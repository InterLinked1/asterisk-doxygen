<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_pjsip_pubsub.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">res_pjsip_pubsub.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d8/dca/res__pjsip__pubsub_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2013, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Mark Michelson &lt;mmichelson@digium.com&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span><span class="comment"></span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * \brief Opaque structure representing an RFC 3265 SIP subscription</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">   &lt;depend&gt;pjproject&lt;/depend&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">   &lt;depend&gt;res_pjsip&lt;/depend&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">   &lt;support_level&gt;core&lt;/support_level&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;pjsip.h&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;pjsip_simple.h&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;pjlib.h&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d33/mwi_8h.html">asterisk/mwi.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html">asterisk/res_pjsip_pubsub.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/module_8h.html">asterisk/module.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d90/linkedlists_8h.html">asterisk/linkedlists.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/da5/astobj2_8h.html">asterisk/astobj2.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/db6/datastore_8h.html">asterisk/datastore.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d1d/uuid_8h.html">asterisk/uuid.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d1e/taskprocessor_8h.html">asterisk/taskprocessor.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d00/sched_8h.html">asterisk/sched.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8c/res__pjsip_8h.html">asterisk/res_pjsip.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d47/callerid_8h.html">asterisk/callerid.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/manager_8h.html">asterisk/manager.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db0/cli_8h.html">asterisk/cli.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/ddc/test_8h.html">asterisk/test.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d5c/res__pjsip__private_8h.html">res_pjsip/include/res_pjsip_private.h</a>&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html">asterisk/res_pjsip_presence_xml.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">/*** DOCUMENTATION</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">   &lt;manager name=&quot;PJSIPShowSubscriptionsInbound&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">         Lists subscriptions.</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">      &lt;syntax /&gt;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">         &lt;para&gt;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">         Provides a listing of all inbound subscriptions.  An event &lt;literal&gt;InboundSubscriptionDetail&lt;/literal&gt;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">         is issued for each subscription object.  Once all detail events are completed an</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">         &lt;literal&gt;InboundSubscriptionDetailComplete&lt;/literal&gt; event is issued.</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">                        &lt;/para&gt;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">   &lt;manager name=&quot;PJSIPShowSubscriptionsOutbound&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">         Lists subscriptions.</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">      &lt;syntax /&gt;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">         &lt;para&gt;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">         Provides a listing of all outbound subscriptions.  An event &lt;literal&gt;OutboundSubscriptionDetail&lt;/literal&gt;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">         is issued for each subscription object.  Once all detail events are completed an</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">         &lt;literal&gt;OutboundSubscriptionDetailComplete&lt;/literal&gt; event is issued.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">                        &lt;/para&gt;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">   &lt;manager name=&quot;PJSIPShowResourceLists&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">         Displays settings for configured resource lists.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">      &lt;syntax /&gt;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">         &lt;para&gt;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">         Provides a listing of all resource lists.  An event &lt;literal&gt;ResourceListDetail&lt;/literal&gt;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">         is issued for each resource list object.  Once all detail events are completed a</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">         &lt;literal&gt;ResourceListDetailComplete&lt;/literal&gt; event is issued.</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">                        &lt;/para&gt;</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">   &lt;configInfo name=&quot;res_pjsip_pubsub&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">      &lt;synopsis&gt;Module that implements publish and subscribe support.&lt;/synopsis&gt;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">      &lt;configFile name=&quot;pjsip.conf&quot;&gt;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">         &lt;configObject name=&quot;subscription_persistence&quot;&gt;</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">            &lt;synopsis&gt;Persists SIP subscriptions so they survive restarts.&lt;/synopsis&gt;</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">            &lt;configOption name=&quot;packet&quot;&gt;</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">               &lt;synopsis&gt;Entire SIP SUBSCRIBE packet that created the subscription&lt;/synopsis&gt;</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">            &lt;configOption name=&quot;src_name&quot;&gt;</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">               &lt;synopsis&gt;The source address of the subscription&lt;/synopsis&gt;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">            &lt;configOption name=&quot;src_port&quot;&gt;</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">               &lt;synopsis&gt;The source port of the subscription&lt;/synopsis&gt;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">            &lt;configOption name=&quot;transport_key&quot;&gt;</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">               &lt;synopsis&gt;The type of transport the subscription was received on&lt;/synopsis&gt;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">            &lt;configOption name=&quot;local_name&quot;&gt;</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">               &lt;synopsis&gt;The local address the subscription was received on&lt;/synopsis&gt;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">            &lt;configOption name=&quot;local_port&quot;&gt;</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">               &lt;synopsis&gt;The local port the subscription was received on&lt;/synopsis&gt;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">            &lt;configOption name=&quot;cseq&quot;&gt;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">               &lt;synopsis&gt;The sequence number of the next NOTIFY to be sent&lt;/synopsis&gt;</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">            &lt;configOption name=&quot;tag&quot;&gt;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">               &lt;synopsis&gt;The local tag of the dialog for the subscription&lt;/synopsis&gt;</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">            &lt;configOption name=&quot;endpoint&quot;&gt;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">               &lt;synopsis&gt;The name of the endpoint that subscribed&lt;/synopsis&gt;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">            &lt;configOption name=&quot;expires&quot;&gt;</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">               &lt;synopsis&gt;The time at which the subscription expires&lt;/synopsis&gt;</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">            &lt;configOption name=&quot;contact_uri&quot;&gt;</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">               &lt;synopsis&gt;The Contact URI of the dialog for the subscription&lt;/synopsis&gt;</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">            &lt;configOption name=&quot;prune_on_boot&quot;&gt;</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">               &lt;synopsis&gt;If set, indicates that the contact used a reliable transport</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">               and therefore the subscription must be deleted after an asterisk restart.</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">               &lt;/synopsis&gt;</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">            &lt;configOption name=&quot;generator_data&quot;&gt;</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">               &lt;synopsis&gt;If set, contains persistence data for all generators of content</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">               for the subscription.</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">               &lt;/synopsis&gt;</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">         &lt;/configObject&gt;</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">         &lt;configObject name=&quot;resource_list&quot;&gt;</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">            &lt;synopsis&gt;Resource list configuration parameters.&lt;/synopsis&gt;</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">            &lt;description&gt;</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">               &lt;para&gt;This configuration object allows for RFC 4662 resource list subscriptions</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">               to be specified. This can be useful to decrease the amount of subscription traffic</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">               that a server has to process.&lt;/para&gt;</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">               &lt;note&gt;</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">                  &lt;para&gt;Current limitations limit the size of SIP NOTIFY requests that Asterisk sends</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">                  to double that of the PJSIP maximum packet length. If your resource list notifications</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">                  are larger than this maximum, you will need to make adjustments.&lt;/para&gt;</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">               &lt;/note&gt;</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">            &lt;/description&gt;</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">            &lt;configOption name=&quot;type&quot;&gt;</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">               &lt;synopsis&gt;Must be of type &#39;resource_list&#39;&lt;/synopsis&gt;</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">            &lt;configOption name=&quot;event&quot;&gt;</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">               &lt;synopsis&gt;The SIP event package that the list resource belong to.&lt;/synopsis&gt;</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">               &lt;description&gt;&lt;para&gt;</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">                  The SIP event package describes the types of resources that Asterisk reports</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">                  the state of.</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">               &lt;/para&gt;</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">                  &lt;enumlist&gt;</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">                     &lt;enum name=&quot;presence&quot;&gt;&lt;para&gt;</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">                        Device state and presence reporting.</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">                     &lt;/para&gt;&lt;/enum&gt;</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">                     &lt;enum name=&quot;dialog&quot;&gt;&lt;para&gt;</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">                        This is identical to &lt;replaceable&gt;presence&lt;/replaceable&gt;.</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">                     &lt;/para&gt;&lt;/enum&gt;</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">                     &lt;enum name=&quot;message-summary&quot;&gt;&lt;para&gt;</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">                        Message-waiting indication (MWI) reporting.</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">                     &lt;/para&gt;&lt;/enum&gt;</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">                  &lt;/enumlist&gt;</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">               &lt;/description&gt;</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">            &lt;configOption name=&quot;list_item&quot;&gt;</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">               &lt;synopsis&gt;The name of a resource to report state on&lt;/synopsis&gt;</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">               &lt;description&gt;</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">                  &lt;para&gt;In general Asterisk looks up list items in the following way:&lt;/para&gt;</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">                  &lt;para&gt;1. Check if the list item refers to another configured resource list.&lt;/para&gt;</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">                  &lt;para&gt;2. Pass the name of the resource off to event-package-specific handlers</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">                     to find the specified resource.&lt;/para&gt;</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">                  &lt;para&gt;The second part means that the way the list item is specified depends</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">                  on what type of list this is. For instance, if you have the &lt;replaceable&gt;event&lt;/replaceable&gt;</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">                  set to &lt;literal&gt;presence&lt;/literal&gt;, then list items should be in the form of</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">                  dialplan_extension@dialplan_context. For &lt;literal&gt;message-summary&lt;/literal&gt; mailbox</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">                  names should be listed.&lt;/para&gt;</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">               &lt;/description&gt;</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">            &lt;configOption name=&quot;full_state&quot; default=&quot;no&quot;&gt;</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">               &lt;synopsis&gt;Indicates if the entire list&#39;s state should be sent out.&lt;/synopsis&gt;</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">               &lt;description&gt;</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">                  &lt;para&gt;If this option is enabled, and a resource changes state, then Asterisk will construct</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">                  a notification that contains the state of all resources in the list. If the option is</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">                  disabled, Asterisk will construct a notification that only contains the states of</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">                  resources that have changed.&lt;/para&gt;</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">                  &lt;note&gt;</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">                     &lt;para&gt;Even with this option disabled, there are certain situations where Asterisk is forced</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">                     to send a notification with the states of all resources in the list. When a subscriber</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">                     renews or terminates its subscription to the list, Asterisk MUST send a full state</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">                     notification.&lt;/para&gt;</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">                  &lt;/note&gt;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">               &lt;/description&gt;</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">            &lt;configOption name=&quot;notification_batch_interval&quot; default=&quot;0&quot;&gt;</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">               &lt;synopsis&gt;Time Asterisk should wait, in milliseconds, before sending notifications.&lt;/synopsis&gt;</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">               &lt;description&gt;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">                  &lt;para&gt;When a resource&#39;s state changes, it may be desired to wait a certain amount before Asterisk</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">                  sends a notification to subscribers. This allows for other state changes to accumulate, so that</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">                  Asterisk can communicate multiple state changes in a single notification instead of rapidly sending</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">                  many notifications.&lt;/para&gt;</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">               &lt;/description&gt;</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">         &lt;/configObject&gt;</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">         &lt;configObject name=&quot;inbound-publication&quot;&gt;</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">            &lt;synopsis&gt;The configuration for inbound publications&lt;/synopsis&gt;</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">            &lt;configOption name=&quot;endpoint&quot; default=&quot;&quot;&gt;</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">               &lt;synopsis&gt;Optional name of an endpoint that is only allowed to publish to this resource&lt;/synopsis&gt;</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">            &lt;configOption name=&quot;type&quot;&gt;</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">               &lt;synopsis&gt;Must be of type &#39;inbound-publication&#39;.&lt;/synopsis&gt;</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">         &lt;/configObject&gt;</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">      &lt;/configFile&gt;</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">   &lt;/configInfo&gt;</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="keyword">static</span> pj_bool_t <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8deba4f5b210a282252f719b1a245029">pubsub_on_rx_request</a>(pjsip_rx_data *rdata);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">  229</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span>pjsip_module <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a> = {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;   .name = { <span class="stringliteral">&quot;PubSub Module&quot;</span>, 13 },</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;   .priority = PJSIP_MOD_PRIORITY_APPLICATION,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;   .on_rx_request = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8deba4f5b210a282252f719b1a245029">pubsub_on_rx_request</a>,</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;};</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad9ab4b2e3c02b132f457ec3e61d5d47d">  235</a></span>&#160;<span class="preprocessor">#define MOD_DATA_PERSISTENCE &quot;sub_persistence&quot;</span></div><div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab95c1bf11412f8e2a82ddd0eb69ad4a4">  236</a></span>&#160;<span class="preprocessor">#define MOD_DATA_MSG &quot;sub_msg&quot;</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4abffbee599d833b446686d5213d80e4">  238</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> pj_str_t <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4abffbee599d833b446686d5213d80e4">str_event_name</a> = { <span class="stringliteral">&quot;Event&quot;</span>, 5 };</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">/*! \brief Scheduler used for automatically expiring publications */</span></div><div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a361b448e9abcfc301602a2573a662d3c">  241</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d7/de8/structast__sched__context.html">ast_sched_context</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a361b448e9abcfc301602a2573a662d3c">sched</a>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">/*! \brief Number of buckets for publications (on a per handler) */</span></div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7b2ea661eb5491432e647c3070aa78a7">  244</a></span>&#160;<span class="preprocessor">#define PUBLICATIONS_BUCKETS 37</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">/*! \brief Default expiration time for PUBLISH if one is not specified */</span></div><div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4d530a1f675151206b5929a37a882fe2">  247</a></span>&#160;<span class="preprocessor">#define DEFAULT_PUBLISH_EXPIRES 3600</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">/*! \brief Number of buckets for subscription datastore */</span></div><div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a39fcd37b99a8eafd0aa1c961d8736f88">  250</a></span>&#160;<span class="preprocessor">#define DATASTORE_BUCKETS 53</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">/*! \brief Default expiration for subscriptions */</span></div><div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#afc353f33f479f252b0cea51d55afc7ca">  253</a></span>&#160;<span class="preprocessor">#define DEFAULT_EXPIRES 3600</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">/*! \brief Defined method for PUBLISH */</span></div><div class="line"><a name="l00256"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad7c1f2dfc743e57aadd39d0be4b97e97">  256</a></span>&#160;<span class="keyword">const</span> pjsip_method <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad7c1f2dfc743e57aadd39d0be4b97e97">pjsip_publish_method</a> =</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;{</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;   PJSIP_OTHER_METHOD,</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   { <span class="stringliteral">&quot;PUBLISH&quot;</span>, 7 }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;};</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"> * \brief The types of PUBLISH messages defined in RFC 3903</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311">  265</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="../../d1/d94/sip_8h.html#a42ecd8494df028dc44c95b90848ad311">sip_publish_type</a> {<span class="comment"></span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">   /*!</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">    * \brief Unknown</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">    * \details</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">    * This actually is not defined in RFC 3903. We use this as a constant</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">    * to indicate that an incoming PUBLISH does not fit into any of the</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">    * other categories and is thus invalid.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a9b252001716803d21529f825433f4008">  274</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a9b252001716803d21529f825433f4008">SIP_PUBLISH_UNKNOWN</a>,</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">   /*!</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">    * \brief Initial</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">    * \details</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">    * The first PUBLISH sent. This will contain a non-zero Expires header</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">    * as well as a body that indicates the current state of the endpoint</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">    * that has sent the message. The initial PUBLISH is the only type</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">    * of PUBLISH to not contain a Sip-If-Match header in it.</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311aeb9d6241943fcb32f34ed3a12548c623">  285</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311aeb9d6241943fcb32f34ed3a12548c623">SIP_PUBLISH_INITIAL</a>,</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">   /*!</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">    * \brief Refresh</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">    * \details</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">    * Used to keep a published state from expiring. This will contain a</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">    * non-zero Expires header but no body since its purpose is not to</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">    * update state.</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00295"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a83a82444fd66df13a6196fe98cedff69">  295</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a83a82444fd66df13a6196fe98cedff69">SIP_PUBLISH_REFRESH</a>,</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">   /*!</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">    * \brief Modify</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">    * \details</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">    * Used to change state from its previous value. This will contain</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">    * a body updating the published state. May or may not contain an</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">    * Expires header.</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311ad4fc06a713557a6d936557a69615d519">  305</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311ad4fc06a713557a6d936557a69615d519">SIP_PUBLISH_MODIFY</a>,</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">   /*!</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">    * \brief Remove</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">    * \details</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">    * Used to remove published state from an ESC. This will contain</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">    * an Expires header set to 0 and likely no body.</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a267332dc912cbca4f3e5ede0fd776ae9">  314</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a267332dc912cbca4f3e5ede0fd776ae9">SIP_PUBLISH_REMOVE</a>,</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;};</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment"> * \brief A vector of strings commonly used throughout this module</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa7db5b123e82a8da6f1ae6fc15aaace5">AST_VECTOR</a>(resources, <span class="keyword">const</span> <span class="keywordtype">char</span> *);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"> * \brief Resource list configuration item</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00325"></a><span class="lineno"><a class="line" href="../../df/dd0/structresource__list.html">  325</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <a class="code" href="../../df/dd0/structresource__list.html#a0e85270ccb77c71eb8f9693642c46daf">SORCERY_OBJECT</a>(details);<span class="comment"></span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">   /*! SIP event package the list uses. */</span></div><div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="../../df/dd0/structresource__list.html#a5053da7047dfe40d67229c5dbc361f8b">  328</a></span>&#160;   <span class="keywordtype">char</span> <span class="keyword">event</span>[32];<span class="comment"></span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">   /*! Strings representing resources in the list. */</span></div><div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">  330</a></span>&#160;   <span class="keyword">struct </span>resources <a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>;<span class="comment"></span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">   /*! Indicates if Asterisk sends full or partial state on notifications. */</span></div><div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="../../df/dd0/structresource__list.html#a4ec2ed8bfc8538671089fc04bb4710bb">  332</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/dd0/structresource__list.html#a4ec2ed8bfc8538671089fc04bb4710bb">full_state</a>;<span class="comment"></span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">   /*! Time, in milliseconds Asterisk waits before sending a batched notification.*/</span></div><div class="line"><a name="l00334"></a><span class="lineno"><a class="line" href="../../df/dd0/structresource__list.html#ac90516981222dda0270465a33483f2b4">  334</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/dd0/structresource__list.html#ac90516981222dda0270465a33483f2b4">notification_batch_interval</a>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;};</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"> * Used to create new entity IDs by ESCs.</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00340"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a47e7031430a4ba4c21aac39b482ffd82">  340</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a47e7031430a4ba4c21aac39b482ffd82">esc_etag_counter</a>;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment"> * \brief Structure representing a SIP publication</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="../../d4/da6/structast__sip__publication.html">  345</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> {<span class="comment"></span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">   /*! Publication datastores set up by handlers */</span></div><div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="../../d4/da6/structast__sip__publication.html#abc32956d82e246471f4e5edbb3dda759">  347</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d4/da6/structast__sip__publication.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>;<span class="comment"></span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">   /*! \brief Entity tag for the publication */</span></div><div class="line"><a name="l00349"></a><span class="lineno"><a class="line" href="../../d4/da6/structast__sip__publication.html#ae9dd8f0a26f1e5fdf7e5630d4dffadd3">  349</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d4/da6/structast__sip__publication.html#ae9dd8f0a26f1e5fdf7e5630d4dffadd3">entity_tag</a>;<span class="comment"></span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">   /*! \brief Handler for this publication */</span></div><div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="../../d4/da6/structast__sip__publication.html#a2f64eb664f09b6d1dde7f4eed3f55862">  351</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d9f/structast__sip__publish__handler.html">ast_sip_publish_handler</a> *<a class="code" href="../../d4/da6/structast__sip__publication.html#a2f64eb664f09b6d1dde7f4eed3f55862">handler</a>;<span class="comment"></span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">   /*! \brief The endpoint with which the subscription is communicating */</span></div><div class="line"><a name="l00353"></a><span class="lineno"><a class="line" href="../../d4/da6/structast__sip__publication.html#a3960205b2a4e7e012dc9f0eae1855f01">  353</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *<a class="code" href="../../d4/da6/structast__sip__publication.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>;<span class="comment"></span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">   /*! \brief Expiration time of the publication */</span></div><div class="line"><a name="l00355"></a><span class="lineno"><a class="line" href="../../d4/da6/structast__sip__publication.html#a06552650d7ef9108d5744ee3f3fff264">  355</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/da6/structast__sip__publication.html#a06552650d7ef9108d5744ee3f3fff264">expires</a>;<span class="comment"></span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">   /*! \brief Scheduled item for expiration of publication */</span></div><div class="line"><a name="l00357"></a><span class="lineno"><a class="line" href="../../d4/da6/structast__sip__publication.html#a5856afac1fb921f1d6a4eb1fe9412bc8">  357</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d4/da6/structast__sip__publication.html#a5856afac1fb921f1d6a4eb1fe9412bc8">sched_id</a>;<span class="comment"></span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">   /*! \brief The resource the publication is to */</span></div><div class="line"><a name="l00359"></a><span class="lineno"><a class="line" href="../../d4/da6/structast__sip__publication.html#add9403c2dd81e949c8c4aa872eabdcc7">  359</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d4/da6/structast__sip__publication.html#add9403c2dd81e949c8c4aa872eabdcc7">resource</a>;<span class="comment"></span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">   /*! \brief The name of the event type configuration */</span></div><div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="../../d4/da6/structast__sip__publication.html#a6aae576152b40374b43f81349aecc739">  361</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d4/da6/structast__sip__publication.html#a6aae576152b40374b43f81349aecc739">event_configuration_name</a>;<span class="comment"></span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">   /*! \brief Data containing the above */</span></div><div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="../../d4/da6/structast__sip__publication.html#a9a3b4be1b9151b0369d7fca9911c7ecd">  363</a></span>&#160;   <span class="keywordtype">char</span> data[0];</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;};</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"> * \brief Structure used for persisting an inbound subscription</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00370"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html">  370</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> {<span class="comment"></span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">   /*! Sorcery object details */</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;   <a class="code" href="../../df/dd0/structresource__list.html#a0e85270ccb77c71eb8f9693642c46daf">SORCERY_OBJECT</a>(details);<span class="comment"></span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">   /*! The name of the endpoint involved in the subscription */</span></div><div class="line"><a name="l00374"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">  374</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>;<span class="comment"></span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">   /*! SIP message that creates the subscription */</span></div><div class="line"><a name="l00376"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#a8d5dbabe731f82e2db15cbf4dabbca93">  376</a></span>&#160;   <span class="keywordtype">char</span> packet[PJSIP_MAX_PKT_LEN];<span class="comment"></span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">   /*! Source address of the message */</span></div><div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#a22710c9f61c084ea3c72d16b9417ff6f">  378</a></span>&#160;   <span class="keywordtype">char</span> src_name[PJ_INET6_ADDRSTRLEN];<span class="comment"></span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">   /*! Source port of the message */</span></div><div class="line"><a name="l00380"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#a2d47efc2f2609185cf802853871de027">  380</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html#a2d47efc2f2609185cf802853871de027">src_port</a>;<span class="comment"></span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">   /*! Local transport key type */</span></div><div class="line"><a name="l00382"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#a050353acc15d097365b7d63f33634d93">  382</a></span>&#160;   <span class="keywordtype">char</span> transport_key[32];<span class="comment"></span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">   /*! Local transport address */</span></div><div class="line"><a name="l00384"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#ade656f40303348a90111082ae08708b1">  384</a></span>&#160;   <span class="keywordtype">char</span> local_name[PJ_INET6_ADDRSTRLEN];<span class="comment"></span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">   /*! Local transport port */</span></div><div class="line"><a name="l00386"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#a009e2d58737d2223ce009dc0631e65dc">  386</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html#a009e2d58737d2223ce009dc0631e65dc">local_port</a>;<span class="comment"></span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">   /*! Next CSeq to use for message */</span></div><div class="line"><a name="l00388"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#aa6f63c8aefae8e2f51a65f61d724aacf">  388</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html#aa6f63c8aefae8e2f51a65f61d724aacf">cseq</a>;<span class="comment"></span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">   /*! Local tag of the dialog */</span></div><div class="line"><a name="l00390"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">  390</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>;<span class="comment"></span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">   /*! When this subscription expires */</span></div><div class="line"><a name="l00392"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#a7814e4900b15b2edc31554bbb7b61b3e">  392</a></span>&#160;   <span class="keyword">struct </span>timeval expires;<span class="comment"></span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">   /*! Contact URI */</span></div><div class="line"><a name="l00394"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#a43edc8933583da8bdbbe4b62a6b0e008">  394</a></span>&#160;   <span class="keywordtype">char</span> contact_uri[PJSIP_MAX_URL_SIZE];<span class="comment"></span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">   /*! Prune subscription on restart */</span></div><div class="line"><a name="l00396"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#a08e0b4a94cab7d431f1717d53d619447">  396</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html#a08e0b4a94cab7d431f1717d53d619447">prune_on_boot</a>;<span class="comment"></span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">   /*! Body generator specific persistence data */</span></div><div class="line"><a name="l00398"></a><span class="lineno"><a class="line" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">  398</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *<a class="code" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">generator_data</a>;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;};</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment"> * \brief The state of the subscription tree</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00404"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89">  404</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89">sip_subscription_tree_state</a> {<span class="comment"></span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">   /*! Normal operation */</span></div><div class="line"><a name="l00406"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af7fea613b9dafd6f664eea50435fea4e">  406</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af7fea613b9dafd6f664eea50435fea4e">SIP_SUB_TREE_NORMAL</a> = 0,<span class="comment"></span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">   /*! A terminate has been requested by Asterisk, the client, or pjproject */</span></div><div class="line"><a name="l00408"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a5ffbdb3ef21db1d83c5a508f5e3865ae">  408</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a5ffbdb3ef21db1d83c5a508f5e3865ae">SIP_SUB_TREE_TERMINATE_PENDING</a>,<span class="comment"></span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">   /*! The terminate is in progress */</span></div><div class="line"><a name="l00410"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af9b5de443ecb1dc5781aff2a03502ca5">  410</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af9b5de443ecb1dc5781aff2a03502ca5">SIP_SUB_TREE_TERMINATE_IN_PROGRESS</a>,<span class="comment"></span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">   /*! The terminate process has finished and the subscription tree is no longer valid */</span></div><div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a68663ef66af50c315fec11f61bc226ab">  412</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a68663ef66af50c315fec11f61bc226ab">SIP_SUB_TREE_TERMINATED</a>,</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;};</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a6ba01bbffb64da676cd5176bb1d918b9">  415</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a6ba01bbffb64da676cd5176bb1d918b9">sub_tree_state_description</a>[] = {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   <span class="stringliteral">&quot;Normal&quot;</span>,</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   <span class="stringliteral">&quot;TerminatePending&quot;</span>,</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;   <span class="stringliteral">&quot;TerminateInProgress&quot;</span>,</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <span class="stringliteral">&quot;Terminated&quot;</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;};</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment"> * \brief A tree of SIP subscriptions</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment"> * Because of the ability to subscribe to resource lists, a SIP</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment"> * subscription can result in a tree of subscriptions being created.</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"> * This structure represents the information relevant to the subscription</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment"> * as a whole, to include the underlying PJSIP structure for the</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"> * subscription.</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00431"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html">  431</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> {<span class="comment"></span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">   /*! The endpoint with which the subscription is communicating */</span></div><div class="line"><a name="l00433"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">  433</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>;<span class="comment"></span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">   /*! Serializer on which to place operations for this subscription */</span></div><div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">  435</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>;<span class="comment"></span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">   /*! The role for this subscription */</span></div><div class="line"><a name="l00437"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">  437</a></span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20">ast_sip_subscription_role</a> role;<span class="comment"></span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">   /*! Persistence information */</span></div><div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">  439</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>;<span class="comment"></span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">   /*! The underlying PJSIP event subscription structure */</span></div><div class="line"><a name="l00441"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">  441</a></span>&#160;   pjsip_evsub *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>;<span class="comment"></span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">   /*! The underlying PJSIP dialog */</span></div><div class="line"><a name="l00443"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">  443</a></span>&#160;   pjsip_dialog *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;<span class="comment"></span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">   /*! Interval to use for batching notifications */</span></div><div class="line"><a name="l00445"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#ac90516981222dda0270465a33483f2b4">  445</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac90516981222dda0270465a33483f2b4">notification_batch_interval</a>;<span class="comment"></span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">   /*! Scheduler ID for batched notification */</span></div><div class="line"><a name="l00447"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#a9d5cc626722f9dee721868da7dc58a40">  447</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d5cc626722f9dee721868da7dc58a40">notify_sched_id</a>;<span class="comment"></span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">   /*! Indicator if scheduled batched notification should be sent */</span></div><div class="line"><a name="l00449"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#a8fe140462b79206a7c20a771dace07e1">  449</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a8fe140462b79206a7c20a771dace07e1">send_scheduled_notify</a>;<span class="comment"></span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">   /*! The root of the subscription tree */</span></div><div class="line"><a name="l00451"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">  451</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>;<span class="comment"></span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">   /*! Is this subscription to a list? */</span></div><div class="line"><a name="l00453"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#a9e1f9ef9caffc6fcf306dbf678ecc747">  453</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9e1f9ef9caffc6fcf306dbf678ecc747">is_list</a>;<span class="comment"></span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">   /*! Next item in the list */</span></div><div class="line"><a name="l00455"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#a8f1e0d0bf78f07ba5cd5825726b20eb8">  455</a></span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7">AST_LIST_ENTRY</a>(<a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a>) <a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a8f1e0d0bf78f07ba5cd5825726b20eb8">next</a>;<span class="comment"></span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">   /*! Subscription tree state */</span></div><div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">  457</a></span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89">sip_subscription_tree_state</a> <a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;<span class="comment"></span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">   /*! On asterisk restart, this is the task data used</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">    * to restart the expiration timer if pjproject isn&#39;t</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">    * capable of restarting the timer.</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00462"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">  462</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d3b/structast__sip__sched__task.html">ast_sip_sched_task</a> *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a>;<span class="comment"></span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">   /*! The transport the subscription was received on.</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">    * Only used for reliable transports.</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00466"></a><span class="lineno"><a class="line" href="../../d0/dd7/structsip__subscription__tree.html#a0cd500af1726295a50c6494772baaaec">  466</a></span>&#160;   pjsip_transport *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a0cd500af1726295a50c6494772baaaec">transport</a>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;};</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment"> * \brief Structure representing a &quot;virtual&quot; SIP subscription.</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment"> * This structure serves a dual purpose. Structurally, it is</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment"> * the constructed tree of subscriptions based on the resources</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment"> * being subscribed to. API-wise, this serves as the handle that</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment"> * subscription handlers use in order to interact with the pubsub API.</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00477"></a><span class="lineno"><a class="line" href="../../db/d02/structast__sip__subscription.html">  477</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> {<span class="comment"></span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">   /*! Subscription datastores set up by handlers */</span></div><div class="line"><a name="l00479"></a><span class="lineno"><a class="line" href="../../db/d02/structast__sip__subscription.html#abc32956d82e246471f4e5edbb3dda759">  479</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../db/d02/structast__sip__subscription.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>;<span class="comment"></span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">   /*! The handler for this subscription */</span></div><div class="line"><a name="l00481"></a><span class="lineno"><a class="line" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">  481</a></span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>;<span class="comment"></span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">   /*! Pointer to the base of the tree */</span></div><div class="line"><a name="l00483"></a><span class="lineno"><a class="line" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">  483</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>;<span class="comment"></span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">   /*! Body generaator for NOTIFYs */</span></div><div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="../../db/d02/structast__sip__subscription.html#a4b57472ac293cbff3de8eb58471771f0">  485</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../db/d02/structast__sip__subscription.html#a4b57472ac293cbff3de8eb58471771f0">body_generator</a>;<span class="comment"></span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">   /*! Vector of child subscriptions */</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa7db5b123e82a8da6f1ae6fc15aaace5">AST_VECTOR</a>(, <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *) children;<span class="comment"></span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">   /*! Saved NOTIFY body text for this subscription */</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *body_text;<span class="comment"></span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">   /*! Indicator that the body text has changed since the last notification */</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   <span class="keywordtype">int</span> body_changed;<span class="comment"></span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">   /*! The current state of the subscription */</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   pjsip_evsub_state subscription_state;<span class="comment"></span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">   /*! For lists, the current version to place in the RLMI body */</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a81b4b1c3c855fb371e7723b473f1ee78">version</a>;<span class="comment"></span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">   /*! For lists, indicates if full state should always be communicated. */</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/dd0/structresource__list.html#a4ec2ed8bfc8538671089fc04bb4710bb">full_state</a>;<span class="comment"></span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">   /*! URI associated with the subscription */</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;   pjsip_sip_uri *uri;<span class="comment"></span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">   /*! Data to be persisted with the subscription */</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *persistence_data;<span class="comment"></span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">   /*! Name of resource being subscribed to */</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   <span class="keywordtype">char</span> resource[0];</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;};</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment"> * \brief Structure representing a publication resource</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00509"></a><span class="lineno"><a class="line" href="../../d2/d91/structast__sip__publication__resource.html">  509</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d2/d91/structast__sip__publication__resource.html">ast_sip_publication_resource</a> {<span class="comment"></span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">   /*! \brief Sorcery object details */</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;   <a class="code" href="../../df/dd0/structresource__list.html#a0e85270ccb77c71eb8f9693642c46daf">SORCERY_OBJECT</a>(details);<span class="comment"></span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">   /*! \brief Optional name of an endpoint that is only allowed to publish to this resource */</span></div><div class="line"><a name="l00513"></a><span class="lineno"><a class="line" href="../../d2/d91/structast__sip__publication__resource.html#a6d2d1c31529bee906473fcabaffff34f">  513</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d2/d91/structast__sip__publication__resource.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>;<span class="comment"></span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">   /*! \brief Mapping for event types to configuration */</span></div><div class="line"><a name="l00515"></a><span class="lineno"><a class="line" href="../../d2/d91/structast__sip__publication__resource.html#ad2ef61c498fc983f10336fd7b5876af7">  515</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../d2/d91/structast__sip__publication__resource.html#ad2ef61c498fc983f10336fd7b5876af7">events</a>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;};</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#af59dad57f47cf8401042d4ecd0b861e5">  518</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#af59dad57f47cf8401042d4ecd0b861e5">sip_subscription_roles_map</a>[] = {</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   [<a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20a3c10d5621e8e7278503d4ea4c13cedc1">AST_SIP_SUBSCRIBER</a>] = <span class="stringliteral">&quot;Subscriber&quot;</span>,</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;   [<a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20ab72ff83a6adb7eae0bf918c8e3f5cf49">AST_SIP_NOTIFIER</a>] = <span class="stringliteral">&quot;Notifier&quot;</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;};</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400">  523</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400">sip_persistence_update_type</a> {<span class="comment"></span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">   /*! Called from send request */</span></div><div class="line"><a name="l00525"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400a56de5c438e2a53b13eb3ba4310d58ae2">  525</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400a56de5c438e2a53b13eb3ba4310d58ae2">SUBSCRIPTION_PERSISTENCE_SEND_REQUEST</a> = 0,<span class="comment"></span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">   /*! Subscription created from initial client request */</span></div><div class="line"><a name="l00527"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400a3ac2fdd9911335d820131a694972a2e3">  527</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400a3ac2fdd9911335d820131a694972a2e3">SUBSCRIPTION_PERSISTENCE_CREATED</a>,<span class="comment"></span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">   /*! Subscription recreated by asterisk on startup */</span></div><div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400aff6b9c21e4f98d098c8bad80b822cdd2">  529</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400aff6b9c21e4f98d098c8bad80b822cdd2">SUBSCRIPTION_PERSISTENCE_RECREATED</a>,<span class="comment"></span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">   /*! Subscription created from client refresh */</span></div><div class="line"><a name="l00531"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400ac38cc588801abf190a87dc6c4220b240">  531</a></span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400ac38cc588801abf190a87dc6c4220b240">SUBSCRIPTION_PERSISTENCE_REFRESHED</a>,</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;};</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno"><a class="line" href="../../df/dab/structsubscriptions.html#ace4e0066a5b24f84b90536e9906619f6">  534</a></span>&#160;<a class="code" href="../../df/d90/linkedlists_8h.html#a39918fd433ac42184b152c86016ef139">AST_RWLIST_HEAD_STATIC</a>(<a class="code" href="../../df/dab/structsubscriptions.html">subscriptions</a>, <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a>);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno"><a class="line" href="../../dd/de0/structbody__generators.html#ace4e0066a5b24f84b90536e9906619f6">  536</a></span>&#160;<a class="code" href="../../df/d90/linkedlists_8h.html#a39918fd433ac42184b152c86016ef139">AST_RWLIST_HEAD_STATIC</a>(<a class="code" href="../../dd/de0/structbody__generators.html">body_generators</a>, <a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a>);</div><div class="line"><a name="l00537"></a><span class="lineno"><a class="line" href="../../d5/d90/structbody__supplements.html#ace4e0066a5b24f84b90536e9906619f6">  537</a></span>&#160;<a class="code" href="../../df/d90/linkedlists_8h.html#a39918fd433ac42184b152c86016ef139">AST_RWLIST_HEAD_STATIC</a>(<a class="code" href="../../d5/d90/structbody__supplements.html">body_supplements</a>, <a class="code" href="../../d7/d72/structast__sip__pubsub__body__supplement.html">ast_sip_pubsub_body_supplement</a>);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae55303c463ee7d4709335ae3311c3826">  539</a></span>&#160;<span class="keyword">static</span> pjsip_media_type <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae55303c463ee7d4709335ae3311c3826">rlmi_media_type</a>;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9edd9dcca7f3caf9af7a4af20ab64868">pubsub_on_evsub_state</a>(pjsip_evsub *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, pjsip_event *<a class="code" href="../../df/d7d/structevent.html">event</a>);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8f6a1ab8c6d5f63fbcc96ea70e0160cf">pubsub_on_rx_refresh</a>(pjsip_evsub *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, pjsip_rx_data *rdata,</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordtype">int</span> *p_st_code, pj_str_t **p_st_text, pjsip_hdr *res_hdr, pjsip_msg_body **p_body);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac9f60cf5b4683fabadff63143ef959f2">pubsub_on_rx_notify</a>(pjsip_evsub *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, pjsip_rx_data *rdata, <span class="keywordtype">int</span> *p_st_code,</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      pj_str_t **p_st_text, pjsip_hdr *res_hdr, pjsip_msg_body **p_body);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a26689d72ab3ff9ce0e56c26fdc6dfd4b">pubsub_on_client_refresh</a>(pjsip_evsub *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3815d56063e28c51b863c26e6b3a49c9">pubsub_on_server_timeout</a>(pjsip_evsub *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>);</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7d62301cf52b6bc6d7b66cea60bee8cc">  549</a></span>&#160;<span class="keyword">static</span> pjsip_evsub_user <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7d62301cf52b6bc6d7b66cea60bee8cc">pubsub_cb</a> = {</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;   .on_evsub_state = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9edd9dcca7f3caf9af7a4af20ab64868">pubsub_on_evsub_state</a>,</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;   .on_rx_refresh = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8f6a1ab8c6d5f63fbcc96ea70e0160cf">pubsub_on_rx_refresh</a>,</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;   .on_rx_notify = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac9f60cf5b4683fabadff63143ef959f2">pubsub_on_rx_notify</a>,</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;   .on_client_refresh = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a26689d72ab3ff9ce0e56c26fdc6dfd4b">pubsub_on_client_refresh</a>,</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;   .on_server_timeout = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3815d56063e28c51b863c26e6b3a49c9">pubsub_on_server_timeout</a>,</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;};</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">/*! \brief Destructor for publication resource */</span></div><div class="line"><a name="l00558"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad470e06c57059377443112a2012ec8bd">  558</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad470e06c57059377443112a2012ec8bd">publication_resource_destroy</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;{</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d91/structast__sip__publication__resource.html">ast_sip_publication_resource</a> *resource = obj;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(resource-&gt;<a class="code" href="../../d2/d91/structast__sip__publication__resource.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a>(resource-&gt;<a class="code" href="../../d2/d91/structast__sip__publication__resource.html#ad2ef61c498fc983f10336fd7b5876af7">events</a>);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;}</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">/*! \brief Allocator for publication resource */</span></div><div class="line"><a name="l00567"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab24c7cae87fc8a55c3a59bbf69cf7352">  567</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab24c7cae87fc8a55c3a59bbf69cf7352">publication_resource_alloc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;{</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/d25/sorcery_8h.html#a4c03ccef909474831717c93679065508">ast_sorcery_generic_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d2/d91/structast__sip__publication__resource.html">ast_sip_publication_resource</a>), <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad470e06c57059377443112a2012ec8bd">publication_resource_destroy</a>);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;}</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2d4ca6324c97d4c2a957dea2aa74c27b">  572</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2d4ca6324c97d4c2a957dea2aa74c27b">sub_tree_subscription_terminate_cb</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;{</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree = data;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;   <span class="keywordflow">if</span> (!sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>) {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="comment">/* Something else already terminated the subscription. */</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;   }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Transport destroyed.  Removing subscription &#39;%s-&gt;%s&#39;  prune on boot: %d\n&quot;</span>,</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource,</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a08e0b4a94cab7d431f1717d53d619447">prune_on_boot</a>);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af9b5de443ecb1dc5781aff2a03502ca5">SIP_SUB_TREE_TERMINATE_IN_PROGRESS</a>;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;   pjsip_evsub_terminate(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, PJ_TRUE);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;}</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment"> * \brief The reliable transport we used as a subscription contact has shutdown.</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment"> * \param data What subscription needs to be terminated.</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment"> * \note Normally executed by the pjsip monitor thread.</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00603"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#abf46a87a277bf64c6230f9f2237906f8">  603</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abf46a87a277bf64c6230f9f2237906f8">sub_tree_transport_cb</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;{</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree = data;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">    * Push off the subscription termination to the serializer to</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">    * avoid deadlock.  Another thread could be trying to send a</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">    * message on the subscription that can deadlock with this</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">    * thread.</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, +1);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2d4ca6324c97d4c2a957dea2aa74c27b">sub_tree_subscription_terminate_cb</a>,</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      sub_tree)) {</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   }</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;}</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">/*! \brief Destructor for subscription persistence */</span></div><div class="line"><a name="l00621"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae5e6ba3b3b049c415ad3056467cc846c">  621</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae5e6ba3b3b049c415ad3056467cc846c">subscription_persistence_destroy</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;{</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = obj;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>(persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">generator_data</a>);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;}</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">/*! \brief Allocator for subscription persistence */</span></div><div class="line"><a name="l00631"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae323533f795e111d13b1d7b9a3d1d973">  631</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae323533f795e111d13b1d7b9a3d1d973">subscription_persistence_alloc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;{</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/d25/sorcery_8h.html#a4c03ccef909474831717c93679065508">ast_sorcery_generic_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a>), <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae5e6ba3b3b049c415ad3056467cc846c">subscription_persistence_destroy</a>);</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;}</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">/*! \brief Function which creates initial persistence information of a subscription in sorcery */</span></div><div class="line"><a name="l00637"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a00a4fae74e9482fb6c95acb3d653a182">  637</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a00a4fae74e9482fb6c95acb3d653a182">subscription_persistence_create</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree)</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;{</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>[PJ_GUID_STRING_LENGTH + 1];</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;   <span class="comment">/* The id of this persistence object doesn&#39;t matter as we keep it on the subscription and don&#39;t need to</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">    * look it up by id at all.</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(),</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;   pjsip_dialog *dlg = sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   <span class="keywordflow">if</span> (!persistence) {</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;   }</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;   persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(tag, &amp;dlg-&gt;local.info-&gt;tag, <span class="keyword">sizeof</span>(tag));</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;   persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(tag);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a575dfe8fd872c033d2b902549df502ea">ast_sorcery_create</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;   <span class="keywordflow">return</span> persistence;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;}</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">/*! \brief Function which updates persistence information of a subscription in sorcery */</span></div><div class="line"><a name="l00662"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab37c67d3e45723f0b0aaf21dd9e2d605">  662</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab37c67d3e45723f0b0aaf21dd9e2d605">subscription_persistence_update</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree,</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;   pjsip_rx_data *rdata, <span class="keyword">enum</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400">sip_persistence_update_type</a> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>)</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;{</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;   pjsip_dialog *dlg;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;   <span class="keywordflow">if</span> (!sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>) {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;   }</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Updating persistence for &#39;%s-&gt;%s&#39;  prune on boot: %s\n&quot;</span>,</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource,</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a08e0b4a94cab7d431f1717d53d619447">prune_on_boot</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;   dlg = sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#aa6f63c8aefae8e2f51a65f61d724aacf">cseq</a> = dlg-&gt;local.cseq;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;   <span class="keywordflow">if</span> (rdata) {</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html#a7814e4900b15b2edc31554bbb7b61b3e">expires</a>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      pjsip_expires_hdr *expires_hdr = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_EXPIRES, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      pjsip_contact_hdr *contact_hdr = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_CONTACT, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      expires = expires_hdr ? expires_hdr-&gt;ivalue : <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4d530a1f675151206b5929a37a882fe2">DEFAULT_PUBLISH_EXPIRES</a>;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7814e4900b15b2edc31554bbb7b61b3e">expires</a> = <a class="code" href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), <a class="code" href="../../de/df7/time_8h.html#a1d774df72e3dbb623475783e06ce4f61">ast_samp2tv</a>(expires, 1));</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">if</span> (contact_hdr) {</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;         <span class="keywordflow">if</span> (contact_hdr) {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            <span class="keywordflow">if</span> (type == <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400a3ac2fdd9911335d820131a694972a2e3">SUBSCRIPTION_PERSISTENCE_CREATED</a>) {</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;               sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a08e0b4a94cab7d431f1717d53d619447">prune_on_boot</a> =</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                  !<a class="code" href="../../d7/d5c/res__pjsip__private_8h.html#ac73444851015b8a7be33534e4a7d2878">ast_sip_will_uri_survive_restart</a>(</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                     (pjsip_sip_uri *)pjsip_uri_get_uri(contact_hdr-&gt;uri),</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                     sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>, rdata);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;               <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a08e0b4a94cab7d431f1717d53d619447">prune_on_boot</a>) {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;adding transport monitor on %s for &#39;%s-&gt;%s&#39;  prune on boot: %d\n&quot;</span>,</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                     rdata-&gt;tp_info.transport-&gt;obj_name,</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                     sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource,</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                     sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a08e0b4a94cab7d431f1717d53d619447">prune_on_boot</a>);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                  sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a0cd500af1726295a50c6494772baaaec">transport</a> = rdata-&gt;tp_info.transport;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                  <a class="code" href="../../d8/d8c/res__pjsip_8h.html#aaee14820d45bd0be318822580b5a8b59">ast_sip_transport_monitor_register</a>(rdata-&gt;tp_info.transport,</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                     <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abf46a87a277bf64c6230f9f2237906f8">sub_tree_transport_cb</a>, sub_tree);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                  <span class="comment">/*</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">                   * FYI: ast_sip_transport_monitor_register holds a reference to the sub_tree</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">                   */</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;               }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;         }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;         pjsip_uri_print(PJSIP_URI_IN_CONTACT_HDR, contact_hdr-&gt;uri,</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;               sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a43edc8933583da8bdbbe4b62a6b0e008">contact_uri</a>, <span class="keyword">sizeof</span>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a43edc8933583da8bdbbe4b62a6b0e008">contact_uri</a>));</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Contact not updated due to missing contact header\n&quot;</span>);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      }</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <span class="comment">/* When receiving a packet on an streaming transport, it&#39;s possible to receive more than one SIP</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">       * message at a time into the rdata-&gt;pkt_info.packet buffer. However, the rdata-&gt;msg_info.msg_buf</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">       * will always point to the proper SIP message that is to be processed. When updating subscription</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">       * persistence that is pulled from persistent storage, though, the rdata-&gt;pkt_info.packet will</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">       * only ever have a single SIP message on it, and so we base persistence on that.</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      <span class="keywordflow">if</span> (type == <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400a3ac2fdd9911335d820131a694972a2e3">SUBSCRIPTION_PERSISTENCE_CREATED</a></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;         || type == <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400aff6b9c21e4f98d098c8bad80b822cdd2">SUBSCRIPTION_PERSISTENCE_RECREATED</a>) {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;         <span class="keywordflow">if</span> (rdata-&gt;msg_info.msg_buf) {</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a8d5dbabe731f82e2db15cbf4dabbca93">packet</a>, rdata-&gt;msg_info.msg_buf,</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                  <a class="code" href="../../d5/d60/utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(<span class="keyword">sizeof</span>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a8d5dbabe731f82e2db15cbf4dabbca93">packet</a>), rdata-&gt;msg_info.len + 1));</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a8d5dbabe731f82e2db15cbf4dabbca93">packet</a>, rdata-&gt;pkt_info.packet,</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                  <span class="keyword">sizeof</span>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a8d5dbabe731f82e2db15cbf4dabbca93">packet</a>));</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;         }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      }</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a22710c9f61c084ea3c72d16b9417ff6f">src_name</a>, rdata-&gt;pkt_info.src_name,</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <span class="keyword">sizeof</span>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a22710c9f61c084ea3c72d16b9417ff6f">src_name</a>));</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a2d47efc2f2609185cf802853871de027">src_port</a> = rdata-&gt;pkt_info.src_port;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a050353acc15d097365b7d63f33634d93">transport_key</a>, rdata-&gt;tp_info.transport-&gt;type_name,</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;         <span class="keyword">sizeof</span>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a050353acc15d097365b7d63f33634d93">transport_key</a>));</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#ade656f40303348a90111082ae08708b1">local_name</a>, &amp;rdata-&gt;tp_info.transport-&gt;local_name.host,</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;         <span class="keyword">sizeof</span>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#ade656f40303348a90111082ae08708b1">local_name</a>));</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a009e2d58737d2223ce009dc0631e65dc">local_port</a> = rdata-&gt;tp_info.transport-&gt;local_name.port;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;   }</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#ab9184a8cdeb14537309e5e020948ecd3">ast_sorcery_update</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;}</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">/*! \brief Function which removes persistence of a subscription from sorcery */</span></div><div class="line"><a name="l00745"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aace626897b8057471bc8f06b3e91e16c">  745</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aace626897b8057471bc8f06b3e91e16c">subscription_persistence_remove</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree)</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;{</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   <span class="keywordflow">if</span> (!sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>) {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;   }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a08e0b4a94cab7d431f1717d53d619447">prune_on_boot</a> &amp;&amp; sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a0cd500af1726295a50c6494772baaaec">transport</a>) {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Unregistering transport monitor on %s &#39;%s-&gt;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;         sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a0cd500af1726295a50c6494772baaaec">transport</a>-&gt;obj_name,</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;         sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a> ? <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>) : <span class="stringliteral">&quot;Unknown&quot;</span>,</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;         sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a> ? sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource : <span class="stringliteral">&quot;Unknown&quot;</span>);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5d73e049fbced1da4e3041d1656e0aa6">ast_sip_transport_monitor_unregister</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a0cd500af1726295a50c6494772baaaec">transport</a>,</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;         <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abf46a87a277bf64c6230f9f2237906f8">sub_tree_transport_cb</a>, sub_tree, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   }</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>, -1);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;}</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a219baab2a37a17e4922d696be2e07cca">find_sub_handler_for_event_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>);</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa43549aaa8be02c39bd1e405f44d27f1">find_body_generator</a>(<span class="keywordtype">char</span> accept[<a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a1521854cc25592b7f8a58a4bed55ac6d">AST_SIP_MAX_ACCEPT</a>][64],</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <span class="keywordtype">size_t</span> num_accept, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a35514bc6335d541353cf54c7146e8ce5">body_type</a>);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">/*! \brief Retrieve a handler using the Event header of an rdata message */</span></div><div class="line"><a name="l00771"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a97f99a19e99580b4339e386220c2d9f6">  771</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a97f99a19e99580b4339e386220c2d9f6">subscription_get_handler_from_rdata</a>(pjsip_rx_data *rdata, <span class="keyword">const</span> <span class="keywordtype">char</span> *endpoint)</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;{</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;   pjsip_event_hdr *event_header;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;   <span class="keywordtype">char</span> <span class="keyword">event</span>[32];</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;   event_header = pjsip_msg_find_hdr_by_name(rdata-&gt;msg_info.msg, &amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4abffbee599d833b446686d5213d80e4">str_event_name</a>, rdata-&gt;msg_info.msg-&gt;hdr.next);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;   <span class="keywordflow">if</span> (!event_header) {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Incoming SUBSCRIBE request from %s with no Event header\n&quot;</span>,</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;         endpoint ? endpoint : <span class="stringliteral">&quot;Unknown&quot;</span>);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   }</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(<a class="code" href="../../df/d7d/structevent.html">event</a>, &amp;event_header-&gt;event_type, <span class="keyword">sizeof</span>(<a class="code" href="../../df/d7d/structevent.html">event</a>));</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;   handler = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a219baab2a37a17e4922d696be2e07cca">find_sub_handler_for_event_name</a>(<a class="code" href="../../df/d7d/structevent.html">event</a>);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   <span class="keywordflow">if</span> (!handler) {</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No registered subscribe handler for event %s from %s\n&quot;</span>, <a class="code" href="../../df/d7d/structevent.html">event</a>,</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;         endpoint ? endpoint : <span class="stringliteral">&quot;Unknown&quot;</span>);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;   }</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;}</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment"> * \brief Accept headers that are exceptions to the rule</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment"> * Typically, when a SUBSCRIBE arrives, we attempt to find a</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"> * body generator that matches one of the Accept headers in</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"> * the request. When subscribing to a single resource, this works</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment"> * great. However, when subscribing to a list, things work</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment"> * differently. Most Accept header values are fine, but there</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment"> * are a couple that are endemic to resource lists that need</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment"> * to be ignored when searching for a body generator to use</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment"> * for the individual resources of the subscription.</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00806"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#af83103f48a2651972c0fc351bfd701bb">  806</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#af83103f48a2651972c0fc351bfd701bb">accept_exceptions</a>[] =  {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   <span class="stringliteral">&quot;multipart/related&quot;</span>,</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;   <span class="stringliteral">&quot;application/rlmi+xml&quot;</span>,</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;};</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment"> * \brief Is the Accept header from the SUBSCRIBE in the list of exceptions?</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment"> * \retval 1 This Accept header value is an exception to the rule.</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment"> * \retval 0 This Accept header is not an exception to the rule.</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00817"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a37e5c81dbce6f5db2f91dbe92689ec2f">  817</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a37e5c81dbce6f5db2f91dbe92689ec2f">exceptional_accept</a>(<span class="keyword">const</span> pj_str_t *<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a37cb3e0e7b0966a69f790d8d182d8cd0">accept</a>)</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;{</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#af83103f48a2651972c0fc351bfd701bb">accept_exceptions</a>); ++i) {</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keywordflow">if</span> (!pj_strcmp2(accept, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#af83103f48a2651972c0fc351bfd701bb">accept_exceptions</a>[i])) {</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      }</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;   }</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;}</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment">/*! \brief Retrieve a body generator using the Accept header of an rdata message */</span></div><div class="line"><a name="l00831"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#af57976fae525316e955e6163f943db90">  831</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#af57976fae525316e955e6163f943db90">subscription_get_generator_from_rdata</a>(pjsip_rx_data *rdata,</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>)</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;{</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;   pjsip_accept_hdr *accept_header = (pjsip_accept_hdr *) &amp;rdata-&gt;msg_info.msg-&gt;hdr;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;   <span class="keywordtype">char</span> accept[<a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a1521854cc25592b7f8a58a4bed55ac6d">AST_SIP_MAX_ACCEPT</a>][64];</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;   <span class="keywordtype">size_t</span> num_accept_headers = 0;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;   <a class="code" href="../../dc/df2/ast__expr2f_8c.html#a8fdafe3be7e00ce3d4f0cb50a9a5eb39">while</a> ((accept_header = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_ACCEPT, accept_header-&gt;next)) &amp;&amp;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      (num_accept_headers &lt; <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a1521854cc25592b7f8a58a4bed55ac6d">AST_SIP_MAX_ACCEPT</a>)) {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; accept_header-&gt;count &amp;&amp; num_accept_headers &lt; <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a1521854cc25592b7f8a58a4bed55ac6d">AST_SIP_MAX_ACCEPT</a>; ++i) {</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a37e5c81dbce6f5db2f91dbe92689ec2f">exceptional_accept</a>(&amp;accept_header-&gt;values[i])) {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(accept[num_accept_headers], &amp;accept_header-&gt;values[i], <span class="keyword">sizeof</span>(accept[num_accept_headers]));</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            ++num_accept_headers;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;         }</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      }</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;   }</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;   <span class="keywordflow">if</span> (num_accept_headers == 0) {</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <span class="comment">/* If a SUBSCRIBE contains no Accept headers, then we must assume that</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">       * the default accept type for the event package is to be used.</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(accept[0], handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a06762434263891503f1fe196fd2cf613">notifier</a>-&gt;<a class="code" href="../../d1/d5b/structast__sip__notifier.html#ad1e64b1a6297045eb98ac47f56591b0f">default_accept</a>, <span class="keyword">sizeof</span>(accept[0]));</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      num_accept_headers = 1;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;   }</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa43549aaa8be02c39bd1e405f44d27f1">find_body_generator</a>(accept, num_accept_headers, handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a35514bc6335d541353cf54c7146e8ce5">body_type</a>);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;}</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">/*! \brief Check if the rdata has a Supported header containing &#39;eventlist&#39;</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment"> *  \retval 1 rdata has an eventlist containing supported header</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment"> *  \retval 0 rdata doesn&#39;t have an eventlist containing supported header</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00866"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa94f5c5d378799e218956c0804cbfb1e">  866</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa94f5c5d378799e218956c0804cbfb1e">ast_sip_pubsub_has_eventlist_support</a>(pjsip_rx_data *rdata)</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;{</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;   pjsip_supported_hdr *supported_header = (pjsip_supported_hdr *) &amp;rdata-&gt;msg_info.msg-&gt;hdr;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;   <a class="code" href="../../dc/df2/ast__expr2f_8c.html#a8fdafe3be7e00ce3d4f0cb50a9a5eb39">while</a> ((supported_header = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_SUPPORTED, supported_header-&gt;next))) {</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; supported_header-&gt;count; i++) {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;         <span class="keywordflow">if</span> (!pj_stricmp2(&amp;supported_header-&gt;values[i], <span class="stringliteral">&quot;eventlist&quot;</span>)) {</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;         }</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      }</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;   }</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;}</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="keyword">struct </span><a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a>;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment"> * \brief A node for a resource tree.</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00888"></a><span class="lineno"><a class="line" href="../../d6/d14/structtree__node.html">  888</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa7db5b123e82a8da6f1ae6fc15aaace5">AST_VECTOR</a>(, <span class="keyword">struct</span> <a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *) children;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/dd0/structresource__list.html#a4ec2ed8bfc8538671089fc04bb4710bb">full_state</a>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;   <span class="keywordtype">char</span> resource[0];</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;};</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment"> * \brief Helper function for retrieving a resource list for a given event.</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment"> * This will retrieve a resource list that corresponds to the resource and event provided.</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment"> * \param resource The name of the resource list to retrieve</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment"> * \param event The expected event name on the resource list</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00902"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a93e6d67f6d539b39fd0ebe7171d480ca">  902</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a93e6d67f6d539b39fd0ebe7171d480ca">retrieve_resource_list</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *resource, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/d7d/structevent.html">event</a>)</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;{</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;   list = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;resource_list&quot;</span>, resource);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;   <span class="keywordflow">if</span> (!list) {</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;   }</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   <span class="keywordflow">if</span> (strcmp(list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#a5053da7047dfe40d67229c5dbc361f8b">event</a>, event)) {</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Found resource list %s, but its event type (%s) does not match SUBSCRIBE&#39;s (%s)\n&quot;</span>,</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            resource, list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#a5053da7047dfe40d67229c5dbc361f8b">event</a>, event);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(list);</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;   }</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;   <span class="keywordflow">return</span> list;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;}</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment"> * \brief Allocate a tree node</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment"> * In addition to allocating and initializing the tree node, the node is also added</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment"> * to the vector of visited resources. See \ref build_resource_tree for more information</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment"> * on the visited resources.</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment"> * \param resource The name of the resource for this tree node.</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment"> * \param visited The vector of resources that have been visited.</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment"> * \param if allocating a list, indicate whether full state is requested in notifications.</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment"> * \retval NULL Allocation failure.</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment"> * \retval non-NULL The newly-allocated tree_node</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00934"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#adba83183b8ab9dfd5b4ce87ddafc78a1">  934</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#adba83183b8ab9dfd5b4ce87ddafc78a1">tree_node_alloc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *resource, <span class="keyword">struct</span> resources *visited, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/dd0/structresource__list.html#a4ec2ed8bfc8538671089fc04bb4710bb">full_state</a>)</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;{</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *<a class="code" href="../../d5/da1/structnode.html">node</a>;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;   node = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*node) + strlen(resource) + 1);</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;   <span class="keywordflow">if</span> (!node) {</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;   }</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;   strcpy(node-&gt;resource, resource);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;node-&gt;children, 4)) {</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(node);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   }</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;   node-&gt;full_state = <a class="code" href="../../df/dd0/structresource__list.html#a4ec2ed8bfc8538671089fc04bb4710bb">full_state</a>;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;   <span class="keywordflow">if</span> (visited) {</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      <a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(visited, resource);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;   }</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   <span class="keywordflow">return</span> node;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;}</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment"> * \brief Destructor for a tree node</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment"> * This function calls recursively in order to destroy</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment"> * all nodes lower in the tree from the given node in</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment"> * addition to the node itself.</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment"> * \param node The node to destroy.</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00965"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aab8324717cc2207dbde31f177aa7ac0f">  965</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aab8324717cc2207dbde31f177aa7ac0f">tree_node_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *<a class="code" href="../../d5/da1/structnode.html">node</a>)</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;{</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   <span class="keywordflow">if</span> (!node) {</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   }</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;node-&gt;children); ++i) {</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aab8324717cc2207dbde31f177aa7ac0f">tree_node_destroy</a>(<a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;node-&gt;children, i));</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   }</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;node-&gt;children);</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(node);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;}</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment"> * \brief Determine if this resource has been visited already</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment"> * See \ref build_resource_tree for more information</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment"> * \param resource The resource currently being visited</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment"> * \param visited The resources that have previously been visited</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00987"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7d439528eda8c1d3b35a443170e745d0">  987</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7d439528eda8c1d3b35a443170e745d0">have_visited</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *resource, <span class="keyword">struct</span> resources *visited)</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;{</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(visited); ++i) {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <span class="keywordflow">if</span> (!strcmp(resource, <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(visited, i))) {</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;   }</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;}</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment"> * \brief Build child nodes for a given parent.</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment"> * This iterates through the items on a resource list and creates tree nodes for each one. The</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment"> * tree nodes created are children of the supplied parent node. If an item in the resource</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment"> * list is itself a list, then this function is called recursively to provide children for</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment"> * the new node.</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment"> * If an item in a resource list is not a list, then the supplied subscription handler is</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment"> * called into as if a new SUBSCRIBE for the list item were presented. The handler&#39;s response</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment"> * is used to determine if the node can be added to the tree or not.</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment"> * If a parent node ends up having no child nodes added under it, then the parent node is</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment"> * pruned from the tree.</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment"> * \param endpoint The endpoint that sent the inbound SUBSCRIBE.</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment"> * \param handler The subscription handler for leaf nodes in the tree.</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment"> * \param list The configured resource list from which the child node is being built.</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment"> * \param parent The parent node for these children.</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment"> * \param visited The resources that have already been visited.</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01021"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a55abfb60c70c5e948521709e10e54492"> 1021</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a55abfb60c70c5e948521709e10e54492">build_node_children</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>,</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list, <span class="keyword">struct</span> <a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *parent, <span class="keyword">struct</span> resources *visited)</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;{</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>); ++i) {</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *current;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *child_list;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *resource = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>, i);</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7d439528eda8c1d3b35a443170e745d0">have_visited</a>(resource, visited)) {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Already visited resource %s. Avoiding duplicate resource or potential loop.\n&quot;</span>, resource);</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      }</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      child_list = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a93e6d67f6d539b39fd0ebe7171d480ca">retrieve_resource_list</a>(resource, list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#a5053da7047dfe40d67229c5dbc361f8b">event</a>);</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      <span class="keywordflow">if</span> (!child_list) {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;         <span class="keywordtype">int</span> resp = handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a06762434263891503f1fe196fd2cf613">notifier</a>-&gt;<a class="code" href="../../d1/d5b/structast__sip__notifier.html#a0772d90dd533f5d4d50dccaad8817843">new_subscribe</a>(endpoint, resource);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;         <span class="keywordflow">if</span> (PJSIP_IS_STATUS_IN_CLASS(resp, 200)) {</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            current = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#adba83183b8ab9dfd5b4ce87ddafc78a1">tree_node_alloc</a>(resource, visited, 0);</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            <span class="keywordflow">if</span> (!current) {</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1,</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                  <span class="stringliteral">&quot;Subscription to leaf resource %s was successful, but encountered allocation error afterwards\n&quot;</span>,</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                  resource);</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            }</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Subscription to leaf resource %s resulted in success. Adding to parent %s\n&quot;</span>,</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                  resource, parent-&gt;resource);</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(&amp;parent-&gt;children, current)) {</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;               <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aab8324717cc2207dbde31f177aa7ac0f">tree_node_destroy</a>(current);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;            }</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Subscription to leaf resource %s resulted in error response %d\n&quot;</span>,</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                  resource, resp);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;         }</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Resource %s (child of %s) is a list\n&quot;</span>, resource, parent-&gt;resource);</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;         current = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#adba83183b8ab9dfd5b4ce87ddafc78a1">tree_node_alloc</a>(resource, visited, child_list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#a4ec2ed8bfc8538671089fc04bb4710bb">full_state</a>);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;         <span class="keywordflow">if</span> (!current) {</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Cannot build children of resource %s due to allocation failure\n&quot;</span>, resource);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;         }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;         <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a55abfb60c70c5e948521709e10e54492">build_node_children</a>(endpoint, handler, child_list, current, visited);</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;current-&gt;children) &gt; 0) {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;List %s had no successful children.\n&quot;</span>, resource);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(&amp;parent-&gt;children, current)) {</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;               <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aab8324717cc2207dbde31f177aa7ac0f">tree_node_destroy</a>(current);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;            }</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;List %s had successful children. Adding to parent %s\n&quot;</span>,</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                  resource, parent-&gt;resource);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aab8324717cc2207dbde31f177aa7ac0f">tree_node_destroy</a>(current);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;         }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(child_list);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      }</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;   }</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;}</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment"> * \brief A resource tree</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment"> * When an inbound SUBSCRIBE arrives, the resource being subscribed to may</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment"> * be a resource list. If this is the case, the resource list may contain resources</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment"> * that are themselves lists. The structure needed to hold the resources is</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment"> * a tree.</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment"> * Upon receipt of the SUBSCRIBE, the tree is built by determining if subscriptions</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment"> * to the individual resources in the tree would be successful or not. Any successful</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment"> * subscriptions result in a node in the tree being created. Any unsuccessful subscriptions</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment"> * result in no node being created.</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment"> * This tree can be seen as a bare-bones analog of the tree of ast_sip_subscriptions that</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment"> * will end up being created to actually carry out the duties of a SIP SUBSCRIBE dialog.</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01095"></a><span class="lineno"><a class="line" href="../../d9/d6a/structresource__tree.html"> 1095</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> {</div><div class="line"><a name="l01096"></a><span class="lineno"><a class="line" href="../../d9/d6a/structresource__tree.html#a2dce9d43da01d556f3a1d694d03a40a9"> 1096</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *<a class="code" href="../../d9/d6a/structresource__tree.html#a2dce9d43da01d556f3a1d694d03a40a9">root</a>;</div><div class="line"><a name="l01097"></a><span class="lineno"><a class="line" href="../../d9/d6a/structresource__tree.html#ac90516981222dda0270465a33483f2b4"> 1097</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d6a/structresource__tree.html#ac90516981222dda0270465a33483f2b4">notification_batch_interval</a>;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;};</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment"> * \brief Destroy a resource tree.</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment"> * This function makes no assumptions about how the tree itself was</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment"> * allocated and does not attempt to free the tree itself. Callers</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment"> * of this function are responsible for freeing the tree.</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment"> * \param tree The tree to destroy.</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01109"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aca2de2a2c7ba7a0a16d4632b56af96fa"> 1109</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aca2de2a2c7ba7a0a16d4632b56af96fa">resource_tree_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> *tree)</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;{</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;   <span class="keywordflow">if</span> (tree) {</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aab8324717cc2207dbde31f177aa7ac0f">tree_node_destroy</a>(tree-&gt;<a class="code" href="../../d9/d6a/structresource__tree.html#a2dce9d43da01d556f3a1d694d03a40a9">root</a>);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;   }</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;}</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment"> * \brief Build a resource tree</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment"> * This function builds a resource tree based on the requested resource in a SUBSCRIBE request.</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment"> * This function also creates a container that has all resources that have been visited during</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment"> * creation of the tree, whether those resources resulted in a tree node being created or not.</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment"> * Keeping this container of visited resources allows for misconfigurations such as loops in</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment"> * the tree or duplicated resources to be detected.</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment"> * \param endpoint The endpoint that sent the SUBSCRIBE request.</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment"> * \param handler The subscription handler for leaf nodes in the tree.</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment"> * \param resource The resource requested in the SUBSCRIBE request.</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment"> * \param tree The tree that is to be built.</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment"> * \param has_eventlist_support</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment"> * \retval 200-299 Successfully subscribed to at least one resource.</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment"> * \retval 300-699 Failure to subscribe to requested resource.</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01135"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477"> 1135</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477">build_resource_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>,</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *resource, <span class="keyword">struct</span> <a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> *tree, <span class="keywordtype">int</span> has_eventlist_support)</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;{</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;   <span class="keyword">struct </span>resources visited;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;   <span class="keywordflow">if</span> (!has_eventlist_support || !(list = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a93e6d67f6d539b39fd0ebe7171d480ca">retrieve_resource_list</a>(resource, handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>))) {</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Subscription &#39;%s-&gt;%s&#39; is not to a list\n&quot;</span>,</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint), resource);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      tree-&gt;<a class="code" href="../../d9/d6a/structresource__tree.html#a2dce9d43da01d556f3a1d694d03a40a9">root</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#adba83183b8ab9dfd5b4ce87ddafc78a1">tree_node_alloc</a>(resource, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <span class="keywordflow">if</span> (!tree-&gt;<a class="code" href="../../d9/d6a/structresource__tree.html#a2dce9d43da01d556f3a1d694d03a40a9">root</a>) {</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;         <span class="keywordflow">return</span> 500;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      }</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="keywordflow">return</span> handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a06762434263891503f1fe196fd2cf613">notifier</a>-&gt;<a class="code" href="../../d1/d5b/structast__sip__notifier.html#a0772d90dd533f5d4d50dccaad8817843">new_subscribe</a>(endpoint, resource);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;   }</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Subscription &#39;%s-&gt;%s&#39; is a list\n&quot;</span>,</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint), resource);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;visited, <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;list-&gt;items))) {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      <span class="keywordflow">return</span> 500;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;   }</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;   tree-&gt;<a class="code" href="../../d9/d6a/structresource__tree.html#a2dce9d43da01d556f3a1d694d03a40a9">root</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#adba83183b8ab9dfd5b4ce87ddafc78a1">tree_node_alloc</a>(resource, &amp;visited, list-&gt;full_state);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;   <span class="keywordflow">if</span> (!tree-&gt;<a class="code" href="../../d9/d6a/structresource__tree.html#a2dce9d43da01d556f3a1d694d03a40a9">root</a>) {</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;visited);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      <span class="keywordflow">return</span> 500;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;   }</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;   tree-&gt;<a class="code" href="../../d9/d6a/structresource__tree.html#ac90516981222dda0270465a33483f2b4">notification_batch_interval</a> = list-&gt;notification_batch_interval;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a55abfb60c70c5e948521709e10e54492">build_node_children</a>(endpoint, handler, list, tree-&gt;<a class="code" href="../../d9/d6a/structresource__tree.html#a2dce9d43da01d556f3a1d694d03a40a9">root</a>, &amp;visited);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;visited);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;tree-&gt;<a class="code" href="../../d9/d6a/structresource__tree.html#a2dce9d43da01d556f3a1d694d03a40a9">root</a>-&gt;children) &gt; 0) {</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      <span class="keywordflow">return</span> 200;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      <span class="keywordflow">return</span> 500;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;   }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;}</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div><div class="line"><a name="l01175"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8ebc5adf3564428c0201cff2376dd187"> 1175</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8ebc5adf3564428c0201cff2376dd187">add_subscription</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *obj)</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;{</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../df/dab/structsubscriptions.html">subscriptions</a>);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="../../df/dab/structsubscriptions.html">subscriptions</a>, obj, next);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/dab/structsubscriptions.html">subscriptions</a>);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;}</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div><div class="line"><a name="l01182"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a55772a6ad10b532f9ae2085ceb0c3942"> 1182</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a55772a6ad10b532f9ae2085ceb0c3942">remove_subscription</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *obj)</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;{</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *i;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../df/dab/structsubscriptions.html">subscriptions</a>);</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="../../df/dab/structsubscriptions.html">subscriptions</a>, i, <a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a8f1e0d0bf78f07ba5cd5825726b20eb8">next</a>) {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      <span class="keywordflow">if</span> (i == obj) {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a>(<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a8f1e0d0bf78f07ba5cd5825726b20eb8">next</a>);</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;         <span class="keywordflow">if</span> (i-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>) {</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Removing subscription &#39;%s-&gt;%s&#39; from list of subscriptions\n&quot;</span>,</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;               <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(i-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>), <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2d7ed3f8785ad9d9aa3fc090d983c45d">ast_sip_subscription_get_resource_name</a>(i-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>));</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;         }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      }</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;   }</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/dab/structsubscriptions.html">subscriptions</a>);</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;}</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div><div class="line"><a name="l01201"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#abcc2b6e9a594e068ec58be82446b15fa"> 1201</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abcc2b6e9a594e068ec58be82446b15fa">destroy_subscription</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;{</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Destroying SIP subscription from &#39;%s-&gt;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a> &amp;&amp; sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a> ? <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>) : <span class="stringliteral">&quot;Unknown&quot;</span>,</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      sub-&gt;resource);</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(sub-&gt;body_text);</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;sub-&gt;children);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>);</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>(sub-&gt;persistence_data);</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(sub);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;}</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8c090850897d5a72420ff3446fe74440"> 1215</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8c090850897d5a72420ff3446fe74440">destroy_subscriptions</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>)</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;{</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;   <span class="keywordflow">if</span> (!root) {</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;   }</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;root-&gt;children); ++i) {</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *child;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      child = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;root-&gt;children, i);</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8c090850897d5a72420ff3446fe74440">destroy_subscriptions</a>(child);</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;   }</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abcc2b6e9a594e068ec58be82446b15fa">destroy_subscription</a>(root);</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;}</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa70a279b186df17b611eabf8164c396c"> 1233</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa70a279b186df17b611eabf8164c396c">allocate_subscription</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>,</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *resource, <span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>)</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;{</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;   pjsip_sip_uri *contact_uri;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;   sub = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*sub) + strlen(resource) + 1);</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;   <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;   }</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   strcpy(sub-&gt;resource, resource); <span class="comment">/* Safe */</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;   sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#abc32956d82e246471f4e5edbb3dda759">datastores</a> = <a class="code" href="../../d9/db6/datastore_8h.html#afa0c7f9c8f98470441ff8e9b3e8f34cc">ast_datastores_alloc</a>();</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;   <span class="keywordflow">if</span> (!sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>) {</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abcc2b6e9a594e068ec58be82446b15fa">destroy_subscription</a>(sub);</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;   }</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;   sub-&gt;body_text = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(128);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;   <span class="keywordflow">if</span> (!sub-&gt;body_text) {</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abcc2b6e9a594e068ec58be82446b15fa">destroy_subscription</a>(sub);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;   }</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;   sub-&gt;uri = pjsip_sip_uri_create(tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;pool, PJ_FALSE);</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   contact_uri = pjsip_uri_get_uri(tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;local.contact-&gt;uri);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;   pjsip_sip_uri_assign(tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;pool, sub-&gt;uri, contact_uri);</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   pj_strdup2(tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;pool, &amp;sub-&gt;uri-&gt;user, resource);</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;   <span class="comment">/* If there is any persistence information available for this subscription that was persisted</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment">    * then make it available so that the NOTIFY has the correct state.</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;   <span class="keywordflow">if</span> (tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a> &amp;&amp; tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">generator_data</a>) {</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      sub-&gt;persistence_data = <a class="code" href="../../d4/d05/json_8h.html#a0ca956b7df20127f7e38993c3c06cb2c">ast_json_ref</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">generator_data</a>, resource));</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;   }</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;   sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a> = <a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;   sub-&gt;subscription_state = PJSIP_EVSUB_STATE_ACTIVE;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;   sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(tree);</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;}</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment"> * \brief Create a tree of virtual subscriptions based on a resource tree node.</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment"> * \param handler The handler to supply to leaf subscriptions.</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment"> * \param resource The requested resource for this subscription.</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment"> * \param generator Body generator to use for leaf subscriptions.</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment"> * \param tree The root of the subscription tree.</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment"> * \param current The tree node that corresponds to the subscription being created.</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01286"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad45e6800f846deafb7b108ee3107b22a"> 1286</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad45e6800f846deafb7b108ee3107b22a">create_virtual_subscriptions</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>,</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *resource, <span class="keyword">struct</span> <a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../df/dde/app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>,</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>, <span class="keyword">struct</span> <a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *current)</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;{</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;   sub = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa70a279b186df17b611eabf8164c396c">allocate_subscription</a>(handler, resource, tree);</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;   <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;   }</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;   sub-&gt;full_state = current-&gt;full_state;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;   sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4b57472ac293cbff3de8eb58471771f0">body_generator</a> = <a class="code" href="../../df/dde/app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;sub-&gt;children, <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;current-&gt;children));</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;current-&gt;children); ++i) {</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *child;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *child_node = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;current-&gt;children, i);</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      child = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad45e6800f846deafb7b108ee3107b22a">create_virtual_subscriptions</a>(handler, child_node-&gt;resource, generator,</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            tree, child_node);</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      <span class="keywordflow">if</span> (!child) {</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Child subscription to resource %s could not be created\n&quot;</span>,</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;               child_node-&gt;resource);</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      }</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(&amp;sub-&gt;children, child)) {</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Child subscription to resource %s could not be appended\n&quot;</span>,</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;               child_node-&gt;resource);</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;         <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abcc2b6e9a594e068ec58be82446b15fa">destroy_subscription</a>(child);</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;         <span class="comment">/* Have to release tree here too because a ref was added</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">          * to child that destroy_subscription() doesn&#39;t release. */</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(tree);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      }</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;   }</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;}</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a52b5a301995d607923de2caddcdcdb62"> 1328</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a52b5a301995d607923de2caddcdcdb62">shutdown_subscriptions</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;{</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;   <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;   }</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;sub-&gt;children) &gt; 0) {</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;sub-&gt;children); ++i) {</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;         <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a52b5a301995d607923de2caddcdcdb62">shutdown_subscriptions</a>(<a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;sub-&gt;children, i));</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;      }</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;   }</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;   <span class="comment">/* We notify subscription shutdown only on the tree leaves. */</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;   <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aafe0a2289a5de4ddc780067899f70eaa">subscription_shutdown</a>) {</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aafe0a2289a5de4ddc780067899f70eaa">subscription_shutdown</a>(sub);</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;   }</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;}</div><div class="line"><a name="l01348"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a91e1ece55fdcfb0290b5cac07b1d463a"> 1348</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a91e1ece55fdcfb0290b5cac07b1d463a">subscription_unreference_dialog</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;{</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree = obj;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;   <span class="comment">/* This is why we keep the dialog on the subscription. When the subscription</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment">    * is destroyed, there is no guarantee that the underlying dialog is ready</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment">    * to be destroyed. Furthermore, there&#39;s no guarantee in the opposite direction</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment">    * either. The dialog could be destroyed before our subscription is. We fix</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">    * this problem by keeping a reference to the dialog until it is time to</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment">    * destroy the subscription. We need to have the dialog available when the</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">    * subscription is destroyed so that we can guarantee that our attempt to</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">    * remove the serializer will be successful.</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;   pjsip_dlg_dec_session(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>, &amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>);</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;}</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div><div class="line"><a name="l01367"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a05c2af54560a8245eef9bd323c2f758b"> 1367</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a05c2af54560a8245eef9bd323c2f758b">subscription_tree_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;{</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree = obj;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Destroying subscription tree %p &#39;%s-&gt;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;      sub_tree,</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a> ? <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>) : <span class="stringliteral">&quot;Unknown&quot;</span>,</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a> ? sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource : <span class="stringliteral">&quot;Unknown&quot;</span>);</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8c090850897d5a72420ff3446fe74440">destroy_subscriptions</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>);</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>) {</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      <a class="code" href="../../d7/dfa/group__pjsip__threading.html#gab8c82412fe0432a91d5c7985cfdf9b59">ast_sip_push_task_wait_servant</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>,</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;         <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a91e1ece55fdcfb0290b5cac07b1d463a">subscription_unreference_dialog</a>, sub_tree);</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;   }</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>);</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;   <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>);</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#a15896c26e51e8162df5eb9a0124c841f">ast_module_unref</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;}</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3bb393c5880be9a3a3ddeccfc998452b"> 1389</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3bb393c5880be9a3a3ddeccfc998452b">ast_sip_subscription_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;{</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Removing subscription %p &#39;%s-&gt;%s&#39; reference to subscription tree %p\n&quot;</span>,</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      sub, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>), sub-&gt;resource, sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>);</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>);</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;}</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#acc8db1e0ce416bc7a5a05275db0cb8a7"> 1396</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acc8db1e0ce416bc7a5a05275db0cb8a7">subscription_setup_dialog</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, pjsip_dialog *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>)</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;{</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a> = <a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;   <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga86c62fe22e3b7fb409c13ec7fd4fee2d">ast_sip_dialog_set_serializer</a>(dlg, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>);</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;   <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga6d8415024c851216fa63fbb94d0aadcf">ast_sip_dialog_set_endpoint</a>(dlg, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>);</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;   pjsip_evsub_set_mod_data(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id, sub_tree);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;   pjsip_dlg_inc_session(dlg, &amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>);</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;}</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae855491c1f2f6714df5daa3fd69a10df"> 1405</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae855491c1f2f6714df5daa3fd69a10df">allocate_subscription_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>, pjsip_rx_data *rdata)</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;{</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;   sub_tree = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span> *sub_tree, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a05c2af54560a8245eef9bd323c2f758b">subscription_tree_destructor</a>);</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;   <span class="keywordflow">if</span> (!sub_tree) {</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;   }</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#a8dea6491bedba471fc44574d76438577">ast_module_ref</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;   <span class="keywordflow">if</span> (rdata) {</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">       * We must continue using the serializer that the original</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment">       * SUBSCRIBE came in on for the dialog.  There may be</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="comment">       * retransmissions already enqueued in the original</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="comment">       * serializer that can result in reentrancy and message</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="comment">       * sequencing problems.</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a> = <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga506c31bc071963fa7ef3ed517fa0a533">ast_sip_get_distributor_serializer</a>(rdata);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      <span class="keywordtype">char</span> tps_name[<a class="code" href="../../d0/d1e/taskprocessor_8h.html#adf4c5a237767eb6db5b1db41ccdfc689">AST_TASKPROCESSOR_MAX_NAME</a> + 1];</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      <span class="comment">/* Create name with seq number appended. */</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ab47623e207bf2cdd0edfa613d91894e5">ast_taskprocessor_build_name</a>(tps_name, <span class="keyword">sizeof</span>(tps_name), <span class="stringliteral">&quot;pjsip/pubsub/%s&quot;</span>,</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint));</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a> = <a class="code" href="../../d7/dfa/group__pjsip__threading.html#gad57aa0b914fbd6adbf8ee2fe176e1fb1">ast_sip_create_serializer</a>(tps_name);</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;   }</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;   <span class="keywordflow">if</span> (!sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>) {</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;   }</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(endpoint);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d5cc626722f9dee721868da7dc58a40">notify_sched_id</a> = -1;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;   <span class="keywordflow">return</span> sub_tree;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;}</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment"> * \brief Create a subscription tree based on a resource tree.</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="comment"> * Using the previously-determined valid resources in the provided resource tree,</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="comment"> * a corresponding tree of ast_sip_subscriptions are created. The root of the</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment"> * subscription tree is a real subscription, and the rest in the tree are</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="comment"> * virtual subscriptions.</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="comment"> * \param handler The handler to use for leaf subscriptions</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="comment"> * \param endpoint The endpoint that sent the SUBSCRIBE request</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment"> * \param rdata The SUBSCRIBE content</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment"> * \param resource The requested resource in the SUBSCRIBE request</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment"> * \param generator The body generator to use in leaf subscriptions</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="comment"> * \param tree The resource tree on which the subscription tree is based</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="comment"> * \param dlg_status[out] The result of attempting to create a dialog.</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="comment"> * \retval NULL Could not create the subscription tree</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment"> * \retval non-NULL The root of the created subscription tree</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a006316bcef76ef13dc1cc99560fbaa86"> 1465</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a006316bcef76ef13dc1cc99560fbaa86">create_subscription_tree</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>,</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>, pjsip_rx_data *rdata, <span class="keyword">const</span> <span class="keywordtype">char</span> *resource,</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../df/dde/app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>, <span class="keyword">struct</span> <a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> *tree,</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      pj_status_t *dlg_status, <span class="keyword">struct</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>)</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;{</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;   pjsip_dialog *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;   sub_tree = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae855491c1f2f6714df5daa3fd69a10df">allocate_subscription_tree</a>(endpoint, rdata);</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;   <span class="keywordflow">if</span> (!sub_tree) {</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      *dlg_status = PJ_ENOMEM;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;   }</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a> = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20ab72ff83a6adb7eae0bf918c8e3f5cf49">AST_SIP_NOTIFIER</a>;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;   dlg = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a9d885d67aea1a6b3419ea96692cd2527">ast_sip_create_dialog_uas_locked</a>(endpoint, rdata, dlg_status);</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;   <span class="keywordflow">if</span> (!dlg) {</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="keywordflow">if</span> (*dlg_status != PJ_EEXISTS) {</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create dialog for SIP subscription\n&quot;</span>);</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      }</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;   }</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;   persistence = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#aad194ead974937834375b0ac8d37a7c2">ast_sip_mod_data_get</a>(rdata-&gt;endpt_info.mod_data,</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;         <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad9ab4b2e3c02b132f457ec3e61d5d47d">MOD_DATA_PERSISTENCE</a>);</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;   <span class="keywordflow">if</span> (persistence) {</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      <span class="comment">/* Update the created dialog with the persisted information */</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      pjsip_ua_unregister_dlg(pjsip_ua_instance(), dlg);</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      pj_strdup2(dlg-&gt;pool, &amp;dlg-&gt;local.info-&gt;tag, persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>);</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      dlg-&gt;local.tag_hval = pj_hash_calc_tolower(0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;dlg-&gt;local.info-&gt;tag);</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      pjsip_ua_register_dlg(pjsip_ua_instance(), dlg);</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      dlg-&gt;local.cseq = persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#aa6f63c8aefae8e2f51a65f61d724aacf">cseq</a>;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;   }</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;   pjsip_evsub_create_uas(dlg, &amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7d62301cf52b6bc6d7b66cea60bee8cc">pubsub_cb</a>, rdata, 0, &amp;sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>);</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acc8db1e0ce416bc7a5a05275db0cb8a7">subscription_setup_dialog</a>(sub_tree, dlg);</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment">    * The evsub and subscription setup both add dialog refs, so the dialog ref that</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">    * was added when the dialog was created (see ast_sip_create_dialog_uas_lock) can</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">    * now be removed. The lock should no longer be needed so can be removed too.</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;   pjsip_dlg_dec_lock(dlg);</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="preprocessor">#ifdef HAVE_PJSIP_EVSUB_GRP_LOCK</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;   pjsip_evsub_add_ref(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>);</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a9937f98867d28da0cc0e8590d9c9ffa4">ast_sip_mod_data_set</a>(dlg-&gt;pool, dlg-&gt;mod_data, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab95c1bf11412f8e2a82ddd0eb69ad4a4">MOD_DATA_MSG</a>,</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;         pjsip_msg_clone(dlg-&gt;pool, rdata-&gt;msg_info.msg));</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac90516981222dda0270465a33483f2b4">notification_batch_interval</a> = tree-&gt;<a class="code" href="../../d9/d6a/structresource__tree.html#ac90516981222dda0270465a33483f2b4">notification_batch_interval</a>;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;   <span class="comment">/* Persistence information needs to be available for all the subscriptions */</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(persistence);</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad45e6800f846deafb7b108ee3107b22a">create_virtual_subscriptions</a>(handler, resource, generator, sub_tree, tree-&gt;<a class="code" href="../../d9/d6a/structresource__tree.html#a2dce9d43da01d556f3a1d694d03a40a9">root</a>);</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;children) &gt; 0) {</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9e1f9ef9caffc6fcf306dbf678ecc747">is_list</a> = 1;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;   }</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8ebc5adf3564428c0201cff2376dd187">add_subscription</a>(sub_tree);</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;   <span class="keywordflow">return</span> sub_tree;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;}</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="comment">/*! Wrapper structure for initial_notify_task */</span></div><div class="line"><a name="l01534"></a><span class="lineno"><a class="line" href="../../df/dbb/structinitial__notify__data.html"> 1534</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../df/dbb/structinitial__notify__data.html">initial_notify_data</a> {</div><div class="line"><a name="l01535"></a><span class="lineno"><a class="line" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518"> 1535</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>;</div><div class="line"><a name="l01536"></a><span class="lineno"><a class="line" href="../../df/dbb/structinitial__notify__data.html#a06552650d7ef9108d5744ee3f3fff264"> 1536</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/dbb/structinitial__notify__data.html#a06552650d7ef9108d5744ee3f3fff264">expires</a>;</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;};</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acb194881d03c561cd60d0c88f82c7478">initial_notify_task</a>(<span class="keywordtype">void</span> *obj);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8b3391cb48972f432118c4ca2eeb3063">send_notify</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> force_full_state);</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">/*! Persistent subscription recreation continuation under distributor serializer data */</span></div><div class="line"><a name="l01543"></a><span class="lineno"><a class="line" href="../../d4/d4c/structpersistence__recreate__data.html"> 1543</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d4/d4c/structpersistence__recreate__data.html">persistence_recreate_data</a> {</div><div class="line"><a name="l01544"></a><span class="lineno"><a class="line" href="../../d4/d4c/structpersistence__recreate__data.html#a21053f8b496f0b3ac0aee6f43d27adce"> 1544</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *<a class="code" href="../../d4/d4c/structpersistence__recreate__data.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>;</div><div class="line"><a name="l01545"></a><span class="lineno"><a class="line" href="../../d4/d4c/structpersistence__recreate__data.html#a41249c16bd9cc17b36f3719debaf7a67"> 1545</a></span>&#160;   pjsip_rx_data *<a class="code" href="../../d4/d4c/structpersistence__recreate__data.html#a41249c16bd9cc17b36f3719debaf7a67">rdata</a>;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;};</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment"> * \brief subscription_persistence_recreate continuation under distributor serializer.</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="comment"> * \since 13.10.0</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01556"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a45ea33c1531c67d7002776939ec80b2b"> 1556</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a45ea33c1531c67d7002776939ec80b2b">sub_persistence_recreate</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;{</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d4c/structpersistence__recreate__data.html">persistence_recreate_data</a> *recreate_data = obj;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = recreate_data-&gt;<a class="code" href="../../d4/d4c/structpersistence__recreate__data.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;   pjsip_rx_data *rdata = recreate_data-&gt;<a class="code" href="../../d4/d4c/structpersistence__recreate__data.html#a41249c16bd9cc17b36f3719debaf7a67">rdata</a>;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../df/dde/app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;   <span class="keywordtype">char</span> *resource;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;   pjsip_sip_uri *request_uri;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;   <span class="keywordtype">size_t</span> resource_size;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;   <span class="keywordtype">int</span> resp;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> tree;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;   pjsip_expires_hdr *expires_header;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;   int64_t expires;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;   request_uri = pjsip_uri_get_uri(rdata-&gt;msg_info.msg-&gt;line.req.uri);</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;   resource_size = pj_strlen(&amp;request_uri-&gt;user) + 1;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;   resource = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(resource_size);</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(resource, &amp;request_uri-&gt;user, resource_size);</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment">    * We may want to match without any user options getting</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">    * in the way.</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a6bb5769d100d0348446c7f032eca58c1">AST_SIP_USER_OPTIONS_TRUNCATE_CHECK</a>(resource);</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;   handler = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a97f99a19e99580b4339e386220c2d9f6">subscription_get_handler_from_rdata</a>(rdata, persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;   <span class="keywordflow">if</span> (!handler || !handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a06762434263891503f1fe196fd2cf613">notifier</a>) {</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed recreating &#39;%s&#39; subscription: Could not get subscription handler.\n&quot;</span>,</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;         persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;   }</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;   generator = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#af57976fae525316e955e6163f943db90">subscription_get_generator_from_rdata</a>(rdata, handler);</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;   <span class="keywordflow">if</span> (!generator) {</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed recreating &#39;%s&#39; subscription: Body generator not available.\n&quot;</span>,</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;         persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;   }</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a9937f98867d28da0cc0e8590d9c9ffa4">ast_sip_mod_data_set</a>(rdata-&gt;tp_info.pool, rdata-&gt;endpt_info.mod_data,</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad9ab4b2e3c02b132f457ec3e61d5d47d">MOD_DATA_PERSISTENCE</a>, persistence);</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;   <span class="comment">/* Getting the endpoint may take some time that can affect the expiration. */</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;   endpoint = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;endpoint&quot;</span>,</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;   <span class="keywordflow">if</span> (!endpoint) {</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed recreating &#39;%s&#39; subscription: The endpoint was not found\n&quot;</span>,</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;         persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;   }</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;   <span class="comment">/* Update the expiration header with the new expiration */</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;   expires_header = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_EXPIRES,</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      rdata-&gt;msg_info.msg-&gt;hdr.next);</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;   <span class="keywordflow">if</span> (!expires_header) {</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;      expires_header = pjsip_expires_hdr_create(rdata-&gt;tp_info.pool, 0);</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;      <span class="keywordflow">if</span> (!expires_header) {</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed recreating &#39;%s&#39; subscription: Could not update expires header.\n&quot;</span>,</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(endpoint, -1);</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      }</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;      pjsip_msg_add_hdr(rdata-&gt;msg_info.msg, (pjsip_hdr *) expires_header);</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;   }</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;   expires = (<a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7814e4900b15b2edc31554bbb7b61b3e">expires</a>, <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>()) / 1000);</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;   <span class="keywordflow">if</span> (expires &lt;= 0) {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      <span class="comment">/* The subscription expired since we started recreating the subscription. */</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Expired subscription retrived from persistent store &#39;%s&#39; %s\n&quot;</span>,</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;         persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>, persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>);</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(endpoint, -1);</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;   }</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;   expires_header-&gt;ivalue = expires;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;   memset(&amp;tree, 0, <span class="keyword">sizeof</span>(tree));</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;   resp = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477">build_resource_tree</a>(endpoint, handler, resource, &amp;tree,</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa94f5c5d378799e218956c0804cbfb1e">ast_sip_pubsub_has_eventlist_support</a>(rdata));</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;   <span class="keywordflow">if</span> (PJSIP_IS_STATUS_IN_CLASS(resp, 200)) {</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      pj_status_t dlg_status;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      sub_tree = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a006316bcef76ef13dc1cc99560fbaa86">create_subscription_tree</a>(handler, endpoint, rdata, resource, generator,</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;         &amp;tree, &amp;dlg_status, persistence);</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      <span class="keywordflow">if</span> (!sub_tree) {</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;         <span class="keywordflow">if</span> (dlg_status != PJ_EEXISTS) {</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed recreating &#39;%s&#39; subscription: Could not create subscription tree.\n&quot;</span>,</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;               persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;         }</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../df/dbb/structinitial__notify__data.html">initial_notify_data</a> *ind = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(<span class="keyword">sizeof</span>(*ind));</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;         <span class="keywordflow">if</span> (!ind) {</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;            pjsip_evsub_terminate(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, PJ_TRUE);</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;         }</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;         ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(sub_tree);</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;         ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a06552650d7ef9108d5744ee3f3fff264">expires</a> = expires_header-&gt;ivalue;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;         <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab37c67d3e45723f0b0aaf21dd9e2d605">subscription_persistence_update</a>(sub_tree, rdata, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400aff6b9c21e4f98d098c8bad80b822cdd2">SUBSCRIPTION_PERSISTENCE_RECREATED</a>);</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acb194881d03c561cd60d0c88f82c7478">initial_notify_task</a>, ind)) {</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            <span class="comment">/* Could not send initial subscribe NOTIFY */</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;            pjsip_evsub_terminate(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, PJ_TRUE);</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;            <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ind);</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;         }</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      }</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;   }</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>:</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aca2de2a2c7ba7a0a16d4632b56af96fa">resource_tree_destroy</a>(&amp;tree);</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(endpoint, -1);</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;}</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="comment">/*! \brief Callback function to perform the actual recreation of a subscription */</span></div><div class="line"><a name="l01684"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0e4842b1807e5e2d33bfda094c83f84d"> 1684</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0e4842b1807e5e2d33bfda094c83f84d">subscription_persistence_recreate</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;{</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = obj;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;   pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = arg;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *<a class="code" href="../../d9/d47/structserializer.html">serializer</a>;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;   pjsip_rx_data rdata;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d4c/structpersistence__recreate__data.html">persistence_recreate_data</a> recreate_data;</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;   <span class="comment">/* If this subscription used a reliable transport it can&#39;t be reestablished so remove it */</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;   <span class="keywordflow">if</span> (persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a08e0b4a94cab7d431f1717d53d619447">prune_on_boot</a>) {</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Deleting subscription marked as &#39;prune&#39; from persistent store &#39;%s&#39; %s\n&quot;</span>,</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;         persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>, persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>);</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;   }</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;   <span class="comment">/* If this subscription has already expired remove it */</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7814e4900b15b2edc31554bbb7b61b3e">expires</a>, <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>()) &lt;= 0) {</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Expired subscription retrived from persistent store &#39;%s&#39; %s\n&quot;</span>,</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;         persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>, persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>);</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;   }</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;   memset(&amp;rdata, 0, <span class="keyword">sizeof</span>(rdata));</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;   pj_pool_reset(pool);</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;   rdata.tp_info.pool = <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#af7c7bb566c8c49dc6536269d0cb736a8">ast_sip_create_rdata_with_contact</a>(&amp;rdata, persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a8d5dbabe731f82e2db15cbf4dabbca93">packet</a>, persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a22710c9f61c084ea3c72d16b9417ff6f">src_name</a>,</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a2d47efc2f2609185cf802853871de027">src_port</a>, persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a050353acc15d097365b7d63f33634d93">transport_key</a>, persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#ade656f40303348a90111082ae08708b1">local_name</a>,</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a009e2d58737d2223ce009dc0631e65dc">local_port</a>, persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a43edc8933583da8bdbbe4b62a6b0e008">contact_uri</a>)) {</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed recreating &#39;%s&#39; subscription: The message could not be parsed\n&quot;</span>,</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;         persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;   }</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;   <span class="keywordflow">if</span> (rdata.msg_info.msg-&gt;type != PJSIP_REQUEST_MSG) {</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Failed recreating &#39;%s&#39; subscription: Stored a SIP response instead of a request.\n&quot;</span>,</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;         persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;   }</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;   <span class="comment">/* Continue the remainder in the distributor serializer */</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;   serializer = <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga506c31bc071963fa7ef3ed517fa0a533">ast_sip_get_distributor_serializer</a>(&amp;rdata);</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;   <span class="keywordflow">if</span> (!serializer) {</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed recreating &#39;%s&#39; subscription: Could not get distributor serializer.\n&quot;</span>,</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;         persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;   }</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;   recreate_data.<a class="code" href="../../d4/d4c/structpersistence__recreate__data.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a> = <a class="code" href="../../d4/d4c/structpersistence__recreate__data.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;   recreate_data.<a class="code" href="../../d4/d4c/structpersistence__recreate__data.html#a41249c16bd9cc17b36f3719debaf7a67">rdata</a> = &amp;<a class="code" href="../../d4/d4c/structpersistence__recreate__data.html#a41249c16bd9cc17b36f3719debaf7a67">rdata</a>;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#gac231880459dcf8feacf1bb272b60472a">ast_sip_push_task_wait_serializer</a>(serializer, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a45ea33c1531c67d7002776939ec80b2b">sub_persistence_recreate</a>,</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      &amp;recreate_data)) {</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed recreating &#39;%s&#39; subscription: Could not continue under distributor serializer.\n&quot;</span>,</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;         persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), persistence);</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;   }</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;   <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a>(serializer);</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;}</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment">/*! \brief Function which loads and recreates persisted subscriptions upon startup when the system is fully booted */</span></div><div class="line"><a name="l01750"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0e8ac5e3b2ce24bb0441ca5c30fa783c"> 1750</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0e8ac5e3b2ce24bb0441ca5c30fa783c">subscription_persistence_load</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;{</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *persisted_subscriptions = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(),</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;      <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a> | <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;   pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;   pool = pjsip_endpt_create_pool(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), <span class="stringliteral">&quot;rtd%p&quot;</span>, PJSIP_POOL_RDATA_LEN,</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      PJSIP_POOL_RDATA_INC);</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;   <span class="keywordflow">if</span> (!pool) {</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not create a memory pool for recreating SIP subscriptions\n&quot;</span>);</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;   }</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(persisted_subscriptions, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0e4842b1807e5e2d33bfda094c83f84d">subscription_persistence_recreate</a>, pool);</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;   pjsip_endpt_release_pool(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), pool);</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(persisted_subscriptions, -1);</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;}</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment">/*! \brief Event callback which fires subscription persistence recreation when the system is fully booted */</span></div><div class="line"><a name="l01772"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac62bbbfecf4068411d7fa11225c91055"> 1772</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac62bbbfecf4068411d7fa11225c91055">subscription_persistence_event_cb</a>(<span class="keywordtype">void</span> *data, <span class="keyword">struct</span> <a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *<a class="code" href="../../d8/d9e/structmessage.html">message</a>)</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;{</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/de9/structast__json__payload.html">ast_json_payload</a> *payload;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>;</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(message) != <a class="code" href="../../db/d45/manager_8h.html#a8ae409b5ff584e42c30edcfe5837d85c">ast_manager_get_generic_type</a>()) {</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;   }</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;   payload = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(message);</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;   type = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(payload-&gt;<a class="code" href="../../d9/de9/structast__json__payload.html#a9cf488298469ae63ef947653d7ff9bab">json</a>, <span class="stringliteral">&quot;type&quot;</span>));</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;   <span class="comment">/* This subscription only responds to the FullyBooted event so that all modules have been loaded when we</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment">    * recreate SIP subscriptions.</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;   <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;FullyBooted&quot;</span>)) {</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;   }</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;   <span class="comment">/* This has to be here so the subscription is recreated when the body generator is available */</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;   <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0e8ac5e3b2ce24bb0441ca5c30fa783c">subscription_persistence_load</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;   <span class="comment">/* Once the system is fully booted we don&#39;t care anymore */</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a>(sub);</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;}</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div><div class="line"><a name="l01798"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0b174b002a4e991ef8c08f17118f8cd5"> 1798</a></span>&#160;<span class="keyword">typedef</span> int (*<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0b174b002a4e991ef8c08f17118f8cd5">on_subscription_t</a>)(<span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, <span class="keywordtype">void</span> *arg);</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div><div class="line"><a name="l01800"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac952acea83472c9c285fe203a5b62ce3"> 1800</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac952acea83472c9c285fe203a5b62ce3">for_each_subscription</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0b174b002a4e991ef8c08f17118f8cd5">on_subscription_t</a> on_subscription, <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;{</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;   <span class="keywordtype">int</span> num = 0;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *i;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;   <span class="keywordflow">if</span> (!on_subscription) {</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      <span class="keywordflow">return</span> num;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;   }</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../df/dab/structsubscriptions.html">subscriptions</a>);</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="../../df/dab/structsubscriptions.html">subscriptions</a>, i, <a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a8f1e0d0bf78f07ba5cd5825726b20eb8">next</a>) {</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;      <span class="keywordflow">if</span> (on_subscription(i, arg)) {</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;      }</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;      ++num;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;   }</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/dab/structsubscriptions.html">subscriptions</a>);</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;   <span class="keywordflow">return</span> num;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;}</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;</div><div class="line"><a name="l01820"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae0461ac441d662c000ef9408ab9dd01c"> 1820</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae0461ac441d662c000ef9408ab9dd01c">sip_subscription_to_ami</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree,</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                <span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>)</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;{</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>[256];</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html">ast_sip_endpoint_id_configuration</a> *<span class="keywordtype">id</span> = &amp;sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50783ac9bc6f4943369ed254972049ac">id</a>;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;Role: %s\r\n&quot;</span>,</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;             <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#af59dad57f47cf8401042d4ecd0b861e5">sip_subscription_roles_map</a>[sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a>]);</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;Endpoint: %s\r\n&quot;</span>,</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;             <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>) {</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(str, &amp;sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;call_id-&gt;id, <span class="keyword">sizeof</span>(str));</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(str, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>, <span class="keyword">sizeof</span>(str));</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;   }</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;Callid: %s\r\n&quot;</span>, str);</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;State: %s\r\n&quot;</span>, pjsip_evsub_get_state_name(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>));</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;   <a class="code" href="../../de/d47/callerid_8h.html#a1c25633b1ed63682c95ec613d7cbe559">ast_callerid_merge</a>(str, <span class="keyword">sizeof</span>(str),</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(id-&gt;<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>, id-&gt;<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(id-&gt;<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>, id-&gt;<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;            <span class="stringliteral">&quot;Unknown&quot;</span>);</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;Callerid: %s\r\n&quot;</span>, str);</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;   <span class="comment">/* XXX This needs to be done recursively for lists */</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a2cdc6ead7e87bb0cd7c01b2445b0f60d">to_ami</a>) {</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a2cdc6ead7e87bb0cd7c01b2445b0f60d">to_ami</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>, buf);</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;   }</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;}</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div><div class="line"><a name="l01854"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4034b13c08bafa4bff82854bcc0ce135"> 1854</a></span>&#160;<span class="keywordtype">void</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4034b13c08bafa4bff82854bcc0ce135">ast_sip_subscription_get_header</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d65/structheader.html">header</a>)</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;{</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;   pjsip_dialog *dlg;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;   pjsip_msg *msg;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;   pj_str_t <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;   dlg = sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;   msg = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#aad194ead974937834375b0ac8d37a7c2">ast_sip_mod_data_get</a>(dlg-&gt;mod_data, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab95c1bf11412f8e2a82ddd0eb69ad4a4">MOD_DATA_MSG</a>);</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;   pj_cstr(&amp;name, header);</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;   <span class="keywordflow">return</span> pjsip_msg_find_hdr_by_name(msg, &amp;name, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;}</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment">/* XXX This function is not used. */</span></div><div class="line"><a name="l01868"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#adcc803ec5ffc0029b9be176cc090f135"> 1868</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#adcc803ec5ffc0029b9be176cc090f135">ast_sip_create_subscription</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>,</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint, <span class="keyword">const</span> <span class="keywordtype">char</span> *resource)</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;{</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;   pjsip_dialog *dlg;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a>;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;   pj_str_t <a class="code" href="../../df/dd0/structresource__list.html#a5053da7047dfe40d67229c5dbc361f8b">event</a>;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;   pjsip_tx_data *tdata;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;   pjsip_evsub *evsub;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;   sub_tree = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae855491c1f2f6714df5daa3fd69a10df">allocate_subscription_tree</a>(endpoint, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;   <span class="keywordflow">if</span> (!sub_tree) {</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;   }</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;   sub = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa70a279b186df17b611eabf8164c396c">allocate_subscription</a>(handler, resource, sub_tree);</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;   <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree);</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;   }</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;   contact = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a00fd98f03df089bd6aa358f941ae0dcd">ast_sip_location_retrieve_contact_from_aor_list</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">aors</a>);</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;   <span class="keywordflow">if</span> (!contact || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">uri</a>)) {</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No contacts configured for endpoint %s. Unable to create SIP subsription\n&quot;</span>,</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint));</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(contact);</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;   }</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;   dlg = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a681ca1bf74a943a8009a5c2ad6894831">ast_sip_create_dialog_uac</a>(endpoint, contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">uri</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(contact);</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;   <span class="keywordflow">if</span> (!dlg) {</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create dialog for SIP subscription\n&quot;</span>);</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;   }</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;   pj_cstr(&amp;event, handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>);</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;   pjsip_evsub_create_uac(dlg, &amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7d62301cf52b6bc6d7b66cea60bee8cc">pubsub_cb</a>, &amp;event, 0, &amp;sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>);</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acc8db1e0ce416bc7a5a05275db0cb8a7">subscription_setup_dialog</a>(sub_tree, dlg);</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;   evsub = sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;   <span class="keywordflow">if</span> (pjsip_evsub_initiate(evsub, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -1, &amp;tdata) == PJ_SUCCESS) {</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;      pjsip_evsub_send_request(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, tdata);</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      <span class="comment">/* pjsip_evsub_terminate will result in pubsub_on_evsub_state,</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="comment">       * being called and terminating the subscription. Therefore, we don&#39;t</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="comment">       * need to decrease the reference count of sub here.</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;      pjsip_evsub_terminate(evsub, PJ_TRUE);</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;   }</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8ebc5adf3564428c0201cff2376dd187">add_subscription</a>(sub_tree);</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;}</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;</div><div class="line"><a name="l01930"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa6471e6d6f4563ef5fb93343180fea40"> 1930</a></span>&#160;pjsip_dialog *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa6471e6d6f4563ef5fb93343180fea40">ast_sip_subscription_get_dialog</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;{</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a> != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;   <span class="keywordflow">return</span> sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;}</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;</div><div class="line"><a name="l01936"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#abce1c0cc1320bb801480d0929266d08f"> 1936</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abce1c0cc1320bb801480d0929266d08f">ast_sip_subscription_get_endpoint</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;{</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a> != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>);</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;}</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;</div><div class="line"><a name="l01942"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a81489602b194ea87cae6470409bee3b5"> 1942</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a81489602b194ea87cae6470409bee3b5">ast_sip_subscription_get_serializer</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;{</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a> != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;   <span class="keywordflow">return</span> sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;}</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="comment"> * \brief Pre-allocate a buffer for the transmission</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment"> * Typically, we let PJSIP do this step for us when we send a request. PJSIP&#39;s buffer</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="comment"> * allocation algorithm is to allocate a buffer of PJSIP_MAX_PKT_LEN bytes and attempt</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="comment"> * to write the packet to the allocated buffer. If the buffer is too small to hold the</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="comment"> * packet, then we get told the message is too long to be sent.</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment"> * When dealing with SIP NOTIFY, especially with RLS, it is possible to exceed</span></div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;<span class="comment"> * PJSIP_MAX_PKT_LEN. Rather than accepting the limitation imposed on us by default,</span></div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;<span class="comment"> * we instead take the strategy of pre-allocating the buffer, testing for ourselves</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment"> * if the message will fit, and resizing the buffer as required.</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="comment"> * The limit we impose is double that of the maximum packet length.</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;<span class="comment"> * \param tdata The tdata onto which to allocate a buffer</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="comment"> * \retval 0 Success</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment"> * \retval -1 The message is too large</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01967"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a204519f08566a8c5fb4711168cad11e3"> 1967</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a204519f08566a8c5fb4711168cad11e3">allocate_tdata_buffer</a>(pjsip_tx_data *tdata)</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;{</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;   <span class="keywordtype">int</span> buf_size;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;   <span class="keywordtype">int</span> size = -1;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;   <span class="keywordflow">for</span> (buf_size = PJSIP_MAX_PKT_LEN; size == -1 &amp;&amp; buf_size &lt; (PJSIP_MAX_PKT_LEN * 2); buf_size *= 2) {</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      buf = pj_pool_alloc(tdata-&gt;pool, buf_size);</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;      size = pjsip_msg_print(tdata-&gt;msg, buf, buf_size);</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;   }</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;   <span class="keywordflow">if</span> (size == -1) {</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;   }</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;   tdata-&gt;buf.start = <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;   tdata-&gt;buf.cur = tdata-&gt;buf.start;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;   tdata-&gt;buf.end = tdata-&gt;buf.start + buf_size;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;}</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;</div><div class="line"><a name="l01989"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae4bf9f7f4557d02712ea86b10e5d6891"> 1989</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae4bf9f7f4557d02712ea86b10e5d6891">sip_subscription_send_request</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, pjsip_tx_data *tdata)</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;{</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="preprocessor">#ifdef TEST_FRAMEWORK</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint = sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;   pjsip_evsub *evsub = sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a204519f08566a8c5fb4711168cad11e3">allocate_tdata_buffer</a>(tdata)) {</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;SIP request %s is too large to send.\n&quot;</span>, tdata-&gt;info);</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;      pjsip_tx_data_dec_ref(tdata);</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;   }</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;   res = pjsip_evsub_send_request(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, tdata);</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab37c67d3e45723f0b0aaf21dd9e2d605">subscription_persistence_update</a>(sub_tree, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400a56de5c438e2a53b13eb3ba4310d58ae2">SUBSCRIPTION_PERSISTENCE_SEND_REQUEST</a>);</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a>(<span class="stringliteral">&quot;SUBSCRIPTION_STATE_SET&quot;</span>,</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;      <span class="stringliteral">&quot;StateText: %s\r\n&quot;</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;      <span class="stringliteral">&quot;Endpoint: %s\r\n&quot;</span>,</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      pjsip_evsub_get_state_name(evsub),</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint));</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;   <span class="keywordflow">return</span> (res == PJ_SUCCESS ? 0 : -1);</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;}</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment"> * \brief Add a resource XML element to an RLMI body</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="comment"> * Each resource element represents a subscribed resource in the list. This function currently</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="comment"> * will unconditionally add an instance element to each created resource element. Instance</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;<span class="comment"> * elements refer to later parts in the multipart body.</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment"> * \param pool PJLIB allocation pool</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment"> * \param cid Content-ID header of the resource</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;<span class="comment"> * \param resource_name Name of the resource</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment"> * \param resource_uri URI of the resource</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment"> * \param state State of the subscribed resource</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02029"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac9ccf20fa81744533ad45801f7f1a3b6"> 2029</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac9ccf20fa81744533ad45801f7f1a3b6">add_rlmi_resource</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, pj_xml_node *rlmi, <span class="keyword">const</span> pjsip_generic_string_hdr *cid,</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *resource_name, <span class="keyword">const</span> pjsip_sip_uri *resource_uri, pjsip_evsub_state <a class="code" href="../../d4/d88/structstate.html">state</a>)</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;{</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;   <span class="keyword">static</span> pj_str_t <a class="code" href="../../d0/dd6/chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a> = { <span class="stringliteral">&quot;cid&quot;</span>, 3 };</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;   pj_xml_node *resource;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;   pj_xml_node *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;   pj_xml_node *instance;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;   pj_xml_attr *cid_attr;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;   <span class="keywordtype">char</span> <span class="keywordtype">id</span>[6];</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;   <span class="keywordtype">char</span> uri[PJSIP_MAX_URL_SIZE];</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;   <span class="comment">/* This creates a string representing the Content-ID without the enclosing &lt; &gt; */</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;   <span class="keyword">const</span> pj_str_t cid_stripped = {</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      .ptr = cid-&gt;hvalue.ptr + 1,</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      .slen = cid-&gt;hvalue.slen - 2,</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;   };</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;   resource = <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#ae8b2b2ccfe3099ff401bad55c2820f98">ast_sip_presence_xml_create_node</a>(pool, rlmi, <span class="stringliteral">&quot;resource&quot;</span>);</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;   name = <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#ae8b2b2ccfe3099ff401bad55c2820f98">ast_sip_presence_xml_create_node</a>(pool, resource, <span class="stringliteral">&quot;name&quot;</span>);</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;   instance = <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#ae8b2b2ccfe3099ff401bad55c2820f98">ast_sip_presence_xml_create_node</a>(pool, resource, <span class="stringliteral">&quot;instance&quot;</span>);</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;   pjsip_uri_print(PJSIP_URI_IN_CONTACT_HDR, resource_uri, uri, <span class="keyword">sizeof</span>(uri));</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;   <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#af60a5851382ce5f434b07fdefc194cbe">ast_sip_presence_xml_create_attr</a>(pool, resource, <span class="stringliteral">&quot;uri&quot;</span>, uri);</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;   pj_strdup2(pool, &amp;name-&gt;content, resource_name);</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ab2c8e1bf4b2b01a1ffabf882774907bb">ast_generate_random_string</a>(<span class="keywordtype">id</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">id</span>));</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;   <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#af60a5851382ce5f434b07fdefc194cbe">ast_sip_presence_xml_create_attr</a>(pool, instance, <span class="stringliteral">&quot;id&quot;</span>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;   <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#af60a5851382ce5f434b07fdefc194cbe">ast_sip_presence_xml_create_attr</a>(pool, instance, <span class="stringliteral">&quot;state&quot;</span>,</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;         state == PJSIP_EVSUB_STATE_TERMINATED ? <span class="stringliteral">&quot;terminated&quot;</span> : <span class="stringliteral">&quot;active&quot;</span>);</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;   <span class="comment">/* Use the PJLIB-util XML library directly here since we are using a</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="comment">    * pj_str_t</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;   cid_attr = pj_xml_attr_new(pool, &amp;cid_name, &amp;cid_stripped);</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;   pj_xml_add_attr(instance, cid_attr);</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;}</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="comment"> * \brief A multipart body part and meta-information</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="comment"> * When creating a multipart body part, the end result (the</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="comment"> * pjsip_multipart_part) is hard to inspect without undoing</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="comment"> * a lot of what was done to create it. Therefore, we use this</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="comment"> * structure to store meta-information about the body part.</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="comment"> * The main consumer of this is the creator of the RLMI body</span></div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="comment"> * part of a multipart resource list body.</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02080"></a><span class="lineno"><a class="line" href="../../d2/de8/structbody__part.html"> 2080</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d2/de8/structbody__part.html">body_part</a> {<span class="comment"></span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment">   /*! Content-ID header for the body part */</span></div><div class="line"><a name="l02082"></a><span class="lineno"><a class="line" href="../../d2/de8/structbody__part.html#a97f61ce218f9876fc092948fe744b2bc"> 2082</a></span>&#160;   pjsip_generic_string_hdr *<a class="code" href="../../d2/de8/structbody__part.html#a97f61ce218f9876fc092948fe744b2bc">cid</a>;<span class="comment"></span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="comment">   /*! Subscribed resource represented in the body part */</span></div><div class="line"><a name="l02084"></a><span class="lineno"><a class="line" href="../../d2/de8/structbody__part.html#a97b7ef5a69a288651ec0d5acbe75d36d"> 2084</a></span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/de8/structbody__part.html#a97b7ef5a69a288651ec0d5acbe75d36d">resource</a>;<span class="comment"></span></div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;<span class="comment">   /*! URI for the subscribed body part */</span></div><div class="line"><a name="l02086"></a><span class="lineno"><a class="line" href="../../d2/de8/structbody__part.html#ac43e5728c2093e52e8a06774ab68afe2"> 2086</a></span>&#160;   pjsip_sip_uri *<a class="code" href="../../d2/de8/structbody__part.html#ac43e5728c2093e52e8a06774ab68afe2">uri</a>;<span class="comment"></span></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;<span class="comment">   /*! Subscription state of the resource represented in the body part */</span></div><div class="line"><a name="l02088"></a><span class="lineno"><a class="line" href="../../d2/de8/structbody__part.html#a06eab984618d6a85fadc73dfb41f5c69"> 2088</a></span>&#160;   pjsip_evsub_state <a class="code" href="../../d2/de8/structbody__part.html#a06eab984618d6a85fadc73dfb41f5c69">state</a>;<span class="comment"></span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="comment">   /*! The actual body part that will be present in the multipart body */</span></div><div class="line"><a name="l02090"></a><span class="lineno"><a class="line" href="../../d2/de8/structbody__part.html#ac56343f0ae7d83d16f23924f1f828149"> 2090</a></span>&#160;   pjsip_multipart_part *<a class="code" href="../../d2/de8/structbody__part.html#ac56343f0ae7d83d16f23924f1f828149">part</a>;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;};</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="comment"> * \brief Type declaration for container of body part structures</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa7db5b123e82a8da6f1ae6fc15aaace5">AST_VECTOR</a>(body_part_list, <span class="keyword">struct</span> <a class="code" href="../../d2/de8/structbody__part.html">body_part</a> *);</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="comment"> * \brief Create a Content-ID header</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;<span class="comment"> * Content-ID headers are required by RFC2387 for multipart/related</span></div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;<span class="comment"> * bodies. They serve as identifiers for each part of the multipart body.</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="comment"> * \param pool PJLIB allocation pool</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="comment"> * \param sub Subscription to a resource</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02107"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7b691f0bc6a8c56d55095fa30cef4e47"> 2107</a></span>&#160;<span class="keyword">static</span> pjsip_generic_string_hdr *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7b691f0bc6a8c56d55095fa30cef4e47">generate_content_id_hdr</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>,</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;{</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t <a class="code" href="../../d0/dd6/chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a> = { <span class="stringliteral">&quot;Content-ID&quot;</span>, 10 };</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;   pjsip_generic_string_hdr *cid;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;   <span class="keywordtype">char</span> <span class="keywordtype">id</span>[6];</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;   <span class="keywordtype">size_t</span> alloc_size;</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;   pj_str_t cid_value;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;   <span class="comment">/* &#39;&lt;&#39; + &#39;@&#39; + &#39;&gt;&#39; = 3. pj_str_t does not require a null-terminator */</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;   alloc_size = <span class="keyword">sizeof</span>(<a class="code" href="../../da/dfb/app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a>) + pj_strlen(&amp;sub-&gt;uri-&gt;host) + 3;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;   cid_value.ptr = pj_pool_alloc(pool, alloc_size);</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;   cid_value.slen = sprintf(cid_value.ptr, <span class="stringliteral">&quot;&lt;%s@%.*s&gt;&quot;</span>,</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ab2c8e1bf4b2b01a1ffabf882774907bb">ast_generate_random_string</a>(<span class="keywordtype">id</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">id</span>)),</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;         (<span class="keywordtype">int</span>) pj_strlen(&amp;sub-&gt;uri-&gt;host), pj_strbuf(&amp;sub-&gt;uri-&gt;host));</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;   cid = pjsip_generic_string_hdr_create(pool, &amp;cid_name, &amp;cid_value);</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;   <span class="keywordflow">return</span> cid;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;}</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;</div><div class="line"><a name="l02127"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a786140dcdee30f86fc9a661c515982bb"> 2127</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a786140dcdee30f86fc9a661c515982bb">rlmi_print_body</a>(<span class="keyword">struct</span> pjsip_msg_body *msg_body, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, pj_size_t size)</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;{</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;   <span class="keywordtype">int</span> num_printed;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;   pj_xml_node *rlmi = msg_body-&gt;data;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;   num_printed = pj_xml_print(rlmi, buf, size, PJ_TRUE);</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;   <span class="keywordflow">if</span> (num_printed &lt;= <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#a2249425f7ecf2dce721526ea4760a41c">AST_PJSIP_XML_PROLOG_LEN</a>) {</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;   }</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;   <span class="keywordflow">return</span> num_printed;</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;}</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div><div class="line"><a name="l02140"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a474bbe394cad0178cf128a36a312ca62"> 2140</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a474bbe394cad0178cf128a36a312ca62">rlmi_clone_data</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *data, <span class="keywordtype">unsigned</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;{</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;   <span class="keyword">const</span> pj_xml_node *rlmi = data;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;   <span class="keywordflow">return</span> pj_xml_clone(pool, rlmi);</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;}</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="comment"> * \brief Create an RLMI body part for a multipart resource list body</span></div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;<span class="comment"> * RLMI (Resource list meta information) is a special body type that lists</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;<span class="comment"> * the subscribed resources and tells subscribers the number of subscribed</span></div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="comment"> * resources and what other body parts are in the multipart body. The</span></div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;<span class="comment"> * RLMI body also has a version number that a subscriber can use to ensure</span></div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="comment"> * that the locally-stored state corresponds to server state.</span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;<span class="comment"> * \param pool The allocation pool</span></div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;<span class="comment"> * \param sub The subscription representing the subscribed resource list</span></div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="comment"> * \param body_parts A container of body parts that RLMI will refer to</span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;<span class="comment"> * \param full_state Indicates whether this is a full or partial state notification</span></div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="comment"> * \return The multipart part representing the RLMI body</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02162"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0aa1afb0a81eaeebda85dbb188f82df7"> 2162</a></span>&#160;<span class="keyword">static</span> pjsip_multipart_part *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0aa1afb0a81eaeebda85dbb188f82df7">build_rlmi_body</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub,</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      <span class="keyword">struct</span> body_part_list *body_parts, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/dd0/structresource__list.html#a4ec2ed8bfc8538671089fc04bb4710bb">full_state</a>)</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;{</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;   pj_xml_node *rlmi;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;   pj_xml_node *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;   pjsip_multipart_part *rlmi_part;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;   <span class="keywordtype">char</span> version_str[32];</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;   <span class="keywordtype">char</span> uri[PJSIP_MAX_URL_SIZE];</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;   pjsip_generic_string_hdr *cid;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;   rlmi = <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#ae8b2b2ccfe3099ff401bad55c2820f98">ast_sip_presence_xml_create_node</a>(pool, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;list&quot;</span>);</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;   <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#af60a5851382ce5f434b07fdefc194cbe">ast_sip_presence_xml_create_attr</a>(pool, rlmi, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;urn:ietf:params:xml:ns:rlmi&quot;</span>);</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aeb411f16e0fee4036a22b354164b43a6">ast_sip_subscription_get_local_uri</a>(sub, uri, <span class="keyword">sizeof</span>(uri));</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;   <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#af60a5851382ce5f434b07fdefc194cbe">ast_sip_presence_xml_create_attr</a>(pool, rlmi, <span class="stringliteral">&quot;uri&quot;</span>, uri);</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;   snprintf(version_str, <span class="keyword">sizeof</span>(version_str), <span class="stringliteral">&quot;%u&quot;</span>, sub-&gt;version++);</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;   <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#af60a5851382ce5f434b07fdefc194cbe">ast_sip_presence_xml_create_attr</a>(pool, rlmi, <span class="stringliteral">&quot;version&quot;</span>, version_str);</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;   <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#af60a5851382ce5f434b07fdefc194cbe">ast_sip_presence_xml_create_attr</a>(pool, rlmi, <span class="stringliteral">&quot;fullState&quot;</span>, full_state ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>);</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;   name = <a class="code" href="../../d5/dc3/res__pjsip__presence__xml_8h.html#ae8b2b2ccfe3099ff401bad55c2820f98">ast_sip_presence_xml_create_node</a>(pool, rlmi, <span class="stringliteral">&quot;name&quot;</span>);</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;   pj_strdup2(pool, &amp;name-&gt;content, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2d7ed3f8785ad9d9aa3fc090d983c45d">ast_sip_subscription_get_resource_name</a>(sub));</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(body_parts); ++i) {</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d2/de8/structbody__part.html">body_part</a> *<a class="code" href="../../d2/de8/structbody__part.html#ac56343f0ae7d83d16f23924f1f828149">part</a> = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(body_parts, i);</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac9ccf20fa81744533ad45801f7f1a3b6">add_rlmi_resource</a>(pool, rlmi, part-&gt;<a class="code" href="../../d2/de8/structbody__part.html#a97f61ce218f9876fc092948fe744b2bc">cid</a>, part-&gt;<a class="code" href="../../d2/de8/structbody__part.html#a97b7ef5a69a288651ec0d5acbe75d36d">resource</a>, part-&gt;<a class="code" href="../../d2/de8/structbody__part.html#ac43e5728c2093e52e8a06774ab68afe2">uri</a>, part-&gt;<a class="code" href="../../d2/de8/structbody__part.html#a06eab984618d6a85fadc73dfb41f5c69">state</a>);</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;   }</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;   rlmi_part = pjsip_multipart_create_part(pool);</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;   rlmi_part-&gt;body = PJ_POOL_ZALLOC_T(pool, pjsip_msg_body);</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;   pjsip_media_type_cp(pool, &amp;rlmi_part-&gt;body-&gt;content_type, &amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae55303c463ee7d4709335ae3311c3826">rlmi_media_type</a>);</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;   rlmi_part-&gt;body-&gt;data = pj_xml_clone(pool, rlmi);</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;   rlmi_part-&gt;body-&gt;clone_data = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a474bbe394cad0178cf128a36a312ca62">rlmi_clone_data</a>;</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;   rlmi_part-&gt;body-&gt;print_body = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a786140dcdee30f86fc9a661c515982bb">rlmi_print_body</a>;</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;   cid = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7b691f0bc6a8c56d55095fa30cef4e47">generate_content_id_hdr</a>(pool, sub);</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;   pj_list_insert_before(&amp;rlmi_part-&gt;hdr, cid);</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;   <span class="keywordflow">return</span> rlmi_part;</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;}</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;<span class="keyword">static</span> pjsip_msg_body *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abe6f294a1dd6e02f90699c6862c8ff37">generate_notify_body</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *root,</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> force_full_state);</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;<span class="comment"> * \brief Destroy a list of body parts</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;<span class="comment"> * \param parts The container of parts to destroy</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02215"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a90eeb90b815577ed6bee36f8278a6e73"> 2215</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a90eeb90b815577ed6bee36f8278a6e73">free_body_parts</a>(<span class="keyword">struct</span> body_part_list *parts)</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;{</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(parts); ++i) {</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d2/de8/structbody__part.html">body_part</a> *<a class="code" href="../../d2/de8/structbody__part.html#ac56343f0ae7d83d16f23924f1f828149">part</a> = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(parts, i);</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(part);</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;   }</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(parts);</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;}</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;<span class="comment"> * \brief Allocate and initialize a body part structure</span></div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;<span class="comment"> * \param pool PJLIB allocation pool</span></div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;<span class="comment"> * \param sub Subscription representing a subscribed resource</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02233"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5314d6fbf19f6f10073f1d4e0787e957"> 2233</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/de8/structbody__part.html">body_part</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5314d6fbf19f6f10073f1d4e0787e957">allocate_body_part</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;{</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/de8/structbody__part.html">body_part</a> *bp;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;   bp = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*bp));</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;   <span class="keywordflow">if</span> (!bp) {</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;   }</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;   bp-&gt;<a class="code" href="../../d2/de8/structbody__part.html#a97f61ce218f9876fc092948fe744b2bc">cid</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7b691f0bc6a8c56d55095fa30cef4e47">generate_content_id_hdr</a>(pool, sub);</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;   bp-&gt;<a class="code" href="../../d2/de8/structbody__part.html#a97b7ef5a69a288651ec0d5acbe75d36d">resource</a> = sub-&gt;resource;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;   bp-&gt;<a class="code" href="../../d2/de8/structbody__part.html#a06eab984618d6a85fadc73dfb41f5c69">state</a> = sub-&gt;subscription_state;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;   bp-&gt;<a class="code" href="../../d2/de8/structbody__part.html#ac43e5728c2093e52e8a06774ab68afe2">uri</a> = sub-&gt;uri;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;   <span class="keywordflow">return</span> bp;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;}</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;<span class="comment"> * \brief Create a multipart body part for a subscribed resource</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;<span class="comment"> * \param pool PJLIB allocation pool</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;<span class="comment"> * \param sub The subscription representing a subscribed resource</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="comment"> * \param parts A vector of parts to append the created part to.</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;<span class="comment"> * \param use_full_state Unused locally, but may be passed to other functions</span></div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02258"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2dba366491005a78cb1b67070de74a6e"> 2258</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2dba366491005a78cb1b67070de74a6e">build_body_part</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub,</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;      <span class="keyword">struct</span> body_part_list *parts, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> use_full_state)</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;{</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/de8/structbody__part.html">body_part</a> *bp;</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;   pjsip_msg_body *body;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;   bp = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5314d6fbf19f6f10073f1d4e0787e957">allocate_body_part</a>(pool, sub);</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;   <span class="keywordflow">if</span> (!bp) {</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;   }</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;   body = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abe6f294a1dd6e02f90699c6862c8ff37">generate_notify_body</a>(pool, sub, use_full_state);</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;   <span class="keywordflow">if</span> (!body) {</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;      <span class="comment">/* Partial state was requested and the resource has not changed state */</span></div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(bp);</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;   }</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;   bp-&gt;<a class="code" href="../../d2/de8/structbody__part.html#ac56343f0ae7d83d16f23924f1f828149">part</a> = pjsip_multipart_create_part(pool);</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;   bp-&gt;<a class="code" href="../../d2/de8/structbody__part.html#ac56343f0ae7d83d16f23924f1f828149">part</a>-&gt;body = body;</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;   pj_list_insert_before(&amp;bp-&gt;<a class="code" href="../../d2/de8/structbody__part.html#ac56343f0ae7d83d16f23924f1f828149">part</a>-&gt;hdr, bp-&gt;<a class="code" href="../../d2/de8/structbody__part.html#a97f61ce218f9876fc092948fe744b2bc">cid</a>);</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(parts, bp)) {</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(bp);</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;   }</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;}</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;<span class="comment"> * \brief Create and initialize the PJSIP multipart body structure for a resource list subscription</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<span class="comment"> * \param pool</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="comment"> * \return The multipart message body</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02291"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac79436df96e320a3107e5e8dfb3e9720"> 2291</a></span>&#160;<span class="keyword">static</span> pjsip_msg_body *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac79436df96e320a3107e5e8dfb3e9720">create_multipart_body</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;{</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;   pjsip_media_type <a class="code" href="../../d1/d94/sip_8h.html#a99c5ff7e5199a13ca4884062b413d68f">media_type</a>;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;   pjsip_param *media_type_param;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;   <span class="keywordtype">char</span> boundary[6];</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;   pj_str_t pj_boundary;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;   pjsip_media_type_init2(&amp;media_type, <span class="stringliteral">&quot;multipart&quot;</span>, <span class="stringliteral">&quot;related&quot;</span>);</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;   media_type_param = pj_pool_alloc(pool, <span class="keyword">sizeof</span>(*media_type_param));</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;   pj_list_init(media_type_param);</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;   pj_strdup2(pool, &amp;media_type_param-&gt;name, <span class="stringliteral">&quot;type&quot;</span>);</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;   pj_strdup2(pool, &amp;media_type_param-&gt;value, <span class="stringliteral">&quot;\&quot;application/rlmi+xml\&quot;&quot;</span>);</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;   pj_list_insert_before(&amp;media_type.param, media_type_param);</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;   pj_cstr(&amp;pj_boundary, <a class="code" href="../../d6/d90/strings_8h.html#ab2c8e1bf4b2b01a1ffabf882774907bb">ast_generate_random_string</a>(boundary, <span class="keyword">sizeof</span>(boundary)));</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;   <span class="keywordflow">return</span> pjsip_multipart_create(pool, &amp;media_type, &amp;pj_boundary);</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;}</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="comment"> * \brief Create a resource list body for NOTIFY requests</span></div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;<span class="comment"> * Resource list bodies are multipart/related bodies. The first part of the multipart body</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;<span class="comment"> * is an RLMI body that describes the rest of the parts to come. The other parts of the body</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;<span class="comment"> * convey state of individual subscribed resources.</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="comment"> * \param pool PJLIB allocation pool</span></div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="comment"> * \param sub Subscription details from which to generate body</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="comment"> * \param force_full_state If true, ignore resource list settings and send a full state notification</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;<span class="comment"> * \return The generated multipart/related body</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02324"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa801068c5728800b602dc19ecbe1b3cf"> 2324</a></span>&#160;<span class="keyword">static</span> pjsip_msg_body *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa801068c5728800b602dc19ecbe1b3cf">generate_list_body</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub,</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> force_full_state)</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;{</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;   pjsip_multipart_part *rlmi_part;</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;   pjsip_msg_body *multipart;</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;   <span class="keyword">struct </span>body_part_list body_parts;</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> use_full_state = force_full_state ? 1 : sub-&gt;full_state;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;body_parts, <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;sub-&gt;children))) {</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;   }</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;sub-&gt;children); ++i) {</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2dba366491005a78cb1b67070de74a6e">build_body_part</a>(pool, <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;sub-&gt;children, i), &amp;body_parts, use_full_state);</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;   }</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;   <span class="comment">/* This can happen if issuing partial state and no children of the list have changed state */</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;body_parts) == 0) {</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a90eeb90b815577ed6bee36f8278a6e73">free_body_parts</a>(&amp;body_parts);</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;   }</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;   multipart = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac79436df96e320a3107e5e8dfb3e9720">create_multipart_body</a>(pool);</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;   rlmi_part = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0aa1afb0a81eaeebda85dbb188f82df7">build_rlmi_body</a>(pool, sub, &amp;body_parts, use_full_state);</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;   <span class="keywordflow">if</span> (!rlmi_part) {</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a90eeb90b815577ed6bee36f8278a6e73">free_body_parts</a>(&amp;body_parts);</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;   }</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;   pjsip_multipart_add_part(pool, multipart, rlmi_part);</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;body_parts); ++i) {</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;      pjsip_multipart_add_part(pool, multipart, <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;body_parts, i)-&gt;part);</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;   }</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a90eeb90b815577ed6bee36f8278a6e73">free_body_parts</a>(&amp;body_parts);</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;   <span class="keywordflow">return</span> multipart;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;}</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="comment"> * \brief Create the body for a NOTIFY request.</span></div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="comment"> * \param pool The pool used for allocations</span></div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;<span class="comment"> * \param root The root of the subscription tree</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;<span class="comment"> * \param force_full_state If true, ignore resource list settings and send a full state notification</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02371"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#abe6f294a1dd6e02f90699c6862c8ff37"> 2371</a></span>&#160;<span class="keyword">static</span> pjsip_msg_body *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abe6f294a1dd6e02f90699c6862c8ff37">generate_notify_body</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *root,</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> force_full_state)</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;{</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;   pjsip_msg_body *body;</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;root-&gt;children) == 0) {</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      <span class="keywordflow">if</span> (force_full_state || root-&gt;body_changed) {</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;         <span class="comment">/* Not a list. We&#39;ve already generated the body and saved it on the subscription.</span></div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment">          * Use that directly.</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;         pj_str_t <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;         pj_str_t subtype;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;         pj_str_t <a class="code" href="../../da/dfb/app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>;</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;         pj_cstr(&amp;type, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2294ee18e05ee676e083133058243909">ast_sip_subscription_get_body_type</a>(root));</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;         pj_cstr(&amp;subtype, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5c54dc5f481da88392b1ec7149385613">ast_sip_subscription_get_body_subtype</a>(root));</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;         pj_cstr(&amp;text, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(root-&gt;body_text));</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;         body = pjsip_msg_body_create(pool, &amp;type, &amp;subtype, &amp;text);</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;         root-&gt;body_changed = 0;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;         body = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;      }</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      body = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa801068c5728800b602dc19ecbe1b3cf">generate_list_body</a>(pool, root, force_full_state);</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;   }</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;   <span class="keywordflow">return</span> body;</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;}</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;<span class="comment"> * \brief Shortcut method to create a Require: eventlist header</span></div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02404"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad353ed8aab9f1e54ccf8d2e89a96bcac"> 2404</a></span>&#160;<span class="keyword">static</span> pjsip_require_hdr *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad353ed8aab9f1e54ccf8d2e89a96bcac">create_require_eventlist</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;{</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;   pjsip_require_hdr *require;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;   require = pjsip_require_hdr_create(pool);</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;   pj_strdup2(pool, &amp;require-&gt;values[0], <span class="stringliteral">&quot;eventlist&quot;</span>);</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;   require-&gt;count = 1;</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;   <span class="keywordflow">return</span> require;</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;}</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="comment"> * \brief Send a NOTIFY request to a subscriber</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="comment"> * \pre sub_tree-&gt;dlg is locked</span></div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="comment"> * \param sub_tree The subscription tree representing the subscription</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="comment"> * \param force_full_state If true, ignore resource list settings and send full resource list state.</span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;<span class="comment"> * \retval 0 Success</span></div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;<span class="comment"> * \retval non-zero Failure</span></div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02425"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8b3391cb48972f432118c4ca2eeb3063"> 2425</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8b3391cb48972f432118c4ca2eeb3063">send_notify</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> force_full_state)</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;{</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;   pjsip_evsub *evsub = sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;   pjsip_tx_data *tdata;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/db2/asterisk_8h.html#a0eb0441c04955094ce5845fb0258645a">ast_shutdown_final</a>()</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;      &amp;&amp; sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;subscription_state == PJSIP_EVSUB_STATE_TERMINATED</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;      &amp;&amp; sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>) {</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;   }</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;   <span class="keywordflow">if</span> (pjsip_evsub_notify(evsub, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;subscription_state,</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;            <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;tdata) != PJ_SUCCESS) {</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;   }</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;   tdata-&gt;msg-&gt;body = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abe6f294a1dd6e02f90699c6862c8ff37">generate_notify_body</a>(tdata-&gt;pool, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>, force_full_state);</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;   <span class="keywordflow">if</span> (!tdata-&gt;msg-&gt;body) {</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;      pjsip_tx_data_dec_ref(tdata);</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;   }</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9e1f9ef9caffc6fcf306dbf678ecc747">is_list</a>) {</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;      pjsip_require_hdr *require = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad353ed8aab9f1e54ccf8d2e89a96bcac">create_require_eventlist</a>(tdata-&gt;pool);</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;      pjsip_msg_add_hdr(tdata-&gt;msg, (pjsip_hdr *) require);</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;   }</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae4bf9f7f4557d02712ea86b10e5d6891">sip_subscription_send_request</a>(sub_tree, tdata)) {</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;      <span class="comment">/* do not call pjsip_tx_data_dec_ref(tdata). The pjsip_dlg_send_request deletes the message on error */</span></div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;   }</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a8fe140462b79206a7c20a771dace07e1">send_scheduled_notify</a> = 0;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;}</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;</div><div class="line"><a name="l02462"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3e9568af1e66909dc6d642070e02b1a0"> 2462</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3e9568af1e66909dc6d642070e02b1a0">serialized_send_notify</a>(<span class="keywordtype">void</span> *userdata)</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;{</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree = userdata;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;   pjsip_dialog *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a> = sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;   pjsip_dlg_inc_lock(dlg);</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;   <span class="comment">/* It&#39;s possible that between when the notification was scheduled</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;<span class="comment">    * and now a new SUBSCRIBE arrived requiring full state to be</span></div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;<span class="comment">    * sent out in an immediate NOTIFY. It&#39;s also possible that we&#39;re</span></div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="comment">    * already processing a terminate.  If that has happened, we need to</span></div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="comment">    * bail out here instead of sending the batched NOTIFY.</span></div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> &gt;= <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af9b5de443ecb1dc5781aff2a03502ca5">SIP_SUB_TREE_TERMINATE_IN_PROGRESS</a></div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;      || !sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a8fe140462b79206a7c20a771dace07e1">send_scheduled_notify</a>) {</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;      pjsip_dlg_dec_lock(dlg);</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree);</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;   }</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;subscription_state == PJSIP_EVSUB_STATE_TERMINATED) {</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af9b5de443ecb1dc5781aff2a03502ca5">SIP_SUB_TREE_TERMINATE_IN_PROGRESS</a>;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;   }</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8b3391cb48972f432118c4ca2eeb3063">send_notify</a>(sub_tree, 0);</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a>(</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> == <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a68663ef66af50c315fec11f61bc226ab">SIP_SUB_TREE_TERMINATED</a></div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;         ? <span class="stringliteral">&quot;SUBSCRIPTION_TERMINATED&quot;</span> : <span class="stringliteral">&quot;SUBSCRIPTION_STATE_CHANGED&quot;</span>,</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;      <span class="stringliteral">&quot;Resource: %s&quot;</span>, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource);</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d5cc626722f9dee721868da7dc58a40">notify_sched_id</a> = -1;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;   pjsip_dlg_dec_lock(dlg);</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree);</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;}</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;</div><div class="line"><a name="l02500"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7ef69ae2e93f18a3a6cc53e4759b332f"> 2500</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7ef69ae2e93f18a3a6cc53e4759b332f">sched_cb</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;{</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree = (<span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *) data;</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;   <span class="comment">/* We don&#39;t need to bump the refcount of sub_tree since we bumped it when scheduling this task */</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3e9568af1e66909dc6d642070e02b1a0">serialized_send_notify</a>, sub_tree)) {</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree);</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;   }</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;}</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;</div><div class="line"><a name="l02512"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a312601e694a9ca811601375d4e33d8df"> 2512</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a312601e694a9ca811601375d4e33d8df">schedule_notification</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree)</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;{</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;   <span class="comment">/* There&#39;s already a notification scheduled */</span></div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d5cc626722f9dee721868da7dc58a40">notify_sched_id</a> &gt; -1) {</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;   }</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a8fe140462b79206a7c20a771dace07e1">send_scheduled_notify</a> = 1;</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d5cc626722f9dee721868da7dc58a40">notify_sched_id</a> = <a class="code" href="../../d7/d00/sched_8h.html#a7a43dcf8be6b2ed7f96f3867fbcb4082">ast_sched_add</a>(sched, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac90516981222dda0270465a33483f2b4">notification_batch_interval</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7ef69ae2e93f18a3a6cc53e4759b332f">sched_cb</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(sub_tree));</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d5cc626722f9dee721868da7dc58a40">notify_sched_id</a> &lt; 0) {</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree);</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;   }</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;}</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;</div><div class="line"><a name="l02529"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5b0f67be0ca6ad54e4eba8d4aa029faf"> 2529</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5b0f67be0ca6ad54e4eba8d4aa029faf">ast_sip_subscription_notify</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub, <span class="keyword">struct</span> <a class="code" href="../../d1/de8/structast__sip__body__data.html">ast_sip_body_data</a> *<a class="code" href="../../d4/d18/structnotify__data.html">notify_data</a>,</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;      <span class="keywordtype">int</span> terminate)</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;{</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;   pjsip_dialog *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a> = sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;   pjsip_dlg_inc_lock(dlg);</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;   <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> != <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af7fea613b9dafd6f664eea50435fea4e">SIP_SUB_TREE_NORMAL</a>) {</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;      pjsip_dlg_dec_lock(dlg);</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;   }</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa3b78cda3768f8f485e1ad46d6fcb765">ast_sip_pubsub_generate_body_content</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2294ee18e05ee676e083133058243909">ast_sip_subscription_get_body_type</a>(sub),</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;            <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5c54dc5f481da88392b1ec7149385613">ast_sip_subscription_get_body_subtype</a>(sub), notify_data, &amp;sub-&gt;body_text)) {</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;      pjsip_dlg_dec_lock(dlg);</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;   }</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;   sub-&gt;body_changed = 1;</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;   <span class="keywordflow">if</span> (terminate) {</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      sub-&gt;subscription_state = PJSIP_EVSUB_STATE_TERMINATED;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;      sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a5ffbdb3ef21db1d83c5a508f5e3865ae">SIP_SUB_TREE_TERMINATE_PENDING</a>;</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;   }</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;   <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac90516981222dda0270465a33483f2b4">notification_batch_interval</a>) {</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      res = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a312601e694a9ca811601375d4e33d8df">schedule_notification</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>);</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      <span class="comment">/* See the note in pubsub_on_rx_refresh() for why sub-&gt;tree is refbumped here */</span></div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>, +1);</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;      <span class="keywordflow">if</span> (terminate) {</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;         sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af9b5de443ecb1dc5781aff2a03502ca5">SIP_SUB_TREE_TERMINATE_IN_PROGRESS</a>;</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;      }</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;      res = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8b3391cb48972f432118c4ca2eeb3063">send_notify</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>, 0);</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a>(terminate ? <span class="stringliteral">&quot;SUBSCRIPTION_TERMINATED&quot;</span> : <span class="stringliteral">&quot;SUBSCRIPTION_STATE_CHANGED&quot;</span>,</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;            <span class="stringliteral">&quot;Resource: %s&quot;</span>,</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;            sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource);</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>, -1);</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;   }</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;   pjsip_dlg_dec_lock(dlg);</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;}</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;</div><div class="line"><a name="l02573"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a79792c0d3a54f779754479075e3c80b3"> 2573</a></span>&#160;pjsip_sip_uri *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a79792c0d3a54f779754479075e3c80b3">ast_sip_subscription_get_sip_uri</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;{</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;   <span class="keywordflow">return</span> sub-&gt;uri;</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;}</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;</div><div class="line"><a name="l02578"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aeb411f16e0fee4036a22b354164b43a6"> 2578</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aeb411f16e0fee4036a22b354164b43a6">ast_sip_subscription_get_local_uri</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">size_t</span> size)</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;{</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;   pjsip_uri_print(PJSIP_URI_IN_CONTACT_HDR, sub-&gt;uri, buf, size);</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;}</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;</div><div class="line"><a name="l02583"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0cb53b1ca63b4b97b4b3fa8721274ee9"> 2583</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0cb53b1ca63b4b97b4b3fa8721274ee9">ast_sip_subscription_get_remote_uri</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">size_t</span> size)</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;{</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;   pjsip_dialog *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;   pjsip_sip_uri *uri;</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;   dlg = sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;   uri = pjsip_uri_get_uri(dlg-&gt;remote.info-&gt;uri);</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;   <span class="keywordflow">if</span> (pjsip_uri_print(PJSIP_URI_IN_FROMTO_HDR, uri, buf, size) &lt; 0) {</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;      *buf = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;   }</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;}</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;</div><div class="line"><a name="l02596"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2d7ed3f8785ad9d9aa3fc090d983c45d"> 2596</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2d7ed3f8785ad9d9aa3fc090d983c45d">ast_sip_subscription_get_resource_name</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;{</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;   <span class="keywordflow">return</span> sub-&gt;resource;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;}</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;</div><div class="line"><a name="l02601"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae741d1ec08fd26b810d24514e510dad8"> 2601</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae741d1ec08fd26b810d24514e510dad8">ast_sip_subscription_is_terminated</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;{</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;   <span class="keywordflow">return</span> sub-&gt;subscription_state == PJSIP_EVSUB_STATE_TERMINATED ? 1 : 0;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;}</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;</div><div class="line"><a name="l02606"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ace14e2a3214654b0c1d15c05ba2bdb89"> 2606</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ace14e2a3214654b0c1d15c05ba2bdb89">sip_subscription_accept</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, pjsip_rx_data *rdata, <span class="keywordtype">int</span> response)</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;{</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;   pjsip_hdr res_hdr;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;   <span class="comment">/* If this is a persistence recreation the subscription has already been accepted */</span></div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#aad194ead974937834375b0ac8d37a7c2">ast_sip_mod_data_get</a>(rdata-&gt;endpt_info.mod_data, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad9ab4b2e3c02b132f457ec3e61d5d47d">MOD_DATA_PERSISTENCE</a>)) {</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;   }</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;   pj_list_init(&amp;res_hdr);</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9e1f9ef9caffc6fcf306dbf678ecc747">is_list</a>) {</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;      <span class="comment">/* If subscribing to a list, our response has to have a Require: eventlist header in it */</span></div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;      pj_list_insert_before(&amp;res_hdr, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad353ed8aab9f1e54ccf8d2e89a96bcac">create_require_eventlist</a>(rdata-&gt;tp_info.pool));</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;   }</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;   <span class="keywordflow">return</span> pjsip_evsub_accept(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, rdata, response, &amp;res_hdr) == PJ_SUCCESS ? 0 : -1;</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;}</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;</div><div class="line"><a name="l02624"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5d3ad3f5c55c026e22e1103686227ae0"> 2624</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5d3ad3f5c55c026e22e1103686227ae0">ast_sip_subscription_alloc_datastore</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a> *<a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d5d/structast__datastore.html#a2daadcdbac635c83b7bfc6375b4c9be4">uid</a>)</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;{</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/db6/datastore_8h.html#a65b31a9e32e3dad540c98ed2ee36e828">ast_datastores_alloc_datastore</a>(info, uid);</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;}</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;</div><div class="line"><a name="l02629"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a68314dedb48b2799a693d3a090ae038b"> 2629</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a68314dedb48b2799a693d3a090ae038b">ast_sip_subscription_add_datastore</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *subscription, <span class="keyword">struct</span> <a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *datastore)</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;{</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/db6/datastore_8h.html#a267b2996c54061f82ff1c5be72bbc731">ast_datastores_add</a>(subscription-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>, datastore);</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;}</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;</div><div class="line"><a name="l02634"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5ad2231cd4e17cd5a713f0c7cea20da4"> 2634</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5ad2231cd4e17cd5a713f0c7cea20da4">ast_sip_subscription_get_datastore</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *subscription, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;{</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/db6/datastore_8h.html#a3e5e18520733ba3dc58c1e218ab5541b">ast_datastores_find</a>(subscription-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>, name);</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;}</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;</div><div class="line"><a name="l02639"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3c257396060f400b0fba424730e7576e"> 2639</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3c257396060f400b0fba424730e7576e">ast_sip_subscription_remove_datastore</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *subscription, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;{</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;   <a class="code" href="../../d9/db6/datastore_8h.html#a126dac1c8ced6e9cf905430e88f35396">ast_datastores_remove</a>(subscription-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>, name);</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;}</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;</div><div class="line"><a name="l02644"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd22eade3d3a1bfce2d9acf505d34b1a"> 2644</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd22eade3d3a1bfce2d9acf505d34b1a">ast_sip_subscription_get_datastores</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *subscription)</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;{</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;   <span class="keywordflow">return</span> subscription-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;}</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;</div><div class="line"><a name="l02649"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aefd01cccb44e52e8c576785903382206"> 2649</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aefd01cccb44e52e8c576785903382206">ast_sip_publication_add_datastore</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *publication, <span class="keyword">struct</span> <a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *datastore)</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;{</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/db6/datastore_8h.html#a267b2996c54061f82ff1c5be72bbc731">ast_datastores_add</a>(publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>, datastore);</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;}</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;</div><div class="line"><a name="l02654"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a69501f479a8ea3b0d1b6c4b8439e03c9"> 2654</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a69501f479a8ea3b0d1b6c4b8439e03c9">ast_sip_publication_get_datastore</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *publication, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;{</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/db6/datastore_8h.html#a3e5e18520733ba3dc58c1e218ab5541b">ast_datastores_find</a>(publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>, name);</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;}</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;</div><div class="line"><a name="l02659"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a60c370a28e03a8dc64e6b1cf9f277194"> 2659</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a60c370a28e03a8dc64e6b1cf9f277194">ast_sip_publication_remove_datastore</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *publication, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;{</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;   <a class="code" href="../../d9/db6/datastore_8h.html#a126dac1c8ced6e9cf905430e88f35396">ast_datastores_remove</a>(publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>, name);</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;}</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;</div><div class="line"><a name="l02664"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa8ca8ca978fb48dc5a57ce618b36c0b5"> 2664</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa8ca8ca978fb48dc5a57ce618b36c0b5">ast_sip_publication_get_datastores</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *publication)</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;{</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;   <span class="keywordflow">return</span> publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>;</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;}</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;</div><div class="line"><a name="l02669"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a823b9711e5de08ec19a03f1994c11b30"> 2669</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a823b9711e5de08ec19a03f1994c11b30">ast_sip_subscription_set_persistence_data</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *subscription, <span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *persistence_data)</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;{</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>(subscription-&gt;persistence_data);</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;   subscription-&gt;persistence_data = persistence_data;</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;   <span class="keywordflow">if</span> (subscription-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>) {</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;      <span class="keywordflow">if</span> (!subscription-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">generator_data</a>) {</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;         subscription-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">generator_data</a> = <a class="code" href="../../d4/d05/json_8h.html#a5892d6cd943e00556180fcf15d30788e">ast_json_object_create</a>();</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;         <span class="keywordflow">if</span> (!subscription-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">generator_data</a>) {</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;         }</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;      }</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;      <a class="code" href="../../d4/d05/json_8h.html#abc8b563c172cfaffa2b555195990f729">ast_json_object_set</a>(subscription-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">generator_data</a>, subscription-&gt;resource,</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;         <a class="code" href="../../d4/d05/json_8h.html#a0ca956b7df20127f7e38993c3c06cb2c">ast_json_ref</a>(persistence_data));</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;   }</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;}</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;</div><div class="line"><a name="l02686"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac14c963f858de2e8b9bcd86c1a127b2d"> 2686</a></span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac14c963f858de2e8b9bcd86c1a127b2d">ast_sip_subscription_get_persistence_data</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *subscription)</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;{</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;   <span class="keywordflow">return</span> subscription-&gt;persistence_data;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;}</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;</div><div class="line"><a name="l02691"></a><span class="lineno"><a class="line" href="../../df/d3c/structpublish__handlers.html#ace4e0066a5b24f84b90536e9906619f6"> 2691</a></span>&#160;<a class="code" href="../../df/d90/linkedlists_8h.html#a39918fd433ac42184b152c86016ef139">AST_RWLIST_HEAD_STATIC</a>(<a class="code" href="../../df/d3c/structpublish__handlers.html">publish_handlers</a>, <a class="code" href="../../d5/d9f/structast__sip__publish__handler.html">ast_sip_publish_handler</a>);</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;</div><div class="line"><a name="l02693"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a267cc6529937f4689c804fb39976a823"> 2693</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a267cc6529937f4689c804fb39976a823">publication_hash_fn</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;{</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *publication = obj;</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">int</span> *<a class="code" href="../../d4/da6/structast__sip__publication.html#ae9dd8f0a26f1e5fdf7e5630d4dffadd3">entity_tag</a> = obj;</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;   <span class="keywordflow">return</span> flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a> ? *<a class="code" href="../../d4/da6/structast__sip__publication.html#ae9dd8f0a26f1e5fdf7e5630d4dffadd3">entity_tag</a> : publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#ae9dd8f0a26f1e5fdf7e5630d4dffadd3">entity_tag</a>;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;}</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;</div><div class="line"><a name="l02701"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a34bc405d2cc3c85aa8d449185c3569d6"> 2701</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a34bc405d2cc3c85aa8d449185c3569d6">publication_cmp_fn</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;{</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *publication1 = obj;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *publication2 = arg;</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">int</span> *<a class="code" href="../../d4/da6/structast__sip__publication.html#ae9dd8f0a26f1e5fdf7e5630d4dffadd3">entity_tag</a> = arg;</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;   <span class="keywordflow">return</span> (publication1-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#ae9dd8f0a26f1e5fdf7e5630d4dffadd3">entity_tag</a> == (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a> ? *entity_tag : publication2-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#ae9dd8f0a26f1e5fdf7e5630d4dffadd3">entity_tag</a>) ?</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0);</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;}</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;</div><div class="line"><a name="l02711"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#adb6d5815066f000bab8aa2aa43611f6c"> 2711</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#adb6d5815066f000bab8aa2aa43611f6c">publish_add_handler</a>(<span class="keyword">struct</span> <a class="code" href="../../d5/d9f/structast__sip__publish__handler.html">ast_sip_publish_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>)</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;{</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../df/d3c/structpublish__handlers.html">publish_handlers</a>);</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="../../df/d3c/structpublish__handlers.html">publish_handlers</a>, handler, next);</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/d3c/structpublish__handlers.html">publish_handlers</a>);</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;}</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;</div><div class="line"><a name="l02718"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a14d30548053458724404f5c041483cfa"> 2718</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a14d30548053458724404f5c041483cfa">ast_sip_register_publish_handler</a>(<span class="keyword">struct</span> <a class="code" href="../../d5/d9f/structast__sip__publish__handler.html">ast_sip_publish_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>)</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;{</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>)) {</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No event package specified for publish handler. Cannot register\n&quot;</span>);</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;   }</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;   handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aac80748c488a3724f6ab7e1ef4b73530">publications</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7b2ea661eb5491432e647c3070aa78a7">PUBLICATIONS_BUCKETS</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a267cc6529937f4689c804fb39976a823">publication_hash_fn</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a34bc405d2cc3c85aa8d449185c3569d6">publication_cmp_fn</a>);</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;   <span class="keywordflow">if</span> (!handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aac80748c488a3724f6ab7e1ef4b73530">publications</a>) {</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not allocate publications container for event &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;         handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>);</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;   }</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#adb6d5815066f000bab8aa2aa43611f6c">publish_add_handler</a>(handler);</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;}</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;</div><div class="line"><a name="l02738"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a65b342a28c864a472dfff5ea27de8691"> 2738</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a65b342a28c864a472dfff5ea27de8691">ast_sip_unregister_publish_handler</a>(<span class="keyword">struct</span> <a class="code" href="../../d5/d9f/structast__sip__publish__handler.html">ast_sip_publish_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>)</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;{</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d9f/structast__sip__publish__handler.html">ast_sip_publish_handler</a> *iter;</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../df/d3c/structpublish__handlers.html">publish_handlers</a>);</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="../../df/d3c/structpublish__handlers.html">publish_handlers</a>, iter, <a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#a6ad12c15b9231aec95e53a632ff79a56">next</a>) {</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;      <span class="keywordflow">if</span> (handler == iter) {</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a>(<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#a6ad12c15b9231aec95e53a632ff79a56">next</a>);</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aac80748c488a3724f6ab7e1ef4b73530">publications</a>);</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;      }</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;   }</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/d3c/structpublish__handlers.html">publish_handlers</a>);</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;}</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;</div><div class="line"><a name="l02754"></a><span class="lineno"><a class="line" href="../../d2/d1b/structsubscription__handlers.html#ace4e0066a5b24f84b90536e9906619f6"> 2754</a></span>&#160;<a class="code" href="../../df/d90/linkedlists_8h.html#a39918fd433ac42184b152c86016ef139">AST_RWLIST_HEAD_STATIC</a>(<a class="code" href="../../d2/d1b/structsubscription__handlers.html">subscription_handlers</a>, <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a>);</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;</div><div class="line"><a name="l02756"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7fa8f8f5e7bf978b9bc6c710d3b3e437"> 2756</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7fa8f8f5e7bf978b9bc6c710d3b3e437">sub_add_handler</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>)</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;{</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../d2/d1b/structsubscription__handlers.html">subscription_handlers</a>);</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="../../d2/d1b/structsubscription__handlers.html">subscription_handlers</a>, handler, <a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#a6ad12c15b9231aec95e53a632ff79a56">next</a>);</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../d2/d1b/structsubscription__handlers.html">subscription_handlers</a>);</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;}</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;</div><div class="line"><a name="l02763"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a219baab2a37a17e4922d696be2e07cca"> 2763</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a219baab2a37a17e4922d696be2e07cca">find_sub_handler_for_event_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>)</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;{</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *iter;</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../d2/d1b/structsubscription__handlers.html">subscription_handlers</a>);</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="../../d2/d1b/structsubscription__handlers.html">subscription_handlers</a>, iter, <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a2e4aa60e677c95983d44693bd69bc1be">next</a>) {</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;      <span class="keywordflow">if</span> (!strcmp(iter-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>, event_name)) {</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;      }</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;   }</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../d2/d1b/structsubscription__handlers.html">subscription_handlers</a>);</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;   <span class="keywordflow">return</span> iter;</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;}</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;</div><div class="line"><a name="l02777"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a250d91ea4fba33dd520804c8a47e795a"> 2777</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a250d91ea4fba33dd520804c8a47e795a">ast_sip_register_subscription_handler</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>)</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;{</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;   pj_str_t <a class="code" href="../../df/dd0/structresource__list.html#a5053da7047dfe40d67229c5dbc361f8b">event</a>;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;   pj_str_t <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a37cb3e0e7b0966a69f790d8d182d8cd0">accept</a>[<a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a1521854cc25592b7f8a58a4bed55ac6d">AST_SIP_MAX_ACCEPT</a>] = { {0, }, };</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *existing;</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;   <span class="keywordtype">int</span> i = 0;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>)) {</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No event package specified for subscription handler. Cannot register\n&quot;</span>);</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;   }</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;   existing = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a219baab2a37a17e4922d696be2e07cca">find_sub_handler_for_event_name</a>(handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>);</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;   <span class="keywordflow">if</span> (existing) {</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;         <span class="stringliteral">&quot;Unable to register subscription handler for event %s.  A handler is already registered\n&quot;</span>,</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;         handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>);</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;   }</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a1521854cc25592b7f8a58a4bed55ac6d">AST_SIP_MAX_ACCEPT</a> &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a37cb3e0e7b0966a69f790d8d182d8cd0">accept</a>[i]); ++i) {</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;      pj_cstr(&amp;accept[i], handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a37cb3e0e7b0966a69f790d8d182d8cd0">accept</a>[i]);</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;   }</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;   pj_cstr(&amp;event, handler-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>);</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;   pjsip_evsub_register_pkg(&amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>, &amp;event, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#afc353f33f479f252b0cea51d55afc7ca">DEFAULT_EXPIRES</a>, i, accept);</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7fa8f8f5e7bf978b9bc6c710d3b3e437">sub_add_handler</a>(handler);</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;}</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;</div><div class="line"><a name="l02810"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a16d299943a24f9857d3e847b83073d5d"> 2810</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a16d299943a24f9857d3e847b83073d5d">ast_sip_unregister_subscription_handler</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>)</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;{</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *iter;</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../d2/d1b/structsubscription__handlers.html">subscription_handlers</a>);</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="../../d2/d1b/structsubscription__handlers.html">subscription_handlers</a>, iter, <a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a2e4aa60e677c95983d44693bd69bc1be">next</a>) {</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;      <span class="keywordflow">if</span> (handler == iter) {</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a>(<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a2e4aa60e677c95983d44693bd69bc1be">next</a>);</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;      }</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;   }</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../d2/d1b/structsubscription__handlers.html">subscription_handlers</a>);</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;}</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;</div><div class="line"><a name="l02825"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3d0a8fc757c1fb1e064887580d4ba1ea"> 2825</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3d0a8fc757c1fb1e064887580d4ba1ea">find_body_generator_type_subtype_nolock</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>)</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;{</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../de/d26/app__externalivr_8c.html#abe143f1bae4445e9b3798e1dec3bda60">gen</a>;</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="../../dd/de0/structbody__generators.html">body_generators</a>, gen, <a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#af820db3728fdeafb6d1c8ff284ea6cc5">list</a>) {</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;      <span class="keywordflow">if</span> (!strcmp(gen-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a>, type)</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;         &amp;&amp; !strcmp(gen-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>, subtype)) {</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;      }</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;   }</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d26/app__externalivr_8c.html#abe143f1bae4445e9b3798e1dec3bda60">gen</a>;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;}</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;</div><div class="line"><a name="l02839"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5df18a3e8742e6bd4e6917b459c4c82d"> 2839</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5df18a3e8742e6bd4e6917b459c4c82d">find_body_generator_type_subtype</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>)</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;{</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../de/d26/app__externalivr_8c.html#abe143f1bae4445e9b3798e1dec3bda60">gen</a>;</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../dd/de0/structbody__generators.html">body_generators</a>);</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;   gen = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3d0a8fc757c1fb1e064887580d4ba1ea">find_body_generator_type_subtype_nolock</a>(type, subtype);</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../dd/de0/structbody__generators.html">body_generators</a>);</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d26/app__externalivr_8c.html#abe143f1bae4445e9b3798e1dec3bda60">gen</a>;</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;}</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;</div><div class="line"><a name="l02849"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a495d318729babacd6785c241fcdf845a"> 2849</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a495d318729babacd6785c241fcdf845a">find_body_generator_accept</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *accept)</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;{</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;   <span class="keywordtype">char</span> *accept_copy = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(accept);</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a> = accept_copy;</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a> = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;subtype, <span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(type) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(subtype)) {</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;   }</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5df18a3e8742e6bd4e6917b459c4c82d">find_body_generator_type_subtype</a>(type, subtype);</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;}</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;</div><div class="line"><a name="l02862"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa43549aaa8be02c39bd1e405f44d27f1"> 2862</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa43549aaa8be02c39bd1e405f44d27f1">find_body_generator</a>(<span class="keywordtype">char</span> accept[<a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a1521854cc25592b7f8a58a4bed55ac6d">AST_SIP_MAX_ACCEPT</a>][64],</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;      <span class="keywordtype">size_t</span> num_accept, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a35514bc6335d541353cf54c7146e8ce5">body_type</a>)</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;{</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../df/dde/app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; num_accept; ++i) {</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      generator = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a495d318729babacd6785c241fcdf845a">find_body_generator_accept</a>(accept[i]);</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;      <span class="keywordflow">if</span> (generator) {</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Body generator %p found for accept type %s\n&quot;</span>, generator, accept[i]);</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;         <span class="keywordflow">if</span> (strcmp(generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a35514bc6335d541353cf54c7146e8ce5">body_type</a>, body_type)) {</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Body generator &#39;%s/%s&#39;(%p) does not accept the type of data this event generates\n&quot;</span>,</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;                  generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a>, generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>, generator);</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;            generator = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;         }</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;No body generator found for accept type %s\n&quot;</span>, accept[i]);</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;      }</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;   }</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../df/dde/app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>;</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;}</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;</div><div class="line"><a name="l02887"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a19dd0f9dd8ac29890f8e90159ca7fb78"> 2887</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a19dd0f9dd8ac29890f8e90159ca7fb78">generate_initial_notify</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;{</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;   <span class="keywordtype">void</span> *<a class="code" href="../../d4/d18/structnotify__data.html">notify_data</a>;</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/de8/structast__sip__body__data.html">ast_sip_body_data</a> data = {</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;      .<a class="code" href="../../d1/de8/structast__sip__body__data.html#a35514bc6335d541353cf54c7146e8ce5">body_type</a> = sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a35514bc6335d541353cf54c7146e8ce5">body_type</a>,</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;   };</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;sub-&gt;children) &gt; 0) {</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;      <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;sub-&gt;children); ++i) {</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a19dd0f9dd8ac29890f8e90159ca7fb78">generate_initial_notify</a>(<a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;sub-&gt;children, i))) {</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;         }</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      }</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;   }</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;   <span class="comment">/* We notify subscription establishment only on the tree leaves. */</span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;   <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a06762434263891503f1fe196fd2cf613">notifier</a>-&gt;<a class="code" href="../../d1/d5b/structast__sip__notifier.html#ae3f8912b4a41553688ad665f170c6a91">subscription_established</a>(sub)) {</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;   }</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;   notify_data = sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#a06762434263891503f1fe196fd2cf613">notifier</a>-&gt;<a class="code" href="../../d1/d5b/structast__sip__notifier.html#ac400184f8d9f71baaaf9d294d33c1ca8">get_notify_data</a>(sub);</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;   <span class="keywordflow">if</span> (!notify_data) {</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;   }</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;   data.<a class="code" href="../../d1/de8/structast__sip__body__data.html#a086f833f6f250c98d7bcd80f9a573d06">body_data</a> = notify_data;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;   res = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa3b78cda3768f8f485e1ad46d6fcb765">ast_sip_pubsub_generate_body_content</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2294ee18e05ee676e083133058243909">ast_sip_subscription_get_body_type</a>(sub),</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;         <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5c54dc5f481da88392b1ec7149385613">ast_sip_subscription_get_body_subtype</a>(sub), &amp;data, &amp;sub-&gt;body_text);</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(notify_data);</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;}</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31b603dda9cf0a3354575494f0d4f9f9">pubsub_on_refresh_timeout</a>(<span class="keywordtype">void</span> *userdata);</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;</div><div class="line"><a name="l02929"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#acb194881d03c561cd60d0c88f82c7478"> 2929</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acb194881d03c561cd60d0c88f82c7478">initial_notify_task</a>(<span class="keywordtype">void</span> * obj)</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;{</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dbb/structinitial__notify__data.html">initial_notify_data</a> *ind = obj;</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a19dd0f9dd8ac29890f8e90159ca7fb78">generate_initial_notify</a>(ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>)) {</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;      pjsip_evsub_terminate(ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, PJ_TRUE);</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8b3391cb48972f432118c4ca2eeb3063">send_notify</a>(ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>, 1);</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a>(<span class="stringliteral">&quot;SUBSCRIPTION_ESTABLISHED&quot;</span>,</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;         <span class="stringliteral">&quot;Resource: %s&quot;</span>,</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;         ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource);</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;   }</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;   <span class="keywordflow">if</span> (ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a06552650d7ef9108d5744ee3f3fff264">expires</a> != <a class="code" href="../../d8/d8c/res__pjsip_8h.html#acd4517938f2afe11a1c6f372e28090a5">PJSIP_EXPIRES_NOT_SPECIFIED</a>) {</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(strlen(<span class="stringliteral">&quot;-&gt;/ &quot;</span>) +</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;         strlen(ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>) +</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;         strlen(ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource) +</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;         strlen(ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>) +</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;         ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;call_id-&gt;id.slen + 1);</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;      sprintf(name, <span class="stringliteral">&quot;%s-&gt;%s/%s %.*s&quot;</span>, ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>,</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;         ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource, ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>,</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;         (<span class="keywordtype">int</span>)ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;call_id-&gt;id.slen, ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;call_id-&gt;id.ptr);</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Scheduling timer: %s\n&quot;</span>, name);</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;      ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a> = <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga47a9130b20e7724a51d5eeebbc0a516b">ast_sip_schedule_task</a>(ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>,</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;         ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a06552650d7ef9108d5744ee3f3fff264">expires</a> * 1000, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31b603dda9cf0a3354575494f0d4f9f9">pubsub_on_refresh_timeout</a>, name,</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;         ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>, <a class="code" href="../../d7/dfa/group__pjsip__threading.html#gga478c7100d82665dc492845e4213ebc40a8d01d6eb6543f97d3289df2cbe6de212">AST_SIP_SCHED_TASK_FIXED</a> | <a class="code" href="../../d7/dfa/group__pjsip__threading.html#gga478c7100d82665dc492845e4213ebc40ac5773e910b212c28550aee8a0a42a22a">AST_SIP_SCHED_TASK_DATA_AO2</a>);</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;      <span class="keywordflow">if</span> (!ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a>) {</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create expiration timer of %d seconds for %s\n&quot;</span>,</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;            ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a06552650d7ef9108d5744ee3f3fff264">expires</a>, name);</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;      }</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;   }</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a>, -1);</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ind);</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;}</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;</div><div class="line"><a name="l02969"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd8fc16260b8a617c3d028b66745d5ad"> 2969</a></span>&#160;<span class="keyword">static</span> pj_bool_t <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd8fc16260b8a617c3d028b66745d5ad">pubsub_on_rx_subscribe_request</a>(pjsip_rx_data *rdata)</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;{</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;   pjsip_expires_hdr *expires_header;</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>;</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *, endpoint, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree;</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../df/dde/app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>;</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;   <span class="keywordtype">char</span> *resource;</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;   pjsip_uri *request_uri;</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;   pjsip_sip_uri *request_uri_sip;</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;   <span class="keywordtype">size_t</span> resource_size;</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;   <span class="keywordtype">int</span> resp;</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> tree;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;   pj_status_t dlg_status;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;   endpoint = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a0dc7590db76dcdc0105abc92072d1b06">ast_pjsip_rdata_get_endpoint</a>(rdata);</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(endpoint != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;   <span class="keywordflow">if</span> (!endpoint-&gt;subscription.allow) {</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Subscriptions not permitted for endpoint %s.\n&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint));</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 603, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;      <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;   }</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;   request_uri = rdata-&gt;msg_info.msg-&gt;line.req.uri;</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;   <span class="keywordflow">if</span> (!PJSIP_URI_SCHEME_IS_SIP(request_uri) &amp;&amp; !PJSIP_URI_SCHEME_IS_SIPS(request_uri)) {</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;      <span class="keywordtype">char</span> uri_str[PJSIP_MAX_URL_SIZE];</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      pjsip_uri_print(PJSIP_URI_IN_REQ_URI, request_uri, uri_str, <span class="keyword">sizeof</span>(uri_str));</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Request URI &#39;%s&#39; is not a sip: or sips: URI.\n&quot;</span>, uri_str);</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 416, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;      <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;   }</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;   request_uri_sip = pjsip_uri_get_uri(request_uri);</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;   resource_size = pj_strlen(&amp;request_uri_sip-&gt;user) + 1;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;   resource = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(resource_size);</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(resource, &amp;request_uri_sip-&gt;user, resource_size);</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;<span class="comment">    * We may want to match without any user options getting</span></div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;<span class="comment">    * in the way.</span></div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a6bb5769d100d0348446c7f032eca58c1">AST_SIP_USER_OPTIONS_TRUNCATE_CHECK</a>(resource);</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;   expires_header = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_EXPIRES, rdata-&gt;msg_info.msg-&gt;hdr.next);</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;   <span class="keywordflow">if</span> (expires_header) {</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;      <span class="keywordflow">if</span> (expires_header-&gt;ivalue == 0) {</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Subscription request from endpoint %s rejected. Expiration of 0 is invalid\n&quot;</span>,</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint));</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;         pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 400, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;            <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;      }</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      <span class="keywordflow">if</span> (expires_header-&gt;ivalue &lt; endpoint-&gt;subscription.minexpiry) {</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Subscription expiration %d is too brief for endpoint %s. Minimum is %u\n&quot;</span>,</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;            expires_header-&gt;ivalue, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint), endpoint-&gt;subscription.minexpiry);</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;         pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 423, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;         <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;      }</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;   }</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;   handler = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a97f99a19e99580b4339e386220c2d9f6">subscription_get_handler_from_rdata</a>(rdata, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint));</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;   <span class="keywordflow">if</span> (!handler) {</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 489, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;      <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;   }</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;   generator = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#af57976fae525316e955e6163f943db90">subscription_get_generator_from_rdata</a>(rdata, handler);</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;   <span class="keywordflow">if</span> (!generator) {</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 489, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;      <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;   }</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;   memset(&amp;tree, 0, <span class="keyword">sizeof</span>(tree));</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;   resp = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477">build_resource_tree</a>(endpoint, handler, resource, &amp;tree,</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa94f5c5d378799e218956c0804cbfb1e">ast_sip_pubsub_has_eventlist_support</a>(rdata));</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;   <span class="keywordflow">if</span> (!PJSIP_IS_STATUS_IN_CLASS(resp, 200)) {</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, resp, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aca2de2a2c7ba7a0a16d4632b56af96fa">resource_tree_destroy</a>(&amp;tree);</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;      <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;   }</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;   sub_tree = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a006316bcef76ef13dc1cc99560fbaa86">create_subscription_tree</a>(handler, endpoint, rdata, resource, generator, &amp;tree, &amp;dlg_status, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;   <span class="keywordflow">if</span> (!sub_tree) {</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;      <span class="keywordflow">if</span> (dlg_status != PJ_EEXISTS) {</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;         pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 500, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;      }</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../df/dbb/structinitial__notify__data.html">initial_notify_data</a> *ind = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(<span class="keyword">sizeof</span>(*ind));</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;      <span class="keywordflow">if</span> (!ind) {</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;         pjsip_evsub_terminate(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, PJ_TRUE);</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;         <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aca2de2a2c7ba7a0a16d4632b56af96fa">resource_tree_destroy</a>(&amp;tree);</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;         <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;      }</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;      ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">sub_tree</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(sub_tree);</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;      <span class="comment">/* Since this is a normal subscribe, pjproject takes care of the timer */</span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;      ind-&gt;<a class="code" href="../../df/dbb/structinitial__notify__data.html#a06552650d7ef9108d5744ee3f3fff264">expires</a> = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#acd4517938f2afe11a1c6f372e28090a5">PJSIP_EXPIRES_NOT_SPECIFIED</a>;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a00a4fae74e9482fb6c95acb3d653a182">subscription_persistence_create</a>(sub_tree);</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab37c67d3e45723f0b0aaf21dd9e2d605">subscription_persistence_update</a>(sub_tree, rdata, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400a3ac2fdd9911335d820131a694972a2e3">SUBSCRIPTION_PERSISTENCE_CREATED</a>);</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ace14e2a3214654b0c1d15c05ba2bdb89">sip_subscription_accept</a>(sub_tree, rdata, resp);</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acb194881d03c561cd60d0c88f82c7478">initial_notify_task</a>, ind)) {</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;         pjsip_evsub_terminate(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, PJ_TRUE);</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ind);</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;      }</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;   }</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aca2de2a2c7ba7a0a16d4632b56af96fa">resource_tree_destroy</a>(&amp;tree);</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;   <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;}</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;</div><div class="line"><a name="l03084"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a52a5833004176713878b9cbf3c311ec0"> 3084</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d5/d9f/structast__sip__publish__handler.html">ast_sip_publish_handler</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a52a5833004176713878b9cbf3c311ec0">find_pub_handler</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/d7d/structevent.html">event</a>)</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;{</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d9f/structast__sip__publish__handler.html">ast_sip_publish_handler</a> *iter = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../df/d3c/structpublish__handlers.html">publish_handlers</a>);</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="../../df/d3c/structpublish__handlers.html">publish_handlers</a>, iter, <a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#a6ad12c15b9231aec95e53a632ff79a56">next</a>) {</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;      <span class="keywordflow">if</span> (strcmp(event, iter-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>)) {</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Event %s does not match %s\n&quot;</span>, event, iter-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>);</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;      }</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Event name match: %s = %s\n&quot;</span>, event, iter-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>);</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;   }</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/d3c/structpublish__handlers.html">publish_handlers</a>);</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;   <span class="keywordflow">return</span> iter;</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;}</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;</div><div class="line"><a name="l03102"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad4c0e99b92215cdc4a96b439c108cd0a"> 3102</a></span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d1/d94/sip_8h.html#a42ecd8494df028dc44c95b90848ad311">sip_publish_type</a> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad4c0e99b92215cdc4a96b439c108cd0a">determine_sip_publish_type</a>(pjsip_rx_data *rdata,</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;   pjsip_generic_string_hdr *etag_hdr, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *expires, <span class="keywordtype">int</span> *entity_id)</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;{</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;   pjsip_expires_hdr *expires_hdr = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_EXPIRES, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;   <span class="keywordflow">if</span> (etag_hdr) {</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;      <span class="keywordtype">char</span> etag[pj_strlen(&amp;etag_hdr-&gt;hvalue) + 1];</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(etag, &amp;etag_hdr-&gt;hvalue, <span class="keyword">sizeof</span>(etag));</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;      <span class="keywordflow">if</span> (sscanf(etag, <span class="stringliteral">&quot;%30d&quot;</span>, entity_id) != 1) {</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a9b252001716803d21529f825433f4008">SIP_PUBLISH_UNKNOWN</a>;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;      }</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;   }</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;   *expires = expires_hdr ? expires_hdr-&gt;ivalue : <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4d530a1f675151206b5929a37a882fe2">DEFAULT_PUBLISH_EXPIRES</a>;</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;   <span class="keywordflow">if</span> (!(*expires)) {</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a267332dc912cbca4f3e5ede0fd776ae9">SIP_PUBLISH_REMOVE</a>;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!etag_hdr &amp;&amp; rdata-&gt;msg_info.msg-&gt;body) {</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311aeb9d6241943fcb32f34ed3a12548c623">SIP_PUBLISH_INITIAL</a>;</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (etag_hdr &amp;&amp; !rdata-&gt;msg_info.msg-&gt;body) {</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a83a82444fd66df13a6196fe98cedff69">SIP_PUBLISH_REFRESH</a>;</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (etag_hdr &amp;&amp; rdata-&gt;msg_info.msg-&gt;body) {</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311ad4fc06a713557a6d936557a69615d519">SIP_PUBLISH_MODIFY</a>;</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;   }</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a9b252001716803d21529f825433f4008">SIP_PUBLISH_UNKNOWN</a>;</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;}</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;<span class="comment">/*! \brief Internal destructor for publications */</span></div><div class="line"><a name="l03133"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#af9e99216a3b9def7b033ec0404e4140f"> 3133</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#af9e99216a3b9def7b033ec0404e4140f">publication_destroy_fn</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;{</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *publication = obj;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Destroying SIP publication\n&quot;</span>);</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#abc32956d82e246471f4e5edbb3dda759">datastores</a>);</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>);</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#a15896c26e51e8162df5eb9a0124c841f">ast_module_unref</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;}</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;</div><div class="line"><a name="l03145"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab8fd4e13f8412f935f22b1df916b55a3"> 3145</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab8fd4e13f8412f935f22b1df916b55a3">sip_create_publication</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *<a class="code" href="../../d4/da6/structast__sip__publication.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>, pjsip_rx_data *rdata,</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/da6/structast__sip__publication.html#add9403c2dd81e949c8c4aa872eabdcc7">resource</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/da6/structast__sip__publication.html#a6aae576152b40374b43f81349aecc739">event_configuration_name</a>)</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;{</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *publication;</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;   pjsip_expires_hdr *expires_hdr = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_EXPIRES, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;   <span class="keywordtype">size_t</span> resource_len = strlen(resource) + 1, event_configuration_name_len = strlen(event_configuration_name) + 1;</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;   <span class="keywordtype">char</span> *dst;</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(endpoint != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;   <span class="keywordflow">if</span> (!(publication = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*publication) + resource_len + event_configuration_name_len, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#af9e99216a3b9def7b033ec0404e4140f">publication_destroy_fn</a>))) {</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;   }</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#a8dea6491bedba471fc44574d76438577">ast_module_ref</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;   <span class="keywordflow">if</span> (!(publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#abc32956d82e246471f4e5edbb3dda759">datastores</a> = <a class="code" href="../../d9/db6/datastore_8h.html#afa0c7f9c8f98470441ff8e9b3e8f34cc">ast_datastores_alloc</a>())) {</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(publication, -1);</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;   }</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;   publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#ae9dd8f0a26f1e5fdf7e5630d4dffadd3">entity_tag</a> = <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a47e7031430a4ba4c21aac39b482ffd82">esc_etag_counter</a>, +1);</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(endpoint, +1);</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;   publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a> = <a class="code" href="../../d4/da6/structast__sip__publication.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>;</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;   publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a06552650d7ef9108d5744ee3f3fff264">expires</a> = expires_hdr ? expires_hdr-&gt;ivalue : <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4d530a1f675151206b5929a37a882fe2">DEFAULT_PUBLISH_EXPIRES</a>;</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;   publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a5856afac1fb921f1d6a4eb1fe9412bc8">sched_id</a> = -1;</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;   dst = publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a>;</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;   publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#add9403c2dd81e949c8c4aa872eabdcc7">resource</a> = strcpy(dst, resource);</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;   dst += resource_len;</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;   publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a6aae576152b40374b43f81349aecc739">event_configuration_name</a> = strcpy(dst, event_configuration_name);</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;   <span class="keywordflow">return</span> publication;</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;}</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;</div><div class="line"><a name="l03179"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a20aeeed556614ef809787fb4f04de0fb"> 3179</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a20aeeed556614ef809787fb4f04de0fb">sip_publication_respond</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *pub, <span class="keywordtype">int</span> status_code,</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;      pjsip_rx_data *rdata)</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;{</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;   pjsip_tx_data *tdata;</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;   pjsip_transaction *tsx;</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;   <span class="keywordflow">if</span> (pjsip_endpt_create_response(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, status_code, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;tdata) != PJ_SUCCESS) {</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;   }</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;   <span class="keywordflow">if</span> (PJSIP_IS_STATUS_IN_CLASS(status_code, 200)) {</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>[30];</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;      snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, pub-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#ae9dd8f0a26f1e5fdf7e5630d4dffadd3">entity_tag</a>);</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#acef4d0aef5bdc92f0b6b188e48f2e90f">ast_sip_add_header</a>(tdata, <span class="stringliteral">&quot;SIP-ETag&quot;</span>, buf);</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;      snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, pub-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a06552650d7ef9108d5744ee3f3fff264">expires</a>);</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#acef4d0aef5bdc92f0b6b188e48f2e90f">ast_sip_add_header</a>(tdata, <span class="stringliteral">&quot;Expires&quot;</span>, buf);</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;   }</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;   <span class="keywordflow">if</span> (pjsip_tsx_create_uas(&amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>, rdata, &amp;tsx) != PJ_SUCCESS) {</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;      pjsip_tx_data_dec_ref(tdata);</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;   }</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;   pjsip_tsx_recv_msg(tsx, rdata);</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;   <span class="keywordflow">if</span> (pjsip_tsx_send_msg(tsx, tdata) != PJ_SUCCESS) {</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;      pjsip_tx_data_dec_ref(tdata);</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;   }</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;}</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;</div><div class="line"><a name="l03214"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#abefb888baf6382d9f1a1266d24e21648"> 3214</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abefb888baf6382d9f1a1266d24e21648">publish_request_initial</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *<a class="code" href="../../d4/da6/structast__sip__publication.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>, pjsip_rx_data *rdata,</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d5/d9f/structast__sip__publish__handler.html">ast_sip_publish_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>)</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;{</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *publication;</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;   <span class="keywordtype">char</span> *resource_name;</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;   <span class="keywordtype">size_t</span> resource_size;</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d91/structast__sip__publication__resource.html">ast_sip_publication_resource</a> *, <a class="code" href="../../d4/da6/structast__sip__publication.html#add9403c2dd81e949c8c4aa872eabdcc7">resource</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *event_configuration_name = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;   pjsip_uri *request_uri;</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;   pjsip_sip_uri *request_uri_sip;</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;   <span class="keywordtype">int</span> resp;</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;   request_uri = rdata-&gt;msg_info.msg-&gt;line.req.uri;</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;   <span class="keywordflow">if</span> (!PJSIP_URI_SCHEME_IS_SIP(request_uri) &amp;&amp; !PJSIP_URI_SCHEME_IS_SIPS(request_uri)) {</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;      <span class="keywordtype">char</span> uri_str[PJSIP_MAX_URL_SIZE];</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;      pjsip_uri_print(PJSIP_URI_IN_REQ_URI, request_uri, uri_str, <span class="keyword">sizeof</span>(uri_str));</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Request URI &#39;%s&#39; is not a sip: or sips: URI.\n&quot;</span>, uri_str);</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 416, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;   }</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;   request_uri_sip = pjsip_uri_get_uri(request_uri);</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;   resource_size = pj_strlen(&amp;request_uri_sip-&gt;user) + 1;</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;   resource_name = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(resource_size);</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(resource_name, &amp;request_uri_sip-&gt;user, resource_size);</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;<span class="comment">    * We may want to match without any user options getting</span></div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;<span class="comment">    * in the way.</span></div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a6bb5769d100d0348446c7f032eca58c1">AST_SIP_USER_OPTIONS_TRUNCATE_CHECK</a>(resource_name);</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;   resource = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;inbound-publication&quot;</span>, resource_name);</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;   <span class="keywordflow">if</span> (!resource) {</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;No &#39;inbound-publication&#39; defined for resource &#39;%s&#39;\n&quot;</span>, resource_name);</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 404, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;   }</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(resource-&gt;endpoint) &amp;&amp; strcmp(resource-&gt;endpoint, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint))) {</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Resource %s has a defined endpoint &#39;%s&#39;, but does not match endpoint &#39;%s&#39; that received the request\n&quot;</span>,</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;         resource_name, resource-&gt;endpoint, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint));</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 403, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;   }</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;   <span class="keywordflow">for</span> (event_configuration_name = resource-&gt;events; event_configuration_name; event_configuration_name = event_configuration_name-&gt;<a class="code" href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">next</a>) {</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;      <span class="keywordflow">if</span> (!strcmp(event_configuration_name-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>)) {</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;      }</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;   }</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;   <span class="keywordflow">if</span> (!event_configuration_name) {</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Event &#39;%s&#39; is not configured for &#39;%s&#39;\n&quot;</span>, handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>, resource_name);</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 404, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;   }</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;   resp = handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#a3bcafa1a0d7e03921ef2883953be90ae">new_publication</a>(endpoint, resource_name, event_configuration_name-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;   <span class="keywordflow">if</span> (!PJSIP_IS_STATUS_IN_CLASS(resp, 200)) {</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, resp, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;   }</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;   publication = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab8fd4e13f8412f935f22b1df916b55a3">sip_create_publication</a>(endpoint, rdata, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(resource_name, <span class="stringliteral">&quot;&quot;</span>), event_configuration_name-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;   <span class="keywordflow">if</span> (!publication) {</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 503, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;   }</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;   publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a2f64eb664f09b6d1dde7f4eed3f55862">handler</a> = <a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>;</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;   <span class="keywordflow">if</span> (publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a2f64eb664f09b6d1dde7f4eed3f55862">handler</a>-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#af0ab5befc3e79fb52d28e243c8ac14e0">publication_state_change</a>(publication, rdata-&gt;msg_info.msg-&gt;body,</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;         <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a0a56204d9bae50c4103725ef62aab562ab368f4beb502956f3544f351c116ade6">AST_SIP_PUBLISH_STATE_INITIALIZED</a>)) {</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 500, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(publication);</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;   }</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a20aeeed556614ef809787fb4f04de0fb">sip_publication_respond</a>(publication, resp, rdata);</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;   <span class="keywordflow">return</span> publication;</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;}</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;</div><div class="line"><a name="l03301"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aaf5faf819b36c09254d66835d498e6e0"> 3301</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aaf5faf819b36c09254d66835d498e6e0">publish_expire_callback</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;{</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *, publication, data, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;   <span class="keywordflow">if</span> (publication-&gt;handler-&gt;publish_expire) {</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;      publication-&gt;handler-&gt;publish_expire(publication);</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;   }</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;}</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;</div><div class="line"><a name="l03312"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a93eb8c4f7adc89002faae30ba3b1da7d"> 3312</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a93eb8c4f7adc89002faae30ba3b1da7d">publish_expire</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;{</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *publication = (<span class="keyword">struct </span><a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a>*)data;</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a2f64eb664f09b6d1dde7f4eed3f55862">handler</a>-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aac80748c488a3724f6ab7e1ef4b73530">publications</a>, publication);</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;   publication-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a5856afac1fb921f1d6a4eb1fe9412bc8">sched_id</a> = -1;</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aaf5faf819b36c09254d66835d498e6e0">publish_expire_callback</a>, publication)) {</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(publication);</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;   }</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;}</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;</div><div class="line"><a name="l03326"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4dba55f11df69f28d19d9125e3995334"> 3326</a></span>&#160;<span class="keyword">static</span> pj_bool_t <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4dba55f11df69f28d19d9125e3995334">pubsub_on_rx_publish_request</a>(pjsip_rx_data *rdata)</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;{</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;   pjsip_event_hdr *event_header;</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d9f/structast__sip__publish__handler.html">ast_sip_publish_handler</a> *<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>;</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *, endpoint, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;   <span class="keywordtype">char</span> <span class="keyword">event</span>[32];</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t str_sip_if_match = { <span class="stringliteral">&quot;SIP-If-Match&quot;</span>, 12 };</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;   pjsip_generic_string_hdr *etag_hdr = pjsip_msg_find_hdr_by_name(rdata-&gt;msg_info.msg, &amp;str_sip_if_match, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d1/d94/sip_8h.html#a42ecd8494df028dc44c95b90848ad311">sip_publish_type</a> publish_type;</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *, publication, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> expires = 0;</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;   <span class="keywordtype">int</span> entity_id, response = 0;</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;   endpoint = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a0dc7590db76dcdc0105abc92072d1b06">ast_pjsip_rdata_get_endpoint</a>(rdata);</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(endpoint != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;   event_header = pjsip_msg_find_hdr_by_name(rdata-&gt;msg_info.msg, &amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4abffbee599d833b446686d5213d80e4">str_event_name</a>, rdata-&gt;msg_info.msg-&gt;hdr.next);</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;   <span class="keywordflow">if</span> (!event_header) {</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Incoming PUBLISH request from %s with no Event header\n&quot;</span>,</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint));</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 489, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;      <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;   }</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(<a class="code" href="../../df/d7d/structevent.html">event</a>, &amp;event_header-&gt;event_type, <span class="keyword">sizeof</span>(<a class="code" href="../../df/d7d/structevent.html">event</a>));</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;   handler = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a52a5833004176713878b9cbf3c311ec0">find_pub_handler</a>(<a class="code" href="../../df/d7d/structevent.html">event</a>);</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;   <span class="keywordflow">if</span> (!handler) {</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No registered publish handler for event %s from %s\n&quot;</span>, <a class="code" href="../../df/d7d/structevent.html">event</a>,</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint));</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 489, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;      <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;   }</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;   publish_type = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad4c0e99b92215cdc4a96b439c108cd0a">determine_sip_publish_type</a>(rdata, etag_hdr, &amp;expires, &amp;entity_id);</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;   <span class="comment">/* If this is not an initial publish ensure that a publication is present */</span></div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;   <span class="keywordflow">if</span> ((publish_type != <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311aeb9d6241943fcb32f34ed3a12548c623">SIP_PUBLISH_INITIAL</a>) &amp;&amp; (publish_type != <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a9b252001716803d21529f825433f4008">SIP_PUBLISH_UNKNOWN</a>)) {</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;      <span class="keywordflow">if</span> (!(publication = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aac80748c488a3724f6ab7e1ef4b73530">publications</a>, &amp;entity_id, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a>))) {</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;         <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t str_conditional_request_failed = { <span class="stringliteral">&quot;Conditional Request Failed&quot;</span>, 26 };</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;         pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 412, &amp;str_conditional_request_failed,</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;            <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;         <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;      }</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;      <span class="comment">/* Per the RFC every response has to have a new entity tag */</span></div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;      publication-&gt;entity_tag = <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a47e7031430a4ba4c21aac39b482ffd82">esc_etag_counter</a>, +1);</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;      <span class="comment">/* Update the expires here so that the created responses will contain the correct value */</span></div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;      publication-&gt;expires = expires;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;   }</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;   <span class="keywordflow">switch</span> (publish_type) {</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311aeb9d6241943fcb32f34ed3a12548c623">SIP_PUBLISH_INITIAL</a>:</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;         publication = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abefb888baf6382d9f1a1266d24e21648">publish_request_initial</a>(endpoint, rdata, handler);</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a83a82444fd66df13a6196fe98cedff69">SIP_PUBLISH_REFRESH</a>:</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311ad4fc06a713557a6d936557a69615d519">SIP_PUBLISH_MODIFY</a>:</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#af0ab5befc3e79fb52d28e243c8ac14e0">publication_state_change</a>(publication, rdata-&gt;msg_info.msg-&gt;body,</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;                  <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a0a56204d9bae50c4103725ef62aab562a5d64d62e9e58a0f155318ab2bc94ade3">AST_SIP_PUBLISH_STATE_ACTIVE</a>)) {</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;            <span class="comment">/* If an error occurs we want to terminate the publication */</span></div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;            expires = 0;</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;         }</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;         response = 200;</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a267332dc912cbca4f3e5ede0fd776ae9">SIP_PUBLISH_REMOVE</a>:</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;         handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#af0ab5befc3e79fb52d28e243c8ac14e0">publication_state_change</a>(publication, rdata-&gt;msg_info.msg-&gt;body,</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;               <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a0a56204d9bae50c4103725ef62aab562a797a8ff87d8dc4f37be06d27c0687352">AST_SIP_PUBLISH_STATE_TERMINATED</a>);</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;         response = 200;</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a9b252001716803d21529f825433f4008">SIP_PUBLISH_UNKNOWN</a>:</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;         pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 400, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;   }</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;   <span class="keywordflow">if</span> (publication) {</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;      <span class="keywordflow">if</span> (expires) {</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(handler-&gt;<a class="code" href="../../d5/d9f/structast__sip__publish__handler.html#aac80748c488a3724f6ab7e1ef4b73530">publications</a>, publication);</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;         <a class="code" href="../../d7/d00/sched_8h.html#a2a9174d10a79bd233b8498a11201f681">AST_SCHED_REPLACE_UNREF</a>(publication-&gt;sched_id, sched, expires * 1000, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a93eb8c4f7adc89002faae30ba3b1da7d">publish_expire</a>, publication,</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;                  <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(_data, -1), <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(publication, -1), <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(publication, +1));</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;         <a class="code" href="../../d7/d00/sched_8h.html#a11e2d4283c11790a27a0f899dab00e93">AST_SCHED_DEL_UNREF</a>(sched, publication-&gt;sched_id, <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(publication, -1));</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;      }</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;   }</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;   <span class="keywordflow">if</span> (response) {</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a20aeeed556614ef809787fb4f04de0fb">sip_publication_respond</a>(publication, response, rdata);</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;   }</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;   <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;}</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;</div><div class="line"><a name="l03420"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#adf23ea14cf21cc35810a043bed318bb6"> 3420</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#adf23ea14cf21cc35810a043bed318bb6">ast_sip_publication_get_endpoint</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *pub)</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;{</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;   <span class="keywordflow">return</span> pub-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>;</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;}</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;</div><div class="line"><a name="l03425"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac1dd2ba4db4cb10f5d1813886503bd96"> 3425</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac1dd2ba4db4cb10f5d1813886503bd96">ast_sip_publication_get_resource</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *pub)</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;{</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;   <span class="keywordflow">return</span> pub-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#add9403c2dd81e949c8c4aa872eabdcc7">resource</a>;</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;}</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;</div><div class="line"><a name="l03430"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ada9f3d03df5f52f4aeb09f6d952f46de"> 3430</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ada9f3d03df5f52f4aeb09f6d952f46de">ast_sip_publication_get_event_configuration</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a> *pub)</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;{</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;   <span class="keywordflow">return</span> pub-&gt;<a class="code" href="../../d4/da6/structast__sip__publication.html#a6aae576152b40374b43f81349aecc739">event_configuration_name</a>;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;}</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;</div><div class="line"><a name="l03435"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac0030d8d5c2b988a0f7e7968a66180dd"> 3435</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac0030d8d5c2b988a0f7e7968a66180dd">ast_sip_pubsub_is_body_generator_registered</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *subtype)</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;{</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;   <span class="keywordflow">return</span> !!<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5df18a3e8742e6bd4e6917b459c4c82d">find_body_generator_type_subtype</a>(type, subtype);</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;}</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;</div><div class="line"><a name="l03440"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8d089a744841fa628f7dc8f09d70db04"> 3440</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8d089a744841fa628f7dc8f09d70db04">ast_sip_pubsub_register_body_generator</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../df/dde/app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>)</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;{</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *existing;</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;   pj_str_t accept;</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;   pj_size_t accept_len;</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../dd/de0/structbody__generators.html">body_generators</a>);</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;   existing = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3d0a8fc757c1fb1e064887580d4ba1ea">find_body_generator_type_subtype_nolock</a>(generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a>, generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>);</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;   <span class="keywordflow">if</span> (existing) {</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../dd/de0/structbody__generators.html">body_generators</a>);</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;A body generator for %s/%s is already registered.\n&quot;</span>,</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;         generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a>, generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>);</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;   }</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307">AST_LIST_INSERT_HEAD</a>(&amp;<a class="code" href="../../dd/de0/structbody__generators.html">body_generators</a>, generator, <a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#af820db3728fdeafb6d1c8ff284ea6cc5">list</a>);</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../dd/de0/structbody__generators.html">body_generators</a>);</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;   <span class="comment">/* Lengths of type and subtype plus a slash. */</span></div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;   accept_len = strlen(generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a>) + strlen(generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>) + 1;</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;   <span class="comment">/* Add room for null terminator that sprintf() will set. */</span></div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;   pj_strset(&amp;accept, <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(accept_len + 1), accept_len);</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;   sprintf((<span class="keywordtype">char</span> *) pj_strbuf(&amp;accept), <span class="stringliteral">&quot;%s/%s&quot;</span>, generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a>, generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>);<span class="comment">/* Safe */</span></div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;   pjsip_endpt_add_capability(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), &amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>,</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;         PJSIP_H_ACCEPT, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 1, &amp;accept);</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;}</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;</div><div class="line"><a name="l03470"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a22d7c1042170155672514fbb16ce46eb"> 3470</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a22d7c1042170155672514fbb16ce46eb">ast_sip_pubsub_unregister_body_generator</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../df/dde/app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>)</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;{</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *iter;</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../dd/de0/structbody__generators.html">body_generators</a>);</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="../../dd/de0/structbody__generators.html">body_generators</a>, iter, <a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#af820db3728fdeafb6d1c8ff284ea6cc5">list</a>) {</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;      <span class="keywordflow">if</span> (iter == generator) {</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a>(<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#af820db3728fdeafb6d1c8ff284ea6cc5">list</a>);</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;      }</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;   }</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../dd/de0/structbody__generators.html">body_generators</a>);</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;}</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;</div><div class="line"><a name="l03485"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5cc1e17b0488075e8ea7d40085d502e1"> 3485</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5cc1e17b0488075e8ea7d40085d502e1">ast_sip_pubsub_register_body_supplement</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d72/structast__sip__pubsub__body__supplement.html">ast_sip_pubsub_body_supplement</a> *supplement)</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;{</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../d5/d90/structbody__supplements.html">body_supplements</a>);</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="../../d5/d90/structbody__supplements.html">body_supplements</a>, supplement, <a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#af820db3728fdeafb6d1c8ff284ea6cc5">list</a>);</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../d5/d90/structbody__supplements.html">body_supplements</a>);</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;}</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;</div><div class="line"><a name="l03494"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2be73952bf96122adf824dbbc26caa1c"> 3494</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2be73952bf96122adf824dbbc26caa1c">ast_sip_pubsub_unregister_body_supplement</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d72/structast__sip__pubsub__body__supplement.html">ast_sip_pubsub_body_supplement</a> *supplement)</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;{</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d72/structast__sip__pubsub__body__supplement.html">ast_sip_pubsub_body_supplement</a> *iter;</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../d5/d90/structbody__supplements.html">body_supplements</a>);</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="../../d5/d90/structbody__supplements.html">body_supplements</a>, iter, <a class="code" href="../../d7/d72/structast__sip__pubsub__body__supplement.html#a50233821a9d3db6ae3c8b16d85bffe86">list</a>) {</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;      <span class="keywordflow">if</span> (iter == supplement) {</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a>(<a class="code" href="../../d7/d72/structast__sip__pubsub__body__supplement.html#a50233821a9d3db6ae3c8b16d85bffe86">list</a>);</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;      }</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;   }</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../d5/d90/structbody__supplements.html">body_supplements</a>);</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;}</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;</div><div class="line"><a name="l03509"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2294ee18e05ee676e083133058243909"> 3509</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2294ee18e05ee676e083133058243909">ast_sip_subscription_get_body_type</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;{</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;   <span class="keywordflow">return</span> sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4b57472ac293cbff3de8eb58471771f0">body_generator</a>-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a>;</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;}</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;</div><div class="line"><a name="l03514"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5c54dc5f481da88392b1ec7149385613"> 3514</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5c54dc5f481da88392b1ec7149385613">ast_sip_subscription_get_body_subtype</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;{</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;   <span class="keywordflow">return</span> sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4b57472ac293cbff3de8eb58471771f0">body_generator</a>-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>;</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;}</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;</div><div class="line"><a name="l03519"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa3b78cda3768f8f485e1ad46d6fcb765"> 3519</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa3b78cda3768f8f485e1ad46d6fcb765">ast_sip_pubsub_generate_body_content</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d72/structast__sip__pubsub__body__supplement.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>,</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../d1/de8/structast__sip__body__data.html">ast_sip_body_data</a> *data, <span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;{</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d72/structast__sip__pubsub__body__supplement.html">ast_sip_pubsub_body_supplement</a> *supplement;</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a> *<a class="code" href="../../df/dde/app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;   <span class="keywordtype">void</span> *body;</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;   generator = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a5df18a3e8742e6bd4e6917b459c4c82d">find_body_generator_type_subtype</a>(type, subtype);</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;   <span class="keywordflow">if</span> (!generator) {</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to find a body generator for %s/%s\n&quot;</span>,</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;            type, subtype);</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;   }</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;   <span class="keywordflow">if</span> (strcmp(data-&gt;<a class="code" href="../../d1/de8/structast__sip__body__data.html#a35514bc6335d541353cf54c7146e8ce5">body_type</a>, generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a35514bc6335d541353cf54c7146e8ce5">body_type</a>)) {</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s/%s body generator does not accept the type of data provided\n&quot;</span>,</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;         type, subtype);</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;   }</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;   body = generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a385739136e77ae600f5bf6f00bcfebb9">allocate_body</a>(data-&gt;<a class="code" href="../../d1/de8/structast__sip__body__data.html#a086f833f6f250c98d7bcd80f9a573d06">body_data</a>);</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;   <span class="keywordflow">if</span> (!body) {</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s/%s body generator could not to allocate a body\n&quot;</span>,</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;         type, subtype);</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;   }</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;   <span class="keywordflow">if</span> (generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#ae9df1ad90af9f1ce1a581f295ef305a5">generate_body_content</a>(body, data-&gt;<a class="code" href="../../d1/de8/structast__sip__body__data.html#a086f833f6f250c98d7bcd80f9a573d06">body_data</a>)) {</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;      res = -1;</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;   }</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../d5/d90/structbody__supplements.html">body_supplements</a>);</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="../../d5/d90/structbody__supplements.html">body_supplements</a>, supplement, <a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#af820db3728fdeafb6d1c8ff284ea6cc5">list</a>) {</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;      <span class="keywordflow">if</span> (!strcmp(generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a>, supplement-&gt;<a class="code" href="../../d7/d72/structast__sip__pubsub__body__supplement.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a>) &amp;&amp;</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;            !strcmp(generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>, supplement-&gt;<a class="code" href="../../d7/d72/structast__sip__pubsub__body__supplement.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>)) {</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;         res = supplement-&gt;<a class="code" href="../../d7/d72/structast__sip__pubsub__body__supplement.html#a2d404fadf2a8afa26742b1cd27bd50cd">supplement_body</a>(body, data-&gt;<a class="code" href="../../d1/de8/structast__sip__body__data.html#a086f833f6f250c98d7bcd80f9a573d06">body_data</a>);</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;         <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;         }</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;      }</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;   }</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../d5/d90/structbody__supplements.html">body_supplements</a>);</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;   <span class="keywordflow">if</span> (!res) {</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;      generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a01fdd40c6cfdff735455dee9436346d6">to_string</a>(body, str);</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;   }</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>:</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;   <span class="keywordflow">if</span> (generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a3b12361a3bb7b12cc7729927503209cb">destroy_body</a>) {</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;      generator-&gt;<a class="code" href="../../df/dc3/structast__sip__pubsub__body__generator.html#a3b12361a3bb7b12cc7729927503209cb">destroy_body</a>(body);</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;   }</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;}</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;</div><div class="line"><a name="l03576"></a><span class="lineno"><a class="line" href="../../d0/d4c/structsimple__message__summary.html"> 3576</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d0/d4c/structsimple__message__summary.html">simple_message_summary</a> {</div><div class="line"><a name="l03577"></a><span class="lineno"><a class="line" href="../../d0/d4c/structsimple__message__summary.html#a1aac92e179c16fc5d0542fed81590d7d"> 3577</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d4c/structsimple__message__summary.html#a1aac92e179c16fc5d0542fed81590d7d">messages_waiting</a>;</div><div class="line"><a name="l03578"></a><span class="lineno"><a class="line" href="../../d0/d4c/structsimple__message__summary.html#a001b7c3c0183b1012cffd3d9498cc384"> 3578</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d4c/structsimple__message__summary.html#a001b7c3c0183b1012cffd3d9498cc384">voice_messages_new</a>;</div><div class="line"><a name="l03579"></a><span class="lineno"><a class="line" href="../../d0/d4c/structsimple__message__summary.html#af13734b83debd190c047ecaa54d0bb7d"> 3579</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d4c/structsimple__message__summary.html#af13734b83debd190c047ecaa54d0bb7d">voice_messages_old</a>;</div><div class="line"><a name="l03580"></a><span class="lineno"><a class="line" href="../../d0/d4c/structsimple__message__summary.html#ac4508933deca9dfd7e9d3f77922ded20"> 3580</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d4c/structsimple__message__summary.html#ac4508933deca9dfd7e9d3f77922ded20">voice_messages_urgent_new</a>;</div><div class="line"><a name="l03581"></a><span class="lineno"><a class="line" href="../../d0/d4c/structsimple__message__summary.html#a973a78773c52754ab9c429483ff9c84d"> 3581</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d4c/structsimple__message__summary.html#a973a78773c52754ab9c429483ff9c84d">voice_messages_urgent_old</a>;</div><div class="line"><a name="l03582"></a><span class="lineno"><a class="line" href="../../d0/d4c/structsimple__message__summary.html#abc5ed3ee3c85dccc50605477083d2e55"> 3582</a></span>&#160;   <span class="keywordtype">char</span> message_account[PJSIP_MAX_URL_SIZE];</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;};</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;</div><div class="line"><a name="l03585"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a6a2ec9c29cf673a20f527615e5acb98b"> 3585</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a6a2ec9c29cf673a20f527615e5acb98b">parse_simple_message_summary</a>(<span class="keywordtype">char</span> *body,</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d0/d4c/structsimple__message__summary.html">simple_message_summary</a> *summary)</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;{</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;   <span class="keywordtype">char</span> *line;</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;   <span class="keywordtype">char</span> *buffer;</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;   <span class="keywordtype">int</span> found_counts = 0;</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(body) || !summary) {</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;   }</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;   buffer = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(body);</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;   memset(summary, 0, <span class="keyword">sizeof</span>(*summary));</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;   <span class="keywordflow">while</span> ((line = <a class="code" href="../../d6/d90/strings_8h.html#aec9fdc621b97dd7beac3e4a225d11bb6">ast_read_line_from_buffer</a>(&amp;buffer))) {</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;      line = <a class="code" href="../../d6/d90/strings_8h.html#aa8ab574002a6eb04925efea4c2885059">ast_str_to_lower</a>(line);</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;      <span class="keywordflow">if</span> (sscanf(line, <span class="stringliteral">&quot;voice-message: %d/%d (%d/%d)&quot;</span>,</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;         &amp;summary-&gt;<a class="code" href="../../d0/d4c/structsimple__message__summary.html#a001b7c3c0183b1012cffd3d9498cc384">voice_messages_new</a>, &amp;summary-&gt;<a class="code" href="../../d0/d4c/structsimple__message__summary.html#af13734b83debd190c047ecaa54d0bb7d">voice_messages_old</a>,</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;         &amp;summary-&gt;<a class="code" href="../../d0/d4c/structsimple__message__summary.html#ac4508933deca9dfd7e9d3f77922ded20">voice_messages_urgent_new</a>, &amp;summary-&gt;<a class="code" href="../../d0/d4c/structsimple__message__summary.html#a973a78773c52754ab9c429483ff9c84d">voice_messages_urgent_old</a>)) {</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;         found_counts = 1;</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;         sscanf(line, <span class="stringliteral">&quot;message-account: %s&quot;</span>, summary-&gt;<a class="code" href="../../d0/d4c/structsimple__message__summary.html#abc5ed3ee3c85dccc50605477083d2e55">message_account</a>);</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;      }</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;   }</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;   <span class="keywordflow">return</span> !found_counts;</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;}</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;</div><div class="line"><a name="l03614"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9982efe78ddb41fc54368049fe7ecdfc"> 3614</a></span>&#160;<span class="keyword">static</span> pj_bool_t <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9982efe78ddb41fc54368049fe7ecdfc">pubsub_on_rx_mwi_notify_request</a>(pjsip_rx_data *rdata)</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;{</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *, endpoint, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d4c/structsimple__message__summary.html">simple_message_summary</a> summary;</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *endpoint_name;</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;   <span class="keywordtype">char</span> *atsign;</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;   <span class="keywordtype">char</span> *body;</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>;</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;   <span class="keywordtype">int</span> rc;</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;   endpoint = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a0dc7590db76dcdc0105abc92072d1b06">ast_pjsip_rdata_get_endpoint</a>(rdata);</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;   <span class="keywordflow">if</span> (!endpoint) {</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Incoming MWI: Endpoint not found in rdata (%p)\n&quot;</span>, rdata);</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;      rc = 404;</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;   }</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;   endpoint_name = <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint);</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Incoming MWI: Found endpoint: %s\n&quot;</span>, endpoint_name);</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(endpoint-&gt;incoming_mwi_mailbox)) {</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Incoming MWI: No incoming mailbox specified for endpoint &#39;%s&#39;\n&quot;</span>, endpoint_name);</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a>(<span class="stringliteral">&quot;PUBSUB_NO_INCOMING_MWI_MAILBOX&quot;</span>,</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;         <span class="stringliteral">&quot;Endpoint: %s&quot;</span>, endpoint_name);</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;      rc = 404;</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;   }</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;   mailbox = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(endpoint-&gt;incoming_mwi_mailbox);</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;   atsign = strchr(mailbox, <span class="charliteral">&#39;@&#39;</span>);</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;   <span class="keywordflow">if</span> (!atsign) {</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Incoming MWI: No &#39;@&#39; found in endpoint %s&#39;s incoming mailbox &#39;%s&#39;.  Can&#39;t parse context\n&quot;</span>,</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;         endpoint_name, endpoint-&gt;incoming_mwi_mailbox);</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;      rc = 404;</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;   }</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;   *atsign = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;   context = atsign + 1;</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;   body = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(rdata-&gt;msg_info.msg-&gt;body-&gt;len + 1);</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;   rdata-&gt;msg_info.msg-&gt;body-&gt;print_body(rdata-&gt;msg_info.msg-&gt;body, body,</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;      rdata-&gt;msg_info.msg-&gt;body-&gt;len + 1);</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a6a2ec9c29cf673a20f527615e5acb98b">parse_simple_message_summary</a>(body, &amp;summary) != 0) {</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Incoming MWI: Endpoint: &#39;%s&#39; There was an issue getting message info from body &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint), body);</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;      rc = 404;</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;   }</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d33/mwi_8h.html#ae7328cd8d8b2120de46b1d2afac99f18">ast_publish_mwi_state</a>(mailbox, context,</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;      summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#a001b7c3c0183b1012cffd3d9498cc384">voice_messages_new</a>, summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#af13734b83debd190c047ecaa54d0bb7d">voice_messages_old</a>)) {</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Incoming MWI: Endpoint: &#39;%s&#39; Could not publish MWI to stasis.  &quot;</span></div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;         <span class="stringliteral">&quot;Mailbox: %s Message-Account: %s Voice-Messages: %d/%d (%d/%d)\n&quot;</span>,</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;         endpoint_name, endpoint-&gt;incoming_mwi_mailbox, summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#abc5ed3ee3c85dccc50605477083d2e55">message_account</a>,</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;         summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#a001b7c3c0183b1012cffd3d9498cc384">voice_messages_new</a>, summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#af13734b83debd190c047ecaa54d0bb7d">voice_messages_old</a>,</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;         summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#ac4508933deca9dfd7e9d3f77922ded20">voice_messages_urgent_new</a>, summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#a973a78773c52754ab9c429483ff9c84d">voice_messages_urgent_old</a>);</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;      rc = 404;</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Incoming MWI: Endpoint: &#39;%s&#39; Mailbox: %s Message-Account: %s Voice-Messages: %d/%d (%d/%d)\n&quot;</span>,</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;         endpoint_name, endpoint-&gt;incoming_mwi_mailbox, summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#abc5ed3ee3c85dccc50605477083d2e55">message_account</a>,</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;         summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#a001b7c3c0183b1012cffd3d9498cc384">voice_messages_new</a>, summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#af13734b83debd190c047ecaa54d0bb7d">voice_messages_old</a>,</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;         summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#ac4508933deca9dfd7e9d3f77922ded20">voice_messages_urgent_new</a>, summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#a973a78773c52754ab9c429483ff9c84d">voice_messages_urgent_old</a>);</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a>(<span class="stringliteral">&quot;PUBSUB_INCOMING_MWI_PUBLISH&quot;</span>,</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;         <span class="stringliteral">&quot;Endpoint: %s\r\n&quot;</span></div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;         <span class="stringliteral">&quot;Mailbox: %s\r\n&quot;</span></div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;         <span class="stringliteral">&quot;MessageAccount: %s\r\n&quot;</span></div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;         <span class="stringliteral">&quot;VoiceMessagesNew: %d\r\n&quot;</span></div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;         <span class="stringliteral">&quot;VoiceMessagesOld: %d\r\n&quot;</span></div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;         <span class="stringliteral">&quot;VoiceMessagesUrgentNew: %d\r\n&quot;</span></div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;         <span class="stringliteral">&quot;VoiceMessagesUrgentOld: %d&quot;</span>,</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;            endpoint_name, endpoint-&gt;incoming_mwi_mailbox, summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#abc5ed3ee3c85dccc50605477083d2e55">message_account</a>,</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;            summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#a001b7c3c0183b1012cffd3d9498cc384">voice_messages_new</a>, summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#af13734b83debd190c047ecaa54d0bb7d">voice_messages_old</a>,</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;            summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#ac4508933deca9dfd7e9d3f77922ded20">voice_messages_urgent_new</a>, summary.<a class="code" href="../../d0/d4c/structsimple__message__summary.html#a973a78773c52754ab9c429483ff9c84d">voice_messages_urgent_old</a>);</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;      rc = 200;</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;   }</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>:</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;   pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, rc, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;   <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;}</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;</div><div class="line"><a name="l03697"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aba712df013e1be0394a2c2943a595376"> 3697</a></span>&#160;<span class="keyword">static</span> pj_bool_t <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aba712df013e1be0394a2c2943a595376">pubsub_on_rx_notify_request</a>(pjsip_rx_data *rdata)</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;{</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;   <span class="keywordflow">if</span> (rdata-&gt;msg_info.msg-&gt;body &amp;&amp;</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#ae47a39537fdf10ceba2fad9d9c380179">ast_sip_is_content_type</a>(&amp;rdata-&gt;msg_info.msg-&gt;body-&gt;content_type,</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;                        <span class="stringliteral">&quot;application&quot;</span>, <span class="stringliteral">&quot;simple-message-summary&quot;</span>)) {</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9982efe78ddb41fc54368049fe7ecdfc">pubsub_on_rx_mwi_notify_request</a>(rdata);</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;   }</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;   <span class="keywordflow">return</span> PJ_FALSE;</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;}</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;</div><div class="line"><a name="l03707"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8deba4f5b210a282252f719b1a245029"> 3707</a></span>&#160;<span class="keyword">static</span> pj_bool_t <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8deba4f5b210a282252f719b1a245029">pubsub_on_rx_request</a>(pjsip_rx_data *rdata)</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;{</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;   <span class="keywordflow">if</span> (!pjsip_method_cmp(&amp;rdata-&gt;msg_info.msg-&gt;line.req.method, pjsip_get_subscribe_method())) {</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd8fc16260b8a617c3d028b66745d5ad">pubsub_on_rx_subscribe_request</a>(rdata);</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pjsip_method_cmp(&amp;rdata-&gt;msg_info.msg-&gt;line.req.method, &amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad7c1f2dfc743e57aadd39d0be4b97e97">pjsip_publish_method</a>)) {</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4dba55f11df69f28d19d9125e3995334">pubsub_on_rx_publish_request</a>(rdata);</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pjsip_method_cmp(&amp;rdata-&gt;msg_info.msg-&gt;line.req.method, &amp;pjsip_notify_method)) {</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aba712df013e1be0394a2c2943a595376">pubsub_on_rx_notify_request</a>(rdata);</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;   }</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;   <span class="keywordflow">return</span> PJ_FALSE;</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;}</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;</div><div class="line"><a name="l03720"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad8c5bddecd1c2126c026728ca98750b0"> 3720</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad8c5bddecd1c2126c026728ca98750b0">set_state_terminated</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *sub)</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;{</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;   sub-&gt;subscription_state = PJSIP_EVSUB_STATE_TERMINATED;</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;sub-&gt;children); ++i) {</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad8c5bddecd1c2126c026728ca98750b0">set_state_terminated</a>(<a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;sub-&gt;children, i));</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;   }</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;}</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;<span class="comment"> * \brief Callback sequence for subscription terminate:</span></div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;<span class="comment"> * * Client initiated:</span></div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;<span class="comment"> *     pjproject receives SUBSCRIBE on the subscription&#39;s serializer thread</span></div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;<span class="comment"> *         calls pubsub_on_rx_refresh with dialog locked</span></div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;<span class="comment"> *             pubsub_on_rx_refresh sets TERMINATE_PENDING</span></div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;<span class="comment"> *             pushes serialized_pubsub_on_refresh_timeout</span></div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;<span class="comment"> *             returns to pjproject</span></div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;<span class="comment"> *         pjproject calls pubsub_on_evsub_state</span></div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;<span class="comment"> *             pubsub_evsub_set_state checks state == TERMINATE_IN_PROGRESS (no)</span></div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;<span class="comment"> *             ignore and return</span></div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;<span class="comment"> *         pjproject unlocks dialog</span></div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;<span class="comment"> *     serialized_pubsub_on_refresh_timeout starts (1)</span></div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;<span class="comment"> *       locks dialog</span></div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;<span class="comment"> *       checks state == TERMINATE_PENDING</span></div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;<span class="comment"> *       sets TERMINATE_IN_PROGRESS</span></div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;<span class="comment"> *       calls send_notify (2)</span></div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;<span class="comment"> *           send_notify ultimately calls pjsip_evsub_send_request</span></div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;<span class="comment"> *               pjsip_evsub_send_request calls evsub&#39;s set_state</span></div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;<span class="comment"> *                   set_state calls pubsub_evsub_set_state</span></div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;<span class="comment"> *                       pubsub_on_evsub_state checks state == TERMINATE_IN_PROGRESS</span></div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;<span class="comment"> *                       removes the subscriptions</span></div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;<span class="comment"> *                       cleans up references to evsub</span></div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;<span class="comment"> *                       sets state = TERMINATED</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;<span class="comment"> *       serialized_pubsub_on_refresh_timeout unlocks dialog</span></div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;<span class="comment"> * * Subscription timer expires:</span></div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;<span class="comment"> *     pjproject timer expires</span></div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;<span class="comment"> *         locks dialog</span></div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;<span class="comment"> *         calls pubsub_on_server_timeout</span></div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;<span class="comment"> *             pubsub_on_server_timeout checks state == NORMAL</span></div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;<span class="comment"> *             sets TERMINATE_PENDING</span></div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;<span class="comment"> *             pushes serialized_pubsub_on_refresh_timeout</span></div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;<span class="comment"> *             returns to pjproject</span></div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;<span class="comment"> *         pjproject unlocks dialog</span></div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;<span class="comment"> *     serialized_pubsub_on_refresh_timeout starts</span></div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;<span class="comment"> *         See (1) Above</span></div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;<span class="comment"> * * Transmission failure sending NOTIFY or error response from client</span></div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;<span class="comment"> *     pjproject transaction timer expires or non OK response</span></div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;<span class="comment"> *         pjproject locks dialog</span></div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;<span class="comment"> *         calls pubsub_on_evsub_state with event TSX_STATE</span></div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;<span class="comment"> *             pubsub_on_evsub_state checks event == TSX_STATE</span></div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;<span class="comment"> *             removes the subscriptions</span></div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;<span class="comment"> *             cleans up references to evsub</span></div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;<span class="comment"> *             sets state = TERMINATED</span></div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;<span class="comment"> *         pjproject unlocks dialog</span></div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;<span class="comment"> * * ast_sip_subscription_notify is called</span></div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;<span class="comment"> *       checks state == NORMAL</span></div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;<span class="comment"> *       if not batched...</span></div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;<span class="comment"> *           sets TERMINATE_IN_PROGRESS (if terminate is requested)</span></div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;<span class="comment"> *           calls send_notify</span></div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;<span class="comment"> *               See (2) Above</span></div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;<span class="comment"> *       if batched...</span></div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;<span class="comment"> *           sets TERMINATE_PENDING</span></div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;<span class="comment"> *           schedules task</span></div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;<span class="comment"> *       scheduler runs sched_task</span></div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;<span class="comment"> *           sched_task pushes serialized_send_notify</span></div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;<span class="comment"> *       serialized_send_notify starts</span></div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;<span class="comment"> *           checks state &lt;= TERMINATE_PENDING</span></div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;<span class="comment"> *           if state == TERMINATE_PENDING set state = TERMINATE_IN_PROGRESS</span></div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;<span class="comment"> *           call send_notify</span></div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;<span class="comment"> *               See (2) Above</span></div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;<span class="comment"> * \brief PJSIP callback when underlying SIP subscription changes state</span></div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;<span class="comment"> * Although this function is called for every state change, we only care</span></div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;<span class="comment"> * about the TERMINATED state, and only when we&#39;re actually processing the final</span></div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;<span class="comment"> * notify (SIP_SUB_TREE_TERMINATE_IN_PROGRESS) OR when a transmission failure</span></div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;<span class="comment"> * occurs (PJSIP_EVENT_TSX_STATE).  In this case, we do all the subscription tree</span></div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;<span class="comment"> * cleanup tasks and decrement the evsub reference.</span></div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03807"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9edd9dcca7f3caf9af7a4af20ab64868"> 3807</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9edd9dcca7f3caf9af7a4af20ab64868">pubsub_on_evsub_state</a>(pjsip_evsub *evsub, pjsip_event *<a class="code" href="../../df/d7d/structevent.html">event</a>)</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;{</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree =</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;      pjsip_evsub_get_mod_data(evsub, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id);</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;evsub %p state %s event %s sub_tree %p sub_tree state %s\n&quot;</span>, evsub,</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;      pjsip_evsub_get_state_name(evsub), pjsip_event_str(event-&gt;type), sub_tree,</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;      (sub_tree ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a6ba01bbffb64da676cd5176bb1d918b9">sub_tree_state_description</a>[sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a>] : <span class="stringliteral">&quot;UNKNOWN&quot;</span>));</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;   <span class="keywordflow">if</span> (!sub_tree || pjsip_evsub_get_state(evsub) != PJSIP_EVSUB_STATE_TERMINATED) {</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;   }</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;   <span class="comment">/* It&#39;s easier to write this as what we WANT to process, then negate it. */</span></div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;   <span class="keywordflow">if</span> (!(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> == <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af9b5de443ecb1dc5781aff2a03502ca5">SIP_SUB_TREE_TERMINATE_IN_PROGRESS</a></div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;      || (event-&gt;type == PJSIP_EVENT_TSX_STATE &amp;&amp; sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> == <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af7fea613b9dafd6f664eea50435fea4e">SIP_SUB_TREE_NORMAL</a>)</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;      )) {</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Do nothing.\n&quot;</span>);</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;   }</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a>) {</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;      <span class="keywordtype">char</span> task_name[256];</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;      <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga78b7691fb1bf1717a7961a68ceed5886">ast_sip_sched_task_get_name</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a>, task_name, <span class="keyword">sizeof</span>(task_name));</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Cancelling timer: %s\n&quot;</span>, task_name);</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;      <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga74acadc4e87ea1cea9cdddba4734bccc">ast_sip_sched_task_cancel</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a>);</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a>);</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;   }</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a55772a6ad10b532f9ae2085ceb0c3942">remove_subscription</a>(sub_tree);</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;   pjsip_evsub_set_mod_data(evsub, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;<span class="preprocessor">#ifdef HAVE_PJSIP_EVSUB_GRP_LOCK</span></div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;   pjsip_evsub_dec_ref(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>);</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;   <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga86c62fe22e3b7fb409c13ec7fd4fee2d">ast_sip_dialog_set_serializer</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;   <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga6d8415024c851216fa63fbb94d0aadcf">ast_sip_dialog_set_endpoint</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aace626897b8057471bc8f06b3e91e16c">subscription_persistence_remove</a>(sub_tree);</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a52b5a301995d607923de2caddcdcdb62">shutdown_subscriptions</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>);</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a68663ef66af50c315fec11f61bc226ab">SIP_SUB_TREE_TERMINATED</a>;</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;   <span class="comment">/* Remove evsub&#39;s reference to the sub_tree */</span></div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;}</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;</div><div class="line"><a name="l03859"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31b603dda9cf0a3354575494f0d4f9f9"> 3859</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31b603dda9cf0a3354575494f0d4f9f9">pubsub_on_refresh_timeout</a>(<span class="keywordtype">void</span> *userdata)</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;{</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree = userdata;</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;   pjsip_dialog *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a> = sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>;</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;sub_tree %p sub_tree state %s\n&quot;</span>, sub_tree,</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;      (sub_tree ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a6ba01bbffb64da676cd5176bb1d918b9">sub_tree_state_description</a>[sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a>] : <span class="stringliteral">&quot;UNKNOWN&quot;</span>));</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;   pjsip_dlg_inc_lock(dlg);</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> &gt;= <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af9b5de443ecb1dc5781aff2a03502ca5">SIP_SUB_TREE_TERMINATE_IN_PROGRESS</a>) {</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;      pjsip_dlg_dec_lock(dlg);</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;   }</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> == <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a5ffbdb3ef21db1d83c5a508f5e3865ae">SIP_SUB_TREE_TERMINATE_PENDING</a>) {</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af9b5de443ecb1dc5781aff2a03502ca5">SIP_SUB_TREE_TERMINATE_IN_PROGRESS</a>;</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad8c5bddecd1c2126c026728ca98750b0">set_state_terminated</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>);</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;   }</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8b3391cb48972f432118c4ca2eeb3063">send_notify</a>(sub_tree, 1);</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;subscription_state == PJSIP_EVSUB_STATE_TERMINATED ?</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;            <span class="stringliteral">&quot;SUBSCRIPTION_TERMINATED&quot;</span> : <span class="stringliteral">&quot;SUBSCRIPTION_REFRESHED&quot;</span>,</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;            <span class="stringliteral">&quot;Resource: %s&quot;</span>, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource);</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;   pjsip_dlg_dec_lock(dlg);</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;}</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;</div><div class="line"><a name="l03889"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3bfb18b697fd27c2c465c9d7182e9d82"> 3889</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3bfb18b697fd27c2c465c9d7182e9d82">serialized_pubsub_on_refresh_timeout</a>(<span class="keywordtype">void</span> *userdata)</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;{</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree = userdata;</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;sub_tree %p sub_tree state %s\n&quot;</span>, sub_tree,</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;      (sub_tree ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a6ba01bbffb64da676cd5176bb1d918b9">sub_tree_state_description</a>[sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a>] : <span class="stringliteral">&quot;UNKNOWN&quot;</span>));</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31b603dda9cf0a3354575494f0d4f9f9">pubsub_on_refresh_timeout</a>(userdata);</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree);</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;}</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;<span class="comment"> * \brief Called whenever an in-dialog SUBSCRIBE is received</span></div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;<span class="comment"> * This includes both SUBSCRIBE requests that actually refresh the subscription</span></div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;<span class="comment"> * as well as SUBSCRIBE requests that end the subscription.</span></div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;<span class="comment"> * In either case we push serialized_pubsub_on_refresh_timeout to send an</span></div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;<span class="comment"> * appropriate NOTIFY request.</span></div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03911"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8f6a1ab8c6d5f63fbcc96ea70e0160cf"> 3911</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8f6a1ab8c6d5f63fbcc96ea70e0160cf">pubsub_on_rx_refresh</a>(pjsip_evsub *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, pjsip_rx_data *rdata,</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;      <span class="keywordtype">int</span> *p_st_code, pj_str_t **p_st_text, pjsip_hdr *res_hdr, pjsip_msg_body **p_body)</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;{</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree;</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;   sub_tree = pjsip_evsub_get_mod_data(evsub, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id);</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;evsub %p sub_tree %p sub_tree state %s\n&quot;</span>, evsub, sub_tree,</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;      (sub_tree ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a6ba01bbffb64da676cd5176bb1d918b9">sub_tree_state_description</a>[sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a>] : <span class="stringliteral">&quot;UNKNOWN&quot;</span>));</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;   <span class="keywordflow">if</span> (!sub_tree || sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> != <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af7fea613b9dafd6f664eea50435fea4e">SIP_SUB_TREE_NORMAL</a>) {</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;   }</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;</div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a>) {</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;      <span class="keywordtype">char</span> task_name[256];</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;      <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga78b7691fb1bf1717a7961a68ceed5886">ast_sip_sched_task_get_name</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a>, task_name, <span class="keyword">sizeof</span>(task_name));</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Cancelling timer: %s\n&quot;</span>, task_name);</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;      <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga74acadc4e87ea1cea9cdddba4734bccc">ast_sip_sched_task_cancel</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a>);</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a>);</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">expiration_task</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;   }</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;   <span class="comment">/* PJSIP will set the evsub&#39;s state to terminated before calling into this function</span></div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;<span class="comment">    * if the Expires value of the incoming SUBSCRIBE is 0.</span></div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;</div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;   <span class="keywordflow">if</span> (pjsip_evsub_get_state(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>) == PJSIP_EVSUB_STATE_TERMINATED) {</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a5ffbdb3ef21db1d83c5a508f5e3865ae">SIP_SUB_TREE_TERMINATE_PENDING</a>;</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;   }</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab37c67d3e45723f0b0aaf21dd9e2d605">subscription_persistence_update</a>(sub_tree, rdata, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400ac38cc588801abf190a87dc6c4220b240">SUBSCRIPTION_PERSISTENCE_REFRESHED</a>);</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3bfb18b697fd27c2c465c9d7182e9d82">serialized_pubsub_on_refresh_timeout</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(sub_tree))) {</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;      <span class="comment">/* If we can&#39;t push the NOTIFY refreshing task...we&#39;ll just go with it. */</span></div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to push task to send NOTIFY.\n&quot;</span>);</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af7fea613b9dafd6f664eea50435fea4e">SIP_SUB_TREE_NORMAL</a>;</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub_tree, -1);</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;   }</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9e1f9ef9caffc6fcf306dbf678ecc747">is_list</a>) {</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;      pj_list_insert_before(res_hdr, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad353ed8aab9f1e54ccf8d2e89a96bcac">create_require_eventlist</a>(rdata-&gt;tp_info.pool));</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;   }</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;}</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;</div><div class="line"><a name="l03956"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac9f60cf5b4683fabadff63143ef959f2"> 3956</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac9f60cf5b4683fabadff63143ef959f2">pubsub_on_rx_notify</a>(pjsip_evsub *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, pjsip_rx_data *rdata, <span class="keywordtype">int</span> *p_st_code,</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;      pj_str_t **p_st_text, pjsip_hdr *res_hdr, pjsip_msg_body **p_body)</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;{</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;   <span class="keywordflow">if</span> (!(sub = pjsip_evsub_get_mod_data(evsub, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id))) {</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;   }</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;   sub-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aa63e03b2552c36d21f2bb7bffd26a06a">subscriber</a>-&gt;<a class="code" href="../../db/dd4/structast__sip__subscriber.html#a6cd23572cbfc2d0302ac6929a18a975b">state_change</a>(sub, rdata-&gt;msg_info.msg-&gt;body,</div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;         pjsip_evsub_get_state(evsub));</div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;}</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;</div><div class="line"><a name="l03969"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a45317a8f9762fa3b934c723df1367336"> 3969</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a45317a8f9762fa3b934c723df1367336">serialized_pubsub_on_client_refresh</a>(<span class="keywordtype">void</span> *userdata)</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;{</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree = userdata;</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;   pjsip_tx_data *tdata;</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;   <span class="keywordflow">if</span> (!sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>) {</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree);</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;   }</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;   <span class="keywordflow">if</span> (pjsip_evsub_initiate(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -1, &amp;tdata) == PJ_SUCCESS) {</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;      pjsip_evsub_send_request(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, tdata);</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;      pjsip_evsub_terminate(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>, PJ_TRUE);</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;   }</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree);</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;}</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;</div><div class="line"><a name="l03989"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a26689d72ab3ff9ce0e56c26fdc6dfd4b"> 3989</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a26689d72ab3ff9ce0e56c26fdc6dfd4b">pubsub_on_client_refresh</a>(pjsip_evsub *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>)</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;{</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree;</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;   <span class="keywordflow">if</span> (!(sub_tree = pjsip_evsub_get_mod_data(evsub, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id))) {</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;   }</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a45317a8f9762fa3b934c723df1367336">serialized_pubsub_on_client_refresh</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(sub_tree))) {</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree);</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;   }</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;}</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;</div><div class="line"><a name="l04002"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3815d56063e28c51b863c26e6b3a49c9"> 4002</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3815d56063e28c51b863c26e6b3a49c9">pubsub_on_server_timeout</a>(pjsip_evsub *<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">evsub</a>)</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;{</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree;</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;   <span class="comment">/* PJSIP does not terminate the server timeout timer when a SUBSCRIBE</span></div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;<span class="comment">    * with Expires: 0 arrives to end a subscription, nor does it terminate</span></div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;<span class="comment">    * this timer when we send a NOTIFY request in response to receiving such</span></div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;<span class="comment">    * a SUBSCRIBE. PJSIP does not stop the server timeout timer until the</span></div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;<span class="comment">    * NOTIFY transaction has finished (either through receiving a response</span></div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;<span class="comment">    * or through a transaction timeout).</span></div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;<span class="comment">    * Therefore, it is possible that we can be told that a server timeout</span></div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;<span class="comment">    * occurred after we already thought that the subscription had been</span></div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;<span class="comment">    * terminated. In such a case, we will have already removed the sub_tree</span></div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;<span class="comment">    * from the evsub&#39;s mod_data array.</span></div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;   sub_tree = pjsip_evsub_get_mod_data(evsub, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>.id);</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;   <span class="keywordflow">if</span> (!sub_tree || sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> != <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af7fea613b9dafd6f664eea50435fea4e">SIP_SUB_TREE_NORMAL</a>) {</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;   }</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;   sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a5ffbdb3ef21db1d83c5a508f5e3865ae">SIP_SUB_TREE_TERMINATE_PENDING</a>;</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3bfb18b697fd27c2c465c9d7182e9d82">serialized_pubsub_on_refresh_timeout</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(sub_tree))) {</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">state</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af7fea613b9dafd6f664eea50435fea4e">SIP_SUB_TREE_NORMAL</a>;</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub_tree);</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;   }</div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;}</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;</div><div class="line"><a name="l04031"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a98dd8da033568491b0241453b2cf34a2"> 4031</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a98dd8da033568491b0241453b2cf34a2">ami_subscription_detail</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree,</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;               <span class="keyword">struct</span> <a class="code" href="../../d4/d2f/structast__sip__ami.html">ast_sip_ami</a> *ami,</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;               <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/d7d/structevent.html">event</a>)</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;{</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>;</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;   buf = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5b63b1eceb879f2cf0e23f356040737a">ast_sip_create_ami_event</a>(event, ami);</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;   <span class="keywordflow">if</span> (!buf) {</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;   }</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae0461ac441d662c000ef9408ab9dd01c">sip_subscription_to_ami</a>(sub_tree, &amp;buf);</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(ami-&gt;<a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a>, <span class="stringliteral">&quot;%s\r\n&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(buf));</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(buf);</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;   ++ami-&gt;<a class="code" href="../../d4/d2f/structast__sip__ami.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;}</div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;</div><div class="line"><a name="l04050"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9321a33ad3bd557f07e777bcdd6afb79"> 4050</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9321a33ad3bd557f07e777bcdd6afb79">ami_subscription_detail_inbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;{</div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;   <span class="keywordflow">return</span> sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a> == <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20ab72ff83a6adb7eae0bf918c8e3f5cf49">AST_SIP_NOTIFIER</a> ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a98dd8da033568491b0241453b2cf34a2">ami_subscription_detail</a>(</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;      sub_tree, arg, <span class="stringliteral">&quot;InboundSubscriptionDetail&quot;</span>) : 0;</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;}</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;</div><div class="line"><a name="l04056"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#add921b3c03175e428a304fbd820c584a"> 4056</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#add921b3c03175e428a304fbd820c584a">ami_subscription_detail_outbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;{</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;   <span class="keywordflow">return</span> sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a> == <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20a3c10d5621e8e7278503d4ea4c13cedc1">AST_SIP_SUBSCRIBER</a> ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a98dd8da033568491b0241453b2cf34a2">ami_subscription_detail</a>(</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;      sub_tree, arg, <span class="stringliteral">&quot;OutboundSubscriptionDetail&quot;</span>) : 0;</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;}</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;</div><div class="line"><a name="l04062"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a675152b3c3f0536dbb1f624fc840fba1"> 4062</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a675152b3c3f0536dbb1f624fc840fba1">ami_show_subscriptions_inbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;{</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d2f/structast__sip__ami.html">ast_sip_ami</a> ami = { .<a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a> = <a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a>, .m = <a class="code" href="../../d4/d2f/structast__sip__ami.html#ac0506a88d121327118c7346baa303a9e">m</a>, .action_id = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>), };</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a>(s, m, <span class="stringliteral">&quot;Following are Events for each inbound Subscription&quot;</span>,</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;      <span class="stringliteral">&quot;start&quot;</span>);</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac952acea83472c9c285fe203a5b62ce3">for_each_subscription</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9321a33ad3bd557f07e777bcdd6afb79">ami_subscription_detail_inbound</a>, &amp;ami);</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a>(s, m, <span class="stringliteral">&quot;InboundSubscriptionDetailComplete&quot;</span>, ami.<a class="code" href="../../d4/d2f/structast__sip__ami.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>);</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a>(s);</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;}</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;</div><div class="line"><a name="l04076"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a53732c2137fa94234dd28ed05de1a282"> 4076</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a53732c2137fa94234dd28ed05de1a282">ami_show_subscriptions_outbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *<a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *<a class="code" href="../../d4/d2f/structast__sip__ami.html#ac0506a88d121327118c7346baa303a9e">m</a>)</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;{</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d2f/structast__sip__ami.html">ast_sip_ami</a> ami = { .<a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a> = <a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a>, .m = <a class="code" href="../../d4/d2f/structast__sip__ami.html#ac0506a88d121327118c7346baa303a9e">m</a>, .action_id = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>), };</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a>(s, m, <span class="stringliteral">&quot;Following are Events for each outbound Subscription&quot;</span>,</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;      <span class="stringliteral">&quot;start&quot;</span>);</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac952acea83472c9c285fe203a5b62ce3">for_each_subscription</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#add921b3c03175e428a304fbd820c584a">ami_subscription_detail_outbound</a>, &amp;ami);</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a>(s, m, <span class="stringliteral">&quot;OutboundSubscriptionDetailComplete&quot;</span>, ami.<a class="code" href="../../d4/d2f/structast__sip__ami.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>);</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a>(s);</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;}</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;</div><div class="line"><a name="l04090"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4cf48fac09e3299c24b6f72f438c421f"> 4090</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4cf48fac09e3299c24b6f72f438c421f">format_ami_resource_lists</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *<a class="code" href="../../d4/d2f/structast__sip__ami.html#a9ce2ec4812a92cb6ab39f6e81e9173a9">arg</a>, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;{</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list = obj;</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d2f/structast__sip__ami.html">ast_sip_ami</a> *ami = <a class="code" href="../../d4/d2f/structast__sip__ami.html#a9ce2ec4812a92cb6ab39f6e81e9173a9">arg</a>;</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>;</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;   buf = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5b63b1eceb879f2cf0e23f356040737a">ast_sip_create_ami_event</a>(<span class="stringliteral">&quot;ResourceListDetail&quot;</span>, ami);</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;   <span class="keywordflow">if</span> (!buf) {</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>;</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;   }</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#ab105b4d8cca635ce7aeed34c4543ab54">ast_sip_sorcery_object_to_ami</a>(list, &amp;buf)) {</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(buf);</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>;</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;   }</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(ami-&gt;<a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a>, <span class="stringliteral">&quot;%s\r\n&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(buf));</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(buf);</div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;   ++ami-&gt;<a class="code" href="../../d4/d2f/structast__sip__ami.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;}</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;</div><div class="line"><a name="l04112"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a22c56a35e1b346bd629dd4caf6a52f03"> 4112</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a22c56a35e1b346bd629dd4caf6a52f03">ami_show_resource_lists</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;{</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d2f/structast__sip__ami.html">ast_sip_ami</a> ami = { .<a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a> = <a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a>, .m = <a class="code" href="../../d4/d2f/structast__sip__ami.html#ac0506a88d121327118c7346baa303a9e">m</a>, .action_id = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>), };</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *lists;</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;   lists = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;resource_list&quot;</span>,</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a> | <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;   <span class="keywordflow">if</span> (!lists || !<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(lists)) {</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No resource lists found\n&quot;</span>);</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;   }</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a>(s, m, <span class="stringliteral">&quot;A listing of resource lists follows, presented as ResourceListDetail events&quot;</span>,</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;      <span class="stringliteral">&quot;start&quot;</span>);</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(lists, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4cf48fac09e3299c24b6f72f438c421f">format_ami_resource_lists</a>, &amp;ami);</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a>(s, m, <span class="stringliteral">&quot;ResourceListDetailComplete&quot;</span>, ami.<a class="code" href="../../d4/d2f/structast__sip__ami.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>);</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a>(s);</div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;}</div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;</div><div class="line"><a name="l04135"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a703b9f7d4c89444b70c00353c864765c"> 4135</a></span>&#160;<span class="preprocessor">#define AMI_SHOW_SUBSCRIPTIONS_INBOUND &quot;PJSIPShowSubscriptionsInbound&quot;</span></div><div class="line"><a name="l04136"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a75e6251ec7546725dcb5cc72bf6b60ce"> 4136</a></span>&#160;<span class="preprocessor">#define AMI_SHOW_SUBSCRIPTIONS_OUTBOUND &quot;PJSIPShowSubscriptionsOutbound&quot;</span></div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;</div><div class="line"><a name="l04138"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a46e524af59f26e0f0825b21acf9ea886"> 4138</a></span>&#160;<span class="preprocessor">#define MAX_REGEX_ERROR_LEN 128</span></div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;</div><div class="line"><a name="l04140"></a><span class="lineno"><a class="line" href="../../dc/d55/structcli__sub__parms.html"> 4140</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../dc/d55/structcli__sub__parms.html">cli_sub_parms</a> {<span class="comment"></span></div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;<span class="comment">   /*! CLI handler entry e parameter */</span></div><div class="line"><a name="l04142"></a><span class="lineno"><a class="line" href="../../dc/d55/structcli__sub__parms.html#a883e4c7acb41c38b2fc01a0d80ed83ec"> 4142</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *<a class="code" href="../../dc/d55/structcli__sub__parms.html#a883e4c7acb41c38b2fc01a0d80ed83ec">e</a>;<span class="comment"></span></div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;<span class="comment">   /*! CLI handler entry a parameter */</span></div><div class="line"><a name="l04144"></a><span class="lineno"><a class="line" href="../../dc/d55/structcli__sub__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f"> 4144</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../dc/d55/structcli__sub__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a>;<span class="comment"></span></div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;<span class="comment">   /*! CLI subscription entry output line(s) */</span></div><div class="line"><a name="l04146"></a><span class="lineno"><a class="line" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e"> 4146</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>;<span class="comment"></span></div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;<span class="comment">   /*! Compiled regular expression to select if buf is written to CLI when not NULL. */</span></div><div class="line"><a name="l04148"></a><span class="lineno"><a class="line" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5"> 4148</a></span>&#160;   regex_t *<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>;</div><div class="line"><a name="l04149"></a><span class="lineno"><a class="line" href="../../dc/d55/structcli__sub__parms.html#ad43c3812e6d13e0518d9f8b8f463ffcf"> 4149</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dc/d55/structcli__sub__parms.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;};</div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;</div><div class="line"><a name="l04152"></a><span class="lineno"><a class="line" href="../../d7/df6/structcli__sub__complete__parms.html"> 4152</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d7/df6/structcli__sub__complete__parms.html">cli_sub_complete_parms</a> {</div><div class="line"><a name="l04153"></a><span class="lineno"><a class="line" href="../../d7/df6/structcli__sub__complete__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f"> 4153</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a>;<span class="comment"></span></div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;<span class="comment">   /*! Found callid for search position */</span></div><div class="line"><a name="l04155"></a><span class="lineno"><a class="line" href="../../d7/df6/structcli__sub__complete__parms.html#af86c4ab2ba7f7fd632482bb08625be1a"> 4155</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#af86c4ab2ba7f7fd632482bb08625be1a">callid</a>;</div><div class="line"><a name="l04156"></a><span class="lineno"><a class="line" href="../../d7/df6/structcli__sub__complete__parms.html#af5adbe0a37846b3aacae6d358a1e57aa"> 4156</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#af5adbe0a37846b3aacae6d358a1e57aa">wordlen</a>;</div><div class="line"><a name="l04157"></a><span class="lineno"><a class="line" href="../../d7/df6/structcli__sub__complete__parms.html#aa2a4dae2a14de4093826005f9bdfd3bb"> 4157</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#aa2a4dae2a14de4093826005f9bdfd3bb">which</a>;</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;};</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;</div><div class="line"><a name="l04160"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a1659843ab11cf04649f5a03657943bb8"> 4160</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a1659843ab11cf04649f5a03657943bb8">cli_complete_subscription_common</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keyword">struct</span> <a class="code" href="../../d7/df6/structcli__sub__complete__parms.html">cli_sub_complete_parms</a> *<a class="code" href="../../de/d52/codec__dahdi_8c.html#ab04b09a194737700c43608ca6de2d1c9">cli</a>)</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;{</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;   pj_str_t *callid;</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;   <span class="keywordflow">if</span> (!sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>) {</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;   }</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;   callid = &amp;sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;call_id-&gt;id;</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;   <span class="keywordflow">if</span> (cli-&gt;<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#af5adbe0a37846b3aacae6d358a1e57aa">wordlen</a> &lt;= pj_strlen(callid)</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;      &amp;&amp; !strncasecmp(cli-&gt;<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a>-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, pj_strbuf(callid), cli-&gt;<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#af5adbe0a37846b3aacae6d358a1e57aa">wordlen</a>)</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;      &amp;&amp; (++cli-&gt;<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#aa2a4dae2a14de4093826005f9bdfd3bb">which</a> &gt; cli-&gt;<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a>-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>)) {</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;      cli-&gt;<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#af86c4ab2ba7f7fd632482bb08625be1a">callid</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(pj_strlen(callid) + 1);</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;      <span class="keywordflow">if</span> (cli-&gt;<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#af86c4ab2ba7f7fd632482bb08625be1a">callid</a>) {</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;         <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(cli-&gt;<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#af86c4ab2ba7f7fd632482bb08625be1a">callid</a>, callid, pj_strlen(callid) + 1);</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;      }</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;   }</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;}</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;</div><div class="line"><a name="l04181"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aebb94c33681f975e62c71f1e970f7dae"> 4181</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aebb94c33681f975e62c71f1e970f7dae">cli_complete_subscription_inbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;{</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;   <span class="keywordflow">return</span> sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a> == <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20ab72ff83a6adb7eae0bf918c8e3f5cf49">AST_SIP_NOTIFIER</a></div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;      ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a1659843ab11cf04649f5a03657943bb8">cli_complete_subscription_common</a>(sub_tree, arg) : 0;</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;}</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;</div><div class="line"><a name="l04187"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3ba86604727a1f14973496013df1884e"> 4187</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3ba86604727a1f14973496013df1884e">cli_complete_subscription_outbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;{</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;   <span class="keywordflow">return</span> sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a> == <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20a3c10d5621e8e7278503d4ea4c13cedc1">AST_SIP_SUBSCRIBER</a></div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;      ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a1659843ab11cf04649f5a03657943bb8">cli_complete_subscription_common</a>(sub_tree, arg) : 0;</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;}</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;</div><div class="line"><a name="l04193"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a47e4246289d04b68202052414c219922"> 4193</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a47e4246289d04b68202052414c219922">cli_complete_subscription_callid</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;{</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/df6/structcli__sub__complete__parms.html">cli_sub_complete_parms</a> cli;</div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0b174b002a4e991ef8c08f17118f8cd5">on_subscription_t</a> on_subscription;</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a> != 4) {</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;   }</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], <span class="stringliteral">&quot;inbound&quot;</span>)) {</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;      on_subscription = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aebb94c33681f975e62c71f1e970f7dae">cli_complete_subscription_inbound</a>;</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], <span class="stringliteral">&quot;outbound&quot;</span>)) {</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;      on_subscription = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3ba86604727a1f14973496013df1884e">cli_complete_subscription_outbound</a>;</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;      <span class="comment">/* Should never get here */</span></div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;   }</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;   cli.<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a> = <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>;</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;   cli.<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#af86c4ab2ba7f7fd632482bb08625be1a">callid</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;   cli.<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#af5adbe0a37846b3aacae6d358a1e57aa">wordlen</a> = strlen(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>);</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;   cli.<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#aa2a4dae2a14de4093826005f9bdfd3bb">which</a> = 0;</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac952acea83472c9c285fe203a5b62ce3">for_each_subscription</a>(on_subscription, &amp;cli);</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;   <span class="keywordflow">return</span> cli.<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#af86c4ab2ba7f7fd632482bb08625be1a">callid</a>;</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;}</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;</div><div class="line"><a name="l04221"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a23418ae9f5ca7a907263b50b7dcc323d"> 4221</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a23418ae9f5ca7a907263b50b7dcc323d">cli_subscription_expiry</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree)</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;{</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;   <span class="keywordtype">int</span> expiry;</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;   expiry = sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a></div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;      ? <a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence</a>-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7814e4900b15b2edc31554bbb7b61b3e">expires</a>, <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>()) / 1000</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;      : 0;</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;   <span class="keywordflow">if</span> (expiry &lt; 0) {</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;      <span class="comment">/* Subscription expired */</span></div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;      expiry = 0;</div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;   }</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;   <span class="keywordflow">return</span> expiry;</div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;}</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;</div><div class="line"><a name="l04235"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#acf8d7453ec67a6a31fa80feffc283128"> 4235</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acf8d7453ec67a6a31fa80feffc283128">cli_show_subscription_common</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keyword">struct</span> <a class="code" href="../../dc/d55/structcli__sub__parms.html">cli_sub_parms</a> *<a class="code" href="../../de/d52/codec__dahdi_8c.html#ab04b09a194737700c43608ca6de2d1c9">cli</a>)</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;{</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/df6/structcli__sub__complete__parms.html#af86c4ab2ba7f7fd632482bb08625be1a">callid</a> = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>;<span class="comment">/* Member repurposed to pass in callid */</span></div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;   pj_str_t *sub_callid;</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>;</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;   <span class="keywordtype">char</span> *src;</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;   <span class="keywordtype">char</span> *dest;</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;   <span class="keywordtype">char</span> *key;</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;   <span class="keywordtype">char</span> *value_end;</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;   <span class="keywordtype">int</span> key_len;</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;   <span class="keywordtype">int</span> key_filler_width;</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;   <span class="keywordtype">int</span> value_len;</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;   <a class="code" href="../../dc/df2/ast__expr2f_8c.html#a33e91cd0cef6786e9e3a27ac67707207">if</a> (!sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>) {</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;   }</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;   sub_callid = &amp;sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;call_id-&gt;id;</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;   <span class="keywordflow">if</span> (pj_strcmp2(sub_callid, callid)) {</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;   }</div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;   <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a> = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(512);</div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>) {</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;   }</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a>-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>,</div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;      <span class="stringliteral">&quot;%-20s: %s\n&quot;</span></div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;      <span class="stringliteral">&quot;===========================================================================\n&quot;</span>,</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;      <span class="stringliteral">&quot;ParameterName&quot;</span>, <span class="stringliteral">&quot;ParameterValue&quot;</span>);</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, 0, <span class="stringliteral">&quot;Resource: %s\n&quot;</span>, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource);</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, 0, <span class="stringliteral">&quot;Event: %s\n&quot;</span>, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>);</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, 0, <span class="stringliteral">&quot;Expiry: %u\n&quot;</span>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a23418ae9f5ca7a907263b50b7dcc323d">cli_subscription_expiry</a>(sub_tree));</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae0461ac441d662c000ef9408ab9dd01c">sip_subscription_to_ami</a>(sub_tree, &amp;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>);</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;   <span class="comment">/* Convert AMI \r\n to \n line terminators. */</span></div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;   src = strchr(<a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>), <span class="charliteral">&#39;\r&#39;</span>);</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;   <span class="keywordflow">if</span> (src) {</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;      dest = src;</div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;      ++src;</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;      <span class="keywordflow">while</span> (*src) {</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;         <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;\r&#39;</span>) {</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;            ++src;</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;         }</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;         *dest++ = *src++;</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;      }</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;      *dest = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#aa64825674476f476402283fe4bd7ee51">ast_str_update</a>(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>);</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;   }</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;   <span class="comment">/* Reformat AMI key value pairs to pretty columns */</span></div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;   key = <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>);</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;   <span class="keywordflow">do</span> {</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;      <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> = strchr(key, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>) {</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;      }</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;      value_end = strchr(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;      <span class="keywordflow">if</span> (!value_end) {</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;      }</div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;      <span class="comment">/* Calculate field lengths */</span></div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;      key_len = <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> - key;</div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;      key_filler_width = 20 - key_len;</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;      <span class="keywordflow">if</span> (key_filler_width &lt; 0) {</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;         key_filler_width = 0;</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;      }</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;      value_len = value_end - <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a>-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%.*s%*s%.*s\n&quot;</span>,</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;         key_len, key, key_filler_width, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;         value_len, value);</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;      key = value_end + 1;</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;   } <span class="keywordflow">while</span> (*key);</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a>-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;</div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>);</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;}</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;</div><div class="line"><a name="l04322"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a66473fb602c745c3dfa226d1c47f425f"> 4322</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a66473fb602c745c3dfa226d1c47f425f">cli_show_subscription_inbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;{</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;   <span class="keywordflow">return</span> sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a> == <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20ab72ff83a6adb7eae0bf918c8e3f5cf49">AST_SIP_NOTIFIER</a></div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;      ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acf8d7453ec67a6a31fa80feffc283128">cli_show_subscription_common</a>(sub_tree, arg) : 0;</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;}</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;</div><div class="line"><a name="l04328"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a539e82113ed22c70c9f62f4d45f15b67"> 4328</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a539e82113ed22c70c9f62f4d45f15b67">cli_show_subscription_outbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;{</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;   <span class="keywordflow">return</span> sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a> == <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20a3c10d5621e8e7278503d4ea4c13cedc1">AST_SIP_SUBSCRIBER</a></div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;      ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acf8d7453ec67a6a31fa80feffc283128">cli_show_subscription_common</a>(sub_tree, arg) : 0;</div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;}</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;</div><div class="line"><a name="l04334"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad8a440b205b153f5b7fa6e0be3eb82ef"> 4334</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad8a440b205b153f5b7fa6e0be3eb82ef">cli_show_subscription_inout</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;{</div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0b174b002a4e991ef8c08f17118f8cd5">on_subscription_t</a> on_subscription;</div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d55/structcli__sub__parms.html">cli_sub_parms</a> cli;</div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;pjsip show subscription {inbound|outbound}&quot;</span>;</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = <span class="stringliteral">&quot;Usage:\n&quot;</span></div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;               <span class="stringliteral">&quot;   pjsip show subscription inbound &lt;call-id&gt;\n&quot;</span></div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;               <span class="stringliteral">&quot;   pjsip show subscription outbound &lt;call-id&gt;\n&quot;</span></div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;               <span class="stringliteral">&quot;      Show active subscription with the dialog call-id\n&quot;</span>;</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a47e4246289d04b68202052414c219922">cli_complete_subscription_callid</a>(a);</div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;   }</div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 5) {</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;   }</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], <span class="stringliteral">&quot;inbound&quot;</span>)) {</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;      on_subscription = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a66473fb602c745c3dfa226d1c47f425f">cli_show_subscription_inbound</a>;</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], <span class="stringliteral">&quot;outbound&quot;</span>)) {</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;      on_subscription = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a539e82113ed22c70c9f62f4d45f15b67">cli_show_subscription_outbound</a>;</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;      <span class="comment">/* Should never get here */</span></div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;   }</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;   <span class="comment">/* Find the subscription with the specified call-id */</span></div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;   cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a> = <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>;</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;   cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a883e4c7acb41c38b2fc01a0d80ed83ec">e</a> = <a class="code" href="../../dc/d55/structcli__sub__parms.html#a883e4c7acb41c38b2fc01a0d80ed83ec">e</a>;</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;   cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a> = (<span class="keywordtype">void</span> *) a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4];<span class="comment">/* Repurpose the buf member to pass in callid */</span></div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac952acea83472c9c285fe203a5b62ce3">for_each_subscription</a>(on_subscription, &amp;cli);</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;}</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;</div><div class="line"><a name="l04374"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2da91e964cff994ce0e57b494316b043"> 4374</a></span>&#160;<span class="preprocessor">#define CLI_SHOW_SUB_FORMAT_HEADER \</span></div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;<span class="preprocessor">   &quot;Endpoint: &lt;Endpoint/Caller-ID.............................................&gt;\n&quot; \</span></div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;<span class="preprocessor">   &quot;Resource: &lt;Resource/Event.................................................&gt;\n&quot; \</span></div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;<span class="preprocessor">   &quot;  Expiry: &lt;Expiry&gt;  &lt;Call-id..............................................&gt;\n&quot; \</span></div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;<span class="preprocessor">   &quot;===========================================================================\n\n&quot;</span></div><div class="line"><a name="l04379"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a025e1fa7b644cd3de8f0f7fe4ab42100"> 4379</a></span>&#160;<span class="preprocessor">#define CLI_SHOW_SUB_FORMAT_ENTRY  \</span></div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;<span class="preprocessor">   &quot;Endpoint: %s/%s\n&quot; \</span></div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;<span class="preprocessor">   &quot;Resource: %s/%s\n&quot; \</span></div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;<span class="preprocessor">   &quot;  Expiry: %8d  %s\n\n&quot;</span></div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;</div><div class="line"><a name="l04384"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a082c4ba2ff2ee9753efd0875b7cfaec3"> 4384</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a082c4ba2ff2ee9753efd0875b7cfaec3">cli_show_subscriptions_detail</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keyword">struct</span> <a class="code" href="../../dc/d55/structcli__sub__parms.html">cli_sub_parms</a> *<a class="code" href="../../de/d52/codec__dahdi_8c.html#ab04b09a194737700c43608ca6de2d1c9">cli</a>)</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;{</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;   <span class="keywordtype">char</span> caller_id[256];</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;   <span class="keywordtype">char</span> callid[256];</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;   <a class="code" href="../../de/d47/callerid_8h.html#a1c25633b1ed63682c95ec613d7cbe559">ast_callerid_merge</a>(caller_id, <span class="keyword">sizeof</span>(caller_id),</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50783ac9bc6f4943369ed254972049ac">id</a>.<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>,</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;         sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50783ac9bc6f4943369ed254972049ac">id</a>.<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50783ac9bc6f4943369ed254972049ac">id</a>.<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>,</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;         sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50783ac9bc6f4943369ed254972049ac">id</a>.<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;      <span class="stringliteral">&quot;&lt;none&gt;&quot;</span>);</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;   <span class="comment">/* Call-id */</span></div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>) {</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(callid, &amp;sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;call_id-&gt;id, <span class="keyword">sizeof</span>(callid));</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(callid, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>, <span class="keyword">sizeof</span>(callid));</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;   }</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>, 0, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a025e1fa7b644cd3de8f0f7fe4ab42100">CLI_SHOW_SUB_FORMAT_ENTRY</a>,</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>), caller_id,</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>,</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a23418ae9f5ca7a907263b50b7dcc323d">cli_subscription_expiry</a>(sub_tree), callid);</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;   <span class="keywordflow">if</span> (cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>) {</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;      <span class="keywordflow">if</span> (regexec(cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>), 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0)) {</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;         <span class="comment">/* Output line did not match the regex */</span></div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;      }</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;   }</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a>-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>));</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;   ++cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;}</div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;</div><div class="line"><a name="l04421"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a89f7ab75ea44a7eb7527943b70a742fc"> 4421</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a89f7ab75ea44a7eb7527943b70a742fc">cli_show_subscriptions_inbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;{</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;   <span class="keywordflow">return</span> sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a> == <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20ab72ff83a6adb7eae0bf918c8e3f5cf49">AST_SIP_NOTIFIER</a></div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;      ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a082c4ba2ff2ee9753efd0875b7cfaec3">cli_show_subscriptions_detail</a>(sub_tree, arg) : 0;</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;}</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;</div><div class="line"><a name="l04427"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a161e2b74b0b3b249c8c9e3ba8bb782ae"> 4427</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a161e2b74b0b3b249c8c9e3ba8bb782ae">cli_show_subscriptions_outbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;{</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;   <span class="keywordflow">return</span> sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a> == <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20a3c10d5621e8e7278503d4ea4c13cedc1">AST_SIP_SUBSCRIBER</a></div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;      ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a082c4ba2ff2ee9753efd0875b7cfaec3">cli_show_subscriptions_detail</a>(sub_tree, arg) : 0;</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;}</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;</div><div class="line"><a name="l04433"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad1bd467902006e27be217191f4f6c793"> 4433</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad1bd467902006e27be217191f4f6c793">cli_show_subscriptions_inout</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *<a class="code" href="../../dc/d55/structcli__sub__parms.html#a883e4c7acb41c38b2fc01a0d80ed83ec">e</a>, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;{</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0b174b002a4e991ef8c08f17118f8cd5">on_subscription_t</a> on_subscription;</div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d55/structcli__sub__parms.html">cli_sub_parms</a> cli;</div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;   regex_t <a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>;</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d9/d1e/func__strings_8c.html#a1b62eb9e3ebf087509f4301aa6336931">regex</a>;</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;pjsip show subscriptions {inbound|outbound} [like]&quot;</span>;</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = <span class="stringliteral">&quot;Usage:\n&quot;</span></div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;               <span class="stringliteral">&quot;   pjsip show subscriptions inbound [like &lt;regex&gt;]\n&quot;</span></div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;               <span class="stringliteral">&quot;      Show active inbound subscriptions\n&quot;</span></div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;               <span class="stringliteral">&quot;   pjsip show subscriptions outbound [like &lt;regex&gt;]\n&quot;</span></div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;               <span class="stringliteral">&quot;      Show active outbound subscriptions\n&quot;</span></div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;               <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;               <span class="stringliteral">&quot;   The regex selects a subscriptions output that matches.\n&quot;</span></div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;               <span class="stringliteral">&quot;   i.e.,  All output lines for a subscription are checked\n&quot;</span></div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;               <span class="stringliteral">&quot;   as a block by the regex.\n&quot;</span>;</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;   }</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 4 &amp;&amp; a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 6) {</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;   }</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], <span class="stringliteral">&quot;inbound&quot;</span>)) {</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;      on_subscription = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a89f7ab75ea44a7eb7527943b70a742fc">cli_show_subscriptions_inbound</a>;</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], <span class="stringliteral">&quot;outbound&quot;</span>)) {</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;      on_subscription = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a161e2b74b0b3b249c8c9e3ba8bb782ae">cli_show_subscriptions_outbound</a>;</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;      <span class="comment">/* Should never get here */</span></div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;   }</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 6) {</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;      <span class="keywordtype">int</span> rc;</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;</div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;      <span class="keywordflow">if</span> (strcasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4], <span class="stringliteral">&quot;like&quot;</span>)) {</div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;      }</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;      <span class="comment">/* Setup regular expression */</span></div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;      memset(&amp;like, 0, <span class="keyword">sizeof</span>(like));</div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;      cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a> = &amp;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>;</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;      regex = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[5];</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;      rc = regcomp(cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>, regex, REG_EXTENDED | REG_NOSUB);</div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;      <span class="keywordflow">if</span> (rc) {</div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;         <span class="keywordtype">char</span> *regerr = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a46e524af59f26e0f0825b21acf9ea886">MAX_REGEX_ERROR_LEN</a>);</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;         regerror(rc, cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>, regerr, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a46e524af59f26e0f0825b21acf9ea886">MAX_REGEX_ERROR_LEN</a>);</div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Regular expression &#39;%s&#39; failed to compile: %s\n&quot;</span>,</div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;            regex, regerr);</div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;      }</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;      cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;      regex = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;   }</div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;   cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a> = <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>;</div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;   cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a883e4c7acb41c38b2fc01a0d80ed83ec">e</a> = <a class="code" href="../../dc/d55/structcli__sub__parms.html#a883e4c7acb41c38b2fc01a0d80ed83ec">e</a>;</div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;   cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0;</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;   cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a> = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(256);</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;   <span class="keywordflow">if</span> (!cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>) {</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;      <span class="keywordflow">if</span> (cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>) {</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;         regfree(cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>);</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;      }</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;   }</div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;</div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2da91e964cff994ce0e57b494316b043">CLI_SHOW_SUB_FORMAT_HEADER</a>);</div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac952acea83472c9c285fe203a5b62ce3">for_each_subscription</a>(on_subscription, &amp;cli);</div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%d active subscriptions%s%s%s\n&quot;</span>,</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;      cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>,</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;      regex ? <span class="stringliteral">&quot; matched \&quot;&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;      regex ?: <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;      regex ? <span class="stringliteral">&quot;\&quot;&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>);</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;   <span class="keywordflow">if</span> (cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>) {</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;      regfree(cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>);</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;   }</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;}</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;</div><div class="line"><a name="l04521"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#abed51420cb87ea551279a07f2c502a37"> 4521</a></span>&#160;<span class="preprocessor">#define CLI_LIST_SUB_FORMAT_HEADER &quot;%-30.30s %-30.30s %6.6s %s\n&quot;</span></div><div class="line"><a name="l04522"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae0e71457156b5ee3447f3a7bd2877e28"> 4522</a></span>&#160;<span class="preprocessor">#define CLI_LIST_SUB_FORMAT_ENTRY  &quot;%-30.30s %-30.30s %6d %s\n&quot;</span></div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;</div><div class="line"><a name="l04524"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4732f846f9b6cda02dea380f561ea76a"> 4524</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4732f846f9b6cda02dea380f561ea76a">cli_list_subscriptions_detail</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keyword">struct</span> <a class="code" href="../../dc/d55/structcli__sub__parms.html">cli_sub_parms</a> *<a class="code" href="../../de/d52/codec__dahdi_8c.html#ab04b09a194737700c43608ca6de2d1c9">cli</a>)</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;{</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;   <span class="keywordtype">char</span> ep_cid_buf[50];</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;   <span class="keywordtype">char</span> res_evt_buf[50];</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;   <span class="keywordtype">char</span> callid[256];</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;   <span class="comment">/* Endpoint/CID column */</span></div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;   snprintf(ep_cid_buf, <span class="keyword">sizeof</span>(ep_cid_buf), <span class="stringliteral">&quot;%s/%s&quot;</span>,</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>),</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50783ac9bc6f4943369ed254972049ac">id</a>.<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>, sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50783ac9bc6f4943369ed254972049ac">id</a>.<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>,</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50783ac9bc6f4943369ed254972049ac">id</a>.<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>,</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;            sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50783ac9bc6f4943369ed254972049ac">id</a>.<a class="code" href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">self</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <span class="stringliteral">&quot;&lt;none&gt;&quot;</span>)));</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;   <span class="comment">/* Resource/Event column */</span></div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;   snprintf(res_evt_buf, <span class="keyword">sizeof</span>(res_evt_buf), <span class="stringliteral">&quot;%s/%s&quot;</span>,</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;resource,</div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;      sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">root</a>-&gt;<a class="code" href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">handler</a>-&gt;<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a>);</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;</div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;   <span class="comment">/* Call-id column */</span></div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;   <span class="keywordflow">if</span> (sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>) {</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(callid, &amp;sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>-&gt;call_id-&gt;id, <span class="keyword">sizeof</span>(callid));</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(callid, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>, <span class="keyword">sizeof</span>(callid));</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;   }</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>, 0, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae0e71457156b5ee3447f3a7bd2877e28">CLI_LIST_SUB_FORMAT_ENTRY</a>,</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;      ep_cid_buf,</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;      res_evt_buf,</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a23418ae9f5ca7a907263b50b7dcc323d">cli_subscription_expiry</a>(sub_tree),</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;      callid);</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;   <span class="keywordflow">if</span> (cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>) {</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;      <span class="keywordflow">if</span> (regexec(cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>), 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0)) {</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;         <span class="comment">/* Output line did not match the regex */</span></div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;      }</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;   }</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;</div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a>-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>));</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;   ++cli-&gt;<a class="code" href="../../dc/d55/structcli__sub__parms.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;}</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;</div><div class="line"><a name="l04568"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#adae4f7e71c1e215af22111048af6ab93"> 4568</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#adae4f7e71c1e215af22111048af6ab93">cli_list_subscriptions_inbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;{</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;   <span class="keywordflow">return</span> sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a> == <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20ab72ff83a6adb7eae0bf918c8e3f5cf49">AST_SIP_NOTIFIER</a></div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;      ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4732f846f9b6cda02dea380f561ea76a">cli_list_subscriptions_detail</a>(sub_tree, arg) : 0;</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;}</div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;</div><div class="line"><a name="l04574"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a67b81ad8c54b40786d415a17d1fe9ff7"> 4574</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a67b81ad8c54b40786d415a17d1fe9ff7">cli_list_subscriptions_outbound</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a> *sub_tree, <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;{</div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;   <span class="keywordflow">return</span> sub_tree-&gt;<a class="code" href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">role</a> == <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20a3c10d5621e8e7278503d4ea4c13cedc1">AST_SIP_SUBSCRIBER</a></div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;      ? <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4732f846f9b6cda02dea380f561ea76a">cli_list_subscriptions_detail</a>(sub_tree, arg) : 0;</div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;}</div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;</div><div class="line"><a name="l04580"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a636cc42bbb2d876178e506f54bf1d05f"> 4580</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a636cc42bbb2d876178e506f54bf1d05f">cli_list_subscriptions_inout</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *<a class="code" href="../../dc/d55/structcli__sub__parms.html#a883e4c7acb41c38b2fc01a0d80ed83ec">e</a>, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;{</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0b174b002a4e991ef8c08f17118f8cd5">on_subscription_t</a> on_subscription;</div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d55/structcli__sub__parms.html">cli_sub_parms</a> cli;</div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;   regex_t <a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>;</div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d9/d1e/func__strings_8c.html#a1b62eb9e3ebf087509f4301aa6336931">regex</a>;</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;pjsip list subscriptions {inbound|outbound} [like]&quot;</span>;</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = <span class="stringliteral">&quot;Usage:\n&quot;</span></div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;               <span class="stringliteral">&quot;   pjsip list subscriptions inbound [like &lt;regex&gt;]\n&quot;</span></div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;               <span class="stringliteral">&quot;      List active inbound subscriptions\n&quot;</span></div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;               <span class="stringliteral">&quot;   pjsip list subscriptions outbound [like &lt;regex&gt;]\n&quot;</span></div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;               <span class="stringliteral">&quot;      List active outbound subscriptions\n&quot;</span></div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;               <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;               <span class="stringliteral">&quot;   The regex selects output lines that match.\n&quot;</span>;</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;   }</div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 4 &amp;&amp; a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 6) {</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;   }</div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], <span class="stringliteral">&quot;inbound&quot;</span>)) {</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;      on_subscription = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#adae4f7e71c1e215af22111048af6ab93">cli_list_subscriptions_inbound</a>;</div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], <span class="stringliteral">&quot;outbound&quot;</span>)) {</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;      on_subscription = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a67b81ad8c54b40786d415a17d1fe9ff7">cli_list_subscriptions_outbound</a>;</div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;      <span class="comment">/* Should never get here */</span></div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;   }</div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 6) {</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;      <span class="keywordtype">int</span> rc;</div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;</div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;      <span class="keywordflow">if</span> (strcasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4], <span class="stringliteral">&quot;like&quot;</span>)) {</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;      }</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;</div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;      <span class="comment">/* Setup regular expression */</span></div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;      memset(&amp;like, 0, <span class="keyword">sizeof</span>(like));</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;      cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a> = &amp;<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>;</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;      regex = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[5];</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;      rc = regcomp(cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>, regex, REG_EXTENDED | REG_NOSUB);</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;      <span class="keywordflow">if</span> (rc) {</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;         <span class="keywordtype">char</span> *regerr = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a46e524af59f26e0f0825b21acf9ea886">MAX_REGEX_ERROR_LEN</a>);</div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;         regerror(rc, cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>, regerr, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a46e524af59f26e0f0825b21acf9ea886">MAX_REGEX_ERROR_LEN</a>);</div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Regular expression &#39;%s&#39; failed to compile: %s\n&quot;</span>,</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;            regex, regerr);</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;      }</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;      cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;      regex = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;   }</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;</div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;   cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a> = <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>;</div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;   cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a883e4c7acb41c38b2fc01a0d80ed83ec">e</a> = <a class="code" href="../../dc/d55/structcli__sub__parms.html#a883e4c7acb41c38b2fc01a0d80ed83ec">e</a>;</div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;   cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0;</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;   cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a> = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(256);</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;   <span class="keywordflow">if</span> (!cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>) {</div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;      <span class="keywordflow">if</span> (cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>) {</div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;         regfree(cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>);</div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;      }</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;   }</div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;</div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abed51420cb87ea551279a07f2c502a37">CLI_LIST_SUB_FORMAT_HEADER</a>,</div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;      <span class="stringliteral">&quot;Endpoint/CLI&quot;</span>, <span class="stringliteral">&quot;Resource/Event&quot;</span>, <span class="stringliteral">&quot;Expiry&quot;</span>, <span class="stringliteral">&quot;Call-id&quot;</span>);</div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac952acea83472c9c285fe203a5b62ce3">for_each_subscription</a>(on_subscription, &amp;cli);</div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n%d active subscriptions%s%s%s\n&quot;</span>,</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;      cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>,</div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;      regex ? <span class="stringliteral">&quot; matched \&quot;&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;      regex ?: <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;      regex ? <span class="stringliteral">&quot;\&quot;&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">buf</a>);</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;   <span class="keywordflow">if</span> (cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>) {</div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;      regfree(cli.<a class="code" href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">like</a>);</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;   }</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;}</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;</div><div class="line"><a name="l04667"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a1959d38582b0da24d4d42766cf13ade8"> 4667</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a1959d38582b0da24d4d42766cf13ade8">cli_commands</a>[] = {</div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a636cc42bbb2d876178e506f54bf1d05f">cli_list_subscriptions_inout</a>, <span class="stringliteral">&quot;List active inbound/outbound subscriptions&quot;</span>),</div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad8a440b205b153f5b7fa6e0be3eb82ef">cli_show_subscription_inout</a>, <span class="stringliteral">&quot;Show active subscription details&quot;</span>),</div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad1bd467902006e27be217191f4f6c793">cli_show_subscriptions_inout</a>, <span class="stringliteral">&quot;Show active inbound/outbound subscriptions&quot;</span>),</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;};</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;</div><div class="line"><a name="l04673"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa312ad955e7ad6a9dff13667be04c7f7"> 4673</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa312ad955e7ad6a9dff13667be04c7f7">persistence_endpoint_str2struct</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/de0/structaco__option.html">aco_option</a> *opt, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;{</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = obj;</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;   persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;}</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;</div><div class="line"><a name="l04681"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a56c0f161f100c005d4c95b26ca3f7d7d"> 4681</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a56c0f161f100c005d4c95b26ca3f7d7d">persistence_endpoint_struct2str</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> intptr_t *<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, <span class="keywordtype">char</span> **<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>)</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;{</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = obj;</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;   *buf = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;}</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;</div><div class="line"><a name="l04689"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aac028869908c724f84c3a1cee520315c"> 4689</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aac028869908c724f84c3a1cee520315c">persistence_tag_str2struct</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/de0/structaco__option.html">aco_option</a> *opt, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;{</div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = obj;</div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;   persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;}</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;</div><div class="line"><a name="l04697"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac4305e5102dec63e8bbb9175dbab630e"> 4697</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac4305e5102dec63e8bbb9175dbab630e">persistence_tag_struct2str</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> intptr_t *<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, <span class="keywordtype">char</span> **<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>)</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;{</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = obj;</div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;   *buf = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a>);</div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;}</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;</div><div class="line"><a name="l04705"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8dcc5a2234d92546bbeeead95aa648ec"> 4705</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8dcc5a2234d92546bbeeead95aa648ec">persistence_generator_data_str2struct</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/de0/structaco__option.html">aco_option</a> *opt, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;{</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = obj;</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d96/structast__json__error.html">ast_json_error</a> error;</div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;</div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;   <span class="comment">/* We tolerate a failure of the JSON to load and instead start fresh, since this field</span></div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;<span class="comment">    * originates from the persistence code and not a user.</span></div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;   persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">generator_data</a> = <a class="code" href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;error);</div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;</div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;}</div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;</div><div class="line"><a name="l04718"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad276d9178ef9aad7e0d9ad2fbd52744d"> 4718</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad276d9178ef9aad7e0d9ad2fbd52744d">persistence_generator_data_struct2str</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> intptr_t *<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, <span class="keywordtype">char</span> **<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>)</div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;{</div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = obj;</div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;</div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;   <span class="keywordflow">if</span> (!persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">generator_data</a>) {</div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;   }</div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;</div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;   value = <a class="code" href="../../d4/d05/json_8h.html#a51a96b2baa67b671ac68a9fcaebbaeea">ast_json_dump_string</a>(persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">generator_data</a>);</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;   <span class="keywordflow">if</span> (!value) {</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;   }</div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;   *buf = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(value);</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(value);</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;</div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;}</div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;</div><div class="line"><a name="l04738"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aae837565412b034de817b534fa2a7136"> 4738</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aae837565412b034de817b534fa2a7136">persistence_expires_str2struct</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/de0/structaco__option.html">aco_option</a> *opt, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;{</div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = obj;</div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#af96aa9b71c6ef0f2f75038669d950b31">ast_get_timeval</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7814e4900b15b2edc31554bbb7b61b3e">expires</a>, <a class="code" href="../../de/df7/time_8h.html#aebf04439f206cc509472ce4b6da48a5a">ast_tv</a>(0, 0), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;}</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;</div><div class="line"><a name="l04744"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a946b1f58e8ead34101e6fc012088140a"> 4744</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a946b1f58e8ead34101e6fc012088140a">persistence_expires_struct2str</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> intptr_t *<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, <span class="keywordtype">char</span> **<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>)</div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;{</div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a> *persistence = obj;</div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;   <span class="keywordflow">return</span> (<a class="code" href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a>(buf, <span class="stringliteral">&quot;%ld&quot;</span>, persistence-&gt;<a class="code" href="../../d9/df9/structsubscription__persistence.html#a7814e4900b15b2edc31554bbb7b61b3e">expires</a>.tv_sec) &lt; 0) ? -1 : 0;</div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;}</div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;</div><div class="line"><a name="l04750"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f5d6a140ec019c5cf145f0d78a946a5"> 4750</a></span>&#160;<span class="preprocessor">#define RESOURCE_LIST_INIT_SIZE 4</span></div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;</div><div class="line"><a name="l04752"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab1dea1f3f371c8b1e033627343f74457"> 4752</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab1dea1f3f371c8b1e033627343f74457">resource_list_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;{</div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list = obj;</div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;</div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>); ++i) {</div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>((<span class="keywordtype">char</span> *) <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>, i));</div><div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;   }</div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;</div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>);</div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;}</div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;</div><div class="line"><a name="l04764"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae30488231b97f5060ccc10743e7a3a64"> 4764</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae30488231b97f5060ccc10743e7a3a64">resource_list_alloc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;{</div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list;</div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;</div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;   list = <a class="code" href="../../d8/d25/sorcery_8h.html#a4c03ccef909474831717c93679065508">ast_sorcery_generic_alloc</a>(<span class="keyword">sizeof</span>(*list), <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab1dea1f3f371c8b1e033627343f74457">resource_list_destructor</a>);</div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;   <span class="keywordflow">if</span> (!list) {</div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;   }</div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;</div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f5d6a140ec019c5cf145f0d78a946a5">RESOURCE_LIST_INIT_SIZE</a>)) {</div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(list);</div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;   }</div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;</div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;   <span class="keywordflow">return</span> list;</div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;}</div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;</div><div class="line"><a name="l04781"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#abb174e25bbf05213be145675e5e2c37f"> 4781</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abb174e25bbf05213be145675e5e2c37f">item_in_vector</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a>)</div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;{</div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;</div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>); ++i) {</div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;      <span class="keywordflow">if</span> (!strcmp(item, <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>, i))) {</div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;      }</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;   }</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;}</div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;</div><div class="line"><a name="l04794"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa1a6f87906d88cf1f915a7598309a3f0"> 4794</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa1a6f87906d88cf1f915a7598309a3f0">list_item_handler</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/de0/structaco__option.html">aco_option</a> *opt,</div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;{</div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list = obj;</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a>;</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;</div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;   <span class="keywordflow">while</span> ((item = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(<a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;items, <span class="stringliteral">&quot;,&quot;</span>)))) {</div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(item)) {</div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;      }</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;</div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abb174e25bbf05213be145675e5e2c37f">item_in_vector</a>(list, item)) {</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Ignoring duplicated list item &#39;%s&#39;\n&quot;</span>, item);</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;      }</div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;</div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;      item = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(item);</div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;      <span class="keywordflow">if</span> (!item || <a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>, item)) {</div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(item);</div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;      }</div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;   }</div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;</div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;}</div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;</div><div class="line"><a name="l04821"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa04aa9b3ab93170dc00535e2deaa5c86"> 4821</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa04aa9b3ab93170dc00535e2deaa5c86">list_item_to_str</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> intptr_t *<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, <span class="keywordtype">char</span> **<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>)</div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;{</div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list = obj;</div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(32);</div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;</div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>); ++i) {</div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;str, 0, <span class="stringliteral">&quot;%s,&quot;</span>, <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>, i));</div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;   }</div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;</div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;   <span class="comment">/* Chop off trailing comma */</span></div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a0b9c195ff2235f7670358e1e37cf6b8d">ast_str_truncate</a>(str, -1);</div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;   *buf = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str));</div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(str);</div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;}</div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;</div><div class="line"><a name="l04838"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a28ad88468ddb5b0d4e26b7406133bd8a"> 4838</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a28ad88468ddb5b0d4e26b7406133bd8a">resource_list_apply_handler</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d1/dbc/res__pjsip__phoneprov__provider_8c.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;{</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list = obj;</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#a5053da7047dfe40d67229c5dbc361f8b">event</a>)) {</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Resource list &#39;%s&#39; has no event set\n&quot;</span>,</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(list));</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;   }</div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;</div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>) == 0) {</div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Resource list &#39;%s&#39; has no list items\n&quot;</span>,</div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(list));</div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;   }</div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;</div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;}</div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;</div><div class="line"><a name="l04857"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9c45ac14fca8a0ed83e33e45856a5199"> 4857</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9c45ac14fca8a0ed83e33e45856a5199">apply_list_configuration</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d1/dbc/res__pjsip__phoneprov__provider_8c.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>)</div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;{</div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#ad1165cf9d45ed5ffa1555371be9ae770">ast_sorcery_apply_default</a>(sorcery, <span class="stringliteral">&quot;resource_list&quot;</span>, <span class="stringliteral">&quot;config&quot;</span>,</div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;         <span class="stringliteral">&quot;pjsip.conf,criteria=type=resource_list&quot;</span>);</div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d25/sorcery_8h.html#a5ee86f00f6e2240f74772d59edf0f74a">ast_sorcery_object_register</a>(sorcery, <span class="stringliteral">&quot;resource_list&quot;</span>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae30488231b97f5060ccc10743e7a3a64">resource_list_alloc</a>,</div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;            <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a28ad88468ddb5b0d4e26b7406133bd8a">resource_list_apply_handler</a>)) {</div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;   }</div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;</div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;resource_list&quot;</span>, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;         <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a0df2cc9dc9bf09ee71252c183fe64bd7">OPT_NOOP_T</a>, 0, 0);</div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;resource_list&quot;</span>, <span class="stringliteral">&quot;event&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;         <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a783aac0af1422c0e46356efd3c52d37a">OPT_CHAR_ARRAY_T</a>, 1, <a class="code" href="../../db/dfe/config__options_8h.html#a5a18d813ca848db340644212d89aac1a">CHARFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a>, <a class="code" href="../../df/d7d/structevent.html">event</a>));</div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;resource_list&quot;</span>, <span class="stringliteral">&quot;full_state&quot;</span>, <span class="stringliteral">&quot;no&quot;</span>,</div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;         <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a5cb849face8441c434d1a2f60264cedb">OPT_BOOL_T</a>, 1, <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a>, <a class="code" href="../../df/dd0/structresource__list.html#a4ec2ed8bfc8538671089fc04bb4710bb">full_state</a>));</div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;resource_list&quot;</span>, <span class="stringliteral">&quot;notification_batch_interval&quot;</span>,</div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;         <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a>, <a class="code" href="../../df/dd0/structresource__list.html#ac90516981222dda0270465a33483f2b4">notification_batch_interval</a>));</div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a720c9774873ec35bae0a0160954767e7">ast_sorcery_object_field_register_custom</a>(sorcery, <span class="stringliteral">&quot;resource_list&quot;</span>, <span class="stringliteral">&quot;list_item&quot;</span>,</div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;         <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa1a6f87906d88cf1f915a7598309a3f0">list_item_handler</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa04aa9b3ab93170dc00535e2deaa5c86">list_item_to_str</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0);</div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;</div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#ad98ae6e153f53b0c3c40119acc5e5266">ast_sorcery_reload_object</a>(sorcery, <span class="stringliteral">&quot;resource_list&quot;</span>);</div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;</div><div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;}</div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;</div><div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;<span class="preprocessor">#ifdef TEST_FRAMEWORK</span></div><div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;<span class="comment"> * \brief &quot;bad&quot; resources</span></div><div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;<span class="comment"> * These are resources that the test handler will reject subscriptions to.</span></div><div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04889"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a83aef050497f83116afc025b7acf19e3"> 4889</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a83aef050497f83116afc025b7acf19e3">bad_resources</a>[] = {</div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;   <span class="stringliteral">&quot;coconut&quot;</span>,</div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;   <span class="stringliteral">&quot;cilantro&quot;</span>,</div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;   <span class="stringliteral">&quot;olive&quot;</span>,</div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;   <span class="stringliteral">&quot;cheese&quot;</span>,</div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;};</div><div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;<span class="comment"> * \brief new_subscribe callback for unit tests</span></div><div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;<span class="comment"> * Will give a 200 OK response to any resource except the &quot;bad&quot; ones.</span></div><div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04901"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2353e3034a3cbd98dcc94740a7d5f8c1"> 4901</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2353e3034a3cbd98dcc94740a7d5f8c1">test_new_subscribe</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint, <span class="keyword">const</span> <span class="keywordtype">char</span> *resource)</div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;{</div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;</div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a83aef050497f83116afc025b7acf19e3">bad_resources</a>); ++i) {</div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;      <span class="keywordflow">if</span> (!strcmp(resource, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a83aef050497f83116afc025b7acf19e3">bad_resources</a>[i])) {</div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;         <span class="keywordflow">return</span> 400;</div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;      }</div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;   }</div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;</div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;   <span class="keywordflow">return</span> 200;</div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;}</div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;<span class="comment"> * \brief Subscription notifier for unit tests.</span></div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;<span class="comment"> * Since unit tests are only concerned with building a resource tree,</span></div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;<span class="comment"> * only the new_subscribe callback needs to be defined.</span></div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04920"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a10ec9e1a5bbe250daa4df389a6127b83"> 4920</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d1/d5b/structast__sip__notifier.html">ast_sip_notifier</a> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a10ec9e1a5bbe250daa4df389a6127b83">test_notifier</a> = {</div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;   .<a class="code" href="../../d1/d5b/structast__sip__notifier.html#a0772d90dd533f5d4d50dccaad8817843">new_subscribe</a> = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2353e3034a3cbd98dcc94740a7d5f8c1">test_new_subscribe</a>,</div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;};</div><div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;<span class="comment"> * \brief Subscription handler for unit tests.</span></div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04927"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a99619cb1fc467541615fc8d043d39643"> 4927</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a99619cb1fc467541615fc8d043d39643">test_handler</a> = {</div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;   .<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a> = <span class="stringliteral">&quot;test&quot;</span>,</div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;   .notifier = &amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a10ec9e1a5bbe250daa4df389a6127b83">test_notifier</a>,</div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;};</div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;<span class="comment"> * \brief Set properties on an allocated resource list</span></div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;<span class="comment"> * \param list The list to set details on.</span></div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;<span class="comment"> * \param event The list&#39;s event.</span></div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;<span class="comment"> * \param resources Array of resources to add to the list.</span></div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;<span class="comment"> * \param num_resources Number of resources in the array.</span></div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;<span class="comment"> * \retval 0 Success</span></div><div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;<span class="comment"> * \retval non-zero Failure</span></div><div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04942"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#abb2474471fcc9b7191d508cf1b407417"> 4942</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abb2474471fcc9b7191d508cf1b407417">populate_list</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/d7d/structevent.html">event</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> **resources, <span class="keywordtype">size_t</span> num_resources)</div><div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;{</div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;</div><div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#a5053da7047dfe40d67229c5dbc361f8b">event</a>, event, <span class="keyword">sizeof</span>(list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#a5053da7047dfe40d67229c5dbc361f8b">event</a>));</div><div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;</div><div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; num_resources; ++i) {</div><div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;      <span class="keywordtype">char</span> *resource = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(resources[i]);</div><div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;</div><div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;      <span class="keywordflow">if</span> (!resource || <a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(&amp;list-&gt;<a class="code" href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">items</a>, resource)) {</div><div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(resource);</div><div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;      }</div><div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;   }</div><div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;}</div><div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;<span class="comment"> * \brief RAII callback to destroy a resource list</span></div><div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04962"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b"> 4962</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list)</div><div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;{</div><div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;   <span class="keywordflow">if</span> (!list) {</div><div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;   }</div><div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;</div><div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), list);</div><div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(list);</div><div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;}</div><div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;<span class="comment"> * \brief allocate a resource list, store it in sorcery, and set its details</span></div><div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;<span class="comment"> * \param test The unit test. Used for logging status messages.</span></div><div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;<span class="comment"> * \param list_name The name of the list to create.</span></div><div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;<span class="comment"> * \param event The event the list services</span></div><div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;<span class="comment"> * \param resources Array of resources to apply to the list</span></div><div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;<span class="comment"> * \param num_resources The number of resources in the array</span></div><div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;<span class="comment"> * \retval NULL Failed to allocate or populate list</span></div><div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;<span class="comment"> * \retval non-NULL The created list</span></div><div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04983"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603"> 4983</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d79/structast__test.html">ast_test</a> *<a class="code" href="../../d8/d89/structtest.html">test</a>,</div><div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *list_name, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/d7d/structevent.html">event</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> **resources, <span class="keywordtype">size_t</span> num_resources)</div><div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;{</div><div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *list;</div><div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;</div><div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;   list = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;resource_list&quot;</span>, list_name);</div><div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;   <span class="keywordflow">if</span> (!list) {</div><div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(test, <span class="stringliteral">&quot;Could not allocate resource list in sorcery\n&quot;</span>);</div><div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;   }</div><div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;</div><div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d25/sorcery_8h.html#a575dfe8fd872c033d2b902549df502ea">ast_sorcery_create</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), list)) {</div><div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(test, <span class="stringliteral">&quot;Could not store the resource list in sorcery\n&quot;</span>);</div><div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(list);</div><div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;   }</div><div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;</div><div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abb2474471fcc9b7191d508cf1b407417">populate_list</a>(list, event, resources, num_resources)) {</div><div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(test, <span class="stringliteral">&quot;Could not add resources to the resource list\n&quot;</span>);</div><div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>(list);</div><div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;   }</div><div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;</div><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;   <span class="keywordflow">return</span> list;</div><div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;}</div><div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;<span class="comment"> * \brief Check the integrity of a tree node against a set of resources.</span></div><div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;<span class="comment"> * The tree node&#39;s resources must be in the same order as the resources in</span></div><div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;<span class="comment"> * the supplied resources array. Because of this constraint, tests can misrepresent</span></div><div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;<span class="comment"> * the size of the resources array as being smaller than it really is if resources</span></div><div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;<span class="comment"> * at the end of the array should not be present in the tree node.</span></div><div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;<span class="comment"> * \param test The unit test. Used for printing status messages.</span></div><div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;<span class="comment"> * \param node The constructed tree node whose integrity is under question.</span></div><div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;<span class="comment"> * \param resources Array of expected resource values</span></div><div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;<span class="comment"> * \param num_resources The number of resources to check in the array.</span></div><div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05022"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2a6654da48a7765b0c5957be5c282ea6"> 5022</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2a6654da48a7765b0c5957be5c282ea6">check_node</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d79/structast__test.html">ast_test</a> *<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="keyword">struct</span> <a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *<a class="code" href="../../d5/da1/structnode.html">node</a>,</div><div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> **resources, <span class="keywordtype">size_t</span> num_resources)</div><div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;{</div><div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;</div><div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;node-&gt;children) != num_resources) {</div><div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(test, <span class="stringliteral">&quot;Unexpected number of resources in tree. Expected %zu, got %zu\n&quot;</span>,</div><div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;            num_resources, <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;node-&gt;children));</div><div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;   }</div><div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;</div><div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; num_resources; ++i) {</div><div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;      <span class="keywordflow">if</span> (strcmp(resources[i], <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;node-&gt;children, i)-&gt;resource)) {</div><div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(test, <span class="stringliteral">&quot;Mismatched resources. Expected &#39;%s&#39; but got &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;               resources[i], <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;node-&gt;children, i)-&gt;resource);</div><div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;      }</div><div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;   }</div><div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;</div><div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;}</div><div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;<span class="comment"> * \brief RAII_VAR callback to destroy an allocated resource tree</span></div><div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05047"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd2ddc65db04f4a50bb9fe68a197b167"> 5047</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd2ddc65db04f4a50bb9fe68a197b167">test_resource_tree_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> *tree)</div><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;{</div><div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;   <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aca2de2a2c7ba7a0a16d4632b56af96fa">resource_tree_destroy</a>(tree);</div><div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tree);</div><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;}</div><div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;</div><div class="line"><a name="l05053"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a673b72409d496c2975c04f5d44f8a277"> 5053</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a673b72409d496c2975c04f5d44f8a277">ineligible_configuration</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;{</div><div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d18/structast__config.html">ast_config</a> *<a class="code" href="../../de/dcc/conf2ael_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>;</div><div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> flags = {0,};</div><div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;</div><div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;   config = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<span class="stringliteral">&quot;sorcery.conf&quot;</span>, flags);</div><div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;   <span class="keywordflow">if</span> (!config) {</div><div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;   }</div><div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;</div><div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;   value = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;res_pjsip_pubsub&quot;</span>, <span class="stringliteral">&quot;resource_list&quot;</span>);</div><div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(value)) {</div><div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;      <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a6b4d4d929013de7812fbba4e58353078">ast_config_destroy</a>(config);</div><div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;   }</div><div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;</div><div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;   <span class="keywordflow">if</span> (strcasecmp(value, <span class="stringliteral">&quot;memory&quot;</span>) &amp;&amp; strcasecmp(value, <span class="stringliteral">&quot;astdb&quot;</span>)) {</div><div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;      <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a6b4d4d929013de7812fbba4e58353078">ast_config_destroy</a>(config);</div><div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;   }</div><div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;</div><div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;}</div><div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;</div><div class="line"><a name="l05078"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a354490007a46ab4f8bebe7d7211bf57c"> 5078</a></span>&#160;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a354490007a46ab4f8bebe7d7211bf57c">AST_TEST_DEFINE</a>(<a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a>)</div><div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;{</div><div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>);</div><div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> *, tree, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd2ddc65db04f4a50bb9fe68a197b167">test_resource_tree_destroy</a>);</div><div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resources[] = {</div><div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;      <span class="stringliteral">&quot;huey&quot;</span>,</div><div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;      <span class="stringliteral">&quot;dewey&quot;</span>,</div><div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;      <span class="stringliteral">&quot;louie&quot;</span>,</div><div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;   };</div><div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;   <span class="keywordtype">int</span> resp;</div><div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;</div><div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;resource_tree&quot;</span>;</div><div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_pjsip_pubsub/&quot;</span>;</div><div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Basic resource tree integrity check&quot;</span>;</div><div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description =</div><div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;         <span class="stringliteral">&quot;Create a resource list and ensure that our attempt to build a tree works as expected.&quot;</span>;</div><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;   }</div><div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;</div><div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a673b72409d496c2975c04f5d44f8a277">ineligible_configuration</a>()) {</div><div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Ineligible configuration for this test. Please add a &quot;</span></div><div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;            <span class="stringliteral">&quot;&#39;res_pjsip_pubsub&#39; section to sorcery.conf, and set &#39;resource_list=memory&#39;\n&quot;</span>);</div><div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;   }</div><div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;</div><div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;   list = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>, resources, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources));</div><div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;   <span class="keywordflow">if</span> (!list) {</div><div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;   }</div><div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;</div><div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;   tree = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tree));</div><div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;   resp = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477">build_resource_tree</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;test_handler, <span class="stringliteral">&quot;foo&quot;</span>, tree, 1);</div><div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;   <span class="keywordflow">if</span> (resp != 200) {</div><div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unexpected response %d when building resource tree\n&quot;</span>, resp);</div><div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;   }</div><div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;</div><div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;   <span class="keywordflow">if</span> (!tree-&gt;root) {</div><div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Resource tree has no root\n&quot;</span>);</div><div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;   }</div><div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;</div><div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2a6654da48a7765b0c5957be5c282ea6">check_node</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, tree-&gt;root, resources, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources))) {</div><div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;   }</div><div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;</div><div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;}</div><div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;</div><div class="line"><a name="l05131"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9a4d24c551721c2fe38c64fbfd48de79"> 5131</a></span>&#160;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a354490007a46ab4f8bebe7d7211bf57c">AST_TEST_DEFINE</a>(complex_resource_tree)</div><div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;{</div><div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list_1, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>);</div><div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list_2, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>);</div><div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> *, tree, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd2ddc65db04f4a50bb9fe68a197b167">test_resource_tree_destroy</a>);</div><div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resources_1[] = {</div><div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;      <span class="stringliteral">&quot;huey&quot;</span>,</div><div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;      <span class="stringliteral">&quot;dewey&quot;</span>,</div><div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;      <span class="stringliteral">&quot;louie&quot;</span>,</div><div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;      <span class="stringliteral">&quot;dwarves&quot;</span>,</div><div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;   };</div><div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resources_2[] = {</div><div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;      <span class="stringliteral">&quot;happy&quot;</span>,</div><div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;      <span class="stringliteral">&quot;grumpy&quot;</span>,</div><div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;      <span class="stringliteral">&quot;doc&quot;</span>,</div><div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;      <span class="stringliteral">&quot;bashful&quot;</span>,</div><div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;      <span class="stringliteral">&quot;dopey&quot;</span>,</div><div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;      <span class="stringliteral">&quot;sneezy&quot;</span>,</div><div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;      <span class="stringliteral">&quot;sleepy&quot;</span>,</div><div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;   };</div><div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;   <span class="keywordtype">int</span> resp;</div><div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *<a class="code" href="../../d5/da1/structnode.html">node</a>;</div><div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;</div><div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;complex_resource_tree&quot;</span>;</div><div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_pjsip_pubsub/&quot;</span>;</div><div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Complex resource tree integrity check&quot;</span>;</div><div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description =</div><div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;         <span class="stringliteral">&quot;Create a complex resource list and ensure that our attempt to build a tree works as expected.&quot;</span>;</div><div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;   }</div><div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;</div><div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a673b72409d496c2975c04f5d44f8a277">ineligible_configuration</a>()) {</div><div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Ineligible configuration for this test. Please add a &quot;</span></div><div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;            <span class="stringliteral">&quot;&#39;res_pjsip_pubsub&#39; section to sorcery.conf, and set &#39;resource_list=memory&#39;\n&quot;</span>);</div><div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;   }</div><div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;</div><div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;   list_1 = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>, resources_1, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_1));</div><div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;   <span class="keywordflow">if</span> (!list_1) {</div><div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;   }</div><div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;</div><div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;   list_2 = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;dwarves&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>, resources_2, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_2));</div><div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;   <span class="keywordflow">if</span> (!list_2) {</div><div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;   }</div><div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;</div><div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;   tree = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tree));</div><div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;   resp = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477">build_resource_tree</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;test_handler, <span class="stringliteral">&quot;foo&quot;</span>, tree, 1);</div><div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;   <span class="keywordflow">if</span> (resp != 200) {</div><div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unexpected response %d when building resource tree\n&quot;</span>, resp);</div><div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;   }</div><div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;</div><div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;   <span class="keywordflow">if</span> (!tree-&gt;root) {</div><div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Resource tree has no root\n&quot;</span>);</div><div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;   }</div><div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;</div><div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;   node = tree-&gt;root;</div><div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2a6654da48a7765b0c5957be5c282ea6">check_node</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, node, resources_1, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_1))) {</div><div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;   }</div><div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;</div><div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;   <span class="comment">/* The embedded list is at index 3 in the root node&#39;s children */</span></div><div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;   node = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;node-&gt;children, 3);</div><div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2a6654da48a7765b0c5957be5c282ea6">check_node</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, node, resources_2, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_2))) {</div><div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;   }</div><div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;</div><div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;}</div><div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;</div><div class="line"><a name="l05208"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a1ad2962bb10fb62debded8a39cc1e3fa"> 5208</a></span>&#160;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a354490007a46ab4f8bebe7d7211bf57c">AST_TEST_DEFINE</a>(bad_resource)</div><div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;{</div><div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>);</div><div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> *, tree, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd2ddc65db04f4a50bb9fe68a197b167">test_resource_tree_destroy</a>);</div><div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resources[] = {</div><div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;      <span class="stringliteral">&quot;huey&quot;</span>,</div><div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;      <span class="stringliteral">&quot;dewey&quot;</span>,</div><div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;      <span class="stringliteral">&quot;louie&quot;</span>,</div><div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;      <span class="stringliteral">&quot;coconut&quot;</span>, <span class="comment">/* A &quot;bad&quot; resource */</span></div><div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;   };</div><div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;   <span class="keywordtype">int</span> resp;</div><div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;</div><div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;bad_resource&quot;</span>;</div><div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_pjsip_pubsub/&quot;</span>;</div><div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Ensure bad resources do not end up in the tree&quot;</span>;</div><div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description =</div><div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;         <span class="stringliteral">&quot;Create a resource list with a single bad resource. Ensure the bad resource does not end up in the tree.&quot;</span>;</div><div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;   }</div><div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;</div><div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a673b72409d496c2975c04f5d44f8a277">ineligible_configuration</a>()) {</div><div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Ineligible configuration for this test. Please add a &quot;</span></div><div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;            <span class="stringliteral">&quot;&#39;res_pjsip_pubsub&#39; section to sorcery.conf, and set &#39;resource_list=memory&#39;\n&quot;</span>);</div><div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;   }</div><div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;</div><div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;   list = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>, resources, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources));</div><div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;   <span class="keywordflow">if</span> (!list) {</div><div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;   }</div><div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;</div><div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;   tree = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tree));</div><div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;   resp = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477">build_resource_tree</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;test_handler, <span class="stringliteral">&quot;foo&quot;</span>, tree, 1);</div><div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;   <span class="keywordflow">if</span> (resp != 200) {</div><div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unexpected response %d when building resource tree\n&quot;</span>, resp);</div><div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;   }</div><div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;</div><div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;   <span class="keywordflow">if</span> (!tree-&gt;root) {</div><div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Resource tree has no root\n&quot;</span>);</div><div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;   }</div><div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;</div><div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;   <span class="comment">/* We check against all but the final resource since we expect it not to be in the tree */</span></div><div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2a6654da48a7765b0c5957be5c282ea6">check_node</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, tree-&gt;root, resources, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources) - 1)) {</div><div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;   }</div><div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;</div><div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;</div><div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;}</div><div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;</div><div class="line"><a name="l05264"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a592d2ccf2b016dd3c962e6bc8eba77a0"> 5264</a></span>&#160;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a354490007a46ab4f8bebe7d7211bf57c">AST_TEST_DEFINE</a>(bad_branch)</div><div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;{</div><div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list_1, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>);</div><div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list_2, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>);</div><div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> *, tree, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd2ddc65db04f4a50bb9fe68a197b167">test_resource_tree_destroy</a>);</div><div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resources_1[] = {</div><div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;      <span class="stringliteral">&quot;huey&quot;</span>,</div><div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;      <span class="stringliteral">&quot;dewey&quot;</span>,</div><div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;      <span class="stringliteral">&quot;louie&quot;</span>,</div><div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;      <span class="stringliteral">&quot;gross&quot;</span>,</div><div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;   };</div><div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;   <span class="comment">/* This list has nothing but bad resources */</span></div><div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resources_2[] = {</div><div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;      <span class="stringliteral">&quot;coconut&quot;</span>,</div><div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;      <span class="stringliteral">&quot;cilantro&quot;</span>,</div><div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;      <span class="stringliteral">&quot;olive&quot;</span>,</div><div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;      <span class="stringliteral">&quot;cheese&quot;</span>,</div><div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;   };</div><div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;   <span class="keywordtype">int</span> resp;</div><div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;</div><div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;bad_branch&quot;</span>;</div><div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_pjsip_pubsub/&quot;</span>;</div><div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Ensure bad branches are pruned from the tree&quot;</span>;</div><div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description =</div><div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;         <span class="stringliteral">&quot;Create a resource list that makes a tree with an entire branch of bad resources.\n&quot;</span></div><div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;         <span class="stringliteral">&quot;Ensure the bad branch is pruned from the tree.&quot;</span>;</div><div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;   }</div><div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;</div><div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a673b72409d496c2975c04f5d44f8a277">ineligible_configuration</a>()) {</div><div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Ineligible configuration for this test. Please add a &quot;</span></div><div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;            <span class="stringliteral">&quot;&#39;res_pjsip_pubsub&#39; section to sorcery.conf, and set &#39;resource_list=memory&#39;\n&quot;</span>);</div><div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;   }</div><div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;</div><div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;   list_1 = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>, resources_1, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_1));</div><div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;   <span class="keywordflow">if</span> (!list_1) {</div><div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;   }</div><div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;   list_2 = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;gross&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>, resources_2, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_2));</div><div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;   <span class="keywordflow">if</span> (!list_2) {</div><div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;   }</div><div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;</div><div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;   tree = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tree));</div><div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;   resp = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477">build_resource_tree</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;test_handler, <span class="stringliteral">&quot;foo&quot;</span>, tree, 1);</div><div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;   <span class="keywordflow">if</span> (resp != 200) {</div><div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unexpected response %d when building resource tree\n&quot;</span>, resp);</div><div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;   }</div><div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;</div><div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;   <span class="keywordflow">if</span> (!tree-&gt;root) {</div><div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Resource tree has no root\n&quot;</span>);</div><div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;   }</div><div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;</div><div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;   <span class="comment">/* We check against all but the final resource of the list since the entire branch should</span></div><div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;<span class="comment">    * be pruned from the tree</span></div><div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2a6654da48a7765b0c5957be5c282ea6">check_node</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, tree-&gt;root, resources_1, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_1) - 1)) {</div><div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;   }</div><div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;</div><div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;</div><div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;}</div><div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;</div><div class="line"><a name="l05335"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a390c1a18874b65665ec47829e6a94b7b"> 5335</a></span>&#160;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a354490007a46ab4f8bebe7d7211bf57c">AST_TEST_DEFINE</a>(duplicate_resource)</div><div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;{</div><div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list_1, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>);</div><div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list_2, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>);</div><div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> *, tree, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd2ddc65db04f4a50bb9fe68a197b167">test_resource_tree_destroy</a>);</div><div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resources_1[] = {</div><div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;      <span class="stringliteral">&quot;huey&quot;</span>,</div><div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;      <span class="stringliteral">&quot;ducks&quot;</span>,</div><div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;      <span class="stringliteral">&quot;dewey&quot;</span>,</div><div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;      <span class="stringliteral">&quot;louie&quot;</span>,</div><div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;   };</div><div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resources_2[] = {</div><div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;      <span class="stringliteral">&quot;donald&quot;</span>,</div><div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;      <span class="stringliteral">&quot;daisy&quot;</span>,</div><div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;      <span class="stringliteral">&quot;scrooge&quot;</span>,</div><div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;      <span class="stringliteral">&quot;dewey&quot;</span>,</div><div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;      <span class="stringliteral">&quot;louie&quot;</span>,</div><div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;      <span class="stringliteral">&quot;huey&quot;</span>,</div><div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;   };</div><div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;   <span class="keywordtype">int</span> resp;</div><div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d14/structtree__node.html">tree_node</a> *<a class="code" href="../../d5/da1/structnode.html">node</a>;</div><div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;</div><div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;duplicate_resource&quot;</span>;</div><div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_pjsip_pubsub/&quot;</span>;</div><div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Ensure duplicated resources do not end up in the tree&quot;</span>;</div><div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description =</div><div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;         <span class="stringliteral">&quot;Create a resource list with a single duplicated resource. Ensure the duplicated resource does not end up in the tree.&quot;</span>;</div><div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;   }</div><div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;</div><div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a673b72409d496c2975c04f5d44f8a277">ineligible_configuration</a>()) {</div><div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Ineligible configuration for this test. Please add a &quot;</span></div><div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;            <span class="stringliteral">&quot;&#39;res_pjsip_pubsub&#39; section to sorcery.conf, and set &#39;resource_list=memory&#39;\n&quot;</span>);</div><div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;   }</div><div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;</div><div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;   list_1 = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>, resources_1, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_1));</div><div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;   <span class="keywordflow">if</span> (!list_1) {</div><div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;   }</div><div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;</div><div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;   list_2 = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;ducks&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>, resources_2, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_2));</div><div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;   <span class="keywordflow">if</span> (!list_2) {</div><div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;   }</div><div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;</div><div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;   tree = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tree));</div><div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;   resp = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477">build_resource_tree</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;test_handler, <span class="stringliteral">&quot;foo&quot;</span>, tree, 1);</div><div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;   <span class="keywordflow">if</span> (resp != 200) {</div><div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unexpected response %d when building resource tree\n&quot;</span>, resp);</div><div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;   }</div><div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;</div><div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;   <span class="keywordflow">if</span> (!tree-&gt;root) {</div><div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Resource tree has no root\n&quot;</span>);</div><div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;   }</div><div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;</div><div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;   node = tree-&gt;root;</div><div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;   <span class="comment">/* This node should have &quot;huey&quot; and &quot;ducks&quot;. &quot;dewey&quot; and &quot;louie&quot; should not</span></div><div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;<span class="comment">    * be present since they were found in the &quot;ducks&quot; list.</span></div><div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2a6654da48a7765b0c5957be5c282ea6">check_node</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, node, resources_1, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_1) - 2)) {</div><div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;   }</div><div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;</div><div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;   <span class="comment">/* This node should have &quot;donald&quot;, &quot;daisy&quot;, &quot;scrooge&quot;, &quot;dewey&quot;, and &quot;louie&quot;.</span></div><div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;<span class="comment">    * &quot;huey&quot; is not here since that was already encountered in the parent list</span></div><div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;   node = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;node-&gt;children, 1);</div><div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a2a6654da48a7765b0c5957be5c282ea6">check_node</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, node, resources_2, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_2) - 1)) {</div><div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;   }</div><div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;</div><div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;}</div><div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;</div><div class="line"><a name="l05416"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad25ce03cdf8ed99dfe8e66a3b3a3d0b6"> 5416</a></span>&#160;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a354490007a46ab4f8bebe7d7211bf57c">AST_TEST_DEFINE</a>(loop)</div><div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;{</div><div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list_1, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>);</div><div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list_2, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>);</div><div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> *, tree, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd2ddc65db04f4a50bb9fe68a197b167">test_resource_tree_destroy</a>);</div><div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resources_1[] = {</div><div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;      <span class="stringliteral">&quot;derp&quot;</span>,</div><div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;   };</div><div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resources_2[] = {</div><div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;      <span class="stringliteral">&quot;herp&quot;</span>,</div><div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;   };</div><div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;   <span class="keywordtype">int</span> resp;</div><div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;</div><div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;loop&quot;</span>;</div><div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_pjsip_pubsub/&quot;</span>;</div><div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Test that loops are properly detected.&quot;</span>;</div><div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description =</div><div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;         <span class="stringliteral">&quot;Create two resource lists that refer to each other. Ensure that attempting to build a tree\n&quot;</span></div><div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;         <span class="stringliteral">&quot;results in an empty tree.&quot;</span>;</div><div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;   }</div><div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;</div><div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a673b72409d496c2975c04f5d44f8a277">ineligible_configuration</a>()) {</div><div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Ineligible configuration for this test. Please add a &quot;</span></div><div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;            <span class="stringliteral">&quot;&#39;res_pjsip_pubsub&#39; section to sorcery.conf, and set &#39;resource_list=memory&#39;\n&quot;</span>);</div><div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;   }</div><div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;</div><div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;   list_1 = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;herp&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>, resources_1, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_1));</div><div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;   <span class="keywordflow">if</span> (!list_1) {</div><div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;   }</div><div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;   list_2 = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;derp&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>, resources_2, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources_2));</div><div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;   <span class="keywordflow">if</span> (!list_2) {</div><div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;   }</div><div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;</div><div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;   tree = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tree));</div><div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;   resp = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477">build_resource_tree</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;test_handler, <span class="stringliteral">&quot;herp&quot;</span>, tree, 1);</div><div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;   <span class="keywordflow">if</span> (resp == 200) {</div><div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unexpected response %d when building resource tree\n&quot;</span>, resp);</div><div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;   }</div><div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;</div><div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;}</div><div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;</div><div class="line"><a name="l05467"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#af570896c63f7cc45d4ed91f135f76340"> 5467</a></span>&#160;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a354490007a46ab4f8bebe7d7211bf57c">AST_TEST_DEFINE</a>(bad_event)</div><div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;{</div><div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dd0/structresource__list.html">resource_list</a> *, list, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a>);</div><div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a> *, tree, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#acd2ddc65db04f4a50bb9fe68a197b167">test_resource_tree_destroy</a>);</div><div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resources[] = {</div><div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;      <span class="stringliteral">&quot;huey&quot;</span>,</div><div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;      <span class="stringliteral">&quot;dewey&quot;</span>,</div><div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;      <span class="stringliteral">&quot;louie&quot;</span>,</div><div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;   };</div><div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;   <span class="keywordtype">int</span> resp;</div><div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;</div><div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;bad_event&quot;</span>;</div><div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_pjsip_pubsub/&quot;</span>;</div><div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Ensure that list with wrong event specified is not retrieved&quot;</span>;</div><div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description =</div><div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;         <span class="stringliteral">&quot;Create a simple resource list for event &#39;tsetse&#39;. Ensure that trying to retrieve the list for event &#39;test&#39; fails.&quot;</span>;</div><div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;   }</div><div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;</div><div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a673b72409d496c2975c04f5d44f8a277">ineligible_configuration</a>()) {</div><div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Ineligible configuration for this test. Please add a &quot;</span></div><div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;            <span class="stringliteral">&quot;&#39;res_pjsip_pubsub&#39; section to sorcery.conf, and set &#39;resource_list=memory&#39;\n&quot;</span>);</div><div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;   }</div><div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;</div><div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;   list = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;tsetse&quot;</span>, resources, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(resources));</div><div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;   <span class="keywordflow">if</span> (!list) {</div><div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;   }</div><div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;</div><div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;   tree = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tree));</div><div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;   <span class="comment">/* Since the test_handler is for event &quot;test&quot;, this should not build a list, but</span></div><div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;<span class="comment">    * instead result in a single resource being created, called &quot;foo&quot;</span></div><div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;   resp = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477">build_resource_tree</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;test_handler, <span class="stringliteral">&quot;foo&quot;</span>, tree, 1);</div><div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;   <span class="keywordflow">if</span> (resp != 200) {</div><div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unexpected response %d when building resource tree\n&quot;</span>, resp);</div><div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;   }</div><div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;</div><div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;   <span class="keywordflow">if</span> (!tree-&gt;root) {</div><div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Resource tree has no root\n&quot;</span>);</div><div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;   }</div><div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;</div><div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;   <span class="keywordflow">if</span> (strcmp(tree-&gt;root-&gt;resource, <span class="stringliteral">&quot;foo&quot;</span>)) {</div><div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unexpected resource %s found in tree\n&quot;</span>, tree-&gt;root-&gt;resource);</div><div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;   }</div><div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;</div><div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;}</div><div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;</div><div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;</div><div class="line"><a name="l05526"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a64671fa6b889a9d62d646f3ab90cc775"> 5526</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a64671fa6b889a9d62d646f3ab90cc775">resource_endpoint_handler</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/de0/structaco__option.html">aco_option</a> *opt, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;{</div><div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d91/structast__sip__publication__resource.html">ast_sip_publication_resource</a> *resource = obj;</div><div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;</div><div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(resource-&gt;<a class="code" href="../../d2/d91/structast__sip__publication__resource.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a>);</div><div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;   resource-&gt;<a class="code" href="../../d2/d91/structast__sip__publication__resource.html#a6d2d1c31529bee906473fcabaffff34f">endpoint</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;</div><div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;}</div><div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;</div><div class="line"><a name="l05536"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3906226af7019edcf94ef2ce356dc7cf"> 5536</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3906226af7019edcf94ef2ce356dc7cf">resource_event_handler</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/de0/structaco__option.html">aco_option</a> *opt, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;{</div><div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d91/structast__sip__publication__resource.html">ast_sip_publication_resource</a> *resource = obj;</div><div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;   <span class="comment">/* The event configuration name starts with &#39;event_&#39; so skip past it to get the real name */</span></div><div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">event</span> = var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> + 6;</div><div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a>;</div><div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;</div><div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../df/d7d/structevent.html">event</a>) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {</div><div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;   }</div><div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;</div><div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;   item = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a66581086d34dfe7ea86b0644bacef239">ast_variable_new</a>(<a class="code" href="../../df/d7d/structevent.html">event</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;   <span class="keywordflow">if</span> (!item) {</div><div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;   }</div><div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;</div><div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;   <span class="keywordflow">if</span> (resource-&gt;<a class="code" href="../../d2/d91/structast__sip__publication__resource.html#ad2ef61c498fc983f10336fd7b5876af7">events</a>) {</div><div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;      item-&gt;<a class="code" href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">next</a> = resource-&gt;<a class="code" href="../../d2/d91/structast__sip__publication__resource.html#ad2ef61c498fc983f10336fd7b5876af7">events</a>;</div><div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;   }</div><div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;   resource-&gt;<a class="code" href="../../d2/d91/structast__sip__publication__resource.html#ad2ef61c498fc983f10336fd7b5876af7">events</a> = <a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a>;</div><div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;</div><div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;}</div><div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;</div><div class="line"><a name="l05560"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9"> 5560</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;{</div><div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t str_PUBLISH = { <span class="stringliteral">&quot;PUBLISH&quot;</span>, 7 };</div><div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d1/dbc/res__pjsip__phoneprov__provider_8c.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>;</div><div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;</div><div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;   sorcery = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>();</div><div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;</div><div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;   <span class="keywordflow">if</span> (!(sched = <a class="code" href="../../d7/d00/sched_8h.html#a5baecc149aeabdbef9b3ed6780c1c4a6">ast_sched_context_create</a>())) {</div><div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not create scheduler for publication expiration\n&quot;</span>);</div><div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;   }</div><div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;</div><div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d00/sched_8h.html#a8ae97d1549b62cfbfc78bd92efe48005">ast_sched_start_thread</a>(sched)) {</div><div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not start scheduler thread for publication expiration\n&quot;</span>);</div><div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;      <a class="code" href="../../d7/d00/sched_8h.html#a862f869d056628b38e09042f21b54413">ast_sched_context_destroy</a>(sched);</div><div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;   }</div><div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;</div><div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a9db9fd1cf5ec967af2ad3a63c27e0233">ast_sorcery_apply_config</a>(sorcery, <span class="stringliteral">&quot;res_pjsip_pubsub&quot;</span>);</div><div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#ad1165cf9d45ed5ffa1555371be9ae770">ast_sorcery_apply_default</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;astdb&quot;</span>, <span class="stringliteral">&quot;subscription_persistence&quot;</span>);</div><div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d25/sorcery_8h.html#a5ee86f00f6e2240f74772d59edf0f74a">ast_sorcery_object_register</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae323533f795e111d13b1d7b9a3d1d973">subscription_persistence_alloc</a>,</div><div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;      <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not register subscription persistence object support\n&quot;</span>);</div><div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;      <a class="code" href="../../d7/d00/sched_8h.html#a862f869d056628b38e09042f21b54413">ast_sched_context_destroy</a>(sched);</div><div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;   }</div><div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;packet&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a783aac0af1422c0e46356efd3c52d37a">OPT_CHAR_ARRAY_T</a>, 0,</div><div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;      <a class="code" href="../../db/dfe/config__options_8h.html#a5a18d813ca848db340644212d89aac1a">CHARFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a>, packet));</div><div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;src_name&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a783aac0af1422c0e46356efd3c52d37a">OPT_CHAR_ARRAY_T</a>, 0,</div><div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;      <a class="code" href="../../db/dfe/config__options_8h.html#a5a18d813ca848db340644212d89aac1a">CHARFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a>, src_name));</div><div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;src_port&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a>, 0,</div><div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;      <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a>, src_port));</div><div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;transport_key&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a783aac0af1422c0e46356efd3c52d37a">OPT_CHAR_ARRAY_T</a>, 0,</div><div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;      <a class="code" href="../../db/dfe/config__options_8h.html#a5a18d813ca848db340644212d89aac1a">CHARFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a>, transport_key));</div><div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;local_name&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a783aac0af1422c0e46356efd3c52d37a">OPT_CHAR_ARRAY_T</a>, 0,</div><div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;      <a class="code" href="../../db/dfe/config__options_8h.html#a5a18d813ca848db340644212d89aac1a">CHARFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a>, local_name));</div><div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;local_port&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a>, 0,</div><div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;      <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a>, local_port));</div><div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;cseq&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a>, 0,</div><div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;      <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a>, cseq));</div><div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a720c9774873ec35bae0a0160954767e7">ast_sorcery_object_field_register_custom</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;endpoint&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aa312ad955e7ad6a9dff13667be04c7f7">persistence_endpoint_str2struct</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a56c0f161f100c005d4c95b26ca3f7d7d">persistence_endpoint_struct2str</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0);</div><div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a720c9774873ec35bae0a0160954767e7">ast_sorcery_object_field_register_custom</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;tag&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aac028869908c724f84c3a1cee520315c">persistence_tag_str2struct</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac4305e5102dec63e8bbb9175dbab630e">persistence_tag_struct2str</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0);</div><div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a720c9774873ec35bae0a0160954767e7">ast_sorcery_object_field_register_custom</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;expires&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#aae837565412b034de817b534fa2a7136">persistence_expires_str2struct</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a946b1f58e8ead34101e6fc012088140a">persistence_expires_struct2str</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0);</div><div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;contact_uri&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a783aac0af1422c0e46356efd3c52d37a">OPT_CHAR_ARRAY_T</a>, 0,</div><div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;      <a class="code" href="../../db/dfe/config__options_8h.html#a5a18d813ca848db340644212d89aac1a">CHARFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a>, contact_uri));</div><div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;prune_on_boot&quot;</span>, <span class="stringliteral">&quot;no&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144ab40ad6fcfeefab3befa32ab479be04a2">OPT_YESNO_T</a>, 1,</div><div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;      <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a>, prune_on_boot));</div><div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a720c9774873ec35bae0a0160954767e7">ast_sorcery_object_field_register_custom</a>(sorcery, <span class="stringliteral">&quot;subscription_persistence&quot;</span>, <span class="stringliteral">&quot;generator_data&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a8dcc5a2234d92546bbeeead95aa648ec">persistence_generator_data_str2struct</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad276d9178ef9aad7e0d9ad2fbd52744d">persistence_generator_data_struct2str</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0);</div><div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;</div><div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a9c45ac14fca8a0ed83e33e45856a5199">apply_list_configuration</a>(sorcery)) {</div><div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;      <a class="code" href="../../d7/d00/sched_8h.html#a862f869d056628b38e09042f21b54413">ast_sched_context_destroy</a>(sched);</div><div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;   }</div><div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;</div><div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#ad1165cf9d45ed5ffa1555371be9ae770">ast_sorcery_apply_default</a>(sorcery, <span class="stringliteral">&quot;inbound-publication&quot;</span>, <span class="stringliteral">&quot;config&quot;</span>, <span class="stringliteral">&quot;pjsip.conf,criteria=type=inbound-publication&quot;</span>);</div><div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d25/sorcery_8h.html#a5ee86f00f6e2240f74772d59edf0f74a">ast_sorcery_object_register</a>(sorcery, <span class="stringliteral">&quot;inbound-publication&quot;</span>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ab24c7cae87fc8a55c3a59bbf69cf7352">publication_resource_alloc</a>,</div><div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;      <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not register subscription persistence object support\n&quot;</span>);</div><div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;      <a class="code" href="../../d7/d00/sched_8h.html#a862f869d056628b38e09042f21b54413">ast_sched_context_destroy</a>(sched);</div><div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;   }</div><div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a>(sorcery, <span class="stringliteral">&quot;inbound-publication&quot;</span>, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a0df2cc9dc9bf09ee71252c183fe64bd7">OPT_NOOP_T</a>, 0, 0);</div><div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a720c9774873ec35bae0a0160954767e7">ast_sorcery_object_field_register_custom</a>(sorcery, <span class="stringliteral">&quot;inbound-publication&quot;</span>, <span class="stringliteral">&quot;endpoint&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;      <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a64671fa6b889a9d62d646f3ab90cc775">resource_endpoint_handler</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0);</div><div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a1f0ff2b69990cd594471a830dea51f6c">ast_sorcery_object_fields_register</a>(sorcery, <span class="stringliteral">&quot;inbound-publication&quot;</span>, <span class="stringliteral">&quot;^event_&quot;</span>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a3906226af7019edcf94ef2ce356dc7cf">resource_event_handler</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#ad98ae6e153f53b0c3c40119acc5e5266">ast_sorcery_reload_object</a>(sorcery, <span class="stringliteral">&quot;inbound-publication&quot;</span>);</div><div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;</div><div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a2d923ef44f62dffc05178f762b88f084">ast_sip_register_service</a>(&amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>)) {</div><div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not register pubsub service\n&quot;</span>);</div><div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;      <a class="code" href="../../d7/d00/sched_8h.html#a862f869d056628b38e09042f21b54413">ast_sched_context_destroy</a>(sched);</div><div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;   }</div><div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;</div><div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;   <span class="keywordflow">if</span> (pjsip_evsub_init_module(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>()) != PJ_SUCCESS) {</div><div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not initialize pjsip evsub module.\n&quot;</span>);</div><div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a15aa09d9084763cdd20b7467a4cd381a">ast_sip_unregister_service</a>(&amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>);</div><div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;      <a class="code" href="../../d7/d00/sched_8h.html#a862f869d056628b38e09042f21b54413">ast_sched_context_destroy</a>(sched);</div><div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;   }</div><div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;</div><div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;   <span class="comment">/* Once pjsip_evsub_init_module succeeds we cannot unload.</span></div><div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;<span class="comment">    * Keep all module_load errors above this point. */</span></div><div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#a9967b09817639f2e15c3f074a60b6379">ast_module_shutdown_ref</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;</div><div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;   pjsip_media_type_init2(&amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ae55303c463ee7d4709335ae3311c3826">rlmi_media_type</a>, <span class="stringliteral">&quot;application&quot;</span>, <span class="stringliteral">&quot;rlmi+xml&quot;</span>);</div><div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;</div><div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;   pjsip_endpt_add_capability(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, PJSIP_H_ALLOW, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 1, &amp;str_PUBLISH);</div><div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;</div><div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;<a class="code" href="../../d6/dd6/group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a>, <a class="code" href="../../d6/dd6/group__main__options.html#gaf2588453b3a373a770741ad3ce353343ade4cf3231c69af57ad0527bd46244680">AST_OPT_FLAG_FULLY_BOOTED</a>)) {</div><div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;      <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a0e8ac5e3b2ce24bb0441ca5c30fa783c">subscription_persistence_load</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;</div><div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;      sub = <a class="code" href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a>(<a class="code" href="../../df/d72/group__Group__AMI.html#ga568aa1aff837fc0001279490a6d9b22f">ast_manager_get_topic</a>(), <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac62bbbfecf4068411d7fa11225c91055">subscription_persistence_event_cb</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;      <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(sub, <a class="code" href="../../db/d45/manager_8h.html#a8ae409b5ff584e42c30edcfe5837d85c">ast_manager_get_generic_type</a>());</div><div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;      <a class="code" href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a>(sub, <a class="code" href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a>);</div><div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;   }</div><div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;</div><div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a703b9f7d4c89444b70c00353c864765c">AMI_SHOW_SUBSCRIPTIONS_INBOUND</a>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>,</div><div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;             <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a675152b3c3f0536dbb1f624fc840fba1">ami_show_subscriptions_inbound</a>);</div><div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a75e6251ec7546725dcb5cc72bf6b60ce">AMI_SHOW_SUBSCRIPTIONS_OUTBOUND</a>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>,</div><div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;             <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a53732c2137fa94234dd28ed05de1a282">ami_show_subscriptions_outbound</a>);</div><div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<span class="stringliteral">&quot;PJSIPShowResourceLists&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>,</div><div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;         <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a22c56a35e1b346bd629dd4caf6a52f03">ami_show_resource_lists</a>);</div><div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;</div><div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a>(cli_commands, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_commands));</div><div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;</div><div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(<a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a>);</div><div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(complex_resource_tree);</div><div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(bad_resource);</div><div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(bad_branch);</div><div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(duplicate_resource);</div><div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(loop);</div><div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(bad_event);</div><div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;</div><div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;}</div><div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;</div><div class="line"><a name="l05682"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad09fa931f468002152a3cc2d5ce25eae"> 5682</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;{</div><div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(<a class="code" href="../../d9/d6a/structresource__tree.html">resource_tree</a>);</div><div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(complex_resource_tree);</div><div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(bad_resource);</div><div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(bad_branch);</div><div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(duplicate_resource);</div><div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(loop);</div><div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(bad_event);</div><div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;</div><div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7e419c29ebfb010ca04b7c189c207bbd">ast_sip_transport_monitor_unregister_all</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#abf46a87a277bf64c6230f9f2237906f8">sub_tree_transport_cb</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;</div><div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a>(cli_commands, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_commands));</div><div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;</div><div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a75e6251ec7546725dcb5cc72bf6b60ce">AMI_SHOW_SUBSCRIPTIONS_OUTBOUND</a>);</div><div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a703b9f7d4c89444b70c00353c864765c">AMI_SHOW_SUBSCRIPTIONS_INBOUND</a>);</div><div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;PJSIPShowResourceLists&quot;</span>);</div><div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;</div><div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a15aa09d9084763cdd20b7467a4cd381a">ast_sip_unregister_service</a>(&amp;<a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a>);</div><div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;   <span class="keywordflow">if</span> (sched) {</div><div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;      <a class="code" href="../../d7/d00/sched_8h.html#a862f869d056628b38e09042f21b54413">ast_sched_context_destroy</a>(sched);</div><div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;   }</div><div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;</div><div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;}</div><div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;</div><div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;<a class="code" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a>(<a class="code" href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a>, <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a>, <span class="stringliteral">&quot;PJSIP event resource&quot;</span>,</div><div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;   .support_level = <a class="code" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>,</div><div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;   .load = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,</div><div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;   .unload = <a class="code" href="../../d8/dca/res__pjsip__pubsub_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>,</div><div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;   .load_pri = <a class="code" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a>,</div><div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;   .requires = <span class="stringliteral">&quot;res_pjsip&quot;</span>,</div><div class="line"><a name="l05714"></a><span class="lineno"><a class="line" href="../../d8/dca/res__pjsip__pubsub_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae"> 5714</a></span>&#160;);</div><div class="ttc" id="structast__sip__pubsub__body__generator_html_a01fdd40c6cfdff735455dee9436346d6"><div class="ttname"><a href="../../df/dc3/structast__sip__pubsub__body__generator.html#a01fdd40c6cfdff735455dee9436346d6">ast_sip_pubsub_body_generator::to_string</a></div><div class="ttdeci">void(* to_string)(void *body, struct ast_str **str)</div><div class="ttdoc">Convert the body to a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00636">res_pjsip_pubsub.h:636</a></div></div>
<div class="ttc" id="sched_8h_html_a8ae97d1549b62cfbfc78bd92efe48005"><div class="ttname"><a href="../../d7/d00/sched_8h.html#a8ae97d1549b62cfbfc78bd92efe48005">ast_sched_start_thread</a></div><div class="ttdeci">int ast_sched_start_thread(struct ast_sched_context *con)</div><div class="ttdoc">Start a thread for processing scheduler entries. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/sched_8c_source.html#l00195">sched.c:195</a></div></div>
<div class="ttc" id="vector_8h_html_a66aaa4efda59c52384b03c38e781124d"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a></div><div class="ttdeci">#define AST_VECTOR_FREE(vec)</div><div class="ttdoc">Deallocates this vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00174">vector.h:174</a></div></div>
<div class="ttc" id="structast__variable_html_afaaf66cc5029a563bd0bb9df076ea14b"><div class="ttname"><a href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">ast_variable::next</a></div><div class="ttdeci">struct ast_variable * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00090">include/asterisk/config.h:90</a></div></div>
<div class="ttc" id="structsimple__message__summary_html_a001b7c3c0183b1012cffd3d9498cc384"><div class="ttname"><a href="../../d0/d4c/structsimple__message__summary.html#a001b7c3c0183b1012cffd3d9498cc384">simple_message_summary::voice_messages_new</a></div><div class="ttdeci">int voice_messages_new</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03578">res_pjsip_pubsub.c:3578</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_adcc803ec5ffc0029b9be176cc090f135"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#adcc803ec5ffc0029b9be176cc090f135">ast_sip_create_subscription</a></div><div class="ttdeci">struct ast_sip_subscription * ast_sip_create_subscription(const struct ast_sip_subscription_handler *handler, struct ast_sip_endpoint *endpoint, const char *resource)</div><div class="ttdoc">Create a new ast_sip_subscription structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01868">res_pjsip_pubsub.c:1868</a></div></div>
<div class="ttc" id="structast__sip__publish__handler_html_aeccf279e6fca0e5f8536fdf76c838728"><div class="ttname"><a href="../../d5/d9f/structast__sip__publish__handler.html#aeccf279e6fca0e5f8536fdf76c838728">ast_sip_publish_handler::event_name</a></div><div class="ttdeci">const char * event_name</div><div class="ttdoc">The name of the event this handler deals with. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00051">res_pjsip_pubsub.h:51</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a4d63fdfe5451ec2248c16a2739190c56"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a></div><div class="ttdeci">static const char type[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00109">chan_ooh323.c:109</a></div></div>
<div class="ttc" id="chan__sip_8c_html_a14a9662e09deed264497073732fb014a"><div class="ttname"><a href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a></div><div class="ttdeci">enum sip_cc_notify_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dfe/chan__sip_8c_source.html#l00959">chan_sip.c:959</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a52a5833004176713878b9cbf3c311ec0"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a52a5833004176713878b9cbf3c311ec0">find_pub_handler</a></div><div class="ttdeci">static struct ast_sip_publish_handler * find_pub_handler(const char *event)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03084">res_pjsip_pubsub.c:3084</a></div></div>
<div class="ttc" id="structast__sip__notifier_html_ac400184f8d9f71baaaf9d294d33c1ca8"><div class="ttname"><a href="../../d1/d5b/structast__sip__notifier.html#ac400184f8d9f71baaaf9d294d33c1ca8">ast_sip_notifier::get_notify_data</a></div><div class="ttdeci">void *(* get_notify_data)(struct ast_sip_subscription *sub)</div><div class="ttdoc">Supply data needed to create a NOTIFY body. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00294">res_pjsip_pubsub.h:294</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_adba83183b8ab9dfd5b4ce87ddafc78a1"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#adba83183b8ab9dfd5b4ce87ddafc78a1">tree_node_alloc</a></div><div class="ttdeci">static struct tree_node * tree_node_alloc(const char *resource, struct resources *visited, unsigned int full_state)</div><div class="ttdoc">Allocate a tree node. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00934">res_pjsip_pubsub.c:934</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a05c2af54560a8245eef9bd323c2f758b"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a05c2af54560a8245eef9bd323c2f758b">subscription_tree_destructor</a></div><div class="ttdeci">static void subscription_tree_destructor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01367">res_pjsip_pubsub.c:1367</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a19dd0f9dd8ac29890f8e90159ca7fb78"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a19dd0f9dd8ac29890f8e90159ca7fb78">generate_initial_notify</a></div><div class="ttdeci">static int generate_initial_notify(struct ast_sip_subscription *sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02887">res_pjsip_pubsub.c:2887</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a36292f9aacdecd44efe47fa591beb400a3ac2fdd9911335d820131a694972a2e3"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400a3ac2fdd9911335d820131a694972a2e3">SUBSCRIPTION_PERSISTENCE_CREATED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00527">res_pjsip_pubsub.c:527</a></div></div>
<div class="ttc" id="structnode_html"><div class="ttname"><a href="../../d5/da1/structnode.html">node</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d2b/test__heap_8c_source.html#l00038">test_heap.c:38</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__generator_html_a35514bc6335d541353cf54c7146e8ce5"><div class="ttname"><a href="../../df/dc3/structast__sip__pubsub__body__generator.html#a35514bc6335d541353cf54c7146e8ce5">ast_sip_pubsub_body_generator::body_type</a></div><div class="ttdeci">const char * body_type</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00603">res_pjsip_pubsub.h:603</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a6bb5769d100d0348446c7f032eca58c1"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a6bb5769d100d0348446c7f032eca58c1">AST_SIP_USER_OPTIONS_TRUNCATE_CHECK</a></div><div class="ttdeci">#define AST_SIP_USER_OPTIONS_TRUNCATE_CHECK(str)</div><div class="ttdoc">Truncate the URI user field options string if enabled. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l03036">res_pjsip.h:3036</a></div></div>
<div class="ttc" id="cli_8h_html_a5c4130cf8f1e93acfdd84416cebf1aef"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a></div><div class="ttdeci">#define AST_CLI_DEFINE(fn, txt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00197">cli.h:197</a></div></div>
<div class="ttc" id="structast__sip__publication_html_a9a3b4be1b9151b0369d7fca9911c7ecd"><div class="ttname"><a href="../../d4/da6/structast__sip__publication.html#a9a3b4be1b9151b0369d7fca9911c7ecd">ast_sip_publication::data</a></div><div class="ttdeci">char data[0]</div><div class="ttdoc">Data containing the above. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00363">res_pjsip_pubsub.c:363</a></div></div>
<div class="ttc" id="structast__party__number_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_number::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber phone number (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00292">channel.h:292</a></div></div>
<div class="ttc" id="json_8h_html_a0ca956b7df20127f7e38993c3c06cb2c"><div class="ttname"><a href="../../d4/d05/json_8h.html#a0ca956b7df20127f7e38993c3c06cb2c">ast_json_ref</a></div><div class="ttdeci">struct ast_json * ast_json_ref(struct ast_json *value)</div><div class="ttdoc">Increase refcount on value. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00067">json.c:67</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_ac02d9f08d76f5be5e9c998ca541c05b9"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#ac02d9f08d76f5be5e9c998ca541c05b9">sip_subscription_tree::root</a></div><div class="ttdeci">struct ast_sip_subscription * root</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00451">res_pjsip_pubsub.c:451</a></div></div>
<div class="ttc" id="structresource__list_html_a0e85270ccb77c71eb8f9693642c46daf"><div class="ttname"><a href="../../df/dd0/structresource__list.html#a0e85270ccb77c71eb8f9693642c46daf">resource_list::SORCERY_OBJECT</a></div><div class="ttdeci">SORCERY_OBJECT(details)</div></div>
<div class="ttc" id="structmessage_html"><div class="ttname"><a href="../../d8/d9e/structmessage.html">message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00144">manager.h:144</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ab47623e207bf2cdd0edfa613d91894e5"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ab47623e207bf2cdd0edfa613d91894e5">ast_taskprocessor_build_name</a></div><div class="ttdeci">void ast_taskprocessor_build_name(char *buf, unsigned int size, const char *format,...)</div><div class="ttdoc">Build a taskprocessor name with a sequence number on the end. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01295">taskprocessor.c:1295</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a36292f9aacdecd44efe47fa591beb400ac38cc588801abf190a87dc6c4220b240"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400ac38cc588801abf190a87dc6c4220b240">SUBSCRIPTION_PERSISTENCE_REFRESHED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00531">res_pjsip_pubsub.c:531</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a8f6a1ab8c6d5f63fbcc96ea70e0160cf"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a8f6a1ab8c6d5f63fbcc96ea70e0160cf">pubsub_on_rx_refresh</a></div><div class="ttdeci">static void pubsub_on_rx_refresh(pjsip_evsub *sub, pjsip_rx_data *rdata, int *p_st_code, pj_str_t **p_st_text, pjsip_hdr *res_hdr, pjsip_msg_body **p_body)</div><div class="ttdoc">Called whenever an in-dialog SUBSCRIBE is received. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03911">res_pjsip_pubsub.c:3911</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a31880cde88a125b5079ac946cc352603"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a31880cde88a125b5079ac946cc352603">create_resource_list</a></div><div class="ttdeci">static struct resource_list * create_resource_list(struct ast_test *test, const char *list_name, const char *event, const char **resources, size_t num_resources)</div><div class="ttdoc">allocate a resource list, store it in sorcery, and set its details </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04983">res_pjsip_pubsub.c:4983</a></div></div>
<div class="ttc" id="structresource__list_html_a5053da7047dfe40d67229c5dbc361f8b"><div class="ttname"><a href="../../df/dd0/structresource__list.html#a5053da7047dfe40d67229c5dbc361f8b">resource_list::event</a></div><div class="ttdeci">char event[32]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00328">res_pjsip_pubsub.c:328</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac2d42f7be13c532b6a70d50f1b8983d2"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a></div><div class="ttdeci">void astman_append(struct mansession *s, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03080">manager.c:3080</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="structast__sip__body__data_html_a086f833f6f250c98d7bcd80f9a573d06"><div class="ttname"><a href="../../d1/de8/structast__sip__body__data.html#a086f833f6f250c98d7bcd80f9a573d06">ast_sip_body_data::body_data</a></div><div class="ttdeci">void * body_data</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00243">res_pjsip_pubsub.h:243</a></div></div>
<div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a4dba55f11df69f28d19d9125e3995334"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a4dba55f11df69f28d19d9125e3995334">pubsub_on_rx_publish_request</a></div><div class="ttdeci">static pj_bool_t pubsub_on_rx_publish_request(pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03326">res_pjsip_pubsub.c:3326</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a386166c75f00c0b4d1878e3a6d666e89"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89">sip_subscription_tree_state</a></div><div class="ttdeci">sip_subscription_tree_state</div><div class="ttdoc">The state of the subscription tree. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00404">res_pjsip_pubsub.c:404</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a3d0a8fc757c1fb1e064887580d4ba1ea"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a3d0a8fc757c1fb1e064887580d4ba1ea">find_body_generator_type_subtype_nolock</a></div><div class="ttdeci">static struct ast_sip_pubsub_body_generator * find_body_generator_type_subtype_nolock(const char *type, const char *subtype)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02825">res_pjsip_pubsub.c:2825</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a9321a33ad3bd557f07e777bcdd6afb79"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a9321a33ad3bd557f07e777bcdd6afb79">ami_subscription_detail_inbound</a></div><div class="ttdeci">static int ami_subscription_detail_inbound(struct sip_subscription_tree *sub_tree, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04050">res_pjsip_pubsub.c:4050</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aefd01cccb44e52e8c576785903382206"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aefd01cccb44e52e8c576785903382206">ast_sip_publication_add_datastore</a></div><div class="ttdeci">int ast_sip_publication_add_datastore(struct ast_sip_publication *publication, struct ast_datastore *datastore)</div><div class="ttdoc">Add a datastore to a SIP publication. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02649">res_pjsip_pubsub.c:2649</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a3e9568af1e66909dc6d642070e02b1a0"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a3e9568af1e66909dc6d642070e02b1a0">serialized_send_notify</a></div><div class="ttdeci">static int serialized_send_notify(void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02462">res_pjsip_pubsub.c:2462</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a025e1fa7b644cd3de8f0f7fe4ab42100"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a025e1fa7b644cd3de8f0f7fe4ab42100">CLI_SHOW_SUB_FORMAT_ENTRY</a></div><div class="ttdeci">#define CLI_SHOW_SUB_FORMAT_ENTRY</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04379">res_pjsip_pubsub.c:4379</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a39918fd433ac42184b152c86016ef139"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a39918fd433ac42184b152c86016ef139">AST_RWLIST_HEAD_STATIC</a></div><div class="ttdeci">#define AST_RWLIST_HEAD_STATIC(name, type)</div><div class="ttdoc">Defines a structure to be used to hold a read/write list of specified type, statically initialized...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00332">linkedlists.h:332</a></div></div>
<div class="ttc" id="module_8h_html_ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15"><div class="ttname"><a href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00121">module.h:121</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a7ef69ae2e93f18a3a6cc53e4759b332f"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a7ef69ae2e93f18a3a6cc53e4759b332f">sched_cb</a></div><div class="ttdeci">static int sched_cb(const void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02500">res_pjsip_pubsub.c:2500</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a75e6251ec7546725dcb5cc72bf6b60ce"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a75e6251ec7546725dcb5cc72bf6b60ce">AMI_SHOW_SUBSCRIPTIONS_OUTBOUND</a></div><div class="ttdeci">#define AMI_SHOW_SUBSCRIPTIONS_OUTBOUND</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04136">res_pjsip_pubsub.c:4136</a></div></div>
<div class="ttc" id="structinitial__notify__data_html_a06552650d7ef9108d5744ee3f3fff264"><div class="ttname"><a href="../../df/dbb/structinitial__notify__data.html#a06552650d7ef9108d5744ee3f3fff264">initial_notify_data::expires</a></div><div class="ttdeci">unsigned int expires</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01536">res_pjsip_pubsub.c:1536</a></div></div>
<div class="ttc" id="callerid_8h_html"><div class="ttname"><a href="../../de/d47/callerid_8h.html">callerid.h</a></div><div class="ttdoc">CallerID (and other GR30) management and generation Includes code and algorithms from the Zapata libr...</div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_adea5390496e5477192d86f340d512d04"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a></div><div class="ttdeci">void ast_variables_destroy(struct ast_variable *var)</div><div class="ttdoc">Free variable list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l01263">extconf.c:1263</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ae55303c463ee7d4709335ae3311c3826"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ae55303c463ee7d4709335ae3311c3826">rlmi_media_type</a></div><div class="ttdeci">static pjsip_media_type rlmi_media_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00539">res_pjsip_pubsub.c:539</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a55772a6ad10b532f9ae2085ceb0c3942"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a55772a6ad10b532f9ae2085ceb0c3942">remove_subscription</a></div><div class="ttdeci">static void remove_subscription(struct sip_subscription_tree *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01182">res_pjsip_pubsub.c:1182</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a8deba4f5b210a282252f719b1a245029"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a8deba4f5b210a282252f719b1a245029">pubsub_on_rx_request</a></div><div class="ttdeci">static pj_bool_t pubsub_on_rx_request(pjsip_rx_data *rdata)</div><div class="ttdoc">Opaque structure representing an RFC 3265 SIP subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03707">res_pjsip_pubsub.c:3707</a></div></div>
<div class="ttc" id="conf2ael_8c_html_a74bb62276efdf39dd94048e007fca05b"><div class="ttname"><a href="../../de/dcc/conf2ael_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a></div><div class="ttdeci">char * config</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcc/conf2ael_8c_source.html#l00066">conf2ael.c:66</a></div></div>
<div class="ttc" id="structast__sip__subscription__handler_html_aa63e03b2552c36d21f2bb7bffd26a06a"><div class="ttname"><a href="../../d8/d6c/structast__sip__subscription__handler.html#aa63e03b2552c36d21f2bb7bffd26a06a">ast_sip_subscription_handler::subscriber</a></div><div class="ttdeci">struct ast_sip_subscriber * subscriber</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00337">res_pjsip_pubsub.h:337</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_af9e99216a3b9def7b033ec0404e4140f"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#af9e99216a3b9def7b033ec0404e4140f">publication_destroy_fn</a></div><div class="ttdeci">static void publication_destroy_fn(void *obj)</div><div class="ttdoc">Internal destructor for publications. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03133">res_pjsip_pubsub.c:3133</a></div></div>
<div class="ttc" id="sip_8h_html_a99c5ff7e5199a13ca4884062b413d68f"><div class="ttname"><a href="../../d1/d94/sip_8h.html#a99c5ff7e5199a13ca4884062b413d68f">media_type</a></div><div class="ttdeci">media_type</div><div class="ttdoc">Media types generate different &quot;dummy answers&quot; for not accepting the offer of a media stream...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d94/sip_8h_source.html#l00489">sip.h:489</a></div></div>
<div class="ttc" id="structsubscription__handlers_html"><div class="ttname"><a href="../../d2/d1b/structsubscription__handlers.html">subscription_handlers</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02754">res_pjsip_pubsub.c:2754</a></div></div>
<div class="ttc" id="structcli__sub__parms_html_a883e4c7acb41c38b2fc01a0d80ed83ec"><div class="ttname"><a href="../../dc/d55/structcli__sub__parms.html#a883e4c7acb41c38b2fc01a0d80ed83ec">cli_sub_parms::e</a></div><div class="ttdeci">struct ast_cli_entry * e</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04142">res_pjsip_pubsub.c:4142</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a386166c75f00c0b4d1878e3a6d666e89af7fea613b9dafd6f664eea50435fea4e"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af7fea613b9dafd6f664eea50435fea4e">SIP_SUB_TREE_NORMAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00406">res_pjsip_pubsub.c:406</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a786140dcdee30f86fc9a661c515982bb"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a786140dcdee30f86fc9a661c515982bb">rlmi_print_body</a></div><div class="ttdeci">static int rlmi_print_body(struct pjsip_msg_body *msg_body, char *buf, pj_size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02127">res_pjsip_pubsub.c:2127</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a16d299943a24f9857d3e847b83073d5d"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a16d299943a24f9857d3e847b83073d5d">ast_sip_unregister_subscription_handler</a></div><div class="ttdeci">void ast_sip_unregister_subscription_handler(struct ast_sip_subscription_handler *handler)</div><div class="ttdoc">Unregister a subscription handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02810">res_pjsip_pubsub.c:2810</a></div></div>
<div class="ttc" id="structast__sip__subscription_html_a1f889c1c1ee1ab4174d6b34771d6951d"><div class="ttname"><a href="../../db/d02/structast__sip__subscription.html#a1f889c1c1ee1ab4174d6b34771d6951d">ast_sip_subscription::tree</a></div><div class="ttdeci">struct sip_subscription_tree * tree</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00483">res_pjsip_pubsub.c:483</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a9b75abdc267ce4a677b7eaa67ead3c20a3c10d5621e8e7278503d4ea4c13cedc1"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20a3c10d5621e8e7278503d4ea4c13cedc1">AST_SIP_SUBSCRIBER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00192">res_pjsip_pubsub.h:192</a></div></div>
<div class="ttc" id="cli_8h_html_a56b6b59ee2eaa994597a5b0f4e9f9d09"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a></div><div class="ttdeci">int ast_cli_unregister_multiple(struct ast_cli_entry *e, int len)</div><div class="ttdoc">Unregister multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00030">clicompat.c:30</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a7f71e2a3aca3dcf8077d9c7edcb34325"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f71e2a3aca3dcf8077d9c7edcb34325">pubsub_module</a></div><div class="ttdeci">static struct pjsip_module pubsub_module</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00229">res_pjsip_pubsub.c:229</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a81489602b194ea87cae6470409bee3b5"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a81489602b194ea87cae6470409bee3b5">ast_sip_subscription_get_serializer</a></div><div class="ttdeci">struct ast_taskprocessor * ast_sip_subscription_get_serializer(struct ast_sip_subscription *sub)</div><div class="ttdoc">Get the serializer for the subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01942">res_pjsip_pubsub.c:1942</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__generator_html"><div class="ttname"><a href="../../df/dc3/structast__sip__pubsub__body__generator.html">ast_sip_pubsub_body_generator</a></div><div class="ttdoc">Pubsub body generator. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00591">res_pjsip_pubsub.h:591</a></div></div>
<div class="ttc" id="structbody__part_html"><div class="ttname"><a href="../../d2/de8/structbody__part.html">body_part</a></div><div class="ttdoc">A multipart body part and meta-information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02080">res_pjsip_pubsub.c:2080</a></div></div>
<div class="ttc" id="utils_8h_html_a00d4c9254c9827d6fa44f17a326744a5"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a></div><div class="ttdeci">#define ast_test_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00063">utils.h:63</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__supplement_html"><div class="ttname"><a href="../../d7/d72/structast__sip__pubsub__body__supplement.html">ast_sip_pubsub_body_supplement</a></div><div class="ttdoc">Body supplement. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00656">res_pjsip_pubsub.h:656</a></div></div>
<div class="ttc" id="structast__sip__ami_html_ad43c3812e6d13e0518d9f8b8f463ffcf"><div class="ttname"><a href="../../d4/d2f/structast__sip__ami.html#ad43c3812e6d13e0518d9f8b8f463ffcf">ast_sip_ami::count</a></div><div class="ttdeci">int count</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02747">res_pjsip.h:2747</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ae5e6ba3b3b049c415ad3056467cc846c"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ae5e6ba3b3b049c415ad3056467cc846c">subscription_persistence_destroy</a></div><div class="ttdeci">static void subscription_persistence_destroy(void *obj)</div><div class="ttdoc">Destructor for subscription persistence. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00621">res_pjsip_pubsub.c:621</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__generator_html_a763fd8db6bba8fbbbc113ca0d61c47c2"><div class="ttname"><a href="../../df/dc3/structast__sip__pubsub__body__generator.html#a763fd8db6bba8fbbbc113ca0d61c47c2">ast_sip_pubsub_body_generator::type</a></div><div class="ttdeci">const char * type</div><div class="ttdoc">Content type In &quot;plain/text&quot;, &quot;plain&quot; is the type. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00596">res_pjsip_pubsub.h:596</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#a3960205b2a4e7e012dc9f0eae1855f01">sip_subscription_tree::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00433">res_pjsip_pubsub.c:433</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aa8ca8ca978fb48dc5a57ce618b36c0b5"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aa8ca8ca978fb48dc5a57ce618b36c0b5">ast_sip_publication_get_datastores</a></div><div class="ttdeci">struct ao2_container * ast_sip_publication_get_datastores(const struct ast_sip_publication *publication)</div><div class="ttdoc">Get the datastores container for a publication. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02664">res_pjsip_pubsub.c:2664</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a00a4fae74e9482fb6c95acb3d653a182"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a00a4fae74e9482fb6c95acb3d653a182">subscription_persistence_create</a></div><div class="ttdeci">static struct subscription_persistence * subscription_persistence_create(struct sip_subscription_tree *sub_tree)</div><div class="ttdoc">Function which creates initial persistence information of a subscription in sorcery. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00637">res_pjsip_pubsub.c:637</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_af83103f48a2651972c0fc351bfd701bb"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#af83103f48a2651972c0fc351bfd701bb">accept_exceptions</a></div><div class="ttdeci">const char * accept_exceptions[]</div><div class="ttdoc">Accept headers that are exceptions to the rule. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00806">res_pjsip_pubsub.c:806</a></div></div>
<div class="ttc" id="structast__sip__body__data_html_a35514bc6335d541353cf54c7146e8ce5"><div class="ttname"><a href="../../d1/de8/structast__sip__body__data.html#a35514bc6335d541353cf54c7146e8ce5">ast_sip_body_data::body_type</a></div><div class="ttdeci">const char * body_type</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00241">res_pjsip_pubsub.h:241</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a161e2b74b0b3b249c8c9e3ba8bb782ae"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a161e2b74b0b3b249c8c9e3ba8bb782ae">cli_show_subscriptions_outbound</a></div><div class="ttdeci">static int cli_show_subscriptions_outbound(struct sip_subscription_tree *sub_tree, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04427">res_pjsip_pubsub.c:4427</a></div></div>
<div class="ttc" id="structast__sip__body__data_html"><div class="ttname"><a href="../../d1/de8/structast__sip__body__data.html">ast_sip_body_data</a></div><div class="ttdoc">Data used to create bodies for NOTIFY/PUBLISH requests. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00239">res_pjsip_pubsub.h:239</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ad7c1f2dfc743e57aadd39d0be4b97e97"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ad7c1f2dfc743e57aadd39d0be4b97e97">pjsip_publish_method</a></div><div class="ttdeci">const pjsip_method pjsip_publish_method</div><div class="ttdoc">Defined method for PUBLISH. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00256">res_pjsip_pubsub.c:256</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a8ebc5adf3564428c0201cff2376dd187"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a8ebc5adf3564428c0201cff2376dd187">add_subscription</a></div><div class="ttdeci">static void add_subscription(struct sip_subscription_tree *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01175">res_pjsip_pubsub.c:1175</a></div></div>
<div class="ttc" id="json_8h_html_a33bcd9181e613a659eefe411ec42c87c"><div class="ttname"><a href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a></div><div class="ttdeci">void ast_json_unref(struct ast_json *value)</div><div class="ttdoc">Decrease refcount on value. If refcount reaches zero, value is freed. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00073">json.c:73</a></div></div>
<div class="ttc" id="structast__party__id_html_aab4036618469f3fa9ab26a22726ba2db"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">ast_party_id::name</a></div><div class="ttdeci">struct ast_party_name name</div><div class="ttdoc">Subscriber name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00341">channel.h:341</a></div></div>
<div class="ttc" id="astobj2_8h_html_a22f40c733a085f259af94e864ebaa09a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a></div><div class="ttdeci">#define OBJ_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01155">astobj2.h:1155</a></div></div>
<div class="ttc" id="structast__sip__ami_html_ac0506a88d121327118c7346baa303a9e"><div class="ttname"><a href="../../d4/d2f/structast__sip__ami.html#ac0506a88d121327118c7346baa303a9e">ast_sip_ami::m</a></div><div class="ttdeci">const struct message * m</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02741">res_pjsip.h:2741</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_acd8fc16260b8a617c3d028b66745d5ad"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#acd8fc16260b8a617c3d028b66745d5ad">pubsub_on_rx_subscribe_request</a></div><div class="ttdeci">static pj_bool_t pubsub_on_rx_subscribe_request(pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02969">res_pjsip_pubsub.c:2969</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga74acadc4e87ea1cea9cdddba4734bccc"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga74acadc4e87ea1cea9cdddba4734bccc">ast_sip_sched_task_cancel</a></div><div class="ttdeci">int ast_sip_sched_task_cancel(struct ast_sip_sched_task *schtd)</div><div class="ttdoc">Cancels the next invocation of a task. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfa/pjsip__scheduler_8c_source.html#l00191">pjsip_scheduler.c:191</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga86c62fe22e3b7fb409c13ec7fd4fee2d"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga86c62fe22e3b7fb409c13ec7fd4fee2d">ast_sip_dialog_set_serializer</a></div><div class="ttdeci">void ast_sip_dialog_set_serializer(pjsip_dialog *dlg, struct ast_taskprocessor *serializer)</div><div class="ttdoc">Set a serializer on a SIP dialog so requests and responses are automatically serialized. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dad/pjsip__distributor_8c_source.html#l00266">pjsip_distributor.c:266</a></div></div>
<div class="ttc" id="res__pjsip__private_8h_html"><div class="ttname"><a href="../../d7/d5c/res__pjsip__private_8h.html">res_pjsip_private.h</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a2d0cf4182bade9f773fb16ff12abe595"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a></div><div class="ttdeci">#define AST_RWLIST_WRLOCK(head)</div><div class="ttdoc">Write locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00051">linkedlists.h:51</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_a08e0b4a94cab7d431f1717d53d619447"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#a08e0b4a94cab7d431f1717d53d619447">subscription_persistence::prune_on_boot</a></div><div class="ttdeci">int prune_on_boot</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00396">res_pjsip_pubsub.c:396</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a8dcc5a2234d92546bbeeead95aa648ec"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a8dcc5a2234d92546bbeeead95aa648ec">persistence_generator_data_str2struct</a></div><div class="ttdeci">static int persistence_generator_data_str2struct(const struct aco_option *opt, struct ast_variable *var, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04705">res_pjsip_pubsub.c:4705</a></div></div>
<div class="ttc" id="test_8h_html_a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00208">test.h:208</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga58c3e3da5d31739cafaee1df6ddf9342"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a></div><div class="ttdeci">void astman_send_list_complete_start(struct mansession *s, const struct message *m, const char *event_name, int count)</div><div class="ttdoc">Start the list complete event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03237">manager.c:3237</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a6a2ec9c29cf673a20f527615e5acb98b"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a6a2ec9c29cf673a20f527615e5acb98b">parse_simple_message_summary</a></div><div class="ttdeci">static int parse_simple_message_summary(char *body, struct simple_message_summary *summary)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03585">res_pjsip_pubsub.c:3585</a></div></div>
<div class="ttc" id="structast__module__info_html"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html">ast_module_info</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00336">module.h:336</a></div></div>
<div class="ttc" id="structast__cli__entry_html"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a></div><div class="ttdoc">descriptor for a cli entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00171">cli.h:171</a></div></div>
<div class="ttc" id="structast__cli__args_html_a98e1d8441ca58834f11f7367be4b3345"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">ast_cli_args::argc</a></div><div class="ttdeci">const int argc</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00160">cli.h:160</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a55abfb60c70c5e948521709e10e54492"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a55abfb60c70c5e948521709e10e54492">build_node_children</a></div><div class="ttdeci">static void build_node_children(struct ast_sip_endpoint *endpoint, const struct ast_sip_subscription_handler *handler, struct resource_list *list, struct tree_node *parent, struct resources *visited)</div><div class="ttdoc">Build child nodes for a given parent. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01021">res_pjsip_pubsub.c:1021</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_aaee14820d45bd0be318822580b5a8b59"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#aaee14820d45bd0be318822580b5a8b59">ast_sip_transport_monitor_register</a></div><div class="ttdeci">enum ast_transport_monitor_reg ast_sip_transport_monitor_register(pjsip_transport *transport, ast_transport_monitor_shutdown_cb cb, void *ao2_data)</div><div class="ttdoc">Register a reliable transport shutdown monitor callback. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d94/pjsip__transport__events_8c_source.html#l00306">pjsip_transport_events.c:306</a></div></div>
<div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_acb194881d03c561cd60d0c88f82c7478"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#acb194881d03c561cd60d0c88f82c7478">initial_notify_task</a></div><div class="ttdeci">static int initial_notify_task(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02929">res_pjsip_pubsub.c:2929</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_gga478c7100d82665dc492845e4213ebc40a8d01d6eb6543f97d3289df2cbe6de212"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#gga478c7100d82665dc492845e4213ebc40a8d01d6eb6543f97d3289df2cbe6de212">AST_SIP_SCHED_TASK_FIXED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l01778">res_pjsip.h:1778</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a2dba366491005a78cb1b67070de74a6e"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a2dba366491005a78cb1b67070de74a6e">build_body_part</a></div><div class="ttdeci">static void build_body_part(pj_pool_t *pool, struct ast_sip_subscription *sub, struct body_part_list *parts, unsigned int use_full_state)</div><div class="ttdoc">Create a multipart body part for a subscribed resource. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02258">res_pjsip_pubsub.c:2258</a></div></div>
<div class="ttc" id="structast__json__payload_html"><div class="ttname"><a href="../../d9/de9/structast__json__payload.html">ast_json_payload</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d05/json_8h_source.html#l01024">json.h:1024</a></div></div>
<div class="ttc" id="astobj2_8h_html_a47857055118a703ae87ea5ebaf4842ed"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a></div><div class="ttdeci">#define ao2_callback(c, flags, cb_fn, arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01716">astobj2.h:1716</a></div></div>
<div class="ttc" id="structast__sip__subscription__handler_html_a06762434263891503f1fe196fd2cf613"><div class="ttname"><a href="../../d8/d6c/structast__sip__subscription__handler.html#a06762434263891503f1fe196fd2cf613">ast_sip_subscription_handler::notifier</a></div><div class="ttdeci">struct ast_sip_notifier * notifier</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00339">res_pjsip_pubsub.h:339</a></div></div>
<div class="ttc" id="json_8h_html_a38eea5afa847432f7c10af8e69fb013e"><div class="ttname"><a href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a></div><div class="ttdeci">void ast_json_free(void *p)</div><div class="ttdoc">Asterisk&amp;#39;s custom JSON allocator. Exposed for use by unit tests. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00052">json.c:52</a></div></div>
<div class="ttc" id="structast__sip__ami_html_a9ce2ec4812a92cb6ab39f6e81e9173a9"><div class="ttname"><a href="../../d4/d2f/structast__sip__ami.html#a9ce2ec4812a92cb6ab39f6e81e9173a9">ast_sip_ami::arg</a></div><div class="ttdeci">void * arg</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02745">res_pjsip.h:2745</a></div></div>
<div class="ttc" id="structast__sip__ami_html"><div class="ttname"><a href="../../d4/d2f/structast__sip__ami.html">ast_sip_ami</a></div><div class="ttdoc">AMI variable container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02737">res_pjsip.h:2737</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a2e9a2518b5029b96671aff6701bd5138"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a></div><div class="ttdeci">#define AST_RWLIST_UNLOCK(head)</div><div class="ttdoc">Attempts to unlock a read/write based list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00150">linkedlists.h:150</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_ade656f40303348a90111082ae08708b1"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#ade656f40303348a90111082ae08708b1">subscription_persistence::local_name</a></div><div class="ttdeci">char local_name[PJ_INET6_ADDRSTRLEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00384">res_pjsip_pubsub.c:384</a></div></div>
<div class="ttc" id="structast__sip__subscription__handler_html_a37cb3e0e7b0966a69f790d8d182d8cd0"><div class="ttname"><a href="../../d8/d6c/structast__sip__subscription__handler.html#a37cb3e0e7b0966a69f790d8d182d8cd0">ast_sip_subscription_handler::accept</a></div><div class="ttdeci">const char * accept[AST_SIP_MAX_ACCEPT]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00320">res_pjsip_pubsub.h:320</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_afc353f33f479f252b0cea51d55afc7ca"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#afc353f33f479f252b0cea51d55afc7ca">DEFAULT_EXPIRES</a></div><div class="ttdeci">#define DEFAULT_EXPIRES</div><div class="ttdoc">Default expiration for subscriptions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00253">res_pjsip_pubsub.c:253</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a93eb8c4f7adc89002faae30ba3b1da7d"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a93eb8c4f7adc89002faae30ba3b1da7d">publish_expire</a></div><div class="ttdeci">static int publish_expire(const void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03312">res_pjsip_pubsub.c:3312</a></div></div>
<div class="ttc" id="structast__sip__endpoint__id__configuration_html"><div class="ttname"><a href="../../d4/df6/structast__sip__endpoint__id__configuration.html">ast_sip_endpoint_id_configuration</a></div><div class="ttdoc">Party identification options for endpoints. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00628">res_pjsip.h:628</a></div></div>
<div class="ttc" id="structast__variable_html"><div class="ttname"><a href="../../dd/d02/structast__variable.html">ast_variable</a></div><div class="ttdoc">Structure for variables, used for configurations and for channel variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00083">include/asterisk/config.h:83</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="vector_8h_html_ae9d6199727f88a8c2407cb0e004e634a"><div class="ttname"><a href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a></div><div class="ttdeci">#define AST_VECTOR_APPEND(vec, elem)</div><div class="ttdoc">Append an element to a vector, growing the vector if needed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00256">vector.h:256</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga6d8415024c851216fa63fbb94d0aadcf"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga6d8415024c851216fa63fbb94d0aadcf">ast_sip_dialog_set_endpoint</a></div><div class="ttdeci">void ast_sip_dialog_set_endpoint(pjsip_dialog *dlg, struct ast_sip_endpoint *endpoint)</div><div class="ttdoc">Set an endpoint on a SIP dialog so in-dialog requests do not undergo endpoint lookup. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dad/pjsip__distributor_8c_source.html#l00294">pjsip_distributor.c:294</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a2d4ca6324c97d4c2a957dea2aa74c27b"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a2d4ca6324c97d4c2a957dea2aa74c27b">sub_tree_subscription_terminate_cb</a></div><div class="ttdeci">static int sub_tree_subscription_terminate_cb(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00572">res_pjsip_pubsub.c:572</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a22c56a35e1b346bd629dd4caf6a52f03"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a22c56a35e1b346bd629dd4caf6a52f03">ami_show_resource_lists</a></div><div class="ttdeci">static int ami_show_resource_lists(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04112">res_pjsip_pubsub.c:4112</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a7f5d6a140ec019c5cf145f0d78a946a5"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a7f5d6a140ec019c5cf145f0d78a946a5">RESOURCE_LIST_INIT_SIZE</a></div><div class="ttdeci">#define RESOURCE_LIST_INIT_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04750">res_pjsip_pubsub.c:4750</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a56c0f161f100c005d4c95b26ca3f7d7d"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a56c0f161f100c005d4c95b26ca3f7d7d">persistence_endpoint_struct2str</a></div><div class="ttdeci">static int persistence_endpoint_struct2str(const void *obj, const intptr_t *args, char **buf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04681">res_pjsip_pubsub.c:4681</a></div></div>
<div class="ttc" id="ast__expr2f_8c_html_a1b0936415a643c88ce543099c10e0d7f"><div class="ttname"><a href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a></div><div class="ttdeci">#define var</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df2/ast__expr2f_8c_source.html#l00614">ast_expr2f.c:614</a></div></div>
<div class="ttc" id="structast__json__payload_html_a9cf488298469ae63ef947653d7ff9bab"><div class="ttname"><a href="../../d9/de9/structast__json__payload.html#a9cf488298469ae63ef947653d7ff9bab">ast_json_payload::json</a></div><div class="ttdeci">struct ast_json * json</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d05/json_8h_source.html#l01025">json.h:1025</a></div></div>
<div class="ttc" id="res__pjsip__presence__xml_8h_html_af60a5851382ce5f434b07fdefc194cbe"><div class="ttname"><a href="../../d5/dc3/res__pjsip__presence__xml_8h.html#af60a5851382ce5f434b07fdefc194cbe">ast_sip_presence_xml_create_attr</a></div><div class="ttdeci">pj_xml_attr * ast_sip_presence_xml_create_attr(pj_pool_t *pool, pj_xml_node *node, const char *name, const char *value)</div><div class="ttdoc">Create XML attribute. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6b/presence__xml_8c_source.html#l00140">presence_xml.c:140</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_af59dad57f47cf8401042d4ecd0b861e5"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#af59dad57f47cf8401042d4ecd0b861e5">sip_subscription_roles_map</a></div><div class="ttdeci">static const char * sip_subscription_roles_map[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00518">res_pjsip_pubsub.c:518</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a4cf48fac09e3299c24b6f72f438c421f"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a4cf48fac09e3299c24b6f72f438c421f">format_ami_resource_lists</a></div><div class="ttdeci">static int format_ami_resource_lists(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04090">res_pjsip_pubsub.c:4090</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a495d318729babacd6785c241fcdf845a"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a495d318729babacd6785c241fcdf845a">find_body_generator_accept</a></div><div class="ttdeci">static struct ast_sip_pubsub_body_generator * find_body_generator_accept(const char *accept)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02849">res_pjsip_pubsub.c:2849</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a22d7c1042170155672514fbb16ce46eb"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a22d7c1042170155672514fbb16ce46eb">ast_sip_pubsub_unregister_body_generator</a></div><div class="ttdeci">void ast_sip_pubsub_unregister_body_generator(struct ast_sip_pubsub_body_generator *generator)</div><div class="ttdoc">Unregister a body generator with the pubsub core. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03470">res_pjsip_pubsub.c:3470</a></div></div>
<div class="ttc" id="structstasis__subscription_html"><div class="ttname"><a href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00681">stasis.c:681</a></div></div>
<div class="ttc" id="uuid_8h_html"><div class="ttname"><a href="../../dd/d1d/uuid_8h.html">uuid.h</a></div><div class="ttdoc">Universally unique identifier support. </div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a14d30548053458724404f5c041483cfa"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a14d30548053458724404f5c041483cfa">ast_sip_register_publish_handler</a></div><div class="ttdeci">int ast_sip_register_publish_handler(struct ast_sip_publish_handler *handler)</div><div class="ttdoc">Register a publish handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02718">res_pjsip_pubsub.c:2718</a></div></div>
<div class="ttc" id="json_8h_html_a51a96b2baa67b671ac68a9fcaebbaeea"><div class="ttname"><a href="../../d4/d05/json_8h.html#a51a96b2baa67b671ac68a9fcaebbaeea">ast_json_dump_string</a></div><div class="ttdeci">#define ast_json_dump_string(root)</div><div class="ttdoc">Encode a JSON value to a compact string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d05/json_8h_source.html#l00763">json.h:763</a></div></div>
<div class="ttc" id="structcli__sub__complete__parms_html_ae19846dd61ed50eb0d30e3b8bb915a8f"><div class="ttname"><a href="../../d7/df6/structcli__sub__complete__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">cli_sub_complete_parms::a</a></div><div class="ttdeci">struct ast_cli_args * a</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04153">res_pjsip_pubsub.c:4153</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ab24c7cae87fc8a55c3a59bbf69cf7352"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ab24c7cae87fc8a55c3a59bbf69cf7352">publication_resource_alloc</a></div><div class="ttdeci">static void * publication_resource_alloc(const char *name)</div><div class="ttdoc">Allocator for publication resource. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00567">res_pjsip_pubsub.c:567</a></div></div>
<div class="ttc" id="test_8h_html"><div class="ttname"><a href="../../d2/ddc/test_8h.html">test.h</a></div><div class="ttdoc">Test Framework API. </div></div>
<div class="ttc" id="sorcery_8h_html_a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a></div><div class="ttdoc">Perform no matching, return all objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00123">sorcery.h:123</a></div></div>
<div class="ttc" id="datastore_8h_html_a267b2996c54061f82ff1c5be72bbc731"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#a267b2996c54061f82ff1c5be72bbc731">ast_datastores_add</a></div><div class="ttdeci">int ast_datastores_add(struct ao2_container *datastores, struct ast_datastore *datastore)</div><div class="ttdoc">Add a data store to a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d7a/datastore_8c_source.html#l00101">datastore.c:101</a></div></div>
<div class="ttc" id="structbody__generators_html"><div class="ttname"><a href="../../dd/de0/structbody__generators.html">body_generators</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00536">res_pjsip_pubsub.c:536</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ac62bbbfecf4068411d7fa11225c91055"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ac62bbbfecf4068411d7fa11225c91055">subscription_persistence_event_cb</a></div><div class="ttdeci">static void subscription_persistence_event_cb(void *data, struct stasis_subscription *sub, struct stasis_message *message)</div><div class="ttdoc">Event callback which fires subscription persistence recreation when the system is fully booted...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01772">res_pjsip_pubsub.c:1772</a></div></div>
<div class="ttc" id="structast__sip__publish__handler_html_a3bcafa1a0d7e03921ef2883953be90ae"><div class="ttname"><a href="../../d5/d9f/structast__sip__publish__handler.html#a3bcafa1a0d7e03921ef2883953be90ae">ast_sip_publish_handler::new_publication</a></div><div class="ttdeci">int(* new_publication)(struct ast_sip_endpoint *endpoint, const char *resource, const char *event_configuration)</div><div class="ttdoc">Called when a PUBLISH to establish a new publication arrives. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00064">res_pjsip_pubsub.h:64</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aaf5faf819b36c09254d66835d498e6e0"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aaf5faf819b36c09254d66835d498e6e0">publish_expire_callback</a></div><div class="ttdeci">static int publish_expire_callback(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03301">res_pjsip_pubsub.c:3301</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ae0e71457156b5ee3447f3a7bd2877e28"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ae0e71457156b5ee3447f3a7bd2877e28">CLI_LIST_SUB_FORMAT_ENTRY</a></div><div class="ttdeci">#define CLI_LIST_SUB_FORMAT_ENTRY</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04522">res_pjsip_pubsub.c:4522</a></div></div>
<div class="ttc" id="test_8h_html_a34f64a69c09d98ceb693b077efd7ef97"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a></div><div class="ttdeci">#define AST_TEST_REGISTER(cb)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00127">test.h:127</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00152">cli.h:152</a></div></div>
<div class="ttc" id="sorcery_8h_html_a1f0ff2b69990cd594471a830dea51f6c"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a1f0ff2b69990cd594471a830dea51f6c">ast_sorcery_object_fields_register</a></div><div class="ttdeci">int ast_sorcery_object_fields_register(struct ast_sorcery *sorcery, const char *type, const char *regex, aco_option_handler config_handler, sorcery_fields_handler sorcery_handler)</div><div class="ttdoc">Register a regex for multiple fields within an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01160">sorcery.c:1160</a></div></div>
<div class="ttc" id="ast__expr2f_8c_html_a33e91cd0cef6786e9e3a27ac67707207"><div class="ttname"><a href="../../dc/df2/ast__expr2f_8c.html#a33e91cd0cef6786e9e3a27ac67707207">if</a></div><div class="ttdeci">if(!yyg-&gt;yy_init)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df2/ast__expr2f_8c_source.html#l00868">ast_expr2f.c:868</a></div></div>
<div class="ttc" id="config__options_8h_html_a5a18d813ca848db340644212d89aac1a"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a5a18d813ca848db340644212d89aac1a">CHARFLDSET</a></div><div class="ttdeci">#define CHARFLDSET(type, field)</div><div class="ttdoc">A helper macro to pass the appropriate arguments to aco_option_register for OPT_CHAR_ARRAY_T. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00835">config_options.h:835</a></div></div>
<div class="ttc" id="structast__sorcery_html"><div class="ttname"><a href="../../d2/d88/structast__sorcery.html">ast_sorcery</a></div><div class="ttdoc">Full structure for sorcery. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l00230">sorcery.c:230</a></div></div>
<div class="ttc" id="stasis_8h_html_a9356e8a29344ca4eac93088198ccff89"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_message_type(const struct stasis_message *msg)</div><div class="ttdoc">Get the message type for a stasis_message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00187">stasis_message.c:187</a></div></div>
<div class="ttc" id="config__options_8h_html_a61bb4940517e7d00e7104de8273c2144a0df2cc9dc9bf09ee71252c183fe64bd7"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a0df2cc9dc9bf09ee71252c183fe64bd7">OPT_NOOP_T</a></div><div class="ttdoc">Type for a default handler that should do nothing. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00399">config_options.h:399</a></div></div>
<div class="ttc" id="stasis_8h_html_a52b5393bef89d7781c0d039d6489de23"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a></div><div class="ttdeci">int stasis_subscription_set_filter(struct stasis_subscription *subscription, enum stasis_subscription_message_filter filter)</div><div class="ttdoc">Set the message type filtering level on a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01079">stasis.c:1079</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ae323533f795e111d13b1d7b9a3d1d973"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ae323533f795e111d13b1d7b9a3d1d973">subscription_persistence_alloc</a></div><div class="ttdeci">static void * subscription_persistence_alloc(const char *name)</div><div class="ttdoc">Allocator for subscription persistence. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00631">res_pjsip_pubsub.c:631</a></div></div>
<div class="ttc" id="structast__datastore__info_html"><div class="ttname"><a href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a></div><div class="ttdoc">Structure for a data store type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00031">datastore.h:31</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_a6d2d1c31529bee906473fcabaffff34f"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#a6d2d1c31529bee906473fcabaffff34f">subscription_persistence::endpoint</a></div><div class="ttdeci">char * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00374">res_pjsip_pubsub.c:374</a></div></div>
<div class="ttc" id="structast__party__name_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_name::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber name (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00265">channel.h:265</a></div></div>
<div class="ttc" id="module_8h_html_aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0"><div class="ttname"><a href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00326">module.h:326</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a8d089a744841fa628f7dc8f09d70db04"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a8d089a744841fa628f7dc8f09d70db04">ast_sip_pubsub_register_body_generator</a></div><div class="ttdeci">int ast_sip_pubsub_register_body_generator(struct ast_sip_pubsub_body_generator *generator)</div><div class="ttdoc">Register a body generator with the pubsub core. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03440">res_pjsip_pubsub.c:3440</a></div></div>
<div class="ttc" id="sched_8h_html_a11e2d4283c11790a27a0f899dab00e93"><div class="ttname"><a href="../../d7/d00/sched_8h.html#a11e2d4283c11790a27a0f899dab00e93">AST_SCHED_DEL_UNREF</a></div><div class="ttdeci">#define AST_SCHED_DEL_UNREF(sched, id, refcall)</div><div class="ttdoc">schedule task to get deleted and call unref function </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d00/sched_8h_source.html#l00080">sched.h:80</a></div></div>
<div class="ttc" id="structbody__part_html_a97b7ef5a69a288651ec0d5acbe75d36d"><div class="ttname"><a href="../../d2/de8/structbody__part.html#a97b7ef5a69a288651ec0d5acbe75d36d">body_part::resource</a></div><div class="ttdeci">const char * resource</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02084">res_pjsip_pubsub.c:2084</a></div></div>
<div class="ttc" id="structevent_html"><div class="ttname"><a href="../../df/d7d/structevent.html">event</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d4d/astman_8c_source.html#l00222">astman.c:222</a></div></div>
<div class="ttc" id="structresource__tree_html_a2dce9d43da01d556f3a1d694d03a40a9"><div class="ttname"><a href="../../d9/d6a/structresource__tree.html#a2dce9d43da01d556f3a1d694d03a40a9">resource_tree::root</a></div><div class="ttdeci">struct tree_node * root</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01096">res_pjsip_pubsub.c:1096</a></div></div>
<div class="ttc" id="structsubscription__persistence_html"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html">subscription_persistence</a></div><div class="ttdoc">Structure used for persisting an inbound subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00370">res_pjsip_pubsub.c:370</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_abed51420cb87ea551279a07f2c502a37"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#abed51420cb87ea551279a07f2c502a37">CLI_LIST_SUB_FORMAT_HEADER</a></div><div class="ttdeci">#define CLI_LIST_SUB_FORMAT_HEADER</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04521">res_pjsip_pubsub.c:4521</a></div></div>
<div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="strings_8h_html_a1088afdd862a49b0fce34ebe02df8ca1"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a></div><div class="ttdeci">int ast_str_append(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Append to a thread local dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01091">strings.h:1091</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ada9f3d03df5f52f4aeb09f6d952f46de"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ada9f3d03df5f52f4aeb09f6d952f46de">ast_sip_publication_get_event_configuration</a></div><div class="ttdeci">const char * ast_sip_publication_get_event_configuration(const struct ast_sip_publication *pub)</div><div class="ttdoc">Given a publication, get the configuration name for the event type in use. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03430">res_pjsip_pubsub.c:3430</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a93e6d67f6d539b39fd0ebe7171d480ca"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a93e6d67f6d539b39fd0ebe7171d480ca">retrieve_resource_list</a></div><div class="ttdeci">static struct resource_list * retrieve_resource_list(const char *resource, const char *event)</div><div class="ttdoc">Helper function for retrieving a resource list for a given event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00902">res_pjsip_pubsub.c:902</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_a0cd500af1726295a50c6494772baaaec"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#a0cd500af1726295a50c6494772baaaec">sip_subscription_tree::transport</a></div><div class="ttdeci">pjsip_transport * transport</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00466">res_pjsip_pubsub.c:466</a></div></div>
<div class="ttc" id="cli_8h_html_aea8910ed9e301e7f741f87942c244eac"><div class="ttname"><a href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a></div><div class="ttdeci">#define ast_cli_register_multiple(e, len)</div><div class="ttdoc">Register multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00265">cli.h:265</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a7d62301cf52b6bc6d7b66cea60bee8cc"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a7d62301cf52b6bc6d7b66cea60bee8cc">pubsub_cb</a></div><div class="ttdeci">static pjsip_evsub_user pubsub_cb</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00549">res_pjsip_pubsub.c:549</a></div></div>
<div class="ttc" id="test__config_8c_html_aecdc7cbd5dfa76493c0212caa55d706c"><div class="ttname"><a href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a></div><div class="ttdeci">static struct aco_type item</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4f/test__config_8c_source.html#l01463">test_config.c:1463</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__supplement_html_a763fd8db6bba8fbbbc113ca0d61c47c2"><div class="ttname"><a href="../../d7/d72/structast__sip__pubsub__body__supplement.html#a763fd8db6bba8fbbbc113ca0d61c47c2">ast_sip_pubsub_body_supplement::type</a></div><div class="ttdeci">const char * type</div><div class="ttdoc">Content type In &quot;plain/text&quot;, &quot;plain&quot; is the type. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00661">res_pjsip_pubsub.h:661</a></div></div>
<div class="ttc" id="structcli__sub__complete__parms_html_af5adbe0a37846b3aacae6d358a1e57aa"><div class="ttname"><a href="../../d7/df6/structcli__sub__complete__parms.html#af5adbe0a37846b3aacae6d358a1e57aa">cli_sub_complete_parms::wordlen</a></div><div class="ttdeci">int wordlen</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04156">res_pjsip_pubsub.c:4156</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ac4305e5102dec63e8bbb9175dbab630e"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ac4305e5102dec63e8bbb9175dbab630e">persistence_tag_struct2str</a></div><div class="ttdeci">static int persistence_tag_struct2str(const void *obj, const intptr_t *args, char **buf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04697">res_pjsip_pubsub.c:4697</a></div></div>
<div class="ttc" id="sorcery_8h_html_a9db9fd1cf5ec967af2ad3a63c27e0233"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a9db9fd1cf5ec967af2ad3a63c27e0233">ast_sorcery_apply_config</a></div><div class="ttdeci">#define ast_sorcery_apply_config(sorcery, name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00456">sorcery.h:456</a></div></div>
<div class="ttc" id="sorcery_8h_html_a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a></div><div class="ttdoc">Return all matching objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00120">sorcery.h:120</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aa312ad955e7ad6a9dff13667be04c7f7"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aa312ad955e7ad6a9dff13667be04c7f7">persistence_endpoint_str2struct</a></div><div class="ttdeci">static int persistence_endpoint_str2struct(const struct aco_option *opt, struct ast_variable *var, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04673">res_pjsip_pubsub.c:4673</a></div></div>
<div class="ttc" id="json_8h_html_adca5179982d1f48df7127c123f15ce74"><div class="ttname"><a href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a></div><div class="ttdeci">struct ast_json * ast_json_load_string(const char *input, struct ast_json_error *error)</div><div class="ttdoc">Parse null terminated string into a JSON object or array. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00546">json.c:546</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_a7814e4900b15b2edc31554bbb7b61b3e"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#a7814e4900b15b2edc31554bbb7b61b3e">subscription_persistence::expires</a></div><div class="ttdeci">struct timeval expires</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00392">res_pjsip_pubsub.c:392</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a0a56204d9bae50c4103725ef62aab562a5d64d62e9e58a0f155318ab2bc94ade3"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a0a56204d9bae50c4103725ef62aab562a5d64d62e9e58a0f155318ab2bc94ade3">AST_SIP_PUBLISH_STATE_ACTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00041">res_pjsip_pubsub.h:41</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a4d530a1f675151206b5929a37a882fe2"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a4d530a1f675151206b5929a37a882fe2">DEFAULT_PUBLISH_EXPIRES</a></div><div class="ttdeci">#define DEFAULT_PUBLISH_EXPIRES</div><div class="ttdoc">Default expiration time for PUBLISH if one is not specified. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00247">res_pjsip_pubsub.c:247</a></div></div>
<div class="ttc" id="app__queue_8c_html_a5633b1433389cec21ade3811bbe9ca5b"><div class="ttname"><a href="../../da/dfb/app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a></div><div class="ttdeci">char * text</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dfb/app__queue_8c_source.html#l01508">app_queue.c:1508</a></div></div>
<div class="ttc" id="time_8h_html_aca4ecdab7d8d3519062aad9a90fcb29d"><div class="ttname"><a href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a></div><div class="ttdeci">int64_t ast_tvdiff_ms(struct timeval end, struct timeval start)</div><div class="ttdoc">Computes the difference (in milliseconds) between two struct timeval instances. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00098">time.h:98</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01032">astobj2.h:1032</a></div></div>
<div class="ttc" id="structast__datastore_html"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html">ast_datastore</a></div><div class="ttdoc">Structure for a data store object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00068">datastore.h:68</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a7da3e1f7ee3fcb77f29d41a76a7528fe"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a></div><div class="ttdeci">void ast_copy_pj_str(char *dest, const pj_str_t *src, size_t size)</div><div class="ttdoc">Copy a pj_str_t into a standard character buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05240">res_pjsip.c:5240</a></div></div>
<div class="ttc" id="app__jack_8c_html_af25d6dc49269fa2003ac7c7fa6f13915"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></div><div class="ttdeci">const char * str</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00147">app_jack.c:147</a></div></div>
<div class="ttc" id="test__func__file_8c_html_a7df83d295429a2562396f1ec127a46c0"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a></div><div class="ttdeci">const char * args</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00046">test_func_file.c:46</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a67b81ad8c54b40786d415a17d1fe9ff7"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a67b81ad8c54b40786d415a17d1fe9ff7">cli_list_subscriptions_outbound</a></div><div class="ttdeci">static int cli_list_subscriptions_outbound(struct sip_subscription_tree *sub_tree, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04574">res_pjsip_pubsub.c:4574</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__sip__subscription__handler_html_a2cdc6ead7e87bb0cd7c01b2445b0f60d"><div class="ttname"><a href="../../d8/d6c/structast__sip__subscription__handler.html#a2cdc6ead7e87bb0cd7c01b2445b0f60d">ast_sip_subscription_handler::to_ami</a></div><div class="ttdeci">void(* to_ami)(struct ast_sip_subscription *sub, struct ast_str **buf)</div><div class="ttdoc">Converts the subscriber to AMI. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00335">res_pjsip_pubsub.h:335</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a9c45ac14fca8a0ed83e33e45856a5199"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a9c45ac14fca8a0ed83e33e45856a5199">apply_list_configuration</a></div><div class="ttdeci">static int apply_list_configuration(struct ast_sorcery *sorcery)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04857">res_pjsip_pubsub.c:4857</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aa7db5b123e82a8da6f1ae6fc15aaace5"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aa7db5b123e82a8da6f1ae6fc15aaace5">AST_VECTOR</a></div><div class="ttdeci">AST_VECTOR(resources, const char *)</div><div class="ttdoc">A vector of strings commonly used throughout this module. </div></div>
<div class="ttc" id="eagi__proxy_8c_html_a8fd806ad19b8f5513a4cf18cbf77532c"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a></div><div class="ttdeci">char * end</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">eagi_proxy.c:73</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_a8d5dbabe731f82e2db15cbf4dabbca93"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#a8d5dbabe731f82e2db15cbf4dabbca93">subscription_persistence::packet</a></div><div class="ttdeci">char packet[PJSIP_MAX_PKT_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00376">res_pjsip_pubsub.c:376</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a7fa8f8f5e7bf978b9bc6c710d3b3e437"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a7fa8f8f5e7bf978b9bc6c710d3b3e437">sub_add_handler</a></div><div class="ttdeci">static void sub_add_handler(struct ast_sip_subscription_handler *handler)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02756">res_pjsip_pubsub.c:2756</a></div></div>
<div class="ttc" id="cli_8h_html_a791bf9f5637185bee5e8f0907c762130"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a></div><div class="ttdeci">void ast_cli(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00006">clicompat.c:6</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_a21053f8b496f0b3ac0aee6f43d27adce"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#a21053f8b496f0b3ac0aee6f43d27adce">sip_subscription_tree::persistence</a></div><div class="ttdeci">struct subscription_persistence * persistence</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00439">res_pjsip_pubsub.c:439</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ae741d1ec08fd26b810d24514e510dad8"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ae741d1ec08fd26b810d24514e510dad8">ast_sip_subscription_is_terminated</a></div><div class="ttdeci">int ast_sip_subscription_is_terminated(const struct ast_sip_subscription *sub)</div><div class="ttdoc">Get whether the subscription has been terminated or not. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02601">res_pjsip_pubsub.c:2601</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_adf4c5a237767eb6db5b1db41ccdfc689"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#adf4c5a237767eb6db5b1db41ccdfc689">AST_TASKPROCESSOR_MAX_NAME</a></div><div class="ttdeci">#define AST_TASKPROCESSOR_MAX_NAME</div><div class="ttdoc">Suggested maximum taskprocessor name length (less null terminator). </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d1e/taskprocessor_8h_source.html#l00060">taskprocessor.h:60</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_gab8c82412fe0432a91d5c7985cfdf9b59"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#gab8c82412fe0432a91d5c7985cfdf9b59">ast_sip_push_task_wait_servant</a></div><div class="ttdeci">int ast_sip_push_task_wait_servant(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Push a task to SIP servants and wait for it to complete. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05204">res_pjsip.c:5204</a></div></div>
<div class="ttc" id="strings_8h_html_af96aa9b71c6ef0f2f75038669d950b31"><div class="ttname"><a href="../../d6/d90/strings_8h.html#af96aa9b71c6ef0f2f75038669d950b31">ast_get_timeval</a></div><div class="ttdeci">int ast_get_timeval(const char *src, struct timeval *tv, struct timeval _default, int *consumed)</div><div class="ttdoc">get values from config variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02171">main/utils.c:2171</a></div></div>
<div class="ttc" id="test_8h_html_a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00207">test.h:207</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_a9e1f9ef9caffc6fcf306dbf678ecc747"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#a9e1f9ef9caffc6fcf306dbf678ecc747">sip_subscription_tree::is_list</a></div><div class="ttdeci">int is_list</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00453">res_pjsip_pubsub.c:453</a></div></div>
<div class="ttc" id="structtree__node_html"><div class="ttname"><a href="../../d6/d14/structtree__node.html">tree_node</a></div><div class="ttdoc">A node for a resource tree. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00888">res_pjsip_pubsub.c:888</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a946b1f58e8ead34101e6fc012088140a"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a946b1f58e8ead34101e6fc012088140a">persistence_expires_struct2str</a></div><div class="ttdeci">static int persistence_expires_struct2str(const void *obj, const intptr_t *args, char **buf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04744">res_pjsip_pubsub.c:4744</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01043">astobj2.h:1043</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a42ecd8494df028dc44c95b90848ad311a9b252001716803d21529f825433f4008"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a9b252001716803d21529f825433f4008">SIP_PUBLISH_UNKNOWN</a></div><div class="ttdoc">Unknown. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00274">res_pjsip_pubsub.c:274</a></div></div>
<div class="ttc" id="structast__json__error_html"><div class="ttname"><a href="../../d0/d96/structast__json__error.html">ast_json_error</a></div><div class="ttdoc">JSON parsing error information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d05/json_8h_source.html#l00829">json.h:829</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ad353ed8aab9f1e54ccf8d2e89a96bcac"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ad353ed8aab9f1e54ccf8d2e89a96bcac">create_require_eventlist</a></div><div class="ttdeci">static pjsip_require_hdr * create_require_eventlist(pj_pool_t *pool)</div><div class="ttdoc">Shortcut method to create a Require: eventlist header. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02404">res_pjsip_pubsub.c:2404</a></div></div>
<div class="ttc" id="structnotify__data_html"><div class="ttname"><a href="../../d4/d18/structnotify__data.html">notify_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d41/res__pjsip__notify_8c_source.html#l00266">res_pjsip_notify.c:266</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a675152b3c3f0536dbb1f624fc840fba1"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a675152b3c3f0536dbb1f624fc840fba1">ami_show_subscriptions_inbound</a></div><div class="ttdeci">static int ami_show_subscriptions_inbound(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04062">res_pjsip_pubsub.c:4062</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a46e524af59f26e0f0825b21acf9ea886"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a46e524af59f26e0f0825b21acf9ea886">MAX_REGEX_ERROR_LEN</a></div><div class="ttdeci">#define MAX_REGEX_ERROR_LEN</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04138">res_pjsip_pubsub.c:4138</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a1959d38582b0da24d4d42766cf13ade8"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a1959d38582b0da24d4d42766cf13ade8">cli_commands</a></div><div class="ttdeci">static struct ast_cli_entry cli_commands[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04667">res_pjsip_pubsub.c:4667</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a99619cb1fc467541615fc8d043d39643"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a99619cb1fc467541615fc8d043d39643">test_handler</a></div><div class="ttdeci">struct ast_sip_subscription_handler test_handler</div><div class="ttdoc">Subscription handler for unit tests. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04927">res_pjsip_pubsub.c:4927</a></div></div>
<div class="ttc" id="lock_8h_html_a8a3bd496edfec04a95683ace66676200"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a></div><div class="ttdeci">int ast_atomic_fetchadd_int(volatile int *p, int v)</div><div class="ttdoc">Atomically add v to *p and return the previous value of *p. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00755">lock.h:755</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_a50c22c2e37da046bc68c646d2599a937"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#a50c22c2e37da046bc68c646d2599a937">sip_subscription_tree::role</a></div><div class="ttdeci">enum ast_sip_subscription_role role</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00437">res_pjsip_pubsub.c:437</a></div></div>
<div class="ttc" id="structsubscriptions_html"><div class="ttname"><a href="../../df/dab/structsubscriptions.html">subscriptions</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00534">res_pjsip_pubsub.c:534</a></div></div>
<div class="ttc" id="structsimple__message__summary_html_abc5ed3ee3c85dccc50605477083d2e55"><div class="ttname"><a href="../../d0/d4c/structsimple__message__summary.html#abc5ed3ee3c85dccc50605477083d2e55">simple_message_summary::message_account</a></div><div class="ttdeci">char message_account[PJSIP_MAX_URL_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03582">res_pjsip_pubsub.c:3582</a></div></div>
<div class="ttc" id="mwi_8h_html_ae7328cd8d8b2120de46b1d2afac99f18"><div class="ttname"><a href="../../dc/d33/mwi_8h.html#ae7328cd8d8b2120de46b1d2afac99f18">ast_publish_mwi_state</a></div><div class="ttdeci">#define ast_publish_mwi_state(mailbox, context, new_msgs, old_msgs)</div><div class="ttdoc">Publish a MWI state update via stasis. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00380">mwi.h:380</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_acef4d0aef5bdc92f0b6b188e48f2e90f"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#acef4d0aef5bdc92f0b6b188e48f2e90f">ast_sip_add_header</a></div><div class="ttdeci">int ast_sip_add_header(pjsip_tx_data *tdata, const char *name, const char *value)</div><div class="ttdoc">Add a header to an outbound SIP message. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05063">res_pjsip.c:5063</a></div></div>
<div class="ttc" id="structresource__list_html"><div class="ttname"><a href="../../df/dd0/structresource__list.html">resource_list</a></div><div class="ttdoc">Resource list configuration item. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00325">res_pjsip_pubsub.c:325</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a69501f479a8ea3b0d1b6c4b8439e03c9"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a69501f479a8ea3b0d1b6c4b8439e03c9">ast_sip_publication_get_datastore</a></div><div class="ttdeci">struct ast_datastore * ast_sip_publication_get_datastore(struct ast_sip_publication *publication, const char *name)</div><div class="ttdoc">Retrieve a publication datastore. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02654">res_pjsip_pubsub.c:2654</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_a9d5cc626722f9dee721868da7dc58a40"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#a9d5cc626722f9dee721868da7dc58a40">sip_subscription_tree::notify_sched_id</a></div><div class="ttdeci">int notify_sched_id</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00447">res_pjsip_pubsub.c:447</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a0e4842b1807e5e2d33bfda094c83f84d"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a0e4842b1807e5e2d33bfda094c83f84d">subscription_persistence_recreate</a></div><div class="ttdeci">static int subscription_persistence_recreate(void *obj, void *arg, int flags)</div><div class="ttdoc">Callback function to perform the actual recreation of a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01684">res_pjsip_pubsub.c:1684</a></div></div>
<div class="ttc" id="structast__datastore_html_a2daadcdbac635c83b7bfc6375b4c9be4"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html#a2daadcdbac635c83b7bfc6375b4c9be4">ast_datastore::uid</a></div><div class="ttdeci">const char * uid</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00069">datastore.h:69</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_a2d47efc2f2609185cf802853871de027"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#a2d47efc2f2609185cf802853871de027">subscription_persistence::src_port</a></div><div class="ttdeci">int src_port</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00380">res_pjsip_pubsub.c:380</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aa6471e6d6f4563ef5fb93343180fea40"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aa6471e6d6f4563ef5fb93343180fea40">ast_sip_subscription_get_dialog</a></div><div class="ttdeci">pjsip_dialog * ast_sip_subscription_get_dialog(struct ast_sip_subscription *sub)</div><div class="ttdoc">Get the pjsip dialog that is associated with this subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01930">res_pjsip_pubsub.c:1930</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00201">test.h:201</a></div></div>
<div class="ttc" id="json_8h_html_abc8b563c172cfaffa2b555195990f729"><div class="ttname"><a href="../../d4/d05/json_8h.html#abc8b563c172cfaffa2b555195990f729">ast_json_object_set</a></div><div class="ttdeci">int ast_json_object_set(struct ast_json *object, const char *key, struct ast_json *value)</div><div class="ttdoc">Set a field in a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00404">json.c:404</a></div></div>
<div class="ttc" id="astmm_8h_html_ada667b6f84a08e6848cb37c5ffb94a5f"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a></div><div class="ttdeci">#define ast_asprintf(ret, fmt,...)</div><div class="ttdoc">A wrapper for asprintf() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00269">astmm.h:269</a></div></div>
<div class="ttc" id="strings_8h_html_a0b9c195ff2235f7670358e1e37cf6b8d"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a0b9c195ff2235f7670358e1e37cf6b8d">ast_str_truncate</a></div><div class="ttdeci">char * ast_str_truncate(struct ast_str *buf, ssize_t len)</div><div class="ttdoc">Truncates the enclosed string to the given length. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00738">strings.h:738</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac6a9f3498f9afffecfd78c485af41556"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a></div><div class="ttdeci">const char * astman_get_header(const struct message *m, char *var)</div><div class="ttdoc">Get header from mananger transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l02820">manager.c:2820</a></div></div>
<div class="ttc" id="structast__sip__subscription_html_a4b57472ac293cbff3de8eb58471771f0"><div class="ttname"><a href="../../db/d02/structast__sip__subscription.html#a4b57472ac293cbff3de8eb58471771f0">ast_sip_subscription::body_generator</a></div><div class="ttdeci">struct ast_sip_pubsub_body_generator * body_generator</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00485">res_pjsip_pubsub.c:485</a></div></div>
<div class="ttc" id="module_8h_html_a15896c26e51e8162df5eb9a0124c841f"><div class="ttname"><a href="../../d5/d16/module_8h.html#a15896c26e51e8162df5eb9a0124c841f">ast_module_unref</a></div><div class="ttdeci">#define ast_module_unref(mod)</div><div class="ttdoc">Release a reference to the module. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00469">module.h:469</a></div></div>
<div class="ttc" id="datastore_8h_html_a3e5e18520733ba3dc58c1e218ab5541b"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#a3e5e18520733ba3dc58c1e218ab5541b">ast_datastores_find</a></div><div class="ttdeci">struct ast_datastore * ast_datastores_find(struct ao2_container *datastores, const char *name)</div><div class="ttdoc">Find a data store in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d7a/datastore_8c_source.html#l00119">datastore.c:119</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="sorcery_8h_html_a100106a82d72aa59a66513ef3ad161c8"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a></div><div class="ttdeci">void * ast_sorcery_retrieve_by_id(const struct ast_sorcery *sorcery, const char *type, const char *id)</div><div class="ttdoc">Retrieve an object using its unique identifier. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01853">sorcery.c:1853</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a6ba01bbffb64da676cd5176bb1d918b9"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a6ba01bbffb64da676cd5176bb1d918b9">sub_tree_state_description</a></div><div class="ttdeci">static char * sub_tree_state_description[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00415">res_pjsip_pubsub.c:415</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ae30488231b97f5060ccc10743e7a3a64"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ae30488231b97f5060ccc10743e7a3a64">resource_list_alloc</a></div><div class="ttdeci">static void * resource_list_alloc(const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04764">res_pjsip_pubsub.c:4764</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_add921b3c03175e428a304fbd820c584a"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#add921b3c03175e428a304fbd820c584a">ami_subscription_detail_outbound</a></div><div class="ttdeci">static int ami_subscription_detail_outbound(struct sip_subscription_tree *sub_tree, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04056">res_pjsip_pubsub.c:4056</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a0dc7590db76dcdc0105abc92072d1b06"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a0dc7590db76dcdc0105abc92072d1b06">ast_pjsip_rdata_get_endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * ast_pjsip_rdata_get_endpoint(pjsip_rx_data *rdata)</div><div class="ttdoc">Get the looked-up endpoint on an out-of dialog request or response. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dad/pjsip__distributor_8c_source.html#l00969">pjsip_distributor.c:969</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a36292f9aacdecd44efe47fa591beb400a56de5c438e2a53b13eb3ba4310d58ae2"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400a56de5c438e2a53b13eb3ba4310d58ae2">SUBSCRIPTION_PERSISTENCE_SEND_REQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00525">res_pjsip_pubsub.c:525</a></div></div>
<div class="ttc" id="datastore_8h_html_afa0c7f9c8f98470441ff8e9b3e8f34cc"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#afa0c7f9c8f98470441ff8e9b3e8f34cc">ast_datastores_alloc</a></div><div class="ttdeci">struct ao2_container * ast_datastores_alloc(void)</div><div class="ttdoc">Allocate a specialized data stores container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d7a/datastore_8c_source.html#l00095">datastore.c:95</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a68314dedb48b2799a693d3a090ae038b"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a68314dedb48b2799a693d3a090ae038b">ast_sip_subscription_add_datastore</a></div><div class="ttdeci">int ast_sip_subscription_add_datastore(struct ast_sip_subscription *subscription, struct ast_datastore *datastore)</div><div class="ttdoc">Add a datastore to a SIP subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02629">res_pjsip_pubsub.c:2629</a></div></div>
<div class="ttc" id="structast__sip__publication_html_abc32956d82e246471f4e5edbb3dda759"><div class="ttname"><a href="../../d4/da6/structast__sip__publication.html#abc32956d82e246471f4e5edbb3dda759">ast_sip_publication::datastores</a></div><div class="ttdeci">struct ao2_container * datastores</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00347">res_pjsip_pubsub.c:347</a></div></div>
<div class="ttc" id="structresource__tree_html_ac90516981222dda0270465a33483f2b4"><div class="ttname"><a href="../../d9/d6a/structresource__tree.html#ac90516981222dda0270465a33483f2b4">resource_tree::notification_batch_interval</a></div><div class="ttdeci">unsigned int notification_batch_interval</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01097">res_pjsip_pubsub.c:1097</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ac9ccf20fa81744533ad45801f7f1a3b6"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ac9ccf20fa81744533ad45801f7f1a3b6">add_rlmi_resource</a></div><div class="ttdeci">static void add_rlmi_resource(pj_pool_t *pool, pj_xml_node *rlmi, const pjsip_generic_string_hdr *cid, const char *resource_name, const pjsip_sip_uri *resource_uri, pjsip_evsub_state state)</div><div class="ttdoc">Add a resource XML element to an RLMI body. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02029">res_pjsip_pubsub.c:2029</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ace14e2a3214654b0c1d15c05ba2bdb89"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ace14e2a3214654b0c1d15c05ba2bdb89">sip_subscription_accept</a></div><div class="ttdeci">static int sip_subscription_accept(struct sip_subscription_tree *sub_tree, pjsip_rx_data *rdata, int response)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02606">res_pjsip_pubsub.c:2606</a></div></div>
<div class="ttc" id="datastore_8h_html"><div class="ttname"><a href="../../d9/db6/datastore_8h.html">datastore.h</a></div><div class="ttdoc">Asterisk datastore objects. </div></div>
<div class="ttc" id="astobj2_8h_html_ac438c3fcd3150481fad38689fd813a15"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a></div><div class="ttdeci">#define ao2_bump(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00491">astobj2.h:491</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a0aa1afb0a81eaeebda85dbb188f82df7"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a0aa1afb0a81eaeebda85dbb188f82df7">build_rlmi_body</a></div><div class="ttdeci">static pjsip_multipart_part * build_rlmi_body(pj_pool_t *pool, struct ast_sip_subscription *sub, struct body_part_list *body_parts, unsigned int full_state)</div><div class="ttdoc">Create an RLMI body part for a multipart resource list body. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02162">res_pjsip_pubsub.c:2162</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a3bfb18b697fd27c2c465c9d7182e9d82"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a3bfb18b697fd27c2c465c9d7182e9d82">serialized_pubsub_on_refresh_timeout</a></div><div class="ttdeci">static int serialized_pubsub_on_refresh_timeout(void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03889">res_pjsip_pubsub.c:3889</a></div></div>
<div class="ttc" id="config__options_8h_html_a61bb4940517e7d00e7104de8273c2144a783aac0af1422c0e46356efd3c52d37a"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a783aac0af1422c0e46356efd3c52d37a">OPT_CHAR_ARRAY_T</a></div><div class="ttdoc">Type for default option handler for character array strings. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00330">config_options.h:330</a></div></div>
<div class="ttc" id="structcli__sub__parms_html"><div class="ttname"><a href="../../dc/d55/structcli__sub__parms.html">cli_sub_parms</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04140">res_pjsip_pubsub.c:4140</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ab37c67d3e45723f0b0aaf21dd9e2d605"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ab37c67d3e45723f0b0aaf21dd9e2d605">subscription_persistence_update</a></div><div class="ttdeci">static void subscription_persistence_update(struct sip_subscription_tree *sub_tree, pjsip_rx_data *rdata, enum sip_persistence_update_type type)</div><div class="ttdoc">Function which updates persistence information of a subscription in sorcery. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00662">res_pjsip_pubsub.c:662</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ae0461ac441d662c000ef9408ab9dd01c"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ae0461ac441d662c000ef9408ab9dd01c">sip_subscription_to_ami</a></div><div class="ttdeci">static void sip_subscription_to_ami(struct sip_subscription_tree *sub_tree, struct ast_str **buf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01820">res_pjsip_pubsub.c:1820</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ab1dea1f3f371c8b1e033627343f74457"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ab1dea1f3f371c8b1e033627343f74457">resource_list_destructor</a></div><div class="ttdeci">static void resource_list_destructor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04752">res_pjsip_pubsub.c:4752</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a5314d6fbf19f6f10073f1d4e0787e957"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a5314d6fbf19f6f10073f1d4e0787e957">allocate_body_part</a></div><div class="ttdeci">static struct body_part * allocate_body_part(pj_pool_t *pool, const struct ast_sip_subscription *sub)</div><div class="ttdoc">Allocate and initialize a body part structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02233">res_pjsip_pubsub.c:2233</a></div></div>
<div class="ttc" id="structsimple__message__summary_html_ac4508933deca9dfd7e9d3f77922ded20"><div class="ttname"><a href="../../d0/d4c/structsimple__message__summary.html#ac4508933deca9dfd7e9d3f77922ded20">simple_message_summary::voice_messages_urgent_new</a></div><div class="ttdeci">int voice_messages_urgent_new</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03580">res_pjsip_pubsub.c:3580</a></div></div>
<div class="ttc" id="utils_8h_html_a3acffbd305ee72dcd4593c0d8af64a4f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a></div><div class="ttdeci">#define MIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00226">utils.h:226</a></div></div>
<div class="ttc" id="strings_8h_html_aa3341f35cedca29e60bb7f3927204283"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a></div><div class="ttdeci">int ast_str_set(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Set a dynamic string using variable arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01065">strings.h:1065</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a0cb53b1ca63b4b97b4b3fa8721274ee9"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a0cb53b1ca63b4b97b4b3fa8721274ee9">ast_sip_subscription_get_remote_uri</a></div><div class="ttdeci">void ast_sip_subscription_get_remote_uri(struct ast_sip_subscription *sub, char *buf, size_t size)</div><div class="ttdoc">Retrive the remote URI for this subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02583">res_pjsip_pubsub.c:2583</a></div></div>
<div class="ttc" id="config__options_8h_html_a61bb4940517e7d00e7104de8273c2144ab40ad6fcfeefab3befa32ab479be04a2"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144ab40ad6fcfeefab3befa32ab479be04a2">OPT_YESNO_T</a></div><div class="ttdoc">Type for default option handler for bools (ast_true/ast_false) </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00481">config_options.h:481</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_a3990a4c9f559fbabfdfe3f6785246b3e"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#a3990a4c9f559fbabfdfe3f6785246b3e">sip_subscription_tree::evsub</a></div><div class="ttdeci">pjsip_evsub * evsub</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00441">res_pjsip_pubsub.c:441</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a0a0fe104cc2cc36a43784f886f3ae7dc"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a></div><div class="ttdeci">#define AST_RWLIST_RDLOCK(head)</div><div class="ttdoc">Read locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00077">linkedlists.h:77</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga47a9130b20e7724a51d5eeebbc0a516b"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga47a9130b20e7724a51d5eeebbc0a516b">ast_sip_schedule_task</a></div><div class="ttdeci">struct ast_sip_sched_task * ast_sip_schedule_task(struct ast_taskprocessor *serializer, int interval, ast_sip_task sip_task, const char *name, void *task_data, enum ast_sip_scheduler_task_flags flags)</div><div class="ttdoc">Schedule a task to run in the res_pjsip thread pool. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfa/pjsip__scheduler_8c_source.html#l00415">pjsip_scheduler.c:415</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__supplement_html_abb4ae60bbcbce3616fdd7d4238869c91"><div class="ttname"><a href="../../d7/d72/structast__sip__pubsub__body__supplement.html#abb4ae60bbcbce3616fdd7d4238869c91">ast_sip_pubsub_body_supplement::subtype</a></div><div class="ttdeci">const char * subtype</div><div class="ttdoc">Content subtype In &quot;plain/text&quot;, &quot;text&quot; is the subtype. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00666">res_pjsip_pubsub.h:666</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a3815d56063e28c51b863c26e6b3a49c9"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a3815d56063e28c51b863c26e6b3a49c9">pubsub_on_server_timeout</a></div><div class="ttdeci">static void pubsub_on_server_timeout(pjsip_evsub *sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04002">res_pjsip_pubsub.c:4002</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a6b49cafa2a3d359a2e865992f551874a"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a></div><div class="ttdeci">static char mailbox[AST_MAX_MAILBOX_UNIQUEID]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00204">chan_mgcp.c:204</a></div></div>
<div class="ttc" id="manager_8h_html_a420f0f755e1c3378b45ca7f6f0669ffa"><div class="ttname"><a href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a></div><div class="ttdeci">#define EVENT_FLAG_SYSTEM</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00071">manager.h:71</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="manager_8h_html_a8ae409b5ff584e42c30edcfe5837d85c"><div class="ttname"><a href="../../db/d45/manager_8h.html#a8ae409b5ff584e42c30edcfe5837d85c">ast_manager_get_generic_type</a></div><div class="ttdeci">struct stasis_message_type * ast_manager_get_generic_type(void)</div><div class="ttdoc">Get the stasis_message_type for generic messages. </div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="sorcery_8h_html_a575dfe8fd872c033d2b902549df502ea"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a575dfe8fd872c033d2b902549df502ea">ast_sorcery_create</a></div><div class="ttdeci">int ast_sorcery_create(const struct ast_sorcery *sorcery, void *object)</div><div class="ttdoc">Create and potentially persist an object using an available wizard. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02057">sorcery.c:2057</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a2be73952bf96122adf824dbbc26caa1c"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a2be73952bf96122adf824dbbc26caa1c">ast_sip_pubsub_unregister_body_supplement</a></div><div class="ttdeci">void ast_sip_pubsub_unregister_body_supplement(struct ast_sip_pubsub_body_supplement *supplement)</div><div class="ttdoc">Unregister a body generator with the pubsub core. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03494">res_pjsip_pubsub.c:3494</a></div></div>
<div class="ttc" id="sorcery_8h_html_a720c9774873ec35bae0a0160954767e7"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a720c9774873ec35bae0a0160954767e7">ast_sorcery_object_field_register_custom</a></div><div class="ttdeci">#define ast_sorcery_object_field_register_custom(sorcery, type, name, default_val, config_handler, sorcery_handler, multiple_handler, flags,...)</div><div class="ttdoc">Register a field within an object with custom handlers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l01005">sorcery.h:1005</a></div></div>
<div class="ttc" id="structpublish__handlers_html"><div class="ttname"><a href="../../df/d3c/structpublish__handlers.html">publish_handlers</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02691">res_pjsip_pubsub.c:2691</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a386166c75f00c0b4d1878e3a6d666e89a68663ef66af50c315fec11f61bc226ab"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a68663ef66af50c315fec11f61bc226ab">SIP_SUB_TREE_TERMINATED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00412">res_pjsip_pubsub.c:412</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a37e5c81dbce6f5db2f91dbe92689ec2f"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a37e5c81dbce6f5db2f91dbe92689ec2f">exceptional_accept</a></div><div class="ttdeci">static int exceptional_accept(const pj_str_t *accept)</div><div class="ttdoc">Is the Accept header from the SUBSCRIBE in the list of exceptions? </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00817">res_pjsip_pubsub.c:817</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a0a07ddd6bbcf44485e01c14c96109482"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a></div><div class="ttdeci">#define ast_config_load(filename, flags)</div><div class="ttdoc">Load a config file. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00179">include/asterisk/config.h:179</a></div></div>
<div class="ttc" id="structast__variable_html_a8556878012feffc9e0beb86cd78f424d"><div class="ttname"><a href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">ast_variable::value</a></div><div class="ttdeci">const char * value</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00087">include/asterisk/config.h:87</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ac952acea83472c9c285fe203a5b62ce3"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ac952acea83472c9c285fe203a5b62ce3">for_each_subscription</a></div><div class="ttdeci">static int for_each_subscription(on_subscription_t on_subscription, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01800">res_pjsip_pubsub.c:1800</a></div></div>
<div class="ttc" id="config__options_8h_html_a5793d5d6ccf2df0b2423eb3274af7802"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a></div><div class="ttdeci">#define FLDSET(type,...)</div><div class="ttdoc">Convert a struct and list of fields to an argument list of field offsets. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00816">config_options.h:816</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ac79436df96e320a3107e5e8dfb3e9720"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ac79436df96e320a3107e5e8dfb3e9720">create_multipart_body</a></div><div class="ttdeci">static pjsip_msg_body * create_multipart_body(pj_pool_t *pool)</div><div class="ttdoc">Create and initialize the PJSIP multipart body structure for a resource list subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02291">res_pjsip_pubsub.c:2291</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a2da91e964cff994ce0e57b494316b043"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a2da91e964cff994ce0e57b494316b043">CLI_SHOW_SUB_FORMAT_HEADER</a></div><div class="ttdeci">#define CLI_SHOW_SUB_FORMAT_HEADER</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04374">res_pjsip_pubsub.c:4374</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a31b603dda9cf0a3354575494f0d4f9f9"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a31b603dda9cf0a3354575494f0d4f9f9">pubsub_on_refresh_timeout</a></div><div class="ttdeci">static int pubsub_on_refresh_timeout(void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03859">res_pjsip_pubsub.c:3859</a></div></div>
<div class="ttc" id="vector_8h_html_ad9d555fa89da1bfc691181993499f785"><div class="ttname"><a href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a></div><div class="ttdeci">#define AST_VECTOR_INIT(vec, size)</div><div class="ttdoc">Initialize a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00113">vector.h:113</a></div></div>
<div class="ttc" id="structast__module__info_html_a1aff0615d43e1dfa5c72c1c7d1c6d709"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">ast_module_info::self</a></div><div class="ttdeci">struct ast_module * self</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00342">module.h:342</a></div></div>
<div class="ttc" id="callerid_8h_html_a1c25633b1ed63682c95ec613d7cbe559"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a1c25633b1ed63682c95ec613d7cbe559">ast_callerid_merge</a></div><div class="ttdeci">char * ast_callerid_merge(char *buf, int bufsiz, const char *name, const char *num, const char *unknown)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd5/callerid_8c_source.html#l01073">callerid.c:1073</a></div></div>
<div class="ttc" id="structsimple__message__summary_html_a1aac92e179c16fc5d0542fed81590d7d"><div class="ttname"><a href="../../d0/d4c/structsimple__message__summary.html#a1aac92e179c16fc5d0542fed81590d7d">simple_message_summary::messages_waiting</a></div><div class="ttdeci">int messages_waiting</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03577">res_pjsip_pubsub.c:3577</a></div></div>
<div class="ttc" id="structast__sip__subscription_html_abc32956d82e246471f4e5edbb3dda759"><div class="ttname"><a href="../../db/d02/structast__sip__subscription.html#abc32956d82e246471f4e5edbb3dda759">ast_sip_subscription::datastores</a></div><div class="ttdeci">struct ao2_container * datastores</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00479">res_pjsip_pubsub.c:479</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a7b2ea661eb5491432e647c3070aa78a7"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a7b2ea661eb5491432e647c3070aa78a7">PUBLICATIONS_BUCKETS</a></div><div class="ttdeci">#define PUBLICATIONS_BUCKETS</div><div class="ttdoc">Number of buckets for publications (on a per handler) </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00244">res_pjsip_pubsub.c:244</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00317">module.h:317</a></div></div>
<div class="ttc" id="structresource__tree_html"><div class="ttname"><a href="../../d9/d6a/structresource__tree.html">resource_tree</a></div><div class="ttdoc">A resource tree. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01095">res_pjsip_pubsub.c:1095</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a9937f98867d28da0cc0e8590d9c9ffa4"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a9937f98867d28da0cc0e8590d9c9ffa4">ast_sip_mod_data_set</a></div><div class="ttdeci">#define ast_sip_mod_data_set(pool, mod_data, id, key, val)</div><div class="ttdoc">Utilizing a mod_data array for a given id, set the value associated with the given key...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02670">res_pjsip.h:2670</a></div></div>
<div class="ttc" id="structcli__sub__complete__parms_html_aa2a4dae2a14de4093826005f9bdfd3bb"><div class="ttname"><a href="../../d7/df6/structcli__sub__complete__parms.html#aa2a4dae2a14de4093826005f9bdfd3bb">cli_sub_complete_parms::which</a></div><div class="ttdeci">int which</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04157">res_pjsip_pubsub.c:4157</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gabf7c909efbfc26d0d9c66786c83b8f69"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a></div><div class="ttdeci">void astman_send_list_complete_end(struct mansession *s)</div><div class="ttdoc">End the list complete event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03245">manager.c:3245</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a79792c0d3a54f779754479075e3c80b3"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a79792c0d3a54f779754479075e3c80b3">ast_sip_subscription_get_sip_uri</a></div><div class="ttdeci">pjsip_sip_uri * ast_sip_subscription_get_sip_uri(struct ast_sip_subscription *sub)</div><div class="ttdoc">Retrieve the local sip uri for this subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02573">res_pjsip_pubsub.c:2573</a></div></div>
<div class="ttc" id="structbody__part_html_ac43e5728c2093e52e8a06774ab68afe2"><div class="ttname"><a href="../../d2/de8/structbody__part.html#ac43e5728c2093e52e8a06774ab68afe2">body_part::uri</a></div><div class="ttdeci">pjsip_sip_uri * uri</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02086">res_pjsip_pubsub.c:2086</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="config__options_8h_html_a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a></div><div class="ttdoc">Type for default option handler for unsigned integers. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00459">config_options.h:459</a></div></div>
<div class="ttc" id="test_8h_html_a5e8fddded61f6989172c981256e7c9bd"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a></div><div class="ttdeci">#define ast_test_status_update(a, b, c...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00129">test.h:129</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a30a0d1004e7965d66f03d5a12645e81b"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a30a0d1004e7965d66f03d5a12645e81b">cleanup_resource_list</a></div><div class="ttdeci">static void cleanup_resource_list(struct resource_list *list)</div><div class="ttdoc">RAII callback to destroy a resource list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04962">res_pjsip_pubsub.c:4962</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a0b174b002a4e991ef8c08f17118f8cd5"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a0b174b002a4e991ef8c08f17118f8cd5">on_subscription_t</a></div><div class="ttdeci">int(* on_subscription_t)(struct sip_subscription_tree *sub, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01798">res_pjsip_pubsub.c:1798</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ad470e06c57059377443112a2012ec8bd"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ad470e06c57059377443112a2012ec8bd">publication_resource_destroy</a></div><div class="ttdeci">static void publication_resource_destroy(void *obj)</div><div class="ttdoc">Destructor for publication resource. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00558">res_pjsip_pubsub.c:558</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__generator_html_a385739136e77ae600f5bf6f00bcfebb9"><div class="ttname"><a href="../../df/dc3/structast__sip__pubsub__body__generator.html#a385739136e77ae600f5bf6f00bcfebb9">ast_sip_pubsub_body_generator::allocate_body</a></div><div class="ttdeci">void *(* allocate_body)(void *data)</div><div class="ttdoc">allocate body structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00617">res_pjsip_pubsub.h:617</a></div></div>
<div class="ttc" id="app__externalivr_8c_html_abe143f1bae4445e9b3798e1dec3bda60"><div class="ttname"><a href="../../de/d26/app__externalivr_8c.html#abe143f1bae4445e9b3798e1dec3bda60">gen</a></div><div class="ttdeci">static struct ast_generator gen</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/app__externalivr_8c_source.html#l00297">app_externalivr.c:297</a></div></div>
<div class="ttc" id="structast__cli__args_html_acf64f219885421479997667d2ed3f08a"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">ast_cli_args::fd</a></div><div class="ttdeci">const int fd</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00159">cli.h:159</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aeb411f16e0fee4036a22b354164b43a6"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aeb411f16e0fee4036a22b354164b43a6">ast_sip_subscription_get_local_uri</a></div><div class="ttdeci">void ast_sip_subscription_get_local_uri(struct ast_sip_subscription *sub, char *buf, size_t size)</div><div class="ttdoc">Retrieve the local URI for this subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02578">res_pjsip_pubsub.c:2578</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aa04aa9b3ab93170dc00535e2deaa5c86"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aa04aa9b3ab93170dc00535e2deaa5c86">list_item_to_str</a></div><div class="ttdeci">static int list_item_to_str(const void *obj, const intptr_t *args, char **buf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04821">res_pjsip_pubsub.c:4821</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a312601e694a9ca811601375d4e33d8df"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a312601e694a9ca811601375d4e33d8df">schedule_notification</a></div><div class="ttdeci">static int schedule_notification(struct sip_subscription_tree *sub_tree)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02512">res_pjsip_pubsub.c:2512</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_abf46a87a277bf64c6230f9f2237906f8"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#abf46a87a277bf64c6230f9f2237906f8">sub_tree_transport_cb</a></div><div class="ttdeci">static void sub_tree_transport_cb(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00603">res_pjsip_pubsub.c:603</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a4732f846f9b6cda02dea380f561ea76a"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a4732f846f9b6cda02dea380f561ea76a">cli_list_subscriptions_detail</a></div><div class="ttdeci">static int cli_list_subscriptions_detail(struct sip_subscription_tree *sub_tree, struct cli_sub_parms *cli)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04524">res_pjsip_pubsub.c:4524</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a5c54dc5f481da88392b1ec7149385613"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a5c54dc5f481da88392b1ec7149385613">ast_sip_subscription_get_body_subtype</a></div><div class="ttdeci">const char * ast_sip_subscription_get_body_subtype(struct ast_sip_subscription *sub)</div><div class="ttdoc">Get the body subtype used for this subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03514">res_pjsip_pubsub.c:3514</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a60c370a28e03a8dc64e6b1cf9f277194"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a60c370a28e03a8dc64e6b1cf9f277194">ast_sip_publication_remove_datastore</a></div><div class="ttdeci">void ast_sip_publication_remove_datastore(struct ast_sip_publication *publication, const char *name)</div><div class="ttdoc">Remove a publication datastore from the publication. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02659">res_pjsip_pubsub.c:2659</a></div></div>
<div class="ttc" id="structast__cli__args_html_acfc02ec89670db29251fda6a66602ce2"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">ast_cli_args::n</a></div><div class="ttdeci">const int n</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00165">cli.h:165</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_gac231880459dcf8feacf1bb272b60472a"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#gac231880459dcf8feacf1bb272b60472a">ast_sip_push_task_wait_serializer</a></div><div class="ttdeci">int ast_sip_push_task_wait_serializer(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Push a task to the serializer and wait for it to complete. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05218">res_pjsip.c:5218</a></div></div>
<div class="ttc" id="structbody__supplements_html"><div class="ttname"><a href="../../d5/d90/structbody__supplements.html">body_supplements</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00537">res_pjsip_pubsub.c:537</a></div></div>
<div class="ttc" id="structast__sip__subscription_html_a4d9a6ec93b26e05758324e9708e7b5a9"><div class="ttname"><a href="../../db/d02/structast__sip__subscription.html#a4d9a6ec93b26e05758324e9708e7b5a9">ast_sip_subscription::handler</a></div><div class="ttdeci">const struct ast_sip_subscription_handler * handler</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00481">res_pjsip_pubsub.c:481</a></div></div>
<div class="ttc" id="astobj2_8h_html"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html">astobj2.h</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a91e1ece55fdcfb0290b5cac07b1d463a"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a91e1ece55fdcfb0290b5cac07b1d463a">subscription_unreference_dialog</a></div><div class="ttdeci">static int subscription_unreference_dialog(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01348">res_pjsip_pubsub.c:1348</a></div></div>
<div class="ttc" id="ast__expr2f_8c_html_a8fdafe3be7e00ce3d4f0cb50a9a5eb39"><div class="ttname"><a href="../../dc/df2/ast__expr2f_8c.html#a8fdafe3be7e00ce3d4f0cb50a9a5eb39">while</a></div><div class="ttdeci">while(1)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df2/ast__expr2f_8c_source.html#l00894">ast_expr2f.c:894</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_af57976fae525316e955e6163f943db90"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#af57976fae525316e955e6163f943db90">subscription_get_generator_from_rdata</a></div><div class="ttdeci">static struct ast_sip_pubsub_body_generator * subscription_get_generator_from_rdata(pjsip_rx_data *rdata, const struct ast_sip_subscription_handler *handler)</div><div class="ttdoc">Retrieve a body generator using the Accept header of an rdata message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00831">res_pjsip_pubsub.c:831</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_aa6f63c8aefae8e2f51a65f61d724aacf"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#aa6f63c8aefae8e2f51a65f61d724aacf">subscription_persistence::cseq</a></div><div class="ttdeci">unsigned int cseq</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00388">res_pjsip_pubsub.c:388</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a944b82566722f2247aa35f1328402c98"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a></div><div class="ttdeci">#define AST_RWLIST_TRAVERSE</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00493">linkedlists.h:493</a></div></div>
<div class="ttc" id="strings_8h_html_ac92713b8d07a45720b2664be70810e55"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a></div><div class="ttdeci">char * ast_strip(char *s)</div><div class="ttdoc">Strip leading/trailing whitespace from a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00219">strings.h:219</a></div></div>
<div class="ttc" id="sched_8h_html"><div class="ttname"><a href="../../d7/d00/sched_8h.html">sched.h</a></div><div class="ttdoc">Scheduler Routines (derived from cheops) </div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a1521854cc25592b7f8a58a4bed55ac6d"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a1521854cc25592b7f8a58a4bed55ac6d">AST_SIP_MAX_ACCEPT</a></div><div class="ttdeci">#define AST_SIP_MAX_ACCEPT</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00219">res_pjsip_pubsub.h:219</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a0a56204d9bae50c4103725ef62aab562a797a8ff87d8dc4f37be06d27c0687352"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a0a56204d9bae50c4103725ef62aab562a797a8ff87d8dc4f37be06d27c0687352">AST_SIP_PUBLISH_STATE_TERMINATED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00043">res_pjsip_pubsub.h:43</a></div></div>
<div class="ttc" id="structcli__sub__parms_html_ae19846dd61ed50eb0d30e3b8bb915a8f"><div class="ttname"><a href="../../dc/d55/structcli__sub__parms.html#ae19846dd61ed50eb0d30e3b8bb915a8f">cli_sub_parms::a</a></div><div class="ttdeci">struct ast_cli_args * a</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04144">res_pjsip_pubsub.c:4144</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa8ac496fa9c717d5afb99a02e1e2760c"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a></div><div class="ttdeci">#define AST_LIST_REMOVE_CURRENT(field)</div><div class="ttdoc">Removes the current entry from a list during a traversal. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00556">linkedlists.h:556</a></div></div>
<div class="ttc" id="structpersistence__recreate__data_html_a41249c16bd9cc17b36f3719debaf7a67"><div class="ttname"><a href="../../d4/d4c/structpersistence__recreate__data.html#a41249c16bd9cc17b36f3719debaf7a67">persistence_recreate_data::rdata</a></div><div class="ttdeci">pjsip_rx_data * rdata</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01545">res_pjsip_pubsub.c:1545</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
<div class="ttc" id="strings_8h_html_a38a896048b2ca84076864505f0aa8f01"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a></div><div class="ttdeci">#define S_COR(a, b, c)</div><div class="ttdoc">returns the equivalent of logic or for strings, with an additional boolean check: second one if not e...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00085">strings.h:85</a></div></div>
<div class="ttc" id="structast__sip__publish__handler_html_a6ad12c15b9231aec95e53a632ff79a56"><div class="ttname"><a href="../../d5/d9f/structast__sip__publish__handler.html#a6ad12c15b9231aec95e53a632ff79a56">ast_sip_publish_handler::next</a></div><div class="ttdeci">struct ast_sip_publish_handler * next</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00090">res_pjsip_pubsub.h:90</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a6b4d4d929013de7812fbba4e58353078"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a6b4d4d929013de7812fbba4e58353078">ast_config_destroy</a></div><div class="ttdeci">void ast_config_destroy(struct ast_config *config)</div><div class="ttdoc">Destroys a config. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l01290">extconf.c:1290</a></div></div>
<div class="ttc" id="structmansession_html"><div class="ttname"><a href="../../d2/d8a/structmansession.html">mansession</a></div><div class="ttdoc">In case you didn&amp;#39;t read that giant block of text above the mansession_session struct, the struct mansession is named this solely to keep the API the same in Asterisk. This structure really represents data that is different from Manager action to Manager action. The mansession_session pointer contained within points to session-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01625">manager.c:1625</a></div></div>
<div class="ttc" id="structast__sip__sched__task_html"><div class="ttname"><a href="../../d5/d3b/structast__sip__sched__task.html">ast_sip_sched_task</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfa/pjsip__scheduler_8c_source.html#l00041">pjsip_scheduler.c:41</a></div></div>
<div class="ttc" id="structinitial__notify__data_html"><div class="ttname"><a href="../../df/dbb/structinitial__notify__data.html">initial_notify_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01534">res_pjsip_pubsub.c:1534</a></div></div>
<div class="ttc" id="time_8h_html_a1d774df72e3dbb623475783e06ce4f61"><div class="ttname"><a href="../../de/df7/time_8h.html#a1d774df72e3dbb623475783e06ce4f61">ast_samp2tv</a></div><div class="ttdeci">struct timeval ast_samp2tv(unsigned int _nsamp, unsigned int _rate)</div><div class="ttdoc">Returns a timeval corresponding to the duration of n samples at rate r. Useful to convert samples to ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00238">time.h:238</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a02212548652c9eb0f3db38dc4e4bd285"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a></div><div class="ttdeci">#define AST_RWLIST_REMOVE_CURRENT</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00569">linkedlists.h:569</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_abe6f294a1dd6e02f90699c6862c8ff37"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#abe6f294a1dd6e02f90699c6862c8ff37">generate_notify_body</a></div><div class="ttdeci">static pjsip_msg_body * generate_notify_body(pj_pool_t *pool, struct ast_sip_subscription *root, unsigned int force_full_state)</div><div class="ttdoc">Create the body for a NOTIFY request. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02371">res_pjsip_pubsub.c:2371</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a2d7ed3f8785ad9d9aa3fc090d983c45d"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a2d7ed3f8785ad9d9aa3fc090d983c45d">ast_sip_subscription_get_resource_name</a></div><div class="ttdeci">const char * ast_sip_subscription_get_resource_name(struct ast_sip_subscription *sub)</div><div class="ttdoc">Get the name of the subscribed resource. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02596">res_pjsip_pubsub.c:2596</a></div></div>
<div class="ttc" id="json_8h_html_a6772fcee88746a9d4f6ec6f240b76dd0"><div class="ttname"><a href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a></div><div class="ttdeci">const char * ast_json_string_get(const struct ast_json *string)</div><div class="ttdoc">Get the value of a JSON string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00273">json.c:273</a></div></div>
<div class="ttc" id="datastore_8h_html_a65b31a9e32e3dad540c98ed2ee36e828"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#a65b31a9e32e3dad540c98ed2ee36e828">ast_datastores_alloc_datastore</a></div><div class="ttdeci">struct ast_datastore * ast_datastores_alloc_datastore(const struct ast_datastore_info *info, const char *uid)</div><div class="ttdoc">Allocate a datastore for use with the datastores container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d7a/datastore_8c_source.html#l00138">datastore.c:138</a></div></div>
<div class="ttc" id="structast__sip__notifier_html_ae3f8912b4a41553688ad665f170c6a91"><div class="ttname"><a href="../../d1/d5b/structast__sip__notifier.html#ae3f8912b4a41553688ad665f170c6a91">ast_sip_notifier::subscription_established</a></div><div class="ttdeci">int(* subscription_established)(struct ast_sip_subscription *sub)</div><div class="ttdoc">Called when an inbound subscription has been accepted. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00284">res_pjsip_pubsub.h:284</a></div></div>
<div class="ttc" id="structast__sip__ami_html_a38bed88f5fd00306683b620c6c90eef4"><div class="ttname"><a href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">ast_sip_ami::s</a></div><div class="ttdeci">struct mansession * s</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02739">res_pjsip.h:2739</a></div></div>
<div class="ttc" id="linkedlists_8h_html"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html">linkedlists.h</a></div><div class="ttdoc">A set of macros to manage forward-linked lists. </div></div>
<div class="ttc" id="structast__variable_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">ast_variable::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00085">include/asterisk/config.h:85</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_a9d867cb404dff4c9d88a624e78a0e4d0"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#a9d867cb404dff4c9d88a624e78a0e4d0">sip_subscription_tree::dlg</a></div><div class="ttdeci">pjsip_dialog * dlg</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00443">res_pjsip_pubsub.c:443</a></div></div>
<div class="ttc" id="structast__sched__context_html"><div class="ttname"><a href="../../d7/de8/structast__sched__context.html">ast_sched_context</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/sched_8c_source.html#l00109">sched.c:109</a></div></div>
<div class="ttc" id="structast__sip__subscription__handler_html"><div class="ttname"><a href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00314">res_pjsip_pubsub.h:314</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a66581086d34dfe7ea86b0644bacef239"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a66581086d34dfe7ea86b0644bacef239">ast_variable_new</a></div><div class="ttdeci">#define ast_variable_new(name, value, filename)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00914">include/asterisk/config.h:914</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aca2de2a2c7ba7a0a16d4632b56af96fa"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aca2de2a2c7ba7a0a16d4632b56af96fa">resource_tree_destroy</a></div><div class="ttdeci">static void resource_tree_destroy(struct resource_tree *tree)</div><div class="ttdoc">Destroy a resource tree. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01109">res_pjsip_pubsub.c:1109</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_adb6d5815066f000bab8aa2aa43611f6c"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#adb6d5815066f000bab8aa2aa43611f6c">publish_add_handler</a></div><div class="ttdeci">static void publish_add_handler(struct ast_sip_publish_handler *handler)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02711">res_pjsip_pubsub.c:2711</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a5df18a3e8742e6bd4e6917b459c4c82d"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a5df18a3e8742e6bd4e6917b459c4c82d">find_body_generator_type_subtype</a></div><div class="ttdeci">static struct ast_sip_pubsub_body_generator * find_body_generator_type_subtype(const char *type, const char *subtype)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02839">res_pjsip_pubsub.c:2839</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a></div><div class="ttdoc">An entity with which Asterisk communicates. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00812">res_pjsip.h:812</a></div></div>
<div class="ttc" id="structsimple__message__summary_html_af13734b83debd190c047ecaa54d0bb7d"><div class="ttname"><a href="../../d0/d4c/structsimple__message__summary.html#af13734b83debd190c047ecaa54d0bb7d">simple_message_summary::voice_messages_old</a></div><div class="ttdeci">int voice_messages_old</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03579">res_pjsip_pubsub.c:3579</a></div></div>
<div class="ttc" id="structcli__sub__parms_html_ad43c3812e6d13e0518d9f8b8f463ffcf"><div class="ttname"><a href="../../dc/d55/structcli__sub__parms.html#ad43c3812e6d13e0518d9f8b8f463ffcf">cli_sub_parms::count</a></div><div class="ttdeci">int count</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04149">res_pjsip_pubsub.c:4149</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a36292f9aacdecd44efe47fa591beb400aff6b9c21e4f98d098c8bad80b822cdd2"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400aff6b9c21e4f98d098c8bad80b822cdd2">SUBSCRIPTION_PERSISTENCE_RECREATED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00529">res_pjsip_pubsub.c:529</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a42ecd8494df028dc44c95b90848ad311a83a82444fd66df13a6196fe98cedff69"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a83a82444fd66df13a6196fe98cedff69">SIP_PUBLISH_REFRESH</a></div><div class="ttdoc">Refresh. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00295">res_pjsip_pubsub.c:295</a></div></div>
<div class="ttc" id="sorcery_8h_html_a5ee86f00f6e2240f74772d59edf0f74a"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a5ee86f00f6e2240f74772d59edf0f74a">ast_sorcery_object_register</a></div><div class="ttdeci">#define ast_sorcery_object_register(sorcery, type, alloc, transform, apply)</div><div class="ttdoc">Register an object type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00838">sorcery.h:838</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a2d923ef44f62dffc05178f762b88f084"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a2d923ef44f62dffc05178f762b88f084">ast_sip_register_service</a></div><div class="ttdeci">int ast_sip_register_service(pjsip_module *module)</div><div class="ttdoc">Register a SIP service in Asterisk. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03315">res_pjsip.c:3315</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__generator_html_abb4ae60bbcbce3616fdd7d4238869c91"><div class="ttname"><a href="../../df/dc3/structast__sip__pubsub__body__generator.html#abb4ae60bbcbce3616fdd7d4238869c91">ast_sip_pubsub_body_generator::subtype</a></div><div class="ttdeci">const char * subtype</div><div class="ttdoc">Content subtype In &quot;plain/text&quot;, &quot;text&quot; is the subtype. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00601">res_pjsip_pubsub.h:601</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a8c090850897d5a72420ff3446fe74440"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a8c090850897d5a72420ff3446fe74440">destroy_subscriptions</a></div><div class="ttdeci">static void destroy_subscriptions(struct ast_sip_subscription *root)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01215">res_pjsip_pubsub.c:1215</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__generator_html_af820db3728fdeafb6d1c8ff284ea6cc5"><div class="ttname"><a href="../../df/dc3/structast__sip__pubsub__body__generator.html#af820db3728fdeafb6d1c8ff284ea6cc5">ast_sip_pubsub_body_generator::list</a></div><div class="ttdeci">struct ast_sip_pubsub_body_generator::@306 list</div></div>
<div class="ttc" id="strings_8h_html_aa8ab574002a6eb04925efea4c2885059"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa8ab574002a6eb04925efea4c2885059">ast_str_to_lower</a></div><div class="ttdeci">static force_inline char * ast_str_to_lower(char *str)</div><div class="ttdoc">Convert a string to all lower-case. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01268">strings.h:1268</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_a9765def6b392c5f0f2eabbf976174b5a"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#a9765def6b392c5f0f2eabbf976174b5a">sip_subscription_tree::state</a></div><div class="ttdeci">enum sip_subscription_tree_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00457">res_pjsip_pubsub.c:457</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a00fd98f03df089bd6aa358f941ae0dcd"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a00fd98f03df089bd6aa358f941ae0dcd">ast_sip_location_retrieve_contact_from_aor_list</a></div><div class="ttdeci">struct ast_sip_contact * ast_sip_location_retrieve_contact_from_aor_list(const char *aor_list)</div><div class="ttdoc">Retrieve the first bound contact from a list of AORs. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00304">location.c:304</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_a009e2d58737d2223ce009dc0631e65dc"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#a009e2d58737d2223ce009dc0631e65dc">subscription_persistence::local_port</a></div><div class="ttdeci">int local_port</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00386">res_pjsip_pubsub.c:386</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a636cc42bbb2d876178e506f54bf1d05f"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a636cc42bbb2d876178e506f54bf1d05f">cli_list_subscriptions_inout</a></div><div class="ttdeci">static char * cli_list_subscriptions_inout(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04580">res_pjsip_pubsub.c:4580</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a21be6da4b2146b04b4868c2be5cae750"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a></div><div class="ttdeci">#define AST_RWLIST_TRAVERSE_SAFE_BEGIN</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00544">linkedlists.h:544</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a83aef050497f83116afc025b7acf19e3"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a83aef050497f83116afc025b7acf19e3">bad_resources</a></div><div class="ttdeci">const char * bad_resources[]</div><div class="ttdoc">&quot;bad&quot; resources </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04889">res_pjsip_pubsub.c:4889</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_adf23ea14cf21cc35810a043bed318bb6"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#adf23ea14cf21cc35810a043bed318bb6">ast_sip_publication_get_endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * ast_sip_publication_get_endpoint(struct ast_sip_publication *pub)</div><div class="ttdoc">Given a publication, get the associated endpoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03420">res_pjsip_pubsub.c:3420</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_aad194ead974937834375b0ac8d37a7c2"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#aad194ead974937834375b0ac8d37a7c2">ast_sip_mod_data_get</a></div><div class="ttdeci">#define ast_sip_mod_data_get(mod_data, id, key)</div><div class="ttdoc">Using the dictionary stored in mod_data array at a given id, retrieve the value associated with the g...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02638">res_pjsip.h:2638</a></div></div>
<div class="ttc" id="res__pjsip__presence__xml_8h_html_a2249425f7ecf2dce721526ea4760a41c"><div class="ttname"><a href="../../d5/dc3/res__pjsip__presence__xml_8h.html#a2249425f7ecf2dce721526ea4760a41c">AST_PJSIP_XML_PROLOG_LEN</a></div><div class="ttdeci">#define AST_PJSIP_XML_PROLOG_LEN</div><div class="ttdoc">Length of the XML prolog when printing presence or other XML in PJSIP. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dc3/res__pjsip__presence__xml_8h_source.html#l00036">res_pjsip_presence_xml.h:36</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a9982efe78ddb41fc54368049fe7ecdfc"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a9982efe78ddb41fc54368049fe7ecdfc">pubsub_on_rx_mwi_notify_request</a></div><div class="ttdeci">static pj_bool_t pubsub_on_rx_mwi_notify_request(pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03614">res_pjsip_pubsub.c:3614</a></div></div>
<div class="ttc" id="sched_8h_html_a5baecc149aeabdbef9b3ed6780c1c4a6"><div class="ttname"><a href="../../d7/d00/sched_8h.html#a5baecc149aeabdbef9b3ed6780c1c4a6">ast_sched_context_create</a></div><div class="ttdeci">struct ast_sched_context * ast_sched_context_create(void)</div><div class="ttdoc">Create a scheduler context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/sched_8c_source.html#l00236">sched.c:236</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a9edd9dcca7f3caf9af7a4af20ab64868"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a9edd9dcca7f3caf9af7a4af20ab64868">pubsub_on_evsub_state</a></div><div class="ttdeci">static void pubsub_on_evsub_state(pjsip_evsub *sub, pjsip_event *event)</div><div class="ttdoc">Callback sequence for subscription terminate: </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03807">res_pjsip_pubsub.c:3807</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a5d73e049fbced1da4e3041d1656e0aa6"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a5d73e049fbced1da4e3041d1656e0aa6">ast_sip_transport_monitor_unregister</a></div><div class="ttdeci">void ast_sip_transport_monitor_unregister(pjsip_transport *transport, ast_transport_monitor_shutdown_cb cb, void *data, ast_transport_monitor_data_matcher matches)</div><div class="ttdoc">Unregister a reliable transport shutdown monitor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d94/pjsip__transport__events_8c_source.html#l00277">pjsip_transport_events.c:277</a></div></div>
<div class="ttc" id="structast__sip__subscription_html"><div class="ttname"><a href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a></div><div class="ttdoc">Structure representing a &quot;virtual&quot; SIP subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00477">res_pjsip_pubsub.c:477</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ae47a39537fdf10ceba2fad9d9c380179"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ae47a39537fdf10ceba2fad9d9c380179">ast_sip_is_content_type</a></div><div class="ttdeci">int ast_sip_is_content_type(pjsip_media_type *content_type, char *type, char *subtype)</div><div class="ttdoc">Checks if the given content type matches type/subtype. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05259">res_pjsip.c:5259</a></div></div>
<div class="ttc" id="test_8h_html_a9482d93ea3931853331bdbc745ce7cb4"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a></div><div class="ttdeci">#define ast_test_suite_event_notify(s, f,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00196">test.h:196</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="structast__cli__args_html_ad0a19c4d63698f9e9cfd5653e8851452"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">ast_cli_args::argv</a></div><div class="ttdeci">const char *const  * argv</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00161">cli.h:161</a></div></div>
<div class="ttc" id="codec__dahdi_8c_html_ab04b09a194737700c43608ca6de2d1c9"><div class="ttname"><a href="../../de/d52/codec__dahdi_8c.html#ab04b09a194737700c43608ca6de2d1c9">cli</a></div><div class="ttdeci">static struct ast_cli_entry cli[]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d52/codec__dahdi_8c_source.html#l00265">codec_dahdi.c:265</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html_a50783ac9bc6f4943369ed254972049ac"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html#a50783ac9bc6f4943369ed254972049ac">ast_sip_endpoint::id</a></div><div class="ttdeci">struct ast_sip_endpoint_id_configuration id</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00847">res_pjsip.h:847</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gafadf012f66a9fd7ecf985ec5b9dee101"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a></div><div class="ttdeci">int ast_manager_unregister(const char *action)</div><div class="ttdoc">Unregister a registered manager command. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l07258">manager.c:7258</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a47e4246289d04b68202052414c219922"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a47e4246289d04b68202052414c219922">cli_complete_subscription_callid</a></div><div class="ttdeci">static char * cli_complete_subscription_callid(struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04193">res_pjsip_pubsub.c:4193</a></div></div>
<div class="ttc" id="manager_8h_html"><div class="ttname"><a href="../../db/d45/manager_8h.html">manager.h</a></div><div class="ttdoc">The AMI - Asterisk Manager Interface - is a TCP protocol created to manage Asterisk with third-party ...</div></div>
<div class="ttc" id="structast__sip__publish__handler_html_af0ab5befc3e79fb52d28e243c8ac14e0"><div class="ttname"><a href="../../d5/d9f/structast__sip__publish__handler.html#af0ab5befc3e79fb52d28e243c8ac14e0">ast_sip_publish_handler::publication_state_change</a></div><div class="ttdeci">int(* publication_state_change)(struct ast_sip_publication *pub, pjsip_msg_body *body, enum ast_sip_publish_state state)</div><div class="ttdoc">Published resource has changed states. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00088">res_pjsip_pubsub.h:88</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aac028869908c724f84c3a1cee520315c"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aac028869908c724f84c3a1cee520315c">persistence_tag_str2struct</a></div><div class="ttdeci">static int persistence_tag_str2struct(const struct aco_option *opt, struct ast_variable *var, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04689">res_pjsip_pubsub.c:4689</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ac0030d8d5c2b988a0f7e7968a66180dd"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ac0030d8d5c2b988a0f7e7968a66180dd">ast_sip_pubsub_is_body_generator_registered</a></div><div class="ttdeci">int ast_sip_pubsub_is_body_generator_registered(const char *type, const char *subtype)</div><div class="ttdoc">Is a body generator registered for the given type/subtype. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03435">res_pjsip_pubsub.c:3435</a></div></div>
<div class="ttc" id="structast__sip__notifier_html_a0772d90dd533f5d4d50dccaad8817843"><div class="ttname"><a href="../../d1/d5b/structast__sip__notifier.html#a0772d90dd533f5d4d50dccaad8817843">ast_sip_notifier::new_subscribe</a></div><div class="ttdeci">int(* new_subscribe)(struct ast_sip_endpoint *endpoint, const char *resource)</div><div class="ttdoc">Called when a SUBSCRIBE arrives attempting to establish a new subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00270">res_pjsip_pubsub.h:270</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ae4bf9f7f4557d02712ea86b10e5d6891"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ae4bf9f7f4557d02712ea86b10e5d6891">sip_subscription_send_request</a></div><div class="ttdeci">static int sip_subscription_send_request(struct sip_subscription_tree *sub_tree, pjsip_tx_data *tdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01989">res_pjsip_pubsub.c:1989</a></div></div>
<div class="ttc" id="asterisk_8h_html_a0eb0441c04955094ce5845fb0258645a"><div class="ttname"><a href="../../db/db2/asterisk_8h.html#a0eb0441c04955094ce5845fb0258645a">ast_shutdown_final</a></div><div class="ttdeci">int ast_shutdown_final(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d03/asterisk_8c_source.html#l01829">asterisk.c:1829</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aa3b78cda3768f8f485e1ad46d6fcb765"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aa3b78cda3768f8f485e1ad46d6fcb765">ast_sip_pubsub_generate_body_content</a></div><div class="ttdeci">int ast_sip_pubsub_generate_body_content(const char *type, const char *subtype, struct ast_sip_body_data *data, struct ast_str **str)</div><div class="ttdoc">Generate body content for a PUBLISH or NOTIFY. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03519">res_pjsip_pubsub.c:3519</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a267cc6529937f4689c804fb39976a823"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a267cc6529937f4689c804fb39976a823">publication_hash_fn</a></div><div class="ttdeci">static int publication_hash_fn(const void *obj, const int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02693">res_pjsip_pubsub.c:2693</a></div></div>
<div class="ttc" id="sorcery_8h_html_aeb9bd9c0bcdaff27ac438a02d472c3b1"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a></div><div class="ttdeci">int ast_sorcery_delete(const struct ast_sorcery *sorcery, void *object)</div><div class="ttdoc">Delete an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02233">sorcery.c:2233</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aba712df013e1be0394a2c2943a595376"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aba712df013e1be0394a2c2943a595376">pubsub_on_rx_notify_request</a></div><div class="ttdeci">static pj_bool_t pubsub_on_rx_notify_request(pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03697">res_pjsip_pubsub.c:3697</a></div></div>
<div class="ttc" id="structast__sip__publication_html_a06552650d7ef9108d5744ee3f3fff264"><div class="ttname"><a href="../../d4/da6/structast__sip__publication.html#a06552650d7ef9108d5744ee3f3fff264">ast_sip_publication::expires</a></div><div class="ttdeci">unsigned int expires</div><div class="ttdoc">Expiration time of the publication. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00355">res_pjsip_pubsub.c:355</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a3906226af7019edcf94ef2ce356dc7cf"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a3906226af7019edcf94ef2ce356dc7cf">resource_event_handler</a></div><div class="ttdeci">static int resource_event_handler(const struct aco_option *opt, struct ast_variable *var, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l05536">res_pjsip_pubsub.c:5536</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html">res_pjsip_pubsub.h</a></div></div>
<div class="ttc" id="structcli__sub__complete__parms_html"><div class="ttname"><a href="../../d7/df6/structcli__sub__complete__parms.html">cli_sub_complete_parms</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04152">res_pjsip_pubsub.c:4152</a></div></div>
<div class="ttc" id="astobj2_8h_html_aefc16f8aa9087cbc5c55c70cf1dd41b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a></div><div class="ttdeci">#define ao2_container_alloc_hash(ao2_options, container_options, n_buckets, hash_fn, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01310">astobj2.h:1310</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a539e82113ed22c70c9f62f4d45f15b67"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a539e82113ed22c70c9f62f4d45f15b67">cli_show_subscription_outbound</a></div><div class="ttdeci">static int cli_show_subscription_outbound(struct sip_subscription_tree *sub_tree, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04328">res_pjsip_pubsub.c:4328</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_acd22eade3d3a1bfce2d9acf505d34b1a"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#acd22eade3d3a1bfce2d9acf505d34b1a">ast_sip_subscription_get_datastores</a></div><div class="ttdeci">struct ao2_container * ast_sip_subscription_get_datastores(const struct ast_sip_subscription *subscription)</div><div class="ttdoc">Get the datastores container for a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02644">res_pjsip_pubsub.c:2644</a></div></div>
<div class="ttc" id="structast__sip__publication_html_a2f64eb664f09b6d1dde7f4eed3f55862"><div class="ttname"><a href="../../d4/da6/structast__sip__publication.html#a2f64eb664f09b6d1dde7f4eed3f55862">ast_sip_publication::handler</a></div><div class="ttdeci">struct ast_sip_publish_handler * handler</div><div class="ttdoc">Handler for this publication. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00351">res_pjsip_pubsub.c:351</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__supplement_html_a50233821a9d3db6ae3c8b16d85bffe86"><div class="ttname"><a href="../../d7/d72/structast__sip__pubsub__body__supplement.html#a50233821a9d3db6ae3c8b16d85bffe86">ast_sip_pubsub_body_supplement::list</a></div><div class="ttdeci">struct ast_sip_pubsub_body_supplement::@307 list</div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_abefb888baf6382d9f1a1266d24e21648"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#abefb888baf6382d9f1a1266d24e21648">publish_request_initial</a></div><div class="ttdeci">static struct ast_sip_publication * publish_request_initial(struct ast_sip_endpoint *endpoint, pjsip_rx_data *rdata, struct ast_sip_publish_handler *handler)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03214">res_pjsip_pubsub.c:3214</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="app__fax_8c_html_a36aeb2eb01afb248bad64a309d743636"><div class="ttname"><a href="../../df/dde/app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a></div><div class="ttdeci">static struct ast_generator generator</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dde/app__fax_8c_source.html#l00359">app_fax.c:359</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ad4c0e99b92215cdc4a96b439c108cd0a"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ad4c0e99b92215cdc4a96b439c108cd0a">determine_sip_publish_type</a></div><div class="ttdeci">static enum sip_publish_type determine_sip_publish_type(pjsip_rx_data *rdata, pjsip_generic_string_hdr *etag_hdr, unsigned int *expires, int *entity_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03102">res_pjsip_pubsub.c:3102</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a97f99a19e99580b4339e386220c2d9f6"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a97f99a19e99580b4339e386220c2d9f6">subscription_get_handler_from_rdata</a></div><div class="ttdeci">static struct ast_sip_subscription_handler * subscription_get_handler_from_rdata(pjsip_rx_data *rdata, const char *endpoint)</div><div class="ttdoc">Retrieve a handler using the Event header of an rdata message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00771">res_pjsip_pubsub.c:771</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a2294ee18e05ee676e083133058243909"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a2294ee18e05ee676e083133058243909">ast_sip_subscription_get_body_type</a></div><div class="ttdeci">const char * ast_sip_subscription_get_body_type(struct ast_sip_subscription *sub)</div><div class="ttdoc">Get the body type used for this subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03509">res_pjsip_pubsub.c:3509</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a204519f08566a8c5fb4711168cad11e3"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a204519f08566a8c5fb4711168cad11e3">allocate_tdata_buffer</a></div><div class="ttdeci">static int allocate_tdata_buffer(pjsip_tx_data *tdata)</div><div class="ttdoc">Pre-allocate a buffer for the transmission. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01967">res_pjsip_pubsub.c:1967</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a3ba86604727a1f14973496013df1884e"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a3ba86604727a1f14973496013df1884e">cli_complete_subscription_outbound</a></div><div class="ttdeci">static int cli_complete_subscription_outbound(struct sip_subscription_tree *sub_tree, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04187">res_pjsip_pubsub.c:4187</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="cli_8h_html_a0873456096960dab21fff0ce68c95acb"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a></div><div class="ttdeci">#define CLI_SHOWUSAGE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00045">cli.h:45</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga4f0a0629fa2ca084812772356d8e3565"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a></div><div class="ttdeci">int ast_sip_push_task(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Pushes a task to SIP servants. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05138">res_pjsip.c:5138</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a2353e3034a3cbd98dcc94740a7d5f8c1"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a2353e3034a3cbd98dcc94740a7d5f8c1">test_new_subscribe</a></div><div class="ttdeci">static int test_new_subscribe(struct ast_sip_endpoint *endpoint, const char *resource)</div><div class="ttdoc">new_subscribe callback for unit tests </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04901">res_pjsip_pubsub.c:4901</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a3707d69a8c25755d9fbe3f4d2ed80477"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a3707d69a8c25755d9fbe3f4d2ed80477">build_resource_tree</a></div><div class="ttdeci">static int build_resource_tree(struct ast_sip_endpoint *endpoint, const struct ast_sip_subscription_handler *handler, const char *resource, struct resource_tree *tree, int has_eventlist_support)</div><div class="ttdoc">Build a resource tree. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01135">res_pjsip_pubsub.c:1135</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a8b3391cb48972f432118c4ca2eeb3063"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a8b3391cb48972f432118c4ca2eeb3063">send_notify</a></div><div class="ttdeci">static int send_notify(struct sip_subscription_tree *sub_tree, unsigned int force_full_state)</div><div class="ttdoc">Send a NOTIFY request to a subscriber. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02425">res_pjsip_pubsub.c:2425</a></div></div>
<div class="ttc" id="test_8h_html_a79bc64a935b14b1b181156e5ada58ead"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a></div><div class="ttdeci">#define AST_TEST_UNREGISTER(cb)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00128">test.h:128</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_acc8db1e0ce416bc7a5a05275db0cb8a7"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#acc8db1e0ce416bc7a5a05275db0cb8a7">subscription_setup_dialog</a></div><div class="ttdeci">static void subscription_setup_dialog(struct sip_subscription_tree *sub_tree, pjsip_dialog *dlg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01396">res_pjsip_pubsub.c:1396</a></div></div>
<div class="ttc" id="structpersistence__recreate__data_html_a21053f8b496f0b3ac0aee6f43d27adce"><div class="ttname"><a href="../../d4/d4c/structpersistence__recreate__data.html#a21053f8b496f0b3ac0aee6f43d27adce">persistence_recreate_data::persistence</a></div><div class="ttdeci">struct subscription_persistence * persistence</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01544">res_pjsip_pubsub.c:1544</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a2a6654da48a7765b0c5957be5c282ea6"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a2a6654da48a7765b0c5957be5c282ea6">check_node</a></div><div class="ttdeci">static int check_node(struct ast_test *test, struct tree_node *node, const char **resources, size_t num_resources)</div><div class="ttdoc">Check the integrity of a tree node against a set of resources. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l05022">res_pjsip_pubsub.c:5022</a></div></div>
<div class="ttc" id="structast__sip__publication_html_a6aae576152b40374b43f81349aecc739"><div class="ttname"><a href="../../d4/da6/structast__sip__publication.html#a6aae576152b40374b43f81349aecc739">ast_sip_publication::event_configuration_name</a></div><div class="ttdeci">char * event_configuration_name</div><div class="ttdoc">The name of the event type configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00361">res_pjsip_pubsub.c:361</a></div></div>
<div class="ttc" id="config__options_8h_html_a61bb4940517e7d00e7104de8273c2144a5cb849face8441c434d1a2f60264cedb"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a5cb849face8441c434d1a2f60264cedb">OPT_BOOL_T</a></div><div class="ttdoc">Type for default option handler for bools (ast_true/ast_false) </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00294">config_options.h:294</a></div></div>
<div class="ttc" id="strings_8h_html_ab2c8e1bf4b2b01a1ffabf882774907bb"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ab2c8e1bf4b2b01a1ffabf882774907bb">ast_generate_random_string</a></div><div class="ttdeci">char * ast_generate_random_string(char *buf, size_t size)</div><div class="ttdoc">Create a pseudo-random string of a fixed length. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d48/strings_8c_source.html#l00227">strings.c:227</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aebb94c33681f975e62c71f1e970f7dae"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aebb94c33681f975e62c71f1e970f7dae">cli_complete_subscription_inbound</a></div><div class="ttdeci">static int cli_complete_subscription_inbound(struct sip_subscription_tree *sub_tree, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04181">res_pjsip_pubsub.c:4181</a></div></div>
<div class="ttc" id="namespacesip__to__pjsip_html_ab82f408a83ecba10ea39afd8abfd371e"><div class="ttname"><a href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">sip_to_pjsip.info</a></div><div class="ttdeci">def info(msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d6f/sip__to__pjsip_8py_source.html#l01313">sip_to_pjsip.py:1313</a></div></div>
<div class="ttc" id="module_8h_html_a9967b09817639f2e15c3f074a60b6379"><div class="ttname"><a href="../../d5/d16/module_8h.html#a9967b09817639f2e15c3f074a60b6379">ast_module_shutdown_ref</a></div><div class="ttdeci">#define ast_module_shutdown_ref(mod)</div><div class="ttdoc">Prevent unload of the module before shutdown. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00464">module.h:464</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ac14c963f858de2e8b9bcd86c1a127b2d"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ac14c963f858de2e8b9bcd86c1a127b2d">ast_sip_subscription_get_persistence_data</a></div><div class="ttdeci">const struct ast_json * ast_sip_subscription_get_persistence_data(const struct ast_sip_subscription *subscription)</div><div class="ttdoc">Retrieve persistence data for a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02686">res_pjsip_pubsub.c:2686</a></div></div>
<div class="ttc" id="sorcery_8h_html_ad1165cf9d45ed5ffa1555371be9ae770"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#ad1165cf9d45ed5ffa1555371be9ae770">ast_sorcery_apply_default</a></div><div class="ttdeci">#define ast_sorcery_apply_default(sorcery, type, name, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00477">sorcery.h:477</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a45ea33c1531c67d7002776939ec80b2b"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a45ea33c1531c67d7002776939ec80b2b">sub_persistence_recreate</a></div><div class="ttdeci">static int sub_persistence_recreate(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01556">res_pjsip_pubsub.c:1556</a></div></div>
<div class="ttc" id="structast__sip__contact_html"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a></div><div class="ttdoc">Contact associated with an address of record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00281">res_pjsip.h:281</a></div></div>
<div class="ttc" id="stasis_8h_html_a597f7a30fe616c9f083a93ed168955ed"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a></div><div class="ttdeci">#define stasis_subscribe_pool(topic, callback, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00682">stasis.h:682</a></div></div>
<div class="ttc" id="time_8h_html_a97e1bb8fbd7a103212789e87e7ed6073"><div class="ttname"><a href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a></div><div class="ttdeci">struct timeval ast_tvadd(struct timeval a, struct timeval b)</div><div class="ttdoc">Returns the sum of two timevals a + b. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l02283">extconf.c:2283</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a0e8ac5e3b2ce24bb0441ca5c30fa783c"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a0e8ac5e3b2ce24bb0441ca5c30fa783c">subscription_persistence_load</a></div><div class="ttdeci">static int subscription_persistence_load(void *data)</div><div class="ttdoc">Function which loads and recreates persisted subscriptions upon startup when the system is fully boot...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01750">res_pjsip_pubsub.c:1750</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a250d91ea4fba33dd520804c8a47e795a"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a250d91ea4fba33dd520804c8a47e795a">ast_sip_register_subscription_handler</a></div><div class="ttdeci">int ast_sip_register_subscription_handler(struct ast_sip_subscription_handler *handler)</div><div class="ttdoc">Register a subscription handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02777">res_pjsip_pubsub.c:2777</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_gad57aa0b914fbd6adbf8ee2fe176e1fb1"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#gad57aa0b914fbd6adbf8ee2fe176e1fb1">ast_sip_create_serializer</a></div><div class="ttdeci">struct ast_taskprocessor * ast_sip_create_serializer(const char *name)</div><div class="ttdoc">Create a new serializer for SIP tasks. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05133">res_pjsip.c:5133</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__generator_html_a3b12361a3bb7b12cc7729927503209cb"><div class="ttname"><a href="../../df/dc3/structast__sip__pubsub__body__generator.html#a3b12361a3bb7b12cc7729927503209cb">ast_sip_pubsub_body_generator::destroy_body</a></div><div class="ttdeci">void(* destroy_body)(void *body)</div><div class="ttdoc">Deallocate resources created for the body. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00645">res_pjsip_pubsub.h:645</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_a050353acc15d097365b7d63f33634d93"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#a050353acc15d097365b7d63f33634d93">subscription_persistence::transport_key</a></div><div class="ttdeci">char transport_key[32]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00382">res_pjsip_pubsub.c:382</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a98dd8da033568491b0241453b2cf34a2"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a98dd8da033568491b0241453b2cf34a2">ami_subscription_detail</a></div><div class="ttdeci">static int ami_subscription_detail(struct sip_subscription_tree *sub_tree, struct ast_sip_ami *ami, const char *event)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04031">res_pjsip_pubsub.c:4031</a></div></div>
<div class="ttc" id="stasis_8h_html_a3498301077e2005383f0d261c471388b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a></div><div class="ttdeci">struct stasis_subscription * stasis_unsubscribe(struct stasis_subscription *subscription)</div><div class="ttdoc">Cancel a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00973">stasis.c:973</a></div></div>
<div class="ttc" id="structast__sip__publish__handler_html"><div class="ttname"><a href="../../d5/d9f/structast__sip__publish__handler.html">ast_sip_publish_handler</a></div><div class="ttdoc">Callbacks that publication handlers will define. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00049">res_pjsip_pubsub.h:49</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="structast__sip__publication_html_add9403c2dd81e949c8c4aa872eabdcc7"><div class="ttname"><a href="../../d4/da6/structast__sip__publication.html#add9403c2dd81e949c8c4aa872eabdcc7">ast_sip_publication::resource</a></div><div class="ttdeci">char * resource</div><div class="ttdoc">The resource the publication is to. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00359">res_pjsip_pubsub.c:359</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga506c31bc071963fa7ef3ed517fa0a533"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga506c31bc071963fa7ef3ed517fa0a533">ast_sip_get_distributor_serializer</a></div><div class="ttdeci">struct ast_taskprocessor * ast_sip_get_distributor_serializer(pjsip_rx_data *rdata)</div><div class="ttdoc">Determine the distributor serializer for the SIP message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dad/pjsip__distributor_8c_source.html#l00448">pjsip_distributor.c:448</a></div></div>
<div class="ttc" id="logger_8h_html_ad89ee324d180cdcd7defcc709ff9ca42"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a></div><div class="ttdeci">#define LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00263">logger.h:263</a></div></div>
<div class="ttc" id="sorcery_8h_html_acb6c97c18566cf94a7ac95a43dd9a816"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a></div><div class="ttdeci">void * ast_sorcery_alloc(const struct ast_sorcery *sorcery, const char *type, const char *id)</div><div class="ttdoc">Allocate an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01744">sorcery.c:1744</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a20aeeed556614ef809787fb4f04de0fb"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a20aeeed556614ef809787fb4f04de0fb">sip_publication_respond</a></div><div class="ttdeci">static int sip_publication_respond(struct ast_sip_publication *pub, int status_code, pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03179">res_pjsip_pubsub.c:3179</a></div></div>
<div class="ttc" id="structast__sip__subscription__handler_html_aeccf279e6fca0e5f8536fdf76c838728"><div class="ttname"><a href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">ast_sip_subscription_handler::event_name</a></div><div class="ttdeci">const char * event_name</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00316">res_pjsip_pubsub.h:316</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a823b9711e5de08ec19a03f1994c11b30"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a823b9711e5de08ec19a03f1994c11b30">ast_sip_subscription_set_persistence_data</a></div><div class="ttdeci">void ast_sip_subscription_set_persistence_data(struct ast_sip_subscription *subscription, struct ast_json *persistence_data)</div><div class="ttdoc">Set persistence data for a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02669">res_pjsip_pubsub.c:2669</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00202">test.h:202</a></div></div>
<div class="ttc" id="structast__config_html"><div class="ttname"><a href="../../dd/d18/structast__config.html">ast_config</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d9d/main_2config_8c_source.html#l00249">main/config.c:249</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_a8f1e0d0bf78f07ba5cd5825726b20eb8"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#a8f1e0d0bf78f07ba5cd5825726b20eb8">sip_subscription_tree::next</a></div><div class="ttdeci">struct sip_subscription_tree * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00455">res_pjsip_pubsub.c:455</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a3008b2f4f236b72d8bcfb80e346324ef"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE(head, var, field)</div><div class="ttdoc">Loops over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00490">linkedlists.h:490</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a67508a613c8f337732e35d9367b43ae7"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7">AST_LIST_ENTRY</a></div><div class="ttdeci">#define AST_LIST_ENTRY(type)</div><div class="ttdoc">Declare a forward link structure inside a list entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00409">linkedlists.h:409</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aace626897b8057471bc8f06b3e91e16c"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aace626897b8057471bc8f06b3e91e16c">subscription_persistence_remove</a></div><div class="ttdeci">static void subscription_persistence_remove(struct sip_subscription_tree *sub_tree)</div><div class="ttdoc">Function which removes persistence of a subscription from sorcery. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00745">res_pjsip_pubsub.c:745</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa2ded2af046bb513f77056c27c083307"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307">AST_LIST_INSERT_HEAD</a></div><div class="ttdeci">#define AST_LIST_INSERT_HEAD(head, elm, field)</div><div class="ttdoc">Inserts a list entry at the head of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00710">linkedlists.h:710</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ac1dd2ba4db4cb10f5d1813886503bd96"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ac1dd2ba4db4cb10f5d1813886503bd96">ast_sip_publication_get_resource</a></div><div class="ttdeci">const char * ast_sip_publication_get_resource(const struct ast_sip_publication *pub)</div><div class="ttdoc">Given a publication, get the resource the publication is to. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03425">res_pjsip_pubsub.c:3425</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a66473fb602c745c3dfa226d1c47f425f"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a66473fb602c745c3dfa226d1c47f425f">cli_show_subscription_inbound</a></div><div class="ttdeci">static int cli_show_subscription_inbound(struct sip_subscription_tree *sub_tree, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04322">res_pjsip_pubsub.c:4322</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a5d3ad3f5c55c026e22e1103686227ae0"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a5d3ad3f5c55c026e22e1103686227ae0">ast_sip_subscription_alloc_datastore</a></div><div class="ttdeci">struct ast_datastore * ast_sip_subscription_alloc_datastore(const struct ast_datastore_info *info, const char *uid)</div><div class="ttdoc">Alternative for ast_datastore_alloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02624">res_pjsip_pubsub.c:2624</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a81b4b1c3c855fb371e7723b473f1ee78"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a81b4b1c3c855fb371e7723b473f1ee78">version</a></div><div class="ttdeci">static char version[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00391">chan_ooh323.c:391</a></div></div>
<div class="ttc" id="cli_8h_html_ae47751901c430ebb833e59291a5e0b3f"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a></div><div class="ttdeci">#define CLI_FAILURE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00046">cli.h:46</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a673b72409d496c2975c04f5d44f8a277"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a673b72409d496c2975c04f5d44f8a277">ineligible_configuration</a></div><div class="ttdeci">static int ineligible_configuration(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l05053">res_pjsip_pubsub.c:5053</a></div></div>
<div class="ttc" id="structast__sip__publication_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../d4/da6/structast__sip__publication.html#a3960205b2a4e7e012dc9f0eae1855f01">ast_sip_publication::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdoc">The endpoint with which the subscription is communicating. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00353">res_pjsip_pubsub.c:353</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_af7c7bb566c8c49dc6536269d0cb736a8"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#af7c7bb566c8c49dc6536269d0cb736a8">ast_sip_create_rdata_with_contact</a></div><div class="ttdeci">int ast_sip_create_rdata_with_contact(pjsip_rx_data *rdata, char *packet, const char *src_name, int src_port, char *transport_type, const char *local_name, int local_port, const char *contact_uri)</div><div class="ttdoc">General purpose method for creating an rdata structure using specific information. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l04271">res_pjsip.c:4271</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__cli__entry_html_ade9cba72805fe52685a1deea307a8e82"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">ast_cli_entry::command</a></div><div class="ttdeci">char * command</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00186">cli.h:186</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a082c4ba2ff2ee9753efd0875b7cfaec3"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a082c4ba2ff2ee9753efd0875b7cfaec3">cli_show_subscriptions_detail</a></div><div class="ttdeci">static int cli_show_subscriptions_detail(struct sip_subscription_tree *sub_tree, struct cli_sub_parms *cli)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04384">res_pjsip_pubsub.c:4384</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a9d885d67aea1a6b3419ea96692cd2527"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a9d885d67aea1a6b3419ea96692cd2527">ast_sip_create_dialog_uas_locked</a></div><div class="ttdeci">pjsip_dialog * ast_sip_create_dialog_uas_locked(const struct ast_sip_endpoint *endpoint, pjsip_rx_data *rdata, pj_status_t *status)</div><div class="ttdoc">General purpose method for creating a UAS dialog with an endpoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l04249">res_pjsip.c:4249</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_afc1efa41dfd583546f0fb620d85bbef8"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#afc1efa41dfd583546f0fb620d85bbef8">sip_subscription_tree::expiration_task</a></div><div class="ttdeci">struct ast_sip_sched_task * expiration_task</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00462">res_pjsip_pubsub.c:462</a></div></div>
<div class="ttc" id="structresource__list_html_aac996d1f40f0b3df21082fd7f1b5d953"><div class="ttname"><a href="../../df/dd0/structresource__list.html#aac996d1f40f0b3df21082fd7f1b5d953">resource_list::items</a></div><div class="ttdeci">struct resources items</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00330">res_pjsip_pubsub.c:330</a></div></div>
<div class="ttc" id="func__strings_8c_html_a1b62eb9e3ebf087509f4301aa6336931"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#a1b62eb9e3ebf087509f4301aa6336931">regex</a></div><div class="ttdeci">static int regex(struct ast_channel *chan, const char *cmd, char *parse, char *buf, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l00948">func_strings.c:948</a></div></div>
<div class="ttc" id="structast__sip__subscriber_html_a6cd23572cbfc2d0302ac6929a18a975b"><div class="ttname"><a href="../../db/dd4/structast__sip__subscriber.html#a6cd23572cbfc2d0302ac6929a18a975b">ast_sip_subscriber::state_change</a></div><div class="ttdeci">void(* state_change)(struct ast_sip_subscription *sub, pjsip_msg_body *body, enum pjsip_evsub_state state)</div><div class="ttdoc">A NOTIFY has been received. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00311">res_pjsip_pubsub.h:311</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a52b5a301995d607923de2caddcdcdb62"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a52b5a301995d607923de2caddcdcdb62">shutdown_subscriptions</a></div><div class="ttdeci">static void shutdown_subscriptions(struct ast_sip_subscription *sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01328">res_pjsip_pubsub.c:1328</a></div></div>
<div class="ttc" id="structserializer_html"><div class="ttname"><a href="../../d9/d47/structserializer.html">serializer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01315">threadpool.c:1315</a></div></div>
<div class="ttc" id="structcli__sub__parms_html_a417ed811ee3ebdee5d550c986daacfa5"><div class="ttname"><a href="../../dc/d55/structcli__sub__parms.html#a417ed811ee3ebdee5d550c986daacfa5">cli_sub_parms::like</a></div><div class="ttdeci">regex_t * like</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04148">res_pjsip_pubsub.c:4148</a></div></div>
<div class="ttc" id="res__pjsip__private_8h_html_ac73444851015b8a7be33534e4a7d2878"><div class="ttname"><a href="../../d7/d5c/res__pjsip__private_8h.html#ac73444851015b8a7be33534e4a7d2878">ast_sip_will_uri_survive_restart</a></div><div class="ttdeci">int ast_sip_will_uri_survive_restart(pjsip_sip_uri *uri, struct ast_sip_endpoint *endpoint, pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03723">res_pjsip.c:3723</a></div></div>
<div class="ttc" id="datastore_8h_html_a126dac1c8ced6e9cf905430e88f35396"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#a126dac1c8ced6e9cf905430e88f35396">ast_datastores_remove</a></div><div class="ttdeci">void ast_datastores_remove(struct ao2_container *datastores, const char *name)</div><div class="ttdoc">Remove a data store from a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d7a/datastore_8c_source.html#l00114">datastore.c:114</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ad45e6800f846deafb7b108ee3107b22a"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ad45e6800f846deafb7b108ee3107b22a">create_virtual_subscriptions</a></div><div class="ttdeci">static struct ast_sip_subscription * create_virtual_subscriptions(const struct ast_sip_subscription_handler *handler, const char *resource, struct ast_sip_pubsub_body_generator *generator, struct sip_subscription_tree *tree, struct tree_node *current)</div><div class="ttdoc">Create a tree of virtual subscriptions based on a resource tree node. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01286">res_pjsip_pubsub.c:1286</a></div></div>
<div class="ttc" id="structbody__part_html_a97f61ce218f9876fc092948fe744b2bc"><div class="ttname"><a href="../../d2/de8/structbody__part.html#a97f61ce218f9876fc092948fe744b2bc">body_part::cid</a></div><div class="ttdeci">pjsip_generic_string_hdr * cid</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02082">res_pjsip_pubsub.c:2082</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a474bbe394cad0178cf128a36a312ca62"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a474bbe394cad0178cf128a36a312ca62">rlmi_clone_data</a></div><div class="ttdeci">static void * rlmi_clone_data(pj_pool_t *pool, const void *data, unsigned len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02140">res_pjsip_pubsub.c:2140</a></div></div>
<div class="ttc" id="res__pjsip__presence__xml_8h_html_ae8b2b2ccfe3099ff401bad55c2820f98"><div class="ttname"><a href="../../d5/dc3/res__pjsip__presence__xml_8h.html#ae8b2b2ccfe3099ff401bad55c2820f98">ast_sip_presence_xml_create_node</a></div><div class="ttdeci">pj_xml_node * ast_sip_presence_xml_create_node(pj_pool_t *pool, pj_xml_node *parent, const char *name)</div><div class="ttdoc">Create XML node. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6b/presence__xml_8c_source.html#l00152">presence_xml.c:152</a></div></div>
<div class="ttc" id="structast__cli__args_html_adc1f34651f7bbfa3ba5af27db5f53817"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">ast_cli_args::word</a></div><div class="ttdeci">const char * word</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00163">cli.h:163</a></div></div>
<div class="ttc" id="structast__sip__publication__resource_html_a6d2d1c31529bee906473fcabaffff34f"><div class="ttname"><a href="../../d2/d91/structast__sip__publication__resource.html#a6d2d1c31529bee906473fcabaffff34f">ast_sip_publication_resource::endpoint</a></div><div class="ttdeci">char * endpoint</div><div class="ttdoc">Optional name of an endpoint that is only allowed to publish to this resource. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00513">res_pjsip_pubsub.c:513</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a354490007a46ab4f8bebe7d7211bf57c"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a354490007a46ab4f8bebe7d7211bf57c">AST_TEST_DEFINE</a></div><div class="ttdeci">AST_TEST_DEFINE(resource_tree)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l05078">res_pjsip_pubsub.c:5078</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_acd2ddc65db04f4a50bb9fe68a197b167"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#acd2ddc65db04f4a50bb9fe68a197b167">test_resource_tree_destroy</a></div><div class="ttdeci">static void test_resource_tree_destroy(struct resource_tree *tree)</div><div class="ttdoc">RAII_VAR callback to destroy an allocated resource tree. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l05047">res_pjsip_pubsub.c:5047</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aa1a6f87906d88cf1f915a7598309a3f0"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aa1a6f87906d88cf1f915a7598309a3f0">list_item_handler</a></div><div class="ttdeci">static int list_item_handler(const struct aco_option *opt, struct ast_variable *var, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04794">res_pjsip_pubsub.c:4794</a></div></div>
<div class="ttc" id="structaco__option_html"><div class="ttname"><a href="../../db/de0/structaco__option.html">aco_option</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dc8/config__options_8c_source.html#l00062">config_options.c:62</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="res__pjsip__presence__xml_8h_html"><div class="ttname"><a href="../../d5/dc3/res__pjsip__presence__xml_8h.html">res_pjsip_presence_xml.h</a></div></div>
<div class="ttc" id="taskprocessor_8h_html"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html">taskprocessor.h</a></div><div class="ttdoc">An API for managing task processing threads that can be shared across modules. </div></div>
<div class="ttc" id="structstate_html"><div class="ttname"><a href="../../d4/d88/structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l00158">localtime.c:158</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a5cc1e17b0488075e8ea7d40085d502e1"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a5cc1e17b0488075e8ea7d40085d502e1">ast_sip_pubsub_register_body_supplement</a></div><div class="ttdeci">int ast_sip_pubsub_register_body_supplement(struct ast_sip_pubsub_body_supplement *supplement)</div><div class="ttdoc">Register a body generator with the pubsub core. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03485">res_pjsip_pubsub.c:3485</a></div></div>
<div class="ttc" id="sched_8h_html_a7a43dcf8be6b2ed7f96f3867fbcb4082"><div class="ttname"><a href="../../d7/d00/sched_8h.html#a7a43dcf8be6b2ed7f96f3867fbcb4082">ast_sched_add</a></div><div class="ttdeci">int ast_sched_add(struct ast_sched_context *con, int when, ast_sched_cb callback, const void *data) attribute_warn_unused_result</div><div class="ttdoc">Adds a scheduled event. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/sched_8c_source.html#l00565">sched.c:565</a></div></div>
<div class="ttc" id="structheader_html"><div class="ttname"><a href="../../d5/d65/structheader.html">header</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d73/pjsip__global__headers_8c_source.html#l00047">pjsip_global_headers.c:47</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_ac23e23ba60f358de78a893d537c0afa4"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#ac23e23ba60f358de78a893d537c0afa4">sip_subscription_tree::serializer</a></div><div class="ttdeci">struct ast_taskprocessor * serializer</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00435">res_pjsip_pubsub.c:435</a></div></div>
<div class="ttc" id="structast__flags_html"><div class="ttname"><a href="../../dc/dac/structast__flags.html">ast_flags</a></div><div class="ttdoc">Structure used to handle boolean flags. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00199">utils.h:199</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga568aa1aff837fc0001279490a6d9b22f"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga568aa1aff837fc0001279490a6d9b22f">ast_manager_get_topic</a></div><div class="ttdeci">struct stasis_topic * ast_manager_get_topic(void)</div><div class="ttdoc">Get the Stasis Message Bus API topic for AMI. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01720">manager.c:1720</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a5b63b1eceb879f2cf0e23f356040737a"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a5b63b1eceb879f2cf0e23f356040737a">ast_sip_create_ami_event</a></div><div class="ttdeci">struct ast_str * ast_sip_create_ami_event(const char *event, struct ast_sip_ami *ami)</div><div class="ttdoc">Creates a string to store AMI event data in. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/pjsip__configuration_8c_source.html#l01584">pjsip_configuration.c:1584</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a9b75abdc267ce4a677b7eaa67ead3c20ab72ff83a6adb7eae0bf918c8e3f5cf49"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20ab72ff83a6adb7eae0bf918c8e3f5cf49">AST_SIP_NOTIFIER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00194">res_pjsip_pubsub.h:194</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_ade5a89f9bee15a492c760ec1765a292d"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a></div><div class="ttdeci">static char cid_name[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00165">chan_mgcp.c:165</a></div></div>
<div class="ttc" id="res__phoneprov_8c_html_addaa208b0ed785225e24490fb9f28a80"><div class="ttname"><a href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a></div><div class="ttdeci">AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_GLOBAL_SYMBOLS|AST_MODFLAG_LOAD_ORDER, &quot;HTTP Phone Provisioning&quot;,.support_level=AST_MODULE_SUPPORT_EXTENDED,.load=load_module,.unload=unload_module,.reload=reload,.load_pri=AST_MODPRI_CHANNEL_DEPEND,.requires=&quot;http&quot;,)</div></div>
<div class="ttc" id="structtest_html"><div class="ttname"><a href="../../d8/d89/structtest.html">test</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d7d/test__logger_8c_source.html#l00043">test_logger.c:43</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a5b0f67be0ca6ad54e4eba8d4aa029faf"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a5b0f67be0ca6ad54e4eba8d4aa029faf">ast_sip_subscription_notify</a></div><div class="ttdeci">int ast_sip_subscription_notify(struct ast_sip_subscription *sub, struct ast_sip_body_data *notify_data, int terminate)</div><div class="ttdoc">Notify a SIP subscription of a state change. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02529">res_pjsip_pubsub.c:2529</a></div></div>
<div class="ttc" id="structast__cli__entry_html_aef1bd6ad890a110b466cb0e8088507a2"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">ast_cli_entry::usage</a></div><div class="ttdeci">const char * usage</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00177">cli.h:177</a></div></div>
<div class="ttc" id="sorcery_8h_html_aaa9cd237841a70862001f580b23212c9"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a></div><div class="ttdeci">void * ast_sorcery_retrieve_by_fields(const struct ast_sorcery *sorcery, const char *type, unsigned int flags, struct ast_variable *fields)</div><div class="ttdoc">Retrieve an object or multiple objects using specific fields. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01897">sorcery.c:1897</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_abb174e25bbf05213be145675e5e2c37f"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#abb174e25bbf05213be145675e5e2c37f">item_in_vector</a></div><div class="ttdeci">static int item_in_vector(const struct resource_list *list, const char *item)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04781">res_pjsip_pubsub.c:4781</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a3c257396060f400b0fba424730e7576e"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a3c257396060f400b0fba424730e7576e">ast_sip_subscription_remove_datastore</a></div><div class="ttdeci">void ast_sip_subscription_remove_datastore(struct ast_sip_subscription *subscription, const char *name)</div><div class="ttdoc">Remove a subscription datastore from the subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02639">res_pjsip_pubsub.c:2639</a></div></div>
<div class="ttc" id="sorcery_8h_html_aa7102b6e71e4fa6525b24a6123a2f6d4"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a></div><div class="ttdeci">#define ast_sorcery_object_field_register(sorcery, type, name, default_val, opt_type, flags,...)</div><div class="ttdoc">Register a field within an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00955">sorcery.h:955</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a785afb501e315c8a97ad476fb6a8be1d"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a></div><div class="ttdeci">pjsip_endpoint * ast_sip_get_pjsip_endpoint(void)</div><div class="ttdoc">Get a pointer to the PJSIP endpoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03718">res_pjsip.c:3718</a></div></div>
<div class="ttc" id="structast__sip__subscription__handler_html_a35514bc6335d541353cf54c7146e8ce5"><div class="ttname"><a href="../../d8/d6c/structast__sip__subscription__handler.html#a35514bc6335d541353cf54c7146e8ce5">ast_sip_subscription_handler::body_type</a></div><div class="ttdeci">const char * body_type</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00318">res_pjsip_pubsub.h:318</a></div></div>
<div class="ttc" id="cli_8h_html_a50989f00b32eeb2516a3803cb2ffb766"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a></div><div class="ttdeci">#define CLI_SUCCESS</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00044">cli.h:44</a></div></div>
<div class="ttc" id="json_8h_html_a5892d6cd943e00556180fcf15d30788e"><div class="ttname"><a href="../../d4/d05/json_8h.html#a5892d6cd943e00556180fcf15d30788e">ast_json_object_create</a></div><div class="ttdeci">struct ast_json * ast_json_object_create(void)</div><div class="ttdoc">Create a new JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00389">json.c:389</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a9ff7aa27ae5f1a980bcf81f91cd6e470"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a></div><div class="ttdeci">const char * ast_variable_retrieve(struct ast_config *config, const char *category, const char *variable)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d9d/main_2config_8c_source.html#l00694">main/config.c:694</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00153">cli.h:153</a></div></div>
<div class="ttc" id="sched_8h_html_a2a9174d10a79bd233b8498a11201f681"><div class="ttname"><a href="../../d7/d00/sched_8h.html#a2a9174d10a79bd233b8498a11201f681">AST_SCHED_REPLACE_UNREF</a></div><div class="ttdeci">#define AST_SCHED_REPLACE_UNREF(id, sched, when, callback, data, unrefcall, addfailcall, refcall)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d00/sched_8h_source.html#l00150">sched.h:150</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aadda916488b2d151af4426e2f06ad332"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a></div><div class="ttdeci">#define AST_RWLIST_INSERT_TAIL</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00740">linkedlists.h:740</a></div></div>
<div class="ttc" id="structsimple__message__summary_html_a973a78773c52754ab9c429483ff9c84d"><div class="ttname"><a href="../../d0/d4c/structsimple__message__summary.html#a973a78773c52754ab9c429483ff9c84d">simple_message_summary::voice_messages_urgent_old</a></div><div class="ttdeci">int voice_messages_urgent_old</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03581">res_pjsip_pubsub.c:3581</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ad1bd467902006e27be217191f4f6c793"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ad1bd467902006e27be217191f4f6c793">cli_show_subscriptions_inout</a></div><div class="ttdeci">static char * cli_show_subscriptions_inout(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04433">res_pjsip_pubsub.c:4433</a></div></div>
<div class="ttc" id="vector_8h_html_aef32ac52c3e8a530d16eb92cde22cacd"><div class="ttname"><a href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a></div><div class="ttdeci">#define AST_VECTOR_GET(vec, idx)</div><div class="ttdoc">Get an element from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00682">vector.h:682</a></div></div>
<div class="ttc" id="group__main__options_html_gaa5dba371db31dc4ebecdff7c929ff263"><div class="ttname"><a href="../../d6/dd6/group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a></div><div class="ttdeci">struct ast_flags ast_options</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00061">options.c:61</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a386166c75f00c0b4d1878e3a6d666e89af9b5de443ecb1dc5781aff2a03502ca5"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89af9b5de443ecb1dc5781aff2a03502ca5">SIP_SUB_TREE_TERMINATE_IN_PROGRESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00410">res_pjsip_pubsub.c:410</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="structast__taskprocessor_html"><div class="ttname"><a href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a></div><div class="ttdoc">A ast_taskprocessor structure is a singleton by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00069">taskprocessor.c:69</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a006316bcef76ef13dc1cc99560fbaa86"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a006316bcef76ef13dc1cc99560fbaa86">create_subscription_tree</a></div><div class="ttdeci">static struct sip_subscription_tree * create_subscription_tree(const struct ast_sip_subscription_handler *handler, struct ast_sip_endpoint *endpoint, pjsip_rx_data *rdata, const char *resource, struct ast_sip_pubsub_body_generator *generator, struct resource_tree *tree, pj_status_t *dlg_status, struct subscription_persistence *persistence)</div><div class="ttdoc">Create a subscription tree based on a resource tree. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01465">res_pjsip_pubsub.c:1465</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ab8fd4e13f8412f935f22b1df916b55a3"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ab8fd4e13f8412f935f22b1df916b55a3">sip_create_publication</a></div><div class="ttdeci">static struct ast_sip_publication * sip_create_publication(struct ast_sip_endpoint *endpoint, pjsip_rx_data *rdata, const char *resource, const char *event_configuration_name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03145">res_pjsip_pubsub.c:3145</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a42ecd8494df028dc44c95b90848ad311ad4fc06a713557a6d936557a69615d519"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311ad4fc06a713557a6d936557a69615d519">SIP_PUBLISH_MODIFY</a></div><div class="ttdoc">Modify. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00305">res_pjsip_pubsub.c:305</a></div></div>
<div class="ttc" id="res__pjsip__phoneprov__provider_8c_html_a95eb520bdb1abcd2a70b1432d3ecbf4c"><div class="ttname"><a href="../../d1/dbc/res__pjsip__phoneprov__provider_8c.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a></div><div class="ttdeci">static struct ast_sorcery * sorcery</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dbc/res__pjsip__phoneprov__provider_8c_source.html#l00126">res_pjsip_phoneprov_provider.c:126</a></div></div>
<div class="ttc" id="structast__test_html"><div class="ttname"><a href="../../d9/d79/structast__test.html">ast_test</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/db9/test_8c_source.html#l00065">test.c:65</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a5572d52daf1a841b0f9308df901448c8"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a></div><div class="ttdeci">struct ast_sorcery * ast_sip_get_sorcery(void)</div><div class="ttdoc">Get a pointer to the SIP sorcery structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/pjsip__configuration_8c_source.html#l02404">pjsip_configuration.c:2404</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="cli_8h_html"><div class="ttname"><a href="../../dc/db0/cli_8h.html">cli.h</a></div><div class="ttdoc">Standard Command Line Interface. </div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="structast__sip__endpoint__id__configuration_html_a179b9758f096dc75be612d5f4e5f07cc"><div class="ttname"><a href="../../d4/df6/structast__sip__endpoint__id__configuration.html#a179b9758f096dc75be612d5f4e5f07cc">ast_sip_endpoint_id_configuration::self</a></div><div class="ttdeci">struct ast_party_id self</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00629">res_pjsip.h:629</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_a43edc8933583da8bdbbe4b62a6b0e008"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#a43edc8933583da8bdbbe4b62a6b0e008">subscription_persistence::contact_uri</a></div><div class="ttdeci">char contact_uri[PJSIP_MAX_URL_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00394">res_pjsip_pubsub.c:394</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a9b75abdc267ce4a677b7eaa67ead3c20"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a9b75abdc267ce4a677b7eaa67ead3c20">ast_sip_subscription_role</a></div><div class="ttdeci">ast_sip_subscription_role</div><div class="ttdoc">Role for the subscription that is being created. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00190">res_pjsip_pubsub.h:190</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="strings_8h_html_aa64825674476f476402283fe4bd7ee51"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa64825674476f476402283fe4bd7ee51">ast_str_update</a></div><div class="ttdeci">void ast_str_update(struct ast_str *buf)</div><div class="ttdoc">Update the length of the buffer, after using ast_str merely as a buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00663">strings.h:663</a></div></div>
<div class="ttc" id="strings_8h_html_a2faaa16929951bfd2802b7829a100ba2"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a></div><div class="ttdeci">#define S_OR(a, b)</div><div class="ttdoc">returns the equivalent of logic or for strings: first one if not empty, otherwise second one...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00079">strings.h:79</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a32492eb2480cb8c46ad669622cff8556"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a></div><div class="ttdeci">void * ast_taskprocessor_unreference(struct ast_taskprocessor *tps)</div><div class="ttdoc">Unreference the specified taskprocessor and its reference count will decrement. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01109">taskprocessor.c:1109</a></div></div>
<div class="ttc" id="time_8h_html_aebf04439f206cc509472ce4b6da48a5a"><div class="ttname"><a href="../../de/df7/time_8h.html#aebf04439f206cc509472ce4b6da48a5a">ast_tv</a></div><div class="ttdeci">struct timeval ast_tv(ast_time_t sec, ast_suseconds_t usec)</div><div class="ttdoc">Returns a timeval from sec, usec. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00226">time.h:226</a></div></div>
<div class="ttc" id="structinitial__notify__data_html_a3b20a602cda3a7726e79738d006c5518"><div class="ttname"><a href="../../df/dbb/structinitial__notify__data.html#a3b20a602cda3a7726e79738d006c5518">initial_notify_data::sub_tree</a></div><div class="ttdeci">struct sip_subscription_tree * sub_tree</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01535">res_pjsip_pubsub.c:1535</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a703b9f7d4c89444b70c00353c864765c"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a703b9f7d4c89444b70c00353c864765c">AMI_SHOW_SUBSCRIPTIONS_INBOUND</a></div><div class="ttdeci">#define AMI_SHOW_SUBSCRIPTIONS_INBOUND</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04135">res_pjsip_pubsub.c:4135</a></div></div>
<div class="ttc" id="structast__cli__args_html_a4b911d12699acbbb5a8b62355b35bae8"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">ast_cli_args::pos</a></div><div class="ttdeci">const int pos</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00164">cli.h:164</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a34bc405d2cc3c85aa8d449185c3569d6"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a34bc405d2cc3c85aa8d449185c3569d6">publication_cmp_fn</a></div><div class="ttdeci">static int publication_cmp_fn(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02701">res_pjsip_pubsub.c:2701</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a4034b13c08bafa4bff82854bcc0ce135"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a4034b13c08bafa4bff82854bcc0ce135">ast_sip_subscription_get_header</a></div><div class="ttdeci">void * ast_sip_subscription_get_header(const struct ast_sip_subscription *sub, const char *header)</div><div class="ttdoc">Get a header value for a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01854">res_pjsip_pubsub.c:1854</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a15aa09d9084763cdd20b7467a4cd381a"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a15aa09d9084763cdd20b7467a4cd381a">ast_sip_unregister_service</a></div><div class="ttdeci">void ast_sip_unregister_service(pjsip_module *module)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03331">res_pjsip.c:3331</a></div></div>
<div class="ttc" id="test__ari_8c_html_a695cc202c7a2869aa8202bb20726ea3c"><div class="ttname"><a href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a></div><div class="ttdeci">static void handler(const char *name, int response_code, struct ast_variable *get_params, struct ast_variable *path_vars, struct ast_variable *headers, struct ast_json *body, struct ast_ari_response *response)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d03/test__ari_8c_source.html#l00059">test_ari.c:59</a></div></div>
<div class="ttc" id="mwi_8h_html"><div class="ttname"><a href="../../dc/d33/mwi_8h.html">mwi.h</a></div><div class="ttdoc">Asterisk MWI API. </div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aae837565412b034de817b534fa2a7136"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aae837565412b034de817b534fa2a7136">persistence_expires_str2struct</a></div><div class="ttdeci">static int persistence_expires_str2struct(const struct aco_option *opt, struct ast_variable *var, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04738">res_pjsip_pubsub.c:4738</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a219baab2a37a17e4922d696be2e07cca"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a219baab2a37a17e4922d696be2e07cca">find_sub_handler_for_event_name</a></div><div class="ttdeci">static struct ast_sip_subscription_handler * find_sub_handler_for_event_name(const char *event_name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02763">res_pjsip_pubsub.c:2763</a></div></div>
<div class="ttc" id="structcli__sub__complete__parms_html_af86c4ab2ba7f7fd632482bb08625be1a"><div class="ttname"><a href="../../d7/df6/structcli__sub__complete__parms.html#af86c4ab2ba7f7fd632482bb08625be1a">cli_sub_complete_parms::callid</a></div><div class="ttdeci">char * callid</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04155">res_pjsip_pubsub.c:4155</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ab105b4d8cca635ce7aeed34c4543ab54"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ab105b4d8cca635ce7aeed34c4543ab54">ast_sip_sorcery_object_to_ami</a></div><div class="ttdeci">int ast_sip_sorcery_object_to_ami(const void *obj, struct ast_str **buf)</div><div class="ttdoc">Converts a sorcery object to a string of object properties. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/pjsip__configuration_8c_source.html#l01609">pjsip_configuration.c:1609</a></div></div>
<div class="ttc" id="stasis_8h_html_a4f248ee5f4791f05d0af8768aaab282b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a></div><div class="ttdeci">int stasis_subscription_accept_message_type(struct stasis_subscription *subscription, const struct stasis_message_type *type)</div><div class="ttdoc">Indicate to a subscription that we are interested in a message type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01025">stasis.c:1025</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aa70a279b186df17b611eabf8164c396c"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aa70a279b186df17b611eabf8164c396c">allocate_subscription</a></div><div class="ttdeci">static struct ast_sip_subscription * allocate_subscription(const struct ast_sip_subscription_handler *handler, const char *resource, struct sip_subscription_tree *tree)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01233">res_pjsip_pubsub.c:1233</a></div></div>
<div class="ttc" id="res__corosync_8c_html_a8e51289dd0fc7415cee40e7a57b49fdf"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a></div><div class="ttdeci">struct stasis_forward * sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00240">res_corosync.c:240</a></div></div>
<div class="ttc" id="sip_8h_html_a42ecd8494df028dc44c95b90848ad311"><div class="ttname"><a href="../../d1/d94/sip_8h.html#a42ecd8494df028dc44c95b90848ad311">sip_publish_type</a></div><div class="ttdeci">sip_publish_type</div><div class="ttdoc">The types of PUBLISH messages defined in RFC 3903. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d94/sip_8h_source.html#l01562">sip.h:1562</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_abb2474471fcc9b7191d508cf1b407417"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#abb2474471fcc9b7191d508cf1b407417">populate_list</a></div><div class="ttdeci">static int populate_list(struct resource_list *list, const char *event, const char **resources, size_t num_resources)</div><div class="ttdoc">Set properties on an allocated resource list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04942">res_pjsip_pubsub.c:4942</a></div></div>
<div class="ttc" id="stasis_8h_html_a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00300">stasis.h:300</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ac3382bf6da54c56b37069bd76bbdf4f9"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a></div><div class="ttdeci">static int load_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l05560">res_pjsip_pubsub.c:5560</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a26689d72ab3ff9ce0e56c26fdc6dfd4b"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a26689d72ab3ff9ce0e56c26fdc6dfd4b">pubsub_on_client_refresh</a></div><div class="ttdeci">static void pubsub_on_client_refresh(pjsip_evsub *sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03989">res_pjsip_pubsub.c:3989</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ac9f60cf5b4683fabadff63143ef959f2"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ac9f60cf5b4683fabadff63143ef959f2">pubsub_on_rx_notify</a></div><div class="ttdeci">static void pubsub_on_rx_notify(pjsip_evsub *sub, pjsip_rx_data *rdata, int *p_st_code, pj_str_t **p_st_text, pjsip_hdr *res_hdr, pjsip_msg_body **p_body)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03956">res_pjsip_pubsub.c:3956</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ad8a440b205b153f5b7fa6e0be3eb82ef"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ad8a440b205b153f5b7fa6e0be3eb82ef">cli_show_subscription_inout</a></div><div class="ttdeci">static char * cli_show_subscription_inout(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04334">res_pjsip_pubsub.c:4334</a></div></div>
<div class="ttc" id="structast__cli__args_html"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html">ast_cli_args</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00158">cli.h:158</a></div></div>
<div class="ttc" id="structast__sip__publication_html"><div class="ttname"><a href="../../d4/da6/structast__sip__publication.html">ast_sip_publication</a></div><div class="ttdoc">Structure representing a SIP publication. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00345">res_pjsip_pubsub.c:345</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aa43549aaa8be02c39bd1e405f44d27f1"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aa43549aaa8be02c39bd1e405f44d27f1">find_body_generator</a></div><div class="ttdeci">static struct ast_sip_pubsub_body_generator * find_body_generator(char accept[AST_SIP_MAX_ACCEPT][64], size_t num_accept, const char *body_type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02862">res_pjsip_pubsub.c:2862</a></div></div>
<div class="ttc" id="structast__sip__publication_html_ae9dd8f0a26f1e5fdf7e5630d4dffadd3"><div class="ttname"><a href="../../d4/da6/structast__sip__publication.html#ae9dd8f0a26f1e5fdf7e5630d4dffadd3">ast_sip_publication::entity_tag</a></div><div class="ttdeci">int entity_tag</div><div class="ttdoc">Entity tag for the publication. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00349">res_pjsip_pubsub.c:349</a></div></div>
<div class="ttc" id="structbody__part_html_ac56343f0ae7d83d16f23924f1f828149"><div class="ttname"><a href="../../d2/de8/structbody__part.html#ac56343f0ae7d83d16f23924f1f828149">body_part::part</a></div><div class="ttdeci">pjsip_multipart_part * part</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02090">res_pjsip_pubsub.c:2090</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a681ca1bf74a943a8009a5c2ad6894831"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a681ca1bf74a943a8009a5c2ad6894831">ast_sip_create_dialog_uac</a></div><div class="ttdeci">pjsip_dialog * ast_sip_create_dialog_uac(const struct ast_sip_endpoint *endpoint, const char *aor_name, const char *request_user)</div><div class="ttdoc">General purpose method for creating a UAC dialog with an endpoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l04028">res_pjsip.c:4028</a></div></div>
<div class="ttc" id="structcontact_html"><div class="ttname"><a href="../../d9/d03/structcontact.html">contact</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8f/reqresp__parser_8h_source.html#l00035">reqresp_parser.h:35</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a28ad88468ddb5b0d4e26b7406133bd8a"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a28ad88468ddb5b0d4e26b7406133bd8a">resource_list_apply_handler</a></div><div class="ttdeci">static int resource_list_apply_handler(const struct ast_sorcery *sorcery, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04838">res_pjsip_pubsub.c:4838</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a42ecd8494df028dc44c95b90848ad311aeb9d6241943fcb32f34ed3a12548c623"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311aeb9d6241943fcb32f34ed3a12548c623">SIP_PUBLISH_INITIAL</a></div><div class="ttdoc">Initial. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00285">res_pjsip_pubsub.c:285</a></div></div>
<div class="ttc" id="app__queue_8c_html_acd1f0e9b4730ec60f62cb0806cb06ef1"><div class="ttname"><a href="../../da/dfb/app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a></div><div class="ttdeci">enum queue_result id</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dfb/app__queue_8c_source.html#l01507">app_queue.c:1507</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a0a56204d9bae50c4103725ef62aab562ab368f4beb502956f3544f351c116ade6"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a0a56204d9bae50c4103725ef62aab562ab368f4beb502956f3544f351c116ade6">AST_SIP_PUBLISH_STATE_INITIALIZED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00039">res_pjsip_pubsub.h:39</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ad8c5bddecd1c2126c026728ca98750b0"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ad8c5bddecd1c2126c026728ca98750b0">set_state_terminated</a></div><div class="ttdeci">static void set_state_terminated(struct ast_sip_subscription *sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03720">res_pjsip_pubsub.c:3720</a></div></div>
<div class="ttc" id="structast__sip__subscription__handler_html_a2e4aa60e677c95983d44693bd69bc1be"><div class="ttname"><a href="../../d8/d6c/structast__sip__subscription__handler.html#a2e4aa60e677c95983d44693bd69bc1be">ast_sip_subscription_handler::next</a></div><div class="ttdeci">struct ast_sip_subscription_handler * next</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00340">res_pjsip_pubsub.h:340</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a53732c2137fa94234dd28ed05de1a282"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a53732c2137fa94234dd28ed05de1a282">ami_show_subscriptions_outbound</a></div><div class="ttdeci">static int ami_show_subscriptions_outbound(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04076">res_pjsip_pubsub.c:4076</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a7b691f0bc6a8c56d55095fa30cef4e47"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a7b691f0bc6a8c56d55095fa30cef4e47">generate_content_id_hdr</a></div><div class="ttdeci">static pjsip_generic_string_hdr * generate_content_id_hdr(pj_pool_t *pool, const struct ast_sip_subscription *sub)</div><div class="ttdoc">Create a Content-ID header. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02107">res_pjsip_pubsub.c:2107</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a65b342a28c864a472dfff5ea27de8691"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a65b342a28c864a472dfff5ea27de8691">ast_sip_unregister_publish_handler</a></div><div class="ttdeci">void ast_sip_unregister_publish_handler(struct ast_sip_publish_handler *handler)</div><div class="ttdoc">Unregister a publish handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02738">res_pjsip_pubsub.c:2738</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a7d439528eda8c1d3b35a443170e745d0"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a7d439528eda8c1d3b35a443170e745d0">have_visited</a></div><div class="ttdeci">static int have_visited(const char *resource, struct resources *visited)</div><div class="ttdoc">Determine if this resource has been visited already. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00987">res_pjsip_pubsub.c:987</a></div></div>
<div class="ttc" id="structcli__sub__parms_html_a179323e4f813eab2843f39bbe6efd65e"><div class="ttname"><a href="../../dc/d55/structcli__sub__parms.html#a179323e4f813eab2843f39bbe6efd65e">cli_sub_parms::buf</a></div><div class="ttdeci">struct ast_str * buf</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04146">res_pjsip_pubsub.c:4146</a></div></div>
<div class="ttc" id="structast__party__name_html_aaa04218f9e3a9065afa8be2491da8904"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">ast_party_name::valid</a></div><div class="ttdeci">unsigned char valid</div><div class="ttdoc">TRUE if the name information is valid/present. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00280">channel.h:280</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_ac25ea00ee3f082df06e0cf468cbde240"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a></div><div class="ttdeci">static char context[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00116">chan_alsa.c:116</a></div></div>
<div class="ttc" id="structsimple__message__summary_html"><div class="ttname"><a href="../../d0/d4c/structsimple__message__summary.html">simple_message_summary</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03576">res_pjsip_pubsub.c:3576</a></div></div>
<div class="ttc" id="sorcery_8h_html_a4c03ccef909474831717c93679065508"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a4c03ccef909474831717c93679065508">ast_sorcery_generic_alloc</a></div><div class="ttdeci">void * ast_sorcery_generic_alloc(size_t size, ao2_destructor_fn destructor)</div><div class="ttdoc">Allocate a generic sorcery capable object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01728">sorcery.c:1728</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__supplement_html_a2d404fadf2a8afa26742b1cd27bd50cd"><div class="ttname"><a href="../../d7/d72/structast__sip__pubsub__body__supplement.html#a2d404fadf2a8afa26742b1cd27bd50cd">ast_sip_pubsub_body_supplement::supplement_body</a></div><div class="ttdeci">int(* supplement_body)(void *body, void *data)</div><div class="ttdoc">Add additional content to a SIP request body. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00679">res_pjsip_pubsub.h:679</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_abce1c0cc1320bb801480d0929266d08f"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#abce1c0cc1320bb801480d0929266d08f">ast_sip_subscription_get_endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * ast_sip_subscription_get_endpoint(struct ast_sip_subscription *sub)</div><div class="ttdoc">Get the endpoint that is associated with this subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01936">res_pjsip_pubsub.c:1936</a></div></div>
<div class="ttc" id="group__main__options_html_gaf2588453b3a373a770741ad3ce353343ade4cf3231c69af57ad0527bd46244680"><div class="ttname"><a href="../../d6/dd6/group__main__options.html#gaf2588453b3a373a770741ad3ce353343ade4cf3231c69af57ad0527bd46244680">AST_OPT_FLAG_FULLY_BOOTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5b/options_8h_source.html#l00058">options.h:58</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00316">module.h:316</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga78b7691fb1bf1717a7961a68ceed5886"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga78b7691fb1bf1717a7961a68ceed5886">ast_sip_sched_task_get_name</a></div><div class="ttdeci">int ast_sip_sched_task_get_name(struct ast_sip_sched_task *schtd, char *name, size_t maxlen)</div><div class="ttdoc">Gets the task name. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfa/pjsip__scheduler_8c_source.html#l00334">pjsip_scheduler.c:334</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html_a50edbc089f02d537b9a487f1a62c889e"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">ast_sip_endpoint::aors</a></div><div class="ttdeci">const ast_string_field aors</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00821">res_pjsip.h:821</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a42ecd8494df028dc44c95b90848ad311a267332dc912cbca4f3e5ede0fd776ae9"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a42ecd8494df028dc44c95b90848ad311a267332dc912cbca4f3e5ede0fd776ae9">SIP_PUBLISH_REMOVE</a></div><div class="ttdoc">Remove. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00314">res_pjsip_pubsub.c:314</a></div></div>
<div class="ttc" id="manager_8h_html_a5b63b8a8faede2d852e071e1f7b31c11"><div class="ttname"><a href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a></div><div class="ttdeci">#define ast_manager_register_xml(action, authority, func)</div><div class="ttdoc">Register a manager callback using XML documentation to describe the manager. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00186">manager.h:186</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aa801068c5728800b602dc19ecbe1b3cf"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aa801068c5728800b602dc19ecbe1b3cf">generate_list_body</a></div><div class="ttdeci">static pjsip_msg_body * generate_list_body(pj_pool_t *pool, struct ast_sip_subscription *sub, unsigned int force_full_state)</div><div class="ttdoc">Create a resource list body for NOTIFY requests. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02324">res_pjsip_pubsub.c:2324</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a4abffbee599d833b446686d5213d80e4"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a4abffbee599d833b446686d5213d80e4">str_event_name</a></div><div class="ttdeci">static const pj_str_t str_event_name</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00238">res_pjsip_pubsub.c:238</a></div></div>
<div class="ttc" id="module_8h_html_aba2c8d4be709a254658b21a834f8294a"><div class="ttname"><a href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a></div><div class="ttdeci">#define ASTERISK_GPL_KEY</div><div class="ttdoc">The text the key() function should return. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00046">module.h:46</a></div></div>
<div class="ttc" id="structast__sip__notifier_html_ad1e64b1a6297045eb98ac47f56591b0f"><div class="ttname"><a href="../../d1/d5b/structast__sip__notifier.html#ad1e64b1a6297045eb98ac47f56591b0f">ast_sip_notifier::default_accept</a></div><div class="ttdeci">const char * default_accept</div><div class="ttdoc">Default body type defined for the event package this notifier handles. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00255">res_pjsip_pubsub.h:255</a></div></div>
<div class="ttc" id="structast__sip__contact_html_a19ac71226fac09e87afe31acb4c99214"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">ast_sip_contact::uri</a></div><div class="ttdeci">const ast_string_field uri</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00303">res_pjsip.h:303</a></div></div>
<div class="ttc" id="structast__sip__notifier_html"><div class="ttname"><a href="../../d1/d5b/structast__sip__notifier.html">ast_sip_notifier</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00246">res_pjsip_pubsub.h:246</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a36292f9aacdecd44efe47fa591beb400"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a36292f9aacdecd44efe47fa591beb400">sip_persistence_update_type</a></div><div class="ttdeci">sip_persistence_update_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00523">res_pjsip_pubsub.c:523</a></div></div>
<div class="ttc" id="structast__sip__publication__resource_html"><div class="ttname"><a href="../../d2/d91/structast__sip__publication__resource.html">ast_sip_publication_resource</a></div><div class="ttdoc">Structure representing a publication resource. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00509">res_pjsip_pubsub.c:509</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga31a02a7d3cc36aa66ebebdedfc574d1c"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a></div><div class="ttdeci">void astman_send_error(struct mansession *s, const struct message *m, char *error)</div><div class="ttdoc">Send error in manager transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03159">manager.c:3159</a></div></div>
<div class="ttc" id="module_8h_html"><div class="ttname"><a href="../../d5/d16/module_8h.html">module.h</a></div><div class="ttdoc">Asterisk module definitions. </div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ad276d9178ef9aad7e0d9ad2fbd52744d"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ad276d9178ef9aad7e0d9ad2fbd52744d">persistence_generator_data_struct2str</a></div><div class="ttdeci">static int persistence_generator_data_struct2str(const void *obj, const intptr_t *args, char **buf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04718">res_pjsip_pubsub.c:4718</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a89f7ab75ea44a7eb7527943b70a742fc"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a89f7ab75ea44a7eb7527943b70a742fc">cli_show_subscriptions_inbound</a></div><div class="ttdeci">static int cli_show_subscriptions_inbound(struct sip_subscription_tree *sub_tree, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04421">res_pjsip_pubsub.c:4421</a></div></div>
<div class="ttc" id="res__pjsip_8h_html"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html">res_pjsip.h</a></div></div>
<div class="ttc" id="structast__sip__publication__resource_html_ad2ef61c498fc983f10336fd7b5876af7"><div class="ttname"><a href="../../d2/d91/structast__sip__publication__resource.html#ad2ef61c498fc983f10336fd7b5876af7">ast_sip_publication_resource::events</a></div><div class="ttdeci">struct ast_variable * events</div><div class="ttdoc">Mapping for event types to configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00515">res_pjsip_pubsub.c:515</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a23418ae9f5ca7a907263b50b7dcc323d"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a23418ae9f5ca7a907263b50b7dcc323d">cli_subscription_expiry</a></div><div class="ttdeci">static unsigned int cli_subscription_expiry(struct sip_subscription_tree *sub_tree)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04221">res_pjsip_pubsub.c:4221</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_a8fe140462b79206a7c20a771dace07e1"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#a8fe140462b79206a7c20a771dace07e1">sip_subscription_tree::send_scheduled_notify</a></div><div class="ttdeci">unsigned int send_scheduled_notify</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00449">res_pjsip_pubsub.c:449</a></div></div>
<div class="ttc" id="structast__sip__publish__handler_html_aac80748c488a3724f6ab7e1ef4b73530"><div class="ttname"><a href="../../d5/d9f/structast__sip__publish__handler.html#aac80748c488a3724f6ab7e1ef4b73530">ast_sip_publish_handler::publications</a></div><div class="ttdeci">struct ao2_container * publications</div><div class="ttdoc">Publications. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00054">res_pjsip_pubsub.h:54</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_abcc2b6e9a594e068ec58be82446b15fa"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#abcc2b6e9a594e068ec58be82446b15fa">destroy_subscription</a></div><div class="ttdeci">static void destroy_subscription(struct ast_sip_subscription *sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01201">res_pjsip_pubsub.c:1201</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_a22710c9f61c084ea3c72d16b9417ff6f"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#a22710c9f61c084ea3c72d16b9417ff6f">subscription_persistence::src_name</a></div><div class="ttdeci">char src_name[PJ_INET6_ADDRSTRLEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00378">res_pjsip_pubsub.c:378</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a7e419c29ebfb010ca04b7c189c207bbd"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a7e419c29ebfb010ca04b7c189c207bbd">ast_sip_transport_monitor_unregister_all</a></div><div class="ttdeci">void ast_sip_transport_monitor_unregister_all(ast_transport_monitor_shutdown_cb cb, void *data, ast_transport_monitor_data_matcher matches)</div><div class="ttdoc">Unregister a transport shutdown monitor from all reliable transports. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d94/pjsip__transport__events_8c_source.html#l00257">pjsip_transport_events.c:257</a></div></div>
<div class="ttc" id="structast__party__number_html_aaa04218f9e3a9065afa8be2491da8904"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">ast_party_number::valid</a></div><div class="ttdeci">unsigned char valid</div><div class="ttdoc">TRUE if the number information is valid/present. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00298">channel.h:298</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_acd4517938f2afe11a1c6f372e28090a5"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#acd4517938f2afe11a1c6f372e28090a5">PJSIP_EXPIRES_NOT_SPECIFIED</a></div><div class="ttdeci">#define PJSIP_EXPIRES_NOT_SPECIFIED</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00063">res_pjsip.h:63</a></div></div>
<div class="ttc" id="structast__sip__pubsub__body__generator_html_ae9df1ad90af9f1ce1a581f295ef305a5"><div class="ttname"><a href="../../df/dc3/structast__sip__pubsub__body__generator.html#ae9df1ad90af9f1ce1a581f295ef305a5">ast_sip_pubsub_body_generator::generate_body_content</a></div><div class="ttdeci">int(* generate_body_content)(void *body, void *data)</div><div class="ttdoc">Add content to the body of a SIP request. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00629">res_pjsip_pubsub.h:629</a></div></div>
<div class="ttc" id="structast__sip__subscription__handler_html_aafe0a2289a5de4ddc780067899f70eaa"><div class="ttname"><a href="../../d8/d6c/structast__sip__subscription__handler.html#aafe0a2289a5de4ddc780067899f70eaa">ast_sip_subscription_handler::subscription_shutdown</a></div><div class="ttdeci">void(* subscription_shutdown)(struct ast_sip_subscription *subscription)</div><div class="ttdoc">Called when a subscription is to be destroyed. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00328">res_pjsip_pubsub.h:328</a></div></div>
<div class="ttc" id="sched_8h_html_a862f869d056628b38e09042f21b54413"><div class="ttname"><a href="../../d7/d00/sched_8h.html#a862f869d056628b38e09042f21b54413">ast_sched_context_destroy</a></div><div class="ttdeci">void ast_sched_context_destroy(struct ast_sched_context *c)</div><div class="ttdoc">destroys a schedule context </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/sched_8c_source.html#l00269">sched.c:269</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a6bf0e81cb6ef01532ddebaba68f6de28"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a></div><div class="ttdeci">#define AST_RWLIST_TRAVERSE_SAFE_END</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00616">linkedlists.h:616</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a5ad2231cd4e17cd5a713f0c7cea20da4"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a5ad2231cd4e17cd5a713f0c7cea20da4">ast_sip_subscription_get_datastore</a></div><div class="ttdeci">struct ast_datastore * ast_sip_subscription_get_datastore(struct ast_sip_subscription *subscription, const char *name)</div><div class="ttdoc">Retrieve a subscription datastore. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02634">res_pjsip_pubsub.c:2634</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html_ac90516981222dda0270465a33483f2b4"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html#ac90516981222dda0270465a33483f2b4">sip_subscription_tree::notification_batch_interval</a></div><div class="ttdeci">unsigned int notification_batch_interval</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00445">res_pjsip_pubsub.c:445</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a3bb393c5880be9a3a3ddeccfc998452b"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a3bb393c5880be9a3a3ddeccfc998452b">ast_sip_subscription_destroy</a></div><div class="ttdeci">void ast_sip_subscription_destroy(struct ast_sip_subscription *sub)</div><div class="ttdoc">Alert the pubsub core that the subscription is ready for destruction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01389">res_pjsip_pubsub.c:1389</a></div></div>
<div class="ttc" id="vector_8h_html_a20b08af81cc9452fb721c9a698f81bdf"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a></div><div class="ttdeci">#define AST_VECTOR_SIZE(vec)</div><div class="ttdoc">Get the number of elements in a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00611">vector.h:611</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a361b448e9abcfc301602a2573a662d3c"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a361b448e9abcfc301602a2573a662d3c">sched</a></div><div class="ttdeci">static struct ast_sched_context * sched</div><div class="ttdoc">Scheduler used for automatically expiring publications. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00241">res_pjsip_pubsub.c:241</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a386166c75f00c0b4d1878e3a6d666e89a5ffbdb3ef21db1d83c5a508f5e3865ae"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a386166c75f00c0b4d1878e3a6d666e89a5ffbdb3ef21db1d83c5a508f5e3865ae">SIP_SUB_TREE_TERMINATE_PENDING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00408">res_pjsip_pubsub.c:408</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_a7bb5e40c10df6a41df64bda1f4bb3e26"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#a7bb5e40c10df6a41df64bda1f4bb3e26">subscription_persistence::tag</a></div><div class="ttdeci">char * tag</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00390">res_pjsip_pubsub.c:390</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ad9ab4b2e3c02b132f457ec3e61d5d47d"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ad9ab4b2e3c02b132f457ec3e61d5d47d">MOD_DATA_PERSISTENCE</a></div><div class="ttdeci">#define MOD_DATA_PERSISTENCE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00235">res_pjsip_pubsub.c:235</a></div></div>
<div class="ttc" id="sorcery_8h_html_ad98ae6e153f53b0c3c40119acc5e5266"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#ad98ae6e153f53b0c3c40119acc5e5266">ast_sorcery_reload_object</a></div><div class="ttdeci">void ast_sorcery_reload_object(const struct ast_sorcery *sorcery, const char *type)</div><div class="ttdoc">Inform any wizards of a specific object type to reload persistent objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01442">sorcery.c:1442</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a10ec9e1a5bbe250daa4df389a6127b83"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a10ec9e1a5bbe250daa4df389a6127b83">test_notifier</a></div><div class="ttdeci">struct ast_sip_notifier test_notifier</div><div class="ttdoc">Subscription notifier for unit tests. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04920">res_pjsip_pubsub.c:4920</a></div></div>
<div class="ttc" id="structresource__list_html_a4ec2ed8bfc8538671089fc04bb4710bb"><div class="ttname"><a href="../../df/dd0/structresource__list.html#a4ec2ed8bfc8538671089fc04bb4710bb">resource_list::full_state</a></div><div class="ttdeci">unsigned int full_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00332">res_pjsip_pubsub.c:332</a></div></div>
<div class="ttc" id="structsip__subscription__tree_html"><div class="ttname"><a href="../../d0/dd7/structsip__subscription__tree.html">sip_subscription_tree</a></div><div class="ttdoc">A tree of SIP subscriptions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00431">res_pjsip_pubsub.c:431</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ae855491c1f2f6714df5daa3fd69a10df"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ae855491c1f2f6714df5daa3fd69a10df">allocate_subscription_tree</a></div><div class="ttdeci">static struct sip_subscription_tree * allocate_subscription_tree(struct ast_sip_endpoint *endpoint, pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01405">res_pjsip_pubsub.c:1405</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_adae4f7e71c1e215af22111048af6ab93"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#adae4f7e71c1e215af22111048af6ab93">cli_list_subscriptions_inbound</a></div><div class="ttdeci">static int cli_list_subscriptions_inbound(struct sip_subscription_tree *sub_tree, void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04568">res_pjsip_pubsub.c:4568</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ab95c1bf11412f8e2a82ddd0eb69ad4a4"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ab95c1bf11412f8e2a82ddd0eb69ad4a4">MOD_DATA_MSG</a></div><div class="ttdeci">#define MOD_DATA_MSG</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00236">res_pjsip_pubsub.c:236</a></div></div>
<div class="ttc" id="structsubscription__persistence_html_a1805e05b0976bcd4f821f92c0206cba0"><div class="ttname"><a href="../../d9/df9/structsubscription__persistence.html#a1805e05b0976bcd4f821f92c0206cba0">subscription_persistence::generator_data</a></div><div class="ttdeci">struct ast_json * generator_data</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00398">res_pjsip_pubsub.c:398</a></div></div>
<div class="ttc" id="structbody__part_html_a06eab984618d6a85fadc73dfb41f5c69"><div class="ttname"><a href="../../d2/de8/structbody__part.html#a06eab984618d6a85fadc73dfb41f5c69">body_part::state</a></div><div class="ttdeci">pjsip_evsub_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02088">res_pjsip_pubsub.c:2088</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_gga478c7100d82665dc492845e4213ebc40ac5773e910b212c28550aee8a0a42a22a"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#gga478c7100d82665dc492845e4213ebc40ac5773e910b212c28550aee8a0a42a22a">AST_SIP_SCHED_TASK_DATA_AO2</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l01801">res_pjsip.h:1801</a></div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a45317a8f9762fa3b934c723df1367336"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a45317a8f9762fa3b934c723df1367336">serialized_pubsub_on_client_refresh</a></div><div class="ttdeci">static int serialized_pubsub_on_client_refresh(void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03969">res_pjsip_pubsub.c:3969</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aa94f5c5d378799e218956c0804cbfb1e"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aa94f5c5d378799e218956c0804cbfb1e">ast_sip_pubsub_has_eventlist_support</a></div><div class="ttdeci">static int ast_sip_pubsub_has_eventlist_support(pjsip_rx_data *rdata)</div><div class="ttdoc">Check if the rdata has a Supported header containing &amp;#39;eventlist&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00866">res_pjsip_pubsub.c:866</a></div></div>
<div class="ttc" id="sorcery_8h_html_ab9184a8cdeb14537309e5e020948ecd3"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#ab9184a8cdeb14537309e5e020948ecd3">ast_sorcery_update</a></div><div class="ttdeci">int ast_sorcery_update(const struct ast_sorcery *sorcery, void *object)</div><div class="ttdoc">Update an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02145">sorcery.c:2145</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a1659843ab11cf04649f5a03657943bb8"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a1659843ab11cf04649f5a03657943bb8">cli_complete_subscription_common</a></div><div class="ttdeci">static int cli_complete_subscription_common(struct sip_subscription_tree *sub_tree, struct cli_sub_complete_parms *cli)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04160">res_pjsip_pubsub.c:4160</a></div></div>
<div class="ttc" id="structast__sip__publication_html_a5856afac1fb921f1d6a4eb1fe9412bc8"><div class="ttname"><a href="../../d4/da6/structast__sip__publication.html#a5856afac1fb921f1d6a4eb1fe9412bc8">ast_sip_publication::sched_id</a></div><div class="ttdeci">int sched_id</div><div class="ttdoc">Scheduled item for expiration of publication. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00357">res_pjsip_pubsub.c:357</a></div></div>
<div class="ttc" id="structpersistence__recreate__data_html"><div class="ttname"><a href="../../d4/d4c/structpersistence__recreate__data.html">persistence_recreate_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01543">res_pjsip_pubsub.c:1543</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_acf8d7453ec67a6a31fa80feffc283128"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#acf8d7453ec67a6a31fa80feffc283128">cli_show_subscription_common</a></div><div class="ttdeci">static int cli_show_subscription_common(struct sip_subscription_tree *sub_tree, struct cli_sub_parms *cli)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l04235">res_pjsip_pubsub.c:4235</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_aab8324717cc2207dbde31f177aa7ac0f"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#aab8324717cc2207dbde31f177aa7ac0f">tree_node_destroy</a></div><div class="ttdeci">static void tree_node_destroy(struct tree_node *node)</div><div class="ttdoc">Destructor for a tree node. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00965">res_pjsip_pubsub.c:965</a></div></div>
<div class="ttc" id="strings_8h_html_aec9fdc621b97dd7beac3e4a225d11bb6"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aec9fdc621b97dd7beac3e4a225d11bb6">ast_read_line_from_buffer</a></div><div class="ttdeci">char * ast_read_line_from_buffer(char **buffer)</div><div class="ttdoc">Read lines from a string buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d48/strings_8c_source.html#l00372">strings.c:372</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_ad09fa931f468002152a3cc2d5ce25eae"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a></div><div class="ttdeci">static int unload_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l05682">res_pjsip_pubsub.c:5682</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga0ee6ee1f4d200f711e2983bffe770a72"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a></div><div class="ttdeci">void astman_send_listack(struct mansession *s, const struct message *m, char *msg, char *listflag)</div><div class="ttdoc">Send ack in manager transaction to begin a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03201">manager.c:3201</a></div></div>
<div class="ttc" id="structresource__list_html_ac90516981222dda0270465a33483f2b4"><div class="ttname"><a href="../../df/dd0/structresource__list.html#ac90516981222dda0270465a33483f2b4">resource_list::notification_batch_interval</a></div><div class="ttdeci">unsigned int notification_batch_interval</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00334">res_pjsip_pubsub.c:334</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a13dd15487fee89a002d17ef3aff62d02"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a></div><div class="ttdeci">static struct test_val a</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00046">test_linkedlists.c:46</a></div></div>
<div class="ttc" id="structast__party__id_html_aca2d7de6c89f201dc8bd0a2642d2a352"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">ast_party_id::number</a></div><div class="ttdeci">struct ast_party_number number</div><div class="ttdoc">Subscriber phone number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00343">channel.h:343</a></div></div>
<div class="ttc" id="module_8h_html_a8dea6491bedba471fc44574d76438577"><div class="ttname"><a href="../../d5/d16/module_8h.html#a8dea6491bedba471fc44574d76438577">ast_module_ref</a></div><div class="ttdeci">#define ast_module_ref(mod)</div><div class="ttdoc">Hold a reference to the module. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00443">module.h:443</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a47e7031430a4ba4c21aac39b482ffd82"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a47e7031430a4ba4c21aac39b482ffd82">esc_etag_counter</a></div><div class="ttdeci">static int esc_etag_counter</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00340">res_pjsip_pubsub.c:340</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a64671fa6b889a9d62d646f3ab90cc775"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a64671fa6b889a9d62d646f3ab90cc775">resource_endpoint_handler</a></div><div class="ttdeci">static int resource_endpoint_handler(const struct aco_option *opt, struct ast_variable *var, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l05526">res_pjsip_pubsub.c:5526</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00203">test.h:203</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8c_html_a90eeb90b815577ed6bee36f8278a6e73"><div class="ttname"><a href="../../d8/dca/res__pjsip__pubsub_8c.html#a90eeb90b815577ed6bee36f8278a6e73">free_body_parts</a></div><div class="ttdeci">static void free_body_parts(struct body_part_list *parts)</div><div class="ttdoc">Destroy a list of body parts. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02215">res_pjsip_pubsub.c:2215</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:05 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
