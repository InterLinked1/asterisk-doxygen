<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_pjsip_mwi.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">res_pjsip_mwi.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d8/d25/res__pjsip__mwi_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2013, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Mark Michelson &lt;mmichelson@digium.com&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">   &lt;depend&gt;pjproject&lt;/depend&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">   &lt;depend&gt;res_pjsip&lt;/depend&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">   &lt;depend&gt;res_pjsip_pubsub&lt;/depend&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">   &lt;support_level&gt;core&lt;/support_level&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;pjsip.h&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;pjsip_simple.h&gt;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;pjlib.h&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8c/res__pjsip_8h.html">asterisk/res_pjsip.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html">asterisk/res_pjsip_pubsub.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d4c/res__pjsip__body__generator__types_8h.html">asterisk/res_pjsip_body_generator_types.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/module_8h.html">asterisk/module.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/logger_8h.html">asterisk/logger.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/da5/astobj2_8h.html">asterisk/astobj2.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d1e/taskprocessor_8h.html">asterisk/taskprocessor.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d5f/serializer_8h.html">asterisk/serializer.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d25/sorcery_8h.html">asterisk/sorcery.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d79/stasis_8h.html">asterisk/stasis.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d33/mwi_8h.html">asterisk/mwi.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad744191b69a79ad9d0264b6605e589c7">AO2_GLOBAL_OBJ_STATIC</a>(mwi_unsolicited);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad744191b69a79ad9d0264b6605e589c7">AO2_GLOBAL_OBJ_STATIC</a>(mwi_solicited);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a806827c417e6b7d0470f0fe335257f39">   49</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a806827c417e6b7d0470f0fe335257f39">default_voicemail_extension</a>;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#acbc2036fde96cf715b5fdd3ab54da666">   51</a></span>&#160;<span class="preprocessor">#define STASIS_BUCKETS 13</span></div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ad79eb292f11982dae39f08414819eafd">   52</a></span>&#160;<span class="preprocessor">#define MWI_BUCKETS 53</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ae4ddcfea92f9b095478dc0bc9a0cd117">   54</a></span>&#160;<span class="preprocessor">#define MWI_TYPE &quot;application&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#aef6c9303305664514600d87be223660b">   55</a></span>&#160;<span class="preprocessor">#define MWI_SUBTYPE &quot;simple-message-summary&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ada97d04fc8187c3dbf625dfa8567db41">   57</a></span>&#160;<span class="preprocessor">#define MWI_DATASTORE &quot;MWI datastore&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">/*! Number of serializers in pool if one not supplied. */</span></div><div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#aefa0b2df79ef1f606d5b00cd72632834">   60</a></span>&#160;<span class="preprocessor">#define MWI_SERIALIZER_POOL_SIZE 8</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">/*! Max timeout for all threads to join during an unload. */</span></div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a536155006f9be75496538efe377145e6">   63</a></span>&#160;<span class="preprocessor">#define MAX_UNLOAD_TIMEOUT_TIME 10 </span><span class="comment">/* Seconds */</span><span class="preprocessor"></span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">/*! Pool of serializers to use if not supplied. */</span></div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a7ce3dfdf12cb89ecedcc301dc6b994cc">   66</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d08/structast__serializer__pool.html">ast_serializer_pool</a> *<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a7ce3dfdf12cb89ecedcc301dc6b994cc">mwi_serializer_pool</a>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a66f4e76926c44414b78e582db97872e7">mwi_subscription_shutdown</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0dc2ec71240257862dd8cd88aab7354b">mwi_to_ami</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a053bbd417bcb3a65e5ae312062e3eafd">mwi_new_subscribe</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint,</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *resource);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a7638502d402f3253031f7975f21c86d8">mwi_subscription_established</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a905a945079446eca1922dd17536896f3">mwi_get_notify_data</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a923853f5d9fcfbd903dd816327b55451">   75</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d1/d5b/structast__sip__notifier.html">ast_sip_notifier</a> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a923853f5d9fcfbd903dd816327b55451">mwi_notifier</a> = {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   .<a class="code" href="../../d1/d5b/structast__sip__notifier.html#ad1e64b1a6297045eb98ac47f56591b0f">default_accept</a> = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ae4ddcfea92f9b095478dc0bc9a0cd117">MWI_TYPE</a><span class="stringliteral">&quot;/&quot;</span><a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aef6c9303305664514600d87be223660b">MWI_SUBTYPE</a>,</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;   .new_subscribe = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a053bbd417bcb3a65e5ae312062e3eafd">mwi_new_subscribe</a>,</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;   .subscription_established = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a7638502d402f3253031f7975f21c86d8">mwi_subscription_established</a>,</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;   .get_notify_data = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a905a945079446eca1922dd17536896f3">mwi_get_notify_data</a>,</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;};</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#afbd635e5398d075384fb7aae37d869e3">   82</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#afbd635e5398d075384fb7aae37d869e3">mwi_handler</a> = {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;   .<a class="code" href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">event_name</a> = <span class="stringliteral">&quot;message-summary&quot;</span>,</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;   .body_type = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9632d729a323355beec62acda995cc21">AST_SIP_MESSAGE_ACCUMULATOR</a>,</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;   .accept = { <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ae4ddcfea92f9b095478dc0bc9a0cd117">MWI_TYPE</a><span class="stringliteral">&quot;/&quot;</span><a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aef6c9303305664514600d87be223660b">MWI_SUBTYPE</a>, },</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;   .subscription_shutdown = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a66f4e76926c44414b78e582db97872e7">mwi_subscription_shutdown</a>,</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;   .to_ami = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0dc2ec71240257862dd8cd88aab7354b">mwi_to_ami</a>,</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;   .notifier = &amp;<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a923853f5d9fcfbd903dd816327b55451">mwi_notifier</a>,</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;};</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"> * \brief Wrapper for stasis subscription</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"> * An MWI subscription has a container of these. This</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> * represents a stasis subscription for MWI state.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="../../d3/d16/structmwi__stasis__subscription.html">   97</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> {<span class="comment"></span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">   /*! The MWI stasis subscription */</span></div><div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="../../d3/d16/structmwi__stasis__subscription.html#a729610ef7a35f78eae4cf4ed1c1552c7">   99</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a729610ef7a35f78eae4cf4ed1c1552c7">mwi_subscriber</a>;<span class="comment"></span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">   /*! The mailbox corresponding with the MWI subscription. Used as a hash key */</span></div><div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">  101</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>[1];</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;};</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"> * \brief A subscription for MWI</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"> * This subscription is the basis for MWI for an endpoint. Each</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> * endpoint that uses MWI will have a corresponding mwi_subscription.</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> * This structure acts as the owner for the underlying SIP subscription.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"> * When the mwi_subscription is destroyed, the SIP subscription dies, too.</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"> * The mwi_subscription&#39;s lifetime is governed by its underlying stasis</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"> * subscriptions. When all stasis subscriptions are destroyed, the</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"> * mwi_subscription is destroyed as well.</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="../../dc/d8a/structmwi__subscription.html">  116</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> {<span class="comment"></span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">   /*! Container of \ref mwi_stasis_subscription structures.</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">    * A single MWI subscription may be for multiple mailboxes, thus</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">    * requiring multiple stasis subscriptions</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">  121</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>;<span class="comment"></span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">   /*! The SIP subscription. Unsolicited MWI does not use this */</span></div><div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">  123</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>;<span class="comment"></span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">   /*! AORs we should react to for unsolicited MWI NOTIFY */</span></div><div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="../../dc/d8a/structmwi__subscription.html#aee9980d9bea7526cafef97a0672b00cd">  125</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d8a/structmwi__subscription.html#aee9980d9bea7526cafef97a0672b00cd">aors</a>;<span class="comment"></span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">   /*! Is the MWI solicited (i.e. Initiated with an external SUBSCRIBE) ? */</span></div><div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="../../dc/d8a/structmwi__subscription.html#ac862c692b98c7abdb1fb8609c40b950c">  127</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d8a/structmwi__subscription.html#ac862c692b98c7abdb1fb8609c40b950c">is_solicited</a>;<span class="comment"></span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">   /*! True if this subscription is to be terminated */</span></div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="../../dc/d8a/structmwi__subscription.html#a54c4d5964f197213bff36430ba6b18dc">  129</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d8a/structmwi__subscription.html#a54c4d5964f197213bff36430ba6b18dc">terminate</a>;<span class="comment"></span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">   /*! Identifier for the subscription.</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">    * The identifier is the same as the corresponding endpoint&#39;s stasis ID.</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">    * Used as a hash key</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">  134</a></span>&#160;   <span class="keywordtype">char</span> <span class="keywordtype">id</span>[1];</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;};</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac1cdb85fe882c3a0b4605746358219b6">mwi_stasis_cb</a>(<span class="keywordtype">void</span> *userdata, <span class="keyword">struct</span> <a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>,</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ac3452fce158d1f1362470481c54aae5a">  140</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac3452fce158d1f1362470481c54aae5a">mwi_stasis_subscription_alloc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>, <span class="keyword">struct</span> <a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;{</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *mwi_stasis_sub;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;   <span class="keywordflow">if</span> (!mwi_sub) {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;   }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   mwi_stasis_sub = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*mwi_stasis_sub) + strlen(mailbox), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;   <span class="keywordflow">if</span> (!mwi_stasis_sub) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;   }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   <span class="comment">/* Safe strcpy */</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;   strcpy(mwi_stasis_sub-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>, mailbox);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_sub, +1);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;   mwi_stasis_sub-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a729610ef7a35f78eae4cf4ed1c1552c7">mwi_subscriber</a> = <a class="code" href="../../dc/d33/mwi_8h.html#ad83d6c9c09755c8b274a8f07fb2c64f7">ast_mwi_subscribe_pool</a>(mailbox, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac1cdb85fe882c3a0b4605746358219b6">mwi_stasis_cb</a>, mwi_sub);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;   <span class="keywordflow">if</span> (!mwi_stasis_sub-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a729610ef7a35f78eae4cf4ed1c1552c7">mwi_subscriber</a>) {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="comment">/* Failed to subscribe. */</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_stasis_sub, -1);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_sub, -1);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <a class="code" href="../../dc/d33/mwi_8h.html#a4209f1d79f28e693bddcc0b918425c91">ast_mwi_subscriber_subscription</a>(mwi_stasis_sub-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a729610ef7a35f78eae4cf4ed1c1552c7">mwi_subscriber</a>),</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gafae630f05995b59b49dc523a5b9ce757">stasis_subscription_change_type</a>());</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;   <span class="keywordflow">return</span> mwi_stasis_sub;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a232abb963bc086f5a0f60764c745b2bb">  172</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a232abb963bc086f5a0f60764c745b2bb">stasis_sub_hash</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;{</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *object;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *key;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      key = obj;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordtype">object</span> = obj;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      key = <span class="keywordtype">object</span>-&gt;mailbox;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#a33ab7fa091d5513d8507d3bd33ef5b55">ast_str_hash</a>(key);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ac8f5c2b8af48e5a0c90c4e89597bfb76">  192</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac8f5c2b8af48e5a0c90c4e89597bfb76">stasis_sub_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;{</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *sub_left = obj;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *sub_right = arg;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *right_key = arg;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   <span class="keywordtype">int</span> cmp;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      right_key = sub_right-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="comment">/* Fall through */</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      cmp = strcmp(sub_left-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>, right_key);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20">OBJ_SEARCH_PARTIAL_KEY</a>:</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      cmp = strncmp(sub_left-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>, right_key, strlen(right_key));</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      cmp = 0;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;   }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   <span class="keywordflow">if</span> (cmp) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;}</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a085df8e51809d774882fb8b22c53c5e2">  219</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a085df8e51809d774882fb8b22c53c5e2">mwi_subscription_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;{</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a> = obj;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Destroying MWI subscription for endpoint %s\n&quot;</span>, sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#ac862c692b98c7abdb1fb8609c40b950c">is_solicited</a>) {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a3bb393c5880be9a3a3ddeccfc998452b">ast_sip_subscription_destroy</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;   }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#aee9980d9bea7526cafef97a0672b00cd">aors</a>);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a80204d074b73e3cc135868e141dabc61">  231</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a80204d074b73e3cc135868e141dabc61">mwi_subscription_alloc</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d8a/structmwi__subscription.html#ac862c692b98c7abdb1fb8609c40b950c">is_solicited</a>, <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>)</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;{</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *endpoint_id = <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   sub = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*sub) + strlen(endpoint_id),</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;         <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a085df8e51809d774882fb8b22c53c5e2">mwi_subscription_destructor</a>);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;   <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   <span class="comment">/* Safe strcpy */</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   strcpy(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>, endpoint_id);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   <span class="comment">/* Unsolicited MWI doesn&#39;t actually result in a SIP subscription being</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">    * created. This is because a SIP subscription associates with a dialog.</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">    * Most devices expect unsolicited MWI NOTIFYs to appear out of dialog. If</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">    * they receive an in-dialog MWI NOTIFY (i.e. with a to-tag), then they</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">    * will reject the NOTIFY with a 481, thus resulting in message-waiting</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">    * state not being updated on the device</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;   <span class="keywordflow">if</span> (is_solicited) {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a> = <a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;   sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#acbc2036fde96cf715b5fdd3ab54da666">STASIS_BUCKETS</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a232abb963bc086f5a0f60764c745b2bb">stasis_sub_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac8f5c2b8af48e5a0c90c4e89597bfb76">stasis_sub_cmp</a>);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;   <span class="keywordflow">if</span> (!sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>) {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#ac862c692b98c7abdb1fb8609c40b950c">is_solicited</a> = <a class="code" href="../../dc/d8a/structmwi__subscription.html#ac862c692b98c7abdb1fb8609c40b950c">is_solicited</a>;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   <span class="keywordflow">if</span> (!is_solicited &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">aors</a>)) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#aee9980d9bea7526cafef97a0672b00cd">aors</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">aors</a>);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordflow">if</span> (!sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#aee9980d9bea7526cafef97a0672b00cd">aors</a>) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub, -1);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;   }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Created %s MWI subscription for endpoint %s\n&quot;</span>, is_solicited ? <span class="stringliteral">&quot;solicited&quot;</span> : <span class="stringliteral">&quot;unsolicited&quot;</span>, sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ad846b31c16befff15082f1dce1b8adad">  279</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad846b31c16befff15082f1dce1b8adad">mwi_sub_hash</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;{</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *object;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *key;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      key = obj;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordtype">object</span> = obj;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      key = <span class="keywordtype">object</span>-&gt;id;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;   }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#a33ab7fa091d5513d8507d3bd33ef5b55">ast_str_hash</a>(key);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#aa6f680355ec58a78ef7a441c5c9ada2c">  299</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aa6f680355ec58a78ef7a441c5c9ada2c">mwi_sub_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;{</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *sub_left = obj;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *sub_right = arg;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *right_key = arg;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   <span class="keywordtype">int</span> cmp;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      right_key = sub_right-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="comment">/* Fall through */</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      cmp = strcmp(sub_left-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>, right_key);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20">OBJ_SEARCH_PARTIAL_KEY</a>:</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      cmp = strncmp(sub_left-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>, right_key, strlen(right_key));</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      cmp = 0;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;   }</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;   <span class="keywordflow">if</span> (cmp) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   }</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;}</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a59a4d26dfca856c70a1e9487e073aa13">  326</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a59a4d26dfca856c70a1e9487e073aa13">get_message_count</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;{</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *mwi_stasis = obj;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html">ast_sip_message_accumulator</a> *counter = arg;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *mwi_state;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   mwi_state = <a class="code" href="../../dc/d33/mwi_8h.html#ae56e2e8831cc3919b5d92bad99786572">ast_mwi_subscriber_data</a>(mwi_stasis-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a729610ef7a35f78eae4cf4ed1c1552c7">mwi_subscriber</a>);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;   <span class="keywordflow">if</span> (!mwi_state) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;   counter-&gt;<a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html#a4369ae7c984aba22ce6d0e92718f2b29">old_msgs</a> += mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga4369ae7c984aba22ce6d0e92718f2b29">old_msgs</a>;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   counter-&gt;<a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html#a70de9f16a229e2c5bf1a973372949d3e">new_msgs</a> += mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga70de9f16a229e2c5bf1a973372949d3e">new_msgs</a>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_state, -1);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a3881b0a18f4862d307926519783a3471">  345</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a3881b0a18f4862d307926519783a3471">set_voicemail_extension</a>(pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, pjsip_sip_uri *local_uri,</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html">ast_sip_message_accumulator</a> *counter, <span class="keyword">const</span> <span class="keywordtype">char</span> *voicemail_extension)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;{</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   pjsip_sip_uri *account_uri;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *vm_exten;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(voicemail_extension)) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      vm_exten = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a806827c417e6b7d0470f0fe335257f39">default_voicemail_extension</a>;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      vm_exten = voicemail_extension;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;   }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vm_exten)) {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      account_uri = pjsip_uri_clone(pool, local_uri);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      pj_strdup2(pool, &amp;account_uri-&gt;user, vm_exten);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      pjsip_uri_print(PJSIP_URI_IN_CONTACT_HDR, account_uri, counter-&gt;<a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html#abc5ed3ee3c85dccc50605477083d2e55">message_account</a>, <span class="keyword">sizeof</span>(counter-&gt;<a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html#abc5ed3ee3c85dccc50605477083d2e55">message_account</a>));</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;   }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;}</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno"><a class="line" href="../../dd/da0/structunsolicited__mwi__data.html">  364</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../dd/da0/structunsolicited__mwi__data.html">unsolicited_mwi_data</a> {</div><div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="../../dd/da0/structunsolicited__mwi__data.html#a45123f0785d20e2f8a0e0da9156bce29">  365</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a45123f0785d20e2f8a0e0da9156bce29">sub</a>;</div><div class="line"><a name="l00366"></a><span class="lineno"><a class="line" href="../../dd/da0/structunsolicited__mwi__data.html#a3960205b2a4e7e012dc9f0eae1855f01">  366</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *<a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>;</div><div class="line"><a name="l00367"></a><span class="lineno"><a class="line" href="../../dd/da0/structunsolicited__mwi__data.html#a06eab984618d6a85fadc73dfb41f5c69">  367</a></span>&#160;   pjsip_evsub_state <a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a06eab984618d6a85fadc73dfb41f5c69">state</a>;</div><div class="line"><a name="l00368"></a><span class="lineno"><a class="line" href="../../dd/da0/structunsolicited__mwi__data.html#a40d55a4fd17d00c3dfa95e0b1d771da8">  368</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html">ast_sip_message_accumulator</a> *<a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a40d55a4fd17d00c3dfa95e0b1d771da8">counter</a>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;};</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a53cdb34a33e982a9c71dc95c3df60e21">  371</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a53cdb34a33e982a9c71dc95c3df60e21">send_unsolicited_mwi_notify_to_contact</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;{</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da0/structunsolicited__mwi__data.html">unsolicited_mwi_data</a> *mwi_data = arg;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a> = mwi_data-&gt;<a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a45123f0785d20e2f8a0e0da9156bce29">sub</a>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint = mwi_data-&gt;<a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;   pjsip_evsub_state <a class="code" href="../../d4/d88/structstate.html">state</a> = mwi_data-&gt;<a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a06eab984618d6a85fadc73dfb41f5c69">state</a>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a> = obj;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *state_name;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;   pjsip_tx_data *tdata;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   pjsip_sub_state_hdr *sub_state;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   pjsip_event_hdr *<a class="code" href="../../df/d7d/structevent.html">event</a>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;   pjsip_from_hdr *from;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   pjsip_sip_uri *from_uri;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   <span class="keyword">const</span> pjsip_hdr *allow_events = pjsip_evsub_get_allow_events_hdr(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d80/structast__sip__body.html">ast_sip_body</a> body;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *body_text;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/de8/structast__sip__body__data.html">ast_sip_body_data</a> body_data = {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      .<a class="code" href="../../d1/de8/structast__sip__body__data.html#a35514bc6335d541353cf54c7146e8ce5">body_type</a> = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9632d729a323355beec62acda995cc21">AST_SIP_MESSAGE_ACCUMULATOR</a>,</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      .body_data = mwi_data-&gt;<a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a40d55a4fd17d00c3dfa95e0b1d771da8">counter</a>,</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   };</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#ac981149e3fb0f7fc8b6e75607b1b2ad0">ast_sip_create_request</a>(<span class="stringliteral">&quot;NOTIFY&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, endpoint, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, contact, &amp;tdata)) {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create unsolicited NOTIFY request to endpoint %s URI %s\n&quot;</span>, sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>, contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">uri</a>);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;   body.<a class="code" href="../../d5/d80/structast__sip__body.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a> = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ae4ddcfea92f9b095478dc0bc9a0cd117">MWI_TYPE</a>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;   body.<a class="code" href="../../d5/d80/structast__sip__body.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a> = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aef6c9303305664514600d87be223660b">MWI_SUBTYPE</a>;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   body_text = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(64);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;   <span class="keywordflow">if</span> (!body_text) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      pjsip_tx_data_dec_ref(tdata);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;   from = PJSIP_MSG_FROM_HDR(tdata-&gt;msg);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;   from_uri = pjsip_uri_get_uri(from-&gt;uri);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">subscription</a>.<a class="code" href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">mwi</a>.<a class="code" href="../../d9/dbd/structast__sip__mwi__configuration.html#ac73c8898b4e904caa12dd1adcab40126">fromuser</a>)) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      pj_strdup2(tdata-&gt;pool, &amp;from_uri-&gt;user, endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">subscription</a>.<a class="code" href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">mwi</a>.<a class="code" href="../../d9/dbd/structast__sip__mwi__configuration.html#ac73c8898b4e904caa12dd1adcab40126">fromuser</a>);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;   <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a3881b0a18f4862d307926519783a3471">set_voicemail_extension</a>(tdata-&gt;pool, from_uri, mwi_data-&gt;<a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a40d55a4fd17d00c3dfa95e0b1d771da8">counter</a>, endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">subscription</a>.<a class="code" href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">mwi</a>.<a class="code" href="../../d9/dbd/structast__sip__mwi__configuration.html#a308749bdeaa0c310b2e8ff666748b5d0">voicemail_extension</a>);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a41512cbe01e475968618fcb5631bb1b0">ast_sip_pubsub_generate_body_content</a>(body.<a class="code" href="../../d5/d80/structast__sip__body.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a>, body.<a class="code" href="../../d5/d80/structast__sip__body.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>, &amp;body_data, &amp;body_text)) {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to generate SIP MWI NOTIFY body.\n&quot;</span>);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(body_text);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      pjsip_tx_data_dec_ref(tdata);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;   body.<a class="code" href="../../d5/d80/structast__sip__body.html#a88687b0dd98d5307f1219432b73b8412">body_text</a> = <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(body_text);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   <span class="keywordflow">switch</span> (state) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   <span class="keywordflow">case</span> PJSIP_EVSUB_STATE_ACTIVE:</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      state_name = <span class="stringliteral">&quot;active&quot;</span>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;   <span class="keywordflow">case</span> PJSIP_EVSUB_STATE_TERMINATED:</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      state_name = <span class="stringliteral">&quot;terminated&quot;</span>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;   }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   sub_state = pjsip_sub_state_hdr_create(tdata-&gt;pool);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;   pj_cstr(&amp;sub_state-&gt;sub_state, state_name);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   pjsip_msg_add_hdr(tdata-&gt;msg, (pjsip_hdr *) sub_state);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;   <span class="keyword">event</span> = pjsip_event_hdr_create(tdata-&gt;pool);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   pj_cstr(&amp;event-&gt;event_type, <span class="stringliteral">&quot;message-summary&quot;</span>);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;   pjsip_msg_add_hdr(tdata-&gt;msg, (pjsip_hdr *) event);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   pjsip_msg_add_hdr(tdata-&gt;msg, pjsip_hdr_shallow_clone(tdata-&gt;pool, allow_events));</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a9a14851d1f88b087df7237ec180de52e">ast_sip_add_body</a>(tdata, &amp;body);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a9302fd362f9d52147d928c5bc4740433">ast_sip_send_request</a>(tdata, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, endpoint, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(body_text);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;}</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a9953876c16c732791945ec93d22bfe3c">  450</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9953876c16c732791945ec93d22bfe3c">find_aor_for_resource</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint, <span class="keyword">const</span> <span class="keywordtype">char</span> *resource)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;{</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;   <span class="keywordtype">char</span> *aor_name;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;   <span class="keywordtype">char</span> *aors_copy;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;   <span class="comment">/* Direct match */</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   <span class="keywordflow">if</span> ((aor = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a434c2d85dbd10a9453f6d409809330d5">ast_sip_location_retrieve_aor</a>(resource))) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordflow">return</span> aor;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;   <span class="keywordflow">if</span> (!endpoint) {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">    * This may be a subscribe to the voicemail_extension.  If so,</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">    * look for an aor belonging to this endpoint that has a matching</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">    * voicemail_extension.</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;   aors_copy = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">aors</a>);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   <span class="keywordflow">while</span> ((aor_name = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(<a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;aors_copy, <span class="stringliteral">&quot;,&quot;</span>)))) {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *check_aor = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a434c2d85dbd10a9453f6d409809330d5">ast_sip_location_retrieve_aor</a>(aor_name);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="keywordflow">if</span> (!check_aor) {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(check_aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a308749bdeaa0c310b2e8ff666748b5d0">voicemail_extension</a>)</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;         &amp;&amp; !strcasecmp(check_aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a308749bdeaa0c310b2e8ff666748b5d0">voicemail_extension</a>, resource)) {</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Found an aor (%s) that matches voicemail_extension %s\n&quot;</span>, aor_name, resource);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;         <span class="keywordflow">return</span> check_aor;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(check_aor, -1);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   }</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;}</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a07b38eb1813c6f4b246826f31ef723cf">  490</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a07b38eb1813c6f4b246826f31ef723cf">send_unsolicited_mwi_notify</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>,</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html">ast_sip_message_accumulator</a> *counter)</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;{</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *, endpoint, <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(),</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            <span class="stringliteral">&quot;endpoint&quot;</span>, sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;   <span class="keywordtype">char</span> *endpoint_aors;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;   <span class="keywordtype">char</span> *aor_name;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;   <span class="keywordflow">if</span> (!endpoint) {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to send unsolicited MWI to %s because endpoint does not exist\n&quot;</span>,</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;   }</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(endpoint-&gt;aors)) {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to send unsolicited MWI to %s because the endpoint has no&quot;</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <span class="stringliteral">&quot; configured AORs\n&quot;</span>, sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;   }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;   endpoint_aors = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(endpoint-&gt;aors);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;Sending unsolicited MWI NOTIFY to endpoint %s, new messages: %d, old messages: %d\n&quot;</span>,</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;         sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>, counter-&gt;<a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html#a70de9f16a229e2c5bf1a973372949d3e">new_msgs</a>, counter-&gt;<a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html#a4369ae7c984aba22ce6d0e92718f2b29">old_msgs</a>);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;   <span class="keywordflow">while</span> ((aor_name = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(<a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;endpoint_aors, <span class="stringliteral">&quot;,&quot;</span>)))) {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *, aor, <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a434c2d85dbd10a9453f6d409809330d5">ast_sip_location_retrieve_aor</a>(aor_name), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *, contacts, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../dd/da0/structunsolicited__mwi__data.html">unsolicited_mwi_data</a> mwi_data = {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;         .<a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a45123f0785d20e2f8a0e0da9156bce29">sub</a> = <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>,</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;         .endpoint = <a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>,</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;         .counter = <a class="code" href="../../dd/da0/structunsolicited__mwi__data.html#a40d55a4fd17d00c3dfa95e0b1d771da8">counter</a>,</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      };</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordflow">if</span> (!aor) {</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to locate AOR %s for unsolicited MWI\n&quot;</span>, aor_name);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      contacts = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a404837089a8a08b9f341f2ccea7128ef">ast_sip_location_retrieve_aor_contacts</a>(aor);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="keywordflow">if</span> (!contacts || (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(contacts) == 0)) {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;No contacts bound to AOR %s. Cannot send unsolicited MWI until a contact registers.\n&quot;</span>, aor_name);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(contacts, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a53cdb34a33e982a9c71dc95c3df60e21">send_unsolicited_mwi_notify_to_contact</a>, &amp;mwi_data);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;   }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;}</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a3095f6b1db2074fd9f8fd709747d1a99">  538</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a3095f6b1db2074fd9f8fd709747d1a99">send_mwi_notify</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;{</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html">ast_sip_message_accumulator</a> counter = {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      .<a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html#a4369ae7c984aba22ce6d0e92718f2b29">old_msgs</a> = 0,</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      .new_msgs = 0,</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      .message_account[0] = <span class="charliteral">&#39;\0&#39;</span>,</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;   };</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/de8/structast__sip__body__data.html">ast_sip_body_data</a> data = {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      .<a class="code" href="../../d1/de8/structast__sip__body__data.html#a35514bc6335d541353cf54c7146e8ce5">body_type</a> = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a9632d729a323355beec62acda995cc21">AST_SIP_MESSAGE_ACCUMULATOR</a>,</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      .body_data = &amp;counter,</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;   };</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a59a4d26dfca856c70a1e9487e073aa13">get_message_count</a>, &amp;counter);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;   <span class="keywordflow">if</span> (sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#ac862c692b98c7abdb1fb8609c40b950c">is_solicited</a>) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *resource = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a2d7ed3f8785ad9d9aa3fc090d983c45d">ast_sip_subscription_get_resource_name</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#abce1c0cc1320bb801480d0929266d08f">ast_sip_subscription_get_endpoint</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9953876c16c732791945ec93d22bfe3c">find_aor_for_resource</a>(endpoint, resource);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      pjsip_dialog *dlg = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#aa6471e6d6f4563ef5fb93343180fea40">ast_sip_subscription_get_dialog</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      pjsip_sip_uri *sip_uri = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a79792c0d3a54f779754479075e3c80b3">ast_sip_subscription_get_sip_uri</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="keywordflow">if</span> (aor &amp;&amp; dlg &amp;&amp; sip_uri) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;         <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a3881b0a18f4862d307926519783a3471">set_voicemail_extension</a>(dlg-&gt;pool, sip_uri, &amp;counter, aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a308749bdeaa0c310b2e8ff666748b5d0">voicemail_extension</a>);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(aor);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(endpoint);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a5b0f67be0ca6ad54e4eba8d4aa029faf">ast_sip_subscription_notify</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>, &amp;data, sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a54c4d5964f197213bff36430ba6b18dc">terminate</a>);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   }</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a07b38eb1813c6f4b246826f31ef723cf">send_unsolicited_mwi_notify</a>(sub, &amp;counter);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;}</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#aba456f7d925cf5fcd7ae2160c74cf72d">  573</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aba456f7d925cf5fcd7ae2160c74cf72d">unsubscribe_stasis</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;{</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *mwi_stasis = obj;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;   <span class="keywordflow">if</span> (mwi_stasis-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a729610ef7a35f78eae4cf4ed1c1552c7">mwi_subscriber</a>) {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Removing stasis subscription to mailbox %s\n&quot;</span>, mwi_stasis-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      mwi_stasis-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a729610ef7a35f78eae4cf4ed1c1552c7">mwi_subscriber</a> = <a class="code" href="../../dc/d33/mwi_8h.html#acf8d474c4029156d9c49a4ddea50d01b">ast_mwi_unsubscribe_and_join</a>(mwi_stasis-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a729610ef7a35f78eae4cf4ed1c1552c7">mwi_subscriber</a>);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;   }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;}</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a6ef65f8e0fb16284789ef192d949fb6c">create_unsolicited_mwi_subscriptions</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint,</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;   <span class="keywordtype">int</span> recreate, <span class="keywordtype">int</span> send_now, <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *unsolicited_mwi, <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *solicited_mwi);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a66f4e76926c44414b78e582db97872e7">  587</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a66f4e76926c44414b78e582db97872e7">mwi_subscription_shutdown</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;{</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *mwi_datastore;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *unsolicited_mwi;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *solicited_mwi;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;   mwi_datastore = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a5ad2231cd4e17cd5a713f0c7cea20da4">ast_sip_subscription_get_datastore</a>(sub, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ada97d04fc8187c3dbf625dfa8567db41">MWI_DATASTORE</a>);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;   <span class="keywordflow">if</span> (!mwi_datastore) {</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;   }</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;   mwi_sub = mwi_datastore-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(mwi_sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aba456f7d925cf5fcd7ae2160c74cf72d">unsubscribe_stasis</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;   <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a3c257396060f400b0fba424730e7576e">ast_sip_subscription_remove_datastore</a>(sub, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ada97d04fc8187c3dbf625dfa8567db41">MWI_DATASTORE</a>);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;   endpoint = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;endpoint&quot;</span>, mwi_sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_datastore, -1);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;   solicited_mwi = <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(mwi_solicited);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;   <span class="keywordflow">if</span> (solicited_mwi) {</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(solicited_mwi, mwi_sub);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;   }</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">    * When a solicited subscription is removed it&#39;s possible an unsolicited one</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">    * needs to be [re-]created. Attempt to establish unsolicited MWI.</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   unsolicited_mwi = <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(mwi_unsolicited);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;   <span class="keywordflow">if</span> (unsolicited_mwi &amp;&amp; endpoint) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(unsolicited_mwi);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a6ef65f8e0fb16284789ef192d949fb6c">create_unsolicited_mwi_subscriptions</a>(endpoint, 1, 1, unsolicited_mwi, solicited_mwi);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(unsolicited_mwi);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(unsolicited_mwi, -1);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;   }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(solicited_mwi);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(endpoint);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;}</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a7d8287379cde5b4645753f3b4c10f1a7">  629</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a7d8287379cde5b4645753f3b4c10f1a7">mwi_ds_destroy</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;{</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a> = data;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub, -1);</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;}</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a71c256db2fb46798ee18ef0321e0b695">  636</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a71c256db2fb46798ee18ef0321e0b695">mwi_ds_info</a> = {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;   .<a class="code" href="../../d9/dfb/structast__datastore__info.html#afdad821535486a599c1df88ef7be69bb">destroy</a> = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a7d8287379cde5b4645753f3b4c10f1a7">mwi_ds_destroy</a>,</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;};</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a5f3a63478908fbf1b6415b2101d12a59">  640</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a5f3a63478908fbf1b6415b2101d12a59">add_mwi_datastore</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;{</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *mwi_datastore;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;   mwi_datastore = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a5d3ad3f5c55c026e22e1103686227ae0">ast_sip_subscription_alloc_datastore</a>(&amp;mwi_ds_info, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ada97d04fc8187c3dbf625dfa8567db41">MWI_DATASTORE</a>);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;   <span class="keywordflow">if</span> (!mwi_datastore) {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;   }</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub, +1);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;   mwi_datastore-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a> = <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">    * NOTE:  Adding the datastore to the subscription creates a ref loop</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">    * that must be manually broken.</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;   res = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a68314dedb48b2799a693d3a090ae038b">ast_sip_subscription_add_datastore</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>, mwi_datastore);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_datastore, -1);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;}</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment"> * \brief Determine if an MWI subscription already exists for the given endpoint/mailbox</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment"> * Search the given container, and attempt to find out if the given endpoint has a</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment"> * current subscription within. If so pass back the associated mwi_subscription and</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment"> * mwi_stasis_subscription objects.</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment"> * \note If a subscription is located then the caller is responsible for removing the</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment"> * references to the passed back mwi_subscription and mwi_stasis_subscription objects.</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment"> * \note Must be called with the given container already locked.</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment"> * \param container The ao2_container to search</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment"> * \param endpoint The endpoint to find</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment"> * \param mailbox The mailbox potentially subscribed</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment"> * \param mwi_sub [out] May contain the located mwi_subscription</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment"> * \param mwi_stasis [out] May contain the located mwi_stasis_subscription</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment"> * \retval 1 if a subscription was located, 0 otherwise</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00682"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a5c3c5d7218e0c2d24c13558dbb3d6f40">  682</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a5c3c5d7218e0c2d24c13558dbb3d6f40">has_mwi_subscription</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">container</a>,</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>,</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> **<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>, <span class="keyword">struct</span> <a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> **mwi_stasis)</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;{</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> *mwi_subs;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;   *mwi_sub = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   *mwi_stasis = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;   <span class="keywordflow">if</span> (!container) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;   }</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;   mwi_subs = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(container, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint),</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                  <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;   <span class="keywordflow">if</span> (!mwi_subs) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;   }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;   <span class="keywordflow">while</span> ((*mwi_sub = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(mwi_subs))) {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      *mwi_stasis = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>((*mwi_sub)-&gt;stasis_subs, mailbox, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keywordflow">if</span> (*mwi_stasis) {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;         <span class="comment">/* If found then caller is responsible for unrefs of passed back objects */</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(*mwi_sub, -1);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;   }</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(mwi_subs);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;   <span class="keywordflow">return</span> *mwi_stasis ? 1 : 0;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;}</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment"> * \brief Allow and/or replace the unsolicited subscription</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment"> * Checks to see if solicited subscription is allowed. If allowed, and an</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment"> * unsolicited one exists then prepare for replacement by removing the</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment"> * current unsolicited subscription.</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment"> * \param endpoint The endpoint</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment"> * \param mailbox The mailbox</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment"> * \param unsolicited_mwi A container of unsolicited mwi objects</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment"> * \retval 1 if a solicited subscription is allowed for the endpoint/mailbox</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment"> *         0 otherwise</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00729"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a4fb7a664ab7adcfedfb757661999a824">  729</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a4fb7a664ab7adcfedfb757661999a824">allow_and_or_replace_unsolicited</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>,</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *unsolicited_mwi)</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;{</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *mwi_stasis;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a5c3c5d7218e0c2d24c13558dbb3d6f40">has_mwi_subscription</a>(unsolicited_mwi, endpoint, mailbox, &amp;mwi_sub, &amp;mwi_stasis)) {</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="comment">/* If no unsolicited subscription then allow the solicited one */</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;   }</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;   <span class="keywordflow">if</span> (!endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">subscription</a>.<a class="code" href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">mwi</a>.<a class="code" href="../../d9/dbd/structast__sip__mwi__configuration.html#aeaf7643dcb3498b22a91f2d5830f6839">subscribe_replaces_unsolicited</a>) {</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="comment">/* Has unsolicited subscription and can&#39;t replace, so disallow */</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_stasis, -1);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_sub, -1);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   }</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">    * The unsolicited subscription exists, and it is allowed to be replaced.</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">    * So, first remove the unsolicited stasis subscription, and if aggregation</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment">    * is not enabled then also remove the mwi_subscription object as well.</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Unsolicited subscription being replaced by solicited for &quot;</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;         <span class="stringliteral">&quot;endpoint &#39;%s&#39; mailbox &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint), mailbox);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;   <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aba456f7d925cf5fcd7ae2160c74cf72d">unsubscribe_stasis</a>(mwi_stasis, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(mwi_sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>, mwi_stasis);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   <span class="keywordflow">if</span> (!endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">subscription</a>.<a class="code" href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">mwi</a>.<a class="code" href="../../d9/dbd/structast__sip__mwi__configuration.html#ab65d43f5f6ba330d99f5552aa3821817">aggregate</a>) {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(unsolicited_mwi, mwi_sub);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_stasis, -1);</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_sub, -1);</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;   <span class="comment">/* This solicited subscription is replacing an unsolicited one, so allow */</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;}</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0d7b02993fcdcf14b5415b98d512fe54">send_notify</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags);</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment"> * \brief Determine if an unsolicited MWI subscription is allowed</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment"> * \param endpoint The endpoint</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment"> * \param mailbox The mailbox</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment"> * \param unsolicited_mwi A container of unsolicited mwi objects</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment"> * \param solicited_mwi A container of solicited mwi objects</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment"> * \retval 1 if an unsolicited subscription is allowed for the endpoint/mailbox</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment"> *         0 otherwise</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00783"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a81588c60180173cbfe0a73e0ba6e4e98">  783</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a81588c60180173cbfe0a73e0ba6e4e98">is_unsolicited_allowed</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>,</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *unsolicited_mwi, <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *solicited_mwi)</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;{</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *mwi_stasis;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(mailbox)) {</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   }</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">    * First check if an unsolicited subscription exists. If it does then we don&#39;t</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">    * want to add another one.</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a5c3c5d7218e0c2d24c13558dbb3d6f40">has_mwi_subscription</a>(unsolicited_mwi, endpoint, mailbox, &amp;mwi_sub, &amp;mwi_stasis)) {</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_stasis, -1);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_sub, -1);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;   }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment">    * If there is no unsolicited subscription, next check to see if a solicited</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment">    * subscription exists for the endpoint/mailbox. If not, then allow.</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a5c3c5d7218e0c2d24c13558dbb3d6f40">has_mwi_subscription</a>(solicited_mwi, endpoint, mailbox, &amp;mwi_sub, &amp;mwi_stasis)) {</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;   }</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment">    * If however, a solicited subscription does exist then we&#39;ll need to see if that</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment">    * subscription is allowed to replace the unsolicited one. If is allowed to replace</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment">    * then disallow the unsolicited one.</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;   <span class="keywordflow">if</span> (endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">subscription</a>.<a class="code" href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">mwi</a>.<a class="code" href="../../d9/dbd/structast__sip__mwi__configuration.html#aeaf7643dcb3498b22a91f2d5830f6839">subscribe_replaces_unsolicited</a>) {</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_stasis, -1);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_sub, -1);</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;   }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;   <span class="comment">/* Otherwise, shutdown the solicited subscription and allow the unsolicited */</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;   mwi_sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a54c4d5964f197213bff36430ba6b18dc">terminate</a> = 1;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;   <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0d7b02993fcdcf14b5415b98d512fe54">send_notify</a>(mwi_sub, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_stasis, -1);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_sub, -1);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;}</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment"> * \brief Determine if an endpoint is a candidate to be able to subscribe for MWI</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment"> * Currently, this just makes sure that the endpoint is not already receiving unsolicted</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment"> * MWI for any of an AOR&#39;s configured mailboxes.</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment"> * \param obj The AOR to which the endpoint is subscribing.</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment"> * \param arg The endpoint that is attempting to subscribe.</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment"> * \param flags Unused.</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment"> * \retval 0 Endpoint is a candidate to subscribe to MWI on the AOR.</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment"> * \retval -1 The endpoint cannot subscribe to MWI on the AOR.</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00844"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a9745c44b16328b58e6058be6766250b2">  844</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9745c44b16328b58e6058be6766250b2">mwi_validate_for_aor</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;{</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor = obj;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint = arg;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd5/res__ari__mailboxes_8c.html#a29d08f8b2448744d75ca9ebc4e218419">mailboxes</a>;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *unsolicited_mwi;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a9894add746aaf09d183e44b09aa8cc78">mailboxes</a>)) {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;   }</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;   <span class="comment">/* A reload could be taking place so lock while checking if allowed */</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;   unsolicited_mwi = <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(mwi_unsolicited);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;   <span class="keywordflow">if</span> (unsolicited_mwi) {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(unsolicited_mwi);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;   }</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;   mailboxes = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a9894add746aaf09d183e44b09aa8cc78">mailboxes</a>);</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;   <span class="keywordflow">while</span> ((mailbox = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(<a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;mailboxes, <span class="stringliteral">&quot;,&quot;</span>)))) {</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(mailbox)) {</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      }</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a4fb7a664ab7adcfedfb757661999a824">allow_and_or_replace_unsolicited</a>(endpoint, mailbox, unsolicited_mwi)) {</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Endpoint &#39;%s&#39; already configured for unsolicited MWI for mailbox &#39;%s&#39;. &quot;</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;               <span class="stringliteral">&quot;Denying MWI subscription to %s\n&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint), mailbox,</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;               <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(aor));</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;         <span class="keywordflow">if</span> (unsolicited_mwi) {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(unsolicited_mwi);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(unsolicited_mwi, -1);</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;         }</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      }</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   }</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;   <span class="keywordflow">if</span> (unsolicited_mwi) {</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(unsolicited_mwi);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(unsolicited_mwi, -1);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;   }</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;}</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00889"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a41fb33a1027944b6705b73648b6d9a5d">  889</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a41fb33a1027944b6705b73648b6d9a5d">mwi_on_aor</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;{</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor = obj;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a> = arg;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd5/res__ari__mailboxes_8c.html#a29d08f8b2448744d75ca9ebc4e218419">mailboxes</a>;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a9894add746aaf09d183e44b09aa8cc78">mailboxes</a>)) {</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;   }</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;   mailboxes = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a9894add746aaf09d183e44b09aa8cc78">mailboxes</a>);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   <span class="keywordflow">while</span> ((mailbox = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(<a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;mailboxes, <span class="stringliteral">&quot;,&quot;</span>)))) {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *mwi_stasis_sub;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(mailbox)) {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      }</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      mwi_stasis_sub = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac3452fce158d1f1362470481c54aae5a">mwi_stasis_subscription_alloc</a>(mailbox, sub);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      <span class="keywordflow">if</span> (!mwi_stasis_sub) {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>, mwi_stasis_sub);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_stasis_sub, -1);</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;   }</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;}</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div><div class="line"><a name="l00920"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a54e3ec951336bb4eddb29532efb45df7">  920</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a54e3ec951336bb4eddb29532efb45df7">mwi_create_subscription</a>(</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint, <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>)</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;{</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a> = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a80204d074b73e3cc135868e141dabc61">mwi_subscription_alloc</a>(endpoint, 1, sip_sub);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;   <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;   }</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a5f3a63478908fbf1b6415b2101d12a59">add_mwi_datastore</a>(sub)) {</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to add datastore for MWI subscription to %s\n&quot;</span>,</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;         sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">id</a>);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub, -1);</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;   }</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;}</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#afdf1bb41c7cc194a8305f4102d529748">  939</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#afdf1bb41c7cc194a8305f4102d529748">mwi_subscribe_single</a>(</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint, <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;{</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;   aor = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9953876c16c732791945ec93d22bfe3c">find_aor_for_resource</a>(endpoint, name);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;   <span class="keywordflow">if</span> (!aor) {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to locate aor %s. MWI subscription failed.\n&quot;</span>, name);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;   }</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;   sub = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a54e3ec951336bb4eddb29532efb45df7">mwi_create_subscription</a>(endpoint, sip_sub);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;   <span class="keywordflow">if</span> (sub) {</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a41fb33a1027944b6705b73648b6d9a5d">mwi_on_aor</a>(aor, sub, 0);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;   }</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(aor, -1);</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;}</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div><div class="line"><a name="l00960"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#aee9c599a805f75e757ffcdc239a1774d">  960</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aee9c599a805f75e757ffcdc239a1774d">mwi_subscribe_all</a>(</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint, <span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>)</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;{</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   sub = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a54e3ec951336bb4eddb29532efb45df7">mwi_create_subscription</a>(endpoint, sip_sub);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;   <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   }</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a4a6f16128f131ec8feae5dc0f8545b2f">ast_sip_for_each_aor</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">aors</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a41fb33a1027944b6705b73648b6d9a5d">mwi_on_aor</a>, sub);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;}</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a053bbd417bcb3a65e5ae312062e3eafd">  974</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a053bbd417bcb3a65e5ae312062e3eafd">mwi_new_subscribe</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint,</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *resource)</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;{</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *, aor, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(resource)) {</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a4a6f16128f131ec8feae5dc0f8545b2f">ast_sip_for_each_aor</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">aors</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9745c44b16328b58e6058be6766250b2">mwi_validate_for_aor</a>, endpoint)) {</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;         <span class="keywordflow">return</span> 500;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      }</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="keywordflow">return</span> 200;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;   }</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;   aor = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9953876c16c732791945ec93d22bfe3c">find_aor_for_resource</a>(endpoint, resource);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;   <span class="keywordflow">if</span> (!aor) {</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to locate aor %s. MWI subscription failed.\n&quot;</span>, resource);</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="keywordflow">return</span> 404;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;   }</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(aor-&gt;mailboxes)) {</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;AOR %s has no configured mailboxes. MWI subscription failed.\n&quot;</span>,</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;         resource);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <span class="keywordflow">return</span> 404;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;   }</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9745c44b16328b58e6058be6766250b2">mwi_validate_for_aor</a>(aor, endpoint, 0)) {</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <span class="keywordflow">return</span> 500;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;   }</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;   <span class="keywordflow">return</span> 200;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;}</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div><div class="line"><a name="l01005"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a7638502d402f3253031f7975f21c86d8"> 1005</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a7638502d402f3253031f7975f21c86d8">mwi_subscription_established</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>)</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;{</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *resource = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a2d7ed3f8785ad9d9aa3fc090d983c45d">ast_sip_subscription_get_resource_name</a>(sip_sub);</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#abce1c0cc1320bb801480d0929266d08f">ast_sip_subscription_get_endpoint</a>(sip_sub);</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *solicited_mwi;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   <span class="comment">/* no aor in uri? subscribe to all on endpoint */</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(resource)) {</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      sub = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aee9c599a805f75e757ffcdc239a1774d">mwi_subscribe_all</a>(endpoint, sip_sub);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      sub = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#afdf1bb41c7cc194a8305f4102d529748">mwi_subscribe_single</a>(endpoint, sip_sub, resource);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;   }</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;   <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(endpoint);</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;   }</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>)) {</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">       * We setup no MWI subscriptions so remove the MWI datastore</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">       * to break the ref loop.</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a3c257396060f400b0fba424730e7576e">ast_sip_subscription_remove_datastore</a>(sip_sub, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ada97d04fc8187c3dbf625dfa8567db41">MWI_DATASTORE</a>);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;   }</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;   solicited_mwi = <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(mwi_solicited);</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;   <span class="keywordflow">if</span> (solicited_mwi) {</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(solicited_mwi, sub);</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(solicited_mwi, -1);</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;   }</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sub);</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(endpoint);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;}</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div><div class="line"><a name="l01042"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a905a945079446eca1922dd17536896f3"> 1042</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a905a945079446eca1922dd17536896f3">mwi_get_notify_data</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;{</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/dfb/structast__sip__message__accumulator.html">ast_sip_message_accumulator</a> *counter;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *mwi_datastore;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#abce1c0cc1320bb801480d0929266d08f">ast_sip_subscription_get_endpoint</a>(sub);</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;   mwi_datastore = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a5ad2231cd4e17cd5a713f0c7cea20da4">ast_sip_subscription_get_datastore</a>(sub, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ada97d04fc8187c3dbf625dfa8567db41">MWI_DATASTORE</a>);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;   <span class="keywordflow">if</span> (!mwi_datastore) {</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;   }</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;   mwi_sub = mwi_datastore-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;   counter = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*counter), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;   <span class="keywordflow">if</span> (!counter) {</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(mwi_datastore);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;   }</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;   <span class="keywordflow">if</span> ((aor = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9953876c16c732791945ec93d22bfe3c">find_aor_for_resource</a>(endpoint, <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a2d7ed3f8785ad9d9aa3fc090d983c45d">ast_sip_subscription_get_resource_name</a>(sub)))) {</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      pjsip_dialog *dlg = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#aa6471e6d6f4563ef5fb93343180fea40">ast_sip_subscription_get_dialog</a>(sub);</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      pjsip_sip_uri *sip_uri = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a79792c0d3a54f779754479075e3c80b3">ast_sip_subscription_get_sip_uri</a>(sub);</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      <span class="keywordflow">if</span> (dlg &amp;&amp; sip_uri) {</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;         <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a3881b0a18f4862d307926519783a3471">set_voicemail_extension</a>(dlg-&gt;pool, sip_uri, counter, aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a308749bdeaa0c310b2e8ff666748b5d0">voicemail_extension</a>);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      }</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(aor, -1);</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;   }</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(endpoint);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(mwi_sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a59a4d26dfca856c70a1e9487e073aa13">get_message_count</a>, counter);</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(mwi_datastore);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;   <span class="keywordflow">return</span> counter;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;}</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ac6e8189a57e4a9cfc4eac7a3523781bd"> 1078</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac6e8189a57e4a9cfc4eac7a3523781bd">mwi_subscription_mailboxes_str</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *stasis_subs,</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;                  <span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;{</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;   <span class="keywordtype">int</span> is_first = 1;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *<a class="code" href="../../d5/da1/structnode.html">node</a>;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(stasis_subs, 0);</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;   <span class="keywordflow">while</span> ((node = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i))) {</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      <span class="keywordflow">if</span> (is_first) {</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;         is_first = 0;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(str, 0, <span class="stringliteral">&quot;%s&quot;</span>, node-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>);</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(str, 0, <span class="stringliteral">&quot;,%s&quot;</span>, node-&gt;<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      }</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(node, -1);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;   }</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;}</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a0dc2ec71240257862dd8cd88aab7354b"> 1097</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0dc2ec71240257862dd8cd88aab7354b">mwi_to_ami</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>,</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;             <span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>)</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;{</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *mwi_datastore;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;   mwi_datastore = <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a5ad2231cd4e17cd5a713f0c7cea20da4">ast_sip_subscription_get_datastore</a>(sub, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ada97d04fc8187c3dbf625dfa8567db41">MWI_DATASTORE</a>);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;   <span class="keywordflow">if</span> (!mwi_datastore) {</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;   }</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;   mwi_sub = mwi_datastore-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;SubscriptionType: mwi\r\n&quot;</span>);</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;Mailboxes: &quot;</span>);</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;   <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac6e8189a57e4a9cfc4eac7a3523781bd">mwi_subscription_mailboxes_str</a>(mwi_sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>, buf);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_datastore, -1);</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;}</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a9f1ada4bb94ffd586b164affb44f5ef3"> 1118</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9f1ada4bb94ffd586b164affb44f5ef3">serialized_notify</a>(<span class="keywordtype">void</span> *userdata)</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;{</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a> = userdata;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;   <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a3095f6b1db2074fd9f8fd709747d1a99">send_mwi_notify</a>(mwi_sub);</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_sub, -1);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;}</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ab7eea518476f0bc3f418067556ccc4bc"> 1127</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ab7eea518476f0bc3f418067556ccc4bc">serialized_cleanup</a>(<span class="keywordtype">void</span> *userdata)</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;{</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a> = userdata;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;   <span class="comment">/* This is getting rid of the reference that was added</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">    * just before this serialized task was pushed.</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(mwi_sub);</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;   <span class="comment">/* This is getting rid of the reference held by the</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">    * stasis subscription</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(mwi_sub);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;}</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a0d7b02993fcdcf14b5415b98d512fe54"> 1142</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0d7b02993fcdcf14b5415b98d512fe54">send_notify</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;{</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a> = obj;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *<a class="code" href="../../d9/d47/structserializer.html">serializer</a> = mwi_sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#ac862c692b98c7abdb1fb8609c40b950c">is_solicited</a></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      ? <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a81489602b194ea87cae6470409bee3b5">ast_sip_subscription_get_serializer</a>(mwi_sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">sip_sub</a>)</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      : <a class="code" href="../../dd/d5f/serializer_8h.html#a57044062c5e192e675109fa621c1588d">ast_serializer_pool_get</a>(mwi_serializer_pool);</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(serializer, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9f1ada4bb94ffd586b164affb44f5ef3">serialized_notify</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(mwi_sub))) {</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_sub, -1);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;   }</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;}</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ac1cdb85fe882c3a0b4605746358219b6"> 1156</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac1cdb85fe882c3a0b4605746358219b6">mwi_stasis_cb</a>(<span class="keywordtype">void</span> *userdata, <span class="keyword">struct</span> <a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>,</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg)</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;{</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a> = userdata;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d79/stasis_8h.html#a839350445aaa51cedf31f6daec933ee0">stasis_subscription_final_message</a>(sub, msg)) {</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(<a class="code" href="../../dd/d5f/serializer_8h.html#a57044062c5e192e675109fa621c1588d">ast_serializer_pool_get</a>(mwi_serializer_pool),</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;            <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ab7eea518476f0bc3f418067556ccc4bc">serialized_cleanup</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(mwi_sub))) {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_sub, -1);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      }</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;   }</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a>() == <a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(msg)) {</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0d7b02993fcdcf14b5415b98d512fe54">send_notify</a>(mwi_sub, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;   }</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;}</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment"> * \brief Create unsolicited MWI subscriptions for an endpoint</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment"> * \note Call with the unsolicited_mwi container lock held.</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment"> * \param endpoint An endpoint object</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment"> * \param recreate Whether or not unsolicited subscriptions are potentially being recreated</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment"> * \param send_now Whether or not to send a notify once the subscription is created</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment"> * \param unsolicited_mwi A container of unsolicited mwi objects</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment"> * \param solicited_mwi A container of solicited mwi objects</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment"> * \retval 0</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01188"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a6ef65f8e0fb16284789ef192d949fb6c"> 1188</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a6ef65f8e0fb16284789ef192d949fb6c">create_unsolicited_mwi_subscriptions</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint,</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;   <span class="keywordtype">int</span> recreate, <span class="keywordtype">int</span> send_now, <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *unsolicited_mwi, <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *solicited_mwi)</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;{</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *, aggregate_sub, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd5/res__ari__mailboxes_8c.html#a29d08f8b2448744d75ca9ebc4e218419">mailboxes</a>;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mailbox</a>;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;   <span class="keywordtype">int</span> sub_added = 0;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">subscription</a>.<a class="code" href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">mwi</a>.<a class="code" href="../../d9/dbd/structast__sip__mwi__configuration.html#a9894add746aaf09d183e44b09aa8cc78">mailboxes</a>)) {</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;   }</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;   <span class="keywordflow">if</span> (endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">subscription</a>.<a class="code" href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">mwi</a>.<a class="code" href="../../d9/dbd/structast__sip__mwi__configuration.html#ab65d43f5f6ba330d99f5552aa3821817">aggregate</a>) {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *endpoint_id = <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint);</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="comment">/* Check if aggregate subscription exists */</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      aggregate_sub = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(unsolicited_mwi, endpoint_id, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment">       * If enabled there should only ever exist a single aggregate subscription object</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">       * for an endpoint. So if it exists just return unless subscriptions are potentially</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment">       * being added back in. If that&#39;s the case then continue.</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordflow">if</span> (aggregate_sub &amp;&amp; !recreate) {</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      }</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      <span class="keywordflow">if</span> (!aggregate_sub) {</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;         aggregate_sub = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a80204d074b73e3cc135868e141dabc61">mwi_subscription_alloc</a>(endpoint, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;         <span class="keywordflow">if</span> (!aggregate_sub) {</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            <span class="keywordflow">return</span> 0; <span class="comment">/* No MWI aggregation for you */</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;         }</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment">          * Just in case we somehow get in the position of recreating with no previous</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">          * aggregate object, set recreate to false here in order to allow the new</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">          * object to be linked into the container below</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;         recreate = 0;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      }</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;   }</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   <span class="comment">/* Lock solicited so we don&#39;t potentially add to both containers */</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;   <span class="keywordflow">if</span> (solicited_mwi) {</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(solicited_mwi);</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   }</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;   mailboxes = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">subscription</a>.<a class="code" href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">mwi</a>.<a class="code" href="../../d9/dbd/structast__sip__mwi__configuration.html#a9894add746aaf09d183e44b09aa8cc78">mailboxes</a>);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;   <span class="keywordflow">while</span> ((mailbox = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(<a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;mailboxes, <span class="stringliteral">&quot;,&quot;</span>)))) {</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a> *mwi_stasis_sub;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a81588c60180173cbfe0a73e0ba6e4e98">is_unsolicited_allowed</a>(endpoint, mailbox, unsolicited_mwi, solicited_mwi)) {</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      }</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      sub = aggregate_sub ?: <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a80204d074b73e3cc135868e141dabc61">mwi_subscription_alloc</a>(endpoint, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      }</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      mwi_stasis_sub = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac3452fce158d1f1362470481c54aae5a">mwi_stasis_subscription_alloc</a>(mailbox, sub);</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      <span class="keywordflow">if</span> (mwi_stasis_sub) {</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>, mwi_stasis_sub);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_stasis_sub, -1);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      }</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <span class="keywordflow">if</span> (!aggregate_sub) {</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a7ce8563daf84a18540a86504d165b444">ao2_link_flags</a>(unsolicited_mwi, sub, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;         <span class="keywordflow">if</span> (send_now) {</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0d7b02993fcdcf14b5415b98d512fe54">send_notify</a>(sub, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;         }</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub, -1);</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      }</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <span class="keywordflow">if</span> (aggregate_sub &amp;&amp; !sub_added) {</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;         <span class="comment">/* If aggregation track if at least one subscription has been added */</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;         sub_added = 1;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      }</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;   }</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;   <span class="keywordflow">if</span> (aggregate_sub) {</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(aggregate_sub-&gt;stasis_subs)) {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;         <span class="comment">/* Only link if we&#39;re dealing with a new aggregate object */</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;         <span class="keywordflow">if</span> (!recreate) {</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a7ce8563daf84a18540a86504d165b444">ao2_link_flags</a>(unsolicited_mwi, aggregate_sub, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;         }</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;         <span class="keywordflow">if</span> (send_now &amp;&amp; sub_added) {</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;            <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0d7b02993fcdcf14b5415b98d512fe54">send_notify</a>(aggregate_sub, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;         }</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      }</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;   }</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;   <span class="keywordflow">if</span> (solicited_mwi) {</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(solicited_mwi);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;   }</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;}</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div><div class="line"><a name="l01287"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ace4133926fe22c2e4c9da402da9e5c20"> 1287</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ace4133926fe22c2e4c9da402da9e5c20">create_mwi_subscriptions_for_endpoint</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;{</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a6ef65f8e0fb16284789ef192d949fb6c">create_unsolicited_mwi_subscriptions</a>(obj, 0, 0, arg, data);</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;}</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a30833678d2fe25c6b56dfe159b3d281b"> 1292</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a30833678d2fe25c6b56dfe159b3d281b">unsubscribe</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;{</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a> = obj;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(mwi_sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">stasis_subs</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aba456f7d925cf5fcd7ae2160c74cf72d">unsubscribe_stasis</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;}</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a84a555cca13f36d9a82bd461f8f5a07b"> 1301</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a84a555cca13f36d9a82bd461f8f5a07b">create_mwi_subscriptions</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;{</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *unsolicited_mwi;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *solicited_mwi;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d7/d4b/main_2endpoints_8c.html#a0b6312c44448ff7ed80ac99b3077e438">endpoints</a>;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;   unsolicited_mwi = <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(mwi_unsolicited);</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;   <span class="keywordflow">if</span> (!unsolicited_mwi) {</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;   }</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;   var = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a66581086d34dfe7ea86b0644bacef239">ast_variable_new</a>(<span class="stringliteral">&quot;mailboxes !=&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;   endpoints = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;endpoint&quot;</span>,</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a>, var);</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;   <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a>(var);</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;   <span class="keywordflow">if</span> (!endpoints) {</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(unsolicited_mwi, -1);</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;   }</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;   solicited_mwi = <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(mwi_solicited);</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;   <span class="comment">/* We remove all the old stasis subscriptions first before applying the new configuration. This</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">    * prevents a situation where there might be multiple overlapping stasis subscriptions for an</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment">    * endpoint for mailboxes. Though there may be mailbox changes during the gap between unsubscribing</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment">    * and resubscribing, up-to-date mailbox state will be sent out to the endpoint when the</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment">    * new stasis subscription is established</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(unsolicited_mwi);</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(unsolicited_mwi, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a30833678d2fe25c6b56dfe159b3d281b">unsubscribe</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a63fd831fe48aed32d3ef992ad8e45293">ao2_callback_data</a>(endpoints, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ace4133926fe22c2e4c9da402da9e5c20">create_mwi_subscriptions_for_endpoint</a>, unsolicited_mwi, solicited_mwi);</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(unsolicited_mwi);</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(endpoints, -1);</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(solicited_mwi);</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(unsolicited_mwi, -1);</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;}</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">/*! \brief Function called to send MWI NOTIFY on any unsolicited mailboxes relating to this AOR */</span></div><div class="line"><a name="l01343"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a9b38fe6d8eca53716459a092e141df75"> 1343</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9b38fe6d8eca53716459a092e141df75">send_contact_notify</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;{</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a> = obj;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *aor = arg;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;   <span class="keywordflow">if</span> (!mwi_sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#aee9980d9bea7526cafef97a0672b00cd">aors</a> || !strstr(mwi_sub-&gt;<a class="code" href="../../dc/d8a/structmwi__subscription.html#aee9980d9bea7526cafef97a0672b00cd">aors</a>, aor)) {</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;   }</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(<a class="code" href="../../dd/d5f/serializer_8h.html#a57044062c5e192e675109fa621c1588d">ast_serializer_pool_get</a>(mwi_serializer_pool),</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;         <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9f1ada4bb94ffd586b164affb44f5ef3">serialized_notify</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(mwi_sub))) {</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_sub, -1);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;   }</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;}</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">/*! \brief Create mwi subscriptions and notify */</span></div><div class="line"><a name="l01361"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a9c7c3b20430fcd169df0e9b532822a35"> 1361</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9c7c3b20430fcd169df0e9b532822a35">mwi_contact_changed</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a>)</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;{</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;   <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(contact));</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;   <span class="keywordtype">char</span> *aor = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *unsolicited_mwi;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *solicited_mwi;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;   <span class="keywordflow">if</span> (contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>) {</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;      endpoint = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#ab4cbf7f39957c6802d6421a2eb5b6350">endpoint_name</a>)) {</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;         endpoint = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;endpoint&quot;</span>, contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#ab4cbf7f39957c6802d6421a2eb5b6350">endpoint_name</a>);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      }</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;   }</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;   <span class="keywordflow">if</span> (!endpoint || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">subscription</a>.<a class="code" href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">mwi</a>.<a class="code" href="../../d9/dbd/structast__sip__mwi__configuration.html#a9894add746aaf09d183e44b09aa8cc78">mailboxes</a>)) {</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(endpoint);</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;   }</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;   unsolicited_mwi = <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(mwi_unsolicited);</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;   <span class="keywordflow">if</span> (!unsolicited_mwi) {</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(endpoint);</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;   }</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;   solicited_mwi = <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(mwi_solicited);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(unsolicited_mwi);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;   <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a6ef65f8e0fb16284789ef192d949fb6c">create_unsolicited_mwi_subscriptions</a>(endpoint, 0, 0, unsolicited_mwi, solicited_mwi);</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(unsolicited_mwi);</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(endpoint);</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(solicited_mwi);</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(unsolicited_mwi, -1);</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;   aor = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;<span class="keywordtype">id</span>, <span class="stringliteral">&quot;;@&quot;</span>);</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(unsolicited_mwi, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9b38fe6d8eca53716459a092e141df75">send_contact_notify</a>, aor);</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;}</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">/*! \brief Function called when a contact is updated */</span></div><div class="line"><a name="l01402"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a60fd19b8347428a9b2ad9f702662132c"> 1402</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a60fd19b8347428a9b2ad9f702662132c">mwi_contact_updated</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *<span class="keywordtype">object</span>)</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;{</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;   <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9c7c3b20430fcd169df0e9b532822a35">mwi_contact_changed</a>(<span class="keywordtype">object</span>);</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;}</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment">/*! \brief Function called when a contact is added */</span></div><div class="line"><a name="l01408"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a2e2327e827ce7451bd96574cd3dd093e"> 1408</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a2e2327e827ce7451bd96574cd3dd093e">mwi_contact_added</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *<span class="keywordtype">object</span>)</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;{</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;   <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a9c7c3b20430fcd169df0e9b532822a35">mwi_contact_changed</a>(<span class="keywordtype">object</span>);</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;}</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment">/*! \brief Function called when a contact is deleted */</span></div><div class="line"><a name="l01414"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a0500e782b1f68867e41457613338f472"> 1414</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0500e782b1f68867e41457613338f472">mwi_contact_deleted</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *<span class="keywordtype">object</span>)</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;{</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a> = object;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> *mwi_subs;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a> *<a class="code" href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *found_contact;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *unsolicited_mwi;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;   <span class="keywordflow">if</span> (contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>) {</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      endpoint = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#ab4cbf7f39957c6802d6421a2eb5b6350">endpoint_name</a>)) {</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;         endpoint = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;endpoint&quot;</span>, contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#ab4cbf7f39957c6802d6421a2eb5b6350">endpoint_name</a>);</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      }</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;   }</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;   <span class="keywordflow">if</span> (!endpoint || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">subscription</a>.<a class="code" href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">mwi</a>.<a class="code" href="../../d9/dbd/structast__sip__mwi__configuration.html#a9894add746aaf09d183e44b09aa8cc78">mailboxes</a>)) {</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(endpoint);</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;   }</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;   <span class="comment">/* Check if there is another contact */</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;   found_contact = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a00fd98f03df089bd6aa358f941ae0dcd">ast_sip_location_retrieve_contact_from_aor_list</a>(endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">aors</a>);</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(endpoint);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;   <span class="keywordflow">if</span> (found_contact) {</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(found_contact);</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;   }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;   unsolicited_mwi = <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(mwi_unsolicited);</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;   <span class="keywordflow">if</span> (!unsolicited_mwi) {</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;   }</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(unsolicited_mwi);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;   mwi_subs = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(unsolicited_mwi, contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#ab4cbf7f39957c6802d6421a2eb5b6350">endpoint_name</a>,</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a>);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;   <span class="keywordflow">if</span> (mwi_subs) {</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      <span class="keywordflow">for</span> (; (mwi_sub = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(mwi_subs)); <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(mwi_sub)) {</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;         <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a30833678d2fe25c6b56dfe159b3d281b">unsubscribe</a>(mwi_sub, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      }</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(mwi_subs);</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;   }</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(unsolicited_mwi);</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(unsolicited_mwi, -1);</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;}</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment">/*! \brief Observer for contacts so unsolicited MWI is sent when a contact changes */</span></div><div class="line"><a name="l01463"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a836dd7fc93908139b4a9361e647bd8af"> 1463</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d2/ddb/structast__sorcery__observer.html">ast_sorcery_observer</a> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a836dd7fc93908139b4a9361e647bd8af">mwi_contact_observer</a> = {</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;   .<a class="code" href="../../d2/ddb/structast__sorcery__observer.html#a5aec1751ab8fa9fe7798e9038c9ec7cf">created</a> = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a2e2327e827ce7451bd96574cd3dd093e">mwi_contact_added</a>,</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;   .updated = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a60fd19b8347428a9b2ad9f702662132c">mwi_contact_updated</a>,</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;   .deleted = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0500e782b1f68867e41457613338f472">mwi_contact_deleted</a>,</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;};</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="comment">/*! \brief Task invoked to send initial MWI NOTIFY for unsolicited */</span></div><div class="line"><a name="l01470"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ad8adb683348f63457224d890996747e9"> 1470</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad8adb683348f63457224d890996747e9">send_initial_notify_all</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;{</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *unsolicited_mwi = <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(mwi_unsolicited);</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;   <span class="keywordflow">if</span> (unsolicited_mwi) {</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(unsolicited_mwi, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0d7b02993fcdcf14b5415b98d512fe54">send_notify</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(unsolicited_mwi, -1);</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;   }</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;}</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment">/*! \brief Event callback which fires initial unsolicited MWI NOTIFY messages when we&#39;re fully booted */</span></div><div class="line"><a name="l01483"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a96179ef1aad910a12619dda0c8750ce5"> 1483</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a96179ef1aad910a12619dda0c8750ce5">mwi_startup_event_cb</a>(<span class="keywordtype">void</span> *data, <span class="keyword">struct</span> <a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *<a class="code" href="../../d8/d9e/structmessage.html">message</a>)</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;{</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/de9/structast__json__payload.html">ast_json_payload</a> *payload;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(message) != <a class="code" href="../../db/d45/manager_8h.html#a8ae409b5ff584e42c30edcfe5837d85c">ast_manager_get_generic_type</a>()) {</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;   }</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;   payload = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(message);</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;   type = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(payload-&gt;<a class="code" href="../../d9/de9/structast__json__payload.html#a9cf488298469ae63ef947653d7ff9bab">json</a>, <span class="stringliteral">&quot;type&quot;</span>));</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;   <span class="keywordflow">if</span> (strcmp(type, <span class="stringliteral">&quot;FullyBooted&quot;</span>)) {</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;   }</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;   <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(<a class="code" href="../../dd/d5f/serializer_8h.html#a57044062c5e192e675109fa621c1588d">ast_serializer_pool_get</a>(mwi_serializer_pool),</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad8adb683348f63457224d890996747e9">send_initial_notify_all</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a>(sub);</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;}</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;</div><div class="line"><a name="l01505"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a2244349ff10e2b679104328f8829617a"> 1505</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a2244349ff10e2b679104328f8829617a">global_loaded</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *object_type)</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;{</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a806827c417e6b7d0470f0fe335257f39">default_voicemail_extension</a>);</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;   <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a806827c417e6b7d0470f0fe335257f39">default_voicemail_extension</a> = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a137a9f1a65ca1b7d3be0d55d3a87f74d">ast_sip_get_default_voicemail_extension</a>();</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;   <a class="code" href="../../dd/d5f/serializer_8h.html#a630652ec26cd3d66063fccef05b3240d">ast_serializer_pool_set_alerts</a>(mwi_serializer_pool,</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#ae3f33b363ff46d3a6e05ee63afd45205">ast_sip_get_mwi_tps_queue_high</a>(), <a class="code" href="../../d8/d8c/res__pjsip_8h.html#acacb0a5069465c03171486fe7cea85a5">ast_sip_get_mwi_tps_queue_low</a>());</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;}</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div><div class="line"><a name="l01513"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a0872cb2fc431c02f2b19ff1d58145c2d"> 1513</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/ddb/structast__sorcery__observer.html">ast_sorcery_observer</a> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a0872cb2fc431c02f2b19ff1d58145c2d">global_observer</a> = {</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;   .<a class="code" href="../../d2/ddb/structast__sorcery__observer.html#a1ebad9f5bd6a80f6f666354460b86e0d">loaded</a> = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a2244349ff10e2b679104328f8829617a">global_loaded</a>,</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;};</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ad1982509765f4870f1f63412a53ea668"> 1517</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;{</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d8c/res__pjsip_8h.html#ac45b58ec6aa9a3778c7cdd48457c7b17">ast_sip_get_mwi_disable_initial_unsolicited</a>()) {</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a84a555cca13f36d9a82bd461f8f5a07b">create_mwi_subscriptions</a>();</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;   }</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;}</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div><div class="line"><a name="l01525"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ad09fa931f468002152a3cc2d5ce25eae"> 1525</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;{</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *unsolicited_mwi;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a18d64c360480b458754fc30f781d5011">ast_sorcery_observer_remove</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;global&quot;</span>, &amp;global_observer);</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a18d64c360480b458754fc30f781d5011">ast_sorcery_observer_remove</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;contact&quot;</span>, &amp;mwi_contact_observer);</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;   unsolicited_mwi = <a class="code" href="../../d5/da5/astobj2_8h.html#aadb92410f92a28e16f404b51bc601a80">ao2_global_obj_replace</a>(mwi_unsolicited, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;   <span class="keywordflow">if</span> (unsolicited_mwi) {</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(unsolicited_mwi, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a30833678d2fe25c6b56dfe159b3d281b">unsubscribe</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(unsolicited_mwi, -1);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;   }</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ac0e1cbc7cf050c8b7b8e3a8fee92c50e">ao2_global_obj_release</a>(mwi_solicited);</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d5f/serializer_8h.html#ab24a7208f10fe9bed74475a531f8881e">ast_serializer_pool_destroy</a>(mwi_serializer_pool)) {</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unload incomplete. Try again later\n&quot;</span>);</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;   }</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;   mwi_serializer_pool = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;   <a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a16d299943a24f9857d3e847b83073d5d">ast_sip_unregister_subscription_handler</a>(&amp;mwi_handler);</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a806827c417e6b7d0470f0fe335257f39">default_voicemail_extension</a>);</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;   <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a806827c417e6b7d0470f0fe335257f39">default_voicemail_extension</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;}</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;</div><div class="line"><a name="l01553"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9"> 1553</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;{</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *mwi_container;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/db0/res__pjsip__pubsub_8h.html#a250d91ea4fba33dd520804c8a47e795a">ast_sip_register_subscription_handler</a>(&amp;mwi_handler)) {</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;   }</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;   mwi_serializer_pool = <a class="code" href="../../dd/d5f/serializer_8h.html#a59e92ce84852e313b5e3a0dae1ddba4d">ast_serializer_pool_create</a>(<span class="stringliteral">&quot;pjsip/mwi&quot;</span>,</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aefa0b2df79ef1f606d5b00cd72632834">MWI_SERIALIZER_POOL_SIZE</a>, <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a00b2e65f1281b71eae7dbf27972e99a8">ast_sip_threadpool</a>(), <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a536155006f9be75496538efe377145e6">MAX_UNLOAD_TIMEOUT_TIME</a>);</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;   <span class="keywordflow">if</span> (!mwi_serializer_pool) {</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2878d83e36d91850732bad997524e45e">AST_LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to create MWI serializer pool. The default SIP pool will be used for MWI\n&quot;</span>);</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;   }</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;   mwi_container = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad79eb292f11982dae39f08414819eafd">MWI_BUCKETS</a>,</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad846b31c16befff15082f1dce1b8adad">mwi_sub_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aa6f680355ec58a78ef7a441c5c9ada2c">mwi_sub_cmp</a>);</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;   <span class="keywordflow">if</span> (!mwi_container) {</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>();</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;   }</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3a11e1a1d3e99bed3ea0a7c57a3880d7">ao2_global_obj_replace_unref</a>(mwi_solicited, mwi_container);</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_container, -1);</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;   mwi_container = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad79eb292f11982dae39f08414819eafd">MWI_BUCKETS</a>,</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad846b31c16befff15082f1dce1b8adad">mwi_sub_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#aa6f680355ec58a78ef7a441c5c9ada2c">mwi_sub_cmp</a>);</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;   <span class="keywordflow">if</span> (!mwi_container) {</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>();</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;   }</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3a11e1a1d3e99bed3ea0a7c57a3880d7">ao2_global_obj_replace_unref</a>(mwi_unsolicited, mwi_container);</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(mwi_container, -1);</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a6c1928d47eae1172f236e8ee421c2db4">ast_sorcery_observer_add</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;contact&quot;</span>, &amp;mwi_contact_observer);</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a6c1928d47eae1172f236e8ee421c2db4">ast_sorcery_observer_add</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;global&quot;</span>, &amp;global_observer);</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#ad98ae6e153f53b0c3c40119acc5e5266">ast_sorcery_reload_object</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;global&quot;</span>);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d8c/res__pjsip_8h.html#ac45b58ec6aa9a3778c7cdd48457c7b17">ast_sip_get_mwi_disable_initial_unsolicited</a>()) {</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a84a555cca13f36d9a82bd461f8f5a07b">create_mwi_subscriptions</a>();</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;<a class="code" href="../../d6/dd6/group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a>, <a class="code" href="../../d6/dd6/group__main__options.html#gaf2588453b3a373a770741ad3ce353343ade4cf3231c69af57ad0527bd46244680">AST_OPT_FLAG_FULLY_BOOTED</a>)) {</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;         <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(<a class="code" href="../../dd/d5f/serializer_8h.html#a57044062c5e192e675109fa621c1588d">ast_serializer_pool_get</a>(mwi_serializer_pool),</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;            <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad8adb683348f63457224d890996747e9">send_initial_notify_all</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;         sub = <a class="code" href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a>(<a class="code" href="../../df/d72/group__Group__AMI.html#ga568aa1aff837fc0001279490a6d9b22f">ast_manager_get_topic</a>(), <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a96179ef1aad910a12619dda0c8750ce5">mwi_startup_event_cb</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;         <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(sub, <a class="code" href="../../db/d45/manager_8h.html#a8ae409b5ff584e42c30edcfe5837d85c">ast_manager_get_generic_type</a>());</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;         <a class="code" href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a>(sub, <a class="code" href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a>);</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      }</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;   }</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;   <span class="keywordflow">if</span> (!mwi_serializer_pool) {</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">       * If the mwi serializer pool was unable to be established then the module will</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">       * use the default serializer pool. If this happens prevent manual unloading</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">       * since there would now exist the potential for a crash on unload.</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <a class="code" href="../../d5/d16/module_8h.html#a9967b09817639f2e15c3f074a60b6379">ast_module_shutdown_ref</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;   }</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;}</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<a class="code" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a>(<a class="code" href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a>, <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a>, <span class="stringliteral">&quot;PJSIP MWI resource&quot;</span>,</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;   .support_level = <a class="code" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>,</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;   .load = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;   .unload = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>,</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;   .<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> = <a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>,</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;   .load_pri = <a class="code" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a> + 5,</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;   .requires = <span class="stringliteral">&quot;res_pjsip,res_pjsip_pubsub&quot;</span>,</div><div class="line"><a name="l01622"></a><span class="lineno"><a class="line" href="../../d8/d25/res__pjsip__mwi_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae"> 1622</a></span>&#160;);</div><div class="ttc" id="res__pjsip__mwi_8c_html_a0872cb2fc431c02f2b19ff1d58145c2d"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a0872cb2fc431c02f2b19ff1d58145c2d">global_observer</a></div><div class="ttdeci">static struct ast_sorcery_observer global_observer</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01513">res_pjsip_mwi.c:1513</a></div></div>
<div class="ttc" id="structmwi__stasis__subscription_html_a729610ef7a35f78eae4cf4ed1c1552c7"><div class="ttname"><a href="../../d3/d16/structmwi__stasis__subscription.html#a729610ef7a35f78eae4cf4ed1c1552c7">mwi_stasis_subscription::mwi_subscriber</a></div><div class="ttdeci">struct ast_mwi_subscriber * mwi_subscriber</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00099">res_pjsip_mwi.c:99</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a9632d729a323355beec62acda995cc21"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a9632d729a323355beec62acda995cc21">AST_SIP_MESSAGE_ACCUMULATOR</a></div><div class="ttdeci">#define AST_SIP_MESSAGE_ACCUMULATOR</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00234">res_pjsip_pubsub.h:234</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a4d63fdfe5451ec2248c16a2739190c56"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a></div><div class="ttdeci">static const char type[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00109">chan_ooh323.c:109</a></div></div>
<div class="ttc" id="structast__sip__body_html_a88687b0dd98d5307f1219432b73b8412"><div class="ttname"><a href="../../d5/d80/structast__sip__body.html#a88687b0dd98d5307f1219432b73b8412">ast_sip_body::body_text</a></div><div class="ttdeci">const char * body_text</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02033">res_pjsip.h:2033</a></div></div>
<div class="ttc" id="structnode_html"><div class="ttname"><a href="../../d5/da1/structnode.html">node</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d2b/test__heap_8c_source.html#l00038">test_heap.c:38</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a2e2327e827ce7451bd96574cd3dd093e"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a2e2327e827ce7451bd96574cd3dd093e">mwi_contact_added</a></div><div class="ttdeci">static void mwi_contact_added(const void *object)</div><div class="ttdoc">Function called when a contact is added. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01408">res_pjsip_mwi.c:1408</a></div></div>
<div class="ttc" id="structast__sip__endpoint__subscription__configuration_html_a30a631f5f4f963d1217ba665e97a2a81"><div class="ttname"><a href="../../db/d70/structast__sip__endpoint__subscription__configuration.html#a30a631f5f4f963d1217ba665e97a2a81">ast_sip_endpoint_subscription_configuration::mwi</a></div><div class="ttdeci">struct ast_sip_mwi_configuration mwi</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00608">res_pjsip.h:608</a></div></div>
<div class="ttc" id="structmessage_html"><div class="ttname"><a href="../../d8/d9e/structmessage.html">message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00144">manager.h:144</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ae4ddcfea92f9b095478dc0bc9a0cd117"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ae4ddcfea92f9b095478dc0bc9a0cd117">MWI_TYPE</a></div><div class="ttdeci">#define MWI_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00054">res_pjsip_mwi.c:54</a></div></div>
<div class="ttc" id="structmwi__subscription_html_a54c4d5964f197213bff36430ba6b18dc"><div class="ttname"><a href="../../dc/d8a/structmwi__subscription.html#a54c4d5964f197213bff36430ba6b18dc">mwi_subscription::terminate</a></div><div class="ttdeci">unsigned int terminate</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00129">res_pjsip_mwi.c:129</a></div></div>
<div class="ttc" id="structast__sip__aor_html_a9894add746aaf09d183e44b09aa8cc78"><div class="ttname"><a href="../../d4/d03/structast__sip__aor.html#a9894add746aaf09d183e44b09aa8cc78">ast_sip_aor::mailboxes</a></div><div class="ttdeci">const ast_string_field mailboxes</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00365">res_pjsip.h:365</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="structast__sip__aor_html"><div class="ttname"><a href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a></div><div class="ttdoc">A SIP address of record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00361">res_pjsip.h:361</a></div></div>
<div class="ttc" id="structunsolicited__mwi__data_html_a06eab984618d6a85fadc73dfb41f5c69"><div class="ttname"><a href="../../dd/da0/structunsolicited__mwi__data.html#a06eab984618d6a85fadc73dfb41f5c69">unsolicited_mwi_data::state</a></div><div class="ttdeci">pjsip_evsub_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00367">res_pjsip_mwi.c:367</a></div></div>
<div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a4a6f16128f131ec8feae5dc0f8545b2f"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a4a6f16128f131ec8feae5dc0f8545b2f">ast_sip_for_each_aor</a></div><div class="ttdeci">int ast_sip_for_each_aor(const char *aors, ao2_callback_fn on_aor, void *arg)</div><div class="ttdoc">For every aor in the comma separated aors string call the given &amp;#39;on_aor&amp;#39; handler. ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00684">location.c:684</a></div></div>
<div class="ttc" id="structunsolicited__mwi__data_html_a40d55a4fd17d00c3dfa95e0b1d771da8"><div class="ttname"><a href="../../dd/da0/structunsolicited__mwi__data.html#a40d55a4fd17d00c3dfa95e0b1d771da8">unsolicited_mwi_data::counter</a></div><div class="ttdeci">struct ast_sip_message_accumulator * counter</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00368">res_pjsip_mwi.c:368</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a60fd19b8347428a9b2ad9f702662132c"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a60fd19b8347428a9b2ad9f702662132c">mwi_contact_updated</a></div><div class="ttdeci">static void mwi_contact_updated(const void *object)</div><div class="ttdoc">Function called when a contact is updated. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01402">res_pjsip_mwi.c:1402</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a81489602b194ea87cae6470409bee3b5"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a81489602b194ea87cae6470409bee3b5">ast_sip_subscription_get_serializer</a></div><div class="ttdeci">struct ast_taskprocessor * ast_sip_subscription_get_serializer(struct ast_sip_subscription *sub)</div><div class="ttdoc">Get the serializer for the subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01942">res_pjsip_pubsub.c:1942</a></div></div>
<div class="ttc" id="structunsolicited__mwi__data_html_a45123f0785d20e2f8a0e0da9156bce29"><div class="ttname"><a href="../../dd/da0/structunsolicited__mwi__data.html#a45123f0785d20e2f8a0e0da9156bce29">unsolicited_mwi_data::sub</a></div><div class="ttdeci">struct mwi_subscription * sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00365">res_pjsip_mwi.c:365</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a96179ef1aad910a12619dda0c8750ce5"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a96179ef1aad910a12619dda0c8750ce5">mwi_startup_event_cb</a></div><div class="ttdeci">static void mwi_startup_event_cb(void *data, struct stasis_subscription *sub, struct stasis_message *message)</div><div class="ttdoc">Event callback which fires initial unsolicited MWI NOTIFY messages when we&amp;#39;re fully booted...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01483">res_pjsip_mwi.c:1483</a></div></div>
<div class="ttc" id="module_8h_html_ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15"><div class="ttname"><a href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00121">module.h:121</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_adea5390496e5477192d86f340d512d04"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a></div><div class="ttdeci">void ast_variables_destroy(struct ast_variable *var)</div><div class="ttdoc">Free variable list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l01263">extconf.c:1263</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a2244349ff10e2b679104328f8829617a"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a2244349ff10e2b679104328f8829617a">global_loaded</a></div><div class="ttdeci">static void global_loaded(const char *object_type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01505">res_pjsip_mwi.c:1505</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ac6e8189a57e4a9cfc4eac7a3523781bd"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ac6e8189a57e4a9cfc4eac7a3523781bd">mwi_subscription_mailboxes_str</a></div><div class="ttdeci">static void mwi_subscription_mailboxes_str(struct ao2_container *stasis_subs, struct ast_str **str)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01078">res_pjsip_mwi.c:1078</a></div></div>
<div class="ttc" id="structmwi__subscription_html_ac862c692b98c7abdb1fb8609c40b950c"><div class="ttname"><a href="../../dc/d8a/structmwi__subscription.html#ac862c692b98c7abdb1fb8609c40b950c">mwi_subscription::is_solicited</a></div><div class="ttdeci">unsigned int is_solicited</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00127">res_pjsip_mwi.c:127</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a6ef65f8e0fb16284789ef192d949fb6c"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a6ef65f8e0fb16284789ef192d949fb6c">create_unsolicited_mwi_subscriptions</a></div><div class="ttdeci">static int create_unsolicited_mwi_subscriptions(struct ast_sip_endpoint *endpoint, int recreate, int send_now, struct ao2_container *unsolicited_mwi, struct ao2_container *solicited_mwi)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01188">res_pjsip_mwi.c:1188</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a></div><div class="ttdoc">The arg parameter is a search key, but is not an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01105">astobj2.h:1105</a></div></div>
<div class="ttc" id="utils_8h_html_a00d4c9254c9827d6fa44f17a326744a5"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a></div><div class="ttdeci">#define ast_test_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00063">utils.h:63</a></div></div>
<div class="ttc" id="structast__sip__body__data_html_a35514bc6335d541353cf54c7146e8ce5"><div class="ttname"><a href="../../d1/de8/structast__sip__body__data.html#a35514bc6335d541353cf54c7146e8ce5">ast_sip_body_data::body_type</a></div><div class="ttdeci">const char * body_type</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00241">res_pjsip_pubsub.h:241</a></div></div>
<div class="ttc" id="structast__sip__body__data_html"><div class="ttname"><a href="../../d1/de8/structast__sip__body__data.html">ast_sip_body_data</a></div><div class="ttdoc">Data used to create bodies for NOTIFY/PUBLISH requests. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00239">res_pjsip_pubsub.h:239</a></div></div>
<div class="ttc" id="structast__sip__message__accumulator_html_a4369ae7c984aba22ce6d0e92718f2b29"><div class="ttname"><a href="../../d0/dfb/structast__sip__message__accumulator.html#a4369ae7c984aba22ce6d0e92718f2b29">ast_sip_message_accumulator::old_msgs</a></div><div class="ttdeci">int old_msgs</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4c/res__pjsip__body__generator__types_8h_source.html#l00070">res_pjsip_body_generator_types.h:70</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a923853f5d9fcfbd903dd816327b55451"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a923853f5d9fcfbd903dd816327b55451">mwi_notifier</a></div><div class="ttdeci">static struct ast_sip_notifier mwi_notifier</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00075">res_pjsip_mwi.c:75</a></div></div>
<div class="ttc" id="structast__sip__mwi__configuration_html_a308749bdeaa0c310b2e8ff666748b5d0"><div class="ttname"><a href="../../d9/dbd/structast__sip__mwi__configuration.html#a308749bdeaa0c310b2e8ff666748b5d0">ast_sip_mwi_configuration::voicemail_extension</a></div><div class="ttdeci">char * voicemail_extension</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00596">res_pjsip.h:596</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_aef6c9303305664514600d87be223660b"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#aef6c9303305664514600d87be223660b">MWI_SUBTYPE</a></div><div class="ttdeci">#define MWI_SUBTYPE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00055">res_pjsip_mwi.c:55</a></div></div>
<div class="ttc" id="structast__module__info_html"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html">ast_module_info</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00336">module.h:336</a></div></div>
<div class="ttc" id="stasis_8h_html"><div class="ttname"><a href="../../dd/d79/stasis_8h.html">stasis.h</a></div><div class="ttdoc">Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. </div></div>
<div class="ttc" id="serializer_8h_html_ab24a7208f10fe9bed74475a531f8881e"><div class="ttname"><a href="../../dd/d5f/serializer_8h.html#ab24a7208f10fe9bed74475a531f8881e">ast_serializer_pool_destroy</a></div><div class="ttdeci">int ast_serializer_pool_destroy(struct ast_serializer_pool *pool)</div><div class="ttdoc">Destroy the serializer pool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/serializer_8c_source.html#l00039">serializer.c:39</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="structast__json__payload_html"><div class="ttname"><a href="../../d9/de9/structast__json__payload.html">ast_json_payload</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d05/json_8h_source.html#l01024">json.h:1024</a></div></div>
<div class="ttc" id="astobj2_8h_html_a47857055118a703ae87ea5ebaf4842ed"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a></div><div class="ttdeci">#define ao2_callback(c, flags, cb_fn, arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01716">astobj2.h:1716</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a5f3a63478908fbf1b6415b2101d12a59"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a5f3a63478908fbf1b6415b2101d12a59">add_mwi_datastore</a></div><div class="ttdeci">static int add_mwi_datastore(struct mwi_subscription *sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00640">res_pjsip_mwi.c:640</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_aba456f7d925cf5fcd7ae2160c74cf72d"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#aba456f7d925cf5fcd7ae2160c74cf72d">unsubscribe_stasis</a></div><div class="ttdeci">static int unsubscribe_stasis(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00573">res_pjsip_mwi.c:573</a></div></div>
<div class="ttc" id="res__ari__mailboxes_8c_html_a29d08f8b2448744d75ca9ebc4e218419"><div class="ttname"><a href="../../d0/dd5/res__ari__mailboxes_8c.html#a29d08f8b2448744d75ca9ebc4e218419">mailboxes</a></div><div class="ttdeci">static struct stasis_rest_handlers mailboxes</div><div class="ttdoc">REST handler for /api-docs/mailboxes.json. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd5/res__ari__mailboxes_8c_source.html#l00322">res_ari_mailboxes.c:322</a></div></div>
<div class="ttc" id="structast__variable_html"><div class="ttname"><a href="../../dd/d02/structast__variable.html">ast_variable</a></div><div class="ttdoc">Structure for variables, used for configurations and for channel variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00083">include/asterisk/config.h:83</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="logger_8h_html_a2878d83e36d91850732bad997524e45e"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a2878d83e36d91850732bad997524e45e">AST_LOG_WARNING</a></div><div class="ttdeci">#define AST_LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00279">logger.h:279</a></div></div>
<div class="ttc" id="ast__expr2f_8c_html_a1b0936415a643c88ce543099c10e0d7f"><div class="ttname"><a href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a></div><div class="ttdeci">#define var</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df2/ast__expr2f_8c_source.html#l00614">ast_expr2f.c:614</a></div></div>
<div class="ttc" id="structast__json__payload_html_a9cf488298469ae63ef947653d7ff9bab"><div class="ttname"><a href="../../d9/de9/structast__json__payload.html#a9cf488298469ae63ef947653d7ff9bab">ast_json_payload::json</a></div><div class="ttdeci">struct ast_json * json</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d05/json_8h_source.html#l01025">json.h:1025</a></div></div>
<div class="ttc" id="mwi_8h_html_a4209f1d79f28e693bddcc0b918425c91"><div class="ttname"><a href="../../dc/d33/mwi_8h.html#a4209f1d79f28e693bddcc0b918425c91">ast_mwi_subscriber_subscription</a></div><div class="ttdeci">struct stasis_subscription * ast_mwi_subscriber_subscription(struct ast_mwi_subscriber *sub)</div><div class="ttdoc">Retrieve the stasis MWI topic subscription if available. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00272">mwi.c:272</a></div></div>
<div class="ttc" id="structast__sorcery__observer_html_a5aec1751ab8fa9fe7798e9038c9ec7cf"><div class="ttname"><a href="../../d2/ddb/structast__sorcery__observer.html#a5aec1751ab8fa9fe7798e9038c9ec7cf">ast_sorcery_observer::created</a></div><div class="ttdeci">void(* created)(const void *object)</div><div class="ttdoc">Callback for when an object is created. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00334">sorcery.h:334</a></div></div>
<div class="ttc" id="structstasis__subscription_html"><div class="ttname"><a href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00681">stasis.c:681</a></div></div>
<div class="ttc" id="serializer_8h_html"><div class="ttname"><a href="../../dd/d5f/serializer_8h.html">serializer.h</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html_ad1ba7bbb888c3c7ca9930718877f2485"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html#ad1ba7bbb888c3c7ca9930718877f2485">ast_sip_endpoint::subscription</a></div><div class="ttdeci">struct ast_sip_endpoint_subscription_configuration subscription</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00843">res_pjsip.h:843</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a250d91ea4fba33dd520804c8a47e795a"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a250d91ea4fba33dd520804c8a47e795a">ast_sip_register_subscription_handler</a></div><div class="ttdeci">int ast_sip_register_subscription_handler(struct ast_sip_subscription_handler *handler)</div><div class="ttdoc">Register a subscription handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02777">res_pjsip_pubsub.c:2777</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a></div><div class="ttdoc">Assume that the ao2_container is already locked. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01067">astobj2.h:1067</a></div></div>
<div class="ttc" id="stasis_8h_html_a9356e8a29344ca4eac93088198ccff89"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_message_type(const struct stasis_message *msg)</div><div class="ttdoc">Get the message type for a stasis_message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00187">stasis_message.c:187</a></div></div>
<div class="ttc" id="stasis_8h_html_a52b5393bef89d7781c0d039d6489de23"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a></div><div class="ttdeci">int stasis_subscription_set_filter(struct stasis_subscription *subscription, enum stasis_subscription_message_filter filter)</div><div class="ttdoc">Set the message type filtering level on a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01079">stasis.c:1079</a></div></div>
<div class="ttc" id="structast__datastore__info_html"><div class="ttname"><a href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a></div><div class="ttdoc">Structure for a data store type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00031">datastore.h:31</a></div></div>
<div class="ttc" id="module_8h_html_aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0"><div class="ttname"><a href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00326">module.h:326</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ad09fa931f468002152a3cc2d5ce25eae"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a></div><div class="ttdeci">static int unload_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01525">res_pjsip_mwi.c:1525</a></div></div>
<div class="ttc" id="structevent_html"><div class="ttname"><a href="../../df/d7d/structevent.html">event</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d4d/astman_8c_source.html#l00222">astman.c:222</a></div></div>
<div class="ttc" id="structast__sip__message__accumulator_html"><div class="ttname"><a href="../../d0/dfb/structast__sip__message__accumulator.html">ast_sip_message_accumulator</a></div><div class="ttdoc">Message counter used for message-summary XML bodies. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4c/res__pjsip__body__generator__types_8h_source.html#l00068">res_pjsip_body_generator_types.h:68</a></div></div>
<div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="strings_8h_html_a1088afdd862a49b0fce34ebe02df8ca1"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a></div><div class="ttdeci">int ast_str_append(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Append to a thread local dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01091">strings.h:1091</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_afbd635e5398d075384fb7aae37d869e3"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#afbd635e5398d075384fb7aae37d869e3">mwi_handler</a></div><div class="ttdeci">static struct ast_sip_subscription_handler mwi_handler</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00082">res_pjsip_mwi.c:82</a></div></div>
<div class="ttc" id="astobj2_8h_html_a86d8d6c3c8866ed0a60121da055cd225"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a></div><div class="ttdeci">#define ao2_global_obj_ref(holder)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00925">astobj2.h:925</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad36841ab6daa3997f7ca7047ad2d033a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a></div><div class="ttdeci">void ao2_iterator_destroy(struct ao2_iterator *iter)</div><div class="ttdoc">Destroy a container iterator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00534">astobj2_container.c:534</a></div></div>
<div class="ttc" id="sorcery_8h_html_a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a></div><div class="ttdoc">Return all matching objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00120">sorcery.h:120</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a7d8287379cde5b4645753f3b4c10f1a7"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a7d8287379cde5b4645753f3b4c10f1a7">mwi_ds_destroy</a></div><div class="ttdeci">static void mwi_ds_destroy(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00629">res_pjsip_mwi.c:629</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a2d7ed3f8785ad9d9aa3fc090d983c45d"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a2d7ed3f8785ad9d9aa3fc090d983c45d">ast_sip_subscription_get_resource_name</a></div><div class="ttdeci">const char * ast_sip_subscription_get_resource_name(struct ast_sip_subscription *sub)</div><div class="ttdoc">Get the name of the subscribed resource. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02596">res_pjsip_pubsub.c:2596</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a404837089a8a08b9f341f2ccea7128ef"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a404837089a8a08b9f341f2ccea7128ef">ast_sip_location_retrieve_aor_contacts</a></div><div class="ttdeci">struct ao2_container * ast_sip_location_retrieve_aor_contacts(const struct ast_sip_aor *aor)</div><div class="ttdoc">Retrieve all contacts currently available for an AOR. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00247">location.c:247</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="astobj2_8h_html_a7ce8563daf84a18540a86504d165b444"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a7ce8563daf84a18540a86504d165b444">ao2_link_flags</a></div><div class="ttdeci">#define ao2_link_flags(container, obj, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01572">astobj2.h:1572</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="structast__datastore_html"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html">ast_datastore</a></div><div class="ttdoc">Structure for a data store object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00068">datastore.h:68</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a9745c44b16328b58e6058be6766250b2"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a9745c44b16328b58e6058be6766250b2">mwi_validate_for_aor</a></div><div class="ttdeci">static int mwi_validate_for_aor(void *obj, void *arg, int flags)</div><div class="ttdoc">Determine if an endpoint is a candidate to be able to subscribe for MWI. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00844">res_pjsip_mwi.c:844</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a53cdb34a33e982a9c71dc95c3df60e21"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a53cdb34a33e982a9c71dc95c3df60e21">send_unsolicited_mwi_notify_to_contact</a></div><div class="ttdeci">static int send_unsolicited_mwi_notify_to_contact(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00371">res_pjsip_mwi.c:371</a></div></div>
<div class="ttc" id="app__jack_8c_html_af25d6dc49269fa2003ac7c7fa6f13915"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></div><div class="ttdeci">const char * str</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00147">app_jack.c:147</a></div></div>
<div class="ttc" id="mwi_8h_html_ae56e2e8831cc3919b5d92bad99786572"><div class="ttname"><a href="../../dc/d33/mwi_8h.html#ae56e2e8831cc3919b5d92bad99786572">ast_mwi_subscriber_data</a></div><div class="ttdeci">struct ast_mwi_state * ast_mwi_subscriber_data(struct ast_mwi_subscriber *sub)</div><div class="ttdoc">Retrieves the state data object associated with the MWI subscriber. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00264">mwi.c:264</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__sip__mwi__configuration_html_a9894add746aaf09d183e44b09aa8cc78"><div class="ttname"><a href="../../d9/dbd/structast__sip__mwi__configuration.html#a9894add746aaf09d183e44b09aa8cc78">ast_sip_mwi_configuration::mailboxes</a></div><div class="ttdeci">const ast_string_field mailboxes</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00588">res_pjsip.h:588</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a00b2e65f1281b71eae7dbf27972e99a8"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a00b2e65f1281b71eae7dbf27972e99a8">ast_sip_threadpool</a></div><div class="ttdeci">struct ast_threadpool * ast_sip_threadpool(void)</div><div class="ttdoc">Retrieve the SIP threadpool object. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05630">res_pjsip.c:5630</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ad1982509765f4870f1f63412a53ea668"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a></div><div class="ttdeci">static int reload(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01517">res_pjsip_mwi.c:1517</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a3095f6b1db2074fd9f8fd709747d1a99"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a3095f6b1db2074fd9f8fd709747d1a99">send_mwi_notify</a></div><div class="ttdeci">static void send_mwi_notify(struct mwi_subscription *sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00538">res_pjsip_mwi.c:538</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a0500e782b1f68867e41457613338f472"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a0500e782b1f68867e41457613338f472">mwi_contact_deleted</a></div><div class="ttdeci">static void mwi_contact_deleted(const void *object)</div><div class="ttdoc">Function called when a contact is deleted. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01414">res_pjsip_mwi.c:1414</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a085df8e51809d774882fb8b22c53c5e2"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a085df8e51809d774882fb8b22c53c5e2">mwi_subscription_destructor</a></div><div class="ttdeci">static void mwi_subscription_destructor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00219">res_pjsip_mwi.c:219</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a41fb33a1027944b6705b73648b6d9a5d"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a41fb33a1027944b6705b73648b6d9a5d">mwi_on_aor</a></div><div class="ttdeci">static int mwi_on_aor(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00889">res_pjsip_mwi.c:889</a></div></div>
<div class="ttc" id="structmwi__subscription_html_a165beda137405c390b32809ecac9b6c0"><div class="ttname"><a href="../../dc/d8a/structmwi__subscription.html#a165beda137405c390b32809ecac9b6c0">mwi_subscription::id</a></div><div class="ttdeci">char id[1]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00134">res_pjsip_mwi.c:134</a></div></div>
<div class="ttc" id="structast__mwi__subscriber_html"><div class="ttname"><a href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00219">mwi.c:219</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ac3452fce158d1f1362470481c54aae5a"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ac3452fce158d1f1362470481c54aae5a">mwi_stasis_subscription_alloc</a></div><div class="ttdeci">static struct mwi_stasis_subscription * mwi_stasis_subscription_alloc(const char *mailbox, struct mwi_subscription *mwi_sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00140">res_pjsip_mwi.c:140</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01043">astobj2.h:1043</a></div></div>
<div class="ttc" id="structmwi__subscription_html_acf0e6eca45606c272e5589c214736320"><div class="ttname"><a href="../../dc/d8a/structmwi__subscription.html#acf0e6eca45606c272e5589c214736320">mwi_subscription::stasis_subs</a></div><div class="ttdeci">struct ao2_container * stasis_subs</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00121">res_pjsip_mwi.c:121</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a9302fd362f9d52147d928c5bc4740433"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a9302fd362f9d52147d928c5bc4740433">ast_sip_send_request</a></div><div class="ttdeci">int ast_sip_send_request(pjsip_tx_data *tdata, struct pjsip_dialog *dlg, struct ast_sip_endpoint *endpoint, void *token, void(*callback)(void *token, pjsip_event *e))</div><div class="ttdoc">General purpose method for sending a SIP request. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05034">res_pjsip.c:5034</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a9953876c16c732791945ec93d22bfe3c"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a9953876c16c732791945ec93d22bfe3c">find_aor_for_resource</a></div><div class="ttdeci">static struct ast_sip_aor * find_aor_for_resource(struct ast_sip_endpoint *endpoint, const char *resource)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00450">res_pjsip_mwi.c:450</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ad744191b69a79ad9d0264b6605e589c7"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ad744191b69a79ad9d0264b6605e589c7">AO2_GLOBAL_OBJ_STATIC</a></div><div class="ttdeci">AO2_GLOBAL_OBJ_STATIC(mwi_unsolicited)</div></div>
<div class="ttc" id="structast__sip__aor_html_a308749bdeaa0c310b2e8ff666748b5d0"><div class="ttname"><a href="../../d4/d03/structast__sip__aor.html#a308749bdeaa0c310b2e8ff666748b5d0">ast_sip_aor::voicemail_extension</a></div><div class="ttdeci">char * voicemail_extension</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00389">res_pjsip.h:389</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="sorcery_8h_html_a100106a82d72aa59a66513ef3ad161c8"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a></div><div class="ttdeci">void * ast_sorcery_retrieve_by_id(const struct ast_sorcery *sorcery, const char *type, const char *id)</div><div class="ttdoc">Retrieve an object using its unique identifier. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01853">sorcery.c:1853</a></div></div>
<div class="ttc" id="structast__sip__contact_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">ast_sip_contact::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00313">res_pjsip.h:313</a></div></div>
<div class="ttc" id="astobj2_8h_html_ac438c3fcd3150481fad38689fd813a15"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a></div><div class="ttdeci">#define ao2_bump(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00491">astobj2.h:491</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ada97d04fc8187c3dbf625dfa8567db41"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ada97d04fc8187c3dbf625dfa8567db41">MWI_DATASTORE</a></div><div class="ttdeci">#define MWI_DATASTORE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00057">res_pjsip_mwi.c:57</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ae3f33b363ff46d3a6e05ee63afd45205"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ae3f33b363ff46d3a6e05ee63afd45205">ast_sip_get_mwi_tps_queue_high</a></div><div class="ttdeci">unsigned int ast_sip_get_mwi_tps_queue_high(void)</div><div class="ttdoc">Retrieve the global MWI taskprocessor high water alert trigger level. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dfd/config__global_8c_source.html#l00402">config_global.c:402</a></div></div>
<div class="ttc" id="structmwi__stasis__subscription_html_a9e7fdba4a571b4961a638ec075aab72f"><div class="ttname"><a href="../../d3/d16/structmwi__stasis__subscription.html#a9e7fdba4a571b4961a638ec075aab72f">mwi_stasis_subscription::mailbox</a></div><div class="ttdeci">char mailbox[1]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00101">res_pjsip_mwi.c:101</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_acacb0a5069465c03171486fe7cea85a5"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#acacb0a5069465c03171486fe7cea85a5">ast_sip_get_mwi_tps_queue_low</a></div><div class="ttdeci">int ast_sip_get_mwi_tps_queue_low(void)</div><div class="ttdoc">Retrieve the global MWI taskprocessor low water clear alert level. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dfd/config__global_8c_source.html#l00417">config_global.c:417</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a79792c0d3a54f779754479075e3c80b3"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a79792c0d3a54f779754479075e3c80b3">ast_sip_subscription_get_sip_uri</a></div><div class="ttdeci">pjsip_sip_uri * ast_sip_subscription_get_sip_uri(struct ast_sip_subscription *sub)</div><div class="ttdoc">Retrieve the local sip uri for this subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02573">res_pjsip_pubsub.c:2573</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="manager_8h_html_a8ae409b5ff584e42c30edcfe5837d85c"><div class="ttname"><a href="../../db/d45/manager_8h.html#a8ae409b5ff584e42c30edcfe5837d85c">ast_manager_get_generic_type</a></div><div class="ttdeci">struct stasis_message_type * ast_manager_get_generic_type(void)</div><div class="ttdoc">Get the stasis_message_type for generic messages. </div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a232abb963bc086f5a0f60764c745b2bb"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a232abb963bc086f5a0f60764c745b2bb">stasis_sub_hash</a></div><div class="ttdeci">static int stasis_sub_hash(const void *obj, const int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00172">res_pjsip_mwi.c:172</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ac8f5c2b8af48e5a0c90c4e89597bfb76"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ac8f5c2b8af48e5a0c90c4e89597bfb76">stasis_sub_cmp</a></div><div class="ttdeci">static int stasis_sub_cmp(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00192">res_pjsip_mwi.c:192</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_aa6f680355ec58a78ef7a441c5c9ada2c"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#aa6f680355ec58a78ef7a441c5c9ada2c">mwi_sub_cmp</a></div><div class="ttdeci">static int mwi_sub_cmp(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00299">res_pjsip_mwi.c:299</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20">OBJ_SEARCH_PARTIAL_KEY</a></div><div class="ttdoc">The arg parameter is a partial search key similar to OBJ_SEARCH_KEY. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01120">astobj2.h:1120</a></div></div>
<div class="ttc" id="structast__sip__contact_html_ab4cbf7f39957c6802d6421a2eb5b6350"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#ab4cbf7f39957c6802d6421a2eb5b6350">ast_sip_contact::endpoint_name</a></div><div class="ttdeci">const ast_string_field endpoint_name</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00303">res_pjsip.h:303</a></div></div>
<div class="ttc" id="structast__module__info_html_a1aff0615d43e1dfa5c72c1c7d1c6d709"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">ast_module_info::self</a></div><div class="ttdeci">struct ast_module * self</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00342">module.h:342</a></div></div>
<div class="ttc" id="structast__serializer__pool_html"><div class="ttname"><a href="../../d0/d08/structast__serializer__pool.html">ast_serializer_pool</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/serializer_8c_source.html#l00028">serializer.c:28</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00317">module.h:317</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a41512cbe01e475968618fcb5631bb1b0"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a41512cbe01e475968618fcb5631bb1b0">ast_sip_pubsub_generate_body_content</a></div><div class="ttdeci">int ast_sip_pubsub_generate_body_content(const char *content_type, const char *content_subtype, struct ast_sip_body_data *data, struct ast_str **str)</div><div class="ttdoc">Generate body content for a PUBLISH or NOTIFY. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03519">res_pjsip_pubsub.c:3519</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a9a14851d1f88b087df7237ec180de52e"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a9a14851d1f88b087df7237ec180de52e">ast_sip_add_body</a></div><div class="ttdeci">int ast_sip_add_body(pjsip_tx_data *tdata, const struct ast_sip_body *body)</div><div class="ttdoc">Add a body to an outbound SIP message. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05091">res_pjsip.c:5091</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="structast__sip__body_html_a763fd8db6bba8fbbbc113ca0d61c47c2"><div class="ttname"><a href="../../d5/d80/structast__sip__body.html#a763fd8db6bba8fbbbc113ca0d61c47c2">ast_sip_body::type</a></div><div class="ttdeci">const char * type</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02029">res_pjsip.h:2029</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a536155006f9be75496538efe377145e6"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a536155006f9be75496538efe377145e6">MAX_UNLOAD_TIMEOUT_TIME</a></div><div class="ttdeci">#define MAX_UNLOAD_TIMEOUT_TIME</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00063">res_pjsip_mwi.c:63</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a5c3c5d7218e0c2d24c13558dbb3d6f40"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a5c3c5d7218e0c2d24c13558dbb3d6f40">has_mwi_subscription</a></div><div class="ttdeci">static int has_mwi_subscription(struct ao2_container *container, struct ast_sip_endpoint *endpoint, const char *mailbox, struct mwi_subscription **mwi_sub, struct mwi_stasis_subscription **mwi_stasis)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00682">res_pjsip_mwi.c:682</a></div></div>
<div class="ttc" id="astobj2_8h_html"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html">astobj2.h</a></div></div>
<div class="ttc" id="structast__sip__mwi__configuration_html_aeaf7643dcb3498b22a91f2d5830f6839"><div class="ttname"><a href="../../d9/dbd/structast__sip__mwi__configuration.html#aeaf7643dcb3498b22a91f2d5830f6839">ast_sip_mwi_configuration::subscribe_replaces_unsolicited</a></div><div class="ttdeci">unsigned int subscribe_replaces_unsolicited</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00594">res_pjsip.h:594</a></div></div>
<div class="ttc" id="strings_8h_html_ac92713b8d07a45720b2664be70810e55"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a></div><div class="ttdeci">char * ast_strip(char *s)</div><div class="ttdoc">Strip leading/trailing whitespace from a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00219">strings.h:219</a></div></div>
<div class="ttc" id="structmwi__subscription_html_a3fbb0a7f6bfd1ea3a8f0230fea6be906"><div class="ttname"><a href="../../dc/d8a/structmwi__subscription.html#a3fbb0a7f6bfd1ea3a8f0230fea6be906">mwi_subscription::sip_sub</a></div><div class="ttdeci">struct ast_sip_subscription * sip_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00123">res_pjsip_mwi.c:123</a></div></div>
<div class="ttc" id="main_2endpoints_8c_html_a0b6312c44448ff7ed80ac99b3077e438"><div class="ttname"><a href="../../d7/d4b/main_2endpoints_8c.html#a0b6312c44448ff7ed80ac99b3077e438">endpoints</a></div><div class="ttdeci">static struct ao2_container * endpoints</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4b/main_2endpoints_8c_source.html#l00050">main/endpoints.c:50</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a71c256db2fb46798ee18ef0321e0b695"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a71c256db2fb46798ee18ef0321e0b695">mwi_ds_info</a></div><div class="ttdeci">static struct ast_datastore_info mwi_ds_info</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00636">res_pjsip_mwi.c:636</a></div></div>
<div class="ttc" id="structast__datastore__info_html_afdad821535486a599c1df88ef7be69bb"><div class="ttname"><a href="../../d9/dfb/structast__datastore__info.html#afdad821535486a599c1df88ef7be69bb">ast_datastore_info::destroy</a></div><div class="ttdeci">void(* destroy)(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00034">datastore.h:34</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga4369ae7c984aba22ce6d0e92718f2b29"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga4369ae7c984aba22ce6d0e92718f2b29">ast_mwi_state::old_msgs</a></div><div class="ttdeci">int old_msgs</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00462">mwi.h:462</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a137a9f1a65ca1b7d3be0d55d3a87f74d"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a137a9f1a65ca1b7d3be0d55d3a87f74d">ast_sip_get_default_voicemail_extension</a></div><div class="ttdeci">char * ast_sip_get_default_voicemail_extension(void)</div><div class="ttdoc">Retrieve the default voicemail extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dfd/config__global_8c_source.html#l00263">config_global.c:263</a></div></div>
<div class="ttc" id="json_8h_html_a6772fcee88746a9d4f6ec6f240b76dd0"><div class="ttname"><a href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a></div><div class="ttdeci">const char * ast_json_string_get(const struct ast_json *string)</div><div class="ttdoc">Get the value of a JSON string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00273">json.c:273</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ac45b58ec6aa9a3778c7cdd48457c7b17"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ac45b58ec6aa9a3778c7cdd48457c7b17">ast_sip_get_mwi_disable_initial_unsolicited</a></div><div class="ttdeci">unsigned int ast_sip_get_mwi_disable_initial_unsolicited(void)</div><div class="ttdoc">Retrieve the global setting &amp;#39;disable sending unsolicited mwi on startup&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dfd/config__global_8c_source.html#l00432">config_global.c:432</a></div></div>
<div class="ttc" id="res__fax_8c_html_a7ea220e4d14b05876af4430e9832ce47"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">container</a></div><div class="ttdeci">struct ao2_container * container</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00502">res_fax.c:502</a></div></div>
<div class="ttc" id="structast__sip__subscription__handler_html"><div class="ttname"><a href="../../d8/d6c/structast__sip__subscription__handler.html">ast_sip_subscription_handler</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00314">res_pjsip_pubsub.h:314</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a54e3ec951336bb4eddb29532efb45df7"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a54e3ec951336bb4eddb29532efb45df7">mwi_create_subscription</a></div><div class="ttdeci">static struct mwi_subscription * mwi_create_subscription(struct ast_sip_endpoint *endpoint, struct ast_sip_subscription *sip_sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00920">res_pjsip_mwi.c:920</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a66581086d34dfe7ea86b0644bacef239"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a66581086d34dfe7ea86b0644bacef239">ast_variable_new</a></div><div class="ttdeci">#define ast_variable_new(name, value, filename)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00914">include/asterisk/config.h:914</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a></div><div class="ttdoc">An entity with which Asterisk communicates. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00812">res_pjsip.h:812</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a00fd98f03df089bd6aa358f941ae0dcd"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a00fd98f03df089bd6aa358f941ae0dcd">ast_sip_location_retrieve_contact_from_aor_list</a></div><div class="ttdeci">struct ast_sip_contact * ast_sip_location_retrieve_contact_from_aor_list(const char *aor_list)</div><div class="ttdoc">Retrieve the first bound contact from a list of AORs. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00304">location.c:304</a></div></div>
<div class="ttc" id="sorcery_8h_html_a6c1928d47eae1172f236e8ee421c2db4"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a6c1928d47eae1172f236e8ee421c2db4">ast_sorcery_observer_add</a></div><div class="ttdeci">int ast_sorcery_observer_add(const struct ast_sorcery *sorcery, const char *type, const struct ast_sorcery_observer *callbacks)</div><div class="ttdoc">Add an observer to a specific object type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02386">sorcery.c:2386</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a3bb393c5880be9a3a3ddeccfc998452b"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a3bb393c5880be9a3a3ddeccfc998452b">ast_sip_subscription_destroy</a></div><div class="ttdeci">void ast_sip_subscription_destroy(struct ast_sip_subscription *sub)</div><div class="ttdoc">Alert the pubsub core that the subscription is ready for destruction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01389">res_pjsip_pubsub.c:1389</a></div></div>
<div class="ttc" id="structast__sip__subscription_html"><div class="ttname"><a href="../../db/d02/structast__sip__subscription.html">ast_sip_subscription</a></div><div class="ttdoc">Structure representing a &quot;virtual&quot; SIP subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l00477">res_pjsip_pubsub.c:477</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a434c2d85dbd10a9453f6d409809330d5"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a434c2d85dbd10a9453f6d409809330d5">ast_sip_location_retrieve_aor</a></div><div class="ttdeci">struct ast_sip_aor * ast_sip_location_retrieve_aor(const char *aor_name)</div><div class="ttdoc">Retrieve a named AOR. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00147">location.c:147</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ac3382bf6da54c56b37069bd76bbdf4f9"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a></div><div class="ttdeci">static int load_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01553">res_pjsip_mwi.c:1553</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a4fb7a664ab7adcfedfb757661999a824"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a4fb7a664ab7adcfedfb757661999a824">allow_and_or_replace_unsolicited</a></div><div class="ttdeci">static int allow_and_or_replace_unsolicited(struct ast_sip_endpoint *endpoint, const char *mailbox, struct ao2_container *unsolicited_mwi)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00729">res_pjsip_mwi.c:729</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html">res_pjsip_pubsub.h</a></div></div>
<div class="ttc" id="astobj2_8h_html_aefc16f8aa9087cbc5c55c70cf1dd41b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a></div><div class="ttdeci">#define ao2_container_alloc_hash(ao2_options, container_options, n_buckets, hash_fn, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01310">astobj2.h:1310</a></div></div>
<div class="ttc" id="structast__sip__mwi__configuration_html_ab65d43f5f6ba330d99f5552aa3821817"><div class="ttname"><a href="../../d9/dbd/structast__sip__mwi__configuration.html#ab65d43f5f6ba330d99f5552aa3821817">ast_sip_mwi_configuration::aggregate</a></div><div class="ttdeci">unsigned int aggregate</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00592">res_pjsip.h:592</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ad846b31c16befff15082f1dce1b8adad"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ad846b31c16befff15082f1dce1b8adad">mwi_sub_hash</a></div><div class="ttdeci">static int mwi_sub_hash(const void *obj, const int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00279">res_pjsip_mwi.c:279</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a9f1ada4bb94ffd586b164affb44f5ef3"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a9f1ada4bb94ffd586b164affb44f5ef3">serialized_notify</a></div><div class="ttdeci">static int serialized_notify(void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01118">res_pjsip_mwi.c:1118</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga4f0a0629fa2ca084812772356d8e3565"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a></div><div class="ttdeci">int ast_sip_push_task(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Pushes a task to SIP servants. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05138">res_pjsip.c:5138</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a0d7b02993fcdcf14b5415b98d512fe54"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a0d7b02993fcdcf14b5415b98d512fe54">send_notify</a></div><div class="ttdeci">static int send_notify(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01142">res_pjsip_mwi.c:1142</a></div></div>
<div class="ttc" id="structast__sorcery__observer_html"><div class="ttname"><a href="../../d2/ddb/structast__sorcery__observer.html">ast_sorcery_observer</a></div><div class="ttdoc">Interface for a sorcery object type observer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00332">sorcery.h:332</a></div></div>
<div class="ttc" id="astobj2_8h_html_ac0e1cbc7cf050c8b7b8e3a8fee92c50e"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ac0e1cbc7cf050c8b7b8e3a8fee92c50e">ao2_global_obj_release</a></div><div class="ttdeci">#define ao2_global_obj_release(holder)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00865">astobj2.h:865</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a806827c417e6b7d0470f0fe335257f39"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a806827c417e6b7d0470f0fe335257f39">default_voicemail_extension</a></div><div class="ttdeci">static char * default_voicemail_extension</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00049">res_pjsip_mwi.c:49</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_acbc2036fde96cf715b5fdd3ab54da666"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#acbc2036fde96cf715b5fdd3ab54da666">STASIS_BUCKETS</a></div><div class="ttdeci">#define STASIS_BUCKETS</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00051">res_pjsip_mwi.c:51</a></div></div>
<div class="ttc" id="module_8h_html_a9967b09817639f2e15c3f074a60b6379"><div class="ttname"><a href="../../d5/d16/module_8h.html#a9967b09817639f2e15c3f074a60b6379">ast_module_shutdown_ref</a></div><div class="ttdeci">#define ast_module_shutdown_ref(mod)</div><div class="ttdoc">Prevent unload of the module before shutdown. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00464">module.h:464</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a5d3ad3f5c55c026e22e1103686227ae0"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a5d3ad3f5c55c026e22e1103686227ae0">ast_sip_subscription_alloc_datastore</a></div><div class="ttdeci">struct ast_datastore * ast_sip_subscription_alloc_datastore(const struct ast_datastore_info *info, const char *uid)</div><div class="ttdoc">Alternative for ast_datastore_alloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02624">res_pjsip_pubsub.c:2624</a></div></div>
<div class="ttc" id="astobj2_8h_html_a63fd831fe48aed32d3ef992ad8e45293"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a63fd831fe48aed32d3ef992ad8e45293">ao2_callback_data</a></div><div class="ttdeci">#define ao2_callback_data(container, flags, cb_fn, arg, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01743">astobj2.h:1743</a></div></div>
<div class="ttc" id="structast__sip__contact_html"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a></div><div class="ttdoc">Contact associated with an address of record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00281">res_pjsip.h:281</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a07b38eb1813c6f4b246826f31ef723cf"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a07b38eb1813c6f4b246826f31ef723cf">send_unsolicited_mwi_notify</a></div><div class="ttdeci">static void send_unsolicited_mwi_notify(struct mwi_subscription *sub, struct ast_sip_message_accumulator *counter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00490">res_pjsip_mwi.c:490</a></div></div>
<div class="ttc" id="stasis_8h_html_a597f7a30fe616c9f083a93ed168955ed"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a></div><div class="ttdeci">#define stasis_subscribe_pool(topic, callback, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00682">stasis.h:682</a></div></div>
<div class="ttc" id="structast__sip__body_html_abb4ae60bbcbce3616fdd7d4238869c91"><div class="ttname"><a href="../../d5/d80/structast__sip__body.html#abb4ae60bbcbce3616fdd7d4238869c91">ast_sip_body::subtype</a></div><div class="ttdeci">const char * subtype</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02031">res_pjsip.h:2031</a></div></div>
<div class="ttc" id="res__pjsip__body__generator__types_8h_html"><div class="ttname"><a href="../../db/d4c/res__pjsip__body__generator__types_8h.html">res_pjsip_body_generator_types.h</a></div></div>
<div class="ttc" id="stasis_8h_html_a3498301077e2005383f0d261c471388b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a></div><div class="ttdeci">struct stasis_subscription * stasis_unsubscribe(struct stasis_subscription *subscription)</div><div class="ttdoc">Cancel a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00973">stasis.c:973</a></div></div>
<div class="ttc" id="astobj2_8h_html_a17990ea630db7dbd1252ef0132133a2b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a></div><div class="ttdeci">#define ao2_iterator_next(iter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01933">astobj2.h:1933</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a3881b0a18f4862d307926519783a3471"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a3881b0a18f4862d307926519783a3471">set_voicemail_extension</a></div><div class="ttdeci">static void set_voicemail_extension(pj_pool_t *pool, pjsip_sip_uri *local_uri, struct ast_sip_message_accumulator *counter, const char *voicemail_extension)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00345">res_pjsip_mwi.c:345</a></div></div>
<div class="ttc" id="structast__sip__subscription__handler_html_aeccf279e6fca0e5f8536fdf76c838728"><div class="ttname"><a href="../../d8/d6c/structast__sip__subscription__handler.html#aeccf279e6fca0e5f8536fdf76c838728">ast_sip_subscription_handler::event_name</a></div><div class="ttdeci">const char * event_name</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00316">res_pjsip_pubsub.h:316</a></div></div>
<div class="ttc" id="stasis_8h_html_a839350445aaa51cedf31f6daec933ee0"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a839350445aaa51cedf31f6daec933ee0">stasis_subscription_final_message</a></div><div class="ttdeci">int stasis_subscription_final_message(struct stasis_subscription *sub, struct stasis_message *msg)</div><div class="ttdoc">Determine whether a message is the final message to be received on a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01176">stasis.c:1176</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a905a945079446eca1922dd17536896f3"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a905a945079446eca1922dd17536896f3">mwi_get_notify_data</a></div><div class="ttdeci">static void * mwi_get_notify_data(struct ast_sip_subscription *sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01042">res_pjsip_mwi.c:1042</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a0dc2ec71240257862dd8cd88aab7354b"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a0dc2ec71240257862dd8cd88aab7354b">mwi_to_ami</a></div><div class="ttdeci">static void mwi_to_ami(struct ast_sip_subscription *sub, struct ast_str **buf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01097">res_pjsip_mwi.c:1097</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a836dd7fc93908139b4a9361e647bd8af"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a836dd7fc93908139b4a9361e647bd8af">mwi_contact_observer</a></div><div class="ttdeci">static const struct ast_sorcery_observer mwi_contact_observer</div><div class="ttdoc">Observer for contacts so unsolicited MWI is sent when a contact changes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01463">res_pjsip_mwi.c:1463</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_afdf1bb41c7cc194a8305f4102d529748"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#afdf1bb41c7cc194a8305f4102d529748">mwi_subscribe_single</a></div><div class="ttdeci">static struct mwi_subscription * mwi_subscribe_single(struct ast_sip_endpoint *endpoint, struct ast_sip_subscription *sip_sub, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00939">res_pjsip_mwi.c:939</a></div></div>
<div class="ttc" id="structserializer_html"><div class="ttname"><a href="../../d9/d47/structserializer.html">serializer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01315">threadpool.c:1315</a></div></div>
<div class="ttc" id="mwi_8h_html_acf8d474c4029156d9c49a4ddea50d01b"><div class="ttname"><a href="../../dc/d33/mwi_8h.html#acf8d474c4029156d9c49a4ddea50d01b">ast_mwi_unsubscribe_and_join</a></div><div class="ttdeci">void * ast_mwi_unsubscribe_and_join(struct ast_mwi_subscriber *sub)</div><div class="ttdoc">Unsubscribe from the stasis topic, block until the final message is received, and then unsubscribe fr...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00254">mwi.c:254</a></div></div>
<div class="ttc" id="structmwi__subscription_html"><div class="ttname"><a href="../../dc/d8a/structmwi__subscription.html">mwi_subscription</a></div><div class="ttdoc">A subscription for MWI. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00116">res_pjsip_mwi.c:116</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a16d299943a24f9857d3e847b83073d5d"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a16d299943a24f9857d3e847b83073d5d">ast_sip_unregister_subscription_handler</a></div><div class="ttdeci">void ast_sip_unregister_subscription_handler(struct ast_sip_subscription_handler *handler)</div><div class="ttdoc">Unregister a subscription handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02810">res_pjsip_pubsub.c:2810</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_aefa0b2df79ef1f606d5b00cd72632834"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#aefa0b2df79ef1f606d5b00cd72632834">MWI_SERIALIZER_POOL_SIZE</a></div><div class="ttdeci">#define MWI_SERIALIZER_POOL_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00060">res_pjsip_mwi.c:60</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a7638502d402f3253031f7975f21c86d8"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a7638502d402f3253031f7975f21c86d8">mwi_subscription_established</a></div><div class="ttdeci">static int mwi_subscription_established(struct ast_sip_subscription *sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01005">res_pjsip_mwi.c:1005</a></div></div>
<div class="ttc" id="structast__sip__message__accumulator_html_a70de9f16a229e2c5bf1a973372949d3e"><div class="ttname"><a href="../../d0/dfb/structast__sip__message__accumulator.html#a70de9f16a229e2c5bf1a973372949d3e">ast_sip_message_accumulator::new_msgs</a></div><div class="ttdeci">int new_msgs</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4c/res__pjsip__body__generator__types_8h_source.html#l00072">res_pjsip_body_generator_types.h:72</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaf226cf2d1a4dbbbf220521d58c05ac0f"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a></div><div class="ttdeci">struct stasis_message_type * ast_mwi_state_type(void)</div><div class="ttdoc">Get the Stasis Message Bus API message type for MWI messages. </div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a80204d074b73e3cc135868e141dabc61"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a80204d074b73e3cc135868e141dabc61">mwi_subscription_alloc</a></div><div class="ttdeci">static struct mwi_subscription * mwi_subscription_alloc(struct ast_sip_endpoint *endpoint, unsigned int is_solicited, struct ast_sip_subscription *sip_sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00231">res_pjsip_mwi.c:231</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="taskprocessor_8h_html"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html">taskprocessor.h</a></div><div class="ttdoc">An API for managing task processing threads that can be shared across modules. </div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a30833678d2fe25c6b56dfe159b3d281b"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a30833678d2fe25c6b56dfe159b3d281b">unsubscribe</a></div><div class="ttdeci">static int unsubscribe(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01292">res_pjsip_mwi.c:1292</a></div></div>
<div class="ttc" id="structstate_html"><div class="ttname"><a href="../../d4/d88/structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l00158">localtime.c:158</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a5ad2231cd4e17cd5a713f0c7cea20da4"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a5ad2231cd4e17cd5a713f0c7cea20da4">ast_sip_subscription_get_datastore</a></div><div class="ttdeci">struct ast_datastore * ast_sip_subscription_get_datastore(struct ast_sip_subscription *subscription, const char *name)</div><div class="ttdoc">Retrieve a subscription datastore. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02634">res_pjsip_pubsub.c:2634</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a66f4e76926c44414b78e582db97872e7"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a66f4e76926c44414b78e582db97872e7">mwi_subscription_shutdown</a></div><div class="ttdeci">static void mwi_subscription_shutdown(struct ast_sip_subscription *sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00587">res_pjsip_mwi.c:587</a></div></div>
<div class="ttc" id="structast__sorcery__observer_html_a1ebad9f5bd6a80f6f666354460b86e0d"><div class="ttname"><a href="../../d2/ddb/structast__sorcery__observer.html#a1ebad9f5bd6a80f6f666354460b86e0d">ast_sorcery_observer::loaded</a></div><div class="ttdeci">void(* loaded)(const char *object_type)</div><div class="ttdoc">Callback for when an object type is loaded/reloaded. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00343">sorcery.h:343</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga568aa1aff837fc0001279490a6d9b22f"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga568aa1aff837fc0001279490a6d9b22f">ast_manager_get_topic</a></div><div class="ttdeci">struct stasis_topic * ast_manager_get_topic(void)</div><div class="ttdoc">Get the Stasis Message Bus API topic for AMI. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01720">manager.c:1720</a></div></div>
<div class="ttc" id="logger_8h_html"><div class="ttname"><a href="../../d1/d8c/logger_8h.html">logger.h</a></div><div class="ttdoc">Support for logging to various files, console and syslog Configuration in file logger.conf. </div></div>
<div class="ttc" id="res__phoneprov_8c_html_addaa208b0ed785225e24490fb9f28a80"><div class="ttname"><a href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a></div><div class="ttdeci">AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_GLOBAL_SYMBOLS|AST_MODFLAG_LOAD_ORDER, &quot;HTTP Phone Provisioning&quot;,.support_level=AST_MODULE_SUPPORT_EXTENDED,.load=load_module,.unload=unload_module,.reload=reload,.load_pri=AST_MODPRI_CHANNEL_DEPEND,.requires=&quot;http&quot;,)</div></div>
<div class="ttc" id="serializer_8h_html_a630652ec26cd3d66063fccef05b3240d"><div class="ttname"><a href="../../dd/d5f/serializer_8h.html#a630652ec26cd3d66063fccef05b3240d">ast_serializer_pool_set_alerts</a></div><div class="ttdeci">int ast_serializer_pool_set_alerts(struct ast_serializer_pool *pool, long high, long low)</div><div class="ttdoc">Set taskprocessor alert levels for the serializers in the pool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/serializer_8c_source.html#l00156">serializer.c:156</a></div></div>
<div class="ttc" id="serializer_8h_html_a59e92ce84852e313b5e3a0dae1ddba4d"><div class="ttname"><a href="../../dd/d5f/serializer_8h.html#a59e92ce84852e313b5e3a0dae1ddba4d">ast_serializer_pool_create</a></div><div class="ttdeci">struct ast_serializer_pool * ast_serializer_pool_create(const char *name, unsigned int size, struct ast_threadpool *threadpool, int timeout)</div><div class="ttdoc">Create a serializer pool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/serializer_8c_source.html#l00076">serializer.c:76</a></div></div>
<div class="ttc" id="sorcery_8h_html_aaa9cd237841a70862001f580b23212c9"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a></div><div class="ttdeci">void * ast_sorcery_retrieve_by_fields(const struct ast_sorcery *sorcery, const char *type, unsigned int flags, struct ast_variable *fields)</div><div class="ttdoc">Retrieve an object or multiple objects using specific fields. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01897">sorcery.c:1897</a></div></div>
<div class="ttc" id="structunsolicited__mwi__data_html"><div class="ttname"><a href="../../dd/da0/structunsolicited__mwi__data.html">unsolicited_mwi_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00364">res_pjsip_mwi.c:364</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_abce1c0cc1320bb801480d0929266d08f"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#abce1c0cc1320bb801480d0929266d08f">ast_sip_subscription_get_endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * ast_sip_subscription_get_endpoint(struct ast_sip_subscription *sub)</div><div class="ttdoc">Get the endpoint that is associated with this subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01936">res_pjsip_pubsub.c:1936</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_aa6471e6d6f4563ef5fb93343180fea40"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#aa6471e6d6f4563ef5fb93343180fea40">ast_sip_subscription_get_dialog</a></div><div class="ttdeci">pjsip_dialog * ast_sip_subscription_get_dialog(struct ast_sip_subscription *sub)</div><div class="ttdoc">Get the pjsip dialog that is associated with this subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l01930">res_pjsip_pubsub.c:1930</a></div></div>
<div class="ttc" id="astobj2_8h_html_a3a11e1a1d3e99bed3ea0a7c57a3880d7"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a3a11e1a1d3e99bed3ea0a7c57a3880d7">ao2_global_obj_replace_unref</a></div><div class="ttdeci">#define ao2_global_obj_replace_unref(holder, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00908">astobj2.h:908</a></div></div>
<div class="ttc" id="structast__datastore_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">ast_datastore::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00070">datastore.h:70</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a></div><div class="ttdoc">The arg parameter is an object of the same type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01091">astobj2.h:1091</a></div></div>
<div class="ttc" id="sorcery_8h_html_a18d64c360480b458754fc30f781d5011"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a18d64c360480b458754fc30f781d5011">ast_sorcery_observer_remove</a></div><div class="ttdeci">void ast_sorcery_observer_remove(const struct ast_sorcery *sorcery, const char *type, const struct ast_sorcery_observer *callbacks)</div><div class="ttdoc">Remove an observer from a specific object type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02418">sorcery.c:2418</a></div></div>
<div class="ttc" id="group__main__options_html_gaa5dba371db31dc4ebecdff7c929ff263"><div class="ttname"><a href="../../d6/dd6/group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a></div><div class="ttdeci">struct ast_flags ast_options</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00061">options.c:61</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="structast__taskprocessor_html"><div class="ttname"><a href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a></div><div class="ttdoc">A ast_taskprocessor structure is a singleton by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00069">taskprocessor.c:69</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a68314dedb48b2799a693d3a090ae038b"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a68314dedb48b2799a693d3a090ae038b">ast_sip_subscription_add_datastore</a></div><div class="ttdeci">int ast_sip_subscription_add_datastore(struct ast_sip_subscription *subscription, struct ast_datastore *datastore)</div><div class="ttdoc">Add a datastore to a SIP subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02629">res_pjsip_pubsub.c:2629</a></div></div>
<div class="ttc" id="structast__sip__mwi__configuration_html_ac73c8898b4e904caa12dd1adcab40126"><div class="ttname"><a href="../../d9/dbd/structast__sip__mwi__configuration.html#ac73c8898b4e904caa12dd1adcab40126">ast_sip_mwi_configuration::fromuser</a></div><div class="ttdeci">const ast_string_field fromuser</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00590">res_pjsip.h:590</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a5572d52daf1a841b0f9308df901448c8"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a></div><div class="ttdeci">struct ast_sorcery * ast_sip_get_sorcery(void)</div><div class="ttdoc">Get a pointer to the SIP sorcery structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/pjsip__configuration_8c_source.html#l02404">pjsip_configuration.c:2404</a></div></div>
<div class="ttc" id="structao2__iterator_html"><div class="ttname"><a href="../../d9/d97/structao2__iterator.html">ao2_iterator</a></div><div class="ttdoc">When we need to walk through a container, we use an ao2_iterator to keep track of the current positio...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01841">astobj2.h:1841</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a5b0f67be0ca6ad54e4eba8d4aa029faf"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a5b0f67be0ca6ad54e4eba8d4aa029faf">ast_sip_subscription_notify</a></div><div class="ttdeci">int ast_sip_subscription_notify(struct ast_sip_subscription *sub, struct ast_sip_body_data *notify_data, int terminate)</div><div class="ttdoc">Notify a SIP subscription of a state change. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02529">res_pjsip_pubsub.c:2529</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="res__pjsip__pubsub_8h_html_a3c257396060f400b0fba424730e7576e"><div class="ttname"><a href="../../dc/db0/res__pjsip__pubsub_8h.html#a3c257396060f400b0fba424730e7576e">ast_sip_subscription_remove_datastore</a></div><div class="ttdeci">void ast_sip_subscription_remove_datastore(struct ast_sip_subscription *subscription, const char *name)</div><div class="ttdoc">Remove a subscription datastore from the subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l02639">res_pjsip_pubsub.c:2639</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a59a4d26dfca856c70a1e9487e073aa13"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a59a4d26dfca856c70a1e9487e073aa13">get_message_count</a></div><div class="ttdeci">static int get_message_count(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00326">res_pjsip_mwi.c:326</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a84a555cca13f36d9a82bd461f8f5a07b"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a84a555cca13f36d9a82bd461f8f5a07b">create_mwi_subscriptions</a></div><div class="ttdeci">static void create_mwi_subscriptions(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01301">res_pjsip_mwi.c:1301</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga70de9f16a229e2c5bf1a973372949d3e"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga70de9f16a229e2c5bf1a973372949d3e">ast_mwi_state::new_msgs</a></div><div class="ttdeci">int new_msgs</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00461">mwi.h:461</a></div></div>
<div class="ttc" id="mwi_8h_html"><div class="ttname"><a href="../../dc/d33/mwi_8h.html">mwi.h</a></div><div class="ttdoc">Asterisk MWI API. </div></div>
<div class="ttc" id="stasis_8h_html_a4f248ee5f4791f05d0af8768aaab282b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a></div><div class="ttdeci">int stasis_subscription_accept_message_type(struct stasis_subscription *subscription, const struct stasis_message_type *type)</div><div class="ttdoc">Indicate to a subscription that we are interested in a message type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01025">stasis.c:1025</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ace4133926fe22c2e4c9da402da9e5c20"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ace4133926fe22c2e4c9da402da9e5c20">create_mwi_subscriptions_for_endpoint</a></div><div class="ttdeci">static int create_mwi_subscriptions_for_endpoint(void *obj, void *arg, void *data, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01287">res_pjsip_mwi.c:1287</a></div></div>
<div class="ttc" id="res__corosync_8c_html_a8e51289dd0fc7415cee40e7a57b49fdf"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a></div><div class="ttdeci">struct stasis_forward * sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00240">res_corosync.c:240</a></div></div>
<div class="ttc" id="stasis_8h_html_a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00300">stasis.h:300</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a9b38fe6d8eca53716459a092e141df75"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a9b38fe6d8eca53716459a092e141df75">send_contact_notify</a></div><div class="ttdeci">static int send_contact_notify(void *obj, void *arg, int flags)</div><div class="ttdoc">Function called to send MWI NOTIFY on any unsolicited mailboxes relating to this AOR. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01343">res_pjsip_mwi.c:1343</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ad8adb683348f63457224d890996747e9"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ad8adb683348f63457224d890996747e9">send_initial_notify_all</a></div><div class="ttdeci">static int send_initial_notify_all(void *obj)</div><div class="ttdoc">Task invoked to send initial MWI NOTIFY for unsolicited. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01470">res_pjsip_mwi.c:1470</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gafae630f05995b59b49dc523a5b9ce757"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gafae630f05995b59b49dc523a5b9ce757">stasis_subscription_change_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_subscription_change_type(void)</div><div class="ttdoc">Gets the message type for subscription change notices. </div></div>
<div class="ttc" id="structcontact_html"><div class="ttname"><a href="../../d9/d03/structcontact.html">contact</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8f/reqresp__parser_8h_source.html#l00035">reqresp_parser.h:35</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_aee9c599a805f75e757ffcdc239a1774d"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#aee9c599a805f75e757ffcdc239a1774d">mwi_subscribe_all</a></div><div class="ttdeci">static struct mwi_subscription * mwi_subscribe_all(struct ast_sip_endpoint *endpoint, struct ast_sip_subscription *sip_sub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00960">res_pjsip_mwi.c:960</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a></div><div class="ttdoc">Search option field mask. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01076">astobj2.h:1076</a></div></div>
<div class="ttc" id="group__main__options_html_gaf2588453b3a373a770741ad3ce353343ade4cf3231c69af57ad0527bd46244680"><div class="ttname"><a href="../../d6/dd6/group__main__options.html#gaf2588453b3a373a770741ad3ce353343ade4cf3231c69af57ad0527bd46244680">AST_OPT_FLAG_FULLY_BOOTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5b/options_8h_source.html#l00058">options.h:58</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html_a50edbc089f02d537b9a487f1a62c889e"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">ast_sip_endpoint::aors</a></div><div class="ttdeci">const ast_string_field aors</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00821">res_pjsip.h:821</a></div></div>
<div class="ttc" id="structast__mwi__state_html"><div class="ttname"><a href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a></div><div class="ttdoc">The structure that contains MWI state. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00457">mwi.h:457</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ad79eb292f11982dae39f08414819eafd"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ad79eb292f11982dae39f08414819eafd">MWI_BUCKETS</a></div><div class="ttdeci">#define MWI_BUCKETS</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00052">res_pjsip_mwi.c:52</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a053bbd417bcb3a65e5ae312062e3eafd"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a053bbd417bcb3a65e5ae312062e3eafd">mwi_new_subscribe</a></div><div class="ttdeci">static int mwi_new_subscribe(struct ast_sip_endpoint *endpoint, const char *resource)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00974">res_pjsip_mwi.c:974</a></div></div>
<div class="ttc" id="module_8h_html_aba2c8d4be709a254658b21a834f8294a"><div class="ttname"><a href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a></div><div class="ttdeci">#define ASTERISK_GPL_KEY</div><div class="ttdoc">The text the key() function should return. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00046">module.h:46</a></div></div>
<div class="ttc" id="structast__sip__notifier_html_ad1e64b1a6297045eb98ac47f56591b0f"><div class="ttname"><a href="../../d1/d5b/structast__sip__notifier.html#ad1e64b1a6297045eb98ac47f56591b0f">ast_sip_notifier::default_accept</a></div><div class="ttdeci">const char * default_accept</div><div class="ttdoc">Default body type defined for the event package this notifier handles. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00255">res_pjsip_pubsub.h:255</a></div></div>
<div class="ttc" id="structast__sip__contact_html_a19ac71226fac09e87afe31acb4c99214"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">ast_sip_contact::uri</a></div><div class="ttdeci">const ast_string_field uri</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00303">res_pjsip.h:303</a></div></div>
<div class="ttc" id="structast__sip__notifier_html"><div class="ttname"><a href="../../d1/d5b/structast__sip__notifier.html">ast_sip_notifier</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/res__pjsip__pubsub_8h_source.html#l00246">res_pjsip_pubsub.h:246</a></div></div>
<div class="ttc" id="structmwi__stasis__subscription_html"><div class="ttname"><a href="../../d3/d16/structmwi__stasis__subscription.html">mwi_stasis_subscription</a></div><div class="ttdoc">Wrapper for stasis subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00097">res_pjsip_mwi.c:97</a></div></div>
<div class="ttc" id="module_8h_html"><div class="ttname"><a href="../../d5/d16/module_8h.html">module.h</a></div><div class="ttdoc">Asterisk module definitions. </div></div>
<div class="ttc" id="res__pjsip_8h_html"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html">res_pjsip.h</a></div></div>
<div class="ttc" id="mwi_8h_html_ad83d6c9c09755c8b274a8f07fb2c64f7"><div class="ttname"><a href="../../dc/d33/mwi_8h.html#ad83d6c9c09755c8b274a8f07fb2c64f7">ast_mwi_subscribe_pool</a></div><div class="ttdeci">struct ast_mwi_subscriber * ast_mwi_subscribe_pool(const char *mailbox, stasis_subscription_cb callback, void *data)</div><div class="ttdoc">Add an MWI state subscriber, and stasis subscription to the mailbox. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00230">mwi.c:230</a></div></div>
<div class="ttc" id="structunsolicited__mwi__data_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../dd/da0/structunsolicited__mwi__data.html#a3960205b2a4e7e012dc9f0eae1855f01">unsolicited_mwi_data::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00366">res_pjsip_mwi.c:366</a></div></div>
<div class="ttc" id="structmwi__subscription_html_aee9980d9bea7526cafef97a0672b00cd"><div class="ttname"><a href="../../dc/d8a/structmwi__subscription.html#aee9980d9bea7526cafef97a0672b00cd">mwi_subscription::aors</a></div><div class="ttdeci">char * aors</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00125">res_pjsip_mwi.c:125</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01053">astobj2.h:1053</a></div></div>
<div class="ttc" id="astobj2_8h_html_aadb92410f92a28e16f404b51bc601a80"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aadb92410f92a28e16f404b51bc601a80">ao2_global_obj_replace</a></div><div class="ttdeci">#define ao2_global_obj_replace(holder, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00885">astobj2.h:885</a></div></div>
<div class="ttc" id="astobj2_8h_html_a91d5d37d00874ae7a92d1a15c0a3b3a6"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a></div><div class="ttdeci">struct ao2_iterator ao2_iterator_init(struct ao2_container *c, int flags) attribute_warn_unused_result</div><div class="ttdoc">Create an iterator for a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00485">astobj2_container.c:485</a></div></div>
<div class="ttc" id="structast__sip__body_html"><div class="ttname"><a href="../../d5/d80/structast__sip__body.html">ast_sip_body</a></div><div class="ttdoc">SIP body description. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02027">res_pjsip.h:2027</a></div></div>
<div class="ttc" id="serializer_8h_html_a57044062c5e192e675109fa621c1588d"><div class="ttname"><a href="../../dd/d5f/serializer_8h.html#a57044062c5e192e675109fa621c1588d">ast_serializer_pool_get</a></div><div class="ttdeci">struct ast_taskprocessor * ast_serializer_pool_get(struct ast_serializer_pool *pool)</div><div class="ttdoc">Retrieve a serializer from the pool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd3/serializer_8c_source.html#l00127">serializer.c:127</a></div></div>
<div class="ttc" id="sorcery_8h_html_ad98ae6e153f53b0c3c40119acc5e5266"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#ad98ae6e153f53b0c3c40119acc5e5266">ast_sorcery_reload_object</a></div><div class="ttdeci">void ast_sorcery_reload_object(const struct ast_sorcery *sorcery, const char *type)</div><div class="ttdoc">Inform any wizards of a specific object type to reload persistent objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01442">sorcery.c:1442</a></div></div>
<div class="ttc" id="res__mwi__devstate_8c_html_a422af54ca3d288f34246a66114879f27"><div class="ttname"><a href="../../d2/dd0/res__mwi__devstate_8c.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a></div><div class="ttdeci">static struct stasis_subscription * mwi_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/res__mwi__devstate_8c_source.html#l00031">res_mwi_devstate.c:31</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ac1cdb85fe882c3a0b4605746358219b6"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ac1cdb85fe882c3a0b4605746358219b6">mwi_stasis_cb</a></div><div class="ttdeci">static void mwi_stasis_cb(void *userdata, struct stasis_subscription *sub, struct stasis_message *msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01156">res_pjsip_mwi.c:1156</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a7ce3dfdf12cb89ecedcc301dc6b994cc"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a7ce3dfdf12cb89ecedcc301dc6b994cc">mwi_serializer_pool</a></div><div class="ttdeci">static struct ast_serializer_pool * mwi_serializer_pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00066">res_pjsip_mwi.c:66</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a9c7c3b20430fcd169df0e9b532822a35"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a9c7c3b20430fcd169df0e9b532822a35">mwi_contact_changed</a></div><div class="ttdeci">static void mwi_contact_changed(const struct ast_sip_contact *contact)</div><div class="ttdoc">Create mwi subscriptions and notify. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01361">res_pjsip_mwi.c:1361</a></div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ac981149e3fb0f7fc8b6e75607b1b2ad0"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ac981149e3fb0f7fc8b6e75607b1b2ad0">ast_sip_create_request</a></div><div class="ttdeci">int ast_sip_create_request(const char *method, struct pjsip_dialog *dlg, struct ast_sip_endpoint *endpoint, const char *uri, struct ast_sip_contact *contact, pjsip_tx_data **tdata)</div><div class="ttdoc">General purpose method for creating a SIP request. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l04490">res_pjsip.c:4490</a></div></div>
<div class="ttc" id="sorcery_8h_html"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html">sorcery.h</a></div><div class="ttdoc">Sorcery Data Access Layer API. </div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a81588c60180173cbfe0a73e0ba6e4e98"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a81588c60180173cbfe0a73e0ba6e4e98">is_unsolicited_allowed</a></div><div class="ttdeci">static int is_unsolicited_allowed(struct ast_sip_endpoint *endpoint, const char *mailbox, struct ao2_container *unsolicited_mwi, struct ao2_container *solicited_mwi)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00783">res_pjsip_mwi.c:783</a></div></div>
<div class="ttc" id="structast__sip__message__accumulator_html_abc5ed3ee3c85dccc50605477083d2e55"><div class="ttname"><a href="../../d0/dfb/structast__sip__message__accumulator.html#abc5ed3ee3c85dccc50605477083d2e55">ast_sip_message_accumulator::message_account</a></div><div class="ttdeci">char message_account[PJSIP_MAX_URL_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4c/res__pjsip__body__generator__types_8h_source.html#l00074">res_pjsip_body_generator_types.h:74</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_ab7eea518476f0bc3f418067556ccc4bc"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#ab7eea518476f0bc3f418067556ccc4bc">serialized_cleanup</a></div><div class="ttdeci">static int serialized_cleanup(void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01127">res_pjsip_mwi.c:1127</a></div></div>
<div class="ttc" id="strings_8h_html_a33ab7fa091d5513d8507d3bd33ef5b55"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a33ab7fa091d5513d8507d3bd33ef5b55">ast_str_hash</a></div><div class="ttdeci">static force_inline int attribute_pure ast_str_hash(const char *str)</div><div class="ttdoc">Compute a hash value on a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01206">strings.h:1206</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:04 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
