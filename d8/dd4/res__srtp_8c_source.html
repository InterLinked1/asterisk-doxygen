<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_srtp.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">res_srtp.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d8/dd4/res__srtp_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2005, Mikael Magnusson</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Mikael Magnusson &lt;mikma@users.sourceforge.net&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * Builds on libSRTP http://srtp.sourceforge.net</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/*! \file res_srtp.c</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * \brief Secure RTP (SRTP)</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * Secure RTP (SRTP)</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * Specified in RFC 3711.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * \author Mikael Magnusson &lt;mikma@users.sourceforge.net&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">   &lt;depend&gt;srtp&lt;/depend&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">   &lt;use type=&quot;external&quot;&gt;openssl&lt;/use&gt;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">   &lt;support_level&gt;core&lt;/support_level&gt;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">***/</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">/* See https://wiki.asterisk.org/wiki/display/AST/Secure+Calling */</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span>                   <span class="comment">/* for NULL, size_t, memcpy, etc */</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span>                       <span class="comment">/* for pow */</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#if HAVE_SRTP_VERSION &gt; 1</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor"># include &lt;srtp2/srtp.h&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor"># include &quot;<a class="code" href="../../d4/dca/srtp__compat_8h.html">srtp/srtp_compat.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor"># include &lt;openssl/rand.h&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor"># include &lt;srtp/srtp.h&gt;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor"># ifdef HAVE_OPENSSL</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#  include &lt;openssl/rand.h&gt;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor"># else</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#  include &lt;srtp/crypto_kernel.h&gt;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor"># endif</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/da5/astobj2_8h.html">asterisk/astobj2.h</a>&quot;</span>           <span class="comment">/* for ao2_t_ref, etc */</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html">asterisk/frame.h</a>&quot;</span>             <span class="comment">/* for AST_FRIENDLY_OFFSET */</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/logger_8h.html">asterisk/logger.h</a>&quot;</span>            <span class="comment">/* for ast_log, ast_debug, etc */</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/module_8h.html">asterisk/module.h</a>&quot;</span>            <span class="comment">/* for ast_module_info, etc */</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d5f/sdp__srtp_8h.html">asterisk/sdp_srtp.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d15/res__srtp_8h.html">asterisk/res_srtp.h</a>&quot;</span>          <span class="comment">/* for ast_srtp_cb, ast_srtp_suite, etc */</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/dde/rtp__engine_8h.html">asterisk/rtp_engine.h</a>&quot;</span>        <span class="comment">/* for ast_rtp_engine_register_srtp, etc */</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d60/utils_8h.html">asterisk/utils.h</a>&quot;</span>             <span class="comment">/* for ast_free, ast_calloc */</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="../../d4/d11/structast__srtp.html">   65</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> {</div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">   66</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d7a/structast__rtp__instance.html">ast_rtp_instance</a> *<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>;</div><div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">   67</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">policies</a>;</div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">   68</a></span>&#160;   srtp_t <a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>;</div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="../../d4/d11/structast__srtp.html#a78dc249b0da93a71c52a5fae14cb4970">   69</a></span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../db/deb/structast__srtp__cb.html">ast_srtp_cb</a> *<a class="code" href="../../d4/d11/structast__srtp.html#a78dc249b0da93a71c52a5fae14cb4970">cb</a>;</div><div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="../../d4/d11/structast__srtp.html#a735984d41155bc1032e09bece8f8d66d">   70</a></span>&#160;   <span class="keywordtype">void</span> *<a class="code" href="../../d4/d11/structast__srtp.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="../../d4/d11/structast__srtp.html#a873db0c09e74a379eb9c741329f126f3">   71</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d4/d11/structast__srtp.html#a873db0c09e74a379eb9c741329f126f3">warned</a>;</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="../../d4/d11/structast__srtp.html#a4da7ebd0a2bf33074ac1826b88936875">   72</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../d4/d11/structast__srtp.html#a4da7ebd0a2bf33074ac1826b88936875">buf</a>[8192 + <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8f7380b8620c80443286b44481f641c">AST_FRIENDLY_OFFSET</a>];</div><div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="../../d4/d11/structast__srtp.html#ad4ad2853bb86f7ed84dbbccbeec3c56b">   73</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../d4/d11/structast__srtp.html#ad4ad2853bb86f7ed84dbbccbeec3c56b">rtcpbuf</a>[8192 + <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8f7380b8620c80443286b44481f641c">AST_FRIENDLY_OFFSET</a>];</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;};</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="../../d4/d86/structast__srtp__policy.html">   76</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> {</div><div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">   77</a></span>&#160;   srtp_policy_t <a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;};</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">/*! Tracks whether or not we&#39;ve initialized the libsrtp library */</span></div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#af26aaa9e68392c11113fe77ca9b15fac">   81</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#af26aaa9e68392c11113fe77ca9b15fac">g_initialized</a> = 0;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">/* SRTP functions */</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a2ff9370aa6ad777df81de3ef7dc39b55">ast_srtp_create</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> **srtp, <span class="keyword">struct</span> <a class="code" href="../../df/d7a/structast__rtp__instance.html">ast_rtp_instance</a> *<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>, <span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a81edc9ce5f56a166bdf966ff5c3ccea2">ast_srtp_replace</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> **srtp, <span class="keyword">struct</span> <a class="code" href="../../df/d7a/structast__rtp__instance.html">ast_rtp_instance</a> *<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>, <span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a9ea3c947f5cd82b97dc6a219810def71">ast_srtp_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a4343846df790beb40a23564977548686">ast_srtp_add_stream</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp, <span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a617fc2aa94ffdeeceb3830df5e058078">ast_srtp_change_source</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> from_ssrc, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> to_ssrc);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#ade80dceb8714107134dc7d7171d7a9d5">ast_srtp_unprotect</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp, <span class="keywordtype">void</span> *<a class="code" href="../../d4/d11/structast__srtp.html#a4da7ebd0a2bf33074ac1826b88936875">buf</a>, <span class="keywordtype">int</span> *<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="keywordtype">int</span> rtcp);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#aea829ea39d65a8f324757efbe3d5bcb9">ast_srtp_protect</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp, <span class="keywordtype">void</span> **<a class="code" href="../../d4/d11/structast__srtp.html#a4da7ebd0a2bf33074ac1826b88936875">buf</a>, <span class="keywordtype">int</span> *<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="keywordtype">int</span> rtcp);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#afce2c36417481dac5c7d112dbb09fcde">ast_srtp_set_cb</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/deb/structast__srtp__cb.html">ast_srtp_cb</a> *<a class="code" href="../../d4/d11/structast__srtp.html#a78dc249b0da93a71c52a5fae14cb4970">cb</a>, <span class="keywordtype">void</span> *<a class="code" href="../../d4/d11/structast__srtp.html#a735984d41155bc1032e09bece8f8d66d">data</a>);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a9d8b42909d9ee47ca3571897213414ab">ast_srtp_get_random</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">size_t</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">/* Policy functions */</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *<a class="code" href="../../d8/dd4/res__srtp_8c.html#aac39276480fc153bc9d11d9bc6b5e3db">ast_srtp_policy_alloc</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a24dd5904934bd991e4a16dc3d80c9160">ast_srtp_policy_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a3f02c6e84de7e7ec17b088aceef3b43d">ast_srtp_policy_set_suite</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy, <span class="keyword">enum</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606">ast_srtp_suite</a> suite);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a421dc7f1902e1303663007480465cf7d">ast_srtp_policy_set_master_key</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">size_t</span> key_len, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *salt, <span class="keywordtype">size_t</span> salt_len);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#aa38f2594fc136f7915c7bdbf5bcb2456">ast_srtp_policy_set_ssrc</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ssrc, <span class="keywordtype">int</span> inbound);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a923397ffbd17f98cf3c9717a0d13e353">  102</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d5d/structast__srtp__res.html">ast_srtp_res</a> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a923397ffbd17f98cf3c9717a0d13e353">srtp_res</a> = {</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   .<a class="code" href="../../d0/d5d/structast__srtp__res.html#ac87bc654e623df7d5d480bf845470242">create</a> = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a2ff9370aa6ad777df81de3ef7dc39b55">ast_srtp_create</a>,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;   .replace = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a81edc9ce5f56a166bdf966ff5c3ccea2">ast_srtp_replace</a>,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   .destroy = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a9ea3c947f5cd82b97dc6a219810def71">ast_srtp_destroy</a>,</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   .add_stream = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a4343846df790beb40a23564977548686">ast_srtp_add_stream</a>,</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;   .change_source = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a617fc2aa94ffdeeceb3830df5e058078">ast_srtp_change_source</a>,</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;   .set_cb = <a class="code" href="../../d8/dd4/res__srtp_8c.html#afce2c36417481dac5c7d112dbb09fcde">ast_srtp_set_cb</a>,</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;   .unprotect = <a class="code" href="../../d8/dd4/res__srtp_8c.html#ade80dceb8714107134dc7d7171d7a9d5">ast_srtp_unprotect</a>,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   .protect = <a class="code" href="../../d8/dd4/res__srtp_8c.html#aea829ea39d65a8f324757efbe3d5bcb9">ast_srtp_protect</a>,</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   .get_random = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a9d8b42909d9ee47ca3571897213414ab">ast_srtp_get_random</a></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;};</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#adae622a01b8004d643b26e73a7859c8f">  114</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d6/d13/structast__srtp__policy__res.html">ast_srtp_policy_res</a> <a class="code" href="../../d8/dd4/res__srtp_8c.html#adae622a01b8004d643b26e73a7859c8f">policy_res</a> = {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;   .<a class="code" href="../../d6/d13/structast__srtp__policy__res.html#a6ac2385237fe875d599a88bac10969f9">alloc</a> = <a class="code" href="../../d8/dd4/res__srtp_8c.html#aac39276480fc153bc9d11d9bc6b5e3db">ast_srtp_policy_alloc</a>,</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;   .destroy = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a24dd5904934bd991e4a16dc3d80c9160">ast_srtp_policy_destroy</a>,</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;   .set_suite = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a3f02c6e84de7e7ec17b088aceef3b43d">ast_srtp_policy_set_suite</a>,</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;   .set_master_key = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a421dc7f1902e1303663007480465cf7d">ast_srtp_policy_set_master_key</a>,</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;   .set_ssrc = <a class="code" href="../../d8/dd4/res__srtp_8c.html#aa38f2594fc136f7915c7bdbf5bcb2456">ast_srtp_policy_set_ssrc</a></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;};</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a73559cc705b835510476ad99fc4104ad">  122</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dd4/res__srtp_8c.html#a73559cc705b835510476ad99fc4104ad">srtp_errstr</a>(<span class="keywordtype">int</span> err)</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;{</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;   <span class="keywordflow">switch</span>(err) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#a3d238d91bc329c337f28ca2d3f23a467">err_status_ok</a>:</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;nothing to report&quot;</span>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#af66c54b01bbb0ea196ffa3fd140566a3">err_status_fail</a>:</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;unspecified failure&quot;</span>;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#accb3924f44d39f4812faf84b54a6ac12">err_status_bad_param</a>:</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;unsupported parameter&quot;</span>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#a981df5e73e2c3f69d2f2800e167a6769">err_status_alloc_fail</a>:</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;couldn&#39;t allocate memory&quot;</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#a854b3109544fdc1fcd4ae6e77a23c744">err_status_dealloc_fail</a>:</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;couldn&#39;t deallocate properly&quot;</span>;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#a52bb43dcbc91ef5bcaf005708ba1c437">err_status_init_fail</a>:</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;couldn&#39;t initialize&quot;</span>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#ae8e232aebb30f87e1ab800d73c07350b">err_status_terminus</a>:</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;can&#39;t process as much data as requested&quot;</span>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#ae4a50388ac8043dbd43d726a3885dc26">err_status_auth_fail</a>:</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;authentication failure&quot;</span>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#a05c7f068d020be42432c4d4157a54ae7">err_status_cipher_fail</a>:</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;cipher failure&quot;</span>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#af24bc421ec61b3c9ac8d09685cf8d7b0">err_status_replay_fail</a>:</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;replay check failed (bad index)&quot;</span>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#a68181e5cc0691ab201cacf0778cdd180">err_status_replay_old</a>:</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;replay check failed (index too old)&quot;</span>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#a6ec2f3743f0bfefec422ef357a88d62d">err_status_algo_fail</a>:</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;algorithm failed test routine&quot;</span>;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#a9ae986c45b28edf57e79c703168e2991">err_status_no_such_op</a>:</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;unsupported operation&quot;</span>;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#a819913052ef352de8dad1cd7a95a3aca">err_status_no_ctx</a>:</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;no appropriate context found&quot;</span>;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#aca320089a8536caef8d5129ca3a534e9">err_status_cant_check</a>:</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;unable to perform desired validation&quot;</span>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/dca/srtp__compat_8h.html#aa5575ba4f5f776d1f012a12d84250571">err_status_key_expired</a>:</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;can&#39;t use key any more&quot;</span>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;   }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;}</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#ad2bed0825e79435e8994414befe0b1ae">  162</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#ad2bed0825e79435e8994414befe0b1ae">policy_hash_fn</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;{</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy = obj;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;   <span class="keywordflow">return</span> policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type == ssrc_specific ? policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.value : policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a004849402c851b293246c12c9f75e629">  169</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a004849402c851b293246c12c9f75e629">policy_cmp_fn</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;{</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *one = obj, *two = arg;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;   <span class="keywordflow">return</span> one-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type == two-&gt;sp.ssrc.type &amp;&amp; one-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.value == two-&gt;sp.ssrc.value;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;}</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a78965d7d619d6a6878c4c5657518cd91">  176</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *<a class="code" href="../../d8/dd4/res__srtp_8c.html#a78965d7d619d6a6878c4c5657518cd91">find_policy</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp, <span class="keyword">const</span> srtp_policy_t *policy, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> tmp = {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      .<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a> = {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;         .ssrc.type = policy-&gt;ssrc.type,</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;         .ssrc.value = policy-&gt;ssrc.value,</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      },</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;   };</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a36591ec4147956994abd2c67dacba18f">ao2_t_find</a>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">policies</a>, &amp;tmp, flags, <span class="stringliteral">&quot;Looking for policy&quot;</span>);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#ac028d37052938579f977518ec30eb469">  188</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *<a class="code" href="../../d8/dd4/res__srtp_8c.html#ac028d37052938579f977518ec30eb469">res_srtp_new</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;{</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;   <span class="keywordflow">if</span> (!(srtp = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*srtp)))) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate memory for srtp\n&quot;</span>);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">policies</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ab5c800b526ca7de022a0a3e79d0292ad">ao2_t_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0, 5,</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <a class="code" href="../../d8/dd4/res__srtp_8c.html#ad2bed0825e79435e8994414befe0b1ae">policy_hash_fn</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/dd4/res__srtp_8c.html#a004849402c851b293246c12c9f75e629">policy_cmp_fn</a>, <span class="stringliteral">&quot;SRTP policy container&quot;</span>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   <span class="keywordflow">if</span> (!srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">policies</a>) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(srtp);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;   }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a873db0c09e74a379eb9c741329f126f3">warned</a> = 1;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   <span class="keywordflow">return</span> srtp;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;}</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">  struct ast_srtp_policy</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#ae59adece7c6925bc7dc210a16cbf0542">  212</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#ae59adece7c6925bc7dc210a16cbf0542">srtp_event_cb</a>(srtp_event_data_t *<a class="code" href="../../d4/d11/structast__srtp.html#a735984d41155bc1032e09bece8f8d66d">data</a>)</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;{</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;   <span class="keywordflow">switch</span> (data-&gt;event) {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   <span class="keywordflow">case</span> event_ssrc_collision:</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;SSRC collision\n&quot;</span>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   <span class="keywordflow">case</span> event_key_soft_limit:</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;event_key_soft_limit\n&quot;</span>);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   <span class="keywordflow">case</span> event_key_hard_limit:</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;event_key_hard_limit\n&quot;</span>);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   <span class="keywordflow">case</span> event_packet_index_limit:</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;event_packet_index_limit\n&quot;</span>);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;}</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#aa38f2594fc136f7915c7bdbf5bcb2456">  230</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#aa38f2594fc136f7915c7bdbf5bcb2456">ast_srtp_policy_set_ssrc</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy,</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ssrc, <span class="keywordtype">int</span> inbound)</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   <span class="keywordflow">if</span> (ssrc) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type = ssrc_specific;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.value = ssrc;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type = inbound ? ssrc_any_inbound : ssrc_any_outbound;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;   }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;}</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#af15440543bd7d214540fe7d3cba5ad4a">  241</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#af15440543bd7d214540fe7d3cba5ad4a">policy_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;{</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy = obj;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   <span class="keywordflow">if</span> (policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.key) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.key);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.key = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;   }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;}</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#aac39276480fc153bc9d11d9bc6b5e3db">  251</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *<a class="code" href="../../d8/dd4/res__srtp_8c.html#aac39276480fc153bc9d11d9bc6b5e3db">ast_srtp_policy_alloc</a>()</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;{</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <span class="keywordflow">if</span> (!(tmp = <a class="code" href="../../d5/da5/astobj2_8h.html#ad57326008c326db88dc36779741622b8">ao2_t_alloc</a>(<span class="keyword">sizeof</span>(*tmp), <a class="code" href="../../d8/dd4/res__srtp_8c.html#af15440543bd7d214540fe7d3cba5ad4a">policy_destructor</a>, <span class="stringliteral">&quot;Allocating policy&quot;</span>))) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate memory for srtp_policy\n&quot;</span>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a24dd5904934bd991e4a16dc3d80c9160">  262</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a24dd5904934bd991e4a16dc3d80c9160">ast_srtp_policy_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;{</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(policy, -1, <span class="stringliteral">&quot;Destroying policy&quot;</span>);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a4c5914517b996d128c2a904e38dc0c76">  267</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a4c5914517b996d128c2a904e38dc0c76">policy_set_suite</a>(<a class="code" href="../../d4/dca/srtp__compat_8h.html#afb7dcd1b02342a0b7b687caed7ca205d">crypto_policy_t</a> *p, <span class="keyword">enum</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606">ast_srtp_suite</a> suite)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;{</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   <span class="keywordflow">switch</span> (suite) {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a01497082a505f28b44550e051c01db16">AST_AES_CM_128_HMAC_SHA1_80</a>:</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <a class="code" href="../../d4/dca/srtp__compat_8h.html#a4c3485ca0c6a5d909cc372e6a2f777c0">crypto_policy_set_aes_cm_128_hmac_sha1_80</a>(p);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a18639c7f72572ae21023a76ad8ec36b7">AST_AES_CM_128_HMAC_SHA1_32</a>:</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <a class="code" href="../../d4/dca/srtp__compat_8h.html#a41ec915ed585862f02f2e6746287108b">crypto_policy_set_aes_cm_128_hmac_sha1_32</a>(p);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="preprocessor">#ifdef HAVE_SRTP_192</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a541332fc9fec9829891e0ac434ae15b8">AST_AES_CM_192_HMAC_SHA1_80</a>:</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <a class="code" href="../../d4/dca/srtp__compat_8h.html#a1625555023b94a961485fdaa0bd96a5d">crypto_policy_set_aes_cm_192_hmac_sha1_80</a>(p);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a8a74712b46d46ddcadd16112c812a149">AST_AES_CM_192_HMAC_SHA1_32</a>:</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <a class="code" href="../../d4/dca/srtp__compat_8h.html#a8486f43b50731a4ba6a47da2167055f6">crypto_policy_set_aes_cm_192_hmac_sha1_32</a>(p);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#ifdef HAVE_SRTP_256</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a7b668ad7b65feef20f16240e81cb206d">AST_AES_CM_256_HMAC_SHA1_80</a>:</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <a class="code" href="../../d4/dca/srtp__compat_8h.html#a93bb76f28a2b3a492ece881a731c58b4">crypto_policy_set_aes_cm_256_hmac_sha1_80</a>(p);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a2a223fc6539b2a452d5aba09683241dd">AST_AES_CM_256_HMAC_SHA1_32</a>:</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <a class="code" href="../../d4/dca/srtp__compat_8h.html#a937b56896ba5a6198b4030d0b4ed3199">crypto_policy_set_aes_cm_256_hmac_sha1_32</a>(p);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">#ifdef HAVE_SRTP_GCM</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a05d42d7c20a4d79f75915ac05800c625">AST_AES_GCM_128</a>:</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <a class="code" href="../../d4/dca/srtp__compat_8h.html#a2250ef3d835936f47a11bb7d580bb94e">crypto_policy_set_aes_gcm_128_16_auth</a>(p);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a01b96b477f9aa8654ea4e206f0fdd2eb">AST_AES_GCM_256</a>:</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <a class="code" href="../../d4/dca/srtp__compat_8h.html#a709129a726ceab8416f357ae7c65cdfa">crypto_policy_set_aes_gcm_256_16_auth</a>(p);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a8868834307ac79c572cf74f122de5df6">AST_AES_GCM_128_8</a>:</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <a class="code" href="../../d4/dca/srtp__compat_8h.html#ab7ec1cb034fc9bb9fd1bbeba32e35da5">crypto_policy_set_aes_gcm_128_8_auth</a>(p);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606af343453fbb06186800265d1eb08c6aaf">AST_AES_GCM_256_8</a>:</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <a class="code" href="../../d4/dca/srtp__compat_8h.html#a096245953dae967ec66dd0a3d816bcaf">crypto_policy_set_aes_gcm_256_8_auth</a>(p);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid crypto suite: %u\n&quot;</span>, suite);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;   }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;}</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a3f02c6e84de7e7ec17b088aceef3b43d">  320</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a3f02c6e84de7e7ec17b088aceef3b43d">ast_srtp_policy_set_suite</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy, <span class="keyword">enum</span> <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606">ast_srtp_suite</a> suite)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;{</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a4c5914517b996d128c2a904e38dc0c76">policy_set_suite</a>(&amp;policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.rtp, suite) | <a class="code" href="../../d8/dd4/res__srtp_8c.html#a4c5914517b996d128c2a904e38dc0c76">policy_set_suite</a>(&amp;policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.rtcp, suite);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;}</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a421dc7f1902e1303663007480465cf7d">  325</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a421dc7f1902e1303663007480465cf7d">ast_srtp_policy_set_master_key</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">size_t</span> key_len, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *salt, <span class="keywordtype">size_t</span> salt_len)</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;{</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="keywordtype">size_t</span> size = key_len + salt_len;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *master_key;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <span class="keywordflow">if</span> (policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.key) {</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.key);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.key = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;   }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   <span class="keywordflow">if</span> (!(master_key = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, size))) {</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;   }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;   memcpy(master_key, key, key_len);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   memcpy(master_key + key_len, salt, salt_len);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;   policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.key = master_key;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;}</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a9d8b42909d9ee47ca3571897213414ab">  347</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a9d8b42909d9ee47ca3571897213414ab">ast_srtp_get_random</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">size_t</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;{</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   <span class="keywordflow">return</span> RAND_bytes(key, len) &gt; 0 ? 0: -1;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   <span class="keywordflow">return</span> crypto_get_random(key, len) != <a class="code" href="../../d4/dca/srtp__compat_8h.html#a3d238d91bc329c337f28ca2d3f23a467">err_status_ok</a> ? -1: 0;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#afce2c36417481dac5c7d112dbb09fcde">  356</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#afce2c36417481dac5c7d112dbb09fcde">ast_srtp_set_cb</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/deb/structast__srtp__cb.html">ast_srtp_cb</a> *<a class="code" href="../../d4/d11/structast__srtp.html#a78dc249b0da93a71c52a5fae14cb4970">cb</a>, <span class="keywordtype">void</span> *<a class="code" href="../../d4/d11/structast__srtp.html#a735984d41155bc1032e09bece8f8d66d">data</a>)</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;{</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;   <span class="keywordflow">if</span> (!srtp) {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;   }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a78dc249b0da93a71c52a5fae14cb4970">cb</a> = <a class="code" href="../../d4/d11/structast__srtp.html#a78dc249b0da93a71c52a5fae14cb4970">cb</a>;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;   srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a735984d41155bc1032e09bece8f8d66d">data</a> = <a class="code" href="../../d4/d11/structast__srtp.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;}</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">/* Vtable functions */</span></div><div class="line"><a name="l00367"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#ade80dceb8714107134dc7d7171d7a9d5">  367</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#ade80dceb8714107134dc7d7171d7a9d5">ast_srtp_unprotect</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp, <span class="keywordtype">void</span> *<a class="code" href="../../d4/d11/structast__srtp.html#a4da7ebd0a2bf33074ac1826b88936875">buf</a>, <span class="keywordtype">int</span> *<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;{</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;   <span class="keywordtype">int</span> rtcp  = (flags &amp; 0x01) &gt;&gt; 0;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;   <span class="keywordtype">int</span> retry = (flags &amp; 0x02) &gt;&gt; 1;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/db0/structast__rtp__instance__stats.html">ast_rtp_instance_stats</a> stats = {0,};</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;tryagain:</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   <span class="keywordflow">if</span> (!srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>) {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;SRTP unprotect %s - missing session\n&quot;</span>, rtcp ? <span class="stringliteral">&quot;rtcp&quot;</span> : <span class="stringliteral">&quot;rtp&quot;</span>);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EINVAL;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      res = rtcp ? srtp_unprotect_rtcp(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>, buf, len) : srtp_unprotect(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>, buf, len);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="keywordflow">if</span> (res != <a class="code" href="../../d4/dca/srtp__compat_8h.html#a819913052ef352de8dad1cd7a95a3aca">err_status_no_ctx</a>) {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      }</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="keywordflow">if</span> (srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a78dc249b0da93a71c52a5fae14cb4970">cb</a> &amp;&amp; srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a78dc249b0da93a71c52a5fae14cb4970">cb</a>-&gt;<a class="code" href="../../db/deb/structast__srtp__cb.html#aa07fd91d93b61e34c6c9dd33eeaab8de">no_ctx</a>) {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/rtp__engine_8h.html#a82a029e03affad8a6e1b322c0b9fe2c3">ast_rtp_instance_get_stats</a>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>, &amp;stats, <a class="code" href="../../d5/dde/rtp__engine_8h.html#a52d18270f48752558c84d7760c82378faf9c51f48bae504be2f9af9f4e646533e">AST_RTP_INSTANCE_STAT_REMOTE_SSRC</a>)) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;         }</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;         <span class="keywordflow">if</span> (srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a78dc249b0da93a71c52a5fae14cb4970">cb</a>-&gt;<a class="code" href="../../db/deb/structast__srtp__cb.html#aa07fd91d93b61e34c6c9dd33eeaab8de">no_ctx</a>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>, stats.<a class="code" href="../../d0/db0/structast__rtp__instance__stats.html#a052c95f741f3e25e6ab9217a01affb53">remote_ssrc</a>, srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a735984d41155bc1032e09bece8f8d66d">data</a>) &lt; 0) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;         }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   }</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;   <span class="keywordflow">if</span> (retry == 0  &amp;&amp; res == <a class="code" href="../../d4/dca/srtp__compat_8h.html#a68181e5cc0691ab201cacf0778cdd180">err_status_replay_old</a>) {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad6810d73cb786e5e74c55c8bd8688e05">AST_LOG_NOTICE</a>, <span class="stringliteral">&quot;SRTP unprotect failed with %s, retrying\n&quot;</span>, <a class="code" href="../../d8/dd4/res__srtp_8c.html#a73559cc705b835510476ad99fc4104ad">srtp_errstr</a>(res));</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordflow">if</span> (srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> it;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;         <span class="keywordtype">int</span> policies_count;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;         <span class="comment">/* dealloc first */</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;SRTP destroy before re-create\n&quot;</span>);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;         srtp_dealloc(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;         <span class="comment">/* get the count */</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;         policies_count = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">policies</a>);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;         <span class="comment">/* get the first to build up */</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;         it = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">policies</a>, 0);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;         policy = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;it);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;SRTP try to re-create\n&quot;</span>);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;         <span class="keywordflow">if</span> (policy) {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="keywordtype">int</span> res_srtp_create = srtp_create(&amp;srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>, &amp;policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordflow">if</span> (res_srtp_create == <a class="code" href="../../d4/dca/srtp__compat_8h.html#a3d238d91bc329c337f28ca2d3f23a467">err_status_ok</a>) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;SRTP re-created with first policy\n&quot;</span>);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;               <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(policy, -1, <span class="stringliteral">&quot;Unreffing first policy for re-creating srtp session&quot;</span>);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;               <span class="comment">/* if we have more than one policy, add them */</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;               <span class="keywordflow">if</span> (policies_count &gt; 1) {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;Add all the other %d policies\n&quot;</span>,</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                     policies_count - 1);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                  <span class="keywordflow">while</span> ((policy = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;it))) {</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                     srtp_add_stream(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>, &amp;policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                     <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(policy, -1, <span class="stringliteral">&quot;Unreffing n-th policy for re-creating srtp session&quot;</span>);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                  }</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;               }</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;               retry++;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;               <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;it);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;               <span class="keywordflow">goto</span> tryagain;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            }</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;SRTP session could not be re-created after unprotect failure: %s\n&quot;</span>, <a class="code" href="../../d8/dd4/res__srtp_8c.html#a73559cc705b835510476ad99fc4104ad">srtp_errstr</a>(res_srtp_create));</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="comment">/* If srtp_create() fails with a previously alloced session, it will have been dealloced before returning. */</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(policy, -1, <span class="stringliteral">&quot;Unreffing first policy after srtp_create failed&quot;</span>);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;         }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;it);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      }</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;   }</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   <span class="keywordflow">if</span> (!srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>) {</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EINVAL;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;   }</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   <span class="keywordflow">if</span> (res != <a class="code" href="../../d4/dca/srtp__compat_8h.html#a3d238d91bc329c337f28ca2d3f23a467">err_status_ok</a> &amp;&amp; res != <a class="code" href="../../d4/dca/srtp__compat_8h.html#af24bc421ec61b3c9ac8d09685cf8d7b0">err_status_replay_fail</a> ) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">       * Authentication failures happen when an active attacker tries to</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">       * insert malicious RTP packets. Furthermore, authentication failures</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">       * happen, when the other party encrypts the sRTP data in an unexpected</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">       * way. This happens quite often with RTCP. Therefore, when you see</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">       * authentication failures, try to identify the implementation</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">       * (author and product name) used by your other party. Try to investigate</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">       * whether they use a custom library or an outdated version of libSRTP.</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <span class="keywordflow">if</span> (rtcp) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;SRTCP unprotect failed on SSRC %u because of %s\n&quot;</span>,</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <a class="code" href="../../d5/dde/rtp__engine_8h.html#af0adb620e28a15749fe5bf4f6912f00d">ast_rtp_instance_get_ssrc</a>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>), <a class="code" href="../../d8/dd4/res__srtp_8c.html#a73559cc705b835510476ad99fc4104ad">srtp_errstr</a>(res));</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;         <span class="keywordflow">if</span> ((srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a873db0c09e74a379eb9c741329f126f3">warned</a> &gt;= 10) &amp;&amp; !((srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a873db0c09e74a379eb9c741329f126f3">warned</a> - 10) % 150)) {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;SRTP unprotect failed on SSRC %u because of %s %d\n&quot;</span>,</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;               <a class="code" href="../../d5/dde/rtp__engine_8h.html#af0adb620e28a15749fe5bf4f6912f00d">ast_rtp_instance_get_ssrc</a>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>), <a class="code" href="../../d8/dd4/res__srtp_8c.html#a73559cc705b835510476ad99fc4104ad">srtp_errstr</a>(res), srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a873db0c09e74a379eb9c741329f126f3">warned</a>);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a873db0c09e74a379eb9c741329f126f3">warned</a> = 11;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a873db0c09e74a379eb9c741329f126f3">warned</a>++;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;         }</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EAGAIN;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;   <span class="keywordflow">return</span> *<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;}</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#aea829ea39d65a8f324757efbe3d5bcb9">  486</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#aea829ea39d65a8f324757efbe3d5bcb9">ast_srtp_protect</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp, <span class="keywordtype">void</span> **<a class="code" href="../../d4/d11/structast__srtp.html#a4da7ebd0a2bf33074ac1826b88936875">buf</a>, <span class="keywordtype">int</span> *<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="keywordtype">int</span> rtcp)</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;{</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *localbuf;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   <span class="keywordflow">if</span> (!srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>) {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;SRTP protect %s - missing session\n&quot;</span>, rtcp ? <span class="stringliteral">&quot;rtcp&quot;</span> : <span class="stringliteral">&quot;rtp&quot;</span>);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EINVAL;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;   }</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;   <span class="keywordflow">if</span> ((*len + SRTP_MAX_TRAILER_LEN) &gt; <span class="keyword">sizeof</span>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a4da7ebd0a2bf33074ac1826b88936875">buf</a>)) {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;   }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;   localbuf = rtcp ? srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#ad4ad2853bb86f7ed84dbbccbeec3c56b">rtcpbuf</a> : srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a4da7ebd0a2bf33074ac1826b88936875">buf</a>;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   memcpy(localbuf, *buf, *len);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;   <span class="keywordflow">if</span> ((res = rtcp ? srtp_protect_rtcp(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>, localbuf, len) : srtp_protect(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>, localbuf, len)) != <a class="code" href="../../d4/dca/srtp__compat_8h.html#a3d238d91bc329c337f28ca2d3f23a467">err_status_ok</a> &amp;&amp; res != <a class="code" href="../../d4/dca/srtp__compat_8h.html#af24bc421ec61b3c9ac8d09685cf8d7b0">err_status_replay_fail</a>) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SRTP protect: %s\n&quot;</span>, <a class="code" href="../../d8/dd4/res__srtp_8c.html#a73559cc705b835510476ad99fc4104ad">srtp_errstr</a>(res));</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;   }</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   *buf = localbuf;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;   <span class="keywordflow">return</span> *<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;}</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a2ff9370aa6ad777df81de3ef7dc39b55">  514</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a2ff9370aa6ad777df81de3ef7dc39b55">ast_srtp_create</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> **srtp, <span class="keyword">struct</span> <a class="code" href="../../df/d7a/structast__rtp__instance.html">ast_rtp_instance</a> *<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>, <span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy)</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;{</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *temp;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   <span class="keywordflow">if</span> (!(temp = <a class="code" href="../../d8/dd4/res__srtp_8c.html#ac028d37052938579f977518ec30eb469">res_srtp_new</a>())) {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;   }</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#a8dea6491bedba471fc44574d76438577">ast_module_ref</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;   <span class="comment">/* Any failures after this point can use ast_srtp_destroy to destroy the instance */</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;   status = srtp_create(&amp;temp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>, &amp;policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   <span class="keywordflow">if</span> (status != <a class="code" href="../../d4/dca/srtp__compat_8h.html#a3d238d91bc329c337f28ca2d3f23a467">err_status_ok</a>) {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="comment">/* Session either wasn&#39;t created or was created and dealloced. */</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      temp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <a class="code" href="../../d8/dd4/res__srtp_8c.html#a9ea3c947f5cd82b97dc6a219810def71">ast_srtp_destroy</a>(temp);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create srtp session on rtp instance (%p) - %s\n&quot;</span>,</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            rtp, <a class="code" href="../../d8/dd4/res__srtp_8c.html#a73559cc705b835510476ad99fc4104ad">srtp_errstr</a>(status));</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;   temp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a> = <a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   *srtp = temp;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6db9934459f5cdc95cb3af77d55d426e">ao2_t_link</a>((*srtp)-&gt;policies, policy, <span class="stringliteral">&quot;Created initial policy&quot;</span>);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;}</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a81edc9ce5f56a166bdf966ff5c3ccea2">  543</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a81edc9ce5f56a166bdf966ff5c3ccea2">ast_srtp_replace</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> **srtp, <span class="keyword">struct</span> <a class="code" href="../../df/d7a/structast__rtp__instance.html">ast_rtp_instance</a> *<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>, <span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy)</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;{</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *old = *srtp;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;   <span class="keywordtype">int</span> res = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a2ff9370aa6ad777df81de3ef7dc39b55">ast_srtp_create</a>(srtp, rtp, policy);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;   <span class="keywordflow">if</span> (!res &amp;&amp; old) {</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <a class="code" href="../../d8/dd4/res__srtp_8c.html#a9ea3c947f5cd82b97dc6a219810def71">ast_srtp_destroy</a>(old);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;   }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;   <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to replace srtp (%p) on rtp instance (%p) &quot;</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="stringliteral">&quot;- keeping old\n&quot;</span>, *srtp, rtp);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;}</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a9ea3c947f5cd82b97dc6a219810def71">  560</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a9ea3c947f5cd82b97dc6a219810def71">ast_srtp_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp)</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;{</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;   <span class="keywordflow">if</span> (srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>) {</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      srtp_dealloc(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;   }</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aeca960ec22a1d0384f6e285b25df8501">ao2_t_callback</a>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">policies</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;Unallocate policy&quot;</span>);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">policies</a>, -1, <span class="stringliteral">&quot;Destroying container&quot;</span>);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(srtp);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#a15896c26e51e8162df5eb9a0124c841f">ast_module_unref</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;}</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a4343846df790beb40a23564977548686">  573</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a4343846df790beb40a23564977548686">ast_srtp_add_stream</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp, <span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy)</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;{</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *<a class="code" href="../../d5/dff/chan__iax2_8c.html#a7dd0190efe1c61151a9dbab078bdb263">match</a>;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;   <span class="comment">/* For existing streams, replace if its an SSRC stream, or bail if its a wildcard */</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   <span class="keywordflow">if</span> ((match = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a78965d7d619d6a6878c4c5657518cd91">find_policy</a>(srtp, &amp;policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a2448088751e4d494d1981c7f4b84e8d0">OBJ_POINTER</a>))) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordflow">if</span> (policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type != ssrc_specific) {</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2878d83e36d91850732bad997524e45e">AST_LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot replace an existing wildcard policy\n&quot;</span>);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(match, -1, <span class="stringliteral">&quot;Unreffing already existing policy&quot;</span>);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;         <span class="keywordflow">if</span> (srtp_remove_stream(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>, match-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.value) != <a class="code" href="../../d4/dca/srtp__compat_8h.html#a3d238d91bc329c337f28ca2d3f23a467">err_status_ok</a>) {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2878d83e36d91850732bad997524e45e">AST_LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to remove SRTP stream for SSRC %u\n&quot;</span>, match-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.value);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;         }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#abd79d7936e873108860cd00d59e1cede">ao2_t_unlink</a>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">policies</a>, match, <span class="stringliteral">&quot;Remove existing match policy&quot;</span>);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(match, -1, <span class="stringliteral">&quot;Unreffing already existing policy&quot;</span>);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;   }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Adding new policy for %s %u\n&quot;</span>,</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type == ssrc_specific ? <span class="stringliteral">&quot;SSRC&quot;</span> : <span class="stringliteral">&quot;type&quot;</span>,</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type == ssrc_specific ? policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.value : policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;   <span class="keywordflow">if</span> (srtp_add_stream(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>, &amp;policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>) != <a class="code" href="../../d4/dca/srtp__compat_8h.html#a3d238d91bc329c337f28ca2d3f23a467">err_status_ok</a>) {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2878d83e36d91850732bad997524e45e">AST_LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to add SRTP stream for %s %u\n&quot;</span>,</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;         policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type == ssrc_specific ? <span class="stringliteral">&quot;SSRC&quot;</span> : <span class="stringliteral">&quot;type&quot;</span>,</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;         policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type == ssrc_specific ? policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.value : policy-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.type);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;   }</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6db9934459f5cdc95cb3af77d55d426e">ao2_t_link</a>(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">policies</a>, policy, <span class="stringliteral">&quot;Added additional stream&quot;</span>);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;}</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a617fc2aa94ffdeeceb3830df5e058078">  607</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a617fc2aa94ffdeeceb3830df5e058078">ast_srtp_change_source</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d11/structast__srtp.html">ast_srtp</a> *srtp, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> from_ssrc, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> to_ssrc)</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;{</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *<a class="code" href="../../d5/dff/chan__iax2_8c.html#a7dd0190efe1c61151a9dbab078bdb263">match</a>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;   <span class="keyword">struct </span>srtp_policy_t sp = {</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      .ssrc.type = ssrc_specific,</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      .ssrc.value = from_ssrc,</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   };</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   <a class="code" href="../../d4/dca/srtp__compat_8h.html#ab5c813cf69f137b0c133a1921b0fc61d">err_status_t</a> <a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   <span class="comment">/* If we find a match, return and unlink it from the container so we</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">    * can change the SSRC (which is part of the hash) and then have</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">    * ast_srtp_add_stream link it back in if all is well */</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;   <span class="keywordflow">if</span> ((match = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a78965d7d619d6a6878c4c5657518cd91">find_policy</a>(srtp, &amp;sp, <a class="code" href="../../d5/da5/astobj2_8h.html#a2448088751e4d494d1981c7f4b84e8d0">OBJ_POINTER</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a>))) {</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      match-&gt;<a class="code" href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">sp</a>.ssrc.value = to_ssrc;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d8/dd4/res__srtp_8c.html#a4343846df790beb40a23564977548686">ast_srtp_add_stream</a>(srtp, match)) {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t add stream\n&quot;</span>);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((status = srtp_remove_stream(srtp-&gt;<a class="code" href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">session</a>, from_ssrc))) {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Couldn&#39;t remove stream (%u)\n&quot;</span>, status);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      }</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(match, -1, <span class="stringliteral">&quot;Unreffing found policy in change_source&quot;</span>);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;   }</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;}</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno"><a class="line" href="../../dc/da1/structast__sdp__crypto.html">  632</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../dc/da1/structast__sdp__crypto.html">ast_sdp_crypto</a> {</div><div class="line"><a name="l00633"></a><span class="lineno"><a class="line" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">  633</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a>;</div><div class="line"><a name="l00634"></a><span class="lineno"><a class="line" href="../../dc/da1/structast__sdp__crypto.html#a8d5fbc3175cd5d4deecca75751969924">  634</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> local_key[SRTP_MAX_KEY_LEN];</div><div class="line"><a name="l00635"></a><span class="lineno"><a class="line" href="../../dc/da1/structast__sdp__crypto.html#aab34f2fc02b4a86bea93c68e1ec09d75">  635</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dc/da1/structast__sdp__crypto.html#aab34f2fc02b4a86bea93c68e1ec09d75">tag</a>;</div><div class="line"><a name="l00636"></a><span class="lineno"><a class="line" href="../../dc/da1/structast__sdp__crypto.html#aa49742b3622b4d9ac9f632df693fdfa2">  636</a></span>&#160;   <span class="keywordtype">char</span> local_key64[((SRTP_MAX_KEY_LEN) * 8 + 5) / 6 + 1];</div><div class="line"><a name="l00637"></a><span class="lineno"><a class="line" href="../../dc/da1/structast__sdp__crypto.html#abc48d3849d5cfe9785371e6b51684844">  637</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> remote_key[SRTP_MAX_KEY_LEN];</div><div class="line"><a name="l00638"></a><span class="lineno"><a class="line" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">  638</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">key_len</a>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;};</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#aaf948ebbf16a04a556cea3a62bd1ee4d">  641</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#aaf948ebbf16a04a556cea3a62bd1ee4d">res_sdp_crypto_dtor</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/da1/structast__sdp__crypto.html">ast_sdp_crypto</a> *crypto)</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;{</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;   <span class="keywordflow">if</span> (crypto) {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(crypto-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a>);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      crypto-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(crypto);</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <a class="code" href="../../d5/d16/module_8h.html#a15896c26e51e8162df5eb9a0124c841f">ast_module_unref</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;}</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a7be1a694a111552b2f84a3606a8fb201">  652</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/da1/structast__sdp__crypto.html">ast_sdp_crypto</a> *<a class="code" href="../../d8/dd4/res__srtp_8c.html#a7be1a694a111552b2f84a3606a8fb201">crypto_init_keys</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/da1/structast__sdp__crypto.html">ast_sdp_crypto</a> *p, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">key_len</a>)</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;{</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../dc/da1/structast__sdp__crypto.html#abc48d3849d5cfe9785371e6b51684844">remote_key</a>[<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">key_len</a>];</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;   <span class="keywordflow">if</span> (srtp_res.<a class="code" href="../../d0/d5d/structast__srtp__res.html#a89e68ba0bd0d64ff39301d38f624aea0">get_random</a>(p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a8d5fbc3175cd5d4deecca75751969924">local_key</a>, key_len) &lt; 0) {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;   }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a555dad1bd5b23acf01cf08f1affab879">ast_base64encode</a>(p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aa49742b3622b4d9ac9f632df693fdfa2">local_key64</a>, p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a8d5fbc3175cd5d4deecca75751969924">local_key</a>, key_len, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aa49742b3622b4d9ac9f632df693fdfa2">local_key64</a>));</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;   p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">key_len</a> = <a class="code" href="../../d5/d60/utils_8h.html#a1e7e06bd20719ecfd58b67f230780ffa">ast_base64decode</a>(remote_key, p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aa49742b3622b4d9ac9f632df693fdfa2">local_key64</a>, <span class="keyword">sizeof</span>(remote_key));</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">key_len</a> != key_len) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;base64 encode/decode bad len %d != %d\n&quot;</span>, p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">key_len</a>, key_len);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;   }</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;   <span class="keywordflow">if</span> (memcmp(remote_key, p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a8d5fbc3175cd5d4deecca75751969924">local_key</a>, p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">key_len</a>)) {</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;base64 encode/decode bad key\n&quot;</span>);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;   }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1 , <span class="stringliteral">&quot;local_key64 %s len %zu\n&quot;</span>, p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aa49742b3622b4d9ac9f632df693fdfa2">local_key64</a>, strlen(p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aa49742b3622b4d9ac9f632df693fdfa2">local_key64</a>));</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;   <span class="keywordflow">return</span> p;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;}</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a61bb4bcd1003afaa50d1835687bd096e">  679</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/da1/structast__sdp__crypto.html">ast_sdp_crypto</a> *<a class="code" href="../../d8/dd4/res__srtp_8c.html#a61bb4bcd1003afaa50d1835687bd096e">sdp_crypto_alloc</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">key_len</a>)</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;{</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/da1/structast__sdp__crypto.html">ast_sdp_crypto</a> *p, *<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;   <span class="keywordflow">if</span> (!(p = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*p)))) {</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;   }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aab34f2fc02b4a86bea93c68e1ec09d75">tag</a> = 1;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#a8dea6491bedba471fc44574d76438577">ast_module_ref</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   <span class="comment">/* default is a key which uses AST_AES_CM_128_HMAC_SHA1_xx */</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   result = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a7be1a694a111552b2f84a3606a8fb201">crypto_init_keys</a>(p, key_len);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;   <span class="keywordflow">if</span> (!result) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <a class="code" href="../../d8/dd4/res__srtp_8c.html#aaf948ebbf16a04a556cea3a62bd1ee4d">res_sdp_crypto_dtor</a>(p);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;   }</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;}</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a3e942904dfadda793804fb284d649469">  698</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/da1/structast__sdp__crypto.html">ast_sdp_crypto</a> *<a class="code" href="../../d8/dd4/res__srtp_8c.html#a3e942904dfadda793804fb284d649469">res_sdp_crypto_alloc</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;{</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a61bb4bcd1003afaa50d1835687bd096e">sdp_crypto_alloc</a>(<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a4e6aec67d7670cbcf4efa4ac86c8d242">SRTP_MASTER_KEY_LEN</a>);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;}</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#ae192a81241a6175dfcfb361ef86e88af">  703</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#ae192a81241a6175dfcfb361ef86e88af">res_sdp_crypto_build_offer</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/da1/structast__sdp__crypto.html">ast_sdp_crypto</a> *p, <span class="keywordtype">int</span> taglen)</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;{</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;   <span class="comment">/* Rebuild the crypto line */</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a>);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;   p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;   <span class="keywordflow">if</span> ((taglen &amp; 0x007f) == 8) {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      res = <a class="code" href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a>(&amp;p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a>, <span class="stringliteral">&quot;%d AEAD_AES_%d_GCM_%d inline:%s&quot;</span>,</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;         p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aab34f2fc02b4a86bea93c68e1ec09d75">tag</a>, 128 + ((taglen &amp; 0x0300) &gt;&gt; 2), taglen &amp; 0x007f, p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aa49742b3622b4d9ac9f632df693fdfa2">local_key64</a>);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((taglen &amp; 0x007f) == 16) {</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      res = <a class="code" href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a>(&amp;p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a>, <span class="stringliteral">&quot;%d AEAD_AES_%d_GCM inline:%s&quot;</span>,</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;         p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aab34f2fc02b4a86bea93c68e1ec09d75">tag</a>, 128 + ((taglen &amp; 0x0300) &gt;&gt; 2), p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aa49742b3622b4d9ac9f632df693fdfa2">local_key64</a>);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((taglen &amp; 0x0300) &amp;&amp; !(taglen &amp; 0x0080)) {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      res = <a class="code" href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a>(&amp;p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a>, <span class="stringliteral">&quot;%d AES_%d_CM_HMAC_SHA1_%d inline:%s&quot;</span>,</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;         p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aab34f2fc02b4a86bea93c68e1ec09d75">tag</a>, 128 + ((taglen &amp; 0x0300) &gt;&gt; 2), taglen &amp; 0x007f, p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aa49742b3622b4d9ac9f632df693fdfa2">local_key64</a>);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      res = <a class="code" href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a>(&amp;p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a>, <span class="stringliteral">&quot;%d AES_CM_%d_HMAC_SHA1_%d inline:%s&quot;</span>,</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;         p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aab34f2fc02b4a86bea93c68e1ec09d75">tag</a>, 128 + ((taglen &amp; 0x0300) &gt;&gt; 2), taglen &amp; 0x007f, p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aa49742b3622b4d9ac9f632df693fdfa2">local_key64</a>);</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;   }</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;   <span class="keywordflow">if</span> (res == -1 || !p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a>) {</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not allocate memory for crypto line\n&quot;</span>);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;   }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Crypto line: a=crypto:%s\n&quot;</span>, p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a>);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;}</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a53cbea1c07124db2a41f78d35306bd15">  734</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a53cbea1c07124db2a41f78d35306bd15">set_crypto_policy</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *policy, <span class="keywordtype">int</span> suite_val, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *master_key, <span class="keywordtype">int</span> <a class="code" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">key_len</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ssrc, <span class="keywordtype">int</span> inbound)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;{</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;   <span class="keywordflow">if</span> (policy_res.<a class="code" href="../../d6/d13/structast__srtp__policy__res.html#a6d3b06b446bad25d4e5e72520207ea94">set_master_key</a>(policy, master_key, key_len, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0) &lt; 0) {</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;   }</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;   <span class="keywordflow">if</span> (policy_res.<a class="code" href="../../d6/d13/structast__srtp__policy__res.html#ac7a970a458c4bfc1df1f46f136e5ea7c">set_suite</a>(policy, suite_val)) {</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not set remote SRTP suite\n&quot;</span>);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   policy_res.<a class="code" href="../../d6/d13/structast__srtp__policy__res.html#aa3ccd59da0f4a72ef29e03e013154d77">set_ssrc</a>(policy, ssrc, inbound);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;}</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a276c692113160e8211b210dab9b9c988">  750</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a276c692113160e8211b210dab9b9c988">crypto_activate</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/da1/structast__sdp__crypto.html">ast_sdp_crypto</a> *p, <span class="keywordtype">int</span> suite_val, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/da1/structast__sdp__crypto.html#abc48d3849d5cfe9785371e6b51684844">remote_key</a>, <span class="keywordtype">int</span> <a class="code" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">key_len</a>, <span class="keyword">struct</span> <a class="code" href="../../df/d7a/structast__rtp__instance.html">ast_rtp_instance</a> *<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;{</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *local_policy = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a> *remote_policy = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/db0/structast__rtp__instance__stats.html">ast_rtp_instance_stats</a> stats = {0,};</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;   <span class="keywordtype">int</span> res = -1;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;   <span class="keywordflow">if</span> (!p) {</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;   }</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;   <span class="keywordflow">if</span> (!(local_policy = policy_res.<a class="code" href="../../d6/d13/structast__srtp__policy__res.html#a6ac2385237fe875d599a88bac10969f9">alloc</a>())) {</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;   }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;   <span class="keywordflow">if</span> (!(remote_policy = policy_res.<a class="code" href="../../d6/d13/structast__srtp__policy__res.html#a6ac2385237fe875d599a88bac10969f9">alloc</a>())) {</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;   }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/rtp__engine_8h.html#a82a029e03affad8a6e1b322c0b9fe2c3">ast_rtp_instance_get_stats</a>(rtp, &amp;stats, <a class="code" href="../../d5/dde/rtp__engine_8h.html#a52d18270f48752558c84d7760c82378faa038ce8bbd3a0f5663deced5625cb32e">AST_RTP_INSTANCE_STAT_LOCAL_SSRC</a>)) {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;   }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dd4/res__srtp_8c.html#a53cbea1c07124db2a41f78d35306bd15">set_crypto_policy</a>(local_policy, suite_val, p-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a8d5fbc3175cd5d4deecca75751969924">local_key</a>, key_len, stats.<a class="code" href="../../d0/db0/structast__rtp__instance__stats.html#a345269c0d57add15c919b781d140e011">local_ssrc</a>, 0) &lt; 0) {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;   }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dd4/res__srtp_8c.html#a53cbea1c07124db2a41f78d35306bd15">set_crypto_policy</a>(remote_policy, suite_val, remote_key, key_len, 0, 1) &lt; 0) {</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;   }</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;   <span class="comment">/* Add the SRTP policies */</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/rtp__engine_8h.html#af63b14f966292c58be12163e0df79924">ast_rtp_instance_add_srtp_policy</a>(rtp, remote_policy, local_policy, 0)) {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not set SRTP policies\n&quot;</span>);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="keywordflow">goto</span> err;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;   }</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1 , <span class="stringliteral">&quot;SRTP policy activated\n&quot;</span>);</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;   res = 0;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;err:</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   <span class="keywordflow">if</span> (local_policy) {</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      policy_res.<a class="code" href="../../d6/d13/structast__srtp__policy__res.html#a525be71c88aa49ab8bd19f7b146945d7">destroy</a>(local_policy);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;   }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;   <span class="keywordflow">if</span> (remote_policy) {</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      policy_res.<a class="code" href="../../d6/d13/structast__srtp__policy__res.html#a525be71c88aa49ab8bd19f7b146945d7">destroy</a>(remote_policy);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;   }</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;}</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a7a6a207336790d8d8cd49bfb3a7e29d9">  802</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a7a6a207336790d8d8cd49bfb3a7e29d9">res_sdp_crypto_parse_offer</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d7a/structast__rtp__instance.html">ast_rtp_instance</a> *<a class="code" href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">rtp</a>, <span class="keyword">struct</span> <a class="code" href="../../de/df7/structast__sdp__srtp.html">ast_sdp_srtp</a> *srtp, <span class="keyword">const</span> <span class="keywordtype">char</span> *attr)</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;{</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;   <span class="keywordtype">char</span> *tag = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   <span class="keywordtype">char</span> *suite = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   <span class="keywordtype">char</span> *key_params = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;   <span class="keywordtype">char</span> *key_param = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;   <span class="keywordtype">char</span> *session_params = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;   <span class="keywordtype">char</span> *key_salt = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;       <span class="comment">/* The actual master key and key salt */</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;   <span class="keywordtype">char</span> *lifetime = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;       <span class="comment">/* Key lifetime (# of RTP packets) */</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;   <span class="keywordtype">char</span> *mki = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;            <span class="comment">/* Master Key Index */</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;   <span class="keywordtype">int</span> found = 0;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;   <span class="keywordtype">int</span> key_len_from_sdp;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;   <span class="keywordtype">int</span> key_len_expected;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;   <span class="keywordtype">int</span> tag_from_sdp;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;   <span class="keywordtype">int</span> suite_val = 0;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> remote_key[SRTP_MAX_KEY_LEN];</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;   <span class="keywordtype">int</span> taglen;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;   <span class="keywordtype">double</span> sdes_lifetime;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/da1/structast__sdp__crypto.html">ast_sdp_crypto</a> *crypto;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/df7/structast__sdp__srtp.html">ast_sdp_srtp</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;   str = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(attr);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;   tag = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;str, <span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   suite = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;str, <span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;   key_params = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;str, <span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;   session_params = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;str, <span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;   <span class="keywordflow">if</span> (!tag || !suite) {</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unrecognized crypto attribute a=%s\n&quot;</span>, attr);</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;   }</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;   <span class="comment">/* RFC4568 9.1 - tag is 1-9 digits */</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;   <span class="keywordflow">if</span> (sscanf(tag, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;tag_from_sdp) != 1 || tag_from_sdp &lt; 0 || tag_from_sdp &gt; 999999999) {</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unacceptable a=crypto tag: %s\n&quot;</span>, tag);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;   }</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(session_params)) {</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported crypto parameters: %s\n&quot;</span>, session_params);</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;   }</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;   <span class="comment">/* On egress, Asterisk sent several crypto lines in the SIP/SDP offer</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">      The remote party might have choosen another line than the first */</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;   <span class="keywordflow">for</span> (tmp = srtp; tmp &amp;&amp; tmp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a> &amp;&amp; tmp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a>-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aab34f2fc02b4a86bea93c68e1ec09d75">tag</a> != tag_from_sdp;) {</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      tmp = <a class="code" href="../../df/d90/linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6">AST_LIST_NEXT</a>(tmp, <a class="code" href="../../de/df7/structast__sdp__srtp.html#a5a5ec5b4367a29990ee49ae4657d94ae">sdp_srtp_list</a>);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;   }</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;   <span class="keywordflow">if</span> (tmp) { <span class="comment">/* tag matched an already created crypto line */</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../de/df7/structast__sdp__srtp.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = tmp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      <span class="comment">/* Make that crypto line the head of the list, not by changing the</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">         list structure but by exchanging the content of the list members */</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      crypto = tmp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a>;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      tmp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a> = srtp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a>;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      tmp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = srtp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      srtp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a> = <a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a>;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      srtp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = <a class="code" href="../../de/df7/structast__sdp__srtp.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      crypto = srtp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a>;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      crypto-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aab34f2fc02b4a86bea93c68e1ec09d75">tag</a> = tag_from_sdp;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;   }</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a8e74dd423c2648d18ee07d22e7e74dea">AST_SRTP_CRYPTO_TAG_8</a>);</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a6296427afbcd34c9f9019f1b1209a9eb">AST_SRTP_CRYPTO_TAG_16</a>);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a802b4a2ad413c6318c31a079b2de7b16">AST_SRTP_CRYPTO_TAG_32</a>);</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a7690a632725e41edf28f502b45ececdb">AST_SRTP_CRYPTO_TAG_80</a>);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a9ff7daa74cea8005427d0967b6f373e0">AST_SRTP_CRYPTO_AES_192</a>);</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a>);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#adac8b810f4e4e2eb647da095a97994ae">AST_SRTP_CRYPTO_OLD_NAME</a>);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;   <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AES_CM_128_HMAC_SHA1_80&quot;</span>)) {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a01497082a505f28b44550e051c01db16">AST_AES_CM_128_HMAC_SHA1_80</a>;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a7690a632725e41edf28f502b45ececdb">AST_SRTP_CRYPTO_TAG_80</a>);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      key_len_expected = 30;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AES_CM_128_HMAC_SHA1_32&quot;</span>)) {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a18639c7f72572ae21023a76ad8ec36b7">AST_AES_CM_128_HMAC_SHA1_32</a>;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a802b4a2ad413c6318c31a079b2de7b16">AST_SRTP_CRYPTO_TAG_32</a>);</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      key_len_expected = 30;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="preprocessor">#ifdef HAVE_SRTP_192</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AES_192_CM_HMAC_SHA1_80&quot;</span>)) {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a541332fc9fec9829891e0ac434ae15b8">AST_AES_CM_192_HMAC_SHA1_80</a>;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a7690a632725e41edf28f502b45ececdb">AST_SRTP_CRYPTO_TAG_80</a>);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a9ff7daa74cea8005427d0967b6f373e0">AST_SRTP_CRYPTO_AES_192</a>);</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      key_len_expected = 38;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AES_192_CM_HMAC_SHA1_32&quot;</span>)) {</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a8a74712b46d46ddcadd16112c812a149">AST_AES_CM_192_HMAC_SHA1_32</a>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a802b4a2ad413c6318c31a079b2de7b16">AST_SRTP_CRYPTO_TAG_32</a>);</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a9ff7daa74cea8005427d0967b6f373e0">AST_SRTP_CRYPTO_AES_192</a>);</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      key_len_expected = 38;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   <span class="comment">/* RFC used a different name while in draft, some still use that */</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AES_CM_192_HMAC_SHA1_80&quot;</span>)) {</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a541332fc9fec9829891e0ac434ae15b8">AST_AES_CM_192_HMAC_SHA1_80</a>;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a7690a632725e41edf28f502b45ececdb">AST_SRTP_CRYPTO_TAG_80</a>);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a9ff7daa74cea8005427d0967b6f373e0">AST_SRTP_CRYPTO_AES_192</a>);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#adac8b810f4e4e2eb647da095a97994ae">AST_SRTP_CRYPTO_OLD_NAME</a>);</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      key_len_expected = 38;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AES_CM_192_HMAC_SHA1_32&quot;</span>)) {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a8a74712b46d46ddcadd16112c812a149">AST_AES_CM_192_HMAC_SHA1_32</a>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a802b4a2ad413c6318c31a079b2de7b16">AST_SRTP_CRYPTO_TAG_32</a>);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a9ff7daa74cea8005427d0967b6f373e0">AST_SRTP_CRYPTO_AES_192</a>);</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#adac8b810f4e4e2eb647da095a97994ae">AST_SRTP_CRYPTO_OLD_NAME</a>);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      key_len_expected = 38;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="preprocessor">#ifdef HAVE_SRTP_256</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AES_256_CM_HMAC_SHA1_80&quot;</span>)) {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a7b668ad7b65feef20f16240e81cb206d">AST_AES_CM_256_HMAC_SHA1_80</a>;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a7690a632725e41edf28f502b45ececdb">AST_SRTP_CRYPTO_TAG_80</a>);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a>);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      key_len_expected = 46;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AES_256_CM_HMAC_SHA1_32&quot;</span>)) {</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a2a223fc6539b2a452d5aba09683241dd">AST_AES_CM_256_HMAC_SHA1_32</a>;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a802b4a2ad413c6318c31a079b2de7b16">AST_SRTP_CRYPTO_TAG_32</a>);</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a>);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      key_len_expected = 46;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   <span class="comment">/* RFC used a different name while in draft, some still use that */</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AES_CM_256_HMAC_SHA1_80&quot;</span>)) {</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a7b668ad7b65feef20f16240e81cb206d">AST_AES_CM_256_HMAC_SHA1_80</a>;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a7690a632725e41edf28f502b45ececdb">AST_SRTP_CRYPTO_TAG_80</a>);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a>);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#adac8b810f4e4e2eb647da095a97994ae">AST_SRTP_CRYPTO_OLD_NAME</a>);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      key_len_expected = 46;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AES_CM_256_HMAC_SHA1_32&quot;</span>)) {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a2a223fc6539b2a452d5aba09683241dd">AST_AES_CM_256_HMAC_SHA1_32</a>;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a802b4a2ad413c6318c31a079b2de7b16">AST_SRTP_CRYPTO_TAG_32</a>);</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a>);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#adac8b810f4e4e2eb647da095a97994ae">AST_SRTP_CRYPTO_OLD_NAME</a>);</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      key_len_expected = 46;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="preprocessor">#ifdef HAVE_SRTP_GCM</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AEAD_AES_128_GCM&quot;</span>)) {</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a05d42d7c20a4d79f75915ac05800c625">AST_AES_GCM_128</a>;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a6296427afbcd34c9f9019f1b1209a9eb">AST_SRTP_CRYPTO_TAG_16</a>);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      key_len_expected = <a class="code" href="../../d4/dca/srtp__compat_8h.html#a7a9a56541b1e42cdc627557f802e4e07">AES_128_GCM_KEYSIZE_WSALT</a>;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AEAD_AES_256_GCM&quot;</span>)) {</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a01b96b477f9aa8654ea4e206f0fdd2eb">AST_AES_GCM_256</a>;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a6296427afbcd34c9f9019f1b1209a9eb">AST_SRTP_CRYPTO_TAG_16</a>);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a>);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      key_len_expected = <a class="code" href="../../d4/dca/srtp__compat_8h.html#ab02cf8f6ef989718a9a0307358f63185">AES_256_GCM_KEYSIZE_WSALT</a>;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;   <span class="comment">/* RFC contained a (too) short auth tag for RTP media, some still use that */</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AEAD_AES_128_GCM_8&quot;</span>)) {</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a8868834307ac79c572cf74f122de5df6">AST_AES_GCM_128_8</a>;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a8e74dd423c2648d18ee07d22e7e74dea">AST_SRTP_CRYPTO_TAG_8</a>);</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      key_len_expected = <a class="code" href="../../d4/dca/srtp__compat_8h.html#a7a9a56541b1e42cdc627557f802e4e07">AES_128_GCM_KEYSIZE_WSALT</a>;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suite, <span class="stringliteral">&quot;AEAD_AES_256_GCM_8&quot;</span>)) {</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      suite_val = <a class="code" href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606af343453fbb06186800265d1eb08c6aaf">AST_AES_GCM_256_8</a>;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a8e74dd423c2648d18ee07d22e7e74dea">AST_SRTP_CRYPTO_TAG_8</a>);</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a>);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      key_len_expected = <a class="code" href="../../d4/dca/srtp__compat_8h.html#ab02cf8f6ef989718a9a0307358f63185">AES_256_GCM_KEYSIZE_WSALT</a>;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Unsupported crypto suite: %s\n&quot;</span>, suite);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;   }</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;   <span class="keywordflow">while</span> ((key_param = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;key_params, <span class="stringliteral">&quot;;&quot;</span>))) {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_lifetime;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="../../de/d96/res__pjsip_8c.html#a8b44a03925325ceaf2de7b079b1541a1">method</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      method = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;key_param, <span class="stringliteral">&quot;:&quot;</span>);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      info = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;key_param, <span class="stringliteral">&quot;;&quot;</span>);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      sdes_lifetime = 0;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="keywordflow">if</span> (strcmp(method, <span class="stringliteral">&quot;inline&quot;</span>)) {</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      }</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      key_salt = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;info, <span class="stringliteral">&quot;|&quot;</span>);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="comment">/* The next parameter can be either lifetime or MKI */</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      lifetime = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;info, <span class="stringliteral">&quot;|&quot;</span>);</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keywordflow">if</span> (!lifetime) {</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;         found = 1;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      }</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      mki = strchr(lifetime, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      <span class="keywordflow">if</span> (mki) {</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;         mki = lifetime;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;         lifetime = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;         mki = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;info, <span class="stringliteral">&quot;|&quot;</span>);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      }</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="keywordflow">if</span> (mki &amp;&amp; *mki != <span class="charliteral">&#39;1&#39;</span>) {</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Crypto MKI handling is not supported: ignoring attribute %s\n&quot;</span>, attr);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      }</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <span class="keywordflow">if</span> (lifetime) {</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;         <span class="keywordflow">if</span> (!strncmp(lifetime, <span class="stringliteral">&quot;2^&quot;</span>, 2)) {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            <span class="keywordtype">char</span> *lifetime_val = lifetime + 2;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            <span class="comment">/* Exponential lifetime */</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            <span class="keywordflow">if</span> (sscanf(lifetime_val, <span class="stringliteral">&quot;%30u&quot;</span>, &amp;n_lifetime) != 1) {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Failed to parse lifetime value in crypto attribute: %s\n&quot;</span>, attr);</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            }</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            <span class="keywordflow">if</span> (n_lifetime &gt; 48) {</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;               <span class="comment">/* Yeah... that&#39;s a bit big. */</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Crypto lifetime exponent of &#39;%u&#39; is a bit large; using 48\n&quot;</span>, n_lifetime);</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;               n_lifetime = 48;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            }</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            sdes_lifetime = pow(2, n_lifetime);</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            <span class="comment">/* Decimal lifetime */</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            <span class="keywordflow">if</span> (sscanf(lifetime, <span class="stringliteral">&quot;%30u&quot;</span>, &amp;n_lifetime) != 1) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Failed to parse lifetime value in crypto attribute: %s\n&quot;</span>, attr);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;            }</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            sdes_lifetime = n_lifetime;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;         }</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;         <span class="comment">/* Accept anything above ~5.8 hours. Less than ~5.8; reject. */</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;         <span class="keywordflow">if</span> (sdes_lifetime &lt; 1048576) {</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Rejecting crypto attribute &#39;%s&#39;: lifetime &#39;%f&#39; too short\n&quot;</span>, attr, sdes_lifetime);</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;         }</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      }</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Crypto attribute &#39;%s&#39; accepted with lifetime &#39;%f&#39;, MKI &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;         attr, sdes_lifetime, mki ? mki : <span class="stringliteral">&quot;-&quot;</span>);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      found = 1;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;   }</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;   <span class="keywordflow">if</span> (!found) {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;SRTP crypto offer not acceptable: &#39;%s&#39;\n&quot;</span>, attr);</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;   }</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;   key_len_from_sdp = <a class="code" href="../../d5/d60/utils_8h.html#a1e7e06bd20719ecfd58b67f230780ffa">ast_base64decode</a>(remote_key, key_salt, <span class="keyword">sizeof</span>(remote_key));</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;   <span class="keywordflow">if</span> (key_len_from_sdp != key_len_expected) {</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SRTP descriptions key length is &#39;%d&#39;, not &#39;%d&#39;\n&quot;</span>,</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;         key_len_from_sdp, key_len_expected);</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;   }</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="comment">/* on default, the key is 30 (AES-128); throw that away (only) when the suite changed actually */</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;   <span class="comment">/* ingress: optional, but saves one expensive call to get_random(.) */</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;   <span class="comment">/*  egress: required, because the local key was communicated before the remote key is processed */</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;   <span class="keywordflow">if</span> (crypto-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">key_len</a> != key_len_from_sdp) {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d8/dd4/res__srtp_8c.html#a7be1a694a111552b2f84a3606a8fb201">crypto_init_keys</a>(crypto, key_len_from_sdp)) {</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      }</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!memcmp(crypto-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#abc48d3849d5cfe9785371e6b51684844">remote_key</a>, remote_key, key_len_from_sdp)) {</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;SRTP remote key unchanged; maintaining current policy\n&quot;</span>);</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;   }</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;   <span class="keywordflow">if</span> (key_len_from_sdp &gt; <span class="keyword">sizeof</span>(crypto-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#abc48d3849d5cfe9785371e6b51684844">remote_key</a>)) {</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;         <span class="stringliteral">&quot;SRTP key buffer is %zu although it must be at least %d bytes\n&quot;</span>,</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;         <span class="keyword">sizeof</span>(crypto-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#abc48d3849d5cfe9785371e6b51684844">remote_key</a>), key_len_from_sdp);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;   }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;   memcpy(crypto-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#abc48d3849d5cfe9785371e6b51684844">remote_key</a>, remote_key, key_len_from_sdp);</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dd4/res__srtp_8c.html#a276c692113160e8211b210dab9b9c988">crypto_activate</a>(crypto, suite_val, remote_key, key_len_from_sdp, rtp) &lt; 0) {</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;   }</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a802b4a2ad413c6318c31a079b2de7b16">AST_SRTP_CRYPTO_TAG_32</a>)) {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      taglen = 32;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a6296427afbcd34c9f9019f1b1209a9eb">AST_SRTP_CRYPTO_TAG_16</a>)) {</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      taglen = 16;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a8e74dd423c2648d18ee07d22e7e74dea">AST_SRTP_CRYPTO_TAG_8</a>)) {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      taglen = 8;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      taglen = 80;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;   }</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a>)) {</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      taglen |= 0x0200;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a9ff7daa74cea8005427d0967b6f373e0">AST_SRTP_CRYPTO_AES_192</a>)) {</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      taglen |= 0x0100;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;   }</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#adac8b810f4e4e2eb647da095a97994ae">AST_SRTP_CRYPTO_OLD_NAME</a>)) {</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      taglen |= 0x0080;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;   }</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;   <span class="comment">/* Finally, rebuild the crypto line */</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dd4/res__srtp_8c.html#ae192a81241a6175dfcfb361ef86e88af">res_sdp_crypto_build_offer</a>(crypto, taglen)) {</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;   }</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#aeef2a537f4fed48886a3f9c316a45285">AST_SRTP_CRYPTO_OFFER_OK</a>);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;}</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a980edcd78788c75d5f19d9a90cd5db6c"> 1096</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dd4/res__srtp_8c.html#a980edcd78788c75d5f19d9a90cd5db6c">res_sdp_srtp_get_attr</a>(<span class="keyword">struct</span> <a class="code" href="../../de/df7/structast__sdp__srtp.html">ast_sdp_srtp</a> *srtp, <span class="keywordtype">int</span> dtls_enabled, <span class="keywordtype">int</span> default_taglen_32)</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;{</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;   <span class="keywordtype">int</span> taglen;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;   <span class="keywordflow">if</span> (!srtp) {</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;   }</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;   <span class="comment">/* Set encryption properties */</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;   <span class="keywordflow">if</span> (!srtp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a>) {</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../df/d90/linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6">AST_LIST_NEXT</a>(srtp, <a class="code" href="../../de/df7/structast__sdp__srtp.html#a5a5ec5b4367a29990ee49ae4657d94ae">sdp_srtp_list</a>)) {</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;         srtp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a> = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a3e942904dfadda793804fb284d649469">res_sdp_crypto_alloc</a>();</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;SRTP SDP list was not empty\n&quot;</span>);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = default_taglen_32 ? <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a802b4a2ad413c6318c31a079b2de7b16">AST_SRTP_CRYPTO_TAG_32</a> : <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a7690a632725e41edf28f502b45ececdb">AST_SRTP_CRYPTO_TAG_80</a>;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">int</span> attr[][3] = {</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;         <span class="comment">/* This array creates the following list:</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">          * a=crypto:1 AES_CM_128_HMAC_SHA1_ ...</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">          * a=crypto:2 AEAD_AES_128_GCM ...</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">          * a=crypto:3 AES_256_CM_HMAC_SHA1_ ...</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">          * a=crypto:4 AEAD_AES_256_GCM ...</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">          * a=crypto:5 AES_192_CM_HMAC_SHA1_ ...</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment">          * something like &#39;AEAD_AES_192_GCM&#39; is not specified by the RFCs</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">          *</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">          * If you want to prefer another crypto suite or you want to</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">          * exclude a suite, change this array and recompile Asterisk.</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">          * This list cannot be changed from rtp.conf because you should</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">          * know what you are doing. Especially AES-192 and AES-GCM are</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">          * broken in many VoIP clients, see</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">          * https://github.com/cisco/libsrtp/pull/170</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">          * https://github.com/cisco/libsrtp/pull/184</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">          * Furthermore, AES-GCM uses a shorter crypto-suite string which</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">          * causes Nokia phones based on Symbian/S60 to reject the whole</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">          * INVITE with status 500, even if a matching suite was offered.</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">          * AES-256 might just waste your processor cycles, especially if</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">          * your TLS transport is not secured with equivalent grade, see</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">          * https://security.stackexchange.com/q/61361</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">          * Therefore, AES-128 was preferred here.</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">          *</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">          * If you want to enable one of those defines, please, go for</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">          * CFLAGS=&#39;-DENABLE_SRTP_AES_GCM&#39; ./configure &amp;&amp; sudo make install</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;            { <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, 0, 30 },</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="preprocessor">#if defined(HAVE_SRTP_GCM) &amp;&amp; defined(ENABLE_SRTP_AES_GCM)</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            { <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a6296427afbcd34c9f9019f1b1209a9eb">AST_SRTP_CRYPTO_TAG_16</a>, 0, <a class="code" href="../../d4/dca/srtp__compat_8h.html#a7a9a56541b1e42cdc627557f802e4e07">AES_128_GCM_KEYSIZE_WSALT</a> },</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="preprocessor">#if defined(HAVE_SRTP_256) &amp;&amp; defined(ENABLE_SRTP_AES_256)</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;            { <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a>, 46 },</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="preprocessor">#if defined(HAVE_SRTP_GCM) &amp;&amp; defined(ENABLE_SRTP_AES_GCM) &amp;&amp; defined(ENABLE_SRTP_AES_256)</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            { <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a6296427afbcd34c9f9019f1b1209a9eb">AST_SRTP_CRYPTO_TAG_16</a>, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a>, <a class="code" href="../../d4/dca/srtp__compat_8h.html#ab02cf8f6ef989718a9a0307358f63185">AES_256_GCM_KEYSIZE_WSALT</a> },</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="preprocessor">#if defined(HAVE_SRTP_192) &amp;&amp; defined(ENABLE_SRTP_AES_192)</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            { <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a9ff7daa74cea8005427d0967b6f373e0">AST_SRTP_CRYPTO_AES_192</a>, 38 },</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;         };</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../de/df7/structast__sdp__srtp.html">ast_sdp_srtp</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a> = srtp;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;         <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(attr); i++) {</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            <span class="keywordflow">if</span> (attr[i][0]) {</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;               <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(tmp, attr[i][0]);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;            }</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            <span class="keywordflow">if</span> (attr[i][1]) {</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;               <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(tmp, attr[i][1]);</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;            }</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            tmp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a> = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a61bb4bcd1003afaa50d1835687bd096e">sdp_crypto_alloc</a>(attr[i][2]); <span class="comment">/* key_len */</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;            tmp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a>-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#aab34f2fc02b4a86bea93c68e1ec09d75">tag</a> = (i + 1); <span class="comment">/* tag starts at 1 */</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            <span class="keywordflow">if</span> (i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(attr) - 1) {</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;               <a class="code" href="../../df/d90/linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6">AST_LIST_NEXT</a>(tmp, <a class="code" href="../../de/df7/structast__sdp__srtp.html#a5a5ec5b4367a29990ee49ae4657d94ae">sdp_srtp_list</a>) = <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a4dcb6159f49beb9265fab2665f9e0f24">ast_sdp_srtp_alloc</a>();</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;               tmp = <a class="code" href="../../df/d90/linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6">AST_LIST_NEXT</a>(tmp, <a class="code" href="../../de/df7/structast__sdp__srtp.html#a5a5ec5b4367a29990ee49ae4657d94ae">sdp_srtp_list</a>);</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;            }</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;         }</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      }</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;   }</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;   <span class="keywordflow">if</span> (dtls_enabled) {</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="comment">/* If DTLS-SRTP is enabled the key details will be pulled from TLS */</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;   }</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;   <span class="comment">/* set the key length based on INVITE or settings */</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a7690a632725e41edf28f502b45ececdb">AST_SRTP_CRYPTO_TAG_80</a>)) {</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      taglen = 80;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a802b4a2ad413c6318c31a079b2de7b16">AST_SRTP_CRYPTO_TAG_32</a>)) {</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      taglen = 32;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a6296427afbcd34c9f9019f1b1209a9eb">AST_SRTP_CRYPTO_TAG_16</a>)) {</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      taglen = 16;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a8e74dd423c2648d18ee07d22e7e74dea">AST_SRTP_CRYPTO_TAG_8</a>)) {</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      taglen = 8;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      taglen = default_taglen_32 ? 32 : 80;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;   }</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a>)) {</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      taglen |= 0x0200;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a9ff7daa74cea8005427d0967b6f373e0">AST_SRTP_CRYPTO_AES_192</a>)) {</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      taglen |= 0x0100;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;   }</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(srtp, <a class="code" href="../../de/d5f/sdp__srtp_8h.html#adac8b810f4e4e2eb647da095a97994ae">AST_SRTP_CRYPTO_OLD_NAME</a>)) {</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      taglen |= 0x0080;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;   }</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;   <span class="keywordflow">if</span> (srtp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a> &amp;&amp; (<a class="code" href="../../d8/dd4/res__srtp_8c.html#ae192a81241a6175dfcfb361ef86e88af">res_sdp_crypto_build_offer</a>(srtp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a>, taglen) &gt;= 0)) {</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <span class="keywordflow">return</span> srtp-&gt;<a class="code" href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">crypto</a>-&gt;<a class="code" href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">a_crypto</a>;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;   }</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No SRTP key management enabled\n&quot;</span>);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;}</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#aefe90a5548f004ee492403c7652979c4"> 1207</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d9/d70/structast__sdp__crypto__api.html">ast_sdp_crypto_api</a> <a class="code" href="../../d8/dd4/res__srtp_8c.html#aefe90a5548f004ee492403c7652979c4">res_sdp_crypto_api</a> = {</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;   .<a class="code" href="../../d9/d70/structast__sdp__crypto__api.html#ab78f0b47364833717209d1a9de2a450e">dtor</a> = <a class="code" href="../../d8/dd4/res__srtp_8c.html#aaf948ebbf16a04a556cea3a62bd1ee4d">res_sdp_crypto_dtor</a>,</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;   .alloc = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a3e942904dfadda793804fb284d649469">res_sdp_crypto_alloc</a>,</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;   .build_offer = <a class="code" href="../../d8/dd4/res__srtp_8c.html#ae192a81241a6175dfcfb361ef86e88af">res_sdp_crypto_build_offer</a>,</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;   .parse_offer = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a7a6a207336790d8d8cd49bfb3a7e29d9">res_sdp_crypto_parse_offer</a>,</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;   .get_attr = <a class="code" href="../../d8/dd4/res__srtp_8c.html#a980edcd78788c75d5f19d9a90cd5db6c">res_sdp_srtp_get_attr</a>,</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;};</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#ae0a9832e105305e2fafb5ac99b3f8e6f"> 1215</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#ae0a9832e105305e2fafb5ac99b3f8e6f">res_srtp_shutdown</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;{</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;   <a class="code" href="../../de/d5f/sdp__srtp_8h.html#a830fdedf0744c1e27839f1aa4a44aec4">ast_sdp_crypto_unregister</a>(&amp;res_sdp_crypto_api);</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;   <a class="code" href="../../d5/dde/rtp__engine_8h.html#a406ed314072b3029782f172649b88e48">ast_rtp_engine_unregister_srtp</a>();</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;   srtp_install_event_handler(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="preprocessor">#ifdef HAVE_SRTP_SHUTDOWN</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;   srtp_shutdown();</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;   <a class="code" href="../../d8/dd4/res__srtp_8c.html#af26aaa9e68392c11113fe77ca9b15fac">g_initialized</a> = 0;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;}</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a64865fd7d79b77b0b9bd2a2c57087ae3"> 1226</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a64865fd7d79b77b0b9bd2a2c57087ae3">res_srtp_init</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;{</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dd4/res__srtp_8c.html#af26aaa9e68392c11113fe77ca9b15fac">g_initialized</a>) {</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   }</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;   <span class="keywordflow">if</span> (srtp_init() != <a class="code" href="../../d4/dca/srtp__compat_8h.html#a3d238d91bc329c337f28ca2d3f23a467">err_status_ok</a>) {</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2878d83e36d91850732bad997524e45e">AST_LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to initialize libsrtp\n&quot;</span>);</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;   }</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;   srtp_install_event_handler(<a class="code" href="../../d8/dd4/res__srtp_8c.html#ae59adece7c6925bc7dc210a16cbf0542">srtp_event_cb</a>);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/rtp__engine_8h.html#a2d639001d5f55f96e7795bf3dd7bd6bc">ast_rtp_engine_register_srtp</a>(&amp;srtp_res, &amp;policy_res)) {</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2878d83e36d91850732bad997524e45e">AST_LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to register SRTP with rtp engine\n&quot;</span>);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      <a class="code" href="../../d8/dd4/res__srtp_8c.html#ae0a9832e105305e2fafb5ac99b3f8e6f">res_srtp_shutdown</a>();</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   }</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/d5f/sdp__srtp_8h.html#a0b200744632824c4588044e38d9c4a95">ast_sdp_crypto_register</a>(&amp;res_sdp_crypto_api)) {</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2878d83e36d91850732bad997524e45e">AST_LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to register SDP SRTP crypto API\n&quot;</span>);</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      <a class="code" href="../../d8/dd4/res__srtp_8c.html#ae0a9832e105305e2fafb5ac99b3f8e6f">res_srtp_shutdown</a>();</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;   }</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="preprocessor">#ifdef HAVE_SRTP_GET_VERSION</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;%s initialized\n&quot;</span>, srtp_get_version_string());</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;libsrtp initialized\n&quot;</span>);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;   <a class="code" href="../../d8/dd4/res__srtp_8c.html#af26aaa9e68392c11113fe77ca9b15fac">g_initialized</a> = 1;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;}</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment"> * Exported functions</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div><div class="line"><a name="l01265"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9"> 1265</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;{</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#a64865fd7d79b77b0b9bd2a2c57087ae3">res_srtp_init</a>();</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;}</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#ad09fa931f468002152a3cc2d5ce25eae"> 1270</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd4/res__srtp_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;{</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;   <a class="code" href="../../d8/dd4/res__srtp_8c.html#ae0a9832e105305e2fafb5ac99b3f8e6f">res_srtp_shutdown</a>();</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;}</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<a class="code" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a>(<a class="code" href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a>, <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a>, <span class="stringliteral">&quot;Secure RTP (SRTP)&quot;</span>,</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;   .support_level = <a class="code" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>,</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;   .load = <a class="code" href="../../d8/dd4/res__srtp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;   .unload = <a class="code" href="../../d8/dd4/res__srtp_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>,</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;   .load_pri = <a class="code" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a>,</div><div class="line"><a name="l01281"></a><span class="lineno"><a class="line" href="../../d8/dd4/res__srtp_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae"> 1281</a></span>&#160;);</div><div class="ttc" id="astobj2_8h_html_a14c61bcab109a520a96d30c56ba5fcde"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a></div><div class="ttdeci">#define ao2_t_ref(o, delta, tag)</div><div class="ttdoc">Reference/unreference an object and return the old refcount. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00463">astobj2.h:463</a></div></div>
<div class="ttc" id="structast__sdp__srtp_html"><div class="ttname"><a href="../../de/df7/structast__sdp__srtp.html">ast_sdp_srtp</a></div><div class="ttdoc">structure for secure RTP audio </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00037">sdp_srtp.h:37</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a61bb4bcd1003afaa50d1835687bd096e"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a61bb4bcd1003afaa50d1835687bd096e">sdp_crypto_alloc</a></div><div class="ttdeci">static struct ast_sdp_crypto * sdp_crypto_alloc(const int key_len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00679">res_srtp.c:679</a></div></div>
<div class="ttc" id="res__srtp_8c_html_aac39276480fc153bc9d11d9bc6b5e3db"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#aac39276480fc153bc9d11d9bc6b5e3db">ast_srtp_policy_alloc</a></div><div class="ttdeci">static struct ast_srtp_policy * ast_srtp_policy_alloc(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00251">res_srtp.c:251</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a8486f43b50731a4ba6a47da2167055f6"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a8486f43b50731a4ba6a47da2167055f6">crypto_policy_set_aes_cm_192_hmac_sha1_32</a></div><div class="ttdeci">#define crypto_policy_set_aes_cm_192_hmac_sha1_32</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00011">srtp_compat.h:11</a></div></div>
<div class="ttc" id="rtp__engine_8h_html_a52d18270f48752558c84d7760c82378faf9c51f48bae504be2f9af9f4e646533e"><div class="ttname"><a href="../../d5/dde/rtp__engine_8h.html#a52d18270f48752558c84d7760c82378faf9c51f48bae504be2f9af9f4e646533e">AST_RTP_INSTANCE_STAT_REMOTE_SSRC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/rtp__engine_8h_source.html#l00246">rtp_engine.h:246</a></div></div>
<div class="ttc" id="res__srtp_8c_html_ad09fa931f468002152a3cc2d5ce25eae"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a></div><div class="ttdeci">static int unload_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l01270">res_srtp.c:1270</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="res__srtp_8c_html_a3e942904dfadda793804fb284d649469"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a3e942904dfadda793804fb284d649469">res_sdp_crypto_alloc</a></div><div class="ttdeci">static struct ast_sdp_crypto * res_sdp_crypto_alloc(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00698">res_srtp.c:698</a></div></div>
<div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="structast__srtp__policy_html"><div class="ttname"><a href="../../d4/d86/structast__srtp__policy.html">ast_srtp_policy</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00076">res_srtp.c:76</a></div></div>
<div class="ttc" id="res__srtp_8h_html_adc6141b2686d5575815ac5938eecb606a01497082a505f28b44550e051c01db16"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a01497082a505f28b44550e051c01db16">AST_AES_CM_128_HMAC_SHA1_80</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00058">res_srtp.h:58</a></div></div>
<div class="ttc" id="res__srtp_8c_html_ad2bed0825e79435e8994414befe0b1ae"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#ad2bed0825e79435e8994414befe0b1ae">policy_hash_fn</a></div><div class="ttdeci">static int policy_hash_fn(const void *obj, const int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00162">res_srtp.c:162</a></div></div>
<div class="ttc" id="res__srtp_8c_html_afce2c36417481dac5c7d112dbb09fcde"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#afce2c36417481dac5c7d112dbb09fcde">ast_srtp_set_cb</a></div><div class="ttdeci">static void ast_srtp_set_cb(struct ast_srtp *srtp, const struct ast_srtp_cb *cb, void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00356">res_srtp.c:356</a></div></div>
<div class="ttc" id="structast__srtp_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d4/d11/structast__srtp.html#a735984d41155bc1032e09bece8f8d66d">ast_srtp::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00070">res_srtp.c:70</a></div></div>
<div class="ttc" id="module_8h_html_ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15"><div class="ttname"><a href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00121">module.h:121</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a1625555023b94a961485fdaa0bd96a5d"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a1625555023b94a961485fdaa0bd96a5d">crypto_policy_set_aes_cm_192_hmac_sha1_80</a></div><div class="ttdeci">#define crypto_policy_set_aes_cm_192_hmac_sha1_80</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00010">srtp_compat.h:10</a></div></div>
<div class="ttc" id="res__srtp_8h_html_adc6141b2686d5575815ac5938eecb606a01b96b477f9aa8654ea4e206f0fdd2eb"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a01b96b477f9aa8654ea4e206f0fdd2eb">AST_AES_GCM_256</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00063">res_srtp.h:63</a></div></div>
<div class="ttc" id="structast__srtp_html"><div class="ttname"><a href="../../d4/d11/structast__srtp.html">ast_srtp</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00065">res_srtp.c:65</a></div></div>
<div class="ttc" id="sdp__srtp_8h_html_adac8b810f4e4e2eb647da095a97994ae"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html#adac8b810f4e4e2eb647da095a97994ae">AST_SRTP_CRYPTO_OLD_NAME</a></div><div class="ttdeci">#define AST_SRTP_CRYPTO_OLD_NAME</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00051">sdp_srtp.h:51</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad57326008c326db88dc36779741622b8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad57326008c326db88dc36779741622b8">ao2_t_alloc</a></div><div class="ttdeci">#define ao2_t_alloc(data_size, destructor_fn, debug_msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00409">astobj2.h:409</a></div></div>
<div class="ttc" id="res__srtp_8h_html_adc6141b2686d5575815ac5938eecb606a7b668ad7b65feef20f16240e81cb206d"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a7b668ad7b65feef20f16240e81cb206d">AST_AES_CM_256_HMAC_SHA1_80</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00060">res_srtp.h:60</a></div></div>
<div class="ttc" id="res__srtp_8h_html_adc6141b2686d5575815ac5938eecb606a8a74712b46d46ddcadd16112c812a149"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a8a74712b46d46ddcadd16112c812a149">AST_AES_CM_192_HMAC_SHA1_32</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00067">res_srtp.h:67</a></div></div>
<div class="ttc" id="rtp__engine_8h_html_a82a029e03affad8a6e1b322c0b9fe2c3"><div class="ttname"><a href="../../d5/dde/rtp__engine_8h.html#a82a029e03affad8a6e1b322c0b9fe2c3">ast_rtp_instance_get_stats</a></div><div class="ttdeci">int ast_rtp_instance_get_stats(struct ast_rtp_instance *instance, struct ast_rtp_instance_stats *stats, enum ast_rtp_instance_stat stat)</div><div class="ttdoc">Retrieve statistics about an RTP instance. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dbe/rtp__engine_8c_source.html#l02446">rtp_engine.c:2446</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a7a9a56541b1e42cdc627557f802e4e07"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a7a9a56541b1e42cdc627557f802e4e07">AES_128_GCM_KEYSIZE_WSALT</a></div><div class="ttdeci">#define AES_128_GCM_KEYSIZE_WSALT</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00022">srtp_compat.h:22</a></div></div>
<div class="ttc" id="utils_8h_html_a00d4c9254c9827d6fa44f17a326744a5"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a></div><div class="ttdeci">#define ast_test_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00063">utils.h:63</a></div></div>
<div class="ttc" id="res__srtp_8c_html_ae192a81241a6175dfcfb361ef86e88af"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#ae192a81241a6175dfcfb361ef86e88af">res_sdp_crypto_build_offer</a></div><div class="ttdeci">static int res_sdp_crypto_build_offer(struct ast_sdp_crypto *p, int taglen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00703">res_srtp.c:703</a></div></div>
<div class="ttc" id="structast__rtp__instance_html"><div class="ttname"><a href="../../df/d7a/structast__rtp__instance.html">ast_rtp_instance</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/dbe/rtp__engine_8c_source.html#l00189">rtp_engine.c:189</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2448088751e4d494d1981c7f4b84e8d0"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2448088751e4d494d1981c7f4b84e8d0">OBJ_POINTER</a></div><div class="ttdeci">#define OBJ_POINTER</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01154">astobj2.h:1154</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a6ec2f3743f0bfefec422ef357a88d62d"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a6ec2f3743f0bfefec422ef357a88d62d">err_status_algo_fail</a></div><div class="ttdeci">#define err_status_algo_fail</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00043">srtp_compat.h:43</a></div></div>
<div class="ttc" id="utils_8h_html_ab5033a1f3d781d45e7ccc27598114510"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a></div><div class="ttdeci">#define ast_set_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00070">utils.h:70</a></div></div>
<div class="ttc" id="structast__module__info_html"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html">ast_module_info</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00336">module.h:336</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_aca320089a8536caef8d5129ca3a534e9"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#aca320089a8536caef8d5129ca3a534e9">err_status_cant_check</a></div><div class="ttdeci">#define err_status_cant_check</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00046">srtp_compat.h:46</a></div></div>
<div class="ttc" id="res__srtp_8c_html_ae0a9832e105305e2fafb5ac99b3f8e6f"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#ae0a9832e105305e2fafb5ac99b3f8e6f">res_srtp_shutdown</a></div><div class="ttdeci">static void res_srtp_shutdown(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l01215">res_srtp.c:1215</a></div></div>
<div class="ttc" id="structast__srtp__policy__res_html_a6ac2385237fe875d599a88bac10969f9"><div class="ttname"><a href="../../d6/d13/structast__srtp__policy__res.html#a6ac2385237fe875d599a88bac10969f9">ast_srtp_policy_res::alloc</a></div><div class="ttdeci">struct ast_srtp_policy *(* alloc)(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00071">res_srtp.h:71</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_ab5c813cf69f137b0c133a1921b0fc61d"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#ab5c813cf69f137b0c133a1921b0fc61d">err_status_t</a></div><div class="ttdeci">#define err_status_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00031">srtp_compat.h:31</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a421dc7f1902e1303663007480465cf7d"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a421dc7f1902e1303663007480465cf7d">ast_srtp_policy_set_master_key</a></div><div class="ttdeci">static int ast_srtp_policy_set_master_key(struct ast_srtp_policy *policy, const unsigned char *key, size_t key_len, const unsigned char *salt, size_t salt_len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00325">res_srtp.c:325</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_accb3924f44d39f4812faf84b54a6ac12"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#accb3924f44d39f4812faf84b54a6ac12">err_status_bad_param</a></div><div class="ttdeci">#define err_status_bad_param</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00034">srtp_compat.h:34</a></div></div>
<div class="ttc" id="bt__open_8c_html_a1cdd2bb1a9a71d3e1120100229315d67"><div class="ttname"><a href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a></div><div class="ttdeci">static int tmp()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1e/bt__open_8c_source.html#l00389">bt_open.c:389</a></div></div>
<div class="ttc" id="structast__srtp_html_ad4ad2853bb86f7ed84dbbccbeec3c56b"><div class="ttname"><a href="../../d4/d11/structast__srtp.html#ad4ad2853bb86f7ed84dbbccbeec3c56b">ast_srtp::rtcpbuf</a></div><div class="ttdeci">unsigned char rtcpbuf[8192+AST_FRIENDLY_OFFSET]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00073">res_srtp.c:73</a></div></div>
<div class="ttc" id="res__srtp_8h_html_adc6141b2686d5575815ac5938eecb606a2a223fc6539b2a452d5aba09683241dd"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a2a223fc6539b2a452d5aba09683241dd">AST_AES_CM_256_HMAC_SHA1_32</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00061">res_srtp.h:61</a></div></div>
<div class="ttc" id="logger_8h_html_a2878d83e36d91850732bad997524e45e"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a2878d83e36d91850732bad997524e45e">AST_LOG_WARNING</a></div><div class="ttdeci">#define AST_LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00279">logger.h:279</a></div></div>
<div class="ttc" id="structast__sdp__crypto_html_a7d361be539db0a416204f2af38248d08"><div class="ttname"><a href="../../dc/da1/structast__sdp__crypto.html#a7d361be539db0a416204f2af38248d08">ast_sdp_crypto::key_len</a></div><div class="ttdeci">int key_len</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00638">res_srtp.c:638</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a2ff9370aa6ad777df81de3ef7dc39b55"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a2ff9370aa6ad777df81de3ef7dc39b55">ast_srtp_create</a></div><div class="ttdeci">static int ast_srtp_create(struct ast_srtp **srtp, struct ast_rtp_instance *rtp, struct ast_srtp_policy *policy)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00514">res_srtp.c:514</a></div></div>
<div class="ttc" id="res__srtp_8h_html_adc6141b2686d5575815ac5938eecb606a05d42d7c20a4d79f75915ac05800c625"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a05d42d7c20a4d79f75915ac05800c625">AST_AES_GCM_128</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00062">res_srtp.h:62</a></div></div>
<div class="ttc" id="linkedlists_8h_html_ae234825bcb65b88c0554b995ff1b8ba6"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6">AST_LIST_NEXT</a></div><div class="ttdeci">#define AST_LIST_NEXT(elm, field)</div><div class="ttdoc">Returns the next entry in the list after the given entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00438">linkedlists.h:438</a></div></div>
<div class="ttc" id="res__srtp_8c_html_aaf948ebbf16a04a556cea3a62bd1ee4d"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#aaf948ebbf16a04a556cea3a62bd1ee4d">res_sdp_crypto_dtor</a></div><div class="ttdeci">static void res_sdp_crypto_dtor(struct ast_sdp_crypto *crypto)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00641">res_srtp.c:641</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6db9934459f5cdc95cb3af77d55d426e"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6db9934459f5cdc95cb3af77d55d426e">ao2_t_link</a></div><div class="ttdeci">#define ao2_t_link(container, obj, tag)</div><div class="ttdoc">Add an object to a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01547">astobj2.h:1547</a></div></div>
<div class="ttc" id="module_8h_html_aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0"><div class="ttname"><a href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00326">module.h:326</a></div></div>
<div class="ttc" id="astobj2_8h_html_abd79d7936e873108860cd00d59e1cede"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#abd79d7936e873108860cd00d59e1cede">ao2_t_unlink</a></div><div class="ttdeci">#define ao2_t_unlink(container, obj, tag)</div><div class="ttdoc">Remove an object from a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01596">astobj2.h:1596</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad36841ab6daa3997f7ca7047ad2d033a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a></div><div class="ttdeci">void ao2_iterator_destroy(struct ao2_iterator *iter)</div><div class="ttdoc">Destroy a container iterator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00534">astobj2_container.c:534</a></div></div>
<div class="ttc" id="chan__iax2_8c_html_a7dd0190efe1c61151a9dbab078bdb263"><div class="ttname"><a href="../../d5/dff/chan__iax2_8c.html#a7dd0190efe1c61151a9dbab078bdb263">match</a></div><div class="ttdeci">static int match(struct ast_sockaddr *addr, unsigned short callno, unsigned short dcallno, const struct chan_iax2_pvt *cur, int check_dcallno)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dff/chan__iax2_8c_source.html#l02315">chan_iax2.c:2315</a></div></div>
<div class="ttc" id="sdp__srtp_8h_html_a6296427afbcd34c9f9019f1b1209a9eb"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html#a6296427afbcd34c9f9019f1b1209a9eb">AST_SRTP_CRYPTO_TAG_16</a></div><div class="ttdeci">#define AST_SRTP_CRYPTO_TAG_16</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00047">sdp_srtp.h:47</a></div></div>
<div class="ttc" id="structast__sdp__crypto_html_aab34f2fc02b4a86bea93c68e1ec09d75"><div class="ttname"><a href="../../dc/da1/structast__sdp__crypto.html#aab34f2fc02b4a86bea93c68e1ec09d75">ast_sdp_crypto::tag</a></div><div class="ttdeci">int tag</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00635">res_srtp.c:635</a></div></div>
<div class="ttc" id="structast__srtp__policy__res_html_a6d3b06b446bad25d4e5e72520207ea94"><div class="ttname"><a href="../../d6/d13/structast__srtp__policy__res.html#a6d3b06b446bad25d4e5e72520207ea94">ast_srtp_policy_res::set_master_key</a></div><div class="ttdeci">int(* set_master_key)(struct ast_srtp_policy *policy, const unsigned char *key, size_t key_len, const unsigned char *salt, size_t salt_len)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00074">res_srtp.h:74</a></div></div>
<div class="ttc" id="app__jack_8c_html_af25d6dc49269fa2003ac7c7fa6f13915"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></div><div class="ttdeci">const char * str</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00147">app_jack.c:147</a></div></div>
<div class="ttc" id="structast__srtp_html_a6e85ff4cc71a5866d438aef5246766b2"><div class="ttname"><a href="../../d4/d11/structast__srtp.html#a6e85ff4cc71a5866d438aef5246766b2">ast_srtp::policies</a></div><div class="ttdeci">struct ao2_container * policies</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00067">res_srtp.c:67</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a93bb76f28a2b3a492ece881a731c58b4"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a93bb76f28a2b3a492ece881a731c58b4">crypto_policy_set_aes_cm_256_hmac_sha1_80</a></div><div class="ttdeci">#define crypto_policy_set_aes_cm_256_hmac_sha1_80</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00012">srtp_compat.h:12</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__srtp_8h_html_adc6141b2686d5575815ac5938eecb606a541332fc9fec9829891e0ac434ae15b8"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a541332fc9fec9829891e0ac434ae15b8">AST_AES_CM_192_HMAC_SHA1_80</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00066">res_srtp.h:66</a></div></div>
<div class="ttc" id="rtp__engine_8h_html_af63b14f966292c58be12163e0df79924"><div class="ttname"><a href="../../d5/dde/rtp__engine_8h.html#af63b14f966292c58be12163e0df79924">ast_rtp_instance_add_srtp_policy</a></div><div class="ttdeci">int ast_rtp_instance_add_srtp_policy(struct ast_rtp_instance *instance, struct ast_srtp_policy *remote_policy, struct ast_srtp_policy *local_policy, int rtcp)</div><div class="ttdoc">Add or replace the SRTP policies for the given RTP instance. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dbe/rtp__engine_8c_source.html#l02736">rtp_engine.c:2736</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a923397ffbd17f98cf3c9717a0d13e353"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a923397ffbd17f98cf3c9717a0d13e353">srtp_res</a></div><div class="ttdeci">static struct ast_srtp_res srtp_res</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00102">res_srtp.c:102</a></div></div>
<div class="ttc" id="structast__srtp__policy__res_html_ac7a970a458c4bfc1df1f46f136e5ea7c"><div class="ttname"><a href="../../d6/d13/structast__srtp__policy__res.html#ac7a970a458c4bfc1df1f46f136e5ea7c">ast_srtp_policy_res::set_suite</a></div><div class="ttdeci">int(* set_suite)(struct ast_srtp_policy *policy, enum ast_srtp_suite suite)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00073">res_srtp.h:73</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01043">astobj2.h:1043</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a9ea3c947f5cd82b97dc6a219810def71"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a9ea3c947f5cd82b97dc6a219810def71">ast_srtp_destroy</a></div><div class="ttdeci">static void ast_srtp_destroy(struct ast_srtp *srtp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00560">res_srtp.c:560</a></div></div>
<div class="ttc" id="logger_8h_html_ad770f83c71e237e1f64163358ce4e13d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a></div><div class="ttdeci">#define ast_verb(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00463">logger.h:463</a></div></div>
<div class="ttc" id="rtp__engine_8h_html_a406ed314072b3029782f172649b88e48"><div class="ttname"><a href="../../d5/dde/rtp__engine_8h.html#a406ed314072b3029782f172649b88e48">ast_rtp_engine_unregister_srtp</a></div><div class="ttdeci">void ast_rtp_engine_unregister_srtp(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dbe/rtp__engine_8c_source.html#l02725">rtp_engine.c:2725</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a854b3109544fdc1fcd4ae6e77a23c744"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a854b3109544fdc1fcd4ae6e77a23c744">err_status_dealloc_fail</a></div><div class="ttdeci">#define err_status_dealloc_fail</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00036">srtp_compat.h:36</a></div></div>
<div class="ttc" id="utils_8h_html"><div class="ttname"><a href="../../d5/d60/utils_8h.html">utils.h</a></div><div class="ttdoc">Utility functions. </div></div>
<div class="ttc" id="astmm_8h_html_ada667b6f84a08e6848cb37c5ffb94a5f"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a></div><div class="ttdeci">#define ast_asprintf(ret, fmt,...)</div><div class="ttdoc">A wrapper for asprintf() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00269">astmm.h:269</a></div></div>
<div class="ttc" id="res__srtp_8h_html_adc6141b2686d5575815ac5938eecb606af343453fbb06186800265d1eb08c6aaf"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606af343453fbb06186800265d1eb08c6aaf">AST_AES_GCM_256_8</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00065">res_srtp.h:65</a></div></div>
<div class="ttc" id="module_8h_html_a15896c26e51e8162df5eb9a0124c841f"><div class="ttname"><a href="../../d5/d16/module_8h.html#a15896c26e51e8162df5eb9a0124c841f">ast_module_unref</a></div><div class="ttdeci">#define ast_module_unref(mod)</div><div class="ttdoc">Release a reference to the module. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00469">module.h:469</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="structast__srtp_html_a78dc249b0da93a71c52a5fae14cb4970"><div class="ttname"><a href="../../d4/d11/structast__srtp.html#a78dc249b0da93a71c52a5fae14cb4970">ast_srtp::cb</a></div><div class="ttdeci">const struct ast_srtp_cb * cb</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00069">res_srtp.c:69</a></div></div>
<div class="ttc" id="res__srtp_8c_html_aefe90a5548f004ee492403c7652979c4"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#aefe90a5548f004ee492403c7652979c4">res_sdp_crypto_api</a></div><div class="ttdeci">static struct ast_sdp_crypto_api res_sdp_crypto_api</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l01207">res_srtp.c:1207</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a4c3485ca0c6a5d909cc372e6a2f777c0"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a4c3485ca0c6a5d909cc372e6a2f777c0">crypto_policy_set_aes_cm_128_hmac_sha1_80</a></div><div class="ttdeci">#define crypto_policy_set_aes_cm_128_hmac_sha1_80</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00008">srtp_compat.h:8</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a981df5e73e2c3f69d2f2800e167a6769"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a981df5e73e2c3f69d2f2800e167a6769">err_status_alloc_fail</a></div><div class="ttdeci">#define err_status_alloc_fail</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00035">srtp_compat.h:35</a></div></div>
<div class="ttc" id="structast__srtp__cb_html"><div class="ttname"><a href="../../db/deb/structast__srtp__cb.html">ast_srtp_cb</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00030">res_srtp.h:30</a></div></div>
<div class="ttc" id="logger_8h_html_ad6810d73cb786e5e74c55c8bd8688e05"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad6810d73cb786e5e74c55c8bd8688e05">AST_LOG_NOTICE</a></div><div class="ttdeci">#define AST_LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00268">logger.h:268</a></div></div>
<div class="ttc" id="utils_8h_html_a1e7e06bd20719ecfd58b67f230780ffa"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1e7e06bd20719ecfd58b67f230780ffa">ast_base64decode</a></div><div class="ttdeci">int ast_base64decode(unsigned char *dst, const char *src, int max)</div><div class="ttdoc">Decode data from base64. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00294">main/utils.c:294</a></div></div>
<div class="ttc" id="structast__sdp__crypto_html"><div class="ttname"><a href="../../dc/da1/structast__sdp__crypto.html">ast_sdp_crypto</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00632">res_srtp.c:632</a></div></div>
<div class="ttc" id="structast__sdp__crypto__api_html_ab78f0b47364833717209d1a9de2a450e"><div class="ttname"><a href="../../d9/d70/structast__sdp__crypto__api.html#ab78f0b47364833717209d1a9de2a450e">ast_sdp_crypto_api::dtor</a></div><div class="ttdeci">sdp_crypto_destroy_cb dtor</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00128">sdp_srtp.h:128</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a617fc2aa94ffdeeceb3830df5e058078"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a617fc2aa94ffdeeceb3830df5e058078">ast_srtp_change_source</a></div><div class="ttdeci">static int ast_srtp_change_source(struct ast_srtp *srtp, unsigned int from_ssrc, unsigned int to_ssrc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00607">res_srtp.c:607</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a05c7f068d020be42432c4d4157a54ae7"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a05c7f068d020be42432c4d4157a54ae7">err_status_cipher_fail</a></div><div class="ttdeci">#define err_status_cipher_fail</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00040">srtp_compat.h:40</a></div></div>
<div class="ttc" id="sdp__srtp_8h_html_a9ff7daa74cea8005427d0967b6f373e0"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html#a9ff7daa74cea8005427d0967b6f373e0">AST_SRTP_CRYPTO_AES_192</a></div><div class="ttdeci">#define AST_SRTP_CRYPTO_AES_192</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00049">sdp_srtp.h:49</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a68181e5cc0691ab201cacf0778cdd180"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a68181e5cc0691ab201cacf0778cdd180">err_status_replay_old</a></div><div class="ttdeci">#define err_status_replay_old</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00042">srtp_compat.h:42</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a7be1a694a111552b2f84a3606a8fb201"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a7be1a694a111552b2f84a3606a8fb201">crypto_init_keys</a></div><div class="ttdeci">static struct ast_sdp_crypto * crypto_init_keys(struct ast_sdp_crypto *p, const int key_len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00652">res_srtp.c:652</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a9ae986c45b28edf57e79c703168e2991"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a9ae986c45b28edf57e79c703168e2991">err_status_no_such_op</a></div><div class="ttdeci">#define err_status_no_such_op</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00044">srtp_compat.h:44</a></div></div>
<div class="ttc" id="structast__srtp__policy__res_html_aa3ccd59da0f4a72ef29e03e013154d77"><div class="ttname"><a href="../../d6/d13/structast__srtp__policy__res.html#aa3ccd59da0f4a72ef29e03e013154d77">ast_srtp_policy_res::set_ssrc</a></div><div class="ttdeci">void(* set_ssrc)(struct ast_srtp_policy *policy, unsigned long ssrc, int inbound)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00075">res_srtp.h:75</a></div></div>
<div class="ttc" id="structast__module__info_html_a1aff0615d43e1dfa5c72c1c7d1c6d709"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">ast_module_info::self</a></div><div class="ttdeci">struct ast_module * self</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00342">module.h:342</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00317">module.h:317</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ac8f7380b8620c80443286b44481f641c"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8f7380b8620c80443286b44481f641c">AST_FRIENDLY_OFFSET</a></div><div class="ttdeci">#define AST_FRIENDLY_OFFSET</div><div class="ttdoc">Offset into a frame&amp;#39;s data buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00229">include/asterisk/frame.h:229</a></div></div>
<div class="ttc" id="res__srtp_8h_html_adc6141b2686d5575815ac5938eecb606a18639c7f72572ae21023a76ad8ec36b7"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a18639c7f72572ae21023a76ad8ec36b7">AST_AES_CM_128_HMAC_SHA1_32</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00059">res_srtp.h:59</a></div></div>
<div class="ttc" id="res__srtp_8h_html_adc6141b2686d5575815ac5938eecb606a8868834307ac79c572cf74f122de5df6"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606a8868834307ac79c572cf74f122de5df6">AST_AES_GCM_128_8</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00064">res_srtp.h:64</a></div></div>
<div class="ttc" id="sdp__srtp_8h_html"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html">sdp_srtp.h</a></div><div class="ttdoc">SRTP and SDP Security descriptions. </div></div>
<div class="ttc" id="astobj2_8h_html"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html">astobj2.h</a></div></div>
<div class="ttc" id="structast__srtp__res_html"><div class="ttname"><a href="../../d0/d5d/structast__srtp__res.html">ast_srtp_res</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00034">res_srtp.h:34</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a52bb43dcbc91ef5bcaf005708ba1c437"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a52bb43dcbc91ef5bcaf005708ba1c437">err_status_init_fail</a></div><div class="ttdeci">#define err_status_init_fail</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00037">srtp_compat.h:37</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html">frame.h</a></div><div class="ttdoc">Asterisk internal frame definitions. </div></div>
<div class="ttc" id="sdp__srtp_8h_html_aeef2a537f4fed48886a3f9c316a45285"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html#aeef2a537f4fed48886a3f9c316a45285">AST_SRTP_CRYPTO_OFFER_OK</a></div><div class="ttdeci">#define AST_SRTP_CRYPTO_OFFER_OK</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00044">sdp_srtp.h:44</a></div></div>
<div class="ttc" id="structast__sdp__crypto_html_a371b4046b9153ea23164e3758d36e8d6"><div class="ttname"><a href="../../dc/da1/structast__sdp__crypto.html#a371b4046b9153ea23164e3758d36e8d6">ast_sdp_crypto::a_crypto</a></div><div class="ttdeci">char * a_crypto</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00633">res_srtp.c:633</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="res__srtp_8c_html_ac3382bf6da54c56b37069bd76bbdf4f9"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a></div><div class="ttdeci">static int load_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l01265">res_srtp.c:1265</a></div></div>
<div class="ttc" id="res__pjsip_8c_html_a8b44a03925325ceaf2de7b079b1541a1"><div class="ttname"><a href="../../de/d96/res__pjsip_8c.html#a8b44a03925325ceaf2de7b079b1541a1">method</a></div><div class="ttdeci">const char * method</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l04335">res_pjsip.c:4335</a></div></div>
<div class="ttc" id="structast__sdp__srtp_html_aab919b2d2e2dca3f96563bff742b50eb"><div class="ttname"><a href="../../de/df7/structast__sdp__srtp.html#aab919b2d2e2dca3f96563bff742b50eb">ast_sdp_srtp::crypto</a></div><div class="ttdeci">struct ast_sdp_crypto * crypto</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00039">sdp_srtp.h:39</a></div></div>
<div class="ttc" id="sdp__srtp_8h_html_a7690a632725e41edf28f502b45ececdb"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html#a7690a632725e41edf28f502b45ececdb">AST_SRTP_CRYPTO_TAG_80</a></div><div class="ttdeci">#define AST_SRTP_CRYPTO_TAG_80</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00046">sdp_srtp.h:46</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_ae4a50388ac8043dbd43d726a3885dc26"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#ae4a50388ac8043dbd43d726a3885dc26">err_status_auth_fail</a></div><div class="ttdeci">#define err_status_auth_fail</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00039">srtp_compat.h:39</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a24dd5904934bd991e4a16dc3d80c9160"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a24dd5904934bd991e4a16dc3d80c9160">ast_srtp_policy_destroy</a></div><div class="ttdeci">static void ast_srtp_policy_destroy(struct ast_srtp_policy *policy)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00262">res_srtp.c:262</a></div></div>
<div class="ttc" id="res__srtp_8c_html_ade80dceb8714107134dc7d7171d7a9d5"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#ade80dceb8714107134dc7d7171d7a9d5">ast_srtp_unprotect</a></div><div class="ttdeci">static int ast_srtp_unprotect(struct ast_srtp *srtp, void *buf, int *len, int rtcp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00367">res_srtp.c:367</a></div></div>
<div class="ttc" id="res__srtp_8c_html_adae622a01b8004d643b26e73a7859c8f"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#adae622a01b8004d643b26e73a7859c8f">policy_res</a></div><div class="ttdeci">static struct ast_srtp_policy_res policy_res</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00114">res_srtp.c:114</a></div></div>
<div class="ttc" id="structast__srtp_html_a873db0c09e74a379eb9c741329f126f3"><div class="ttname"><a href="../../d4/d11/structast__srtp.html#a873db0c09e74a379eb9c741329f126f3">ast_srtp::warned</a></div><div class="ttdeci">int warned</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00071">res_srtp.c:71</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a980edcd78788c75d5f19d9a90cd5db6c"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a980edcd78788c75d5f19d9a90cd5db6c">res_sdp_srtp_get_attr</a></div><div class="ttdeci">static const char * res_sdp_srtp_get_attr(struct ast_sdp_srtp *srtp, int dtls_enabled, int default_taglen_32)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l01096">res_srtp.c:1096</a></div></div>
<div class="ttc" id="structast__sdp__crypto_html_abc48d3849d5cfe9785371e6b51684844"><div class="ttname"><a href="../../dc/da1/structast__sdp__crypto.html#abc48d3849d5cfe9785371e6b51684844">ast_sdp_crypto::remote_key</a></div><div class="ttdeci">unsigned char remote_key[SRTP_MAX_KEY_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00637">res_srtp.c:637</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a2250ef3d835936f47a11bb7d580bb94e"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a2250ef3d835936f47a11bb7d580bb94e">crypto_policy_set_aes_gcm_128_16_auth</a></div><div class="ttdeci">#define crypto_policy_set_aes_gcm_128_16_auth</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00014">srtp_compat.h:14</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a78965d7d619d6a6878c4c5657518cd91"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a78965d7d619d6a6878c4c5657518cd91">find_policy</a></div><div class="ttdeci">static struct ast_srtp_policy * find_policy(struct ast_srtp *srtp, const srtp_policy_t *policy, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00176">res_srtp.c:176</a></div></div>
<div class="ttc" id="rtp__engine_8h_html_a2d639001d5f55f96e7795bf3dd7bd6bc"><div class="ttname"><a href="../../d5/dde/rtp__engine_8h.html#a2d639001d5f55f96e7795bf3dd7bd6bc">ast_rtp_engine_register_srtp</a></div><div class="ttdeci">int ast_rtp_engine_register_srtp(struct ast_srtp_res *srtp_res, struct ast_srtp_policy_res *policy_res)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dbe/rtp__engine_8c_source.html#l02710">rtp_engine.c:2710</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a096245953dae967ec66dd0a3d816bcaf"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a096245953dae967ec66dd0a3d816bcaf">crypto_policy_set_aes_gcm_256_8_auth</a></div><div class="ttdeci">#define crypto_policy_set_aes_gcm_256_8_auth</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00017">srtp_compat.h:17</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a9d8b42909d9ee47ca3571897213414ab"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a9d8b42909d9ee47ca3571897213414ab">ast_srtp_get_random</a></div><div class="ttdeci">static int ast_srtp_get_random(unsigned char *key, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00347">res_srtp.c:347</a></div></div>
<div class="ttc" id="utils_8h_html_a555dad1bd5b23acf01cf08f1affab879"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a555dad1bd5b23acf01cf08f1affab879">ast_base64encode</a></div><div class="ttdeci">int ast_base64encode(char *dst, const unsigned char *src, int srclen, int max)</div><div class="ttdoc">Encode data in base64. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00404">main/utils.c:404</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_ab7ec1cb034fc9bb9fd1bbeba32e35da5"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#ab7ec1cb034fc9bb9fd1bbeba32e35da5">crypto_policy_set_aes_gcm_128_8_auth</a></div><div class="ttdeci">#define crypto_policy_set_aes_gcm_128_8_auth</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00016">srtp_compat.h:16</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a53cbea1c07124db2a41f78d35306bd15"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a53cbea1c07124db2a41f78d35306bd15">set_crypto_policy</a></div><div class="ttdeci">static int set_crypto_policy(struct ast_srtp_policy *policy, int suite_val, const unsigned char *master_key, int key_len, unsigned long ssrc, int inbound)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00734">res_srtp.c:734</a></div></div>
<div class="ttc" id="structast__rtp__instance__stats_html_a345269c0d57add15c919b781d140e011"><div class="ttname"><a href="../../d0/db0/structast__rtp__instance__stats.html#a345269c0d57add15c919b781d140e011">ast_rtp_instance_stats::local_ssrc</a></div><div class="ttdeci">unsigned int local_ssrc</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/rtp__engine_8h_source.html#l00422">rtp_engine.h:422</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a819913052ef352de8dad1cd7a95a3aca"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a819913052ef352de8dad1cd7a95a3aca">err_status_no_ctx</a></div><div class="ttdeci">#define err_status_no_ctx</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00045">srtp_compat.h:45</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a4343846df790beb40a23564977548686"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a4343846df790beb40a23564977548686">ast_srtp_add_stream</a></div><div class="ttdeci">static int ast_srtp_add_stream(struct ast_srtp *srtp, struct ast_srtp_policy *policy)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00573">res_srtp.c:573</a></div></div>
<div class="ttc" id="namespacesip__to__pjsip_html_ab82f408a83ecba10ea39afd8abfd371e"><div class="ttname"><a href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">sip_to_pjsip.info</a></div><div class="ttdeci">def info(msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d6f/sip__to__pjsip_8py_source.html#l01313">sip_to_pjsip.py:1313</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="srtp__compat_8h_html_afb7dcd1b02342a0b7b687caed7ca205d"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#afb7dcd1b02342a0b7b687caed7ca205d">crypto_policy_t</a></div><div class="ttdeci">#define crypto_policy_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00006">srtp_compat.h:6</a></div></div>
<div class="ttc" id="astobj2_8h_html_aeca960ec22a1d0384f6e285b25df8501"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aeca960ec22a1d0384f6e285b25df8501">ao2_t_callback</a></div><div class="ttdeci">#define ao2_t_callback(c, flags, cb_fn, arg, tag)</div><div class="ttdoc">ao2_callback() is a generic function that applies cb_fn() to all objects in a container, as described below. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01714">astobj2.h:1714</a></div></div>
<div class="ttc" id="rtp__engine_8h_html_af0adb620e28a15749fe5bf4f6912f00d"><div class="ttname"><a href="../../d5/dde/rtp__engine_8h.html#af0adb620e28a15749fe5bf4f6912f00d">ast_rtp_instance_get_ssrc</a></div><div class="ttdeci">unsigned int ast_rtp_instance_get_ssrc(struct ast_rtp_instance *rtp)</div><div class="ttdoc">Retrieve the local SSRC value that we will be using. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dbe/rtp__engine_8c_source.html#l03778">rtp_engine.c:3778</a></div></div>
<div class="ttc" id="structast__srtp__cb_html_aa07fd91d93b61e34c6c9dd33eeaab8de"><div class="ttname"><a href="../../db/deb/structast__srtp__cb.html#aa07fd91d93b61e34c6c9dd33eeaab8de">ast_srtp_cb::no_ctx</a></div><div class="ttdeci">int(* no_ctx)(struct ast_rtp_instance *rtp, unsigned long ssrc, void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00031">res_srtp.h:31</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a64865fd7d79b77b0b9bd2a2c57087ae3"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a64865fd7d79b77b0b9bd2a2c57087ae3">res_srtp_init</a></div><div class="ttdeci">static int res_srtp_init(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l01226">res_srtp.c:1226</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a81edc9ce5f56a166bdf966ff5c3ccea2"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a81edc9ce5f56a166bdf966ff5c3ccea2">ast_srtp_replace</a></div><div class="ttdeci">static int ast_srtp_replace(struct ast_srtp **srtp, struct ast_rtp_instance *rtp, struct ast_srtp_policy *policy)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00543">res_srtp.c:543</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a4e6aec67d7670cbcf4efa4ac86c8d242"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a4e6aec67d7670cbcf4efa4ac86c8d242">SRTP_MASTER_KEY_LEN</a></div><div class="ttdeci">#define SRTP_MASTER_KEY_LEN</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00157">res_rtp_asterisk.c:157</a></div></div>
<div class="ttc" id="astobj2_8h_html_a17990ea630db7dbd1252ef0132133a2b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a></div><div class="ttdeci">#define ao2_iterator_next(iter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01933">astobj2.h:1933</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a3f02c6e84de7e7ec17b088aceef3b43d"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a3f02c6e84de7e7ec17b088aceef3b43d">ast_srtp_policy_set_suite</a></div><div class="ttdeci">static int ast_srtp_policy_set_suite(struct ast_srtp_policy *policy, enum ast_srtp_suite suite)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00320">res_srtp.c:320</a></div></div>
<div class="ttc" id="logger_8h_html_ad89ee324d180cdcd7defcc709ff9ca42"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a></div><div class="ttdeci">#define LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00263">logger.h:263</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a276c692113160e8211b210dab9b9c988"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a276c692113160e8211b210dab9b9c988">crypto_activate</a></div><div class="ttdeci">static int crypto_activate(struct ast_sdp_crypto *p, int suite_val, unsigned char *remote_key, int key_len, struct ast_rtp_instance *rtp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00750">res_srtp.c:750</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structast__srtp__policy__res_html"><div class="ttname"><a href="../../d6/d13/structast__srtp__policy__res.html">ast_srtp_policy_res</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00070">res_srtp.h:70</a></div></div>
<div class="ttc" id="sdp__srtp_8h_html_a4dcb6159f49beb9265fab2665f9e0f24"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html#a4dcb6159f49beb9265fab2665f9e0f24">ast_sdp_srtp_alloc</a></div><div class="ttdeci">struct ast_sdp_srtp * ast_sdp_srtp_alloc(void)</div><div class="ttdoc">allocate a ast_sdp_srtp structure </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3c/sdp__srtp_8c_source.html#l00041">sdp_srtp.c:41</a></div></div>
<div class="ttc" id="astobj2_8h_html_ab5c800b526ca7de022a0a3e79d0292ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ab5c800b526ca7de022a0a3e79d0292ad">ao2_t_container_alloc_hash</a></div><div class="ttdeci">#define ao2_t_container_alloc_hash(ao2_options, container_options, n_buckets, hash_fn, sort_fn, cmp_fn, tag)</div><div class="ttdoc">Allocate and initialize a hash container with the desired number of buckets. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01308">astobj2.h:1308</a></div></div>
<div class="ttc" id="res__srtp_8c_html_af15440543bd7d214540fe7d3cba5ad4a"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#af15440543bd7d214540fe7d3cba5ad4a">policy_destructor</a></div><div class="ttdeci">static void policy_destructor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00241">res_srtp.c:241</a></div></div>
<div class="ttc" id="res__srtp_8c_html_ac028d37052938579f977518ec30eb469"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#ac028d37052938579f977518ec30eb469">res_srtp_new</a></div><div class="ttdeci">static struct ast_srtp * res_srtp_new(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00188">res_srtp.c:188</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a709129a726ceab8416f357ae7c65cdfa"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a709129a726ceab8416f357ae7c65cdfa">crypto_policy_set_aes_gcm_256_16_auth</a></div><div class="ttdeci">#define crypto_policy_set_aes_gcm_256_16_auth</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00015">srtp_compat.h:15</a></div></div>
<div class="ttc" id="sdp__srtp_8h_html_a8e74dd423c2648d18ee07d22e7e74dea"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html#a8e74dd423c2648d18ee07d22e7e74dea">AST_SRTP_CRYPTO_TAG_8</a></div><div class="ttdeci">#define AST_SRTP_CRYPTO_TAG_8</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00048">sdp_srtp.h:48</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a73559cc705b835510476ad99fc4104ad"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a73559cc705b835510476ad99fc4104ad">srtp_errstr</a></div><div class="ttdeci">static const char * srtp_errstr(int err)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00122">res_srtp.c:122</a></div></div>
<div class="ttc" id="structast__srtp_html_a7024a736852b782ea9cab0ce3660b0c1"><div class="ttname"><a href="../../d4/d11/structast__srtp.html#a7024a736852b782ea9cab0ce3660b0c1">ast_srtp::session</a></div><div class="ttdeci">srtp_t session</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00068">res_srtp.c:68</a></div></div>
<div class="ttc" id="structast__sdp__srtp_html_a5a5ec5b4367a29990ee49ae4657d94ae"><div class="ttname"><a href="../../de/df7/structast__sdp__srtp.html#a5a5ec5b4367a29990ee49ae4657d94ae">ast_sdp_srtp::sdp_srtp_list</a></div><div class="ttdeci">struct ast_sdp_srtp::@318 sdp_srtp_list</div></div>
<div class="ttc" id="utils_8h_html_a7b260320610a09017a9416398acd0a70"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a></div><div class="ttdeci">#define ast_clear_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00077">utils.h:77</a></div></div>
<div class="ttc" id="logger_8h_html"><div class="ttname"><a href="../../d1/d8c/logger_8h.html">logger.h</a></div><div class="ttdoc">Support for logging to various files, console and syslog Configuration in file logger.conf. </div></div>
<div class="ttc" id="res__phoneprov_8c_html_addaa208b0ed785225e24490fb9f28a80"><div class="ttname"><a href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a></div><div class="ttdeci">AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_GLOBAL_SYMBOLS|AST_MODFLAG_LOAD_ORDER, &quot;HTTP Phone Provisioning&quot;,.support_level=AST_MODULE_SUPPORT_EXTENDED,.load=load_module,.unload=unload_module,.reload=reload,.load_pri=AST_MODPRI_CHANNEL_DEPEND,.requires=&quot;http&quot;,)</div></div>
<div class="ttc" id="srtp__compat_8h_html"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html">srtp_compat.h</a></div></div>
<div class="ttc" id="res__srtp_8c_html_aea829ea39d65a8f324757efbe3d5bcb9"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#aea829ea39d65a8f324757efbe3d5bcb9">ast_srtp_protect</a></div><div class="ttdeci">static int ast_srtp_protect(struct ast_srtp *srtp, void **buf, int *len, int rtcp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00486">res_srtp.c:486</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="sdp__srtp_8h_html_a802b4a2ad413c6318c31a079b2de7b16"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html#a802b4a2ad413c6318c31a079b2de7b16">AST_SRTP_CRYPTO_TAG_32</a></div><div class="ttdeci">#define AST_SRTP_CRYPTO_TAG_32</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00045">sdp_srtp.h:45</a></div></div>
<div class="ttc" id="structast__sdp__crypto_html_a8d5fbc3175cd5d4deecca75751969924"><div class="ttname"><a href="../../dc/da1/structast__sdp__crypto.html#a8d5fbc3175cd5d4deecca75751969924">ast_sdp_crypto::local_key</a></div><div class="ttdeci">unsigned char local_key[SRTP_MAX_KEY_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00634">res_srtp.c:634</a></div></div>
<div class="ttc" id="structast__sdp__crypto__api_html"><div class="ttname"><a href="../../d9/d70/structast__sdp__crypto__api.html">ast_sdp_crypto_api</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00126">sdp_srtp.h:126</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_af24bc421ec61b3c9ac8d09685cf8d7b0"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#af24bc421ec61b3c9ac8d09685cf8d7b0">err_status_replay_fail</a></div><div class="ttdeci">#define err_status_replay_fail</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00041">srtp_compat.h:41</a></div></div>
<div class="ttc" id="sdp__srtp_8h_html_a79530c8d4a804e3576c1dd1166f89415"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html#a79530c8d4a804e3576c1dd1166f89415">AST_SRTP_CRYPTO_AES_256</a></div><div class="ttdeci">#define AST_SRTP_CRYPTO_AES_256</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00050">sdp_srtp.h:50</a></div></div>
<div class="ttc" id="structao2__iterator_html"><div class="ttname"><a href="../../d9/d97/structao2__iterator.html">ao2_iterator</a></div><div class="ttdoc">When we need to walk through a container, we use an ao2_iterator to keep track of the current positio...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01841">astobj2.h:1841</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_aa5575ba4f5f776d1f012a12d84250571"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#aa5575ba4f5f776d1f012a12d84250571">err_status_key_expired</a></div><div class="ttdeci">#define err_status_key_expired</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00047">srtp_compat.h:47</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a41ec915ed585862f02f2e6746287108b"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a41ec915ed585862f02f2e6746287108b">crypto_policy_set_aes_cm_128_hmac_sha1_32</a></div><div class="ttdeci">#define crypto_policy_set_aes_cm_128_hmac_sha1_32</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00009">srtp_compat.h:9</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_ab02cf8f6ef989718a9a0307358f63185"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#ab02cf8f6ef989718a9a0307358f63185">AES_256_GCM_KEYSIZE_WSALT</a></div><div class="ttdeci">#define AES_256_GCM_KEYSIZE_WSALT</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00028">srtp_compat.h:28</a></div></div>
<div class="ttc" id="res__srtp_8c_html_aa38f2594fc136f7915c7bdbf5bcb2456"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#aa38f2594fc136f7915c7bdbf5bcb2456">ast_srtp_policy_set_ssrc</a></div><div class="ttdeci">static void ast_srtp_policy_set_ssrc(struct ast_srtp_policy *policy, unsigned long ssrc, int inbound)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00230">res_srtp.c:230</a></div></div>
<div class="ttc" id="sdp__srtp_8h_html_a830fdedf0744c1e27839f1aa4a44aec4"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html#a830fdedf0744c1e27839f1aa4a44aec4">ast_sdp_crypto_unregister</a></div><div class="ttdeci">void ast_sdp_crypto_unregister(struct ast_sdp_crypto_api *api)</div><div class="ttdoc">Unregister SDP SRTP crypto processing routines. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3c/sdp__srtp_8c_source.html#l00132">sdp_srtp.c:132</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a4c5914517b996d128c2a904e38dc0c76"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a4c5914517b996d128c2a904e38dc0c76">policy_set_suite</a></div><div class="ttdeci">static int policy_set_suite(crypto_policy_t *p, enum ast_srtp_suite suite)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00267">res_srtp.c:267</a></div></div>
<div class="ttc" id="res__srtp_8c_html_ae59adece7c6925bc7dc210a16cbf0542"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#ae59adece7c6925bc7dc210a16cbf0542">srtp_event_cb</a></div><div class="ttdeci">static void srtp_event_cb(srtp_event_data_t *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00212">res_srtp.c:212</a></div></div>
<div class="ttc" id="astobj2_8h_html_a36591ec4147956994abd2c67dacba18f"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a36591ec4147956994abd2c67dacba18f">ao2_t_find</a></div><div class="ttdeci">#define ao2_t_find(container, arg, flags, tag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01754">astobj2.h:1754</a></div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a7a6a207336790d8d8cd49bfb3a7e29d9"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a7a6a207336790d8d8cd49bfb3a7e29d9">res_sdp_crypto_parse_offer</a></div><div class="ttdeci">static int res_sdp_crypto_parse_offer(struct ast_rtp_instance *rtp, struct ast_sdp_srtp *srtp, const char *attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00802">res_srtp.c:802</a></div></div>
<div class="ttc" id="rtp__engine_8h_html_a52d18270f48752558c84d7760c82378faa038ce8bbd3a0f5663deced5625cb32e"><div class="ttname"><a href="../../d5/dde/rtp__engine_8h.html#a52d18270f48752558c84d7760c82378faa038ce8bbd3a0f5663deced5625cb32e">AST_RTP_INSTANCE_STAT_LOCAL_SSRC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/rtp__engine_8h_source.html#l00244">rtp_engine.h:244</a></div></div>
<div class="ttc" id="sdp__srtp_8h_html_a0b200744632824c4588044e38d9c4a95"><div class="ttname"><a href="../../de/d5f/sdp__srtp_8h.html#a0b200744632824c4588044e38d9c4a95">ast_sdp_crypto_register</a></div><div class="ttdeci">int ast_sdp_crypto_register(struct ast_sdp_crypto_api *api)</div><div class="ttdoc">Register SDP SRTP crypto processing routines. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3c/sdp__srtp_8c_source.html#l00123">sdp_srtp.c:123</a></div></div>
<div class="ttc" id="res__srtp_8h_html"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html">res_srtp.h</a></div><div class="ttdoc">SRTP resource. </div></div>
<div class="ttc" id="structast__srtp__policy__res_html_a525be71c88aa49ab8bd19f7b146945d7"><div class="ttname"><a href="../../d6/d13/structast__srtp__policy__res.html#a525be71c88aa49ab8bd19f7b146945d7">ast_srtp_policy_res::destroy</a></div><div class="ttdeci">void(* destroy)(struct ast_srtp_policy *policy)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00072">res_srtp.h:72</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a3d238d91bc329c337f28ca2d3f23a467"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a3d238d91bc329c337f28ca2d3f23a467">err_status_ok</a></div><div class="ttdeci">#define err_status_ok</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00032">srtp_compat.h:32</a></div></div>
<div class="ttc" id="structast__srtp_html_a4da7ebd0a2bf33074ac1826b88936875"><div class="ttname"><a href="../../d4/d11/structast__srtp.html#a4da7ebd0a2bf33074ac1826b88936875">ast_srtp::buf</a></div><div class="ttdeci">unsigned char buf[8192+AST_FRIENDLY_OFFSET]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00072">res_srtp.c:72</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00316">module.h:316</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_af66c54b01bbb0ea196ffa3fd140566a3"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#af66c54b01bbb0ea196ffa3fd140566a3">err_status_fail</a></div><div class="ttdeci">#define err_status_fail</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00033">srtp_compat.h:33</a></div></div>
<div class="ttc" id="structast__rtp__instance__stats_html"><div class="ttname"><a href="../../d0/db0/structast__rtp__instance__stats.html">ast_rtp_instance_stats</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/rtp__engine_8h_source.html#l00366">rtp_engine.h:366</a></div></div>
<div class="ttc" id="module_8h_html_aba2c8d4be709a254658b21a834f8294a"><div class="ttname"><a href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a></div><div class="ttdeci">#define ASTERISK_GPL_KEY</div><div class="ttdoc">The text the key() function should return. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00046">module.h:46</a></div></div>
<div class="ttc" id="rtp__engine_8h_html"><div class="ttname"><a href="../../d5/dde/rtp__engine_8h.html">rtp_engine.h</a></div><div class="ttdoc">Pluggable RTP Architecture. </div></div>
<div class="ttc" id="srtp__compat_8h_html_ae8e232aebb30f87e1ab800d73c07350b"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#ae8e232aebb30f87e1ab800d73c07350b">err_status_terminus</a></div><div class="ttdeci">#define err_status_terminus</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00038">srtp_compat.h:38</a></div></div>
<div class="ttc" id="module_8h_html"><div class="ttname"><a href="../../d5/d16/module_8h.html">module.h</a></div><div class="ttdoc">Asterisk module definitions. </div></div>
<div class="ttc" id="res__srtp_8h_html_adc6141b2686d5575815ac5938eecb606"><div class="ttname"><a href="../../de/d15/res__srtp_8h.html#adc6141b2686d5575815ac5938eecb606">ast_srtp_suite</a></div><div class="ttdeci">ast_srtp_suite</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00056">res_srtp.h:56</a></div></div>
<div class="ttc" id="res__srtp_8c_html_af26aaa9e68392c11113fe77ca9b15fac"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#af26aaa9e68392c11113fe77ca9b15fac">g_initialized</a></div><div class="ttdeci">static int g_initialized</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00081">res_srtp.c:81</a></div></div>
<div class="ttc" id="srtp__compat_8h_html_a937b56896ba5a6198b4030d0b4ed3199"><div class="ttname"><a href="../../d4/dca/srtp__compat_8h.html#a937b56896ba5a6198b4030d0b4ed3199">crypto_policy_set_aes_cm_256_hmac_sha1_32</a></div><div class="ttdeci">#define crypto_policy_set_aes_cm_256_hmac_sha1_32</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/srtp__compat_8h_source.html#l00013">srtp_compat.h:13</a></div></div>
<div class="ttc" id="structast__srtp_html_a8adb8595b8127cbea2118fada1ef8782"><div class="ttname"><a href="../../d4/d11/structast__srtp.html#a8adb8595b8127cbea2118fada1ef8782">ast_srtp::rtp</a></div><div class="ttdeci">struct ast_rtp_instance * rtp</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00066">res_srtp.c:66</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01053">astobj2.h:1053</a></div></div>
<div class="ttc" id="astobj2_8h_html_a91d5d37d00874ae7a92d1a15c0a3b3a6"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a></div><div class="ttdeci">struct ao2_iterator ao2_iterator_init(struct ao2_container *c, int flags) attribute_warn_unused_result</div><div class="ttdoc">Create an iterator for a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00485">astobj2_container.c:485</a></div></div>
<div class="ttc" id="structast__srtp__res_html_a89e68ba0bd0d64ff39301d38f624aea0"><div class="ttname"><a href="../../d0/d5d/structast__srtp__res.html#a89e68ba0bd0d64ff39301d38f624aea0">ast_srtp_res::get_random</a></div><div class="ttdeci">int(* get_random)(unsigned char *key, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00052">res_srtp.h:52</a></div></div>
<div class="ttc" id="structast__sdp__crypto_html_aa49742b3622b4d9ac9f632df693fdfa2"><div class="ttname"><a href="../../dc/da1/structast__sdp__crypto.html#aa49742b3622b4d9ac9f632df693fdfa2">ast_sdp_crypto::local_key64</a></div><div class="ttdeci">char local_key64[((SRTP_MAX_KEY_LEN) *8+5)/6+1]</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00636">res_srtp.c:636</a></div></div>
<div class="ttc" id="structast__sdp__srtp_html_ac92588540e8c1d014a08cd8a45462b19"><div class="ttname"><a href="../../de/df7/structast__sdp__srtp.html#ac92588540e8c1d014a08cd8a45462b19">ast_sdp_srtp::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d5f/sdp__srtp_8h_source.html#l00038">sdp_srtp.h:38</a></div></div>
<div class="ttc" id="app__jack_8c_html_ac191e5810fa65e63095409471eb5648f"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a></div><div class="ttdeci">jack_status_t status</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00146">app_jack.c:146</a></div></div>
<div class="ttc" id="structast__srtp__policy_html_a98a009afaa3c2ba8aaf794e8cb639093"><div class="ttname"><a href="../../d4/d86/structast__srtp__policy.html#a98a009afaa3c2ba8aaf794e8cb639093">ast_srtp_policy::sp</a></div><div class="ttdeci">srtp_policy_t sp</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00077">res_srtp.c:77</a></div></div>
<div class="ttc" id="structast__rtp__instance__stats_html_a052c95f741f3e25e6ab9217a01affb53"><div class="ttname"><a href="../../d0/db0/structast__rtp__instance__stats.html#a052c95f741f3e25e6ab9217a01affb53">ast_rtp_instance_stats::remote_ssrc</a></div><div class="ttdeci">unsigned int remote_ssrc</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/rtp__engine_8h_source.html#l00424">rtp_engine.h:424</a></div></div>
<div class="ttc" id="res__srtp_8c_html_a004849402c851b293246c12c9f75e629"><div class="ttname"><a href="../../d8/dd4/res__srtp_8c.html#a004849402c851b293246c12c9f75e629">policy_cmp_fn</a></div><div class="ttdeci">static int policy_cmp_fn(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd4/res__srtp_8c_source.html#l00169">res_srtp.c:169</a></div></div>
<div class="ttc" id="structast__srtp__res_html_ac87bc654e623df7d5d480bf845470242"><div class="ttname"><a href="../../d0/d5d/structast__srtp__res.html#ac87bc654e623df7d5d480bf845470242">ast_srtp_res::create</a></div><div class="ttdeci">int(* create)(struct ast_srtp **srtp, struct ast_rtp_instance *rtp, struct ast_srtp_policy *policy)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d15/res__srtp_8h_source.html#l00036">res_srtp.h:36</a></div></div>
<div class="ttc" id="module_8h_html_a8dea6491bedba471fc44574d76438577"><div class="ttname"><a href="../../d5/d16/module_8h.html#a8dea6491bedba471fc44574d76438577">ast_module_ref</a></div><div class="ttdeci">#define ast_module_ref(mod)</div><div class="ttdoc">Hold a reference to the module. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00443">module.h:443</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:09 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
