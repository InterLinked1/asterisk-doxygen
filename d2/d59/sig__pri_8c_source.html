<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: sig_pri.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_9662a6a166de1dda18179da17db0f05a.html">channels</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">sig_pri.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d2/d59/sig__pri_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 1999 - 2009, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Mark Spencer &lt;markster@digium.com&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*! \file</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * \brief PRI signaling module</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * \author Matthew Fredrickson &lt;creslin@digium.com&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">   &lt;support_level&gt;core&lt;/support_level&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">/*** DOCUMENTATION</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">   &lt;managerEvent language=&quot;en_US&quot; name=&quot;MCID&quot;&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">      &lt;managerEventInstance class=&quot;EVENT_FLAG_CALL&quot;&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">         &lt;synopsis&gt;Published when a malicious call ID request arrives.&lt;/synopsis&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">         &lt;syntax&gt;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">            &lt;channel_snapshot/&gt;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDNumValid&quot;&gt;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDNum&quot;&gt;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDton&quot;&gt;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDNumPlan&quot;&gt;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDNumPres&quot;&gt;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDNameValid&quot;&gt;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDName&quot;&gt;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDNameCharSet&quot;&gt;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDNamePres&quot;&gt;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDSubaddr&quot;&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDSubaddrType&quot;&gt;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDSubaddrOdd&quot;&gt;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">            &lt;parameter name=&quot;MCallerIDPres&quot;&gt;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDNumValid&quot;&gt;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDNum&quot;&gt;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDton&quot;&gt;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDNumPlan&quot;&gt;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDNumPres&quot;&gt;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDNameValid&quot;&gt;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDName&quot;&gt;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDNameCharSet&quot;&gt;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDNamePres&quot;&gt;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDSubaddr&quot;&gt;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDSubaddrType&quot;&gt;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDSubaddrOdd&quot;&gt;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">            &lt;parameter name=&quot;MConnectedIDPres&quot;&gt;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">         &lt;/syntax&gt;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">      &lt;/managerEventInstance&gt;</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">   &lt;/managerEvent&gt;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#ifdef HAVE_PRI</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d60/utils_8h.html">asterisk/utils.h</a>&quot;</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d5b/options_8h.html">asterisk/options.h</a>&quot;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/de0/pbx_8h.html">asterisk/pbx.h</a>&quot;</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html">asterisk/app.h</a>&quot;</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d33/mwi_8h.html">asterisk/mwi.h</a>&quot;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4d/file_8h.html">asterisk/file.h</a>&quot;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d47/callerid_8h.html">asterisk/callerid.h</a>&quot;</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/dce/say_8h.html">asterisk/say.h</a>&quot;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/manager_8h.html">asterisk/manager.h</a>&quot;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d4a/astdb_8h.html">asterisk/astdb.h</a>&quot;</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/da3/causes_8h.html">asterisk/causes.h</a>&quot;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d07/musiconhold_8h.html">asterisk/musiconhold.h</a>&quot;</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db0/cli_8h.html">asterisk/cli.h</a>&quot;</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d86/transcap_8h.html">asterisk/transcap.h</a>&quot;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d47/features_8h.html">asterisk/features.h</a>&quot;</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/db3/aoc_8h.html">asterisk/aoc.h</a>&quot;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d56/bridge_8h.html">asterisk/bridge.h</a>&quot;</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d4a/stasis__channels_8h.html">asterisk/stasis_channels.h</a>&quot;</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d6c/sig__pri_8h.html">sig_pri.h</a>&quot;</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">#ifndef PRI_EVENT_FACILITY</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#error &quot;Upgrade your libpri&quot;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">/*** DOCUMENTATION</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">/* define this to send PRI user-user information elements */</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">#undef SUPPORT_USERUSER</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"> * Define to make always pick a channel if allowed.  Useful for</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"> * testing channel shifting.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">//#define ALWAYS_PICK_CHANNEL 1</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="keyword">struct </span>sig_pri_cc_agent_prv {<span class="comment"></span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">   /*! Asterisk span D channel control structure. */</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>;<span class="comment"></span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">   /*! CC id value to use with libpri. -1 if invalid. */</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   <span class="keywordtype">long</span> cc_id;<span class="comment"></span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">   /*! TRUE if CC has been requested and we are waiting for the response. */</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cc_request_response_pending;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;};</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="keyword">struct </span>sig_pri_cc_monitor_instance {<span class="comment"></span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">   /*! \brief Asterisk span D channel control structure. */</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>;<span class="comment"></span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">   /*! CC id value to use with libpri. (-1 if already canceled). */</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;   <span class="keywordtype">long</span> cc_id;<span class="comment"></span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">   /*! CC core id value. */</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   <span class="keywordtype">int</span> core_id;<span class="comment"></span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">   /*! Device name(Channel name less sequence number) */</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>[1];</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;};</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">/*! Upper level agent/monitor type name. */</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *sig_pri_cc_type_name;<span class="comment"></span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">/*! Container of sig_pri monitor instances. */</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *sig_pri_cc_monitors;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> pri_matchdigittimeout = 3000;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> pri_gendigittimeout = 8000;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="preprocessor">#define DCHAN_NOTINALARM  (1 &lt;&lt; 0)</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">#define DCHAN_UP          (1 &lt;&lt; 1)</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">/* Defines to help decode the encoded event channel id. */</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="preprocessor">#define PRI_CHANNEL(p)  ((p) &amp; 0xff)</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">#define PRI_SPAN(p)     (((p) &gt;&gt; 8) &amp; 0xff)</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">#define PRI_EXPLICIT (1 &lt;&lt; 16)</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">#define PRI_CIS_CALL (1 &lt;&lt; 17)   </span><span class="comment">/* Call is using the D channel only. */</span><span class="preprocessor"></span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor">#define PRI_HELD_CALL   (1 &lt;&lt; 18)</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor">#define DCHAN_AVAILABLE (DCHAN_NOTINALARM | DCHAN_UP)</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> pri_active_dchan_index(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *sig_pri_call_level2str(<span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444">sig_pri_call_level</a> level)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;{</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <span class="keywordflow">switch</span> (level) {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a160bf6ebcaf7f83a1d419472aa594e8c">SIG_PRI_CALL_LEVEL_IDLE</a>:</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Idle&quot;</span>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aebff40bc07274874bba2159ad5b22d73">SIG_PRI_CALL_LEVEL_SETUP</a>:</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Setup&quot;</span>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a56a6bdb3a08f47f53f414ba014b47980">SIG_PRI_CALL_LEVEL_OVERLAP</a>:</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Overlap&quot;</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a60273beaf5da6262358cc2add8aa2765">SIG_PRI_CALL_LEVEL_PROCEEDING</a>:</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Proceeding&quot;</span>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aadfde2210c446742a8276382cb57a960">SIG_PRI_CALL_LEVEL_ALERTING</a>:</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Alerting&quot;</span>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a97a62807945f1318b8d4f643c3709c94">SIG_PRI_CALL_LEVEL_DEFER_DIAL</a>:</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;DeferDial&quot;</span>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822">SIG_PRI_CALL_LEVEL_CONNECT</a>:</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Connect&quot;</span>;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;}</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> pri_rel(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;{</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;}</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PVT_TO_CHANNEL(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;{</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;   <span class="keywordtype">int</span> res = (((p)-&gt;prioffset) | ((p)-&gt;logicalspan &lt;&lt; 8) | (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#acf6f33eb3b0b5cc3ffa093f595e8b7e7">mastertrunkgroup</a> ? PRI_EXPLICIT : 0));</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;prioffset: %d mastertrunkgroup: %d logicalspan: %d result: %d\n&quot;</span>,</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#acf6f33eb3b0b5cc3ffa093f595e8b7e7">mastertrunkgroup</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>, res);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;}</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_handle_dchan_exception(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> index)</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;{</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ad0f583995b62c8aaac419e06a0c5ce4b">handle_dchan_exception</a>) {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ad0f583995b62c8aaac419e06a0c5ce4b">handle_dchan_exception</a>(pri, index);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   }</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_set_dialing(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keywordtype">int</span> is_dialing)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;{</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a5b02e99831df16498dcd2420091d2140">set_dialing</a>) {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a5b02e99831df16498dcd2420091d2140">set_dialing</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, is_dialing);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;}</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_set_digital(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keywordtype">int</span> is_digital)</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;{</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf54768a4327f86de3a234648305c4a4">digital</a> = is_digital;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a0ae638daae78c962c27f9345d441f94f">set_digital</a>) {</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a0ae638daae78c962c27f9345d441f94f">set_digital</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, is_digital);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_set_outgoing(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keywordtype">int</span> is_outgoing)</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;{</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a> = is_outgoing;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#aa9c7fe564b39094f9db7027725d4b26a">set_outgoing</a>) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#aa9c7fe564b39094f9db7027725d4b26a">set_outgoing</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, is_outgoing);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aefda8988d1ad788713126dbeb4d002ec">sig_pri_set_alarm</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keywordtype">int</span> in_alarm)</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;{</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a4c8e5865974440593998fff35afa83d7">sig_pri_is_alarm_ignored</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>)) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="comment">/* Always set not in alarm */</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      in_alarm = 0;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   }</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">    * Clear the channel restart state when the channel alarm</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">    * changes to prevent the state from getting stuck when the link</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">    * goes down.</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3">SIG_PRI_RESET_IDLE</a>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adbe10c4b12619d6cb58b1ad14bc437af">inalarm</a> = in_alarm;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ac03fb31b814daac55fbcee51938446b1">set_alarm</a>) {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ac03fb31b814daac55fbcee51938446b1">set_alarm</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, in_alarm);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *sig_pri_get_orig_dialstring(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;{</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#abdcd7b92c9774bd089a24bd5b7ca21b1">get_orig_dialstring</a>) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#abdcd7b92c9774bd089a24bd5b7ca21b1">get_orig_dialstring</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;   }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;get_orig_dialstring callback not defined\n&quot;</span>);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;}</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_make_cc_dialstring(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">size_t</span> buf_size)</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;{</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ae82785eb6a66d7f0b80342eb4bf60242">make_cc_dialstring</a>) {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ae82785eb6a66d7f0b80342eb4bf60242">make_cc_dialstring</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, buf, buf_size);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;make_cc_dialstring callback not defined\n&quot;</span>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      buf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;   }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;}</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_dial_digits(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *dial_string)</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;{</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a3f5929b7e2c310dc5d852c140402b0d6">dial_digits</a>) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a3f5929b7e2c310dc5d852c140402b0d6">dial_digits</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, dial_string);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;   }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;}</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment"> * \brief Reevaluate the PRI span device state.</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_span_devstate_changed(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;{</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ac38432875dd10cf176f4c668037fe2bc">update_span_devstate</a>) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ac38432875dd10cf176f4c668037fe2bc">update_span_devstate</a>(pri);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;   }</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"> * \brief Set the caller id information in the parent module.</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"> * \param p sig_pri channel structure.</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_set_caller_id(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;{</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d77/structast__party__caller.html">ast_party_caller</a> caller;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a7573e5cc4c6a59a40ed97b5a09c799e2">set_callerid</a>) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#afdaf014aa17389de35cba4df16860b0d">ast_party_caller_init</a>(&amp;caller);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      caller.id.name.str = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      caller.id.name.presentation = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#abd29b99884a9fc8a54fc021555190fb8">callingpres</a>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      caller.id.name.valid = 1;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      caller.id.number.str = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      caller.id.number.plan = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aff456ca48d31a9813584e799064cf88e">cid_ton</a>;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      caller.id.number.presentation = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#abd29b99884a9fc8a54fc021555190fb8">callingpres</a>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      caller.id.number.valid = 1;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a16348e587eb42db97d2169c6c11ebe46">cid_subaddr</a>)) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;         caller.id.subaddress.valid = 1;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;         <span class="comment">//caller.id.subaddress.type = 0;/* nsap */</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;         <span class="comment">//caller.id.subaddress.odd_even_indicator = 0;</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;         caller.id.subaddress.str = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a16348e587eb42db97d2169c6c11ebe46">cid_subaddr</a>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      caller.id.tag = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      caller.ani.number.str = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af1b1c1bbbca6309f8fe1071cd27aff80">cid_ani</a>;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="comment">//caller.ani.number.plan = p-&gt;xxx;</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="comment">//caller.ani.number.presentation = p-&gt;xxx;</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      caller.ani.number.valid = 1;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      caller.ani2 = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9540aaac76be952860ef25d607eb33fb">cid_ani2</a>;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a7573e5cc4c6a59a40ed97b5a09c799e2">set_callerid</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, &amp;caller);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;}</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment"> * \brief Set the Dialed Number Identifier.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment"> * \param p sig_pri channel structure.</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment"> * \param dnid Dialed Number Identifier string.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_set_dnid(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *dnid)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;{</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a8c166f1770c49a3e9986c461c19cef86">set_dnid</a>) {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a8c166f1770c49a3e9986c461c19cef86">set_dnid</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, dnid);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;   }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;}</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment"> * \brief Set the Redirecting Directory Number Information Service (RDNIS).</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment"> * \param p sig_pri channel structure.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment"> * \param rdnis Redirecting Directory Number Information Service (RDNIS) string.</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_set_rdnis(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *rdnis)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;{</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a83b017fb4ce4ea3a7754c4765231a2d0">set_rdnis</a>) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a83b017fb4ce4ea3a7754c4765231a2d0">set_rdnis</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, rdnis);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;   }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;}</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_unlock_private(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p)</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;{</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a5e796d7f69b1a3e73ee47bd97a119ce4">unlock_private</a>) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a5e796d7f69b1a3e73ee47bd97a119ce4">unlock_private</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_lock_private(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p)</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;{</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#abe550d126d8f98b2e177cf80f4c2119b">lock_private</a>) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#abe550d126d8f98b2e177cf80f4c2119b">lock_private</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;}</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_deadlock_avoidance_private(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p)</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;{</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a57a8b48f8536584c41c24d1672cf311f">deadlock_avoidance_private</a>) {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a57a8b48f8536584c41c24d1672cf311f">deadlock_avoidance_private</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="comment">/* Fallback to the old way if callback not present. */</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      sig_pri_unlock_private(p);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      sched_yield();</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      sig_pri_lock_private(p);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;}</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> pri_grab(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;{</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <span class="comment">/* Grab the lock first */</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../dd/d42/lock_8h.html#a987fc536e8b6a1044689eca873610792">ast_mutex_trylock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)) {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="comment">/* Avoid deadlock */</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      sig_pri_deadlock_avoidance_private(p);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   <span class="comment">/* Then break the poll */</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9e187fd6e33fd32a888531467786c773">master</a> != <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      pthread_kill(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9e187fd6e33fd32a888531467786c773">master</a>, SIGURG);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;   }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"> * \brief Convert PRI redirecting reason to asterisk version.</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"> * \param pri_reason PRI redirecting reason.</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"> * \return Equivalent asterisk redirecting reason value.</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169">AST_REDIRECTING_REASON</a> pri_to_ast_reason(<span class="keywordtype">int</span> pri_reason)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;{</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169">AST_REDIRECTING_REASON</a> ast_reason;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   <span class="keywordflow">switch</span> (pri_reason) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;   <span class="keywordflow">case</span> PRI_REDIR_FORWARD_ON_BUSY:</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      ast_reason = <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169aeb1c62f996a259e85eed7e6e529addaf">AST_REDIRECTING_REASON_USER_BUSY</a>;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   <span class="keywordflow">case</span> PRI_REDIR_FORWARD_ON_NO_REPLY:</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      ast_reason = <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169a44d73d03e9d22a95d04fecb97a4a96a5">AST_REDIRECTING_REASON_NO_ANSWER</a>;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;   <span class="keywordflow">case</span> PRI_REDIR_DEFLECTION:</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      ast_reason = <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169ab66eaca00d890abee0495c676b5789b1">AST_REDIRECTING_REASON_DEFLECTION</a>;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;   <span class="keywordflow">case</span> PRI_REDIR_UNCONDITIONAL:</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      ast_reason = <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169ac0b65b437eabc6c251883b9094d74b5e">AST_REDIRECTING_REASON_UNCONDITIONAL</a>;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;   <span class="keywordflow">case</span> PRI_REDIR_UNKNOWN:</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      ast_reason = <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169a1cf63751ca0805657b57f0ca36069f41">AST_REDIRECTING_REASON_UNKNOWN</a>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   }</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;   <span class="keywordflow">return</span> ast_reason;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;}</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment"> * \brief Convert asterisk redirecting reason to PRI version.</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment"> * \param ast_reason Asterisk redirecting reason.</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment"> * \return Equivalent PRI redirecting reason value.</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ast_to_pri_reason(<span class="keyword">enum</span> <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169">AST_REDIRECTING_REASON</a> ast_reason)</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;{</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   <span class="keywordtype">int</span> pri_reason;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;   <span class="keywordflow">switch</span> (ast_reason) {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169aeb1c62f996a259e85eed7e6e529addaf">AST_REDIRECTING_REASON_USER_BUSY</a>:</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      pri_reason = PRI_REDIR_FORWARD_ON_BUSY;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169a44d73d03e9d22a95d04fecb97a4a96a5">AST_REDIRECTING_REASON_NO_ANSWER</a>:</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      pri_reason = PRI_REDIR_FORWARD_ON_NO_REPLY;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169ac0b65b437eabc6c251883b9094d74b5e">AST_REDIRECTING_REASON_UNCONDITIONAL</a>:</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      pri_reason = PRI_REDIR_UNCONDITIONAL;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169ab66eaca00d890abee0495c676b5789b1">AST_REDIRECTING_REASON_DEFLECTION</a>:</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      pri_reason = PRI_REDIR_DEFLECTION;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169a1cf63751ca0805657b57f0ca36069f41">AST_REDIRECTING_REASON_UNKNOWN</a>:</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      pri_reason = PRI_REDIR_UNKNOWN;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;   }</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;   <span class="keywordflow">return</span> pri_reason;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment"> * \brief Convert PRI number presentation to asterisk version.</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment"> * \param pri_presentation PRI number presentation.</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment"> * \return Equivalent asterisk number presentation value.</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> pri_to_ast_presentation(<span class="keywordtype">int</span> pri_presentation)</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;{</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;   <span class="keywordtype">int</span> ast_presentation;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;   <span class="keywordflow">switch</span> (pri_presentation) {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_ALLOWED | PRI_PRES_USER_NUMBER_UNSCREENED:</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      ast_presentation = <a class="code" href="../../de/d47/callerid_8h.html#a4b8463f8be514e1134291b2a9ddaeb35">AST_PRES_ALLOWED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a24813a6a337abb76e92c7f226f68c3cd">AST_PRES_USER_NUMBER_UNSCREENED</a>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_ALLOWED | PRI_PRES_USER_NUMBER_PASSED_SCREEN:</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      ast_presentation = <a class="code" href="../../de/d47/callerid_8h.html#a4b8463f8be514e1134291b2a9ddaeb35">AST_PRES_ALLOWED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a373e33a23b1df10c39311947fc724b11">AST_PRES_USER_NUMBER_PASSED_SCREEN</a>;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_ALLOWED | PRI_PRES_USER_NUMBER_FAILED_SCREEN:</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      ast_presentation = <a class="code" href="../../de/d47/callerid_8h.html#a4b8463f8be514e1134291b2a9ddaeb35">AST_PRES_ALLOWED</a> | <a class="code" href="../../de/d47/callerid_8h.html#ab103476cd94e4c3dfeadf3dff48bb51f">AST_PRES_USER_NUMBER_FAILED_SCREEN</a>;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_ALLOWED | PRI_PRES_NETWORK_NUMBER:</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      ast_presentation = <a class="code" href="../../de/d47/callerid_8h.html#a4b8463f8be514e1134291b2a9ddaeb35">AST_PRES_ALLOWED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a681f7db5cdf14387bac29c1d220fe3b0">AST_PRES_NETWORK_NUMBER</a>;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_RESTRICTED | PRI_PRES_USER_NUMBER_UNSCREENED:</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      ast_presentation = <a class="code" href="../../de/d47/callerid_8h.html#a405736564654ff0e5a98d4be4c57b16c">AST_PRES_RESTRICTED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a24813a6a337abb76e92c7f226f68c3cd">AST_PRES_USER_NUMBER_UNSCREENED</a>;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_RESTRICTED | PRI_PRES_USER_NUMBER_PASSED_SCREEN:</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      ast_presentation = <a class="code" href="../../de/d47/callerid_8h.html#a405736564654ff0e5a98d4be4c57b16c">AST_PRES_RESTRICTED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a373e33a23b1df10c39311947fc724b11">AST_PRES_USER_NUMBER_PASSED_SCREEN</a>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_RESTRICTED | PRI_PRES_USER_NUMBER_FAILED_SCREEN:</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      ast_presentation = <a class="code" href="../../de/d47/callerid_8h.html#a405736564654ff0e5a98d4be4c57b16c">AST_PRES_RESTRICTED</a> | <a class="code" href="../../de/d47/callerid_8h.html#ab103476cd94e4c3dfeadf3dff48bb51f">AST_PRES_USER_NUMBER_FAILED_SCREEN</a>;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_RESTRICTED | PRI_PRES_NETWORK_NUMBER:</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      ast_presentation = <a class="code" href="../../de/d47/callerid_8h.html#a405736564654ff0e5a98d4be4c57b16c">AST_PRES_RESTRICTED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a681f7db5cdf14387bac29c1d220fe3b0">AST_PRES_NETWORK_NUMBER</a>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_UNAVAILABLE | PRI_PRES_USER_NUMBER_UNSCREENED:</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_UNAVAILABLE | PRI_PRES_USER_NUMBER_PASSED_SCREEN:</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_UNAVAILABLE | PRI_PRES_USER_NUMBER_FAILED_SCREEN:</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;   <span class="keywordflow">case</span> PRI_PRES_UNAVAILABLE | PRI_PRES_NETWORK_NUMBER:</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      ast_presentation = <a class="code" href="../../de/d47/callerid_8h.html#a69574f5c1e9be59b1d2eb727d4209bce">AST_PRES_NUMBER_NOT_AVAILABLE</a>;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      ast_presentation = <a class="code" href="../../de/d47/callerid_8h.html#a405736564654ff0e5a98d4be4c57b16c">AST_PRES_RESTRICTED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a24813a6a337abb76e92c7f226f68c3cd">AST_PRES_USER_NUMBER_UNSCREENED</a>;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;   }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;   <span class="keywordflow">return</span> ast_presentation;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;}</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment"> * \brief Convert asterisk number presentation to PRI version.</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment"> * \param ast_presentation Asterisk number presentation.</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment"> * \return Equivalent PRI number presentation value.</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ast_to_pri_presentation(<span class="keywordtype">int</span> ast_presentation)</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;{</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <span class="keywordtype">int</span> pri_presentation;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   <span class="keywordflow">switch</span> (ast_presentation) {</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a4b8463f8be514e1134291b2a9ddaeb35">AST_PRES_ALLOWED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a24813a6a337abb76e92c7f226f68c3cd">AST_PRES_USER_NUMBER_UNSCREENED</a>:</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      pri_presentation = PRI_PRES_ALLOWED | PRI_PRES_USER_NUMBER_UNSCREENED;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a4b8463f8be514e1134291b2a9ddaeb35">AST_PRES_ALLOWED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a373e33a23b1df10c39311947fc724b11">AST_PRES_USER_NUMBER_PASSED_SCREEN</a>:</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      pri_presentation = PRI_PRES_ALLOWED | PRI_PRES_USER_NUMBER_PASSED_SCREEN;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a4b8463f8be514e1134291b2a9ddaeb35">AST_PRES_ALLOWED</a> | <a class="code" href="../../de/d47/callerid_8h.html#ab103476cd94e4c3dfeadf3dff48bb51f">AST_PRES_USER_NUMBER_FAILED_SCREEN</a>:</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      pri_presentation = PRI_PRES_ALLOWED | PRI_PRES_USER_NUMBER_FAILED_SCREEN;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a4b8463f8be514e1134291b2a9ddaeb35">AST_PRES_ALLOWED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a681f7db5cdf14387bac29c1d220fe3b0">AST_PRES_NETWORK_NUMBER</a>:</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      pri_presentation = PRI_PRES_ALLOWED | PRI_PRES_NETWORK_NUMBER;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a405736564654ff0e5a98d4be4c57b16c">AST_PRES_RESTRICTED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a24813a6a337abb76e92c7f226f68c3cd">AST_PRES_USER_NUMBER_UNSCREENED</a>:</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      pri_presentation = PRI_PRES_RESTRICTED | PRI_PRES_USER_NUMBER_UNSCREENED;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a405736564654ff0e5a98d4be4c57b16c">AST_PRES_RESTRICTED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a373e33a23b1df10c39311947fc724b11">AST_PRES_USER_NUMBER_PASSED_SCREEN</a>:</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      pri_presentation = PRI_PRES_RESTRICTED | PRI_PRES_USER_NUMBER_PASSED_SCREEN;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a405736564654ff0e5a98d4be4c57b16c">AST_PRES_RESTRICTED</a> | <a class="code" href="../../de/d47/callerid_8h.html#ab103476cd94e4c3dfeadf3dff48bb51f">AST_PRES_USER_NUMBER_FAILED_SCREEN</a>:</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      pri_presentation = PRI_PRES_RESTRICTED | PRI_PRES_USER_NUMBER_FAILED_SCREEN;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a405736564654ff0e5a98d4be4c57b16c">AST_PRES_RESTRICTED</a> | <a class="code" href="../../de/d47/callerid_8h.html#a681f7db5cdf14387bac29c1d220fe3b0">AST_PRES_NETWORK_NUMBER</a>:</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      pri_presentation = PRI_PRES_RESTRICTED | PRI_PRES_NETWORK_NUMBER;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a2981008d349635cf996bb8629d15a926">AST_PRES_UNAVAILABLE</a> | <a class="code" href="../../de/d47/callerid_8h.html#a24813a6a337abb76e92c7f226f68c3cd">AST_PRES_USER_NUMBER_UNSCREENED</a>:</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a2981008d349635cf996bb8629d15a926">AST_PRES_UNAVAILABLE</a> | <a class="code" href="../../de/d47/callerid_8h.html#a373e33a23b1df10c39311947fc724b11">AST_PRES_USER_NUMBER_PASSED_SCREEN</a>:</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a2981008d349635cf996bb8629d15a926">AST_PRES_UNAVAILABLE</a> | <a class="code" href="../../de/d47/callerid_8h.html#ab103476cd94e4c3dfeadf3dff48bb51f">AST_PRES_USER_NUMBER_FAILED_SCREEN</a>:</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/d47/callerid_8h.html#a2981008d349635cf996bb8629d15a926">AST_PRES_UNAVAILABLE</a> | <a class="code" href="../../de/d47/callerid_8h.html#a681f7db5cdf14387bac29c1d220fe3b0">AST_PRES_NETWORK_NUMBER</a>:</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      pri_presentation = PRES_NUMBER_NOT_AVAILABLE;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      pri_presentation = PRI_PRES_RESTRICTED | PRI_PRES_USER_NUMBER_UNSCREENED;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;   <span class="keywordflow">return</span> pri_presentation;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;}</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment"> * \brief Convert PRI name char_set to asterisk version.</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment"> * \param pri_char_set PRI name char_set.</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment"> * \return Equivalent asterisk name char_set value.</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dff">AST_PARTY_CHAR_SET</a> pri_to_ast_char_set(<span class="keywordtype">int</span> pri_char_set)</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;{</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dff">AST_PARTY_CHAR_SET</a> ast_char_set;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;   <span class="keywordflow">switch</span> (pri_char_set) {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;   <span class="keywordflow">case</span> PRI_CHAR_SET_UNKNOWN:</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      ast_char_set = <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa582102c3504ea0967dce72b559dcc86c">AST_PARTY_CHAR_SET_UNKNOWN</a>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;   <span class="keywordflow">case</span> PRI_CHAR_SET_ISO8859_1:</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      ast_char_set = <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffae83dea89fd3ea1272aca35be3e9767e9">AST_PARTY_CHAR_SET_ISO8859_1</a>;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;   <span class="keywordflow">case</span> PRI_CHAR_SET_WITHDRAWN:</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      ast_char_set = <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa8914ca0a52908f74f9579814362289ba">AST_PARTY_CHAR_SET_WITHDRAWN</a>;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;   <span class="keywordflow">case</span> PRI_CHAR_SET_ISO8859_2:</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      ast_char_set = <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffacc63f30dd3c3af06430f20dc48d1aac1">AST_PARTY_CHAR_SET_ISO8859_2</a>;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;   <span class="keywordflow">case</span> PRI_CHAR_SET_ISO8859_3:</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      ast_char_set = <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffaf8519bddc355ac6ee509060476ad61cb">AST_PARTY_CHAR_SET_ISO8859_3</a>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;   <span class="keywordflow">case</span> PRI_CHAR_SET_ISO8859_4:</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      ast_char_set = <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa842c2a9ccda3b03230c9ee81ec8adf88">AST_PARTY_CHAR_SET_ISO8859_4</a>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;   <span class="keywordflow">case</span> PRI_CHAR_SET_ISO8859_5:</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      ast_char_set = <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa98e85ca7dd343ed5651fa79541037d47">AST_PARTY_CHAR_SET_ISO8859_5</a>;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;   <span class="keywordflow">case</span> PRI_CHAR_SET_ISO8859_7:</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      ast_char_set = <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffab6ad448c18f5068ecb0c530ea2cf2a9b">AST_PARTY_CHAR_SET_ISO8859_7</a>;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   <span class="keywordflow">case</span> PRI_CHAR_SET_ISO10646_BMPSTRING:</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      ast_char_set = <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffaf206a750513cebdced73ea3a40e4fe13">AST_PARTY_CHAR_SET_ISO10646_BMPSTRING</a>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;   <span class="keywordflow">case</span> PRI_CHAR_SET_ISO10646_UTF_8STRING:</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      ast_char_set = <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffaea8e3dae9ceb06346c30d6543084283c">AST_PARTY_CHAR_SET_ISO10646_UTF_8STRING</a>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;   }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;   <span class="keywordflow">return</span> ast_char_set;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;}</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment"> * \brief Convert asterisk name char_set to PRI version.</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment"> * \param ast_char_set Asterisk name char_set.</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment"> * \return Equivalent PRI name char_set value.</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ast_to_pri_char_set(<span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dff">AST_PARTY_CHAR_SET</a> ast_char_set)</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;{</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;   <span class="keywordtype">int</span> pri_char_set;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;   <span class="keywordflow">switch</span> (ast_char_set) {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa582102c3504ea0967dce72b559dcc86c">AST_PARTY_CHAR_SET_UNKNOWN</a>:</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      pri_char_set = PRI_CHAR_SET_UNKNOWN;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffae83dea89fd3ea1272aca35be3e9767e9">AST_PARTY_CHAR_SET_ISO8859_1</a>:</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      pri_char_set = PRI_CHAR_SET_ISO8859_1;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa8914ca0a52908f74f9579814362289ba">AST_PARTY_CHAR_SET_WITHDRAWN</a>:</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      pri_char_set = PRI_CHAR_SET_WITHDRAWN;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffacc63f30dd3c3af06430f20dc48d1aac1">AST_PARTY_CHAR_SET_ISO8859_2</a>:</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      pri_char_set = PRI_CHAR_SET_ISO8859_2;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffaf8519bddc355ac6ee509060476ad61cb">AST_PARTY_CHAR_SET_ISO8859_3</a>:</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      pri_char_set = PRI_CHAR_SET_ISO8859_3;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa842c2a9ccda3b03230c9ee81ec8adf88">AST_PARTY_CHAR_SET_ISO8859_4</a>:</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      pri_char_set = PRI_CHAR_SET_ISO8859_4;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa98e85ca7dd343ed5651fa79541037d47">AST_PARTY_CHAR_SET_ISO8859_5</a>:</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      pri_char_set = PRI_CHAR_SET_ISO8859_5;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffab6ad448c18f5068ecb0c530ea2cf2a9b">AST_PARTY_CHAR_SET_ISO8859_7</a>:</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      pri_char_set = PRI_CHAR_SET_ISO8859_7;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffaf206a750513cebdced73ea3a40e4fe13">AST_PARTY_CHAR_SET_ISO10646_BMPSTRING</a>:</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      pri_char_set = PRI_CHAR_SET_ISO10646_BMPSTRING;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffaea8e3dae9ceb06346c30d6543084283c">AST_PARTY_CHAR_SET_ISO10646_UTF_8STRING</a>:</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      pri_char_set = PRI_CHAR_SET_ISO10646_UTF_8STRING;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;   }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;   <span class="keywordflow">return</span> pri_char_set;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;}</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SUBADDR)</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment"> * \brief Fill in the asterisk party subaddress from the given PRI party subaddress.</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment"> * \param ast_subaddress Asterisk party subaddress structure.</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment"> * \param pri_subaddress PRI party subaddress structure.</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_set_subaddress(<span class="keyword">struct</span> <a class="code" href="../../d7/d41/structast__party__subaddress.html">ast_party_subaddress</a> *ast_subaddress, <span class="keyword">const</span> <span class="keyword">struct</span> pri_party_subaddress *pri_subaddress)</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;{</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>);</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;   <span class="keywordflow">if</span> (pri_subaddress-&gt;length &lt;= 0) {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a40230121458bf94386b685b2e3270880">ast_party_subaddress_init</a>(ast_subaddress);</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;   }</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;   <span class="keywordflow">if</span> (!pri_subaddress-&gt;type) {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="comment">/* NSAP */</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>((<span class="keywordtype">char</span> *) pri_subaddress-&gt;data);</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="keywordtype">char</span> *cnum;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keywordtype">char</span> *ptr;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keywordtype">int</span> x;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="comment">/* User Specified */</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      cnum = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(2 * pri_subaddress-&gt;length + 1);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordflow">if</span> (!cnum) {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a40230121458bf94386b685b2e3270880">ast_party_subaddress_init</a>(ast_subaddress);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;         <span class="keywordflow">return</span>;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      ptr = cnum;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      len = pri_subaddress-&gt;length - 1; <span class="comment">/* -1 account for zero based indexing */</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>; ++x) {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;         ptr += sprintf(ptr, <span class="stringliteral">&quot;%02hhx&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)pri_subaddress-&gt;data[x]);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="keywordflow">if</span> (pri_subaddress-&gt;odd_even_indicator) {</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;         <span class="comment">/* ODD */</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;         sprintf(ptr, <span class="stringliteral">&quot;%01hhx&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((pri_subaddress-&gt;data[len]) &gt;&gt; 4));</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;         <span class="comment">/* EVEN */</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;         sprintf(ptr, <span class="stringliteral">&quot;%02hhx&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)pri_subaddress-&gt;data[len]);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      }</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = cnum;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;   ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#ac765329451135abec74c45e1897abf26">type</a> = pri_subaddress-&gt;type;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;   ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#a141590e40aa10259d3c0bc722725e7ad">odd_even_indicator</a> = pri_subaddress-&gt;odd_even_indicator;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;   ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#aaa04218f9e3a9065afa8be2491da8904">valid</a> = 1;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;}</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SUBADDR) */</span><span class="preprocessor"></span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SUBADDR)</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ast_pri_pack_hex_char(<span class="keywordtype">char</span> <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>)</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;{</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> res;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;   <span class="keywordflow">if</span> (c &lt; <span class="charliteral">&#39;0&#39;</span>) {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      res = 0;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c &lt; (<span class="charliteral">&#39;9&#39;</span> + 1)) {</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      res = c - <span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c &lt; <span class="charliteral">&#39;A&#39;</span>) {</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      res = 0;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c &lt; (<span class="charliteral">&#39;F&#39;</span> + 1)) {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      res = c - <span class="charliteral">&#39;A&#39;</span> + 10;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c &lt; <span class="charliteral">&#39;a&#39;</span>) {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      res = 0;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c &lt; (<span class="charliteral">&#39;f&#39;</span> + 1)) {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      res = c - <span class="charliteral">&#39;a&#39;</span> + 10;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      res = 0;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   }</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;}</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SUBADDR) */</span><span class="preprocessor"></span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SUBADDR)</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment"> * \brief Convert a null terminated hexadecimal string to a packed hex byte array.</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment"> * \details left justified, with 0 padding if odd length.</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"> * \param dst pointer to packed byte array.</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"> * \param src pointer to null terminated hexadecimal string.</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment"> * \param maxlen destination array size.</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment"> * \return Length of byte array</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment"> * \note The dst is not an ASCIIz string.</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment"> * \note The src is an ASCIIz hex string.</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> ast_pri_pack_hex_string(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *dst, <span class="keywordtype">char</span> *src, <span class="keywordtype">int</span> maxlen)</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;{</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;   <span class="keywordtype">int</span> len = strlen(src);</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;   <span class="keywordflow">if</span> (len &gt; (2 * maxlen)) {</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      len = 2 * maxlen;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;   }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;   res = len / 2 + len % 2;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;   <span class="keywordflow">while</span> (len &gt; 1) {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      *dst = ast_pri_pack_hex_char(*src) &lt;&lt; 4;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      src++;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      *dst |= ast_pri_pack_hex_char(*src);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      dst++, src++;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      len -= 2;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;   }</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;   <span class="keywordflow">if</span> (len) { <span class="comment">/* 1 left */</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      *dst = ast_pri_pack_hex_char(*src) &lt;&lt; 4;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;}</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SUBADDR) */</span><span class="preprocessor"></span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SUBADDR)</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment"> * \brief Fill in the PRI party subaddress from the given asterisk party subaddress.</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment"> * \param pri_subaddress PRI party subaddress structure.</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment"> * \param ast_subaddress Asterisk party subaddress structure.</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment"> * \note Assumes that pri_subaddress has been previously memset to zero.</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_party_subaddress_from_ast(<span class="keyword">struct</span> pri_party_subaddress *pri_subaddress, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d7/d41/structast__party__subaddress.html">ast_party_subaddress</a> *ast_subaddress)</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;{</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;   <span class="keywordflow">if</span> (ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#aaa04218f9e3a9065afa8be2491da8904">valid</a> &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)) {</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      pri_subaddress-&gt;type = ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#ac765329451135abec74c45e1897abf26">type</a>;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      <span class="keywordflow">if</span> (!ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#ac765329451135abec74c45e1897abf26">type</a>) {</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;         <span class="comment">/* 0 = NSAP */</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>((<span class="keywordtype">char</span> *) pri_subaddress-&gt;data, ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>,</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            <span class="keyword">sizeof</span>(pri_subaddress-&gt;data));</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;         pri_subaddress-&gt;length = strlen((<span class="keywordtype">char</span> *) pri_subaddress-&gt;data);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;         pri_subaddress-&gt;odd_even_indicator = 0;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;         pri_subaddress-&gt;valid = 1;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;         <span class="comment">/* 2 = User Specified */</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">          * Copy HexString to packed HexData,</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment">          * if odd length then right pad trailing byte with 0</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;         <span class="keywordtype">int</span> length = ast_pri_pack_hex_string(pri_subaddress-&gt;data,</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <span class="keyword">sizeof</span>(pri_subaddress-&gt;data));</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;         pri_subaddress-&gt;length = length; <span class="comment">/* packed data length */</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;         length = strlen(ast_subaddress-&gt;<a class="code" href="../../d7/d41/structast__party__subaddress.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>);</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;         <span class="keywordflow">if</span> (length &gt; 2 * <span class="keyword">sizeof</span>(pri_subaddress-&gt;data)) {</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            pri_subaddress-&gt;odd_even_indicator = 0;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            pri_subaddress-&gt;odd_even_indicator = (length &amp; 1);</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;         }</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;         pri_subaddress-&gt;valid = 1;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      }</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;   }</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;}</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SUBADDR) */</span><span class="preprocessor"></span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment"> * \brief Fill in the PRI party name from the given asterisk party name.</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment"> * \param pri_name PRI party name structure.</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment"> * \param ast_name Asterisk party name structure.</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment"> * \note Assumes that pri_name has been previously memset to zero.</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_party_name_from_ast(<span class="keyword">struct</span> pri_party_name *pri_name, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d6f/structast__party__name.html">ast_party_name</a> *ast_name)</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;{</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;   <span class="keywordflow">if</span> (!ast_name-&gt;<a class="code" href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>) {</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;   }</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;   pri_name-&gt;valid = 1;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;   pri_name-&gt;presentation = ast_to_pri_presentation(ast_name-&gt;<a class="code" href="../../d8/d6f/structast__party__name.html#a3df9119032baa1743f2db71344bd7cac">presentation</a>);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;   pri_name-&gt;char_set = ast_to_pri_char_set(ast_name-&gt;<a class="code" href="../../d8/d6f/structast__party__name.html#a1fb9f03e5de01bf0a8f221e627fa9a7b">char_set</a>);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(ast_name-&gt;<a class="code" href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)) {</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri_name-&gt;str, ast_name-&gt;<a class="code" href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <span class="keyword">sizeof</span>(pri_name-&gt;str));</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   }</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;}</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment"> * \brief Fill in the PRI party number from the given asterisk party number.</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment"> * \param pri_number PRI party number structure.</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment"> * \param ast_number Asterisk party number structure.</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment"> * \note Assumes that pri_number has been previously memset to zero.</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_party_number_from_ast(<span class="keyword">struct</span> pri_party_number *pri_number, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d6/dbb/structast__party__number.html">ast_party_number</a> *ast_number)</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;{</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;   <span class="keywordflow">if</span> (!ast_number-&gt;<a class="code" href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>) {</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;   pri_number-&gt;valid = 1;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;   pri_number-&gt;presentation = ast_to_pri_presentation(ast_number-&gt;<a class="code" href="../../d6/dbb/structast__party__number.html#a3df9119032baa1743f2db71344bd7cac">presentation</a>);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;   pri_number-&gt;plan = ast_number-&gt;<a class="code" href="../../d6/dbb/structast__party__number.html#ad1f8db563cb99d404b72e02cf8f78cd1">plan</a>;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(ast_number-&gt;<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)) {</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri_number-&gt;str, ast_number-&gt;<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <span class="keyword">sizeof</span>(pri_number-&gt;str));</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;   }</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;}</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment"> * \brief Fill in the PRI party id from the given asterisk party id.</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment"> * \param pri_id PRI party id structure.</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment"> * \param ast_id Asterisk party id structure.</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment"> * \note Assumes that pri_id has been previously memset to zero.</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_party_id_from_ast(<span class="keyword">struct</span> pri_party_id *pri_id, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d1/dcb/structast__party__id.html">ast_party_id</a> *ast_id)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;{</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;   sig_pri_party_name_from_ast(&amp;pri_id-&gt;name, &amp;ast_id-&gt;<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;   sig_pri_party_number_from_ast(&amp;pri_id-&gt;number, &amp;ast_id-&gt;<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>);</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SUBADDR)</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;   sig_pri_party_subaddress_from_ast(&amp;pri_id-&gt;subaddress, &amp;ast_id-&gt;<a class="code" href="../../d1/dcb/structast__party__id.html#a10023f503341f2b8c82117b31a0cc531">subaddress</a>);</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SUBADDR) */</span><span class="preprocessor"></span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;}</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment"> * \brief Update the PRI redirecting information for the current call.</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment"> * \param pvt sig_pri private channel structure.</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment"> * \param ast Asterisk channel</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment"> * \note Assumes that the PRI lock is already obtained.</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_redirecting_update(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *ast)</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;{</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;   <span class="keyword">struct </span>pri_party_redirecting pri_redirecting;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../df/d44/structast__party__redirecting.html">ast_party_redirecting</a> *ast_redirecting;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/dcb/structast__party__id.html">ast_party_id</a> redirecting_from = <a class="code" href="../../d5/d7b/channel_8h.html#a20d25ecd953d8ab838fa96d3cb6f06a1">ast_channel_redirecting_effective_from</a>(ast);</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/dcb/structast__party__id.html">ast_party_id</a> redirecting_to = <a class="code" href="../../d5/d7b/channel_8h.html#a1f58aea6d9e9c644a5ec802f45c6245d">ast_channel_redirecting_effective_to</a>(ast);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/dcb/structast__party__id.html">ast_party_id</a> redirecting_orig = <a class="code" href="../../d5/d7b/channel_8h.html#aab9499820db0745b46667b349932effe">ast_channel_redirecting_effective_orig</a>(ast);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   memset(&amp;pri_redirecting, 0, <span class="keyword">sizeof</span>(pri_redirecting));</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;   ast_redirecting = <a class="code" href="../../d5/d7b/channel_8h.html#ad2334e69c466aec25ba3cbba53b7201b">ast_channel_redirecting</a>(ast);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;   sig_pri_party_id_from_ast(&amp;pri_redirecting.from, &amp;redirecting_from);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;   sig_pri_party_id_from_ast(&amp;pri_redirecting.to, &amp;redirecting_to);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   sig_pri_party_id_from_ast(&amp;pri_redirecting.orig_called, &amp;redirecting_orig);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;   pri_redirecting.count = ast_redirecting-&gt;<a class="code" href="../../df/d44/structast__party__redirecting.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;   pri_redirecting.orig_reason = ast_to_pri_reason(ast_redirecting-&gt;<a class="code" href="../../df/d44/structast__party__redirecting.html#aa17ec85399145e14c9f08d81a2261231">orig_reason</a>.<a class="code" href="../../d1/dee/structast__party__redirecting__reason.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   pri_redirecting.reason = ast_to_pri_reason(ast_redirecting-&gt;<a class="code" href="../../df/d44/structast__party__redirecting.html#aa961ad9bce0cf7679c5d938519ff1885">reason</a>.<a class="code" href="../../d1/dee/structast__party__redirecting__reason.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;   pri_redirecting_update(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, &amp;pri_redirecting);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;}</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment"> * \brief Reset DTMF detector.</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment"> * \param p sig_pri channel structure.</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_dsp_reset_and_flush_digits(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p)</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;{</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#aa18eca99495b7731cf2ba16a76041e72">dsp_reset_and_flush_digits</a>) {</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#aa18eca99495b7731cf2ba16a76041e72">dsp_reset_and_flush_digits</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;   }</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;}</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_set_echocanceller(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keywordtype">int</span> enable)</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;{</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a9664a4459cb4009a6752625e7ebc6240">set_echocanceller</a>) {</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a9664a4459cb4009a6752625e7ebc6240">set_echocanceller</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, enable);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;   }</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;}</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_fixup_chans(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *old_chan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *new_chan)</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;{</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ab68aa97314690deafd5da58f34579cb5">fixup_chans</a>) {</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ab68aa97314690deafd5da58f34579cb5">fixup_chans</a>(old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>);</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;   }</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;}</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_play_tone(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#ae264fa3d1f9d29c2c76c99bfa13ce95c">sig_pri_tone</a> tone)</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;{</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a3120f0107c2854fc676067477f135d86">play_tone</a>) {</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a3120f0107c2854fc676067477f135d86">play_tone</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, tone);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;   }</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;}</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *sig_pri_new_ast_channel(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keywordtype">int</span> <a class="code" href="../../d4/d88/structstate.html">state</a>,</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0521b3661ec0c6d0b664abe98f84c5ba">sig_pri_law</a> law, <span class="keywordtype">int</span> transfercapability, <span class="keywordtype">char</span> *<a class="code" href="../../da/d45/chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>,</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../da/de5/structast__assigned__ids.html">ast_assigned_ids</a> *assignedids, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *requestor)</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;{</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a3967853a8d6157831ca2c3a356092d21">new_ast_channel</a>) {</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      c = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a3967853a8d6157831ca2c3a356092d21">new_ast_channel</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, state, law, exten, assignedids, requestor);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;   }</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;   <span class="keywordflow">if</span> (!c) {</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;   }</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == c);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aea53d06676b28028fe5faeb3e2124fde">isidlecall</a> = 0;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af530b38fefaa05e6fa4f0ebe72c73455">alreadyhungup</a> = 0;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ae307ed78db92c08b0dd9c13a7724ae86">ast_channel_transfercapability_set</a>(c, transfercapability);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(c, <span class="stringliteral">&quot;TRANSFERCAPABILITY&quot;</span>,</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#acb027b361350d81e4b94b540fbdfe4e4">ast_transfercapability2str</a>(transfercapability));</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="keywordflow">if</span> (transfercapability &amp; <a class="code" href="../../d7/d86/transcap_8h.html#a70df930118839f3fc035fc9f15dfa621">AST_TRANS_CAP_DIGITAL</a>) {</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      sig_pri_set_digital(p, 1);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;   }</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>) {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      sig_pri_span_devstate_changed(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;   }</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;}</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment"> * \brief Open the PRI channel media path.</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment"> * \param p Channel private control structure.</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_open_media(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p)</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;{</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a>) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;   }</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a97a6fe4247dbe0925678132c6a85cbfd">open_media</a>) {</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a97a6fe4247dbe0925678132c6a85cbfd">open_media</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>);</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   }</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;}</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment"> * \brief Post an AMI B channel association event.</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment"> * \param p Channel private control structure.</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment"> * \note Assumes the private and owner are locked.</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_ami_channel_event(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p)</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;{</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ac3cd01d1a409f5acf3630f539be01cf3">ami_channel_event</a>) {</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ac3cd01d1a409f5acf3630f539be01cf3">ami_channel_event</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;   }</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;}</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6c/sig__pri_8h.html#a0f304fe6c585e80cb10fd235d35b17f2">sig_pri_request</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0521b3661ec0c6d0b664abe98f84c5ba">sig_pri_law</a> law,</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../da/de5/structast__assigned__ids.html">ast_assigned_ids</a> *assignedids, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *requestor,</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;   <span class="keywordtype">int</span> transfercapability)</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;{</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *ast;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;%s %d\n&quot;</span>, __FUNCTION__, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;   sig_pri_set_outgoing(p, 1);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;   ast = sig_pri_new_ast_channel(p, <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>, law, transfercapability,</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>, assignedids, requestor);</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;   <span class="keywordflow">if</span> (!ast) {</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      sig_pri_set_outgoing(p, 0);</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;   }</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;   <span class="keywordflow">return</span> ast;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;}</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0c585919b853d8ccef6d54422f289f2b">pri_is_up</a>(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;{</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../df/d3c/structast__channel.html#ab06e9aa782b61ccfb42f7c48996f6ed4">x</a>;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;   <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; x++) {</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">dchanavail</a>[x] == DCHAN_AVAILABLE)</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;   }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;}</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *pri_order(<span class="keywordtype">int</span> level)</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;{</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;   <span class="keywordflow">switch</span> (level) {</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;   <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Primary&quot;</span>;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;   <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Secondary&quot;</span>;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;   <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Tertiary&quot;</span>;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;   <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Quaternary&quot;</span>;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;Unknown&gt;&quot;</span>;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;   }</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;}</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">/* Returns index of the active dchan */</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> pri_active_dchan_index(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;{</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../df/d3c/structast__channel.html#ab06e9aa782b61ccfb42f7c48996f6ed4">x</a>;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;   <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; x++) {</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <span class="keywordflow">if</span> ((pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[x] == pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>))</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../df/d3c/structast__channel.html#ab06e9aa782b61ccfb42f7c48996f6ed4">x</a>;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;   }</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No active dchan found!\n&quot;</span>);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;}</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> pri_find_dchan(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;{</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;   <span class="keyword">struct </span>pri *old;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;   <span class="keywordtype">int</span> oldslot = -1;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;   <span class="keywordtype">int</span> newslot = -1;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;   old = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; ++idx) {</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[idx]) {</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;         <span class="comment">/* No more D channels defined on the span. */</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      }</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[idx] == old) {</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;         oldslot = idx;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      }</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      <span class="keywordflow">if</span> (newslot &lt; 0 &amp;&amp; pri-&gt;dchanavail[idx] == DCHAN_AVAILABLE) {</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;         newslot = idx;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      }</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;   }</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;   <span class="comment">/* At this point, idx is a count of how many D-channels are defined on the span. */</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   <span class="keywordflow">if</span> (1 &lt; idx) {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="comment">/* We have several D-channels defined on the span.  (NFAS PRI setup) */</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      <span class="keywordflow">if</span> (newslot &lt; 0) {</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;         <span class="comment">/* No D-channels available.  Default to the primary D-channel. */</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;         newslot = 0;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;         <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aa0e541bb0229ec83998375ddec7d4704">no_d_channels</a>) {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aa0e541bb0229ec83998375ddec7d4704">no_d_channels</a> = 1;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            <span class="keywordflow">if</span> (old &amp;&amp; oldslot != newslot) {</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                  <span class="stringliteral">&quot;Span %d: No D-channels up!  Switching selected D-channel from %s to %s.\n&quot;</span>,</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri_order(oldslot), pri_order(newslot));</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Span %d: No D-channels up!\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            }</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;         }</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aa0e541bb0229ec83998375ddec7d4704">no_d_channels</a> = 0;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      }</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      <span class="keywordflow">if</span> (old &amp;&amp; oldslot != newslot) {</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;            <span class="stringliteral">&quot;Switching selected D-channel from %s (fd %d) to %s (fd %d)!\n&quot;</span>,</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;            pri_order(oldslot), pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[oldslot],</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            pri_order(newslot), pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[newslot]);</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      }</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <span class="keywordflow">if</span> (newslot &lt; 0) {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;         <span class="comment">/* The only D-channel is not up. */</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;         newslot = 0;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;         <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aa0e541bb0229ec83998375ddec7d4704">no_d_channels</a>) {</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aa0e541bb0229ec83998375ddec7d4704">no_d_channels</a> = 1;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">             * This is annoying to see on non-persistent layer 2</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment">             * connections.  Let&#39;s not complain in that case.</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="../../d5/db3/chan__dahdi_8h.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>) {</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Span %d: D-channel is down!\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;            }</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;         }</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aa0e541bb0229ec83998375ddec7d4704">no_d_channels</a> = 0;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      }</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;   }</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;   pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a> = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[newslot];</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;}</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment"> * \brief Determine if a private channel structure is in use.</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment"> * \param pvt Channel to determine if in use.</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="comment"> * \return TRUE if the channel is in use.</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_is_chan_in_use(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt)</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;{</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   <span class="keywordflow">return</span> pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> || pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> || pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a44ac4c6a3693f3d2fa34a50428e42237">allocated</a> || pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adbe10c4b12619d6cb58b1ad14bc437af">inalarm</a></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      || pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> != <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3">SIG_PRI_RESET_IDLE</a>;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;}</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment"> * \brief Determine if a private channel structure is available.</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment"> * \param pvt Channel to determine if available.</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment"> * \return TRUE if the channel is available.</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a03805c1c05301a1e86967ad671dec748">sig_pri_is_chan_available</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt)</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;{</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;   <span class="keywordflow">return</span> !sig_pri_is_chan_in_use(pvt)</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SERVICE_MESSAGES)</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      <span class="comment">/* And not out-of-service */</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      &amp;&amp; !pvt-&gt;service_status</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SERVICE_MESSAGES) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      ;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;}</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment"> * \brief Obtain the sig_pri owner channel lock if the owner exists.</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_lock_owner(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos)</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;{</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;         <span class="comment">/* There is no owner lock to get. */</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7b/channel_8h.html#a7dc0d696d897c864c6f41a3a1795c82e">ast_channel_trylock</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;         <span class="comment">/* We got the lock */</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      }</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      <span class="comment">/* Avoid deadlock */</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a851106e971b4611a38cb4be8b39d9fcf">DEADLOCK_AVOIDANCE</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;   }</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;}</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment"> * \brief Queue the given frame onto the owner channel.</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment"> * \param frame Frame to queue onto the owner channel.</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> pri_queue_frame(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos, <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *frame)</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;{</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;   sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a6cbcba5661d55216968cde8fdf913c89">ast_queue_frame</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, frame);</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;   }</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;}</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment"> * \brief Queue a hold frame onto the owner channel.</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment"> * \since 12</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_queue_hold(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos)</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;{</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;   sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ab2e0a6897707b1102ad453ea0963999f">ast_queue_hold</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;   }</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;}</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment"> * \brief Queue an unhold frame onto the owner channel.</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment"> * \since 12</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_queue_unhold(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos)</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;{</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;   sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#aada21a9f55151c285a1537613ff9197a">ast_queue_unhold</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;   }</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;}</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment"> * \brief Queue a control frame of the specified subclass onto the owner channel.</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment"> * \param subclass Control frame subclass to queue onto the owner channel.</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> pri_queue_control(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos, <span class="keywordtype">int</span> subclass)</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;{</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> f = {<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>, };</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a37d6733b3c615f45c446c2671f3d7b6e">queue_control</a>) {</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a37d6733b3c615f45c446c2671f3d7b6e">queue_control</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, subclass);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;   }</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;   f.<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> = <a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;   pri_queue_frame(pri, chanpos, &amp;f);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;}</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment"> * \brief Queue a request to hangup control frame onto the owner channel.</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment"> * \note The unlocking/locking sequence now present has been stress tested</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment"> *       without deadlocks.  Please don&#39;t change it without consulting</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment"> *       core development team members.</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_queue_hangup(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos)</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;{</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a37d6733b3c615f45c446c2671f3d7b6e">queue_control</a>) {</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a37d6733b3c615f45c446c2671f3d7b6e">queue_control</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;   }</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;   sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;   owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;   <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(owner, +1);</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a30bcf0418189567bc84ff32034f79f28">ast_queue_hangup</a>(owner);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;      sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      <span class="comment">/* Tell the CDR this DAHDI channel hung up */</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#aa9a1d01546e0fc0047e56ba589790b6f">ast_set_hangupsource</a>(owner, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(owner), 0);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(owner, -1);</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;   }</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;}</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="comment"> * \brief Queue a PVT_CAUSE_CODE frame onto the owner channel.</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="comment"> * \since 11</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment"> * \param cause String describing the cause to be placed into the frame.</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> pri_queue_pvt_cause_data(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos, <span class="keyword">const</span> <span class="keywordtype">char</span> *cause, <span class="keywordtype">int</span> ast_cause)</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;{</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d2d/structast__control__pvt__cause__code.html">ast_control_pvt_cause_code</a> *cause_code;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;   sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;   chan = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;   <span class="keywordflow">if</span> (chan) {</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      <span class="keywordtype">int</span> datalen = <span class="keyword">sizeof</span>(*cause_code) + strlen(cause);</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      cause_code = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(datalen);</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      memset(cause_code, 0, datalen);</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      cause_code-&gt;<a class="code" href="../../d9/d2d/structast__control__pvt__cause__code.html#a24429ec0f2cac0778a905f215a5e1d4e">ast_cause</a> = <a class="code" href="../../d9/d2d/structast__control__pvt__cause__code.html#a24429ec0f2cac0778a905f215a5e1d4e">ast_cause</a>;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(cause_code-&gt;<a class="code" href="../../d9/d2d/structast__control__pvt__cause__code.html#a933d9bf113023b81a5bc4820f617c068">chan_name</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>);</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(cause_code-&gt;<a class="code" href="../../d9/d2d/structast__control__pvt__cause__code.html#a9f49ca84424b69a07af7d0d8c84e612f">code</a>, cause, datalen + 1 - <span class="keyword">sizeof</span>(*cause_code));</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a7e5e15c22564fd66351d332ad10658b5">ast_queue_control_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390af9665e40f4c9ef6fcfc3e179c6986c41">AST_CONTROL_PVT_CAUSE_CODE</a>, cause_code, datalen);</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#aace0c1f41b57a6599775d0f704234eaf">ast_channel_hangupcause_hash_set</a>(chan, cause_code, datalen);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;   }</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;}</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="comment"> * \brief Find the channel associated with the libpri call.</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment"> * \param call LibPRI opaque call pointer to find.</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment"> * \retval array-index into private pointer array on success.</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> pri_find_principle_by_call(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, q931_call *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#acc941e909d1ca6a0997028d9562d78da">call</a>)</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;{</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;   <span class="keywordflow">if</span> (!call) {</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      <span class="comment">/* Cannot find a call without a call. */</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;   }</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; ++idx) {</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[idx] &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[idx]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> == call) {</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;         <span class="comment">/* Found the principle */</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;         <span class="keywordflow">return</span> idx;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      }</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;   }</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;}</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="comment"> * \brief Queue the span for destruction</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="comment"> * \since 13.0</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="comment"> * Asks the channel driver to queue the span for destruction at a</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment"> * possibly later time, if (e.g.) locking considerations don&#39;t allow</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment"> * destroying it right now.</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> pri_destroy_later(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;{</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a34bcd49ca1d689da83ba4f67a5601d0e">destroy_later</a>) {</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;   }</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;   <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a34bcd49ca1d689da83ba4f67a5601d0e">destroy_later</a>(pri);</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;}</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment"> * \brief Kill the call.</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="comment"> * \param call LibPRI opaque call pointer to find.</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment"> * \param cause Reason call was killed.</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_kill_call(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, q931_call *call, <span class="keywordtype">int</span> cause)</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;{</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;   <span class="keywordtype">int</span> chanpos;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;   chanpos = pri_find_principle_by_call(pri, call);</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, call, cause);</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;   }</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;   sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;   <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;      pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, call, cause);</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;      sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;      sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;   }</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, cause);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;   pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>);</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;   sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;}</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment"> * \brief Find the private structure for the libpri call.</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment"> * \param channel LibPRI encoded channel ID.</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment"> * \param call LibPRI opaque call pointer.</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="comment"> * \retval array-index into private pointer array on success.</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> pri_find_principle(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> <a class="code" href="../../d4/d84/structchannel.html">channel</a>, q931_call *call)</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;{</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;   <span class="keywordtype">int</span> x;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;   <span class="keywordtype">int</span> span;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;   <span class="keywordtype">int</span> principle;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;   <span class="keywordtype">int</span> prioffset;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;   <span class="keywordflow">if</span> (channel &lt; 0) {</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      <span class="comment">/* Channel is not picked yet. */</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;   }</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;   prioffset = PRI_CHANNEL(channel);</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;   <span class="keywordflow">if</span> (!prioffset || (channel &amp; PRI_HELD_CALL)) {</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      <span class="comment">/* Find the call waiting call or held call. */</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <span class="keywordflow">return</span> pri_find_principle_by_call(pri, call);</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;   }</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;   span = PRI_SPAN(channel);</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;   <span class="keywordflow">if</span> (!(channel &amp; PRI_EXPLICIT)) {</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;      <span class="keywordtype">int</span> index;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;      index = pri_active_dchan_index(pri);</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      <span class="keywordflow">if</span> (index == -1) {</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      }</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;      span = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#af352101854fcf60ed3f0015542f943dc">dchan_logical_span</a>[index];</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;   }</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;   principle = -1;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;   <span class="keywordflow">for</span> (x = 0; x &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; x++) {</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;         &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a> == prioffset</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;         &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a> == span</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;         &amp;&amp; !pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a>) {</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;         principle = x;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;      }</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;   }</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;   <span class="keywordflow">return</span> principle;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;}</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment"> * \brief Fixup the private structure associated with the libpri call.</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment"> * \param principle Array-index into private array to move call to if not already there.</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment"> * \param call LibPRI opaque call pointer to find if need to move call.</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment"> * \retval principle on success.</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> pri_fixup_principle(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> principle, q931_call *call)</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;{</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;   <span class="keywordtype">int</span> x;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;   <span class="keywordflow">if</span> (principle &lt; 0 || pri-&gt;numchans &lt;= principle) {</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;      <span class="comment">/* Out of rannge */</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;   }</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;   <span class="keywordflow">if</span> (!call) {</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      <span class="comment">/* No call */</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      <span class="keywordflow">return</span> principle;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;   }</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[principle] &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[principle]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> == call) {</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      <span class="comment">/* Call is already on the specified principle. */</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;      <span class="keywordflow">return</span> principle;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;   }</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;   <span class="comment">/* Find the old principle location. */</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;   <span class="keywordflow">for</span> (x = 0; x &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; x++) {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *new_chan;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *old_chan;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x] || pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> != call) {</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      }</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;      <span class="comment">/* Found our call */</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      new_chan = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[principle];</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;      old_chan = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x];</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      <span class="comment">/* Get locks to safely move to the new private structure. */</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      sig_pri_lock_private(old_chan);</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      sig_pri_lock_owner(pri, x);</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;      sig_pri_lock_private(new_chan);</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Moving call (%s) from channel %d to %d.\n&quot;</span>,</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;         old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;         old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6c/sig__pri_8h.html#a03805c1c05301a1e86967ad671dec748">sig_pri_is_chan_available</a>(new_chan)) {</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            <span class="stringliteral">&quot;Can&#39;t move call (%s) from channel %d to %d.  It is already in use.\n&quot;</span>,</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;            old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;            old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;         sig_pri_unlock_private(new_chan);</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;         <span class="keywordflow">if</span> (old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;         }</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;         sig_pri_unlock_private(old_chan);</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      }</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      sig_pri_fixup_chans(old_chan, new_chan);</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      <span class="comment">/* Fix it all up now */</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;      new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      <span class="comment">/* Transfer flags from the old channel. */</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      new_chan-&gt;aoc_s_request_invoke_id_valid = old_chan-&gt;aoc_s_request_invoke_id_valid;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      new_chan-&gt;waiting_for_aoce = old_chan-&gt;waiting_for_aoce;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      new_chan-&gt;holding_aoce = old_chan-&gt;holding_aoce;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af530b38fefaa05e6fa4f0ebe72c73455">alreadyhungup</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af530b38fefaa05e6fa4f0ebe72c73455">alreadyhungup</a>;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aea53d06676b28028fe5faeb3e2124fde">isidlecall</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aea53d06676b28028fe5faeb3e2124fde">isidlecall</a>;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a>;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a44ac4c6a3693f3d2fa34a50428e42237">allocated</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a44ac4c6a3693f3d2fa34a50428e42237">allocated</a>;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a>;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;      new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf54768a4327f86de3a234648305c4a4">digital</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf54768a4327f86de3a234648305c4a4">digital</a>;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      new_chan-&gt;is_call_waiting = old_chan-&gt;is_call_waiting;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SETUP_ACK_INBAND)</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;      new_chan-&gt;no_dialed_digits = old_chan-&gt;no_dialed_digits;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SETUP_ACK_INBAND) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      old_chan-&gt;aoc_s_request_invoke_id_valid = 0;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;      old_chan-&gt;waiting_for_aoce = 0;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;      old_chan-&gt;holding_aoce = 0;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af530b38fefaa05e6fa4f0ebe72c73455">alreadyhungup</a> = 0;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aea53d06676b28028fe5faeb3e2124fde">isidlecall</a> = 0;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> = 0;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a44ac4c6a3693f3d2fa34a50428e42237">allocated</a> = 0;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;      old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a> = 0;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf54768a4327f86de3a234648305c4a4">digital</a> = 0;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      old_chan-&gt;is_call_waiting = 0;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SETUP_ACK_INBAND)</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      old_chan-&gt;no_dialed_digits = 0;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SETUP_ACK_INBAND) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;      <span class="comment">/* More stuff to transfer to the new channel. */</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a>;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a160bf6ebcaf7f83a1d419472aa594e8c">SIG_PRI_CALL_LEVEL_IDLE</a>;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_REVERSE_CHARGE)</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      new_chan-&gt;reverse_charging_indication = old_chan-&gt;reverse_charging_indication;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_REVERSE_CHARGE) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SETUP_KEYPAD)</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      strcpy(new_chan-&gt;keypad_digits, old_chan-&gt;keypad_digits);</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SETUP_KEYPAD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      strcpy(new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aa31218f7cda0b552305b7daed3a4a58d">deferred_digits</a>, old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aa31218f7cda0b552305b7daed3a4a58d">deferred_digits</a>);</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      strcpy(new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>);</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a>;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      new_chan-&gt;xfer_data = old_chan-&gt;xfer_data;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      old_chan-&gt;xfer_data = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      new_chan-&gt;aoc_s_request_invoke_id = old_chan-&gt;aoc_s_request_invoke_id;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      new_chan-&gt;aoc_e = old_chan-&gt;aoc_e;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      strcpy(new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>, old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>);</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      <span class="keywordflow">if</span> (new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a>) {</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;         <span class="comment">/* Copy the real channel configuration to the no B channel interface. */</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;         new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a8c5bb01611cd9890c062782fa0366459">hidecallerid</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a8c5bb01611cd9890c062782fa0366459">hidecallerid</a>;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;         new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ab9a2fe4dd3d880dcb9fec85b60814978">hidecalleridname</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ab9a2fe4dd3d880dcb9fec85b60814978">hidecalleridname</a>;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;         new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a04e3105c0481dfd78913d4bc9796f1c3">immediate</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a04e3105c0481dfd78913d4bc9796f1c3">immediate</a>;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;         new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a6ae2ff84731ea1e81a24412800030423">priexclusive</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a6ae2ff84731ea1e81a24412800030423">priexclusive</a>;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;         new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ab7d3c3f03d40ad5cea4721e94cb64e40">priindication_oob</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ab7d3c3f03d40ad5cea4721e94cb64e40">priindication_oob</a>;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;         new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aee1feef8ad729d208a3ab28f0de46658">use_callerid</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aee1feef8ad729d208a3ab28f0de46658">use_callerid</a>;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;         new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a6799914e39462ec4cfef0e6b310e7104">use_callingpres</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a6799914e39462ec4cfef0e6b310e7104">use_callingpres</a>;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;         new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;         strcpy(new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;         strcpy(new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>, old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;         <span class="comment">/* Become a member of the old channel span/trunk-group. */</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;         new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;         new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#acf6f33eb3b0b5cc3ffa093f595e8b7e7">mastertrunkgroup</a> = old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#acf6f33eb3b0b5cc3ffa093f595e8b7e7">mastertrunkgroup</a>;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (old_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a>) {</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="comment">          * We are transitioning from a held/call-waiting channel to a</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="comment">          * real channel so we need to make sure that the media path is</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;<span class="comment">          * open.  (Needed especially if the channel is natively</span></div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="comment">          * bridged.)</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;         sig_pri_open_media(new_chan);</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      }</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      <span class="keywordflow">if</span> (new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;         sig_pri_ami_channel_event(new_chan);</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      }</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;      sig_pri_unlock_private(old_chan);</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;      <span class="keywordflow">if</span> (new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(new_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;      }</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      sig_pri_unlock_private(new_chan);</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      <span class="keywordflow">return</span> principle;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;   }</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Call specified, but not found.\n&quot;</span>);</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;}</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment"> * \brief Find and fixup the private structure associated with the libpri call.</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="comment"> * \param channel LibPRI encoded channel ID.</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="comment"> * \param call LibPRI opaque call pointer.</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment"> * This is a combination of pri_find_principle() and pri_fixup_principle()</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="comment"> * to reduce code redundancy and to make handling several PRI_EVENT_xxx&#39;s</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment"> * consistent for the current architecture.</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="comment"> * \retval array-index into private pointer array on success.</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> pri_find_fixup_principle(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> channel, q931_call *call)</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;{</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;   <span class="keywordtype">int</span> chanpos;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;   chanpos = pri_find_principle(pri, channel, call);</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Span %d: PRI requested channel %d/%d is unconfigured.\n&quot;</span>,</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, PRI_SPAN(channel), PRI_CHANNEL(channel));</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      sig_pri_kill_call(pri, call, PRI_CAUSE_IDENTIFIED_CHANNEL_NOTEXIST);</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;   }</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;   chanpos = pri_fixup_principle(pri, chanpos, call);</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Span %d: PRI requested channel %d/%d is not available.\n&quot;</span>,</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, PRI_SPAN(channel), PRI_CHANNEL(channel));</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment">       * Using Q.931 section 5.2.3.1 b) as the reason for picking</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment">       * PRI_CAUSE_CHANNEL_UNACCEPTABLE.  Receiving a</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment">       * PRI_CAUSE_REQUESTED_CHAN_UNAVAIL would cause us to restart</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment">       * that channel (which is not specified by Q.931) and kill some</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="comment">       * other call which would be bad.</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;      sig_pri_kill_call(pri, call, PRI_CAUSE_CHANNEL_UNACCEPTABLE);</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;   }</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;   <span class="keywordflow">return</span> chanpos;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;}</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> * redirectingreason2str(<span class="keywordtype">int</span> redirectingreason)</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;{</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;   <span class="keywordflow">switch</span> (redirectingreason) {</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;   <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;UNKNOWN&quot;</span>;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;   <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;BUSY&quot;</span>;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;   <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;NO_REPLY&quot;</span>;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;   <span class="keywordflow">case</span> 0xF:</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;UNCONDITIONAL&quot;</span>;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;NOREDIRECT&quot;</span>;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;   }</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;}</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *dialplan2str(<span class="keywordtype">int</span> dialplan)</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;{</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;   <span class="keywordflow">if</span> (dialplan == -1) {</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;      <span class="keywordflow">return</span>(<span class="stringliteral">&quot;Dynamically set dialplan in ISDN&quot;</span>);</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;   }</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;   <span class="keywordflow">return</span> (pri_plan2str(dialplan));</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;}</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment"> * \brief Apply numbering plan prefix to the given number.</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="comment"> * \param buf Buffer to put number into.</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="comment"> * \param size Size of given buffer.</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="comment"> * \param number Number to apply numbering plan.</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="comment"> * \param plan Numbering plan to apply.</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> apply_plan_to_number(<span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> size, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/d49/structnumber.html">number</a>, <span class="keywordtype">int</span> plan)</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;{</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;   <span class="keywordflow">switch</span> (plan) {</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;   <span class="keywordflow">case</span> PRI_INTERNATIONAL_ISDN:     <span class="comment">/* Q.931 dialplan == 0x11 international dialplan =&gt; prepend international prefix digits */</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      snprintf(buf, size, <span class="stringliteral">&quot;%s%s&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae384fc9ad39051984beca025ded44f41">internationalprefix</a>, number);</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;   <span class="keywordflow">case</span> PRI_NATIONAL_ISDN:       <span class="comment">/* Q.931 dialplan == 0x21 national dialplan =&gt; prepend national prefix digits */</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      snprintf(buf, size, <span class="stringliteral">&quot;%s%s&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a74f03b8f0dd671a3f916bdd8fe6cfb75">nationalprefix</a>, number);</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;   <span class="keywordflow">case</span> PRI_LOCAL_ISDN:       <span class="comment">/* Q.931 dialplan == 0x41 local dialplan =&gt; prepend local prefix digits */</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      snprintf(buf, size, <span class="stringliteral">&quot;%s%s&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a82888352b7fb9230e3052d9aa0820199">localprefix</a>, number);</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;   <span class="keywordflow">case</span> PRI_PRIVATE:       <span class="comment">/* Q.931 dialplan == 0x49 private dialplan =&gt; prepend private prefix digits */</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      snprintf(buf, size, <span class="stringliteral">&quot;%s%s&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a4dec407d22aef029145eadceecd1df6d">privateprefix</a>, number);</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;   <span class="keywordflow">case</span> PRI_UNKNOWN:       <span class="comment">/* Q.931 dialplan == 0x00 unknown dialplan =&gt; prepend unknown prefix digits */</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;      snprintf(buf, size, <span class="stringliteral">&quot;%s%s&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a4149ab7462729c97cf44d6389abf0989">unknownprefix</a>, number);</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;   <span class="keywordflow">default</span>:          <span class="comment">/* other Q.931 dialplan =&gt; don&#39;t twiddle with callingnum */</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      snprintf(buf, size, <span class="stringliteral">&quot;%s&quot;</span>, number);</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;   }</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;}</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="comment"> * \brief Apply numbering plan prefix to the given number if the number exists.</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="comment"> * \param buf Buffer to put number into.</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment"> * \param size Size of given buffer.</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment"> * \param number Number to apply numbering plan.</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment"> * \param plan Numbering plan to apply.</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> apply_plan_to_existing_number(<span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> size, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keyword">const</span> <span class="keywordtype">char</span> *number, <span class="keywordtype">int</span> plan)</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;{</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;   <span class="comment">/* Make sure a number exists so the prefix isn&#39;t placed on an empty string. */</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(number)) {</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      <span class="keywordflow">if</span> (size) {</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;         *buf = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      }</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;   }</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;   apply_plan_to_number(buf, size, pri, number, plan);</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;}</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment"> * \brief Restart the next channel we think is idle on the span.</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> pri_check_restart(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;{</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SERVICE_MESSAGES)</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;   <span class="keywordtype">unsigned</span> why;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SERVICE_MESSAGES) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;   <span class="keywordflow">for</span> (++pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a>; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a> &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; ++pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a>) {</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a>]</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;         || pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a>]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;         || sig_pri_is_chan_in_use(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a>])) {</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      }</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SERVICE_MESSAGES)</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      why = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a>]-&gt;service_status;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      <span class="keywordflow">if</span> (why) {</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;            <span class="stringliteral">&quot;Span %d: channel %d out-of-service (reason: %s), not sending RESTART\n&quot;</span>,</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a>]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>,</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;            (why &amp; SRVST_FAREND) ? (why &amp; SRVST_NEAREND) ? <span class="stringliteral">&quot;both ends&quot;</span> : <span class="stringliteral">&quot;far end&quot;</span> : <span class="stringliteral">&quot;near end&quot;</span>);</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      }</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SERVICE_MESSAGES) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;   }</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a> &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>) {</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      <span class="comment">/* Mark the channel as resetting and restart it */</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a>]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaad73773a22eaed64af27f4c0905f239dc">SIG_PRI_RESET_ACTIVE</a>;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;      pri_reset(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, PVT_TO_CHANNEL(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a>]));</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a> = 0;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      time(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae752c5957f8323851102513cd35837b1">lastreset</a>);</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;   }</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;}</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="comment"> * \brief Init the private channel configuration using the span controller.</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="comment"> * \param pvt Channel to init the configuration.</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_init_config(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;{</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a> = pri-&gt;ch_cfg.stripmsd;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a8c5bb01611cd9890c062782fa0366459">hidecallerid</a> = pri-&gt;ch_cfg.hidecallerid;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ab9a2fe4dd3d880dcb9fec85b60814978">hidecalleridname</a> = pri-&gt;ch_cfg.hidecalleridname;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a04e3105c0481dfd78913d4bc9796f1c3">immediate</a> = pri-&gt;ch_cfg.immediate;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a6ae2ff84731ea1e81a24412800030423">priexclusive</a> = pri-&gt;ch_cfg.priexclusive;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ab7d3c3f03d40ad5cea4721e94cb64e40">priindication_oob</a> = pri-&gt;ch_cfg.priindication_oob;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aee1feef8ad729d208a3ab28f0de46658">use_callerid</a> = pri-&gt;ch_cfg.use_callerid;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a6799914e39462ec4cfef0e6b310e7104">use_callingpres</a> = pri-&gt;ch_cfg.use_callingpres;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, pri-&gt;ch_cfg.context, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>, pri-&gt;ch_cfg.mohinterpret, <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>));</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a37e39aab51e06fe8a823525c8cb18396">init_config</a>) {</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;      <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a37e39aab51e06fe8a823525c8cb18396">init_config</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, pri);</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;   }</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;}</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment"> * \brief Find an empty B-channel interface to use.</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment"> * \param backwards TRUE if the search starts from higher channels.</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment"> * \retval array-index into private pointer array on success.</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> pri_find_empty_chan(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> backwards)</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;{</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;   <span class="keywordtype">int</span> x;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;   <span class="keywordflow">if</span> (backwards)</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      x = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;      x = 0;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      <span class="keywordflow">if</span> (backwards &amp;&amp; (x &lt; 0))</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      <span class="keywordflow">if</span> (!backwards &amp;&amp; (x &gt;= pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>))</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;         &amp;&amp; !pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;         &amp;&amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a03805c1c05301a1e86967ad671dec748">sig_pri_is_chan_available</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x])) {</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Found empty available channel %d/%d\n&quot;</span>,</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>);</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;         <span class="keywordflow">return</span> x;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;      }</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;      <span class="keywordflow">if</span> (backwards)</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;         x--;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;         x++;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;   }</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;}</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment"> * \brief Find or create an empty no-B-channel interface to use.</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment"> * \retval array-index into private pointer array on success.</span></div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> pri_find_empty_nobch(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;{</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; ++idx) {</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[idx]</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;         &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[idx]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;         &amp;&amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a03805c1c05301a1e86967ad671dec748">sig_pri_is_chan_available</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[idx])) {</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Found empty available no B channel interface\n&quot;</span>);</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;         <span class="keywordflow">return</span> idx;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      }</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;   }</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;   <span class="comment">/* Need to create a new interface. */</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ad1e793a256fbfeb7f8857d34de0f7d22">new_nobch_intf</a>) {</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      idx = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ad1e793a256fbfeb7f8857d34de0f7d22">new_nobch_intf</a>(pri);</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      idx = -1;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;   }</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;   <span class="keywordflow">return</span> idx;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;}</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *do_idle_thread(<span class="keywordtype">void</span> *v_pvt)</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;{</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt = v_pvt;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan = pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;   <span class="keywordtype">char</span> ex[128];</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;   <span class="comment">/* Wait up to 30 seconds for an answer */</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;   <span class="keywordtype">int</span> timeout_ms = 30000;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;   <span class="keywordtype">int</span> ms;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;   <span class="keyword">struct </span>timeval start;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> callid;</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;   <span class="keywordflow">if</span> ((callid = <a class="code" href="../../d5/d7b/channel_8h.html#a6c2c406bdebd477029e61774cc300abd">ast_channel_callid</a>(chan))) {</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a6956becf4d7e3906c74b6e30b834ebd8">ast_callid_threadassoc_add</a>(callid);</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;   }</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Initiating idle call on channel %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;   snprintf(ex, <span class="keyword">sizeof</span>(ex), <span class="stringliteral">&quot;%d/%s&quot;</span>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#af75747551b37515dbfc2a60a6ed24dee">idledial</a>);</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a1b732eb4ed203140b1a3aae9e7dec2c1">ast_call</a>(chan, ex, 0)) {</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Idle dial failed on &#39;%s&#39; to &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), ex);</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(chan);</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;   }</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;   start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;   <span class="keywordflow">while</span> ((ms = <a class="code" href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a>(start, timeout_ms))) {</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a>(chan, ms) &lt;= 0) {</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;      }</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;      f = <a class="code" href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a>(chan);</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <span class="keywordflow">if</span> (!f) {</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;         <span class="comment">/* Got hangup */</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;      }</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;      <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) {</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;         <span class="keywordflow">switch</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a>) {</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>:</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;            <span class="comment">/* Launch the PBX */</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a16be7012a9efbe71bd98228d48c7c89b">idleext</a>);</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aab9ab1e6f772f75d5f179e4ecf57d830">idlecontext</a>);</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a>(chan, 1);</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Idle channel &#39;%s&#39; answered, sending to %s@%s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan));</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;            <a class="code" href="../../db/de0/pbx_8h.html#a44b6406c9220f7f2b610ac712369f405">ast_pbx_run</a>(chan);</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;            <span class="comment">/* It&#39;s already hungup, return immediately */</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Idle channel &#39;%s&#39; busy, waiting...\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Idle channel &#39;%s&#39; congested, waiting...\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;         };</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      }</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;      <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;   }</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;   <span class="comment">/* Hangup the channel since nothing happend */</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(chan);</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;}</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *pri_ss_thread(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;{</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p = data;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;   <span class="keywordtype">char</span> exten[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> <a class="code" href="../../df/d3c/structast__channel.html#a62f8995a6eac6c8a48205a6f3815d54b">callid</a>;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;   <span class="keywordflow">if</span> (!chan) {</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      <span class="comment">/* We lost the owner before we could get started. */</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;   }</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;   <span class="keywordflow">if</span> ((callid = <a class="code" href="../../d5/d7b/channel_8h.html#a6c2c406bdebd477029e61774cc300abd">ast_channel_callid</a>(chan))) {</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a6956becf4d7e3906c74b6e30b834ebd8">ast_callid_threadassoc_add</a>(callid);</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;   }</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;<span class="comment">    * In the bizarre case where the channel has become a zombie before we</span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="comment">    * even get started here, abort safely.</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7b/channel_8h.html#a3dc9d235c0e16ab0a6812b4aa6572cce">ast_channel_tech_pvt</a>(chan)) {</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel became a zombie before simple switch could be started (%s)\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(chan);</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;   }</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Starting simple switch on &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;   sig_pri_dsp_reset_and_flush_digits(p);</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;   <span class="comment">/* Now loop looking for an extension */</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(exten, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(exten));</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;   len = strlen(exten);</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;   res = 0;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;   <span class="keywordflow">while</span> ((len &lt; <a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>-1) &amp;&amp; <a class="code" href="../../db/de0/pbx_8h.html#ac359af75b9494f50904583d2168a7577">ast_matchmore_extension</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan), exten, 1, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>)) {</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      <span class="keywordflow">if</span> (len &amp;&amp; !<a class="code" href="../../db/de0/pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3">ast_ignore_pattern</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan), exten))</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;         sig_pri_play_tone(p, -1);</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;         sig_pri_play_tone(p, <a class="code" href="../../d7/d6c/sig__pri_8h.html#ae264fa3d1f9d29c2c76c99bfa13ce95ca2d37f45a9668a50e609b29622d00e0c5">SIG_PRI_TONE_DIALTONE</a>);</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan), exten, 1, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>))</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;         timeout = pri_matchdigittimeout;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;         timeout = pri_gendigittimeout;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;      res = <a class="code" href="../../d5/d7b/channel_8h.html#a050bec9a4abc1a599b6573a6091b080c">ast_waitfordigit</a>(chan, timeout);</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      <span class="keywordflow">if</span> (res &lt; 0) {</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;waitfordigit returned &lt; 0...\n&quot;</span>);</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(chan);</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;         exten[len++] = res;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;         exten[<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;   }</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;   <span class="comment">/* if no extension was received (&#39;unspecified&#39;) on overlap call, use the &#39;s&#39; extension */</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(exten)) {</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Going to extension s|1 because of empty extension received on overlap call\n&quot;</span>);</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      exten[0] = <span class="charliteral">&#39;s&#39;</span>;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      exten[1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a63732831df3e7a0999b0900ec85c626a">ast_channel_dialed</a>(chan)-&gt;number.<a class="code" href="../../d1/dd1/structast__party__dialed.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>);</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a63732831df3e7a0999b0900ec85c626a">ast_channel_dialed</a>(chan)-&gt;<a class="code" href="../../d1/dd1/structast__party__dialed.html#a436a3700bd4ae24751d7fad4538466aa">number</a>.<a class="code" href="../../d1/dd1/structast__party__dialed.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(exten);</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a798fd91893ed411125afa28a5a7addc7">append_msn_to_user_tag</a> &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">nodetype</a> != PRI_NETWORK) {</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="comment">          * Update the user tag for party id&#39;s from this device for this call</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="comment">          * now that we have a complete MSN from the network.</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;         snprintf(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>), <span class="stringliteral">&quot;%s_%s&quot;</span>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#af985df4218702eebfb4949ccd29657ca">initial_user_tag</a>,</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;            exten);</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.tag);</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<a class="code" href="../../d4/d77/structast__party__caller.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>);</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;      }</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;   }</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;   sig_pri_play_tone(p, -1);</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan), exten, 1, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>)) {</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;      <span class="comment">/* Start the real PBX */</span></div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a>(chan, exten);</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;      sig_pri_dsp_reset_and_flush_digits(p);</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="preprocessor">#if defined(JIRA_ASTERISK_15594)</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="comment">       * Conditionaled out this code to effectively revert the JIRA</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="comment">       * ASTERISK-15594 change.  It breaks overlap dialing through</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;<span class="comment">       * Asterisk.  There is not enough information available at this</span></div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;<span class="comment">       * point to know if dialing is complete.  The</span></div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="comment">       * ast_exists_extension(), ast_matchmore_extension(), and</span></div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;<span class="comment">       * ast_canmatch_extension() calls are not adequate to detect a</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;<span class="comment">       * dial through extension pattern of &quot;_9!&quot;.</span></div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;<span class="comment">       * Workaround is to use the dialplan Proceeding() application</span></div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;<span class="comment">       * early on non-dial through extensions.</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">overlapdial</a> &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>)</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;         &amp;&amp; !<a class="code" href="../../db/de0/pbx_8h.html#ac359af75b9494f50904583d2168a7577">ast_matchmore_extension</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan), exten, 1, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>)) {</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;         sig_pri_lock_private(p);</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>) {</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;            pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;            <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a60273beaf5da6262358cc2add8aa2765">SIG_PRI_CALL_LEVEL_PROCEEDING</a>) {</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;               p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a60273beaf5da6262358cc2add8aa2765">SIG_PRI_CALL_LEVEL_PROCEEDING</a>;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;            }</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;            pri_proceeding(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, PVT_TO_CHANNEL(p), 0);</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;            pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;         }</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;         sig_pri_unlock_private(p);</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;      }</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(JIRA_ASTERISK_15594) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      sig_pri_set_echocanceller(p, 1);</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <a class="code" href="../../d9/d95/channelstate_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448">ast_setstate</a>(chan, <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>);</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      res = <a class="code" href="../../db/de0/pbx_8h.html#a44b6406c9220f7f2b610ac712369f405">ast_pbx_run</a>(chan);</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;      <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;PBX exited non-zero!\n&quot;</span>);</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      }</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;No such possible extension &#39;%s&#39; in context &#39;%s&#39;\n&quot;</span>, exten, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan));</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(chan, <a class="code" href="../../d4/da3/causes_8h.html#a131d8780af378d0c4ef5075949902785">AST_CAUSE_UNALLOCATED</a>);</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(chan);</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;      p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;      <span class="comment">/* Since we send release complete here, we won&#39;t get one */</span></div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;      p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;      sig_pri_span_devstate_changed(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;   }</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;}</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#ae340d6d4a8b26ed4c604768d817fff0c">pri_event_alarm</a>(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> index, <span class="keywordtype">int</span> before_start_pri)</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;{</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;   pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">dchanavail</a>[index] &amp;= ~DCHAN_NOTINALARM;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;   <span class="keywordflow">if</span> (!before_start_pri) {</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;      pri_find_dchan(pri);</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;   }</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;}</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#ac78d645f6e15d770b1d413281cb0c89b">pri_event_noalarm</a>(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> index, <span class="keywordtype">int</span> before_start_pri)</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;{</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;   pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">dchanavail</a>[index] |= DCHAN_NOTINALARM;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;   <span class="keywordflow">if</span> (!before_start_pri)</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;      pri_restart(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[index]);</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;}</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;<span class="comment"> * \brief Convert libpri party name into asterisk party name.</span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;<span class="comment"> * \param ast_name Asterisk party name structure to fill.  Must already be set initialized.</span></div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="comment"> * \param pri_name libpri party name structure containing source information.</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;<span class="comment"> * \note The filled in ast_name structure needs to be destroyed by</span></div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;<span class="comment"> * ast_party_name_free() when it is no longer needed.</span></div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_party_name_convert(<span class="keyword">struct</span> <a class="code" href="../../d8/d6f/structast__party__name.html">ast_party_name</a> *ast_name, <span class="keyword">const</span> <span class="keyword">struct</span> pri_party_name *pri_name)</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;{</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;   ast_name-&gt;<a class="code" href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(pri_name-&gt;str);</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;   ast_name-&gt;<a class="code" href="../../d8/d6f/structast__party__name.html#a1fb9f03e5de01bf0a8f221e627fa9a7b">char_set</a> = pri_to_ast_char_set(pri_name-&gt;char_set);</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;   ast_name-&gt;<a class="code" href="../../d8/d6f/structast__party__name.html#a3df9119032baa1743f2db71344bd7cac">presentation</a> = pri_to_ast_presentation(pri_name-&gt;presentation);</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;   ast_name-&gt;<a class="code" href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">valid</a> = 1;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;}</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;<span class="comment"> * \brief Convert libpri party number into asterisk party number.</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="comment"> * \param ast_number Asterisk party number structure to fill.  Must already be set initialized.</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="comment"> * \param pri_number libpri party number structure containing source information.</span></div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="comment"> * \note The filled in ast_number structure needs to be destroyed by</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="comment"> * ast_party_number_free() when it is no longer needed.</span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_party_number_convert(<span class="keyword">struct</span> <a class="code" href="../../d6/dbb/structast__party__number.html">ast_party_number</a> *ast_number, <span class="keyword">const</span> <span class="keyword">struct</span> pri_party_number *pri_number, <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;{</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;   <span class="keywordtype">char</span> number[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a> * 2];</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;   apply_plan_to_existing_number(number, <span class="keyword">sizeof</span>(number), pri, pri_number-&gt;str,</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      pri_number-&gt;plan);</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;   ast_number-&gt;<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(number);</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;   ast_number-&gt;<a class="code" href="../../d6/dbb/structast__party__number.html#ad1f8db563cb99d404b72e02cf8f78cd1">plan</a> = pri_number-&gt;plan;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;   ast_number-&gt;<a class="code" href="../../d6/dbb/structast__party__number.html#a3df9119032baa1743f2db71344bd7cac">presentation</a> = pri_to_ast_presentation(pri_number-&gt;presentation);</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;   ast_number-&gt;<a class="code" href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">valid</a> = 1;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;}</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="comment"> * \brief Convert libpri party id into asterisk party id.</span></div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;<span class="comment"> * \param ast_id Asterisk party id structure to fill.  Must already be set initialized.</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;<span class="comment"> * \param pri_id libpri party id structure containing source information.</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="comment"> * \note The filled in ast_id structure needs to be destroyed by</span></div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="comment"> * ast_party_id_free() when it is no longer needed.</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_party_id_convert(<span class="keyword">struct</span> <a class="code" href="../../d1/dcb/structast__party__id.html">ast_party_id</a> *ast_id, <span class="keyword">const</span> <span class="keyword">struct</span> pri_party_id *pri_id, <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;{</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;   <span class="keywordflow">if</span> (pri_id-&gt;name.valid) {</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      sig_pri_party_name_convert(&amp;ast_id-&gt;<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>, &amp;pri_id-&gt;name);</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;   }</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;   <span class="keywordflow">if</span> (pri_id-&gt;number.valid) {</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;      sig_pri_party_number_convert(&amp;ast_id-&gt;<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>, &amp;pri_id-&gt;number, pri);</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;   }</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SUBADDR)</span></div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;   <span class="keywordflow">if</span> (pri_id-&gt;subaddress.valid) {</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;      sig_pri_set_subaddress(&amp;ast_id-&gt;<a class="code" href="../../d1/dcb/structast__party__id.html#a10023f503341f2b8c82117b31a0cc531">subaddress</a>, &amp;pri_id-&gt;subaddress);</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;   }</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SUBADDR) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;}</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="comment"> * \brief Convert libpri redirecting information into asterisk redirecting information.</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="comment"> * \param ast_redirecting Asterisk redirecting structure to fill.</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="comment"> * \param pri_redirecting libpri redirecting structure containing source information.</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="comment"> * \param ast_guide Asterisk redirecting structure to use as an initialization guide.</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="comment"> * \note The filled in ast_redirecting structure needs to be destroyed by</span></div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;<span class="comment"> * ast_party_redirecting_free() when it is no longer needed.</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_redirecting_convert(<span class="keyword">struct</span> <a class="code" href="../../df/d44/structast__party__redirecting.html">ast_party_redirecting</a> *ast_redirecting,</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> pri_party_redirecting *pri_redirecting,</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../df/d44/structast__party__redirecting.html">ast_party_redirecting</a> *ast_guide,</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;{</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a8ec95c9df838fdfbb514995efb96bf82">ast_party_redirecting_set_init</a>(ast_redirecting, ast_guide);</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;   sig_pri_party_id_convert(&amp;ast_redirecting-&gt;<a class="code" href="../../df/d44/structast__party__redirecting.html#ad91368b8b243737d0a7fb6644f35809e">orig</a>, &amp;pri_redirecting-&gt;orig_called, pri);</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;   sig_pri_party_id_convert(&amp;ast_redirecting-&gt;<a class="code" href="../../df/d44/structast__party__redirecting.html#acf09e8312b8b4396ec42c5147cdf9b5b">from</a>, &amp;pri_redirecting-&gt;from, pri);</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;   sig_pri_party_id_convert(&amp;ast_redirecting-&gt;<a class="code" href="../../df/d44/structast__party__redirecting.html#ad6644f992fc696511eebf8732e98e74a">to</a>, &amp;pri_redirecting-&gt;to, pri);</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;   ast_redirecting-&gt;<a class="code" href="../../df/d44/structast__party__redirecting.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = pri_redirecting-&gt;count;</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;   ast_redirecting-&gt;<a class="code" href="../../df/d44/structast__party__redirecting.html#aa961ad9bce0cf7679c5d938519ff1885">reason</a>.<a class="code" href="../../d1/dee/structast__party__redirecting__reason.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a> = pri_to_ast_reason(pri_redirecting-&gt;reason);</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;   ast_redirecting-&gt;<a class="code" href="../../df/d44/structast__party__redirecting.html#aa17ec85399145e14c9f08d81a2261231">orig_reason</a>.<a class="code" href="../../d1/dee/structast__party__redirecting__reason.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a> = pri_to_ast_reason(pri_redirecting-&gt;orig_reason);</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;}</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;<span class="comment"> * \brief Determine if the given extension matches one of the MSNs in the pattern list.</span></div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="comment"> * \param msn_patterns Comma separated list of MSN patterns to match.</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="comment"> * \param exten Extension to match in the MSN list.</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="comment"> * \retval 1 if matches.</span></div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="comment"> * \retval 0 if no match.</span></div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_msn_match(<span class="keyword">const</span> <span class="keywordtype">char</span> *msn_patterns, <span class="keyword">const</span> <span class="keywordtype">char</span> *exten)</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;{</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;   <span class="keywordtype">char</span> *pattern;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d4/d60/structmsn__list.html">msn_list</a>;</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;   <span class="keywordtype">char</span> *list_tail;</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;   msn_list = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(msn_patterns);</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;   list_tail = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;   pattern = strtok_r(msn_list, <span class="stringliteral">&quot;,&quot;</span>, &amp;list_tail);</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;   <span class="keywordflow">while</span> (pattern) {</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;      pattern = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(pattern);</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(pattern) &amp;&amp; <a class="code" href="../../db/de0/pbx_8h.html#aa0e4fd3343c8c7ee979a6a44d2113495">ast_extension_match</a>(pattern, exten)) {</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;         <span class="comment">/* Extension matched the pattern. */</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      }</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;      pattern = strtok_r(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;,&quot;</span>, &amp;list_tail);</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;   }</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;   <span class="comment">/* Did not match any pattern in the list. */</span></div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;}</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MCID)</span></div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> party_number_json_to_ami(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **msg, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>, <span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *number)</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;{</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *num_txt, *pres_txt;</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;   <span class="keywordtype">int</span> plan, pres;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;   <span class="keywordflow">if</span> (!number) {</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0,</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;         <span class="stringliteral">&quot;%sNumValid: 0\r\n&quot;</span></div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;         <span class="stringliteral">&quot;%sNum: \r\n&quot;</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;         <span class="stringliteral">&quot;%ston: 0\r\n&quot;</span>,</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;         prefix, prefix, prefix);</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;   }</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;   num_txt = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(number, <span class="stringliteral">&quot;number&quot;</span>));</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;   plan = <a class="code" href="../../d4/d05/json_8h.html#ad20fdcbab1ed5c078284a687cced2877">ast_json_integer_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(number, <span class="stringliteral">&quot;plan&quot;</span>));</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;   pres = <a class="code" href="../../d4/d05/json_8h.html#ad20fdcbab1ed5c078284a687cced2877">ast_json_integer_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(number, <span class="stringliteral">&quot;presentation&quot;</span>));</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;   pres_txt = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(number, <span class="stringliteral">&quot;presentation_txt&quot;</span>));</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sNumValid: 1\r\n&quot;</span>, prefix);</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sNum: %s\r\n&quot;</span>, prefix, num_txt);</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%ston: %d\r\n&quot;</span>, prefix, plan);</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sNumPlan: %d\r\n&quot;</span>, prefix, plan);</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sNumPres: %d (%s)\r\n&quot;</span>, prefix, pres, pres_txt);</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;}</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> party_name_json_to_ami(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **msg, <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix, <span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;{</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *name_txt, *pres_txt, *<a class="code" href="../../d1/d6d/chan__unistim_8c.html#a8bd4accafd4e712317ed9a471738a971">charset</a>;</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;   <span class="keywordtype">int</span> pres;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;   <span class="keywordflow">if</span> (!name) {</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0,</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;         <span class="stringliteral">&quot;%sNameValid: 0\r\n&quot;</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;         <span class="stringliteral">&quot;%sName: \r\n&quot;</span>,</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;         prefix, prefix);</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;   }</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;   name_txt = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(name, <span class="stringliteral">&quot;name&quot;</span>));</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;   charset = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(name, <span class="stringliteral">&quot;character_set&quot;</span>));</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;   pres = <a class="code" href="../../d4/d05/json_8h.html#ad20fdcbab1ed5c078284a687cced2877">ast_json_integer_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(name, <span class="stringliteral">&quot;presentation&quot;</span>));</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;   pres_txt = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(name, <span class="stringliteral">&quot;presentation_txt&quot;</span>));</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sNameValid: 1\r\n&quot;</span>, prefix);</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sName: %s\r\n&quot;</span>, prefix, name_txt);</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sNameCharSet: %s\r\n&quot;</span>, prefix, charset);</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sNamePres: %d (%s)\r\n&quot;</span>, prefix, pres, pres_txt);</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;}</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> party_subaddress_json_to_ami(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **msg, <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix, <span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *subaddress)</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;{</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *subaddress_txt, *type_txt;</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;   <span class="keywordtype">int</span> odd;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;   <span class="keywordflow">if</span> (!subaddress) {</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;   }</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;   subaddress_txt = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(subaddress, <span class="stringliteral">&quot;subaddress&quot;</span>));</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;   type_txt = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(subaddress, <span class="stringliteral">&quot;type&quot;</span>));</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;   odd = <a class="code" href="../../d4/d05/json_8h.html#ae19fc17ca5bc416b135feb64bfeb6b9e">ast_json_is_true</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(subaddress, <span class="stringliteral">&quot;odd&quot;</span>)) ? 1 : 0;</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sSubaddr: %s\r\n&quot;</span>, prefix, subaddress_txt);</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sSubaddrType: %s\r\n&quot;</span>, prefix, type_txt);</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sSubaddrOdd: %d\r\n&quot;</span>, prefix, odd);</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;}</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;<span class="comment"> * \brief Append the given JSON party id to the event string.</span></div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="comment"> * \param msg Event message string being built.</span></div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;<span class="comment"> * \param prefix Prefix to add to the party id lines.</span></div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;<span class="comment"> * \param party Party information to encode.</span></div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> party_json_to_ami(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **msg, <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix, <span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *party)</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;{</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *presentation = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(party, <span class="stringliteral">&quot;presentation&quot;</span>);</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *presentation_txt = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(party, <span class="stringliteral">&quot;presentation_txt&quot;</span>);</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *name = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(party, <span class="stringliteral">&quot;name&quot;</span>);</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *number = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(party, <span class="stringliteral">&quot;number&quot;</span>);</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *subaddress = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(party, <span class="stringliteral">&quot;subaddress&quot;</span>);</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;   <span class="comment">/* Combined party presentation */</span></div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(msg, 0, <span class="stringliteral">&quot;%sPres: %jd (%s)\r\n&quot;</span>, prefix,</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;      <a class="code" href="../../d4/d05/json_8h.html#ad20fdcbab1ed5c078284a687cced2877">ast_json_integer_get</a>(presentation),</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;      <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(presentation_txt));</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;   <span class="comment">/* Party number */</span></div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;   party_number_json_to_ami(msg, prefix, number);</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;   <span class="comment">/* Party name */</span></div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;   party_name_json_to_ami(msg, prefix, name);</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;   <span class="comment">/* Party subaddress */</span></div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;   party_subaddress_json_to_ami(msg, prefix, subaddress);</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;}</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dd/d96/structast__manager__event__blob.html">ast_manager_event_blob</a> *mcid_to_ami(<span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg)</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;{</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *, channel_string, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *, party_string, <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(256), <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/df0/structast__channel__blob.html">ast_channel_blob</a> *obj = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(msg);</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;   <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="../../db/df0/structast__channel__blob.html#a36584c0251e54a7af4892d63f7a28c77">snapshot</a>) {</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;      channel_string = <a class="code" href="../../db/d45/manager_8h.html#a777cde87d12b331902f862ec44641688">ast_manager_build_channel_state_string</a>(obj-&gt;<a class="code" href="../../db/df0/structast__channel__blob.html#a36584c0251e54a7af4892d63f7a28c77">snapshot</a>);</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;      <span class="keywordflow">if</span> (!channel_string) {</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      }</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;   }</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;   party_json_to_ami(&amp;party_string, <span class="stringliteral">&quot;MCallerID&quot;</span>, <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(obj-&gt;<a class="code" href="../../db/df0/structast__channel__blob.html#ad2b8e22df32b99651f727cd9a8dcb9f3">blob</a>, <span class="stringliteral">&quot;caller&quot;</span>));</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;   party_json_to_ami(&amp;party_string, <span class="stringliteral">&quot;MConnectedID&quot;</span>, <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(obj-&gt;<a class="code" href="../../db/df0/structast__channel__blob.html#ad2b8e22df32b99651f727cd9a8dcb9f3">blob</a>, <span class="stringliteral">&quot;connected&quot;</span>));</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d45/manager_8h.html#a3ace32eaf9a3fc2f7d15121c64bf8ecd">ast_manager_event_blob_create</a>(<a class="code" href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;MCID&quot;</span>,</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;      <span class="stringliteral">&quot;%s&quot;</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;      <span class="stringliteral">&quot;%s&quot;</span>,</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(obj-&gt;<a class="code" href="../../db/df0/structast__channel__blob.html#a36584c0251e54a7af4892d63f7a28c77">snapshot</a>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(channel_string), <span class="stringliteral">&quot;&quot;</span>), <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(party_string));</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;}</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<a class="code" href="../../dd/d79/stasis_8h.html#a51fb372b38f434a3bab7a5ec5e65c396">STASIS_MESSAGE_TYPE_DEFN_LOCAL</a>(mcid_type,</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;   .<a class="code" href="../../d2/d3d/res__pjsip__exten__state_8c.html#ae8731a90be4dc2d8272b7dfd8a001d4c">to_ami</a> = mcid_to_ami,</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;   );</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> send_mcid(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d1/dcb/structast__party__id.html">ast_party_id</a> *caller, <span class="keyword">struct</span> <a class="code" href="../../d1/dcb/structast__party__id.html">ast_party_id</a> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a414b69d7583bb4cfc6daf5276aac6d14">connected</a>)</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;{</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, <a class="code" href="../../db/df0/structast__channel__blob.html#ad2b8e22df32b99651f727cd9a8dcb9f3">blob</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>);</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(caller != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(connected != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;   <a class="code" href="../../db/df0/structast__channel__blob.html#ad2b8e22df32b99651f727cd9a8dcb9f3">blob</a> = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: o, s: o}&quot;</span>,</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      <span class="stringliteral">&quot;caller&quot;</span>, <a class="code" href="../../d4/d05/json_8h.html#ae312205990ae66d95f79f11a0ab50a31">ast_json_party_id</a>(caller),</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;      <span class="stringliteral">&quot;connected&quot;</span>, <a class="code" href="../../d4/d05/json_8h.html#ae312205990ae66d95f79f11a0ab50a31">ast_json_party_id</a>(connected));</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../db/df0/structast__channel__blob.html#ad2b8e22df32b99651f727cd9a8dcb9f3">blob</a>) {</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;   }</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;   <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf03b8daa7784a26648db90614add6caa">ast_channel_publish_blob</a>(chan, mcid_type(), <a class="code" href="../../db/df0/structast__channel__blob.html#ad2b8e22df32b99651f727cd9a8dcb9f3">blob</a>);</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;}</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;<span class="comment"> * \brief Handle the MCID event.</span></div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;<span class="comment"> * \param mcid MCID event parameters.</span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;<span class="comment"> * \param owner Asterisk channel associated with the call.</span></div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;<span class="comment"> * NULL if Asterisk no longer has the ast_channel struct.</span></div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;<span class="comment"> * \note Assumes the owner channel lock is already obtained if still present.</span></div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_mcid_event(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keyword">const</span> <span class="keyword">struct</span> pri_subcmd_mcid_req *mcid, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner)</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;{</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/dcb/structast__party__id.html">ast_party_id</a> caller_party;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/dcb/structast__party__id.html">ast_party_id</a> connected_party;</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;   <span class="comment">/* Always use libpri&#39;s called party information. */</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a2126ac3bbc1a14f6ed5ccdfcbb851776">ast_party_id_init</a>(&amp;connected_party);</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;   sig_pri_party_id_convert(&amp;connected_party, &amp;mcid-&gt;answerer, pri);</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;   <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="comment">       * The owner channel is present.</span></div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;<span class="comment">       * Pass the event to the peer as well.</span></div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a60f9d2b0ab8b7a839902313321163b28">ast_queue_control</a>(owner, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a6265e05e606bb17be5cd81a309cf98a2">AST_CONTROL_MCID</a>);</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;      send_mcid(owner, &amp;<a class="code" href="../../d5/d7b/channel_8h.html#a10f23f1907b804485f62973f66cd9aef">ast_channel_connected</a>(owner)-&gt;<span class="keywordtype">id</span>, &amp;connected_party);</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;<span class="comment">       * Since we no longer have an owner channel,</span></div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;<span class="comment">       * we have to use the caller information supplied by libpri.</span></div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a2126ac3bbc1a14f6ed5ccdfcbb851776">ast_party_id_init</a>(&amp;caller_party);</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;      sig_pri_party_id_convert(&amp;caller_party, &amp;mcid-&gt;originator, pri);</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;      send_mcid(owner, &amp;caller_party, &amp;connected_party);</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a5399dc7357197254794b990b263a2b7b">ast_party_id_free</a>(&amp;caller_party);</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;   }</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a5399dc7357197254794b990b263a2b7b">ast_party_id_free</a>(&amp;connected_party);</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;}</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MCID) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;<span class="keyword">struct </span>xfer_rsp_data {</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>;<span class="comment"></span></div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;<span class="comment">   /*! Call to send transfer success/fail response over. */</span></div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;   q931_call *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#acc941e909d1ca6a0997028d9562d78da">call</a>;<span class="comment"></span></div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;<span class="comment">   /*! Invocation ID to use when sending a reply to the transfer request. */</span></div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;   <span class="keywordtype">int</span> invoke_id;<span class="comment"></span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;<span class="comment">   /*! TRUE if the transfer response has been made. */</span></div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;   <span class="keywordtype">int</span> responded;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;};</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;<span class="comment"> * \brief Send the transfer success/fail response message.</span></div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;<span class="comment"> * \param rsp Transfer response data.</span></div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;<span class="comment"> * \param is_successful TRUE if the transfer was successful.</span></div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="comment"> * \note Assumes the rsp-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_transfer_rsp(<span class="keyword">struct</span> xfer_rsp_data *rsp, <span class="keywordtype">int</span> is_successful)</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;{</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;   <span class="keywordflow">if</span> (rsp-&gt;responded) {</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;   }</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;   rsp-&gt;responded = 1;</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;   pri_transfer_rsp(rsp-&gt;pri-&gt;pri, rsp-&gt;call, rsp-&gt;invoke_id, is_successful);</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;}</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD) || defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;<span class="comment"> * \brief Attempt to transfer the two calls to each other.</span></div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;<span class="comment"> * \param call_1_pri First call involved in the transfer. (transferee; usually on hold)</span></div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="comment"> * \param call_1_held TRUE if call_1_pri is on hold.</span></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;<span class="comment"> * \param call_2_pri Second call involved in the transfer. (target; usually active/ringing)</span></div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;<span class="comment"> * \param call_2_held TRUE if call_2_pri is on hold.</span></div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;<span class="comment"> * \param xfer_data Transfer response data if non-NULL.</span></div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_attempt_transfer(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, q931_call *call_1_pri, <span class="keywordtype">int</span> call_1_held, q931_call *call_2_pri, <span class="keywordtype">int</span> call_2_held, <span class="keyword">struct</span> xfer_rsp_data *xfer_data)</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;{</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;   <span class="keyword">struct </span>attempt_xfer_call {</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;      q931_call *pri;</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *ast;</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;      <span class="keywordtype">int</span> held;</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;      <span class="keywordtype">int</span> chanpos;</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;   };</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../db/d37/hsearch_8c.html#ad0f0f85b3cab490a81baa02c4b9edf45">retval</a>;</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17">ast_transfer_result</a> xfer_res;</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;   <span class="keyword">struct </span>attempt_xfer_call *call_1;</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;   <span class="keyword">struct </span>attempt_xfer_call *call_2;</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;   <span class="keyword">struct </span>attempt_xfer_call c1;</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;   <span class="keyword">struct </span>attempt_xfer_call c2;</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;   c1.pri = call_1_pri;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;   c1.held = call_1_held;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;   call_1 = &amp;c1;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;   c2.pri = call_2_pri;</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;   c2.held = call_2_held;</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;   call_2 = &amp;c2;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;   call_1-&gt;chanpos = pri_find_principle_by_call(pri, call_1-&gt;pri);</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;   call_2-&gt;chanpos = pri_find_principle_by_call(pri, call_2-&gt;pri);</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;   <span class="keywordflow">if</span> (call_1-&gt;chanpos &lt; 0 || call_2-&gt;chanpos &lt; 0) {</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;      <span class="comment">/* Calls not found in span control. */</span></div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;      <span class="keywordflow">if</span> (xfer_data) {</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;         <span class="comment">/* Transfer failed. */</span></div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;         sig_pri_transfer_rsp(xfer_data, 0);</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;      }</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;   }</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;   <span class="comment">/* Get call_1 owner. */</span></div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;   sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_1-&gt;chanpos]);</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;   sig_pri_lock_owner(pri, call_1-&gt;chanpos);</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;   call_1-&gt;ast = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_1-&gt;chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;   <span class="keywordflow">if</span> (call_1-&gt;ast) {</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a>(call_1-&gt;ast);</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(call_1-&gt;ast);</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;   }</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;   sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_1-&gt;chanpos]);</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;   <span class="comment">/* Get call_2 owner. */</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;   sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_2-&gt;chanpos]);</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;   sig_pri_lock_owner(pri, call_2-&gt;chanpos);</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;   call_2-&gt;ast = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_2-&gt;chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;   <span class="keywordflow">if</span> (call_2-&gt;ast) {</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a>(call_2-&gt;ast);</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(call_2-&gt;ast);</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;   }</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;   sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_2-&gt;chanpos]);</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;   <span class="keywordflow">if</span> (!call_1-&gt;ast || !call_2-&gt;ast) {</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;      <span class="comment">/* At least one owner is not present. */</span></div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;      <span class="keywordflow">if</span> (call_1-&gt;ast) {</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(call_1-&gt;ast);</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;      }</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;      <span class="keywordflow">if</span> (call_2-&gt;ast) {</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(call_2-&gt;ast);</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;      }</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;      <span class="keywordflow">if</span> (xfer_data) {</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;         <span class="comment">/* Transfer failed. */</span></div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;         sig_pri_transfer_rsp(xfer_data, 0);</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;      }</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;   }</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;TRANSFERRING %s to %s\n&quot;</span>,</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(call_1-&gt;ast), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(call_2-&gt;ast));</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;   <span class="keywordflow">if</span> (xfer_data) {</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;<span class="comment">       * Add traps on the transferer channels in case threading causes</span></div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;<span class="comment">       * them to hangup before ast_bridge_transfer_attended() returns</span></div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;<span class="comment">       * and we can get the pri-&gt;lock back.</span></div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;      sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_1-&gt;chanpos]);</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_1-&gt;chanpos]-&gt;xfer_data = xfer_data;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_1-&gt;chanpos]);</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;      sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_2-&gt;chanpos]);</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_2-&gt;chanpos]-&gt;xfer_data = xfer_data;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;      sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[call_2-&gt;chanpos]);</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;   }</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;   xfer_res = <a class="code" href="../../d4/d56/bridge_8h.html#aec45146e91e4d8bc2a7d2cf083c4dac0">ast_bridge_transfer_attended</a>(call_1-&gt;ast, call_2-&gt;ast);</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;   retval = (xfer_res != <a class="code" href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17a6b0053a1a47d100ef5f155f068c08934">AST_BRIDGE_TRANSFER_SUCCESS</a>) ? -1 : 0;</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;   <span class="keywordflow">if</span> (xfer_data) {</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;      <span class="keywordtype">int</span> rsp_chanpos;</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;<span class="comment">       * Remove the transferrer channel traps.</span></div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;<span class="comment">       * We must refind chanpos because we released pri-&gt;lock.</span></div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;      rsp_chanpos = pri_find_principle_by_call(pri, call_1-&gt;pri);</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;      <span class="keywordflow">if</span> (0 &lt;= rsp_chanpos) {</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;         sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[rsp_chanpos]);</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[rsp_chanpos]-&gt;xfer_data = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;         sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[rsp_chanpos]);</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;      }</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;      rsp_chanpos = pri_find_principle_by_call(pri, call_2-&gt;pri);</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;      <span class="keywordflow">if</span> (0 &lt;= rsp_chanpos) {</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;         sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[rsp_chanpos]);</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[rsp_chanpos]-&gt;xfer_data = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;         sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[rsp_chanpos]);</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;      }</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;      <span class="comment">/* Report transfer status. */</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;      sig_pri_transfer_rsp(xfer_data, retval ? 0 : 1);</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;   }</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(call_1-&gt;ast);</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(call_2-&gt;ast);</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d37/hsearch_8c.html#ad0f0f85b3cab490a81baa02c4b9edf45">retval</a>;</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;}</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) || defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;<span class="comment"> * \brief Compare the CC agent private data by libpri cc_id.</span></div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;<span class="comment"> * \param obj pointer to the (user-defined part) of an object.</span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;<span class="comment"> * \param arg callback argument from ao2_callback()</span></div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;<span class="comment"> * \param flags flags from ao2_callback()</span></div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;<span class="comment"> * \return values are a combination of enum _cb_results.</span></div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_cc_agent_cmp_cc_id(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;{</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent_1 = obj;</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_agent_prv *agent_prv_1 = agent_1-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_agent_prv *agent_prv_2 = arg;</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;   <span class="keywordflow">return</span> (agent_prv_1 &amp;&amp; agent_prv_1-&gt;pri == agent_prv_2-&gt;pri</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;      &amp;&amp; agent_prv_1-&gt;cc_id == agent_prv_2-&gt;cc_id) ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;}</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="comment"> * \brief Find the CC agent by libpri cc_id.</span></div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="comment"> * \param cc_id CC record ID to find.</span></div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;<span class="comment"> * \note</span></div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;<span class="comment"> * Since agents are refcounted, and this function returns</span></div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;<span class="comment"> * a reference to the agent, it is imperative that you decrement</span></div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;<span class="comment"> * the refcount of the agent once you have finished using it.</span></div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;<span class="comment"> * \retval agent on success.</span></div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;<span class="comment"> * \retval NULL not found.</span></div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *sig_pri_find_cc_agent_by_cc_id(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">long</span> cc_id)</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;{</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_agent_prv finder = {</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;      .pri = pri,</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;      .cc_id = cc_id,</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;   };</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/dc8/ccss_8h.html#ac9a717c8b12205435084874c2f833d8a">ast_cc_agent_callback</a>(0, sig_pri_cc_agent_cmp_cc_id, &amp;finder,</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;      sig_pri_cc_type_name);</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;}</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="comment"> * \brief Compare the CC monitor instance by libpri cc_id.</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="comment"> * \param obj pointer to the (user-defined part) of an object.</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;<span class="comment"> * \param arg callback argument from ao2_callback()</span></div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;<span class="comment"> * \param flags flags from ao2_callback()</span></div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;<span class="comment"> * \return values are a combination of enum _cb_results.</span></div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_cc_monitor_cmp_cc_id(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;{</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *monitor_1 = obj;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *monitor_2 = arg;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;   <span class="keywordflow">return</span> (monitor_1-&gt;pri == monitor_2-&gt;pri</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;      &amp;&amp; monitor_1-&gt;cc_id == monitor_2-&gt;cc_id) ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;}</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;<span class="comment"> * \brief Find the CC monitor instance by libpri cc_id.</span></div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;<span class="comment"> * \param cc_id CC record ID to find.</span></div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;<span class="comment"> * \note</span></div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;<span class="comment"> * Since monitor_instances are refcounted, and this function returns</span></div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;<span class="comment"> * a reference to the instance, it is imperative that you decrement</span></div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;<span class="comment"> * the refcount of the instance once you have finished using it.</span></div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;<span class="comment"> * \retval monitor_instance on success.</span></div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;<span class="comment"> * \retval NULL not found.</span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span>sig_pri_cc_monitor_instance *sig_pri_find_cc_monitor_by_cc_id(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">long</span> cc_id)</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;{</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance finder = {</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;      .pri = pri,</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;      .cc_id = cc_id,</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;   };</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(sig_pri_cc_monitors, 0, sig_pri_cc_monitor_cmp_cc_id, &amp;finder);</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;}</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;<span class="comment"> * \brief Destroy the given monitor instance.</span></div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;<span class="comment"> * \param data Monitor instance to destroy.</span></div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_cc_monitor_instance_destroy(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;{</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *monitor_instance = data;</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;   <span class="keywordflow">if</span> (monitor_instance-&gt;cc_id != -1) {</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;monitor_instance-&gt;pri-&gt;lock);</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;      pri_cc_cancel(monitor_instance-&gt;pri-&gt;pri, monitor_instance-&gt;cc_id);</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;monitor_instance-&gt;pri-&gt;lock);</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;   }</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;   <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ad049075cd52b3f86d2524940af4c98de">module_unref</a>();</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;}</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;<span class="comment"> * \brief Construct a new monitor instance.</span></div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;<span class="comment"> * \param core_id CC core ID.</span></div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;<span class="comment"> * \param cc_id CC record ID.</span></div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="comment"> * \param device_name Name of device (Asterisk channel name less sequence number).</span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="comment"> * \note</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="comment"> * Since monitor_instances are refcounted, and this function returns</span></div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;<span class="comment"> * a reference to the instance, it is imperative that you decrement</span></div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="comment"> * the refcount of the instance once you have finished using it.</span></div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;<span class="comment"> * \retval monitor_instance on success.</span></div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;<span class="comment"> * \retval NULL on error.</span></div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span>sig_pri_cc_monitor_instance *sig_pri_cc_monitor_instance_init(<span class="keywordtype">int</span> core_id, <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">long</span> cc_id, <span class="keyword">const</span> <span class="keywordtype">char</span> *device_name)</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;{</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *monitor_instance;</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a4cc7c3ad72e2848945d8c5a2bbdf7d68">module_ref</a> || !<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#ad049075cd52b3f86d2524940af4c98de">module_unref</a>) {</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;   }</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;   monitor_instance = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*monitor_instance) + strlen(device_name),</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;      sig_pri_cc_monitor_instance_destroy);</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;   <span class="keywordflow">if</span> (!monitor_instance) {</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;   }</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;   monitor_instance-&gt;cc_id = cc_id;</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;   monitor_instance-&gt;pri = pri;</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;   monitor_instance-&gt;core_id = core_id;</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;   strcpy(monitor_instance-&gt;name, device_name);</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;   <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a4cc7c3ad72e2848945d8c5a2bbdf7d68">module_ref</a>();</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(sig_pri_cc_monitors, monitor_instance);</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;   <span class="keywordflow">return</span> monitor_instance;</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;}</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;<span class="comment"> * \brief Announce to the CC core that protocol CC monitor is available for this call.</span></div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;<span class="comment"> * \param cc_id CC record ID.</span></div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;<span class="comment"> * \param service CCBS/CCNR indication.</span></div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_owner(pri, chanpos) is already obtained.</span></div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_cc_available(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos, <span class="keywordtype">long</span> cc_id, <span class="keyword">enum</span> <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530">ast_cc_service_type</a> <a class="code" href="../../d5/dfe/chan__sip_8c.html#a495cc24c1947d49a2b6de488a45c9d72">service</a>)</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;{</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt;</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d2e/structast__cc__config__params.html">ast_cc_config_params</a> *cc_params;</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *<a class="code" href="../../da/dde/chan__phone_8c.html#a4e40373706bcf5cdb9409dac3166d280">monitor</a>;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4">ast_cc_monitor_policies</a> monitor_policy;</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;   <span class="keywordtype">int</span> core_id;</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;   <span class="keywordtype">char</span> device_name[<a class="code" href="../../d5/d7b/channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>];</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;   <span class="keywordtype">char</span> dialstring[<a class="code" href="../../d5/d7b/channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>];</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;   pvt = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos];</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;   core_id = <a class="code" href="../../de/dc8/ccss_8h.html#af78031bab9c298a15d07a5f30ed0c3df">ast_cc_get_current_core_id</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;   <span class="keywordflow">if</span> (core_id == -1) {</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;   }</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;   cc_params = <a class="code" href="../../d5/d7b/channel_8h.html#a7df9da0e99e443d7ae13dc07bbc57dcd">ast_channel_get_cc_config_params</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;   <span class="keywordflow">if</span> (!cc_params) {</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;   }</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;   res = -1;</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;   monitor_policy = <a class="code" href="../../de/dc8/ccss_8h.html#aafed4bcde7e857db88ca60471e709a55">ast_get_cc_monitor_policy</a>(cc_params);</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;   <span class="keywordflow">switch</span> (monitor_policy) {</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4a302a65a5fc7468b6b96af0ec39eedae2">AST_CC_MONITOR_NEVER</a>:</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;      <span class="comment">/* CCSS is not enabled. */</span></div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4a8f6c86645c00c1789fec227c20bfa66e">AST_CC_MONITOR_NATIVE</a>:</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4a7b88359e04845d054178fb03d238ea77">AST_CC_MONITOR_ALWAYS</a>:</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;<span class="comment">       * If it is AST_CC_MONITOR_ALWAYS and native fails we will attempt the fallback</span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;<span class="comment">       * later in the call to sig_pri_cc_generic_check().</span></div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a1677fd1f6e2cab646aeb76db8a044c2e">ast_channel_get_device_name</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, device_name, <span class="keyword">sizeof</span>(device_name));</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;      sig_pri_make_cc_dialstring(pvt, dialstring, <span class="keyword">sizeof</span>(dialstring));</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      monitor = sig_pri_cc_monitor_instance_init(core_id, pri, cc_id, device_name);</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;      <span class="keywordflow">if</span> (!monitor) {</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;      }</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;      res = <a class="code" href="../../de/dc8/ccss_8h.html#ac83e01d7016c2eca52aa5748e91e1cd9">ast_queue_cc_frame</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, sig_pri_cc_type_name, dialstring, service,</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;         monitor);</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;      <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;         monitor-&gt;cc_id = -1;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(sig_pri_cc_monitors, monitor);</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;      }</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4af60dcecaf7e419b66f364595c3739b05">AST_CC_MONITOR_GENERIC</a>:</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;      <a class="code" href="../../de/dc8/ccss_8h.html#ac83e01d7016c2eca52aa5748e91e1cd9">ast_queue_cc_frame</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="../../de/dc8/ccss_8h.html#a1c00e4618fa5ece215682cf02519ab55">AST_CC_GENERIC_MONITOR_TYPE</a>,</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;         sig_pri_get_orig_dialstring(pvt), service, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;      <span class="comment">/* Say it failed to force caller to cancel native CC. */</span></div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;   }</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;}</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;<span class="comment"> * \brief Check if generic CC monitor is needed and request it.</span></div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;<span class="comment"> * \param service CCBS/CCNR indication.</span></div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_cc_generic_check(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos, <span class="keyword">enum</span> <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530">ast_cc_service_type</a> service)</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;{</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d2e/structast__cc__config__params.html">ast_cc_config_params</a> *cc_params;</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d6e/structast__cc__monitor.html">ast_cc_monitor</a> *<a class="code" href="../../da/dde/chan__phone_8c.html#a4e40373706bcf5cdb9409dac3166d280">monitor</a>;</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;   <span class="keywordtype">char</span> device_name[<a class="code" href="../../d5/d7b/channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>];</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4">ast_cc_monitor_policies</a> monitor_policy;</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d6e/structast__cc__monitor.html#a72a2c55008105f91d1af2942453eca2b">core_id</a>;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;   <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a>) {</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;      <span class="comment">/* This is not an outgoing call so it cannot be CC monitor. */</span></div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;   }</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;   sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;   owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;   <span class="keywordflow">if</span> (!owner) {</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;   }</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;   core_id = <a class="code" href="../../de/dc8/ccss_8h.html#af78031bab9c298a15d07a5f30ed0c3df">ast_cc_get_current_core_id</a>(owner);</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;   <span class="keywordflow">if</span> (core_id == -1) {</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;      <span class="comment">/* No CC core setup */</span></div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;   }</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;   cc_params = <a class="code" href="../../d5/d7b/channel_8h.html#a7df9da0e99e443d7ae13dc07bbc57dcd">ast_channel_get_cc_config_params</a>(owner);</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;   <span class="keywordflow">if</span> (!cc_params) {</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;      <span class="comment">/* Could not get CC config parameters. */</span></div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;   }</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a1677fd1f6e2cab646aeb76db8a044c2e">ast_channel_get_device_name</a>(owner, device_name, <span class="keyword">sizeof</span>(device_name));</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;   monitor = <a class="code" href="../../de/dc8/ccss_8h.html#a05d18d9e83ba249ca1e5f23c537f2535">ast_cc_get_monitor_by_recall_core_id</a>(core_id, device_name);</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;   <span class="keywordflow">if</span> (monitor) {</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      <span class="comment">/* CC monitor is already present so no need for generic CC. */</span></div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;   }</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;   monitor_policy = <a class="code" href="../../de/dc8/ccss_8h.html#aafed4bcde7e857db88ca60471e709a55">ast_get_cc_monitor_policy</a>(cc_params);</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;   <span class="keywordflow">switch</span> (monitor_policy) {</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4a302a65a5fc7468b6b96af0ec39eedae2">AST_CC_MONITOR_NEVER</a>:</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;      <span class="comment">/* CCSS is not enabled. */</span></div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4a8f6c86645c00c1789fec227c20bfa66e">AST_CC_MONITOR_NATIVE</a>:</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="../../d5/db3/chan__dahdi_8h.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a> &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">nodetype</a> == PRI_NETWORK) {</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;         <span class="comment">/* Request generic CC monitor. */</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;         <a class="code" href="../../de/dc8/ccss_8h.html#ac83e01d7016c2eca52aa5748e91e1cd9">ast_queue_cc_frame</a>(owner, <a class="code" href="../../de/dc8/ccss_8h.html#a1c00e4618fa5ece215682cf02519ab55">AST_CC_GENERIC_MONITOR_TYPE</a>,</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;            sig_pri_get_orig_dialstring(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]), service, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;      }</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4a7b88359e04845d054178fb03d238ea77">AST_CC_MONITOR_ALWAYS</a>:</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="../../d5/db3/chan__dahdi_8h.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a> &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">nodetype</a> != PRI_NETWORK) {</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;<span class="comment">          * Cannot monitor PTMP TE side since this is not defined.</span></div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;<span class="comment">          * We are playing the roll of a phone in this case and</span></div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;<span class="comment">          * a phone cannot monitor a party over the network without</span></div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;<span class="comment">          * protocol help.</span></div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;      }</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;<span class="comment">       * We are either falling back or this is a PTMP NT span.</span></div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;<span class="comment">       * Request generic CC monitor.</span></div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;      <a class="code" href="../../de/dc8/ccss_8h.html#ac83e01d7016c2eca52aa5748e91e1cd9">ast_queue_cc_frame</a>(owner, <a class="code" href="../../de/dc8/ccss_8h.html#a1c00e4618fa5ece215682cf02519ab55">AST_CC_GENERIC_MONITOR_TYPE</a>,</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;         sig_pri_get_orig_dialstring(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]), service, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4af60dcecaf7e419b66f364595c3739b05">AST_CC_MONITOR_GENERIC</a>:</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="../../d5/db3/chan__dahdi_8h.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a> &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">nodetype</a> == PRI_NETWORK) {</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;         <span class="comment">/* Request generic CC monitor. */</span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;         <a class="code" href="../../de/dc8/ccss_8h.html#ac83e01d7016c2eca52aa5748e91e1cd9">ast_queue_cc_frame</a>(owner, <a class="code" href="../../de/dc8/ccss_8h.html#a1c00e4618fa5ece215682cf02519ab55">AST_CC_GENERIC_MONITOR_TYPE</a>,</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;            sig_pri_get_orig_dialstring(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]), service, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;      }</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;   }</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;<a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>:</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;}</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;<span class="comment"> * \brief The CC link canceled the CC instance.</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;<span class="comment"> * \param cc_id CC record ID.</span></div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;<span class="comment"> * \param is_agent TRUE if the cc_id is for an agent.</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_cc_link_canceled(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">long</span> cc_id, <span class="keywordtype">int</span> is_agent)</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;{</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;   <span class="keywordflow">if</span> (is_agent) {</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent;</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;      agent = sig_pri_find_cc_agent_by_cc_id(pri, cc_id);</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;      <span class="keywordflow">if</span> (!agent) {</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;         <span class="keywordflow">return</span>;</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;      }</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;      <a class="code" href="../../de/dc8/ccss_8h.html#ad25ea527a36ed77fcba9eb1eba0b4186">ast_cc_failed</a>(agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#a48e5b8fb1ab4916549247ea116b8f5b9">core_id</a>, <span class="stringliteral">&quot;%s agent got canceled by link&quot;</span>,</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;         sig_pri_cc_type_name);</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(agent, -1);</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;      <span class="keyword">struct </span>sig_pri_cc_monitor_instance *<a class="code" href="../../da/dde/chan__phone_8c.html#a4e40373706bcf5cdb9409dac3166d280">monitor</a>;</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;      monitor = sig_pri_find_cc_monitor_by_cc_id(pri, cc_id);</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;      <span class="keywordflow">if</span> (!monitor) {</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;         <span class="keywordflow">return</span>;</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;      }</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;      monitor-&gt;cc_id = -1;</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;      <a class="code" href="../../de/dc8/ccss_8h.html#ad179ffd63f6ff74454f58c58d7248368">ast_cc_monitor_failed</a>(monitor-&gt;core_id, monitor-&gt;name,</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;         <span class="stringliteral">&quot;%s monitor got canceled by link&quot;</span>, sig_pri_cc_type_name);</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;   }</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;}</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;<span class="comment"> * \brief Convert ast_aoc_charged_item to PRI_AOC_CHARGED_ITEM .</span></div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;<span class="comment"> * \param value Value to convert to string.</span></div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;<span class="comment"> * \return PRI_AOC_CHARGED_ITEM</span></div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> PRI_AOC_CHARGED_ITEM sig_pri_aoc_charged_item_to_pri(<span class="keyword">enum</span> PRI_AOC_CHARGED_ITEM <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>)</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;{</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;   <span class="keywordflow">switch</span> (value) {</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a2d7ad212799bb6b541f626bcaf181168">AST_AOC_CHARGED_ITEM_NA</a>:</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_CHARGED_ITEM_NOT_AVAILABLE;</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a2b26875eb31f0e8bebcaeacfaf72c934">AST_AOC_CHARGED_ITEM_SPECIAL_ARRANGEMENT</a>:</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_CHARGED_ITEM_SPECIAL_ARRANGEMENT;</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a25788b7cfbb10de1565909f726083407">AST_AOC_CHARGED_ITEM_BASIC_COMMUNICATION</a>:</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_CHARGED_ITEM_BASIC_COMMUNICATION;</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411aade837dc9996d9f33a8b2e0ec2dd73c7">AST_AOC_CHARGED_ITEM_CALL_ATTEMPT</a>:</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_CHARGED_ITEM_CALL_ATTEMPT;</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a8caefba33453702b9c8a342908e9a31e">AST_AOC_CHARGED_ITEM_CALL_SETUP</a>:</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_CHARGED_ITEM_CALL_SETUP;</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a625570cd7e855a633bb7be2a2c16327f">AST_AOC_CHARGED_ITEM_USER_USER_INFO</a>:</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_CHARGED_ITEM_USER_USER_INFO;</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a90ab9e785008e0919573fd09f088334c">AST_AOC_CHARGED_ITEM_SUPPLEMENTARY_SERVICE</a>:</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_CHARGED_ITEM_SUPPLEMENTARY_SERVICE;</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;   }</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;   <span class="keywordflow">return</span> PRI_AOC_CHARGED_ITEM_NOT_AVAILABLE;</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;}</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;<span class="comment"> * \brief Convert PRI_AOC_CHARGED_ITEM to ast_aoc_charged_item.</span></div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;<span class="comment"> * \param value Value to convert to string.</span></div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;<span class="comment"> * \return ast_aoc_charged_item</span></div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411">ast_aoc_s_charged_item</a> sig_pri_aoc_charged_item_to_ast(<span class="keyword">enum</span> PRI_AOC_CHARGED_ITEM value)</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;{</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;   <span class="keywordflow">switch</span> (value) {</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_CHARGED_ITEM_NOT_AVAILABLE:</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a2d7ad212799bb6b541f626bcaf181168">AST_AOC_CHARGED_ITEM_NA</a>;</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_CHARGED_ITEM_SPECIAL_ARRANGEMENT:</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a2b26875eb31f0e8bebcaeacfaf72c934">AST_AOC_CHARGED_ITEM_SPECIAL_ARRANGEMENT</a>;</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_CHARGED_ITEM_BASIC_COMMUNICATION:</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a25788b7cfbb10de1565909f726083407">AST_AOC_CHARGED_ITEM_BASIC_COMMUNICATION</a>;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_CHARGED_ITEM_CALL_ATTEMPT:</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411aade837dc9996d9f33a8b2e0ec2dd73c7">AST_AOC_CHARGED_ITEM_CALL_ATTEMPT</a>;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_CHARGED_ITEM_CALL_SETUP:</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a8caefba33453702b9c8a342908e9a31e">AST_AOC_CHARGED_ITEM_CALL_SETUP</a>;</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_CHARGED_ITEM_USER_USER_INFO:</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a625570cd7e855a633bb7be2a2c16327f">AST_AOC_CHARGED_ITEM_USER_USER_INFO</a>;</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_CHARGED_ITEM_SUPPLEMENTARY_SERVICE:</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a90ab9e785008e0919573fd09f088334c">AST_AOC_CHARGED_ITEM_SUPPLEMENTARY_SERVICE</a>;</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;   }</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a2d7ad212799bb6b541f626bcaf181168">AST_AOC_CHARGED_ITEM_NA</a>;</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;}</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;<span class="comment"> * \brief Convert AST_AOC_MULTIPLER to PRI_AOC_MULTIPLIER.</span></div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;<span class="comment"> * \return pri enum equivalent.</span></div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_aoc_multiplier_from_ast(<span class="keyword">enum</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089">ast_aoc_currency_multiplier</a> mult)</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;{</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;   <span class="keywordflow">switch</span> (mult) {</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a865002098f4bc4e8e711bd3d2450f6bf">AST_AOC_MULT_ONETHOUSANDTH</a>:</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_MULTIPLIER_THOUSANDTH;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a218074f0220f2224fa4c4cab5281834a">AST_AOC_MULT_ONEHUNDREDTH</a>:</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_MULTIPLIER_HUNDREDTH;</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a6060df3e95e44802a372af9f0eb5ebaf">AST_AOC_MULT_ONETENTH</a>:</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_MULTIPLIER_TENTH;</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089ab55dc209b59be84c7162d3128565ab36">AST_AOC_MULT_ONE</a>:</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_MULTIPLIER_ONE;</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a20055187dd0b3834fe5cc313e1f08965">AST_AOC_MULT_TEN</a>:</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_MULTIPLIER_TEN;</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a27a0c84a4d31cb0060200d36100c1c75">AST_AOC_MULT_HUNDRED</a>:</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_MULTIPLIER_HUNDRED;</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089ab00c5e861fc1c84070bb4af0ae15690b">AST_AOC_MULT_THOUSAND</a>:</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_MULTIPLIER_THOUSAND;</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_MULTIPLIER_ONE;</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;   }</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;}</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;<span class="comment"> * \brief Convert PRI_AOC_MULTIPLIER to AST_AOC_MULTIPLIER</span></div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;<span class="comment"> * \return ast enum equivalent.</span></div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_aoc_multiplier_from_pri(<span class="keyword">const</span> <span class="keywordtype">int</span> mult)</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;{</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;   <span class="keywordflow">switch</span> (mult) {</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_MULTIPLIER_THOUSANDTH:</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a865002098f4bc4e8e711bd3d2450f6bf">AST_AOC_MULT_ONETHOUSANDTH</a>;</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_MULTIPLIER_HUNDREDTH:</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a218074f0220f2224fa4c4cab5281834a">AST_AOC_MULT_ONEHUNDREDTH</a>;</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_MULTIPLIER_TENTH:</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a6060df3e95e44802a372af9f0eb5ebaf">AST_AOC_MULT_ONETENTH</a>;</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_MULTIPLIER_ONE:</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089ab55dc209b59be84c7162d3128565ab36">AST_AOC_MULT_ONE</a>;</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_MULTIPLIER_TEN:</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a20055187dd0b3834fe5cc313e1f08965">AST_AOC_MULT_TEN</a>;</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_MULTIPLIER_HUNDRED:</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a27a0c84a4d31cb0060200d36100c1c75">AST_AOC_MULT_HUNDRED</a>;</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_MULTIPLIER_THOUSAND:</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089ab00c5e861fc1c84070bb4af0ae15690b">AST_AOC_MULT_THOUSAND</a>;</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089ab55dc209b59be84c7162d3128565ab36">AST_AOC_MULT_ONE</a>;</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;   }</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;}</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;<span class="comment"> * \brief Convert ast_aoc_time_scale representation to PRI_AOC_TIME_SCALE</span></div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;<span class="comment"> * \param value Value to convert to ast representation</span></div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;<span class="comment"> * \return PRI_AOC_TIME_SCALE</span></div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> PRI_AOC_TIME_SCALE sig_pri_aoc_scale_to_pri(<span class="keyword">enum</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402">ast_aoc_time_scale</a> value)</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;{</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;   <span class="keywordflow">switch</span> (value) {</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402afdac340bd7e2c98dd1f2f45a6ed1670a">AST_AOC_TIME_SCALE_HUNDREDTH_SECOND</a>:</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_TIME_SCALE_HUNDREDTH_SECOND;</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402aac5248537cff99345656f6671b1504b6">AST_AOC_TIME_SCALE_TENTH_SECOND</a>:</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_TIME_SCALE_TENTH_SECOND;</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402ae00c4894ab4f166394380b3b8ff2ea32">AST_AOC_TIME_SCALE_SECOND</a>:</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_TIME_SCALE_SECOND;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402a794877492ffef9d20af12d1faaada02d">AST_AOC_TIME_SCALE_TEN_SECOND</a>:</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_TIME_SCALE_TEN_SECOND;</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402ac64a47c6076f6dadc3a9d47594a756af">AST_AOC_TIME_SCALE_MINUTE</a>:</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_TIME_SCALE_MINUTE;</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402ae03e07e3d0015100bb0318f555c6ddff">AST_AOC_TIME_SCALE_HOUR</a>:</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_TIME_SCALE_HOUR;</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402a89a323e13121bee405e164653d824913">AST_AOC_TIME_SCALE_DAY</a>:</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;      <span class="keywordflow">return</span> PRI_AOC_TIME_SCALE_DAY;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;   }</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;}</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;<span class="comment"> * \brief Convert PRI_AOC_TIME_SCALE to ast aoc representation</span></div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;<span class="comment"> * \param value Value to convert to ast representation</span></div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;<span class="comment"> * \return ast aoc time scale</span></div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402">ast_aoc_time_scale</a> sig_pri_aoc_scale_to_ast(<span class="keyword">enum</span> PRI_AOC_TIME_SCALE value)</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;{</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;   <span class="keywordflow">switch</span> (value) {</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_TIME_SCALE_HUNDREDTH_SECOND:</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402afdac340bd7e2c98dd1f2f45a6ed1670a">AST_AOC_TIME_SCALE_HUNDREDTH_SECOND</a>;</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_TIME_SCALE_TENTH_SECOND:</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402aac5248537cff99345656f6671b1504b6">AST_AOC_TIME_SCALE_TENTH_SECOND</a>;</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_TIME_SCALE_SECOND:</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402ae00c4894ab4f166394380b3b8ff2ea32">AST_AOC_TIME_SCALE_SECOND</a>;</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_TIME_SCALE_TEN_SECOND:</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402a794877492ffef9d20af12d1faaada02d">AST_AOC_TIME_SCALE_TEN_SECOND</a>;</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_TIME_SCALE_MINUTE:</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402ac64a47c6076f6dadc3a9d47594a756af">AST_AOC_TIME_SCALE_MINUTE</a>;</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_TIME_SCALE_HOUR:</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402ae03e07e3d0015100bb0318f555c6ddff">AST_AOC_TIME_SCALE_HOUR</a>;</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_TIME_SCALE_DAY:</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402a89a323e13121bee405e164653d824913">AST_AOC_TIME_SCALE_DAY</a>;</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;   }</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402afdac340bd7e2c98dd1f2f45a6ed1670a">AST_AOC_TIME_SCALE_HUNDREDTH_SECOND</a>;</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;}</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;<span class="comment"> * \brief Handle AOC-S control frame</span></div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;<span class="comment"> * \param aoc_s AOC-S event parameters.</span></div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;<span class="comment"> * \param owner Asterisk channel associated with the call.</span></div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;<span class="comment"> * \param passthrough indicating if this message should be queued on the ast channel</span></div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;<span class="comment"> * \note Assumes the sig_pri private is locked</span></div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;<span class="comment"> * \note Assumes the owner channel lock is already obtained.</span></div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_aoc_s_from_pri(<span class="keyword">const</span> <span class="keyword">struct</span> pri_subcmd_aoc_s *aoc_s, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner, <span class="keywordtype">int</span> passthrough)</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;{</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dca/structast__aoc__decoded.html">ast_aoc_decoded</a> *decoded = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d72/structast__aoc__encoded.html">ast_aoc_encoded</a> *encoded = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;   <span class="keywordtype">size_t</span> encoded_size = 0;</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;   <span class="keywordflow">if</span> (!owner || !aoc_s) {</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;   }</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;   <span class="keywordflow">if</span> (!(decoded = <a class="code" href="../../d6/db3/aoc_8h.html#ada9b84ac8130231cee87ba4d33a5dda0">ast_aoc_create</a>(<a class="code" href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548a3cdee929459fa195eabd19f5c156c7ec">AST_AOC_S</a>, 0, 0))) {</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;   }</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; aoc_s-&gt;num_items; ++idx) {</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;      <span class="keyword">enum</span> <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411">ast_aoc_s_charged_item</a> charged_item;</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;      charged_item = sig_pri_aoc_charged_item_to_ast(aoc_s-&gt;item[idx].chargeable);</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;      <span class="keywordflow">if</span> (charged_item == <a class="code" href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a2d7ad212799bb6b541f626bcaf181168">AST_AOC_CHARGED_ITEM_NA</a>) {</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;         <span class="comment">/* Delete the unknown charged item from the list. */</span></div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;      }</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;      <span class="keywordflow">switch</span> (aoc_s-&gt;item[idx].rate_type) {</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;      <span class="keywordflow">case</span> PRI_AOC_RATE_TYPE_DURATION:</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;         <a class="code" href="../../d6/db3/aoc_8h.html#a1e39f2e893091c0780856e2080c57360">ast_aoc_s_add_rate_duration</a>(decoded,</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;            charged_item,</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;            aoc_s-&gt;item[idx].rate.duration.amount.cost,</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;            sig_pri_aoc_multiplier_from_pri(aoc_s-&gt;item[idx].rate.duration.amount.multiplier),</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;            aoc_s-&gt;item[idx].rate.duration.currency,</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;            aoc_s-&gt;item[idx].rate.duration.time.length,</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;            sig_pri_aoc_scale_to_ast(aoc_s-&gt;item[idx].rate.duration.time.scale),</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;            aoc_s-&gt;item[idx].rate.duration.granularity.length,</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;            sig_pri_aoc_scale_to_ast(aoc_s-&gt;item[idx].rate.duration.granularity.scale),</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;            aoc_s-&gt;item[idx].rate.duration.charging_type);</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;      <span class="keywordflow">case</span> PRI_AOC_RATE_TYPE_FLAT:</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;         <a class="code" href="../../d6/db3/aoc_8h.html#a91718e9eba530fcfee96c53e68021dbc">ast_aoc_s_add_rate_flat</a>(decoded,</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;            charged_item,</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;            aoc_s-&gt;item[idx].rate.flat.amount.cost,</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;            sig_pri_aoc_multiplier_from_pri(aoc_s-&gt;item[idx].rate.flat.amount.multiplier),</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;            aoc_s-&gt;item[idx].rate.flat.currency);</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;      <span class="keywordflow">case</span> PRI_AOC_RATE_TYPE_VOLUME:</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;         <a class="code" href="../../d6/db3/aoc_8h.html#aa49f963b5a453a69ff3480457aa4415a">ast_aoc_s_add_rate_volume</a>(decoded,</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;            charged_item,</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;            aoc_s-&gt;item[idx].rate.volume.unit,</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;            aoc_s-&gt;item[idx].rate.volume.amount.cost,</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;            sig_pri_aoc_multiplier_from_pri(aoc_s-&gt;item[idx].rate.volume.amount.multiplier),</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;            aoc_s-&gt;item[idx].rate.volume.currency);</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;      <span class="keywordflow">case</span> PRI_AOC_RATE_TYPE_SPECIAL_CODE:</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;         <a class="code" href="../../d6/db3/aoc_8h.html#a3af9ee383a42048c9922f10ad0fc9e92">ast_aoc_s_add_rate_special_charge_code</a>(decoded,</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;            charged_item,</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;            aoc_s-&gt;item[idx].rate.special);</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;      <span class="keywordflow">case</span> PRI_AOC_RATE_TYPE_FREE:</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;         <a class="code" href="../../d6/db3/aoc_8h.html#a786ba86b9ee2950a6d9639ea85592d72">ast_aoc_s_add_rate_free</a>(decoded, charged_item, 0);</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;      <span class="keywordflow">case</span> PRI_AOC_RATE_TYPE_FREE_FROM_BEGINNING:</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;         <a class="code" href="../../d6/db3/aoc_8h.html#a786ba86b9ee2950a6d9639ea85592d72">ast_aoc_s_add_rate_free</a>(decoded, charged_item, 1);</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;         <a class="code" href="../../d6/db3/aoc_8h.html#ae9395e09a678474ae3a5e6bf4ab72f5f">ast_aoc_s_add_rate_na</a>(decoded, charged_item);</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;      }</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;   }</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;   <span class="keywordflow">if</span> (passthrough &amp;&amp; (encoded = <a class="code" href="../../d6/db3/aoc_8h.html#abbf1344a7eae88ea2cef85c1b0b6c24d">ast_aoc_encode</a>(decoded, &amp;encoded_size, owner))) {</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a7e5e15c22564fd66351d332ad10658b5">ast_queue_control_data</a>(owner, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390af10845d12981bce4e141a5b0ed431494">AST_CONTROL_AOC</a>, encoded, encoded_size);</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;   }</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#ae2665f609286429cb5007507d7c800de">ast_aoc_manager_event</a>(decoded, owner);</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#a33b761090d3debbfd4cdb0c800a13bb2">ast_aoc_destroy_decoded</a>(decoded);</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#a8f66f98f015246c294b10dc2c9350612">ast_aoc_destroy_encoded</a>(encoded);</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;}</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;<span class="comment"> * \brief Generate AOC Request Response</span></div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;<span class="comment"> * \param aoc_request</span></div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;<span class="comment"> * \note Assumes the sig_pri private is locked</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;<span class="comment"> * \note Assumes the owner channel lock is already obtained.</span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_aoc_request_from_pri(<span class="keyword">const</span> <span class="keyword">struct</span> pri_subcmd_aoc_request *aoc_request, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, q931_call *call)</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;{</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a>;</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;   <span class="keywordflow">if</span> (!aoc_request) {</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;   }</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;   request = aoc_request-&gt;charging_request;</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;   <span class="keywordflow">if</span> (request &amp; PRI_AOC_REQUEST_S) {</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;      <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;aoc_passthrough_flag &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ae1ccf2737a073b7016533eacd4ecaa1f">SIG_PRI_AOC_GRANT_S</a>) {</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;         <span class="comment">/* An AOC-S response must come from the other side, so save off this invoke_id</span></div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;<span class="comment">          * and see if an AOC-S message comes in before the call is answered. */</span></div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;         pvt-&gt;aoc_s_request_invoke_id = aoc_request-&gt;invoke_id;</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;         pvt-&gt;aoc_s_request_invoke_id_valid = 1;</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;         pri_aoc_s_request_response_send(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>,</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;            call,</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;            aoc_request-&gt;invoke_id,</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;            <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;      }</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;   }</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;   <span class="keywordflow">if</span> (request &amp; PRI_AOC_REQUEST_D) {</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;      <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;aoc_passthrough_flag &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a7da4d7e4aa12411980e8ad434eba04b4">SIG_PRI_AOC_GRANT_D</a>) {</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;         pri_aoc_de_request_response_send(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>,</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;            call,</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;            PRI_AOC_REQ_RSP_CHARGING_INFO_FOLLOWS,</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;            aoc_request-&gt;invoke_id);</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;         pri_aoc_de_request_response_send(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>,</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;            call,</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;            PRI_AOC_REQ_RSP_ERROR_NOT_AVAILABLE,</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;            aoc_request-&gt;invoke_id);</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;      }</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;   }</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;   <span class="keywordflow">if</span> (request &amp; PRI_AOC_REQUEST_E) {</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;      <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;aoc_passthrough_flag &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab85195824a5cbc6eebb66dc1709f3626">SIG_PRI_AOC_GRANT_E</a>) {</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;         pri_aoc_de_request_response_send(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>,</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;            call,</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;            PRI_AOC_REQ_RSP_CHARGING_INFO_FOLLOWS,</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;            aoc_request-&gt;invoke_id);</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;         pri_aoc_de_request_response_send(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>,</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;            call,</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;            PRI_AOC_REQ_RSP_ERROR_NOT_AVAILABLE,</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;            aoc_request-&gt;invoke_id);</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;      }</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;   }</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;}</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;<span class="comment"> * \brief Generate AOC-D AST_CONTROL_AOC frame</span></div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;<span class="comment"> * \param aoc_e AOC-D event parameters.</span></div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;<span class="comment"> * \param owner Asterisk channel associated with the call.</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;<span class="comment"> * \param passthrough indicating if this message should be queued on the ast channel</span></div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;<span class="comment"> * \note Assumes the sig_pri private is locked</span></div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;<span class="comment"> * \note Assumes the owner channel lock is already obtained.</span></div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_aoc_d_from_pri(<span class="keyword">const</span> <span class="keyword">struct</span> pri_subcmd_aoc_d *aoc_d, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner, <span class="keywordtype">int</span> passthrough)</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;{</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dca/structast__aoc__decoded.html">ast_aoc_decoded</a> *decoded = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d72/structast__aoc__encoded.html">ast_aoc_encoded</a> *encoded = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;   <span class="keywordtype">size_t</span> encoded_size = 0;</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9">ast_aoc_charge_type</a> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>;</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;   <span class="keywordflow">if</span> (!owner || !aoc_d) {</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;   }</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;   <span class="keywordflow">switch</span> (aoc_d-&gt;charge) {</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_DE_CHARGE_CURRENCY:</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;      type = <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a38cfbbe1a40256021b03e1599b1a23ed">AST_AOC_CHARGE_CURRENCY</a>;</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_DE_CHARGE_UNITS:</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;      type = <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a5816131a38e568febf50d316c850c44b">AST_AOC_CHARGE_UNIT</a>;</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_DE_CHARGE_FREE:</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;      type = <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a44da551e5cfa1d51b072685591df0800">AST_AOC_CHARGE_FREE</a>;</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;      type = <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9ad60d324867080b1a1ca3b13db29b27c2">AST_AOC_CHARGE_NA</a>;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;   }</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;   <span class="keywordflow">if</span> (!(decoded = <a class="code" href="../../d6/db3/aoc_8h.html#ada9b84ac8130231cee87ba4d33a5dda0">ast_aoc_create</a>(<a class="code" href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548a463d1c225066e20d4cc56abee5a5b239">AST_AOC_D</a>, type, 0))) {</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;   }</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;   <span class="keywordflow">switch</span> (aoc_d-&gt;billing_accumulation) {</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;AOC-D billing accumulation has unknown value: %d\n&quot;</span>,</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;         aoc_d-&gt;billing_accumulation);</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;      <span class="comment">/* Fall through */</span></div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;   <span class="keywordflow">case</span> 0:<span class="comment">/* subTotal */</span></div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a9dc12343996e18f696da3dcde18fabcb">ast_aoc_set_total_type</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#aed3fe8e8d708e8aff42a2ad205813cb7aff4d08a18d17f2ffe60dd21a316ae677">AST_AOC_SUBTOTAL</a>);</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;   <span class="keywordflow">case</span> 1:<span class="comment">/* total */</span></div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a9dc12343996e18f696da3dcde18fabcb">ast_aoc_set_total_type</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#aed3fe8e8d708e8aff42a2ad205813cb7a437decc9f64054294b48742e48089619">AST_AOC_TOTAL</a>);</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;   }</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;   <span class="keywordflow">switch</span> (aoc_d-&gt;billing_id) {</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_D_BILLING_ID_NORMAL:</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da83b02bda7920334b1d7cb85c53be1d50">AST_AOC_BILLING_NORMAL</a>);</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_D_BILLING_ID_REVERSE:</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1dad1092f5f7da0428ebd4c6ec4ed78d751">AST_AOC_BILLING_REVERSE_CHARGE</a>);</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_D_BILLING_ID_CREDIT_CARD:</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da91a7d97d8c344b40e9aaadc39c4d9269">AST_AOC_BILLING_CREDIT_CARD</a>);</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_D_BILLING_ID_NOT_AVAILABLE:</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1daf2aa1a3d8a87f17ac604cead1964f52f">AST_AOC_BILLING_NA</a>);</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;   }</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;   <span class="keywordflow">switch</span> (aoc_d-&gt;charge) {</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_DE_CHARGE_CURRENCY:</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a84cc9357bb1acbc2b24d7e80780e3b9d">ast_aoc_set_currency_info</a>(decoded,</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;         aoc_d-&gt;recorded.money.amount.cost,</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;         sig_pri_aoc_multiplier_from_pri(aoc_d-&gt;recorded.money.amount.multiplier),</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;         aoc_d-&gt;recorded.money.currency);</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_DE_CHARGE_UNITS:</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;      {</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;         <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; aoc_d-&gt;recorded.unit.num_items; ++i) {</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;            <span class="comment">/* if type or number are negative, then they are not present */</span></div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;            <a class="code" href="../../d6/db3/aoc_8h.html#a6e8ab2944e2d6d1f783b3ebcd7b3c272">ast_aoc_add_unit_entry</a>(decoded,</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;               (aoc_d-&gt;recorded.unit.item[i].number &gt;= 0 ? 1 : 0),</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;               aoc_d-&gt;recorded.unit.item[i].number,</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;               (aoc_d-&gt;recorded.unit.item[i].type &gt;= 0 ? 1 : 0),</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;               aoc_d-&gt;recorded.unit.item[i].type);</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;         }</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;      }</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;   }</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;   <span class="keywordflow">if</span> (passthrough &amp;&amp; (encoded = <a class="code" href="../../d6/db3/aoc_8h.html#abbf1344a7eae88ea2cef85c1b0b6c24d">ast_aoc_encode</a>(decoded, &amp;encoded_size, owner))) {</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a7e5e15c22564fd66351d332ad10658b5">ast_queue_control_data</a>(owner, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390af10845d12981bce4e141a5b0ed431494">AST_CONTROL_AOC</a>, encoded, encoded_size);</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;   }</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#ae2665f609286429cb5007507d7c800de">ast_aoc_manager_event</a>(decoded, owner);</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#a33b761090d3debbfd4cdb0c800a13bb2">ast_aoc_destroy_decoded</a>(decoded);</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#a8f66f98f015246c294b10dc2c9350612">ast_aoc_destroy_encoded</a>(encoded);</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;}</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;<span class="comment"> * \brief Generate AOC-E AST_CONTROL_AOC frame</span></div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;<span class="comment"> * \param aoc_e AOC-E event parameters.</span></div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;<span class="comment"> * \param owner Asterisk channel associated with the call.</span></div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;<span class="comment"> * \param passthrough indicating if this message should be queued on the ast channel</span></div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;<span class="comment"> * \note Assumes the sig_pri private is locked</span></div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;<span class="comment"> * \note Assumes the owner channel lock is already obtained.</span></div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;<span class="comment"> * \note owner channel may be NULL. In that case, generate event only</span></div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_aoc_e_from_pri(<span class="keyword">const</span> <span class="keyword">struct</span> pri_subcmd_aoc_e *aoc_e, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner, <span class="keywordtype">int</span> passthrough)</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;{</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dca/structast__aoc__decoded.html">ast_aoc_decoded</a> *decoded = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d72/structast__aoc__encoded.html">ast_aoc_encoded</a> *encoded = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;   <span class="keywordtype">size_t</span> encoded_size = 0;</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9">ast_aoc_charge_type</a> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>;</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;   <span class="keywordflow">if</span> (!aoc_e) {</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;   }</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;   <span class="keywordflow">switch</span> (aoc_e-&gt;charge) {</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_DE_CHARGE_CURRENCY:</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;      type = <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a38cfbbe1a40256021b03e1599b1a23ed">AST_AOC_CHARGE_CURRENCY</a>;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_DE_CHARGE_UNITS:</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;      type = <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a5816131a38e568febf50d316c850c44b">AST_AOC_CHARGE_UNIT</a>;</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_DE_CHARGE_FREE:</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;      type = <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a44da551e5cfa1d51b072685591df0800">AST_AOC_CHARGE_FREE</a>;</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;      type = <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9ad60d324867080b1a1ca3b13db29b27c2">AST_AOC_CHARGE_NA</a>;</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;   }</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;   <span class="keywordflow">if</span> (!(decoded = <a class="code" href="../../d6/db3/aoc_8h.html#ada9b84ac8130231cee87ba4d33a5dda0">ast_aoc_create</a>(<a class="code" href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548a98adf1ef32c4d9b775cc595795ac4693">AST_AOC_E</a>, type, 0))) {</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;   }</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;   <span class="keywordflow">switch</span> (aoc_e-&gt;associated.charging_type) {</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_E_CHARGING_ASSOCIATION_NUMBER:</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;      <span class="keywordflow">if</span> (!aoc_e-&gt;associated.charge.number.valid) {</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;      }</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a655f2e3693ef15ab3bdfc623807278a7">ast_aoc_set_association_number</a>(decoded, aoc_e-&gt;associated.charge.number.str, aoc_e-&gt;associated.charge.number.plan);</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_E_CHARGING_ASSOCIATION_ID:</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a8f4901f528a0a8c757a12e94178606e6">ast_aoc_set_association_id</a>(decoded, aoc_e-&gt;associated.charge.id);</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;   }</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;   <span class="keywordflow">switch</span> (aoc_e-&gt;billing_id) {</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_E_BILLING_ID_NORMAL:</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da83b02bda7920334b1d7cb85c53be1d50">AST_AOC_BILLING_NORMAL</a>);</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_E_BILLING_ID_REVERSE:</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1dad1092f5f7da0428ebd4c6ec4ed78d751">AST_AOC_BILLING_REVERSE_CHARGE</a>);</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_E_BILLING_ID_CREDIT_CARD:</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da91a7d97d8c344b40e9aaadc39c4d9269">AST_AOC_BILLING_CREDIT_CARD</a>);</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_E_BILLING_ID_CALL_FORWARDING_UNCONDITIONAL:</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1daceee6b8982426596fe14c3948aa29987">AST_AOC_BILLING_CALL_FWD_UNCONDITIONAL</a>);</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_E_BILLING_ID_CALL_FORWARDING_BUSY:</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da204aa062b4281ee428f0709259f73116">AST_AOC_BILLING_CALL_FWD_BUSY</a>);</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_E_BILLING_ID_CALL_FORWARDING_NO_REPLY:</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da5c049c80395b1353839451a4f6d790e3">AST_AOC_BILLING_CALL_FWD_NO_REPLY</a>);</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_E_BILLING_ID_CALL_DEFLECTION:</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da848e7e562e4048e4b0ea85d176afa76c">AST_AOC_BILLING_CALL_DEFLECTION</a>);</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_E_BILLING_ID_CALL_TRANSFER:</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da9f62d8ce9119202ffb00eb74d5db7412">AST_AOC_BILLING_CALL_TRANSFER</a>);</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_E_BILLING_ID_NOT_AVAILABLE:</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a>(decoded, <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1daf2aa1a3d8a87f17ac604cead1964f52f">AST_AOC_BILLING_NA</a>);</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;   }</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;   <span class="keywordflow">switch</span> (aoc_e-&gt;charge) {</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_DE_CHARGE_CURRENCY:</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;      <a class="code" href="../../d6/db3/aoc_8h.html#a84cc9357bb1acbc2b24d7e80780e3b9d">ast_aoc_set_currency_info</a>(decoded,</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;         aoc_e-&gt;recorded.money.amount.cost,</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;         sig_pri_aoc_multiplier_from_pri(aoc_e-&gt;recorded.money.amount.multiplier),</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;         aoc_e-&gt;recorded.money.currency);</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;   <span class="keywordflow">case</span> PRI_AOC_DE_CHARGE_UNITS:</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;      {</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;         <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; aoc_e-&gt;recorded.unit.num_items; ++i) {</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;            <span class="comment">/* if type or number are negative, then they are not present */</span></div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;            <a class="code" href="../../d6/db3/aoc_8h.html#a6e8ab2944e2d6d1f783b3ebcd7b3c272">ast_aoc_add_unit_entry</a>(decoded,</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;               (aoc_e-&gt;recorded.unit.item[i].number &gt;= 0 ? 1 : 0),</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;               aoc_e-&gt;recorded.unit.item[i].number,</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;               (aoc_e-&gt;recorded.unit.item[i].type &gt;= 0 ? 1 : 0),</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;               aoc_e-&gt;recorded.unit.item[i].type);</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;         }</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;      }</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;   }</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;   <span class="keywordflow">if</span> (passthrough &amp;&amp; owner &amp;&amp; (encoded = <a class="code" href="../../d6/db3/aoc_8h.html#abbf1344a7eae88ea2cef85c1b0b6c24d">ast_aoc_encode</a>(decoded, &amp;encoded_size, owner))) {</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a7e5e15c22564fd66351d332ad10658b5">ast_queue_control_data</a>(owner, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390af10845d12981bce4e141a5b0ed431494">AST_CONTROL_AOC</a>, encoded, encoded_size);</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;   }</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#ae2665f609286429cb5007507d7c800de">ast_aoc_manager_event</a>(decoded, owner);</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#a33b761090d3debbfd4cdb0c800a13bb2">ast_aoc_destroy_decoded</a>(decoded);</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#a8f66f98f015246c294b10dc2c9350612">ast_aoc_destroy_encoded</a>(encoded);</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;}</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;<span class="comment"> * \brief send an AOC-S message on the current call</span></div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;<span class="comment"> * \param pvt sig_pri private channel structure.</span></div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;<span class="comment"> * \param generic decoded ast AOC message</span></div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;<span class="comment"> * \note Assumes that the PRI lock is already obtained.</span></div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_aoc_s_from_ast(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">struct</span> <a class="code" href="../../d9/dca/structast__aoc__decoded.html">ast_aoc_decoded</a> *decoded)</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;{</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;   <span class="keyword">struct </span>pri_subcmd_aoc_s aoc_s = { 0, };</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d4/de4/structast__aoc__s__entry.html">ast_aoc_s_entry</a> *<a class="code" href="../../d3/d96/structentry.html">entry</a>;</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../d6/db3/aoc_8h.html#ac1f3beff212225f7a1b240cdc60616b5">ast_aoc_s_get_count</a>(decoded); idx++) {</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;      <span class="keywordflow">if</span> (!(entry = <a class="code" href="../../d6/db3/aoc_8h.html#a8ae6592d8c3d40717734be55c9c522e9">ast_aoc_s_get_rate_info</a>(decoded, idx))) {</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;      }</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;      aoc_s.item[idx].chargeable = sig_pri_aoc_charged_item_to_pri(entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#a3b28fa9fd5a6e01aa753b433867531ab">charged_item</a>);</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;      <span class="keywordflow">switch</span> (entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ae1ae65af34ec51676f3d0c860561bbfe">rate_type</a>) {</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136a73286142ba88e883850e58b7d9862ca1">AST_AOC_RATE_TYPE_DURATION</a>:</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;         aoc_s.item[idx].rate_type = PRI_AOC_RATE_TYPE_DURATION;</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;         aoc_s.item[idx].rate.duration.amount.cost = entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ac8692012a6454afe71a9472e22f57fcb">duration</a>.<a class="code" href="../../d6/d53/structast__aoc__duration__rate.html#a070da2496793ccf8efc39f311bcda914">amount</a>;</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;         aoc_s.item[idx].rate.duration.amount.multiplier =</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;            sig_pri_aoc_multiplier_from_ast(entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ac8692012a6454afe71a9472e22f57fcb">duration</a>.<a class="code" href="../../d6/d53/structast__aoc__duration__rate.html#a2c5b15b6851f558acabe1294d0e84e1c">multiplier</a>);</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;         aoc_s.item[idx].rate.duration.time.length = entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ac8692012a6454afe71a9472e22f57fcb">duration</a>.<a class="code" href="../../d6/d53/structast__aoc__duration__rate.html#ae73654f333e4363463ad8c594eca1905">time</a>;</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;         aoc_s.item[idx].rate.duration.time.scale =</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;            sig_pri_aoc_scale_to_pri(entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ac8692012a6454afe71a9472e22f57fcb">duration</a>.<a class="code" href="../../d6/d53/structast__aoc__duration__rate.html#a5fa7310aeb706ad22dd07d338959a9af">time_scale</a>);</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;         aoc_s.item[idx].rate.duration.granularity.length = entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ac8692012a6454afe71a9472e22f57fcb">duration</a>.<a class="code" href="../../d6/d53/structast__aoc__duration__rate.html#a6bf79289fabcea29afd55cee906c53d7">granularity_time</a>;</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;         aoc_s.item[idx].rate.duration.granularity.scale =</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;            sig_pri_aoc_scale_to_pri(entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ac8692012a6454afe71a9472e22f57fcb">duration</a>.<a class="code" href="../../d6/d53/structast__aoc__duration__rate.html#a4519a215298e0964839d61c49e9c85f4">granularity_time_scale</a>);</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;         aoc_s.item[idx].rate.duration.charging_type = entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ac8692012a6454afe71a9472e22f57fcb">duration</a>.<a class="code" href="../../d6/d53/structast__aoc__duration__rate.html#a4f6be1c174ff49ae4c0c696e75cccfcf">charging_type</a>;</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ac8692012a6454afe71a9472e22f57fcb">duration</a>.<a class="code" href="../../d6/d53/structast__aoc__duration__rate.html#a2854e091b0a0f6c8da639ced777fe99d">currency_name</a>)) {</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(aoc_s.item[idx].rate.duration.currency,</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;               entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ac8692012a6454afe71a9472e22f57fcb">duration</a>.<a class="code" href="../../d6/d53/structast__aoc__duration__rate.html#a2854e091b0a0f6c8da639ced777fe99d">currency_name</a>,</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;               <span class="keyword">sizeof</span>(aoc_s.item[idx].rate.duration.currency));</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;         }</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136aae1181ffe5fdb5bfa119c3421f44e944">AST_AOC_RATE_TYPE_FLAT</a>:</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;         aoc_s.item[idx].rate_type = PRI_AOC_RATE_TYPE_FLAT;</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;         aoc_s.item[idx].rate.flat.amount.cost = entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#a0e300d9871c2a507068dda6d12617d30">flat</a>.<a class="code" href="../../d9/d7a/structast__aoc__flat__rate.html#a070da2496793ccf8efc39f311bcda914">amount</a>;</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;         aoc_s.item[idx].rate.flat.amount.multiplier =</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;            sig_pri_aoc_multiplier_from_ast(entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#a0e300d9871c2a507068dda6d12617d30">flat</a>.<a class="code" href="../../d9/d7a/structast__aoc__flat__rate.html#a2c5b15b6851f558acabe1294d0e84e1c">multiplier</a>);</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#a0e300d9871c2a507068dda6d12617d30">flat</a>.<a class="code" href="../../d9/d7a/structast__aoc__flat__rate.html#a2854e091b0a0f6c8da639ced777fe99d">currency_name</a>)) {</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(aoc_s.item[idx].rate.flat.currency,</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;               entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#a0e300d9871c2a507068dda6d12617d30">flat</a>.<a class="code" href="../../d9/d7a/structast__aoc__flat__rate.html#a2854e091b0a0f6c8da639ced777fe99d">currency_name</a>,</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;               <span class="keyword">sizeof</span>(aoc_s.item[idx].rate.flat.currency));</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;         }</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136a2c59202ac651d099a355efdb2acf0ebf">AST_AOC_RATE_TYPE_VOLUME</a>:</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;         aoc_s.item[idx].rate_type = PRI_AOC_RATE_TYPE_VOLUME;</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;         aoc_s.item[idx].rate.volume.unit = entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ab73a64cdd300bc2552cf255386845b52">volume</a>.<a class="code" href="../../db/d83/structast__aoc__volume__rate.html#a8e9f2604f702639994f22f5f3911b86b">volume_unit</a>;</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;         aoc_s.item[idx].rate.volume.amount.cost = entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ab73a64cdd300bc2552cf255386845b52">volume</a>.<a class="code" href="../../db/d83/structast__aoc__volume__rate.html#a070da2496793ccf8efc39f311bcda914">amount</a>;</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;         aoc_s.item[idx].rate.volume.amount.multiplier =</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;            sig_pri_aoc_multiplier_from_ast(entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ab73a64cdd300bc2552cf255386845b52">volume</a>.<a class="code" href="../../db/d83/structast__aoc__volume__rate.html#a2c5b15b6851f558acabe1294d0e84e1c">multiplier</a>);</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ab73a64cdd300bc2552cf255386845b52">volume</a>.<a class="code" href="../../db/d83/structast__aoc__volume__rate.html#a2854e091b0a0f6c8da639ced777fe99d">currency_name</a>)) {</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(aoc_s.item[idx].rate.volume.currency,</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;               entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ab73a64cdd300bc2552cf255386845b52">volume</a>.<a class="code" href="../../db/d83/structast__aoc__volume__rate.html#a2854e091b0a0f6c8da639ced777fe99d">currency_name</a>,</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;               <span class="keyword">sizeof</span>(aoc_s.item[idx].rate.volume.currency));</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;         }</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136a4bd081a66f6065f4963840d4a1a02870">AST_AOC_RATE_TYPE_SPECIAL_CODE</a>:</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;         aoc_s.item[idx].rate_type = PRI_AOC_RATE_TYPE_SPECIAL_CODE;</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;         aoc_s.item[idx].rate.special = entry-&gt;<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">rate</a>.<a class="code" href="../../d4/de4/structast__aoc__s__entry.html#a3864d3b889994b88c025a7819c5e0749">special_code</a>;</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136afcc954c074314092fc28fa66cf158f48">AST_AOC_RATE_TYPE_FREE</a>:</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;         aoc_s.item[idx].rate_type = PRI_AOC_RATE_TYPE_FREE;</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136a40a01cc0779b0eb6eaada7827a0c8c86">AST_AOC_RATE_TYPE_FREE_FROM_BEGINNING</a>:</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;         aoc_s.item[idx].rate_type = PRI_AOC_RATE_TYPE_FREE_FROM_BEGINNING;</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136a53c594c3f49d098ffcccb94a919ada67">AST_AOC_RATE_TYPE_NA</a>:</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;         aoc_s.item[idx].rate_type = PRI_AOC_RATE_TYPE_NOT_AVAILABLE;</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;      }</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;   }</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;   aoc_s.num_items = idx;</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;   <span class="comment">/* if this rate should be sent as a response to an AOC-S request we will</span></div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;<span class="comment">    * have an aoc_s_request_invoke_id associated with this pvt */</span></div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;   <span class="keywordflow">if</span> (pvt-&gt;aoc_s_request_invoke_id_valid) {</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;      pri_aoc_s_request_response_send(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, pvt-&gt;aoc_s_request_invoke_id, &amp;aoc_s);</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;      pvt-&gt;aoc_s_request_invoke_id_valid = 0;</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;      pri_aoc_s_send(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, &amp;aoc_s);</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;   }</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;}</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;<span class="comment"> * \brief send an AOC-D message on the current call</span></div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;<span class="comment"> * \param pvt sig_pri private channel structure.</span></div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;<span class="comment"> * \param generic decoded ast AOC message</span></div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;<span class="comment"> * \note Assumes that the PRI lock is already obtained.</span></div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_aoc_d_from_ast(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">struct</span> <a class="code" href="../../d9/dca/structast__aoc__decoded.html">ast_aoc_decoded</a> *decoded)</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;{</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;   <span class="keyword">struct </span>pri_subcmd_aoc_d aoc_d = { 0, };</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;   aoc_d.billing_accumulation = (<a class="code" href="../../d6/db3/aoc_8h.html#a232365978b35ceaeb76bd634a601aa80">ast_aoc_get_total_type</a>(decoded) == <a class="code" href="../../d6/db3/aoc_8h.html#aed3fe8e8d708e8aff42a2ad205813cb7a437decc9f64054294b48742e48089619">AST_AOC_TOTAL</a>) ? 1 : 0;</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;   <span class="keywordflow">switch</span> (<a class="code" href="../../d6/db3/aoc_8h.html#ab7eb4ba93a3c67ac3747f5731db62813">ast_aoc_get_billing_id</a>(decoded)) {</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da83b02bda7920334b1d7cb85c53be1d50">AST_AOC_BILLING_NORMAL</a>:</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;      aoc_d.billing_id = PRI_AOC_D_BILLING_ID_NORMAL;</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1dad1092f5f7da0428ebd4c6ec4ed78d751">AST_AOC_BILLING_REVERSE_CHARGE</a>:</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;      aoc_d.billing_id = PRI_AOC_D_BILLING_ID_REVERSE;</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da91a7d97d8c344b40e9aaadc39c4d9269">AST_AOC_BILLING_CREDIT_CARD</a>:</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;      aoc_d.billing_id = PRI_AOC_D_BILLING_ID_CREDIT_CARD;</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1daf2aa1a3d8a87f17ac604cead1964f52f">AST_AOC_BILLING_NA</a>:</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;      aoc_d.billing_id = PRI_AOC_D_BILLING_ID_NOT_AVAILABLE;</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;   }</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;   <span class="keywordflow">switch</span> (<a class="code" href="../../d6/db3/aoc_8h.html#ae91f3998077136a2d44cc4307c7523be">ast_aoc_get_charge_type</a>(decoded)) {</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a44da551e5cfa1d51b072685591df0800">AST_AOC_CHARGE_FREE</a>:</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;      aoc_d.charge = PRI_AOC_DE_CHARGE_FREE;</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a38cfbbe1a40256021b03e1599b1a23ed">AST_AOC_CHARGE_CURRENCY</a>:</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;      {</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *currency_name = <a class="code" href="../../d6/db3/aoc_8h.html#a43274565efa1c1e0235c1568ab0593bd">ast_aoc_get_currency_name</a>(decoded);</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;         aoc_d.charge = PRI_AOC_DE_CHARGE_CURRENCY;</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;         aoc_d.recorded.money.amount.cost = <a class="code" href="../../d6/db3/aoc_8h.html#aea6890fe5889849199eeedd18a9367e7">ast_aoc_get_currency_amount</a>(decoded);</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;         aoc_d.recorded.money.amount.multiplier = sig_pri_aoc_multiplier_from_ast(<a class="code" href="../../d6/db3/aoc_8h.html#ac7f88b403a23432d67246765a900abd3">ast_aoc_get_currency_multiplier</a>(decoded));</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(currency_name)) {</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(aoc_d.recorded.money.currency, currency_name, <span class="keyword">sizeof</span>(aoc_d.recorded.money.currency));</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;         }</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;      }</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a5816131a38e568febf50d316c850c44b">AST_AOC_CHARGE_UNIT</a>:</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;      {</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../df/d18/structast__aoc__unit__entry.html">ast_aoc_unit_entry</a> *entry;</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;         <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;         aoc_d.charge = PRI_AOC_DE_CHARGE_UNITS;</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/db3/aoc_8h.html#a1dab5872fd399614765583200752fce8">ast_aoc_get_unit_count</a>(decoded); i++) {</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;            <span class="keywordflow">if</span> ((entry = <a class="code" href="../../d6/db3/aoc_8h.html#a9d8bce208856acd7aa722ad0f7f280bc">ast_aoc_get_unit_info</a>(decoded, i)) &amp;&amp; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(aoc_d.recorded.unit.item)) {</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;               <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../df/d18/structast__aoc__unit__entry.html#a7dd39f0ed064eccd86e7b98ee0834b67">valid_amount</a>) {</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;                  aoc_d.recorded.unit.item[i].number = entry-&gt;<a class="code" href="../../df/d18/structast__aoc__unit__entry.html#a3aaa7811b1b3c09c7945b9e090220ea1">amount</a>;</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;                  aoc_d.recorded.unit.item[i].number = -1;</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;               }</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;               <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../df/d18/structast__aoc__unit__entry.html#a7a39ee49c9364cb0e662f7637a323830">valid_type</a>) {</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;                  aoc_d.recorded.unit.item[i].type = entry-&gt;<a class="code" href="../../df/d18/structast__aoc__unit__entry.html#a4bfea42429249a1f65204f0c0f34704a">type</a>;</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;                  aoc_d.recorded.unit.item[i].type = -1;</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;               }</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;               aoc_d.recorded.unit.num_items++;</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;            }</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;         }</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;      }</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9ad60d324867080b1a1ca3b13db29b27c2">AST_AOC_CHARGE_NA</a>:</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;      aoc_d.charge = PRI_AOC_DE_CHARGE_NOT_AVAILABLE;</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;   }</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;   pri_aoc_d_send(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, &amp;aoc_d);</div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;}</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;<span class="comment"> * \brief send an AOC-E message on the current call</span></div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;<span class="comment"> * \param pvt sig_pri private channel structure.</span></div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;<span class="comment"> * \param generic decoded ast AOC message</span></div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;<span class="comment"> * \note Assumes that the PRI lock is already obtained.</span></div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_aoc_e_from_ast(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">struct</span> <a class="code" href="../../d9/dca/structast__aoc__decoded.html">ast_aoc_decoded</a> *decoded)</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;{</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;   <span class="keyword">struct </span>pri_subcmd_aoc_e *aoc_e = &amp;pvt-&gt;aoc_e;</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d0/dad/structast__aoc__charging__association.html">ast_aoc_charging_association</a> *ca = <a class="code" href="../../d6/db3/aoc_8h.html#a28da5b6a0c5bfb9caec2c753c3225f9b">ast_aoc_get_association_info</a>(decoded);</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;   memset(aoc_e, 0, <span class="keyword">sizeof</span>(*aoc_e));</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;   pvt-&gt;holding_aoce = 1;</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;   <span class="keywordflow">switch</span> (ca-&gt;<a class="code" href="../../d0/dad/structast__aoc__charging__association.html#a4f6be1c174ff49ae4c0c696e75cccfcf">charging_type</a>) {</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a64a0b1ab9b0b18a58861ef59bb5ea8a7a68edc99ae56d99d05a257c37fe4dc0d9">AST_AOC_CHARGING_ASSOCIATION_NUMBER</a>:</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;      aoc_e-&gt;associated.charge.number.valid = 1;</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(aoc_e-&gt;associated.charge.number.str,</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;         ca-&gt;<a class="code" href="../../d0/dad/structast__aoc__charging__association.html#ac7dfe3b37208afd58d8c6bbaa7c97ffb">charge</a>.<a class="code" href="../../d0/dad/structast__aoc__charging__association.html#af21aeb9c83a66eea1b467b61bdb730f9">number</a>.<a class="code" href="../../d9/d54/structast__aoc__charging__association__number.html#a424ebc3ada265291282b9136b7c56555">number</a>,</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;         <span class="keyword">sizeof</span>(aoc_e-&gt;associated.charge.number.str));</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;      aoc_e-&gt;associated.charge.number.plan = ca-&gt;<a class="code" href="../../d0/dad/structast__aoc__charging__association.html#ac7dfe3b37208afd58d8c6bbaa7c97ffb">charge</a>.<a class="code" href="../../d0/dad/structast__aoc__charging__association.html#af21aeb9c83a66eea1b467b61bdb730f9">number</a>.<a class="code" href="../../d9/d54/structast__aoc__charging__association__number.html#a4c36514e1f80f8b79273614b4029d173">plan</a>;</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;      aoc_e-&gt;associated.charging_type = PRI_AOC_E_CHARGING_ASSOCIATION_NUMBER;</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a64a0b1ab9b0b18a58861ef59bb5ea8a7a5aaaededce99757a5c1aaf025f4c7e6d">AST_AOC_CHARGING_ASSOCIATION_ID</a>:</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;      aoc_e-&gt;associated.charge.id = ca-&gt;<a class="code" href="../../d0/dad/structast__aoc__charging__association.html#ac7dfe3b37208afd58d8c6bbaa7c97ffb">charge</a>.<a class="code" href="../../d0/dad/structast__aoc__charging__association.html#a2708c0bbb6f926149707c2c61fe43c3e">id</a>;</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;      aoc_e-&gt;associated.charging_type = PRI_AOC_E_CHARGING_ASSOCIATION_ID;</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a64a0b1ab9b0b18a58861ef59bb5ea8a7a0a50acf15993012768155fb7263c4dc2">AST_AOC_CHARGING_ASSOCIATION_NA</a>:</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;   }</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;   <span class="keywordflow">switch</span> (<a class="code" href="../../d6/db3/aoc_8h.html#ab7eb4ba93a3c67ac3747f5731db62813">ast_aoc_get_billing_id</a>(decoded)) {</div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da83b02bda7920334b1d7cb85c53be1d50">AST_AOC_BILLING_NORMAL</a>:</div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;      aoc_e-&gt;billing_id = PRI_AOC_E_BILLING_ID_NORMAL;</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1dad1092f5f7da0428ebd4c6ec4ed78d751">AST_AOC_BILLING_REVERSE_CHARGE</a>:</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;      aoc_e-&gt;billing_id = PRI_AOC_E_BILLING_ID_REVERSE;</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da91a7d97d8c344b40e9aaadc39c4d9269">AST_AOC_BILLING_CREDIT_CARD</a>:</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;      aoc_e-&gt;billing_id = PRI_AOC_E_BILLING_ID_CREDIT_CARD;</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1daceee6b8982426596fe14c3948aa29987">AST_AOC_BILLING_CALL_FWD_UNCONDITIONAL</a>:</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;      aoc_e-&gt;billing_id = PRI_AOC_E_BILLING_ID_CALL_FORWARDING_UNCONDITIONAL;</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da204aa062b4281ee428f0709259f73116">AST_AOC_BILLING_CALL_FWD_BUSY</a>:</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;      aoc_e-&gt;billing_id = PRI_AOC_E_BILLING_ID_CALL_FORWARDING_BUSY;</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da5c049c80395b1353839451a4f6d790e3">AST_AOC_BILLING_CALL_FWD_NO_REPLY</a>:</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;      aoc_e-&gt;billing_id = PRI_AOC_E_BILLING_ID_CALL_FORWARDING_NO_REPLY;</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da848e7e562e4048e4b0ea85d176afa76c">AST_AOC_BILLING_CALL_DEFLECTION</a>:</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;      aoc_e-&gt;billing_id = PRI_AOC_E_BILLING_ID_CALL_DEFLECTION;</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da9f62d8ce9119202ffb00eb74d5db7412">AST_AOC_BILLING_CALL_TRANSFER</a>:</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;      aoc_e-&gt;billing_id = PRI_AOC_E_BILLING_ID_CALL_TRANSFER;</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1daf2aa1a3d8a87f17ac604cead1964f52f">AST_AOC_BILLING_NA</a>:</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;      aoc_e-&gt;billing_id = PRI_AOC_E_BILLING_ID_NOT_AVAILABLE;</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;   }</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;   <span class="keywordflow">switch</span> (<a class="code" href="../../d6/db3/aoc_8h.html#ae91f3998077136a2d44cc4307c7523be">ast_aoc_get_charge_type</a>(decoded)) {</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a44da551e5cfa1d51b072685591df0800">AST_AOC_CHARGE_FREE</a>:</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;      aoc_e-&gt;charge = PRI_AOC_DE_CHARGE_FREE;</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a38cfbbe1a40256021b03e1599b1a23ed">AST_AOC_CHARGE_CURRENCY</a>:</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;      {</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *currency_name = <a class="code" href="../../d6/db3/aoc_8h.html#a43274565efa1c1e0235c1568ab0593bd">ast_aoc_get_currency_name</a>(decoded);</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;         aoc_e-&gt;charge = PRI_AOC_DE_CHARGE_CURRENCY;</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;         aoc_e-&gt;recorded.money.amount.cost = <a class="code" href="../../d6/db3/aoc_8h.html#aea6890fe5889849199eeedd18a9367e7">ast_aoc_get_currency_amount</a>(decoded);</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;         aoc_e-&gt;recorded.money.amount.multiplier = sig_pri_aoc_multiplier_from_ast(<a class="code" href="../../d6/db3/aoc_8h.html#ac7f88b403a23432d67246765a900abd3">ast_aoc_get_currency_multiplier</a>(decoded));</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(currency_name)) {</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(aoc_e-&gt;recorded.money.currency, currency_name, <span class="keyword">sizeof</span>(aoc_e-&gt;recorded.money.currency));</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;         }</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;      }</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a5816131a38e568febf50d316c850c44b">AST_AOC_CHARGE_UNIT</a>:</div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;      {</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../df/d18/structast__aoc__unit__entry.html">ast_aoc_unit_entry</a> *entry;</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;         <span class="keywordtype">int</span> i;</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;         aoc_e-&gt;charge = PRI_AOC_DE_CHARGE_UNITS;</div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/db3/aoc_8h.html#a1dab5872fd399614765583200752fce8">ast_aoc_get_unit_count</a>(decoded); i++) {</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;            <span class="keywordflow">if</span> ((entry = <a class="code" href="../../d6/db3/aoc_8h.html#a9d8bce208856acd7aa722ad0f7f280bc">ast_aoc_get_unit_info</a>(decoded, i)) &amp;&amp; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(aoc_e-&gt;recorded.unit.item)) {</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;               <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../df/d18/structast__aoc__unit__entry.html#a7dd39f0ed064eccd86e7b98ee0834b67">valid_amount</a>) {</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;                  aoc_e-&gt;recorded.unit.item[i].number = entry-&gt;<a class="code" href="../../df/d18/structast__aoc__unit__entry.html#a3aaa7811b1b3c09c7945b9e090220ea1">amount</a>;</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;                  aoc_e-&gt;recorded.unit.item[i].number = -1;</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;               }</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;               <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../df/d18/structast__aoc__unit__entry.html#a7a39ee49c9364cb0e662f7637a323830">valid_type</a>) {</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;                  aoc_e-&gt;recorded.unit.item[i].type = entry-&gt;<a class="code" href="../../df/d18/structast__aoc__unit__entry.html#a4bfea42429249a1f65204f0c0f34704a">type</a>;</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;                  aoc_e-&gt;recorded.unit.item[i].type = -1;</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;               }</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;               aoc_e-&gt;recorded.unit.num_items++;</div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;            }</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;         }</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;      }</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9ad60d324867080b1a1ca3b13db29b27c2">AST_AOC_CHARGE_NA</a>:</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;      aoc_e-&gt;charge = PRI_AOC_DE_CHARGE_NOT_AVAILABLE;</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;   }</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;}</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;<span class="comment"> * \brief send an AOC-E termination request on ast_channel and set</span></div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;<span class="comment"> * hangup delay.</span></div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;<span class="comment"> * \param ms to delay hangup</span></div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_send_aoce_termination_request(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ms)</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;{</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt;</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dca/structast__aoc__decoded.html">ast_aoc_decoded</a> *decoded = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d72/structast__aoc__encoded.html">ast_aoc_encoded</a> *encoded = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;   <span class="keywordtype">size_t</span> encoded_size;</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;   <span class="keyword">struct </span>timeval whentohangup = { 0, };</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;   sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;   pvt = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos];</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;   <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;   }</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;   <span class="keywordflow">if</span> (!(decoded = <a class="code" href="../../d6/db3/aoc_8h.html#ada9b84ac8130231cee87ba4d33a5dda0">ast_aoc_create</a>(<a class="code" href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548abe386d5c13914197811b47e6d3fcdfc9">AST_AOC_REQUEST</a>, 0, <a class="code" href="../../d6/db3/aoc_8h.html#adfa4093a881618aef565ef412962cccca8a14ac00143374e3e9495680cae78ec0">AST_AOC_REQUEST_E</a>))) {</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a30bcf0418189567bc84ff32034f79f28">ast_queue_hangup</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;      <span class="keywordflow">goto</span> cleanup_termination_request;</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;   }</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#ae89259b25941770bf1e0eaa1fe1e051c">ast_aoc_set_termination_request</a>(decoded);</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;   <span class="keywordflow">if</span> (!(encoded = <a class="code" href="../../d6/db3/aoc_8h.html#abbf1344a7eae88ea2cef85c1b0b6c24d">ast_aoc_encode</a>(decoded, &amp;encoded_size, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))) {</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a30bcf0418189567bc84ff32034f79f28">ast_queue_hangup</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;      <span class="keywordflow">goto</span> cleanup_termination_request;</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;   }</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;   <span class="comment">/* convert ms to timeval */</span></div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;   whentohangup.tv_usec = (ms % 1000) * 1000;</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;   whentohangup.tv_sec = ms / 1000;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a7e5e15c22564fd66351d332ad10658b5">ast_queue_control_data</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390af10845d12981bce4e141a5b0ed431494">AST_CONTROL_AOC</a>, encoded, encoded_size)) {</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a30bcf0418189567bc84ff32034f79f28">ast_queue_hangup</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;      <span class="keywordflow">goto</span> cleanup_termination_request;</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;   }</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;   pvt-&gt;waiting_for_aoce = 1;</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ac03c2ec5ac8e7a6ef9c5d92f91880927">ast_channel_setwhentohangup_tv</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, whentohangup);</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Delaying hangup on %s for aoc-e msg\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>));</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;cleanup_termination_request:</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#a33b761090d3debbfd4cdb0c800a13bb2">ast_aoc_destroy_decoded</a>(decoded);</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;   <a class="code" href="../../d6/db3/aoc_8h.html#a8f66f98f015246c294b10dc2c9350612">ast_aoc_destroy_encoded</a>(encoded);</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;}</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;<span class="comment"> * \brief TRUE if PRI event came in on a CIS call.</span></div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;<span class="comment"> * \param channel PRI encoded span/channel</span></div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;<span class="comment"> * \retval non-zero if CIS call.</span></div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_is_cis_call(<span class="keywordtype">int</span> channel)</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;{</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;   <span class="keywordflow">return</span> channel != -1 &amp;&amp; (channel &amp; PRI_CIS_CALL);</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;}</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;<span class="comment"> * \brief Handle the CIS associated PRI subcommand events.</span></div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;<span class="comment"> * \param event_id PRI event id</span></div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;<span class="comment"> * \param subcmds Subcommands to process if any. (Could be NULL).</span></div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;<span class="comment"> * \param call_rsp libpri opaque call structure to send any responses toward.</span></div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;<span class="comment"> * Could be NULL either because it is not available or the call is for the</span></div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;<span class="comment"> * dummy call reference.  However, this should not be NULL in the cases that</span></div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;<span class="comment"> * need to use the pointer to send a response message back.</span></div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_handle_cis_subcmds(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> event_id,</div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> pri_subcommands *subcmds, q931_call *call_rsp)</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;{</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;   <span class="keywordtype">int</span> index;</div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent;</div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_agent_prv *agent_prv;</div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *<a class="code" href="../../da/dde/chan__phone_8c.html#a4e40373706bcf5cdb9409dac3166d280">monitor</a>;</div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;   <span class="keywordflow">if</span> (!subcmds) {</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;   }</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;   <span class="keywordflow">for</span> (index = 0; index &lt; subcmds-&gt;counter_subcmd; ++index) {</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span>pri_subcommand *subcmd = &amp;subcmds-&gt;subcmd[index];</div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;      <span class="keywordflow">switch</span> (subcmd-&gt;cmd) {</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;<span class="preprocessor">#if defined(STATUS_REQUEST_PLACE_HOLDER)</span></div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_STATUS_REQ:</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_STATUS_REQ_RSP:</div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;         <span class="comment">/* Ignore for now. */</span></div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(STATUS_REQUEST_PLACE_HOLDER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_REQ:</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;         agent = sig_pri_find_cc_agent_by_cc_id(pri, subcmd-&gt;u.cc_request.cc_id);</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;         <span class="keywordflow">if</span> (!agent) {</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;            pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_request.cc_id);</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;         }</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../de/dc8/ccss_8h.html#ae1570706dee0c4c88406d96f47f166d3">ast_cc_request_is_within_limits</a>()) {</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;            <span class="keywordflow">if</span> (pri_cc_req_rsp(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_request.cc_id,</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;               5<span class="comment">/* queue_full */</span>)) {</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;               pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_request.cc_id);</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;            }</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;            <a class="code" href="../../de/dc8/ccss_8h.html#ad25ea527a36ed77fcba9eb1eba0b4186">ast_cc_failed</a>(agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#a48e5b8fb1ab4916549247ea116b8f5b9">core_id</a>, <span class="stringliteral">&quot;%s agent system CC queue full&quot;</span>,</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;               sig_pri_cc_type_name);</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(agent, -1);</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;         }</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;         agent_prv = agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;         agent_prv-&gt;cc_request_response_pending = 1;</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../de/dc8/ccss_8h.html#a037cc988c277a5a296ad1af1fb05f5a4">ast_cc_agent_accept_request</a>(agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#a48e5b8fb1ab4916549247ea116b8f5b9">core_id</a>,</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;            <span class="stringliteral">&quot;%s caller accepted CC offer.&quot;</span>, sig_pri_cc_type_name)) {</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;            agent_prv-&gt;cc_request_response_pending = 0;</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;            <span class="keywordflow">if</span> (pri_cc_req_rsp(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_request.cc_id,</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;               2<span class="comment">/* short_term_denial */</span>)) {</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;               pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_request.cc_id);</div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;            }</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;            <a class="code" href="../../de/dc8/ccss_8h.html#ad25ea527a36ed77fcba9eb1eba0b4186">ast_cc_failed</a>(agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#a48e5b8fb1ab4916549247ea116b8f5b9">core_id</a>, <span class="stringliteral">&quot;%s agent CC core request accept failed&quot;</span>,</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;               sig_pri_cc_type_name);</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;         }</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(agent, -1);</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_REQ_RSP:</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;         monitor = sig_pri_find_cc_monitor_by_cc_id(pri,</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;            subcmd-&gt;u.cc_request_rsp.cc_id);</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;         <span class="keywordflow">if</span> (!monitor) {</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;            pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_request_rsp.cc_id);</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;         }</div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;         <span class="keywordflow">switch</span> (subcmd-&gt;u.cc_request_rsp.status) {</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;         <span class="keywordflow">case</span> 0:<span class="comment">/* success */</span></div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;            <a class="code" href="../../de/dc8/ccss_8h.html#a64d38b6c2631ece08ca6f32620e02635">ast_cc_monitor_request_acked</a>(monitor-&gt;core_id,</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;               <span class="stringliteral">&quot;%s far end accepted CC request&quot;</span>, sig_pri_cc_type_name);</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;         <span class="keywordflow">case</span> 1:<span class="comment">/* timeout */</span></div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;core_id:%d %s CC request timeout\n&quot;</span>, monitor-&gt;core_id,</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;               sig_pri_cc_type_name);</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;            <a class="code" href="../../de/dc8/ccss_8h.html#ad179ffd63f6ff74454f58c58d7248368">ast_cc_monitor_failed</a>(monitor-&gt;core_id, monitor-&gt;name,</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;               <span class="stringliteral">&quot;%s CC request timeout&quot;</span>, sig_pri_cc_type_name);</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;         <span class="keywordflow">case</span> 2:<span class="comment">/* error */</span></div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;core_id:%d %s CC request error: %s\n&quot;</span>, monitor-&gt;core_id,</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;               sig_pri_cc_type_name,</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;               pri_facility_error2str(subcmd-&gt;u.cc_request_rsp.fail_code));</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;            <a class="code" href="../../de/dc8/ccss_8h.html#ad179ffd63f6ff74454f58c58d7248368">ast_cc_monitor_failed</a>(monitor-&gt;core_id, monitor-&gt;name,</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;               <span class="stringliteral">&quot;%s CC request error&quot;</span>, sig_pri_cc_type_name);</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;         <span class="keywordflow">case</span> 3:<span class="comment">/* reject */</span></div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;core_id:%d %s CC request reject: %s\n&quot;</span>, monitor-&gt;core_id,</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;               sig_pri_cc_type_name,</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;               pri_facility_reject2str(subcmd-&gt;u.cc_request_rsp.fail_code));</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;            <a class="code" href="../../de/dc8/ccss_8h.html#ad179ffd63f6ff74454f58c58d7248368">ast_cc_monitor_failed</a>(monitor-&gt;core_id, monitor-&gt;name,</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;               <span class="stringliteral">&quot;%s CC request reject&quot;</span>, sig_pri_cc_type_name);</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;         <span class="keywordflow">default</span>:</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;core_id:%d %s CC request unknown status %d\n&quot;</span>,</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;               monitor-&gt;core_id, sig_pri_cc_type_name,</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;               subcmd-&gt;u.cc_request_rsp.status);</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;            <a class="code" href="../../de/dc8/ccss_8h.html#ad179ffd63f6ff74454f58c58d7248368">ast_cc_monitor_failed</a>(monitor-&gt;core_id, monitor-&gt;name,</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;               <span class="stringliteral">&quot;%s CC request unknown status&quot;</span>, sig_pri_cc_type_name);</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;         }</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_REMOTE_USER_FREE:</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;         monitor = sig_pri_find_cc_monitor_by_cc_id(pri,</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;            subcmd-&gt;u.cc_remote_user_free.cc_id);</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;         <span class="keywordflow">if</span> (!monitor) {</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;            pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_remote_user_free.cc_id);</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;         }</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;         <a class="code" href="../../de/dc8/ccss_8h.html#a8f831cfaba759c6073f1940c9b81e2a9">ast_cc_monitor_callee_available</a>(monitor-&gt;core_id,</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;            <span class="stringliteral">&quot;%s callee has become available&quot;</span>, sig_pri_cc_type_name);</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_B_FREE:</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;         monitor = sig_pri_find_cc_monitor_by_cc_id(pri,</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;            subcmd-&gt;u.cc_b_free.cc_id);</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;         <span class="keywordflow">if</span> (!monitor) {</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;            pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_b_free.cc_id);</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;         }</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;         <a class="code" href="../../de/dc8/ccss_8h.html#a1400673f64bff290fb66d7c2bd8b7830">ast_cc_monitor_party_b_free</a>(monitor-&gt;core_id);</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_STATUS_REQ:</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;         monitor = sig_pri_find_cc_monitor_by_cc_id(pri,</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;            subcmd-&gt;u.cc_status_req.cc_id);</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;         <span class="keywordflow">if</span> (!monitor) {</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;            pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_status_req.cc_id);</div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;         }</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;         <a class="code" href="../../de/dc8/ccss_8h.html#a98e261f13321084b4ed0c1bd0d4ec70e">ast_cc_monitor_status_request</a>(monitor-&gt;core_id);</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_STATUS_REQ_RSP:</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;         agent = sig_pri_find_cc_agent_by_cc_id(pri, subcmd-&gt;u.cc_status_req_rsp.cc_id);</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;         <span class="keywordflow">if</span> (!agent) {</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;            pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_status_req_rsp.cc_id);</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;         }</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;         <a class="code" href="../../de/dc8/ccss_8h.html#acdc7eb3bf93834fe45f72829ff9abe16">ast_cc_agent_status_response</a>(agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#a48e5b8fb1ab4916549247ea116b8f5b9">core_id</a>,</div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;            subcmd-&gt;u.cc_status_req_rsp.status ? <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a></div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;            : <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>);</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(agent, -1);</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_STATUS:</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;         agent = sig_pri_find_cc_agent_by_cc_id(pri, subcmd-&gt;u.cc_status.cc_id);</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;         <span class="keywordflow">if</span> (!agent) {</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;            pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_status.cc_id);</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;         }</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;         <span class="keywordflow">if</span> (subcmd-&gt;u.cc_status.status) {</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;            <a class="code" href="../../de/dc8/ccss_8h.html#a0a815b8982e8b9183a38a2e2c785d155">ast_cc_agent_caller_busy</a>(agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#a48e5b8fb1ab4916549247ea116b8f5b9">core_id</a>, <span class="stringliteral">&quot;%s agent caller is busy&quot;</span>,</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;               sig_pri_cc_type_name);</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;            <a class="code" href="../../de/dc8/ccss_8h.html#ac2a5064d0e089814ba93dc2aefacdd09">ast_cc_agent_caller_available</a>(agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#a48e5b8fb1ab4916549247ea116b8f5b9">core_id</a>,</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;               <span class="stringliteral">&quot;%s agent caller is available&quot;</span>, sig_pri_cc_type_name);</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;         }</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(agent, -1);</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_CANCEL:</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;         sig_pri_cc_link_canceled(pri, subcmd-&gt;u.cc_cancel.cc_id,</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;            subcmd-&gt;u.cc_cancel.is_agent);</div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_STOP_ALERTING:</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;         monitor = sig_pri_find_cc_monitor_by_cc_id(pri,</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;            subcmd-&gt;u.cc_stop_alerting.cc_id);</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;         <span class="keywordflow">if</span> (!monitor) {</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;            pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_stop_alerting.cc_id);</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;         }</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;         <a class="code" href="../../de/dc8/ccss_8h.html#a3ccff7da399d534b7ac4eee20fb25ae7">ast_cc_monitor_stop_ringing</a>(monitor-&gt;core_id);</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_AOC_E:</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;         <span class="comment">/* Queue AST_CONTROL_AOC frame */</span></div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;         sig_pri_aoc_e_from_pri(&amp;subcmd-&gt;u.aoc_e, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Span %d: Unknown CIS subcommand(%d) in %s event.\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>,</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;            subcmd-&gt;cmd, pri_event2str(event_id));</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;      }</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;   }</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;}</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;<span class="comment"> * \brief Handle the call associated PRI subcommand events.</span></div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;<span class="comment"> * \param event_id PRI event id</span></div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;<span class="comment"> * \param subcmds Subcommands to process if any. (Could be NULL).</span></div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;<span class="comment"> * \param call_rsp libpri opaque call structure to send any responses toward.</span></div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;<span class="comment"> * Could be NULL either because it is not available or the call is for the</span></div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;<span class="comment"> * dummy call reference.  However, this should not be NULL in the cases that</span></div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;<span class="comment"> * need to use the pointer to send a response message back.</span></div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_handle_subcmds(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos, <span class="keywordtype">int</span> event_id,</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> pri_subcommands *subcmds, q931_call *call_rsp)</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;{</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;   <span class="keywordtype">int</span> index;</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner;</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d44/structast__party__redirecting.html">ast_party_redirecting</a> ast_redirecting;</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;   <span class="keyword">struct </span>xfer_rsp_data xfer_rsp;</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;   <span class="keywordflow">if</span> (!subcmds) {</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;   }</div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;   <span class="keywordflow">for</span> (index = 0; index &lt; subcmds-&gt;counter_subcmd; ++index) {</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span>pri_subcommand *subcmd = &amp;subcmds-&gt;subcmd[index];</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;</div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;      <span class="keywordflow">switch</span> (subcmd-&gt;cmd) {</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CONNECTED_LINE:</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;         sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;         owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;         <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../dc/d9e/structast__party__connected__line.html">ast_party_connected_line</a> ast_connected;</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;            <span class="keywordtype">int</span> caller_id_update;</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;</div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;            <span class="comment">/* Extract the connected line information */</span></div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#abf514b9d96a1821a33fec8c64ee4e26f">ast_party_connected_line_init</a>(&amp;ast_connected);</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;            sig_pri_party_id_convert(&amp;ast_connected.id, &amp;subcmd-&gt;u.connected_line.id,</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;               pri);</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;            ast_connected.id.tag = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>);</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;</div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;            caller_id_update = 0;</div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;            <span class="keywordflow">if</span> (ast_connected.id.name.str) {</div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;               <span class="comment">/* Save name for Caller-ID update */</span></div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;               <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>,</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;                  ast_connected.id.name.str, <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>));</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;               caller_id_update = 1;</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;            }</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;            <span class="keywordflow">if</span> (ast_connected.id.number.str) {</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;               <span class="comment">/* Save number for Caller-ID update */</span></div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;               <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>,</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;                  ast_connected.id.number.str, <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>));</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aff456ca48d31a9813584e799064cf88e">cid_ton</a> = ast_connected.id.number.plan;</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;               caller_id_update = 1;</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;            }</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;            ast_connected.source = <a class="code" href="../../de/d47/callerid_8h.html#a5cdbc47cd18e7f41d450e9caea186b1bac0f31b03872d178b92b054fb07358495">AST_CONNECTED_LINE_UPDATE_SOURCE_ANSWER</a>;</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a16348e587eb42db97d2169c6c11ebe46">cid_subaddr</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SUBADDR)</span></div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;            <span class="keywordflow">if</span> (ast_connected.id.subaddress.str) {</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;               <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a16348e587eb42db97d2169c6c11ebe46">cid_subaddr</a>,</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;                  ast_connected.id.subaddress.str,</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;                  <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a16348e587eb42db97d2169c6c11ebe46">cid_subaddr</a>));</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;               caller_id_update = 1;</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;            }</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SUBADDR) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;            <span class="keywordflow">if</span> (caller_id_update) {</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;               <span class="keyword">struct </span><a class="code" href="../../d4/d77/structast__party__caller.html">ast_party_caller</a> ast_caller;</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#abd29b99884a9fc8a54fc021555190fb8">callingpres</a> =</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#a39aac47fef1240391fd97e055522fd83">ast_party_id_presentation</a>(&amp;ast_connected.id);</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;               sig_pri_set_caller_id(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a84a85d871e634a86b2421ac9354b50c6">ast_party_caller_set_init</a>(&amp;ast_caller, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(owner));</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;               ast_caller.id = ast_connected.id;</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;               ast_caller.ani = ast_connected.id;</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a46837c158733334d2bb155bbd827ddb8">ast_channel_set_caller_event</a>(owner, &amp;ast_caller, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;               <span class="comment">/* Update the connected line information on the other channel */</span></div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;               <span class="keywordflow">if</span> (event_id != PRI_EVENT_RING) {</div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;                  <span class="comment">/* This connected_line update was not from a SETUP message. */</span></div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#ade57349a78b2f32d3a7d1bc01fb3bf96">ast_channel_queue_connected_line_update</a>(owner, &amp;ast_connected,</div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;                     <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;               }</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;            }</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a40fc421536e02d30fecaa51a255b4144">ast_party_connected_line_free</a>(&amp;ast_connected);</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;         }</div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_REDIRECTING:</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;         sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;         owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;         <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;            sig_pri_redirecting_convert(&amp;ast_redirecting, &amp;subcmd-&gt;u.redirecting,</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#ad2334e69c466aec25ba3cbba53b7201b">ast_channel_redirecting</a>(owner), pri);</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;            ast_redirecting.<a class="code" href="../../df/d44/structast__party__redirecting.html#ad91368b8b243737d0a7fb6644f35809e">orig</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>);</div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;            ast_redirecting.<a class="code" href="../../df/d44/structast__party__redirecting.html#acf09e8312b8b4396ec42c5147cdf9b5b">from</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>);</div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;            ast_redirecting.<a class="code" href="../../df/d44/structast__party__redirecting.html#ad6644f992fc696511eebf8732e98e74a">to</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>);</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a1cb98e78f1231d96dad09ddaeaf0981d">ast_channel_set_redirecting</a>(owner, &amp;ast_redirecting, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;            <span class="keywordflow">if</span> (event_id != PRI_EVENT_RING) {</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;               <span class="comment">/* This redirection was not from a SETUP message. */</span></div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;               <span class="comment">/* Invalidate any earlier private redirecting id representations */</span></div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#ab1f348349b5df2d0b662fb9eed5afcce">ast_party_id_invalidate</a>(&amp;ast_redirecting.<a class="code" href="../../df/d44/structast__party__redirecting.html#adf35ee8c2640d03e5c0d311d3e76fd45">priv_orig</a>);</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#ab1f348349b5df2d0b662fb9eed5afcce">ast_party_id_invalidate</a>(&amp;ast_redirecting.<a class="code" href="../../df/d44/structast__party__redirecting.html#ac1e6e2d7f1a76e125a3c2361607afc18">priv_from</a>);</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#ab1f348349b5df2d0b662fb9eed5afcce">ast_party_id_invalidate</a>(&amp;ast_redirecting.<a class="code" href="../../df/d44/structast__party__redirecting.html#a99c02430b9b95b394cc2eb49ece959ad">priv_to</a>);</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a8195bba43b7c08b3063bd19b28291b55">ast_channel_queue_redirecting_update</a>(owner, &amp;ast_redirecting, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;            }</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ac8bce0bf79829c59a7671c4eff83a31f">ast_party_redirecting_free</a>(&amp;ast_redirecting);</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;</div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;         }</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_REROUTING)</span></div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_REROUTING:</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;         sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;         owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;         <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;            <span class="keyword">struct </span>pri_party_redirecting pri_deflection;</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;            <span class="keywordflow">if</span> (!call_rsp) {</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;                  <span class="stringliteral">&quot;Span %d: %s tried CallRerouting/CallDeflection to &#39;%s&#39; without call!\n&quot;</span>,</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(owner), subcmd-&gt;u.rerouting.deflection.to.number.str);</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;            }</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(subcmd-&gt;u.rerouting.deflection.to.number.str)) {</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;                  <span class="stringliteral">&quot;Span %d: %s tried CallRerouting/CallDeflection to empty number!\n&quot;</span>,</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(owner));</div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;               pri_rerouting_rsp(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, call_rsp, subcmd-&gt;u.rerouting.invoke_id,</div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;                  PRI_REROUTING_RSP_INVALID_NUMBER);</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;            }</div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;</div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Span %d: %s is CallRerouting/CallDeflection to &#39;%s&#39;.\n&quot;</span>,</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(owner), subcmd-&gt;u.rerouting.deflection.to.number.str);</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;</div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;<span class="comment">             * Send back positive ACK to CallRerouting/CallDeflection.</span></div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;<span class="comment">             *</span></div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;<span class="comment">             * Note:  This call will be hungup by the core when it processes</span></div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;<span class="comment">             * the call_forward string.</span></div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;            pri_rerouting_rsp(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, call_rsp, subcmd-&gt;u.rerouting.invoke_id,</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;               PRI_REROUTING_RSP_OK_CLEAR);</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;</div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;            pri_deflection = subcmd-&gt;u.rerouting.deflection;</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;            <span class="comment">/* Adjust the deflecting to number based upon the subscription option. */</span></div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;            <span class="keywordflow">switch</span> (subcmd-&gt;u.rerouting.subscription_option) {</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;            <span class="keywordflow">case</span> 0:  <span class="comment">/* noNotification */</span></div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;            <span class="keywordflow">case</span> 1:  <span class="comment">/* notificationWithoutDivertedToNr */</span></div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;               <span class="comment">/* Delete the number because the far end is not supposed to see it. */</span></div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;               pri_deflection.to.number.presentation =</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;                  PRI_PRES_RESTRICTED | PRI_PRES_USER_NUMBER_UNSCREENED;</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;               pri_deflection.to.number.plan =</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;                  (PRI_TON_UNKNOWN &lt;&lt; 4) | PRI_NPI_E163_E164;</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;               pri_deflection.to.number.str[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;            <span class="keywordflow">case</span> 2:  <span class="comment">/* notificationWithDivertedToNr */</span></div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;            <span class="keywordflow">case</span> 3:  <span class="comment">/* notApplicable */</span></div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;            }</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;            sig_pri_redirecting_convert(&amp;ast_redirecting, &amp;pri_deflection,</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#ad2334e69c466aec25ba3cbba53b7201b">ast_channel_redirecting</a>(owner), pri);</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;            ast_redirecting.<a class="code" href="../../df/d44/structast__party__redirecting.html#ad91368b8b243737d0a7fb6644f35809e">orig</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>);</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;            ast_redirecting.<a class="code" href="../../df/d44/structast__party__redirecting.html#acf09e8312b8b4396ec42c5147cdf9b5b">from</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>);</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;            ast_redirecting.<a class="code" href="../../df/d44/structast__party__redirecting.html#ad6644f992fc696511eebf8732e98e74a">to</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>);</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a1cb98e78f1231d96dad09ddaeaf0981d">ast_channel_set_redirecting</a>(owner, &amp;ast_redirecting, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ac8bce0bf79829c59a7671c4eff83a31f">ast_party_redirecting_free</a>(&amp;ast_redirecting);</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;            <span class="comment">/* Request the core to forward to the new number. */</span></div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;            ast_channel_call_forward_set(owner, subcmd-&gt;u.rerouting.deflection.to.number.str);</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;            <span class="comment">/* Wake up the channel. */</span></div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a6cbcba5661d55216968cde8fdf913c89">ast_queue_frame</a>(owner, &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>);</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;         }</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_REROUTING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_AVAILABLE:</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;         sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;         owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;         <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;            <span class="keyword">enum</span> <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530">ast_cc_service_type</a> <a class="code" href="../../d5/dfe/chan__sip_8c.html#a495cc24c1947d49a2b6de488a45c9d72">service</a>;</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;            <span class="keywordflow">switch</span> (event_id) {</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;            <span class="keywordflow">case</span> PRI_EVENT_RINGING:</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;               service = <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530aec12fa6bbd080be709806e28f8bade1e">AST_CC_CCNR</a>;</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;            <span class="keywordflow">case</span> PRI_EVENT_HANGUP_REQ:</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;               <span class="comment">/* We will assume that the cause was busy/congestion. */</span></div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;               service = <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530a64c2fae63ae9df0696a2092477c6fcb2">AST_CC_CCBS</a>;</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;               service = <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530aa9c4c6035dbb586ac72385084df5c16a">AST_CC_NONE</a>;</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;            }</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;            <span class="keywordflow">if</span> (service == <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530aa9c4c6035dbb586ac72385084df5c16a">AST_CC_NONE</a></div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;               || sig_pri_cc_available(pri, chanpos, subcmd-&gt;u.cc_available.cc_id,</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;               service)) {</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;               pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_available.cc_id);</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;            }</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;            <span class="comment">/* No asterisk channel. */</span></div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;            pri_cc_cancel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, subcmd-&gt;u.cc_available.cc_id);</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;         }</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_CALL:</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;         sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;         owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;         <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent;</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;            agent = sig_pri_find_cc_agent_by_cc_id(pri, subcmd-&gt;u.cc_call.cc_id);</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;            <span class="keywordflow">if</span> (agent) {</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;               <a class="code" href="../../de/dc8/ccss_8h.html#a3d7883a7ab60e13e2697fccb74ed5d8d">ast_setup_cc_recall_datastore</a>(owner, agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#a48e5b8fb1ab4916549247ea116b8f5b9">core_id</a>);</div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;               <a class="code" href="../../de/dc8/ccss_8h.html#ac943e39777b9c5ac58c4b4802b7347c6">ast_cc_agent_set_interfaces_chanvar</a>(owner);</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;               <a class="code" href="../../de/dc8/ccss_8h.html#a6d36b7a6c430c9a9d9a773745db94354">ast_cc_agent_recalling</a>(agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#a48e5b8fb1ab4916549247ea116b8f5b9">core_id</a>,</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;                  <span class="stringliteral">&quot;%s caller is attempting recall&quot;</span>, sig_pri_cc_type_name);</div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;               <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(agent, -1);</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;            }</div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;</div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;         }</div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_CC_CANCEL:</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;         sig_pri_cc_link_canceled(pri, subcmd-&gt;u.cc_cancel.cc_id,</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;            subcmd-&gt;u.cc_cancel.is_agent);</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_TRANSFER_CALL:</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;         <span class="keywordflow">if</span> (!call_rsp) {</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;            <span class="comment">/* Should never happen. */</span></div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;               <span class="stringliteral">&quot;Call transfer subcommand without call to send response!\n&quot;</span>);</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;         }</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;</div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;         sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;         xfer_rsp.pri = pri;</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;         xfer_rsp.call = call_rsp;</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;         xfer_rsp.invoke_id = subcmd-&gt;u.<a class="code" href="../../df/db1/structsig__pri__span.html#ad9e41a9a2b63c1e9bad00df4c2bfc92e">transfer</a>.invoke_id;</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;         xfer_rsp.responded = 0;</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;         sig_pri_attempt_transfer(pri,</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;            subcmd-&gt;u.<a class="code" href="../../df/db1/structsig__pri__span.html#ad9e41a9a2b63c1e9bad00df4c2bfc92e">transfer</a>.call_1, subcmd-&gt;u.transfer.is_call_1_held,</div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;            subcmd-&gt;u.transfer.call_2, subcmd-&gt;u.transfer.is_call_2_held,</div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;            &amp;xfer_rsp);</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;         sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_AOC_S:</div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;         sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;         owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;         <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;            sig_pri_aoc_s_from_pri(&amp;subcmd-&gt;u.aoc_s, owner,</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;               (pri-&gt;aoc_passthrough_flag &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ae1ccf2737a073b7016533eacd4ecaa1f">SIG_PRI_AOC_GRANT_S</a>));</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;         }</div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_AOC_D:</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;         sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;         owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;         <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;            <span class="comment">/* Queue AST_CONTROL_AOC frame on channel */</span></div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;            sig_pri_aoc_d_from_pri(&amp;subcmd-&gt;u.aoc_d, owner,</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;               (pri-&gt;aoc_passthrough_flag &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a7da4d7e4aa12411980e8ad434eba04b4">SIG_PRI_AOC_GRANT_D</a>));</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;         }</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_AOC_E:</div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;         sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;         owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;         <span class="comment">/* Queue AST_CONTROL_AOC frame */</span></div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;         sig_pri_aoc_e_from_pri(&amp;subcmd-&gt;u.aoc_e, owner,</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;            (pri-&gt;aoc_passthrough_flag &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab85195824a5cbc6eebb66dc1709f3626">SIG_PRI_AOC_GRANT_E</a>));</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;         <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;         }</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_AOC_CHARGING_REQ:</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;         sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;         owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;         <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;            sig_pri_aoc_request_from_pri(&amp;subcmd-&gt;u.aoc_request, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos],</div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;               call_rsp);</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;         }</div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_AOC_CHARGING_REQ_RSP:</div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;<span class="comment">          * An AOC request response may contain an AOC-S rate list.</span></div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;<span class="comment">          * If this is the case handle this just like we</span></div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;<span class="comment">          * would an incoming AOC-S msg.</span></div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;         <span class="keywordflow">if</span> (subcmd-&gt;u.aoc_request_response.valid_aoc_s) {</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;            sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;            owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;            <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;               sig_pri_aoc_s_from_pri(&amp;subcmd-&gt;u.aoc_request_response.aoc_s, owner,</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;                  (pri-&gt;aoc_passthrough_flag &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ae1ccf2737a073b7016533eacd4ecaa1f">SIG_PRI_AOC_GRANT_S</a>));</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;            }</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;         }</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MCID)</span></div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_MCID_REQ:</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;         sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;         owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;         sig_pri_mcid_event(pri, &amp;subcmd-&gt;u.mcid_req, owner);</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;         <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;         }</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MCID) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MCID)</span></div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_MCID_RSP:</div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;         <span class="comment">/* Ignore for now. */</span></div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MCID) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_DISPLAY_TEXT)</span></div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;      <span class="keywordflow">case</span> PRI_SUBCMD_DISPLAY_TEXT:</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;         <span class="keywordflow">if</span> (event_id != PRI_EVENT_RING) {</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;<span class="comment">             * This display text was not from a SETUP message.  We can do</span></div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;<span class="comment">             * something with this display text string.</span></div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;            sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;            owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;            <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;               <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> f;</div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;               <span class="comment">/* Pass the display text to the peer channel. */</span></div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;               memset(&amp;f, 0, <span class="keyword">sizeof</span>(f));</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;               f.<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a>;</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;               f.<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> = 0;</div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;               f.<a class="code" href="../../d0/d99/structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;               f.<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = (<span class="keywordtype">void</span> *)&amp;subcmd-&gt;u.display.text;</div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;               f.<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = subcmd-&gt;u.display.length + 1;</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a6cbcba5661d55216968cde8fdf913c89">ast_queue_frame</a>(owner, &amp;f);</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;            }</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;         }</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_DISPLAY_TEXT) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Span %d: Unknown call subcommand(%d) in %s event.\n&quot;</span>,</div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, subcmd-&gt;cmd, pri_event2str(event_id));</div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;      }</div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;   }</div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;}</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;<span class="comment"> * \brief Convert the MOH state to string.</span></div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;<span class="comment"> * \param state MOH state to process.</span></div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;<span class="comment"> * \return String version of MOH state.</span></div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *sig_pri_moh_state_str(<span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> state)</div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;{</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;</div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;   str = <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;   <span class="keywordflow">switch</span> (state) {</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>:</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_STATE_IDLE&quot;</span>;</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7a06b6af75bdaf9eac2404a54607d47644">SIG_PRI_MOH_STATE_NOTIFY</a>:</div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_STATE_NOTIFY&quot;</span>;</div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7abc2ce0250707ac2dc988b32ba98cad31">SIG_PRI_MOH_STATE_MOH</a>:</div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_STATE_MOH&quot;</span>;</div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_STATE_HOLD_REQ:</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_STATE_HOLD_REQ&quot;</span>;</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_STATE_PEND_UNHOLD:</div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_STATE_PEND_UNHOLD&quot;</span>;</div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_STATE_HOLD:</div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_STATE_HOLD&quot;</span>;</div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_STATE_RETRIEVE_REQ:</div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_STATE_RETRIEVE_REQ&quot;</span>;</div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_STATE_PEND_HOLD:</div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_STATE_PEND_HOLD&quot;</span>;</div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_STATE_RETRIEVE_FAIL:</div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_STATE_RETRIEVE_FAIL&quot;</span>;</div><div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7a55dbd776d4f654e80bdc2d1321d8939c">SIG_PRI_MOH_STATE_NUM</a>:</div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;      <span class="comment">/* Not a real state. */</span></div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;   }</div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;}</div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;<span class="comment"> * \brief Convert the MOH event to string.</span></div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;<span class="comment"> * \return String version of MOH event.</span></div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *sig_pri_moh_event_str(<span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> <a class="code" href="../../df/d7d/structevent.html">event</a>)</div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;{</div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;</div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;   str = <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7">SIG_PRI_MOH_EVENT_RESET</a>:</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_EVENT_RESET&quot;</span>;</div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba656e095f1a501561bcd791e27dc4cb1b">SIG_PRI_MOH_EVENT_HOLD</a>:</div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_EVENT_HOLD&quot;</span>;</div><div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1baa19137c862a2cea0ffde7a9424297d92">SIG_PRI_MOH_EVENT_UNHOLD</a>:</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_EVENT_UNHOLD&quot;</span>;</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_HOLD_ACK:</div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_EVENT_HOLD_ACK&quot;</span>;</div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_HOLD_REJ:</div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_EVENT_HOLD_REJ&quot;</span>;</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_RETRIEVE_ACK:</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_EVENT_RETRIEVE_ACK&quot;</span>;</div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_RETRIEVE_REJ:</div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_EVENT_RETRIEVE_REJ&quot;</span>;</div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_REMOTE_RETRIEVE_ACK:</div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;      str = <span class="stringliteral">&quot;SIG_PRI_MOH_EVENT_REMOTE_RETRIEVE_ACK&quot;</span>;</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba136f020c1dcbe92aeb9d3e18cb0195f3">SIG_PRI_MOH_EVENT_NUM</a>:</div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;      <span class="comment">/* Not a real event. */</span></div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;   }</div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;}</div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;</div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;<span class="comment"> * \brief Retrieve a call that was placed on hold by the HOLD message.</span></div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;<span class="comment"> * \return Next MOH state</span></div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> sig_pri_moh_retrieve_call(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt)</div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;{</div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;   <span class="keywordtype">int</span> chanpos;</div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;   <span class="keywordtype">int</span> channel;</div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;</div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;   <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">nodetype</a> == PRI_NETWORK) {</div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;      <span class="comment">/* Find an available channel to propose */</span></div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;      chanpos = pri_find_empty_chan(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>, 1);</div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;      <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;         <span class="comment">/* No channels available. */</span></div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;         <span class="keywordflow">return</span> SIG_PRI_MOH_STATE_RETRIEVE_FAIL;</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;      }</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;      channel = PVT_TO_CHANNEL(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;<span class="comment">       * We cannot occupy or reserve this channel at this time because</span></div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;<span class="comment">       * the retrieve may fail or we could have a RETRIEVE collision.</span></div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;      <span class="comment">/* Let the network pick the channel. */</span></div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;      channel = 0;</div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;   }</div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;</div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;   <span class="keywordflow">if</span> (pri_retrieve(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, channel)) {</div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;      <span class="keywordflow">return</span> SIG_PRI_MOH_STATE_RETRIEVE_FAIL;</div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;   }</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;   <span class="keywordflow">return</span> SIG_PRI_MOH_STATE_RETRIEVE_REQ;</div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;}</div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;<span class="comment"> * \brief MOH FSM state idle.</span></div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;<span class="comment"> * \param chan Channel to post event to (Usually pvt-&gt;owner)</span></div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;<span class="comment"> * \return Next MOH state</span></div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> sig_pri_moh_fsm_idle(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> event)</div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;{</div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> next_state;</div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;</div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;   next_state = pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a>;</div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba656e095f1a501561bcd791e27dc4cb1b">SIG_PRI_MOH_EVENT_HOLD</a>:</div><div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>, <span class="stringliteral">&quot;passthrough&quot;</span>)) {</div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;<span class="comment">          * This config setting is deprecated.</span></div><div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;<span class="comment">          * The old way did not send MOH just in case the notification was ignored.</span></div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;         pri_notify(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>, PRI_NOTIFY_REMOTE_HOLD);</div><div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;         next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7a06b6af75bdaf9eac2404a54607d47644">SIG_PRI_MOH_STATE_NOTIFY</a>;</div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;      }</div><div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;</div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;      <span class="keywordflow">switch</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a1e4a0fed4f941e3e49ead503d0b461c0">moh_signaling</a>) {</div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aaefb9d75efc555db41e739129925f90ea171b597e4452ea8d2fd6da561c828f9d">SIG_PRI_MOH_SIGNALING_MOH</a>:</div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;         <a class="code" href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;         next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7abc2ce0250707ac2dc988b32ba98cad31">SIG_PRI_MOH_STATE_MOH</a>;</div><div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aaefb9d75efc555db41e739129925f90ea8fad76df1a5826da082efe6d6a0f5d4d">SIG_PRI_MOH_SIGNALING_NOTIFY</a>:</div><div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;         <span class="comment">/* Send MOH anyway in case the far end does not interpret the notification. */</span></div><div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;         <a class="code" href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;</div><div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;         pri_notify(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>, PRI_NOTIFY_REMOTE_HOLD);</div><div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;         next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7a06b6af75bdaf9eac2404a54607d47644">SIG_PRI_MOH_STATE_NOTIFY</a>;</div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;      <span class="keywordflow">case</span> SIG_PRI_MOH_SIGNALING_HOLD:</div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;         <span class="keywordflow">if</span> (pri_hold(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>)) {</div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;            <span class="comment">/* Fall back to MOH instead */</span></div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;            <a class="code" href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;            next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7abc2ce0250707ac2dc988b32ba98cad31">SIG_PRI_MOH_STATE_MOH</a>;</div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;            next_state = SIG_PRI_MOH_STATE_HOLD_REQ;</div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;         }</div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;      }</div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;   }</div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a> = next_state;</div><div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;   <span class="keywordflow">return</span> next_state;</div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;}</div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;<span class="comment"> * \brief MOH FSM state notify remote party.</span></div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;<span class="comment"> * \param chan Channel to post event to (Usually pvt-&gt;owner)</span></div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;<span class="comment"> * \return Next MOH state</span></div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> sig_pri_moh_fsm_notify(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> event)</div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;{</div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> next_state;</div><div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;</div><div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;   next_state = pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a>;</div><div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba656e095f1a501561bcd791e27dc4cb1b">SIG_PRI_MOH_EVENT_HOLD</a>:</div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;      <span class="keywordflow">if</span> (strcasecmp(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>, <span class="stringliteral">&quot;passthrough&quot;</span>)) {</div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;         <span class="comment">/* Restart MOH in case it was stopped by other means. */</span></div><div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;         <a class="code" href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;      }</div><div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1baa19137c862a2cea0ffde7a9424297d92">SIG_PRI_MOH_EVENT_UNHOLD</a>:</div><div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;      pri_notify(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>, PRI_NOTIFY_REMOTE_RETRIEVAL);</div><div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;      <span class="comment">/* Fall through */</span></div><div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7">SIG_PRI_MOH_EVENT_RESET</a>:</div><div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;      <a class="code" href="../../dc/d07/musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149">ast_moh_stop</a>(chan);</div><div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;   }</div><div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a> = next_state;</div><div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;   <span class="keywordflow">return</span> next_state;</div><div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;}</div><div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;<span class="comment"> * \brief MOH FSM state generate moh.</span></div><div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;<span class="comment"> * \param chan Channel to post event to (Usually pvt-&gt;owner)</span></div><div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;<span class="comment"> * \return Next MOH state</span></div><div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> sig_pri_moh_fsm_moh(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> event)</div><div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;{</div><div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> next_state;</div><div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;</div><div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;   next_state = pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a>;</div><div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba656e095f1a501561bcd791e27dc4cb1b">SIG_PRI_MOH_EVENT_HOLD</a>:</div><div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;      <span class="comment">/* Restart MOH in case it was stopped by other means. */</span></div><div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;      <a class="code" href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7">SIG_PRI_MOH_EVENT_RESET</a>:</div><div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1baa19137c862a2cea0ffde7a9424297d92">SIG_PRI_MOH_EVENT_UNHOLD</a>:</div><div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;      <a class="code" href="../../dc/d07/musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149">ast_moh_stop</a>(chan);</div><div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;   }</div><div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a> = next_state;</div><div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;   <span class="keywordflow">return</span> next_state;</div><div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;}</div><div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;</div><div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;<span class="comment"> * \brief MOH FSM state hold requested.</span></div><div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;<span class="comment"> * \param chan Channel to post event to (Usually pvt-&gt;owner)</span></div><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;<span class="comment"> * \return Next MOH state</span></div><div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> sig_pri_moh_fsm_hold_req(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> event)</div><div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;{</div><div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> next_state;</div><div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;</div><div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;   next_state = pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a>;</div><div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7">SIG_PRI_MOH_EVENT_RESET</a>:</div><div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1baa19137c862a2cea0ffde7a9424297d92">SIG_PRI_MOH_EVENT_UNHOLD</a>:</div><div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;      next_state = SIG_PRI_MOH_STATE_PEND_UNHOLD;</div><div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_HOLD_REJ:</div><div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;      <span class="comment">/* Fall back to MOH */</span></div><div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;      <span class="keywordflow">if</span> (chan) {</div><div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;         <a class="code" href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;      }</div><div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7abc2ce0250707ac2dc988b32ba98cad31">SIG_PRI_MOH_STATE_MOH</a>;</div><div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_HOLD_ACK:</div><div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;      next_state = SIG_PRI_MOH_STATE_HOLD;</div><div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;   }</div><div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a> = next_state;</div><div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;   <span class="keywordflow">return</span> next_state;</div><div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;}</div><div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;</div><div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;<span class="comment"> * \brief MOH FSM state hold requested with pending unhold.</span></div><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;<span class="comment"> * \param chan Channel to post event to (Usually pvt-&gt;owner)</span></div><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;<span class="comment"> * \return Next MOH state</span></div><div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> sig_pri_moh_fsm_pend_unhold(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> event)</div><div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;{</div><div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> next_state;</div><div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;</div><div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;   next_state = pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a>;</div><div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7">SIG_PRI_MOH_EVENT_RESET</a>:</div><div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba656e095f1a501561bcd791e27dc4cb1b">SIG_PRI_MOH_EVENT_HOLD</a>:</div><div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;      next_state = SIG_PRI_MOH_STATE_HOLD_REQ;</div><div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_HOLD_REJ:</div><div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_HOLD_ACK:</div><div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;      next_state = sig_pri_moh_retrieve_call(pvt);</div><div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;   }</div><div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a> = next_state;</div><div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;   <span class="keywordflow">return</span> next_state;</div><div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;}</div><div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;</div><div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;<span class="comment"> * \brief MOH FSM state hold.</span></div><div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;<span class="comment"> * \param chan Channel to post event to (Usually pvt-&gt;owner)</span></div><div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;<span class="comment"> * \return Next MOH state</span></div><div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> sig_pri_moh_fsm_hold(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> event)</div><div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;{</div><div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> next_state;</div><div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;</div><div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;   next_state = pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a>;</div><div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7">SIG_PRI_MOH_EVENT_RESET</a>:</div><div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1baa19137c862a2cea0ffde7a9424297d92">SIG_PRI_MOH_EVENT_UNHOLD</a>:</div><div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;      next_state = sig_pri_moh_retrieve_call(pvt);</div><div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_REMOTE_RETRIEVE_ACK:</div><div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;      <span class="comment">/* Fall back to MOH */</span></div><div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;      <span class="keywordflow">if</span> (chan) {</div><div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;         <a class="code" href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;      }</div><div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7abc2ce0250707ac2dc988b32ba98cad31">SIG_PRI_MOH_STATE_MOH</a>;</div><div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;   }</div><div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a> = next_state;</div><div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;   <span class="keywordflow">return</span> next_state;</div><div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;}</div><div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;</div><div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;<span class="comment"> * \brief MOH FSM state retrieve requested.</span></div><div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;<span class="comment"> * \param chan Channel to post event to (Usually pvt-&gt;owner)</span></div><div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;<span class="comment"> * \return Next MOH state</span></div><div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> sig_pri_moh_fsm_retrieve_req(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> event)</div><div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;{</div><div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> next_state;</div><div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;</div><div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;   next_state = pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a>;</div><div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7">SIG_PRI_MOH_EVENT_RESET</a>:</div><div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba656e095f1a501561bcd791e27dc4cb1b">SIG_PRI_MOH_EVENT_HOLD</a>:</div><div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;      next_state = SIG_PRI_MOH_STATE_PEND_HOLD;</div><div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_RETRIEVE_ACK:</div><div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_REMOTE_RETRIEVE_ACK:</div><div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_RETRIEVE_REJ:</div><div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;      next_state = SIG_PRI_MOH_STATE_RETRIEVE_FAIL;</div><div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;   }</div><div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a> = next_state;</div><div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;   <span class="keywordflow">return</span> next_state;</div><div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;}</div><div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;</div><div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;<span class="comment"> * \brief MOH FSM state retrieve requested with pending hold.</span></div><div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;<span class="comment"> * \param chan Channel to post event to (Usually pvt-&gt;owner)</span></div><div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;<span class="comment"> * \return Next MOH state</span></div><div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> sig_pri_moh_fsm_pend_hold(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> event)</div><div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;{</div><div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> next_state;</div><div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;</div><div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;   next_state = pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a>;</div><div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7">SIG_PRI_MOH_EVENT_RESET</a>:</div><div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1baa19137c862a2cea0ffde7a9424297d92">SIG_PRI_MOH_EVENT_UNHOLD</a>:</div><div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;      next_state = SIG_PRI_MOH_STATE_RETRIEVE_REQ;</div><div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_RETRIEVE_ACK:</div><div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_REMOTE_RETRIEVE_ACK:</div><div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;<span class="comment">       * Successfully came off of hold.  Now we can reinterpret the</span></div><div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;<span class="comment">       * MOH signaling option to handle the pending HOLD request.</span></div><div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;      <span class="keywordflow">switch</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a1e4a0fed4f941e3e49ead503d0b461c0">moh_signaling</a>) {</div><div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aaefb9d75efc555db41e739129925f90ea171b597e4452ea8d2fd6da561c828f9d">SIG_PRI_MOH_SIGNALING_MOH</a>:</div><div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;         <span class="keywordflow">if</span> (chan) {</div><div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;            <a class="code" href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;         }</div><div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;         next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7abc2ce0250707ac2dc988b32ba98cad31">SIG_PRI_MOH_STATE_MOH</a>;</div><div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aaefb9d75efc555db41e739129925f90ea8fad76df1a5826da082efe6d6a0f5d4d">SIG_PRI_MOH_SIGNALING_NOTIFY</a>:</div><div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;         <span class="comment">/* Send MOH anyway in case the far end does not interpret the notification. */</span></div><div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;         <span class="keywordflow">if</span> (chan) {</div><div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;            <a class="code" href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;         }</div><div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;</div><div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;         pri_notify(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>, PRI_NOTIFY_REMOTE_HOLD);</div><div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;         next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7a06b6af75bdaf9eac2404a54607d47644">SIG_PRI_MOH_STATE_NOTIFY</a>;</div><div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;      <span class="keywordflow">case</span> SIG_PRI_MOH_SIGNALING_HOLD:</div><div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;         <span class="keywordflow">if</span> (pri_hold(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>)) {</div><div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;            <span class="comment">/* Fall back to MOH instead */</span></div><div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;            <span class="keywordflow">if</span> (chan) {</div><div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;               <a class="code" href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a>(chan, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;            }</div><div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;            next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7abc2ce0250707ac2dc988b32ba98cad31">SIG_PRI_MOH_STATE_MOH</a>;</div><div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;            next_state = SIG_PRI_MOH_STATE_HOLD_REQ;</div><div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;         }</div><div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;      }</div><div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_RETRIEVE_REJ:</div><div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;<span class="comment">       * We cannot reinterpret the MOH signaling option because we</span></div><div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;<span class="comment">       * failed to come off of hold.</span></div><div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;      next_state = SIG_PRI_MOH_STATE_HOLD;</div><div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;   }</div><div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a> = next_state;</div><div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;   <span class="keywordflow">return</span> next_state;</div><div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;}</div><div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;</div><div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;<span class="comment"> * \brief MOH FSM state retrieve failed.</span></div><div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;<span class="comment"> * \param chan Channel to post event to (Usually pvt-&gt;owner)</span></div><div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;<span class="comment"> * \return Next MOH state</span></div><div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> sig_pri_moh_fsm_retrieve_fail(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> event)</div><div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;{</div><div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> next_state;</div><div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;</div><div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;   next_state = pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a>;</div><div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7">SIG_PRI_MOH_EVENT_RESET</a>:</div><div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba656e095f1a501561bcd791e27dc4cb1b">SIG_PRI_MOH_EVENT_HOLD</a>:</div><div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;      next_state = SIG_PRI_MOH_STATE_HOLD;</div><div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1baa19137c862a2cea0ffde7a9424297d92">SIG_PRI_MOH_EVENT_UNHOLD</a>:</div><div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;      next_state = sig_pri_moh_retrieve_call(pvt);</div><div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;   <span class="keywordflow">case</span> SIG_PRI_MOH_EVENT_REMOTE_RETRIEVE_ACK:</div><div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;      next_state = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>;</div><div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;   }</div><div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;   pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a> = next_state;</div><div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;   <span class="keywordflow">return</span> next_state;</div><div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;}</div><div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;<span class="comment"> * \brief MOH FSM state function type.</span></div><div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;<span class="comment"> * \param chan Channel to post event to (Usually pvt-&gt;owner)</span></div><div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;<span class="comment"> * \return Next MOH state</span></div><div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> (*sig_pri_moh_fsm_state)(<span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> event);</div><div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;<span class="comment">/*! MOH FSM state table. */</span></div><div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> sig_pri_moh_fsm_state sig_pri_moh_fsm[<a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7a55dbd776d4f654e80bdc2d1321d8939c">SIG_PRI_MOH_STATE_NUM</a>] = {</div><div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;<span class="comment">/* *INDENT-OFF* */</span></div><div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;   [<a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a>] = sig_pri_moh_fsm_idle,</div><div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;   [<a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7a06b6af75bdaf9eac2404a54607d47644">SIG_PRI_MOH_STATE_NOTIFY</a>] = sig_pri_moh_fsm_notify,</div><div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;   [<a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7abc2ce0250707ac2dc988b32ba98cad31">SIG_PRI_MOH_STATE_MOH</a>] = sig_pri_moh_fsm_moh,</div><div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;   [SIG_PRI_MOH_STATE_HOLD_REQ] = sig_pri_moh_fsm_hold_req,</div><div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;   [SIG_PRI_MOH_STATE_PEND_UNHOLD] = sig_pri_moh_fsm_pend_unhold,</div><div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;   [SIG_PRI_MOH_STATE_HOLD] = sig_pri_moh_fsm_hold,</div><div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;   [SIG_PRI_MOH_STATE_RETRIEVE_REQ] = sig_pri_moh_fsm_retrieve_req,</div><div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;   [SIG_PRI_MOH_STATE_PEND_HOLD] = sig_pri_moh_fsm_pend_hold,</div><div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;   [SIG_PRI_MOH_STATE_RETRIEVE_FAIL] = sig_pri_moh_fsm_retrieve_fail,</div><div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;<span class="comment">/* *INDENT-ON* */</span></div><div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;};</div><div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;<span class="comment"> * \brief Send an event to the MOH FSM.</span></div><div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;<span class="comment"> * \param chan Channel to post event to (Usually pvt-&gt;owner)</span></div><div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;<span class="comment"> * \param pvt Channel private control structure.</span></div><div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;<span class="comment"> * \param event MOH event to process.</span></div><div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;<span class="comment"> * \note Assumes the pvt-&gt;pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pvt) is already obtained.</span></div><div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_moh_fsm_event(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a> event)</div><div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;{</div><div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> orig_state;</div><div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a> next_state;</div><div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *chan_name;</div><div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;</div><div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;   <span class="keywordflow">if</span> (chan) {</div><div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;      chan_name = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;      chan_name = <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;   }</div><div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;   orig_state = pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">moh_state</a>;</div><div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Channel &#39;%s&#39; MOH-Event: %s in state %s\n&quot;</span>, chan_name,</div><div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;      sig_pri_moh_event_str(event), sig_pri_moh_state_str(orig_state));</div><div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;   <span class="keywordflow">if</span> (orig_state &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a> || <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7a55dbd776d4f654e80bdc2d1321d8939c">SIG_PRI_MOH_STATE_NUM</a> &lt;= orig_state</div><div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;      || !sig_pri_moh_fsm[orig_state]) {</div><div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;      <span class="comment">/* Programming error: State not implemented. */</span></div><div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;MOH state not implemented: %s(%u)\n&quot;</span>,</div><div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;         sig_pri_moh_state_str(orig_state), orig_state);</div><div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;   }</div><div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;   <span class="comment">/* Execute the state. */</span></div><div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;   next_state = sig_pri_moh_fsm[orig_state](chan, pvt, event);</div><div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Channel &#39;%s&#39;  MOH-Next-State: %s\n&quot;</span>, chan_name,</div><div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;      (orig_state == next_state) ? <span class="stringliteral">&quot;$&quot;</span> : sig_pri_moh_state_str(next_state));</div><div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;}</div><div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;<span class="comment"> * \brief Set callid threadstorage for the pri_dchannel thread when a new call is created</span></div><div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;<span class="comment"> * \return A new callid which has been bound to threadstorage. The threadstorage</span></div><div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;<span class="comment"> *         should be unbound when the pri_dchannel primary loop wraps.</span></div><div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> func_pri_dchannel_new_callid(<span class="keywordtype">void</span>)</div><div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;{</div><div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> callid = <a class="code" href="../../d1/d8c/logger_8h.html#a6cd2a7c20c6cfe0e3f4fed72dd2cc6b2">ast_create_callid</a>();</div><div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;</div><div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;   <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a6956becf4d7e3906c74b6e30b834ebd8">ast_callid_threadassoc_add</a>(callid);</div><div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;   }</div><div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;</div><div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;   <span class="keywordflow">return</span> callid;</div><div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;}</div><div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;<span class="comment"> * \brief Set callid threadstorage for the pri_dchannel thread to that of an existing channel</span></div><div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;<span class="comment"> * \param chanpos channel position in the span</span></div><div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;<span class="comment"> * \return The callid which has also been bound to threadstorage if it exists.</span></div><div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;<span class="comment"> *         The threadstorage should be unbound when the pri_dchannel primary loop wraps.</span></div><div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;<span class="keyword">static</span> <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> func_pri_dchannel_chanpos_callid(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos)</div><div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;{</div><div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;   }</div><div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;</div><div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;   sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> callid;</div><div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;      callid = <a class="code" href="../../d5/d7b/channel_8h.html#a6c2c406bdebd477029e61774cc300abd">ast_channel_callid</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;      <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a6956becf4d7e3906c74b6e30b834ebd8">ast_callid_threadassoc_add</a>(callid);</div><div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;         <span class="keywordflow">return</span> callid;</div><div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;      }</div><div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;   }</div><div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;</div><div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;}</div><div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;</div><div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;<span class="comment"> * \brief Handle the hold event from libpri.</span></div><div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;<span class="comment"> * \param ev Hold event received.</span></div><div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_handle_hold(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, pri_event *ev)</div><div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;{</div><div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../db/d37/hsearch_8c.html#ad0f0f85b3cab490a81baa02c4b9edf45">retval</a>;</div><div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;   <span class="keywordtype">int</span> chanpos_old;</div><div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;   <span class="keywordtype">int</span> chanpos_new;</div><div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner;</div><div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> callid = 0;</div><div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;</div><div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;   chanpos_old = pri_find_principle_by_call(pri, ev-&gt;hold.call);</div><div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;   <span class="keywordflow">if</span> (chanpos_old &lt; 0) {</div><div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Span %d: Received HOLD for unknown call.\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;   }</div><div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos_old]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a>) {</div><div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;      <span class="comment">/* Call is already on hold or is call waiting call. */</span></div><div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;   }</div><div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;</div><div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;   chanpos_new = -1;</div><div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;</div><div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;   sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos_old]);</div><div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;   sig_pri_lock_owner(pri, chanpos_old);</div><div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;   owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos_old]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;   <span class="keywordflow">if</span> (!owner) {</div><div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;      <span class="keywordflow">goto</span> done_with_private;</div><div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;   }</div><div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;</div><div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;   callid = <a class="code" href="../../d5/d7b/channel_8h.html#a6c2c406bdebd477029e61774cc300abd">ast_channel_callid</a>(owner);</div><div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;</div><div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;   <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a6956becf4d7e3906c74b6e30b834ebd8">ast_callid_threadassoc_add</a>(callid);</div><div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;   }</div><div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;</div><div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos_old]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> != <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822">SIG_PRI_CALL_LEVEL_CONNECT</a>) {</div><div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;<span class="comment">       * Make things simple.  Don&#39;t allow placing a call on hold that</span></div><div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;<span class="comment">       * is not connected.</span></div><div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;      <span class="keywordflow">goto</span> done_with_owner;</div><div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;   }</div><div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;   chanpos_new = pri_find_empty_nobch(pri);</div><div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;   <span class="keywordflow">if</span> (chanpos_new &lt; 0) {</div><div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;      <span class="comment">/* No hold channel available. */</span></div><div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;      <span class="keywordflow">goto</span> done_with_owner;</div><div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;   }</div><div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;   sig_pri_handle_subcmds(pri, chanpos_old, ev-&gt;e, ev-&gt;hold.subcmds, ev-&gt;hold.call);</div><div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;   sig_pri_queue_hold(pri, chanpos_old);</div><div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;   chanpos_new = pri_fixup_principle(pri, chanpos_new, ev-&gt;hold.call);</div><div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;   <span class="keywordflow">if</span> (chanpos_new &lt; 0) {</div><div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;      <span class="comment">/* Should never happen. */</span></div><div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;      sig_pri_queue_unhold(pri, chanpos_old);</div><div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;   }</div><div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;</div><div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;done_with_owner:;</div><div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;done_with_private:;</div><div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;   sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos_old]);</div><div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;</div><div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;   <span class="keywordflow">if</span> (chanpos_new &lt; 0) {</div><div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;      retval = -1;</div><div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;      sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;      retval = 0;</div><div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;   }</div><div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;</div><div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;   <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a9e325f2d0c2872627a05feff17423f80">ast_callid_threadassoc_remove</a>();</div><div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;   }</div><div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;</div><div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d37/hsearch_8c.html#ad0f0f85b3cab490a81baa02c4b9edf45">retval</a>;</div><div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;}</div><div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;</div><div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;<span class="comment"> * \brief Handle the hold acknowledge event from libpri.</span></div><div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;<span class="comment"> * \param ev Hold acknowledge event received.</span></div><div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_handle_hold_ack(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, pri_event *ev)</div><div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;{</div><div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;   <span class="keywordtype">int</span> chanpos;</div><div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> <a class="code" href="../../df/d3c/structast__channel.html#a62f8995a6eac6c8a48205a6f3815d54b">callid</a>;</div><div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;</div><div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;<span class="comment">    * We were successfully put on hold by the remote party</span></div><div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;<span class="comment">    * so we just need to switch to a no_b_channel channel.</span></div><div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;   chanpos = pri_find_empty_nobch(pri);</div><div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;      <span class="comment">/* Very bad news.  No hold channel available. */</span></div><div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;         <span class="stringliteral">&quot;Span %d: No hold channel available for held call that is on %d/%d\n&quot;</span>,</div><div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, PRI_SPAN(ev-&gt;hold_ack.channel), PRI_CHANNEL(ev-&gt;hold_ack.channel));</div><div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;      sig_pri_kill_call(pri, ev-&gt;hold_ack.call, PRI_CAUSE_RESOURCE_UNAVAIL_UNSPECIFIED);</div><div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;   }</div><div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;   chanpos = pri_fixup_principle(pri, chanpos, ev-&gt;hold_ack.call);</div><div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;      <span class="comment">/* Should never happen. */</span></div><div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;      sig_pri_kill_call(pri, ev-&gt;hold_ack.call, PRI_CAUSE_NORMAL_TEMPORARY_FAILURE);</div><div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;   }</div><div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;</div><div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;   sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;   callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;</div><div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;   sig_pri_handle_subcmds(pri, chanpos, ev-&gt;e, ev-&gt;hold_ack.subcmds, ev-&gt;hold_ack.call);</div><div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;   sig_pri_moh_fsm_event(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos],</div><div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;      SIG_PRI_MOH_EVENT_HOLD_ACK);</div><div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;   sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;   sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;</div><div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;   <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a9e325f2d0c2872627a05feff17423f80">ast_callid_threadassoc_remove</a>();</div><div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;   }</div><div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;}</div><div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;</div><div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;<span class="comment"> * \brief Handle the hold reject event from libpri.</span></div><div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;<span class="comment"> * \param ev Hold reject event received.</span></div><div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_handle_hold_rej(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, pri_event *ev)</div><div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;{</div><div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;   <span class="keywordtype">int</span> chanpos;</div><div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> <a class="code" href="../../df/d3c/structast__channel.html#a62f8995a6eac6c8a48205a6f3815d54b">callid</a>;</div><div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;</div><div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;   chanpos = pri_find_principle(pri, ev-&gt;hold_rej.channel, ev-&gt;hold_rej.call);</div><div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Span %d: Could not find principle for HOLD_REJECT\n&quot;</span>,</div><div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;      sig_pri_kill_call(pri, ev-&gt;hold_rej.call, PRI_CAUSE_NORMAL_TEMPORARY_FAILURE);</div><div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;   }</div><div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;   chanpos = pri_fixup_principle(pri, chanpos, ev-&gt;hold_rej.call);</div><div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;      <span class="comment">/* Should never happen. */</span></div><div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;      sig_pri_kill_call(pri, ev-&gt;hold_rej.call, PRI_CAUSE_NORMAL_TEMPORARY_FAILURE);</div><div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;   }</div><div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;</div><div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Span %d: HOLD_REJECT cause: %d(%s)\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>,</div><div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;      ev-&gt;hold_rej.cause, pri_cause2str(ev-&gt;hold_rej.cause));</div><div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;</div><div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;   sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;   callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;</div><div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;   sig_pri_handle_subcmds(pri, chanpos, ev-&gt;e, ev-&gt;hold_rej.subcmds, ev-&gt;hold_rej.call);</div><div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;   sig_pri_moh_fsm_event(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos],</div><div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;      SIG_PRI_MOH_EVENT_HOLD_REJ);</div><div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;   sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;</div><div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;   <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a9e325f2d0c2872627a05feff17423f80">ast_callid_threadassoc_remove</a>();</div><div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;   }</div><div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;}</div><div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;</div><div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;<span class="comment"> * \brief Handle the retrieve event from libpri.</span></div><div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;<span class="comment"> * \param ev Retrieve event received.</span></div><div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_handle_retrieve(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, pri_event *ev)</div><div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;{</div><div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;   <span class="keywordtype">int</span> chanpos;</div><div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> <a class="code" href="../../df/d3c/structast__channel.html#a62f8995a6eac6c8a48205a6f3815d54b">callid</a>;</div><div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;</div><div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;   <span class="keywordflow">if</span> (!(ev-&gt;retrieve.channel &amp; PRI_HELD_CALL)) {</div><div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;      <span class="comment">/* The call is not currently held. */</span></div><div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;      pri_retrieve_rej(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, ev-&gt;retrieve.call,</div><div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;         PRI_CAUSE_RESOURCE_UNAVAIL_UNSPECIFIED);</div><div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;   }</div><div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;   <span class="keywordflow">if</span> (pri_find_principle_by_call(pri, ev-&gt;retrieve.call) &lt; 0) {</div><div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Span %d: Received RETRIEVE for unknown call.\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;      pri_retrieve_rej(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, ev-&gt;retrieve.call,</div><div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;         PRI_CAUSE_RESOURCE_UNAVAIL_UNSPECIFIED);</div><div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;   }</div><div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;   <span class="keywordflow">if</span> (PRI_CHANNEL(ev-&gt;retrieve.channel) == 0xFF) {</div><div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;      chanpos = pri_find_empty_chan(pri, 1);</div><div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;      chanpos = pri_find_principle(pri,</div><div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;         ev-&gt;retrieve.channel &amp; ~PRI_HELD_CALL, ev-&gt;retrieve.call);</div><div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;      <span class="keywordflow">if</span> (ev-&gt;retrieve.flexible</div><div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;         &amp;&amp; (chanpos &lt; 0 || !<a class="code" href="../../d7/d6c/sig__pri_8h.html#a03805c1c05301a1e86967ad671dec748">sig_pri_is_chan_available</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]))) {</div><div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;<span class="comment">          * Channel selection is flexible and the requested channel</span></div><div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;<span class="comment">          * is bad or not available.  Pick another channel.</span></div><div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;         chanpos = pri_find_empty_chan(pri, 1);</div><div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;      }</div><div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;   }</div><div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;      pri_retrieve_rej(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, ev-&gt;retrieve.call,</div><div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;         ev-&gt;retrieve.flexible ? PRI_CAUSE_NORMAL_CIRCUIT_CONGESTION</div><div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;         : PRI_CAUSE_REQUESTED_CHAN_UNAVAIL);</div><div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;   }</div><div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;   chanpos = pri_fixup_principle(pri, chanpos, ev-&gt;retrieve.call);</div><div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;      <span class="comment">/* Channel is already in use. */</span></div><div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;      pri_retrieve_rej(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, ev-&gt;retrieve.call,</div><div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;         PRI_CAUSE_REQUESTED_CHAN_UNAVAIL);</div><div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;   }</div><div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;   sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;   callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;   sig_pri_handle_subcmds(pri, chanpos, ev-&gt;e, ev-&gt;retrieve.subcmds, ev-&gt;retrieve.call);</div><div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;   sig_pri_queue_unhold(pri, chanpos);</div><div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;   pri_retrieve_ack(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, ev-&gt;retrieve.call,</div><div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;      PVT_TO_CHANNEL(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]));</div><div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;   sig_pri_moh_fsm_event(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos],</div><div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;      SIG_PRI_MOH_EVENT_REMOTE_RETRIEVE_ACK);</div><div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;   sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;   sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;</div><div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;   <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a9e325f2d0c2872627a05feff17423f80">ast_callid_threadassoc_remove</a>();</div><div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;   }</div><div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;}</div><div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;</div><div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;<span class="comment"> * \brief Handle the retrieve acknowledge event from libpri.</span></div><div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;<span class="comment"> * \param ev Retrieve acknowledge event received.</span></div><div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_handle_retrieve_ack(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, pri_event *ev)</div><div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;{</div><div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;   <span class="keywordtype">int</span> chanpos;</div><div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> <a class="code" href="../../df/d3c/structast__channel.html#a62f8995a6eac6c8a48205a6f3815d54b">callid</a>;</div><div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;</div><div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;   chanpos = pri_find_fixup_principle(pri, ev-&gt;retrieve_ack.channel,</div><div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;      ev-&gt;retrieve_ack.call);</div><div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;   }</div><div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;</div><div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;   sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;   callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;</div><div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;   sig_pri_handle_subcmds(pri, chanpos, ev-&gt;e, ev-&gt;retrieve_ack.subcmds,</div><div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;      ev-&gt;retrieve_ack.call);</div><div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;   sig_pri_moh_fsm_event(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos],</div><div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;      SIG_PRI_MOH_EVENT_RETRIEVE_ACK);</div><div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;   sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;   sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;</div><div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;   <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a9e325f2d0c2872627a05feff17423f80">ast_callid_threadassoc_remove</a>();</div><div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;   }</div><div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;}</div><div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;</div><div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;<span class="comment"> * \brief Handle the retrieve reject event from libpri.</span></div><div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;<span class="comment"> * \param ev Retrieve reject event received.</span></div><div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_handle_retrieve_rej(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, pri_event *ev)</div><div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;{</div><div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;   <span class="keywordtype">int</span> chanpos;</div><div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> <a class="code" href="../../df/d3c/structast__channel.html#a62f8995a6eac6c8a48205a6f3815d54b">callid</a>;</div><div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;</div><div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;   chanpos = pri_find_principle(pri, ev-&gt;retrieve_rej.channel, ev-&gt;retrieve_rej.call);</div><div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Span %d: Could not find principle for RETRIEVE_REJECT\n&quot;</span>,</div><div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;      sig_pri_kill_call(pri, ev-&gt;retrieve_rej.call, PRI_CAUSE_NORMAL_TEMPORARY_FAILURE);</div><div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;   }</div><div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;   chanpos = pri_fixup_principle(pri, chanpos, ev-&gt;retrieve_rej.call);</div><div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;      <span class="comment">/* Should never happen. */</span></div><div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;      sig_pri_kill_call(pri, ev-&gt;retrieve_rej.call, PRI_CAUSE_NORMAL_TEMPORARY_FAILURE);</div><div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;   }</div><div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;</div><div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Span %d: RETRIEVE_REJECT cause: %d(%s)\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>,</div><div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;      ev-&gt;retrieve_rej.cause, pri_cause2str(ev-&gt;retrieve_rej.cause));</div><div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160;</div><div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;   sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;   callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;</div><div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;   sig_pri_handle_subcmds(pri, chanpos, ev-&gt;e, ev-&gt;retrieve_rej.subcmds,</div><div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;      ev-&gt;retrieve_rej.call);</div><div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160;   sig_pri_moh_fsm_event(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos],</div><div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;      SIG_PRI_MOH_EVENT_RETRIEVE_REJ);</div><div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;   sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160;</div><div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;   <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a9e325f2d0c2872627a05feff17423f80">ast_callid_threadassoc_remove</a>();</div><div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;   }</div><div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;}</div><div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;<span class="comment"> * \brief Setup channel variables on the owner.</span></div><div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;<span class="comment"> * \param chanpos Channel position in the span.</span></div><div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;<span class="comment"> * \param ev SETUP event received.</span></div><div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(pri-&gt;pvts[chanpos]) is already obtained.</span></div><div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> setup_incoming_channel(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> chanpos, pri_event *ev)</div><div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;{</div><div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner;</div><div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;   <span class="keywordtype">char</span> ani2str[6];</div><div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;   <span class="keywordtype">char</span> calledtonstr[10];</div><div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;</div><div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;   sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;   owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;   <span class="keywordflow">if</span> (!owner) {</div><div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;   }</div><div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;</div><div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;   <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf195fcf1686408b5e52ad76996653cea">ast_channel_stage_snapshot</a>(owner);</div><div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;</div><div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SUBADDR)</span></div><div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;   <span class="keywordflow">if</span> (ev-&gt;ring.calling.subaddress.valid) {</div><div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;      <span class="comment">/* Set Calling Subaddress */</span></div><div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;      sig_pri_set_subaddress(&amp;<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(owner)-&gt;<span class="keywordtype">id</span>.subaddress,</div><div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;         &amp;ev-&gt;ring.calling.subaddress);</div><div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;      <span class="keywordflow">if</span> (!ev-&gt;ring.calling.subaddress.type</div><div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160;         &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>((<span class="keywordtype">char</span> *) ev-&gt;ring.calling.subaddress.data)) {</div><div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;         <span class="comment">/* NSAP */</span></div><div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;CALLINGSUBADDR&quot;</span>,</div><div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;            (<span class="keywordtype">char</span> *) ev-&gt;ring.calling.subaddress.<a class="code" href="../../df/d3c/structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>);</div><div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;      }</div><div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;   }</div><div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;   <span class="keywordflow">if</span> (ev-&gt;ring.called_subaddress.valid) {</div><div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;      <span class="comment">/* Set Called Subaddress */</span></div><div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;      sig_pri_set_subaddress(&amp;<a class="code" href="../../d5/d7b/channel_8h.html#a63732831df3e7a0999b0900ec85c626a">ast_channel_dialed</a>(owner)-&gt;subaddress,</div><div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;         &amp;ev-&gt;ring.called_subaddress);</div><div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;      <span class="keywordflow">if</span> (!ev-&gt;ring.called_subaddress.type</div><div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;         &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>((<span class="keywordtype">char</span> *) ev-&gt;ring.called_subaddress.data)) {</div><div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;         <span class="comment">/* NSAP */</span></div><div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;CALLEDSUBADDR&quot;</span>,</div><div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;            (<span class="keywordtype">char</span> *) ev-&gt;ring.called_subaddress.<a class="code" href="../../df/d3c/structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>);</div><div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;      }</div><div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;   }</div><div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(ev-&gt;ring.callingsubaddr)) {</div><div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;CALLINGSUBADDR&quot;</span>, ev-&gt;ring.callingsubaddr);</div><div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;   }</div><div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !defined(HAVE_PRI_SUBADDR) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;   <span class="keywordflow">if</span> (ev-&gt;ring.ani2 &gt;= 0) {</div><div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(owner)-&gt;<a class="code" href="../../d4/d77/structast__party__caller.html#ad3bdbbc7177d5ac309bc72f9fc3c4bee">ani2</a> = ev-&gt;ring.ani2;</div><div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;      snprintf(ani2str, <span class="keyword">sizeof</span>(ani2str), <span class="stringliteral">&quot;%d&quot;</span>, ev-&gt;ring.ani2);</div><div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;ANI2&quot;</span>, ani2str);</div><div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;   }</div><div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;</div><div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;<span class="preprocessor">#ifdef SUPPORT_USERUSER</span></div><div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(ev-&gt;ring.useruserinfo)) {</div><div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;USERUSERINFO&quot;</span>, ev-&gt;ring.useruserinfo);</div><div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;   }</div><div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;</div><div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;   snprintf(calledtonstr, <span class="keyword">sizeof</span>(calledtonstr), <span class="stringliteral">&quot;%d&quot;</span>, ev-&gt;ring.calledplan);</div><div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;CALLEDTON&quot;</span>, calledtonstr);</div><div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a63732831df3e7a0999b0900ec85c626a">ast_channel_dialed</a>(owner)-&gt;<a class="code" href="../../d1/dd1/structast__party__dialed.html#a436a3700bd4ae24751d7fad4538466aa">number</a>.<a class="code" href="../../d1/dd1/structast__party__dialed.html#ad1f8db563cb99d404b72e02cf8f78cd1">plan</a> = ev-&gt;ring.calledplan;</div><div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;</div><div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;   <span class="keywordflow">if</span> (ev-&gt;ring.redirectingreason &gt;= 0) {</div><div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;      <span class="comment">/* This is now just a status variable.  Use REDIRECTING() dialplan function. */</span></div><div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;PRIREDIRECTREASON&quot;</span>,</div><div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160;         redirectingreason2str(ev-&gt;ring.redirectingreason));</div><div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;   }</div><div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_REVERSE_CHARGE)</span></div><div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;   pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;reverse_charging_indication = ev-&gt;ring.reversecharge;</div><div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SETUP_KEYPAD)</span></div><div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;keypad_digits,</div><div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;      ev-&gt;ring.keypad_digits, <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;keypad_digits));</div><div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SETUP_KEYPAD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;</div><div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;<span class="comment">    * It&#39;s ok to call this with the owner already locked here</span></div><div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;<span class="comment">    * since it will want to do this anyway if there are any</span></div><div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;<span class="comment">    * subcmds.</span></div><div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160;   sig_pri_handle_subcmds(pri, chanpos, ev-&gt;e, ev-&gt;ring.subcmds,</div><div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;      ev-&gt;ring.call);</div><div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;</div><div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;   <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga920b9d3e484257c7e593452a8e36d8d4">ast_channel_stage_snapshot_done</a>(owner);</div><div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;}</div><div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;<span class="comment"> * \brief Handle the incoming SETUP event from libpri.</span></div><div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;<span class="comment"> * \param e SETUP event received.</span></div><div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_handle_setup(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, pri_event *e)</div><div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;{</div><div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;   <span class="keywordtype">int</span> exten_exists_or_can_exist;</div><div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;   <span class="keywordtype">int</span> could_match_more;</div><div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;   <span class="keywordtype">int</span> need_dialtone;</div><div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0521b3661ec0c6d0b664abe98f84c5ba">sig_pri_law</a> law;</div><div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;   <span class="keywordtype">int</span> chanpos = -1;</div><div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> callid = 0;</div><div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;   <span class="keywordtype">char</span> plancallingnum[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];</div><div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;   <span class="keywordtype">char</span> plancallingani[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];</div><div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;   pthread_t threadid;</div><div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;</div><div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a42d869c4d919457e772ca8346dde0f35">msn_list</a>)</div><div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;      &amp;&amp; !sig_pri_msn_match(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a42d869c4d919457e772ca8346dde0f35">msn_list</a>, e-&gt;ring.callednum)) {</div><div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;      <span class="comment">/* The call is not for us so ignore it. */</span></div><div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,</div><div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;         <span class="stringliteral">&quot;Ignoring call to &#39;%s&#39; on span %d.  Its not in the MSN list: %s\n&quot;</span>,</div><div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;         e-&gt;ring.callednum, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a42d869c4d919457e772ca8346dde0f35">msn_list</a>);</div><div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;      pri_destroycall(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call);</div><div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;      <span class="keywordflow">goto</span> setup_exit;</div><div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;   }</div><div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;   <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;ring.channel)) {</div><div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;      sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;ring.subcmds, e-&gt;ring.call);</div><div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;      <span class="keywordflow">goto</span> setup_exit;</div><div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;   }</div><div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;   chanpos = pri_find_principle_by_call(pri, e-&gt;ring.call);</div><div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;   <span class="keywordflow">if</span> (-1 &lt; chanpos) {</div><div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;      <span class="comment">/* Libpri has already filtered out duplicate SETUPs. */</span></div><div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;         <span class="stringliteral">&quot;Span %d: Got SETUP with duplicate call ptr (%p).  Dropping call.\n&quot;</span>,</div><div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, e-&gt;ring.call);</div><div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;      pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call, PRI_CAUSE_NORMAL_TEMPORARY_FAILURE);</div><div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;      <span class="keywordflow">goto</span> setup_exit;</div><div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;   }</div><div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;   <span class="keywordflow">if</span> (e-&gt;ring.channel == -1 || PRI_CHANNEL(e-&gt;ring.channel) == 0xFF) {</div><div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;      <span class="comment">/* Any channel requested. */</span></div><div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;      chanpos = pri_find_empty_chan(pri, 1);</div><div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;      <span class="keywordflow">if</span> (-1 &lt; chanpos) {</div><div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;         callid = func_pri_dchannel_new_callid();</div><div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;      }</div><div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PRI_CHANNEL(e-&gt;ring.channel) == 0x00) {</div><div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;      <span class="comment">/* No channel specified. */</span></div><div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;allow_call_waiting_calls)</div><div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;      {</div><div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;         <span class="comment">/* We will not accept incoming call waiting calls. */</span></div><div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;         pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call, PRI_CAUSE_NORMAL_CIRCUIT_CONGESTION);</div><div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;         <span class="keywordflow">goto</span> setup_exit;</div><div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;      }</div><div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;      chanpos = pri_find_empty_nobch(pri);</div><div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;      <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;         <span class="comment">/* We could not find/create a call interface. */</span></div><div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;         pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call, PRI_CAUSE_NORMAL_CIRCUIT_CONGESTION);</div><div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;         <span class="keywordflow">goto</span> setup_exit;</div><div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;      }</div><div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;</div><div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;      callid = func_pri_dchannel_new_callid();</div><div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;</div><div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;      <span class="comment">/* Setup the call interface to use. */</span></div><div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;      sig_pri_init_config(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], pri);</div><div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;      <span class="comment">/* A channel is specified. */</span></div><div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160;      callid = func_pri_dchannel_new_callid();</div><div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;      chanpos = pri_find_principle(pri, e-&gt;ring.channel, e-&gt;ring.call);</div><div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;      <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;            <span class="stringliteral">&quot;Span %d: SETUP on unconfigured channel %d/%d\n&quot;</span>,</div><div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, PRI_SPAN(e-&gt;ring.channel), PRI_CHANNEL(e-&gt;ring.channel));</div><div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160;         <span class="keywordflow">switch</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a>) {</div><div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3">SIG_PRI_RESET_IDLE</a>:</div><div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaad73773a22eaed64af27f4c0905f239dc">SIG_PRI_RESET_ACTIVE</a>:</div><div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;<span class="comment">             * The peer may have lost the expected ack or not received the</span></div><div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160;<span class="comment">             * RESTART yet.</span></div><div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaa815b45d62e77504ff9ed13d69b4f3710">SIG_PRI_RESET_NO_ACK</a>;</div><div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaa815b45d62e77504ff9ed13d69b4f3710">SIG_PRI_RESET_NO_ACK</a>:</div><div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;            <span class="comment">/* The peer likely is not going to ack the RESTART. */</span></div><div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1,</div><div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;               <span class="stringliteral">&quot;Span %d: Second SETUP while waiting for RESTART ACKNOWLEDGE on channel %d/%d\n&quot;</span>,</div><div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, PRI_SPAN(e-&gt;ring.channel), PRI_CHANNEL(e-&gt;ring.channel));</div><div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;</div><div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;            <span class="comment">/* Assume we got the ack. */</span></div><div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3">SIG_PRI_RESET_IDLE</a>;</div><div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a>) {</div><div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;               <span class="comment">/* Go on to the next idle channel to RESTART. */</span></div><div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;               pri_check_restart(pri);</div><div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;            }</div><div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;         }</div><div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6c/sig__pri_8h.html#a03805c1c05301a1e86967ad671dec748">sig_pri_is_chan_available</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos])) {</div><div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;            <span class="comment">/* This is where we handle initial glare */</span></div><div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1,</div><div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;               <span class="stringliteral">&quot;Span %d: SETUP requested unavailable channel %d/%d.  Attempting to renegotiate.\n&quot;</span>,</div><div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, PRI_SPAN(e-&gt;ring.channel), PRI_CHANNEL(e-&gt;ring.channel));</div><div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;            chanpos = -1;</div><div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;         }</div><div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;      }</div><div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;<span class="preprocessor">#if defined(ALWAYS_PICK_CHANNEL)</span></div><div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;      <span class="keywordflow">if</span> (e-&gt;ring.flexible) {</div><div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;         chanpos = -1;</div><div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;      }</div><div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(ALWAYS_PICK_CHANNEL) */</span><span class="preprocessor"></span></div><div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;      <span class="keywordflow">if</span> (chanpos &lt; 0 &amp;&amp; e-&gt;ring.flexible) {</div><div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160;         <span class="comment">/* We can try to pick another channel. */</span></div><div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;         chanpos = pri_find_empty_chan(pri, 1);</div><div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;      }</div><div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;   }</div><div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;   <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160;      <span class="keywordflow">if</span> (e-&gt;ring.flexible) {</div><div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;         pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call, PRI_CAUSE_NORMAL_CIRCUIT_CONGESTION);</div><div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;         pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call, PRI_CAUSE_REQUESTED_CHAN_UNAVAIL);</div><div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;      }</div><div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;      <span class="keywordflow">goto</span> setup_exit;</div><div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;   }</div><div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160;</div><div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;   sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;</div><div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;   <span class="comment">/* Mark channel as in use so noone else will steal it. */</span></div><div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;   pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = e-&gt;ring.call;</div><div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;</div><div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;   <span class="comment">/* Use plancallingnum as a scratch buffer since it is initialized next. */</span></div><div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;   apply_plan_to_existing_number(plancallingnum, <span class="keyword">sizeof</span>(plancallingnum), pri,</div><div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;      e-&gt;ring.redirectingnum, e-&gt;ring.callingplanrdnis);</div><div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;   sig_pri_set_rdnis(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], plancallingnum);</div><div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;</div><div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;   <span class="comment">/* Setup caller-id info */</span></div><div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160;   apply_plan_to_existing_number(plancallingnum, <span class="keyword">sizeof</span>(plancallingnum), pri,</div><div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;      e-&gt;ring.callingnum, e-&gt;ring.callingplan);</div><div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;   pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9540aaac76be952860ef25d607eb33fb">cid_ani2</a> = 0;</div><div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aee1feef8ad729d208a3ab28f0de46658">use_callerid</a>) {</div><div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;      <a class="code" href="../../de/d47/callerid_8h.html#a6a61669b28d0f994e44db5e3baab6ef2">ast_shrink_phone_number</a>(plancallingnum);</div><div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, plancallingnum,</div><div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;         <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>));</div><div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;<span class="preprocessor">#ifdef PRI_ANI</span></div><div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;      apply_plan_to_existing_number(plancallingani, <span class="keyword">sizeof</span>(plancallingani),</div><div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;         pri, e-&gt;ring.callingani, e-&gt;ring.callingplanani);</div><div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;      <a class="code" href="../../de/d47/callerid_8h.html#a6a61669b28d0f994e44db5e3baab6ef2">ast_shrink_phone_number</a>(plancallingani);</div><div class="line"><a name="l06019"></a><span class="lineno"> 6019</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af1b1c1bbbca6309f8fe1071cd27aff80">cid_ani</a>, plancallingani,</div><div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;         <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af1b1c1bbbca6309f8fe1071cd27aff80">cid_ani</a>));</div><div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a16348e587eb42db97d2169c6c11ebe46">cid_subaddr</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SUBADDR)</span></div><div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;      <span class="keywordflow">if</span> (e-&gt;ring.calling.subaddress.valid) {</div><div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d7/d41/structast__party__subaddress.html">ast_party_subaddress</a> calling_subaddress;</div><div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;</div><div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a40230121458bf94386b685b2e3270880">ast_party_subaddress_init</a>(&amp;calling_subaddress);</div><div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;         sig_pri_set_subaddress(&amp;calling_subaddress,</div><div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;            &amp;e-&gt;ring.calling.subaddress);</div><div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;         <span class="keywordflow">if</span> (calling_subaddress.str) {</div><div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a16348e587eb42db97d2169c6c11ebe46">cid_subaddr</a>,</div><div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;               calling_subaddress.str,</div><div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;               <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a16348e587eb42db97d2169c6c11ebe46">cid_subaddr</a>));</div><div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;         }</div><div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#adaa84a3e1b57ef0c912b57699fc0ddc9">ast_party_subaddress_free</a>(&amp;calling_subaddress);</div><div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;      }</div><div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* defined(HAVE_PRI_SUBADDR) */</span><span class="preprocessor"></span></div><div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, e-&gt;ring.callingname,</div><div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;         <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>));</div><div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;      <span class="comment">/* this is the callingplan (TON/NPI), e-&gt;ring.callingplan&gt;&gt;4 would be the TON */</span></div><div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aff456ca48d31a9813584e799064cf88e">cid_ton</a> = e-&gt;ring.callingplan;</div><div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#abd29b99884a9fc8a54fc021555190fb8">callingpres</a> = e-&gt;ring.callingpres;</div><div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160;      <span class="keywordflow">if</span> (e-&gt;ring.ani2 &gt;= 0) {</div><div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9540aaac76be952860ef25d607eb33fb">cid_ani2</a> = e-&gt;ring.ani2;</div><div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160;      }</div><div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a16348e587eb42db97d2169c6c11ebe46">cid_subaddr</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af1b1c1bbbca6309f8fe1071cd27aff80">cid_ani</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aff456ca48d31a9813584e799064cf88e">cid_ton</a> = 0;</div><div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#abd29b99884a9fc8a54fc021555190fb8">callingpres</a> = 0;</div><div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;   }</div><div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;</div><div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;   <span class="comment">/* Setup the user tag for party id&#39;s from this device for this call. */</span></div><div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a798fd91893ed411125afa28a5a7addc7">append_msn_to_user_tag</a>) {</div><div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;      <span class="keywordtype">int</span> len = snprintf(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>,</div><div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;         <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>), <span class="stringliteral">&quot;%s_%s&quot;</span>,</div><div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#af985df4218702eebfb4949ccd29657ca">initial_user_tag</a>,</div><div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">nodetype</a> == PRI_NETWORK</div><div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;            ? plancallingnum : e-&gt;ring.callednum);</div><div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;      <span class="keywordflow">if</span> (len &gt;= <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>)) {</div><div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;user_tag &#39;%s&#39; truncated\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>);</div><div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;      }</div><div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>,</div><div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#af985df4218702eebfb4949ccd29657ca">initial_user_tag</a>, <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>));</div><div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;   }</div><div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;</div><div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160;   sig_pri_set_caller_id(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;</div><div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;   <span class="comment">/* Set DNID on all incoming calls -- even immediate */</span></div><div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;   sig_pri_set_dnid(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], e-&gt;ring.callednum);</div><div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;</div><div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a04e3105c0481dfd78913d4bc9796f1c3">immediate</a>) {</div><div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;      <span class="comment">/* immediate=yes go to s|1 */</span></div><div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Going to extension s|1 because of immediate=yes\n&quot;</span>);</div><div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>[0] = <span class="charliteral">&#39;s&#39;</span>;</div><div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>[1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(e-&gt;ring.callednum)) {</div><div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;      <span class="comment">/* Get called number */</span></div><div class="line"><a name="l06082"></a><span class="lineno"> 6082</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>, e-&gt;ring.callednum,</div><div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;         <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>));</div><div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">overlapdial</a>) {</div><div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;      <span class="comment">/* Some PRI circuits are set up to send _no_ digits.  Handle them as &#39;s&#39;. */</span></div><div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>[0] = <span class="charliteral">&#39;s&#39;</span>;</div><div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>[1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;   }</div><div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;   <span class="comment">/* No number yet, but received &quot;sending complete&quot;? */</span></div><div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;   <span class="keywordflow">if</span> (e-&gt;ring.complete &amp;&amp; (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(e-&gt;ring.callednum))) {</div><div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Going to extension s|1 because of Complete received\n&quot;</span>);</div><div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>[0] = <span class="charliteral">&#39;s&#39;</span>;</div><div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>[1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;   }</div><div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160;</div><div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;   <span class="comment">/* Make sure extension exists (or in overlap dial mode, can exist) */</span></div><div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;   exten_exists_or_can_exist = ((pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">overlapdial</a> &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>)</div><div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;      &amp;&amp; <a class="code" href="../../db/de0/pbx_8h.html#a93f9868530c1e8a9d9d367d1ead8782e">ast_canmatch_extension</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>,</div><div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>, 1, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>))</div><div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;         || <a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>,</div><div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>, 1, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>);</div><div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;   <span class="keywordflow">if</span> (!exten_exists_or_can_exist) {</div><div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,</div><div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;         <span class="stringliteral">&quot;Span %d: Extension %s@%s does not exist.  Rejecting call from &#39;%s&#39;.\n&quot;</span>,</div><div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>,</div><div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>);</div><div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160;      pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call, PRI_CAUSE_UNALLOCATED);</div><div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;      sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;      sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;      <span class="keywordflow">goto</span> setup_exit;</div><div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;   }</div><div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;</div><div class="line"><a name="l06117"></a><span class="lineno"> 6117</span>&#160;   <span class="comment">/* Select audio companding mode. */</span></div><div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;   <span class="keywordflow">switch</span> (e-&gt;ring.layer1) {</div><div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;   <span class="keywordflow">case</span> PRI_LAYER_1_ALAW:</div><div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;      law = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0521b3661ec0c6d0b664abe98f84c5baab76a82ed2436d4803b139cdcf4099d82">SIG_PRI_ALAW</a>;</div><div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;   <span class="keywordflow">case</span> PRI_LAYER_1_ULAW:</div><div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160;      law = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0521b3661ec0c6d0b664abe98f84c5baa580981a034a497c0a43e3c7b5eef227d">SIG_PRI_ULAW</a>;</div><div class="line"><a name="l06124"></a><span class="lineno"> 6124</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;      <span class="comment">/* This is a data call to us. */</span></div><div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160;      law = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0521b3661ec0c6d0b664abe98f84c5baa1fc5b46fc67021e72dfeb033aeab982b">SIG_PRI_DEFLAW</a>;</div><div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;   }</div><div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;</div><div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;   could_match_more = !e-&gt;ring.complete</div><div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;      &amp;&amp; (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">overlapdial</a> &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>)</div><div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;      &amp;&amp; <a class="code" href="../../db/de0/pbx_8h.html#ac359af75b9494f50904583d2168a7577">ast_matchmore_extension</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>,</div><div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>, 1, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>);</div><div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;</div><div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;   need_dialtone = could_match_more</div><div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;<span class="comment">       * Must explicitly check the digital capability this</span></div><div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;<span class="comment">       * way instead of checking the pvt-&gt;digital flag</span></div><div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;<span class="comment">       * because the flag hasn&#39;t been set yet.</span></div><div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;      &amp;&amp; !(e-&gt;ring.ctype &amp; <a class="code" href="../../d7/d86/transcap_8h.html#a70df930118839f3fc035fc9f15dfa621">AST_TRANS_CAP_DIGITAL</a>)</div><div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;      &amp;&amp; !pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a></div><div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;      &amp;&amp; (!strlen(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>)</div><div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;         || <a class="code" href="../../db/de0/pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3">ast_ignore_pattern</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>,</div><div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>));</div><div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;</div><div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;   <span class="keywordflow">if</span> (e-&gt;ring.complete || !(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">overlapdial</a> &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>)) {</div><div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;      <span class="comment">/* Just announce proceeding */</span></div><div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a60273beaf5da6262358cc2add8aa2765">SIG_PRI_CALL_LEVEL_PROCEEDING</a>;</div><div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;      pri_proceeding(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call, PVT_TO_CHANNEL(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]), 0);</div><div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3308f9fadc7b0c6c044b363e9bd731ae">switchtype</a> == PRI_SWITCH_GR303_TMC) {</div><div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822">SIG_PRI_CALL_LEVEL_CONNECT</a>;</div><div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;      pri_answer(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call, PVT_TO_CHANNEL(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]), 1);</div><div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a56a6bdb3a08f47f53f414ba014b47980">SIG_PRI_CALL_LEVEL_OVERLAP</a>;</div><div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SETUP_ACK_INBAND)</span></div><div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;      pri_setup_ack(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call,</div><div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;         PVT_TO_CHANNEL(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]), 1, need_dialtone);</div><div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* !defined(HAVE_PRI_SETUP_ACK_INBAND) */</span><span class="preprocessor"></span></div><div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;      pri_need_more_info(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call,</div><div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;         PVT_TO_CHANNEL(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]), 1);</div><div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* !defined(HAVE_PRI_SETUP_ACK_INBAND) */</span><span class="preprocessor"></span></div><div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;   }</div><div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;</div><div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;<span class="comment">    * Release the PRI lock while we create the channel so other</span></div><div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;<span class="comment">    * threads can send D channel messages.  We must also release</span></div><div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;<span class="comment">    * the private lock to prevent deadlock while creating the</span></div><div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;<span class="comment">    * channel.</span></div><div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;   sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;   c = sig_pri_new_ast_channel(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos],</div><div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;      could_match_more ? <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a> : <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>, law, e-&gt;ring.ctype,</div><div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;   sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06179"></a><span class="lineno"> 6179</span>&#160;</div><div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;   <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160;      setup_incoming_channel(pri, chanpos, e);</div><div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;</div><div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;      <span class="comment">/* Start PBX */</span></div><div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;      <span class="keywordflow">if</span> (could_match_more) {</div><div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;<span class="preprocessor">#if !defined(HAVE_PRI_SETUP_ACK_INBAND)</span></div><div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;         <span class="keywordflow">if</span> (need_dialtone) {</div><div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;            <span class="comment">/* Indicate that we are providing dialtone. */</span></div><div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> = 1;<span class="comment">/* No need to send plain PROGRESS again. */</span></div><div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;<span class="preprocessor">#ifdef HAVE_PRI_PROG_W_CAUSE</span></div><div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160;            pri_progress_with_cause(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call,</div><div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160;               PVT_TO_CHANNEL(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]), 1, -1);<span class="comment">/* no cause at all */</span></div><div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;            pri_progress(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call,</div><div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;               PVT_TO_CHANNEL(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]), 1);</div><div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;         }</div><div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* !defined(HAVE_PRI_SETUP_ACK_INBAND) */</span><span class="preprocessor"></span></div><div class="line"><a name="l06198"></a><span class="lineno"> 6198</span>&#160;</div><div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d60/utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;threadid, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pri_ss_thread,</div><div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos])) {</div><div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Accepting overlap call from &#39;%s&#39; to &#39;%s&#39; on channel %d/%d, span %d\n&quot;</span>,</div><div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;               plancallingnum, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="stringliteral">&quot;&lt;unspecified&gt;&quot;</span>),</div><div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>,</div><div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06206"></a><span class="lineno"> 6206</span>&#160;            <span class="keywordflow">goto</span> setup_exit;</div><div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;         }</div><div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../db/de0/pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5">ast_pbx_start</a>(c)) {</div><div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Accepting call from &#39;%s&#39; to &#39;%s&#39; on channel %d/%d, span %d\n&quot;</span>,</div><div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;               plancallingnum, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>,</div><div class="line"><a name="l06212"></a><span class="lineno"> 6212</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>,</div><div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160;            sig_pri_set_echocanceller(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], 1);</div><div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;            <span class="keywordflow">goto</span> setup_exit;</div><div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;         }</div><div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;      }</div><div class="line"><a name="l06219"></a><span class="lineno"> 6219</span>&#160;   }</div><div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start PBX on channel %d/%d, span %d\n&quot;</span>,</div><div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;   <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;      <span class="comment">/* Avoid deadlock while destroying channel */</span></div><div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160;      sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(c);</div><div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;      pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;ring.call, PRI_CAUSE_SWITCH_CONGESTION);</div><div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;      sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;      sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;   }</div><div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;</div><div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;setup_exit:;</div><div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;   <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a9e325f2d0c2872627a05feff17423f80">ast_callid_threadassoc_remove</a>();</div><div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;   }</div><div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160;}</div><div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;</div><div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *pri_dchannel(<span class="keywordtype">void</span> *vpri)</div><div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;{</div><div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri = vpri;</div><div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;   pri_event *e;</div><div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160;   <span class="keyword">struct </span>pollfd fds[SIG_PRI_NUM_DCHANS];</div><div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;   <span class="keywordtype">int</span> x;</div><div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;   <span class="keyword">struct </span>timeval tv, lowest, *next;</div><div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;   <span class="keywordtype">int</span> doidling=0;</div><div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;   <span class="keywordtype">char</span> *cc;</div><div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160;   time_t t;</div><div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;   <span class="keywordtype">int</span> i, which=-1;</div><div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;   <span class="keywordtype">int</span> numdchans;</div><div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;   <span class="keyword">struct </span>timeval lastidle = { 0, 0 };</div><div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160;   pthread_t p;</div><div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *idle;</div><div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;   <span class="keywordtype">char</span> idlen[128];</div><div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;   <span class="keywordtype">int</span> nextidle = -1;</div><div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;   <span class="keywordtype">int</span> haveidles;</div><div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;   <span class="keywordtype">int</span> activeidles;</div><div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;</div><div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;   gettimeofday(&amp;lastidle, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;   pthread_setcancelstate(PTHREAD_CANCEL_DISABLE, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;</div><div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#af75747551b37515dbfc2a60a6ed24dee">idledial</a>) &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a16be7012a9efbe71bd98228d48c7c89b">idleext</a>)) {</div><div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;      <span class="comment">/* Need to do idle dialing, check to be sure though */</span></div><div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;      cc = strchr(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a16be7012a9efbe71bd98228d48c7c89b">idleext</a>, <span class="charliteral">&#39;@&#39;</span>);</div><div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;      <span class="keywordflow">if</span> (cc) {</div><div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;         *cc = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;         cc++;</div><div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aab9ab1e6f772f75d5f179e4ecf57d830">idlecontext</a>, cc, <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aab9ab1e6f772f75d5f179e4ecf57d830">idlecontext</a>));</div><div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;         <span class="comment">/* Extensions may not be loaded yet */</span></div><div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aab9ab1e6f772f75d5f179e4ecf57d830">idlecontext</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a16be7012a9efbe71bd98228d48c7c89b">idleext</a>, 1, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))</div><div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Extension &#39;%s @ %s&#39; does not exist\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a16be7012a9efbe71bd98228d48c7c89b">idleext</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aab9ab1e6f772f75d5f179e4ecf57d830">idlecontext</a>);</div><div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;            doidling = 1;</div><div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Idle dial string &#39;%s&#39; lacks &#39;@context&#39;\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a16be7012a9efbe71bd98228d48c7c89b">idleext</a>);</div><div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160;   }</div><div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> callid = 0;</div><div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;</div><div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; i++) {</div><div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;         <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i])</div><div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;         fds[i].fd = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i];</div><div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;         fds[i].events = POLLIN | POLLPRI;</div><div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;         fds[i].revents = 0;</div><div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;      }</div><div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;      numdchans = i;</div><div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;      time(&amp;t);</div><div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3308f9fadc7b0c6c044b363e9bd731ae">switchtype</a> != PRI_SWITCH_GR303_TMC &amp;&amp; (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="../../d5/db3/chan__dahdi_8h.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>) &amp;&amp; (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a095eb5749876ec9c9f28a5dab2bf05b0">resetinterval</a> &gt; 0)) {</div><div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;         <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a> &amp;&amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0c585919b853d8ccef6d54422f289f2b">pri_is_up</a>(pri)) {</div><div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a> &lt; 0) {</div><div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;               pri_check_restart(pri);</div><div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a>) {</div><div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;                  sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;               }</div><div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;            }</div><div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;            <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a>  &amp;&amp; (t - pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae752c5957f8323851102513cd35837b1">lastreset</a>) &gt;= pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a095eb5749876ec9c9f28a5dab2bf05b0">resetinterval</a>) {</div><div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a> = 1;</div><div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a> = -1;</div><div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;            }</div><div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;         }</div><div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;      }</div><div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;      <span class="comment">/* Look for any idle channels if appropriate */</span></div><div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;      <span class="keywordflow">if</span> (doidling &amp;&amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0c585919b853d8ccef6d54422f289f2b">pri_is_up</a>(pri)) {</div><div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;         nextidle = -1;</div><div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;         haveidles = 0;</div><div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;         activeidles = 0;</div><div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;         <span class="keywordflow">for</span> (x = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; x &gt;= 0; x--) {</div><div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x] &amp;&amp; !pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a>) {</div><div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a03805c1c05301a1e86967ad671dec748">sig_pri_is_chan_available</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x])) {</div><div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;                  <span class="keywordflow">if</span> (haveidles &lt; pri-&gt;minunused) {</div><div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;                     haveidles++;</div><div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;                  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;                     nextidle = <a class="code" href="../../df/d3c/structast__channel.html#ab06e9aa782b61ccfb42f7c48996f6ed4">x</a>;</div><div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;                  }</div><div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aea53d06676b28028fe5faeb3e2124fde">isidlecall</a>) {</div><div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;                  activeidles++;</div><div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160;               }</div><div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;            }</div><div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;         }</div><div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;         <span class="keywordflow">if</span> (nextidle &gt; -1) {</div><div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), lastidle) &gt; 1000) {</div><div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160;               <span class="comment">/* Don&#39;t create a new idle call more than once per second */</span></div><div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;               snprintf(idlen, <span class="keyword">sizeof</span>(idlen), <span class="stringliteral">&quot;%d/%s&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[nextidle]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#af75747551b37515dbfc2a60a6ed24dee">idledial</a>);</div><div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[nextidle]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a44ac4c6a3693f3d2fa34a50428e42237">allocated</a> = 1;</div><div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;<span class="comment">                * Release the PRI lock while we create the channel so other</span></div><div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;<span class="comment">                * threads can send D channel messages.</span></div><div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;               <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;<span class="comment">                * We already have the B channel reserved for this call.  We</span></div><div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;<span class="comment">                * just need to make sure that sig_pri_hangup() has completed</span></div><div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;<span class="comment">                * cleaning up before continuing.</span></div><div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;               sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[nextidle]);</div><div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;               sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[nextidle]);</div><div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160;               idle = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0f304fe6c585e80cb10fd235d35b17f2">sig_pri_request</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[nextidle], <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0521b3661ec0c6d0b664abe98f84c5baa580981a034a497c0a43e3c7b5eef227d">SIG_PRI_ULAW</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;               <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;               <span class="keywordflow">if</span> (idle) {</div><div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[nextidle]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aea53d06676b28028fe5faeb3e2124fde">isidlecall</a> = 1;</div><div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;                  <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;p, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, do_idle_thread, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[nextidle])) {</div><div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;                     <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start new thread for idle channel &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(idle));</div><div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;                     <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;                     <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(idle);</div><div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;                     <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;                  }</div><div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[nextidle]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a44ac4c6a3693f3d2fa34a50428e42237">allocated</a> = 0;</div><div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to request channel &#39;DAHDI/%s&#39; for idle call\n&quot;</span>, idlen);</div><div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;               }</div><div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;               gettimeofday(&amp;lastidle, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;            }</div><div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((haveidles &lt; pri-&gt;minunused) &amp;&amp;</div><div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;            (activeidles &gt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a6d2c2c9d0c6665ccf044be9f3caddee8">minidle</a>)) {</div><div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;            <span class="comment">/* Mark something for hangup if there is something</span></div><div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;<span class="comment">               that can be hungup */</span></div><div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;            <span class="keywordflow">for</span> (x = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; x &gt;= 0; x--) {</div><div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;               <span class="comment">/* find a candidate channel */</span></div><div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x] &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aea53d06676b28028fe5faeb3e2124fde">isidlecall</a>) {</div><div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#ab683c21c4a34450c4bfb8b672a7b4045">ast_channel_softhangup_internal_flag_add</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);</div><div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160;                  haveidles++;</div><div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;                  <span class="comment">/* Stop if we have enough idle channels or</span></div><div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;<span class="comment">                    can&#39;t spare any more active idle ones */</span></div><div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;                  <span class="keywordflow">if</span> ((haveidles &gt;= pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a40d80acf78e1e7c7ece36c153c1d6a5f">minunused</a>) ||</div><div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;                     (activeidles &lt;= pri-&gt;minidle))</div><div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l06377"></a><span class="lineno"> 6377</span>&#160;               }</div><div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;            }</div><div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;         }</div><div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;      }</div><div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160;      <span class="comment">/* Start with reasonable max */</span></div><div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;      <span class="keywordflow">if</span> (doidling || pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a>) {</div><div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;<span class="comment">          * Make sure we stop at least once per second if we&#39;re</span></div><div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;<span class="comment">          * monitoring idle channels</span></div><div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;         lowest = <a class="code" href="../../de/df7/time_8h.html#aebf04439f206cc509472ce4b6da48a5a">ast_tv</a>(1, 0);</div><div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;         <span class="comment">/* Don&#39;t poll for more than 60 seconds */</span></div><div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;         lowest = <a class="code" href="../../de/df7/time_8h.html#aebf04439f206cc509472ce4b6da48a5a">ast_tv</a>(60, 0);</div><div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;      }</div><div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; i++) {</div><div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;         <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i]) {</div><div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;            <span class="comment">/* We scanned all D channels on this span. */</span></div><div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;         }</div><div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;         next = pri_schedule_next(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i]);</div><div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;         <span class="keywordflow">if</span> (next) {</div><div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;            <span class="comment">/* We need relative time here */</span></div><div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;            tv = <a class="code" href="../../de/df7/time_8h.html#aa13b651c18bc6004cab21ac041d44dd8">ast_tvsub</a>(*next, <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>());</div><div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;            <span class="keywordflow">if</span> (tv.tv_sec &lt; 0) {</div><div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;<span class="comment">                * A timer has already expired.</span></div><div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;<span class="comment">                * By definition zero time is the lowest so we can quit early.</span></div><div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160;               lowest = <a class="code" href="../../de/df7/time_8h.html#aebf04439f206cc509472ce4b6da48a5a">ast_tv</a>(0, 0);</div><div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160;            }</div><div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a>(tv, lowest) &lt; 0) {</div><div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;               lowest = tv;</div><div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160;            }</div><div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;         }</div><div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;      }</div><div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;</div><div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;      pthread_setcancelstate(PTHREAD_CANCEL_ENABLE, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160;      pthread_testcancel();</div><div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;      e = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;      res = poll(fds, numdchans, lowest.tv_sec * 1000 + lowest.tv_usec / 1000);</div><div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;      pthread_testcancel();</div><div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;      pthread_setcancelstate(PTHREAD_CANCEL_DISABLE, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;</div><div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160;      <span class="keywordflow">if</span> (!res) {</div><div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;         <span class="keywordflow">for</span> (which = 0; which &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; which++) {</div><div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;            <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[which])</div><div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;            <span class="comment">/* Just a timeout, run the scheduler */</span></div><div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;            e = pri_schedule_run(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[which]);</div><div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;            <span class="keywordflow">if</span> (e)</div><div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;         }</div><div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res &gt; -1) {</div><div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160;         <span class="keywordflow">for</span> (which = 0; which &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; which++) {</div><div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;            <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[which])</div><div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;            <span class="keywordflow">if</span> (fds[which].revents &amp; POLLPRI) {</div><div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160;               sig_pri_handle_dchan_exception(pri, which);</div><div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fds[which].revents &amp; POLLIN) {</div><div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160;               e = pri_check_event(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[which]);</div><div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;            }</div><div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160;            <span class="keywordflow">if</span> (e)</div><div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;</div><div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> != 0) &amp;&amp; (<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> != EINTR)) {</div><div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;pri_check_event returned error %d (%s)\n&quot;</span>,</div><div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;                  <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l06448"></a><span class="lineno"> 6448</span>&#160;            }</div><div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> == ENODEV) {</div><div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;               pri_destroy_later(pri);</div><div class="line"><a name="l06451"></a><span class="lineno"> 6451</span>&#160;            }</div><div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;         }</div><div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> != EINTR)</div><div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;pri_event returned error %d (%s)\n&quot;</span>, <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160;</div><div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;      <span class="keywordflow">if</span> (e) {</div><div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;         <span class="keywordtype">int</span> chanpos = -1;</div><div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;         <span class="keywordtype">char</span> cause_str[36];</div><div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;</div><div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;         <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) {</div><div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;            <a class="code" href="../../d4/dc5/extconf_8c.html#a81d26348827b996085d4cb6be3e2c348">ast_verbose</a>(<span class="stringliteral">&quot;Span %d: Processing event %s(%d)\n&quot;</span>,</div><div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri_event2str(e-&gt;e), e-&gt;e);</div><div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160;         }</div><div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;</div><div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;         <span class="keywordflow">if</span> (e-&gt;e != PRI_EVENT_DCHAN_DOWN) {</div><div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;            <span class="keywordflow">if</span> (!(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">dchanavail</a>[which] &amp; DCHAN_UP)) {</div><div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;%s D-Channel on span %d up\n&quot;</span>, pri_order(which), pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06468"></a><span class="lineno"> 6468</span>&#160;            }</div><div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">dchanavail</a>[which] |= DCHAN_UP;</div><div class="line"><a name="l06470"></a><span class="lineno"> 6470</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06471"></a><span class="lineno"> 6471</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">dchanavail</a>[which] &amp; DCHAN_UP) {</div><div class="line"><a name="l06472"></a><span class="lineno"> 6472</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;%s D-Channel on span %d down\n&quot;</span>, pri_order(which), pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06473"></a><span class="lineno"> 6473</span>&#160;            }</div><div class="line"><a name="l06474"></a><span class="lineno"> 6474</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">dchanavail</a>[which] &amp;= ~DCHAN_UP;</div><div class="line"><a name="l06475"></a><span class="lineno"> 6475</span>&#160;         }</div><div class="line"><a name="l06476"></a><span class="lineno"> 6476</span>&#160;</div><div class="line"><a name="l06477"></a><span class="lineno"> 6477</span>&#160;         <span class="keywordflow">if</span> ((e-&gt;e != PRI_EVENT_DCHAN_UP) &amp;&amp; (e-&gt;e != PRI_EVENT_DCHAN_DOWN) &amp;&amp; (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a> != pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[which]))</div><div class="line"><a name="l06478"></a><span class="lineno"> 6478</span>&#160;            <span class="comment">/* Must be an NFAS group that has the secondary dchan active */</span></div><div class="line"><a name="l06479"></a><span class="lineno"> 6479</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a> = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[which];</div><div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;</div><div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160;         <span class="keywordflow">switch</span> (e-&gt;e) {</div><div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_DCHAN_UP:</div><div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#aa0e541bb0229ec83998375ddec7d4704">no_d_channels</a> = 0;</div><div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;            <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>) {</div><div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;               pri_find_dchan(pri);</div><div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;            }</div><div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;</div><div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;            <span class="comment">/* Note presense of D-channel */</span></div><div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;            time(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae752c5957f8323851102513cd35837b1">lastreset</a>);</div><div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160;</div><div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;            <span class="comment">/* Restart in 5 seconds */</span></div><div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a095eb5749876ec9c9f28a5dab2bf05b0">resetinterval</a> &gt; -1) {</div><div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae752c5957f8323851102513cd35837b1">lastreset</a> -= pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a095eb5749876ec9c9f28a5dab2bf05b0">resetinterval</a>;</div><div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae752c5957f8323851102513cd35837b1">lastreset</a> += 5;</div><div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;            }</div><div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160;            <span class="comment">/* Take the channels from inalarm condition */</span></div><div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a> = 0;</div><div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;            <span class="keywordflow">for</span> (i = 0; i &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; i++) {</div><div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[i]) {</div><div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;                  <a class="code" href="../../d7/d6c/sig__pri_8h.html#aefda8988d1ad788713126dbeb4d002ec">sig_pri_set_alarm</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[i], 0);</div><div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;               }</div><div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;            }</div><div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;            sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_DCHAN_DOWN:</div><div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;            pri_find_dchan(pri);</div><div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6c/sig__pri_8h.html#a0c585919b853d8ccef6d54422f289f2b">pri_is_up</a>(pri)) {</div><div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="../../d5/db3/chan__dahdi_8h.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>) {</div><div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;                  <span class="comment">/*</span></div><div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;<span class="comment">                   * For PTMP connections with non-persistent layer 2 we want to</span></div><div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160;<span class="comment">                   * *not* declare inalarm unless there actually is an alarm.</span></div><div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160;<span class="comment">                   */</span></div><div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;               }</div><div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;               <span class="comment">/* Hangup active channels and put them in alarm mode */</span></div><div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a> = 0;</div><div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;               <span class="keywordflow">for</span> (i = 0; i &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; i++) {</div><div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;                  <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[i];</div><div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;</div><div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;                  <span class="keywordflow">if</span> (p) {</div><div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;                     <span class="keywordflow">if</span> (pri_get_timer(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, PRI_TIMER_T309) &lt; 0) {</div><div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;                        <span class="comment">/* T309 is not enabled : destroy calls when alarm occurs */</span></div><div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;                        <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>) {</div><div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;                           pri_destroycall(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>);</div><div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;                           p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160;                        }</div><div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;                        <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)</div><div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160;                           <a class="code" href="../../d5/d7b/channel_8h.html#ab683c21c4a34450c4bfb8b672a7b4045">ast_channel_softhangup_internal_flag_add</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);</div><div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160;                     }</div><div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;                     <a class="code" href="../../d7/d6c/sig__pri_8h.html#aefda8988d1ad788713126dbeb4d002ec">sig_pri_set_alarm</a>(p, 1);</div><div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160;                  }</div><div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160;               }</div><div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;               sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;            }</div><div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_RESTART:</div><div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;            <span class="keywordflow">if</span> (e-&gt;restart.channel &gt; -1 &amp;&amp; PRI_CHANNEL(e-&gt;restart.channel) != 0xFF) {</div><div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;               chanpos = pri_find_principle(pri, e-&gt;restart.channel, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;               <span class="keywordflow">if</span> (chanpos &lt; 0)</div><div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160;                     <span class="stringliteral">&quot;Span %d: Restart requested on odd/unavailable channel number %d/%d\n&quot;</span>,</div><div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160;                     pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, PRI_SPAN(e-&gt;restart.channel),</div><div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;                     PRI_CHANNEL(e-&gt;restart.channel));</div><div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160;               <span class="keywordflow">else</span> {</div><div class="line"><a name="l06545"></a><span class="lineno"> 6545</span>&#160;                  <span class="keywordtype">int</span> skipit = 0;</div><div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SERVICE_MESSAGES)</span></div><div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;                  <span class="keywordtype">unsigned</span> why;</div><div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;</div><div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;                  why = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;service_status;</div><div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;                  <span class="keywordflow">if</span> (why) {</div><div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160;                     <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,</div><div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160;                        <span class="stringliteral">&quot;Span %d: Channel %d/%d out-of-service (reason: %s), ignoring RESTART\n&quot;</span>,</div><div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;                        pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, PRI_SPAN(e-&gt;restart.channel),</div><div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;                        PRI_CHANNEL(e-&gt;restart.channel),</div><div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;                        (why &amp; SRVST_FAREND) ? (why &amp; SRVST_NEAREND) ? <span class="stringliteral">&quot;both ends&quot;</span> : <span class="stringliteral">&quot;far end&quot;</span> : <span class="stringliteral">&quot;near end&quot;</span>);</div><div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;                     skipit = 1;</div><div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;                  }</div><div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SERVICE_MESSAGES) */</span><span class="preprocessor"></span></div><div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;                  sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;                  <span class="keywordflow">if</span> (!skipit) {</div><div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;                     <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Span %d: Channel %d/%d restarted\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>,</div><div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;                        PRI_SPAN(e-&gt;restart.channel),</div><div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160;                        PRI_CHANNEL(e-&gt;restart.channel));</div><div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;                     <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>) {</div><div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;                        pri_destroycall(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>);</div><div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160;                        pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;                     }</div><div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160;                  }</div><div class="line"><a name="l06569"></a><span class="lineno"> 6569</span>&#160;                  <span class="comment">/* Force hangup if appropriate */</span></div><div class="line"><a name="l06570"></a><span class="lineno"> 6570</span>&#160;                  sig_pri_queue_hangup(pri, chanpos);</div><div class="line"><a name="l06571"></a><span class="lineno"> 6571</span>&#160;                  sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06572"></a><span class="lineno"> 6572</span>&#160;               }</div><div class="line"><a name="l06573"></a><span class="lineno"> 6573</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06574"></a><span class="lineno"> 6574</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Restart requested on entire span %d\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06575"></a><span class="lineno"> 6575</span>&#160;               <span class="keywordflow">for</span> (x = 0; x &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; x++)</div><div class="line"><a name="l06576"></a><span class="lineno"> 6576</span>&#160;                  <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]) {</div><div class="line"><a name="l06577"></a><span class="lineno"> 6577</span>&#160;                     sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]);</div><div class="line"><a name="l06578"></a><span class="lineno"> 6578</span>&#160;                     <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>) {</div><div class="line"><a name="l06579"></a><span class="lineno"> 6579</span>&#160;                        pri_destroycall(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>);</div><div class="line"><a name="l06580"></a><span class="lineno"> 6580</span>&#160;                        pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160;                     }</div><div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;                     <span class="comment">/* Force hangup if appropriate */</span></div><div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160;                     sig_pri_queue_hangup(pri, x);</div><div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160;                     sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]);</div><div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160;                  }</div><div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;            }</div><div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160;            sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_KEYPAD_DIGIT:</div><div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;digit.channel)) {</div><div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;digit.subcmds,</div><div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160;                  e-&gt;digit.call);</div><div class="line"><a name="l06593"></a><span class="lineno"> 6593</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160;            }</div><div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160;            chanpos = pri_find_principle_by_call(pri, e-&gt;digit.call);</div><div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;                  <span class="stringliteral">&quot;Span %d: Received keypad digits for unknown call.\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160;            }</div><div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160;</div><div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160;</div><div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;digit.subcmds,</div><div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;               e-&gt;digit.call);</div><div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;            <span class="comment">/* queue DTMF frame if the PBX for this call was already started (we&#39;re forwarding KEYPAD_DIGITs further on */</span></div><div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160;            <span class="keywordflow">if</span> ((pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">overlapdial</a> &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>)</div><div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;               &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l06610"></a><span class="lineno"> 6610</span>&#160;               <span class="comment">/* how to do that */</span></div><div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160;               <span class="keywordtype">int</span> digitlen = strlen(e-&gt;digit.digits);</div><div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;               <span class="keywordtype">int</span> i;</div><div class="line"><a name="l06613"></a><span class="lineno"> 6613</span>&#160;</div><div class="line"><a name="l06614"></a><span class="lineno"> 6614</span>&#160;               <span class="keywordflow">for</span> (i = 0; i &lt; digitlen; i++) {</div><div class="line"><a name="l06615"></a><span class="lineno"> 6615</span>&#160;                  <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> f = { <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>, .subclass.integer = e-&gt;digit.digits[i], };</div><div class="line"><a name="l06616"></a><span class="lineno"> 6616</span>&#160;</div><div class="line"><a name="l06617"></a><span class="lineno"> 6617</span>&#160;                  pri_queue_frame(pri, chanpos, &amp;f);</div><div class="line"><a name="l06618"></a><span class="lineno"> 6618</span>&#160;               }</div><div class="line"><a name="l06619"></a><span class="lineno"> 6619</span>&#160;            }</div><div class="line"><a name="l06620"></a><span class="lineno"> 6620</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06621"></a><span class="lineno"> 6621</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06622"></a><span class="lineno"> 6622</span>&#160;</div><div class="line"><a name="l06623"></a><span class="lineno"> 6623</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_INFO_RECEIVED:</div><div class="line"><a name="l06624"></a><span class="lineno"> 6624</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;ring.channel)) {</div><div class="line"><a name="l06625"></a><span class="lineno"> 6625</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;ring.subcmds,</div><div class="line"><a name="l06626"></a><span class="lineno"> 6626</span>&#160;                  e-&gt;ring.call);</div><div class="line"><a name="l06627"></a><span class="lineno"> 6627</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06628"></a><span class="lineno"> 6628</span>&#160;            }</div><div class="line"><a name="l06629"></a><span class="lineno"> 6629</span>&#160;            chanpos = pri_find_principle_by_call(pri, e-&gt;ring.call);</div><div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;                  <span class="stringliteral">&quot;Span %d: Received INFORMATION for unknown call.\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160;            }</div><div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;</div><div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;</div><div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;ring.subcmds, e-&gt;ring.call);</div><div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160;            <span class="comment">/* queue DTMF frame if the PBX for this call was already started (we&#39;re forwarding INFORMATION further on */</span></div><div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;            <span class="keywordflow">if</span> ((pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">overlapdial</a> &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>)</div><div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160;               &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;               <span class="comment">/* how to do that */</span></div><div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;               <span class="keywordtype">int</span> digitlen = strlen(e-&gt;ring.callednum);</div><div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;               <span class="keywordtype">int</span> i;</div><div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;</div><div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160;               <span class="keywordflow">for</span> (i = 0; i &lt; digitlen; i++) {</div><div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160;                  <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> f = { <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>, .subclass.integer = e-&gt;ring.callednum[i], };</div><div class="line"><a name="l06649"></a><span class="lineno"> 6649</span>&#160;</div><div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;                  pri_queue_frame(pri, chanpos, &amp;f);</div><div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160;               }</div><div class="line"><a name="l06652"></a><span class="lineno"> 6652</span>&#160;            }</div><div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SERVICE_MESSAGES)</span></div><div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_SERVICE:</div><div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160;            chanpos = pri_find_principle(pri, e-&gt;service.channel, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Received service change status %d on unconfigured channel %d/%d span %d\n&quot;</span>,</div><div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160;                  e-&gt;service_ack.changestatus, PRI_SPAN(e-&gt;service_ack.channel), PRI_CHANNEL(e-&gt;service_ack.channel), pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06662"></a><span class="lineno"> 6662</span>&#160;               <span class="keywordtype">char</span> db_chan_name[20];</div><div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160;               <span class="keywordtype">char</span> db_answer[15];</div><div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160;               <span class="keywordtype">int</span> ch;</div><div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;               <span class="keywordtype">unsigned</span> *why;</div><div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;</div><div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160;               ch = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>;</div><div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;               snprintf(db_chan_name, <span class="keyword">sizeof</span>(db_chan_name), <span class="stringliteral">&quot;%s/%d:%d&quot;</span>, dahdi_db, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, ch);</div><div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;               why = &amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;service_status;</div><div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;               <span class="keywordflow">switch</span> (e-&gt;service.changestatus) {</div><div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160;               <span class="keywordflow">case</span> 0: <span class="comment">/* in-service */</span></div><div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160;                  <span class="comment">/* Far end wants to be in service now. */</span></div><div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;                  <a class="code" href="../../de/d4a/astdb_8h.html#a71e8d5ab1757b184683a99125d1c8160">ast_db_del</a>(db_chan_name, SRVST_DBKEY);</div><div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;                  *why &amp;= ~SRVST_FAREND;</div><div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;                  <span class="keywordflow">if</span> (*why) {</div><div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160;                     snprintf(db_answer, <span class="keyword">sizeof</span>(db_answer), <span class="stringliteral">&quot;%s:%u&quot;</span>,</div><div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;                        SRVST_TYPE_OOS, *why);</div><div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160;                     <a class="code" href="../../de/d4a/astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a>(db_chan_name, SRVST_DBKEY, db_answer);</div><div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160;                  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06680"></a><span class="lineno"> 6680</span>&#160;                     sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160;                  }</div><div class="line"><a name="l06682"></a><span class="lineno"> 6682</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l06683"></a><span class="lineno"> 6683</span>&#160;               <span class="keywordflow">case</span> 2: <span class="comment">/* out-of-service */</span></div><div class="line"><a name="l06684"></a><span class="lineno"> 6684</span>&#160;                  <span class="comment">/* Far end wants to be out-of-service now. */</span></div><div class="line"><a name="l06685"></a><span class="lineno"> 6685</span>&#160;                  <a class="code" href="../../de/d4a/astdb_8h.html#a71e8d5ab1757b184683a99125d1c8160">ast_db_del</a>(db_chan_name, SRVST_DBKEY);</div><div class="line"><a name="l06686"></a><span class="lineno"> 6686</span>&#160;                  *why |= SRVST_FAREND;</div><div class="line"><a name="l06687"></a><span class="lineno"> 6687</span>&#160;                  snprintf(db_answer, <span class="keyword">sizeof</span>(db_answer), <span class="stringliteral">&quot;%s:%u&quot;</span>, SRVST_TYPE_OOS,</div><div class="line"><a name="l06688"></a><span class="lineno"> 6688</span>&#160;                     *why);</div><div class="line"><a name="l06689"></a><span class="lineno"> 6689</span>&#160;                  <a class="code" href="../../de/d4a/astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a>(db_chan_name, SRVST_DBKEY, db_answer);</div><div class="line"><a name="l06690"></a><span class="lineno"> 6690</span>&#160;                  sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l06691"></a><span class="lineno"> 6691</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l06692"></a><span class="lineno"> 6692</span>&#160;               <span class="keywordflow">default</span>:</div><div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Huh?  changestatus is: %d\n&quot;</span>, e-&gt;service.changestatus);</div><div class="line"><a name="l06694"></a><span class="lineno"> 6694</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;               }</div><div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Channel %d/%d span %d (logical: %d) received a change of service message, status &#39;%d&#39;\n&quot;</span>,</div><div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;                  PRI_SPAN(e-&gt;service.channel), PRI_CHANNEL(e-&gt;service.channel), pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, ch, e-&gt;service.changestatus);</div><div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160;            }</div><div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_SERVICE_ACK:</div><div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160;            chanpos = pri_find_principle(pri, e-&gt;service_ack.channel, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l06703"></a><span class="lineno"> 6703</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Received service acknowledge change status &#39;%d&#39; on unconfigured channel %d/%d span %d\n&quot;</span>,</div><div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;                  e-&gt;service_ack.changestatus, PRI_SPAN(e-&gt;service_ack.channel), PRI_CHANNEL(e-&gt;service_ack.channel), pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Channel %d/%d span %d received a change os service acknowledgement message, status &#39;%d&#39;\n&quot;</span>,</div><div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;                  PRI_SPAN(e-&gt;service_ack.channel), PRI_CHANNEL(e-&gt;service_ack.channel), pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, e-&gt;service_ack.changestatus);</div><div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;            }</div><div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SERVICE_MESSAGES) */</span><span class="preprocessor"></span></div><div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_RING:</div><div class="line"><a name="l06712"></a><span class="lineno"> 6712</span>&#160;            sig_pri_handle_setup(pri, e);</div><div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_RINGING:</div><div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;ringing.channel)) {</div><div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;ringing.subcmds,</div><div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;                  e-&gt;ringing.call);</div><div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;            }</div><div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;            chanpos = pri_find_fixup_principle(pri, e-&gt;ringing.channel,</div><div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160;               e-&gt;ringing.call);</div><div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l06723"></a><span class="lineno"> 6723</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;            }</div><div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06726"></a><span class="lineno"> 6726</span>&#160;</div><div class="line"><a name="l06727"></a><span class="lineno"> 6727</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;</div><div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;ringing.subcmds,</div><div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;               e-&gt;ringing.call);</div><div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;            sig_pri_cc_generic_check(pri, chanpos, <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530aec12fa6bbd080be709806e28f8bade1e">AST_CC_CCNR</a>);</div><div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;            sig_pri_set_echocanceller(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], 1);</div><div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;            sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l06734"></a><span class="lineno"> 6734</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l06735"></a><span class="lineno"> 6735</span>&#160;               <a class="code" href="../../d9/d95/channelstate_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448">ast_setstate</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>);</div><div class="line"><a name="l06736"></a><span class="lineno"> 6736</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l06737"></a><span class="lineno"> 6737</span>&#160;            }</div><div class="line"><a name="l06738"></a><span class="lineno"> 6738</span>&#160;            pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>);</div><div class="line"><a name="l06739"></a><span class="lineno"> 6739</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aadfde2210c446742a8276382cb57a960">SIG_PRI_CALL_LEVEL_ALERTING</a>) {</div><div class="line"><a name="l06740"></a><span class="lineno"> 6740</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aadfde2210c446742a8276382cb57a960">SIG_PRI_CALL_LEVEL_ALERTING</a>;</div><div class="line"><a name="l06741"></a><span class="lineno"> 6741</span>&#160;            }</div><div class="line"><a name="l06742"></a><span class="lineno"> 6742</span>&#160;</div><div class="line"><a name="l06743"></a><span class="lineno"> 6743</span>&#160;            <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a></div><div class="line"><a name="l06744"></a><span class="lineno"> 6744</span>&#160;               &amp;&amp; !pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a></div><div class="line"><a name="l06745"></a><span class="lineno"> 6745</span>&#160;#ifdef PRI_PROGRESS_MASK</div><div class="line"><a name="l06746"></a><span class="lineno"> 6746</span>&#160;               &amp;&amp; (e-&gt;ringing.progressmask</div><div class="line"><a name="l06747"></a><span class="lineno"> 6747</span>&#160;                  &amp; (PRI_PROG_CALL_NOT_E2E_ISDN | PRI_PROG_INBAND_AVAILABLE))</div><div class="line"><a name="l06748"></a><span class="lineno"> 6748</span>&#160;#<span class="keywordflow">else</span></div><div class="line"><a name="l06749"></a><span class="lineno"> 6749</span>&#160;               &amp;&amp; e-&gt;ringing.progress == 8</div><div class="line"><a name="l06750"></a><span class="lineno"> 6750</span>&#160;#endif</div><div class="line"><a name="l06751"></a><span class="lineno"> 6751</span>&#160;               ) {</div><div class="line"><a name="l06752"></a><span class="lineno"> 6752</span>&#160;               <span class="comment">/* Bring voice path up */</span></div><div class="line"><a name="l06753"></a><span class="lineno"> 6753</span>&#160;               pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>);</div><div class="line"><a name="l06754"></a><span class="lineno"> 6754</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> = 1;</div><div class="line"><a name="l06755"></a><span class="lineno"> 6755</span>&#160;               sig_pri_set_dialing(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], 0);</div><div class="line"><a name="l06756"></a><span class="lineno"> 6756</span>&#160;               sig_pri_open_media(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06757"></a><span class="lineno"> 6757</span>&#160;            }</div><div class="line"><a name="l06758"></a><span class="lineno"> 6758</span>&#160;</div><div class="line"><a name="l06759"></a><span class="lineno"> 6759</span>&#160;<span class="preprocessor">#ifdef SUPPORT_USERUSER</span></div><div class="line"><a name="l06760"></a><span class="lineno"> 6760</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(e-&gt;ringing.useruserinfo)) {</div><div class="line"><a name="l06761"></a><span class="lineno"> 6761</span>&#160;               <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner;</div><div class="line"><a name="l06762"></a><span class="lineno"> 6762</span>&#160;</div><div class="line"><a name="l06763"></a><span class="lineno"> 6763</span>&#160;               sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l06764"></a><span class="lineno"> 6764</span>&#160;               owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l06765"></a><span class="lineno"> 6765</span>&#160;               <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l06766"></a><span class="lineno"> 6766</span>&#160;                  <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;USERUSERINFO&quot;</span>,</div><div class="line"><a name="l06767"></a><span class="lineno"> 6767</span>&#160;                     e-&gt;ringing.useruserinfo);</div><div class="line"><a name="l06768"></a><span class="lineno"> 6768</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l06769"></a><span class="lineno"> 6769</span>&#160;               }</div><div class="line"><a name="l06770"></a><span class="lineno"> 6770</span>&#160;            }</div><div class="line"><a name="l06771"></a><span class="lineno"> 6771</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l06772"></a><span class="lineno"> 6772</span>&#160;</div><div class="line"><a name="l06773"></a><span class="lineno"> 6773</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06774"></a><span class="lineno"> 6774</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06775"></a><span class="lineno"> 6775</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_PROGRESS:</div><div class="line"><a name="l06776"></a><span class="lineno"> 6776</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;proceeding.channel)) {</div><div class="line"><a name="l06777"></a><span class="lineno"> 6777</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;proceeding.subcmds,</div><div class="line"><a name="l06778"></a><span class="lineno"> 6778</span>&#160;                  e-&gt;proceeding.call);</div><div class="line"><a name="l06779"></a><span class="lineno"> 6779</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06780"></a><span class="lineno"> 6780</span>&#160;            }</div><div class="line"><a name="l06781"></a><span class="lineno"> 6781</span>&#160;            chanpos = pri_find_fixup_principle(pri, e-&gt;proceeding.channel,</div><div class="line"><a name="l06782"></a><span class="lineno"> 6782</span>&#160;               e-&gt;proceeding.call);</div><div class="line"><a name="l06783"></a><span class="lineno"> 6783</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l06784"></a><span class="lineno"> 6784</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06785"></a><span class="lineno"> 6785</span>&#160;            }</div><div class="line"><a name="l06786"></a><span class="lineno"> 6786</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06787"></a><span class="lineno"> 6787</span>&#160;</div><div class="line"><a name="l06788"></a><span class="lineno"> 6788</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l06789"></a><span class="lineno"> 6789</span>&#160;</div><div class="line"><a name="l06790"></a><span class="lineno"> 6790</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;proceeding.subcmds,</div><div class="line"><a name="l06791"></a><span class="lineno"> 6791</span>&#160;               e-&gt;proceeding.call);</div><div class="line"><a name="l06792"></a><span class="lineno"> 6792</span>&#160;</div><div class="line"><a name="l06793"></a><span class="lineno"> 6793</span>&#160;            <span class="keywordflow">if</span> (e-&gt;proceeding.cause &gt; -1) {</div><div class="line"><a name="l06794"></a><span class="lineno"> 6794</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l06795"></a><span class="lineno"> 6795</span>&#160;                  snprintf(cause_str, <span class="keyword">sizeof</span>(cause_str), <span class="stringliteral">&quot;PRI PRI_EVENT_PROGRESS (%d)&quot;</span>, e-&gt;proceeding.cause);</div><div class="line"><a name="l06796"></a><span class="lineno"> 6796</span>&#160;                  pri_queue_pvt_cause_data(pri, chanpos, cause_str, e-&gt;proceeding.cause);</div><div class="line"><a name="l06797"></a><span class="lineno"> 6797</span>&#160;               }</div><div class="line"><a name="l06798"></a><span class="lineno"> 6798</span>&#160;</div><div class="line"><a name="l06799"></a><span class="lineno"> 6799</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;PROGRESS with cause code %d received\n&quot;</span>, e-&gt;proceeding.cause);</div><div class="line"><a name="l06800"></a><span class="lineno"> 6800</span>&#160;</div><div class="line"><a name="l06801"></a><span class="lineno"> 6801</span>&#160;               <span class="comment">/* Work around broken, out of spec USER_BUSY cause in a progress message */</span></div><div class="line"><a name="l06802"></a><span class="lineno"> 6802</span>&#160;               <span class="keywordflow">if</span> (e-&gt;proceeding.cause == <a class="code" href="../../d4/da3/causes_8h.html#aff0e956cb3ef657557fa468a17416c0b">AST_CAUSE_USER_BUSY</a>) {</div><div class="line"><a name="l06803"></a><span class="lineno"> 6803</span>&#160;                  <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l06804"></a><span class="lineno"> 6804</span>&#160;                     <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;PROGRESS with &#39;user busy&#39; received, signaling AST_CONTROL_BUSY instead of AST_CONTROL_PROGRESS\n&quot;</span>);</div><div class="line"><a name="l06805"></a><span class="lineno"> 6805</span>&#160;</div><div class="line"><a name="l06806"></a><span class="lineno"> 6806</span>&#160;                     <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, e-&gt;proceeding.cause);</div><div class="line"><a name="l06807"></a><span class="lineno"> 6807</span>&#160;                     pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>);</div><div class="line"><a name="l06808"></a><span class="lineno"> 6808</span>&#160;                  }</div><div class="line"><a name="l06809"></a><span class="lineno"> 6809</span>&#160;               }</div><div class="line"><a name="l06810"></a><span class="lineno"> 6810</span>&#160;            }</div><div class="line"><a name="l06811"></a><span class="lineno"> 6811</span>&#160;</div><div class="line"><a name="l06812"></a><span class="lineno"> 6812</span>&#160;            <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a></div><div class="line"><a name="l06813"></a><span class="lineno"> 6813</span>&#160;               &amp;&amp; !pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a></div><div class="line"><a name="l06814"></a><span class="lineno"> 6814</span>&#160;#ifdef PRI_PROGRESS_MASK</div><div class="line"><a name="l06815"></a><span class="lineno"> 6815</span>&#160;               &amp;&amp; (e-&gt;proceeding.progressmask</div><div class="line"><a name="l06816"></a><span class="lineno"> 6816</span>&#160;                  &amp; (PRI_PROG_CALL_NOT_E2E_ISDN | PRI_PROG_INBAND_AVAILABLE))</div><div class="line"><a name="l06817"></a><span class="lineno"> 6817</span>&#160;#<span class="keywordflow">else</span></div><div class="line"><a name="l06818"></a><span class="lineno"> 6818</span>&#160;               &amp;&amp; e-&gt;proceeding.progress == 8</div><div class="line"><a name="l06819"></a><span class="lineno"> 6819</span>&#160;#endif</div><div class="line"><a name="l06820"></a><span class="lineno"> 6820</span>&#160;               ) {</div><div class="line"><a name="l06821"></a><span class="lineno"> 6821</span>&#160;               <span class="comment">/* Bring voice path up */</span></div><div class="line"><a name="l06822"></a><span class="lineno"> 6822</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1,</div><div class="line"><a name="l06823"></a><span class="lineno"> 6823</span>&#160;                  <span class="stringliteral">&quot;Queuing frame from PRI_EVENT_PROGRESS on channel %d/%d span %d\n&quot;</span>,</div><div class="line"><a name="l06824"></a><span class="lineno"> 6824</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>,</div><div class="line"><a name="l06825"></a><span class="lineno"> 6825</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06826"></a><span class="lineno"> 6826</span>&#160;               pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>);</div><div class="line"><a name="l06827"></a><span class="lineno"> 6827</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> = 1;</div><div class="line"><a name="l06828"></a><span class="lineno"> 6828</span>&#160;               sig_pri_set_dialing(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], 0);</div><div class="line"><a name="l06829"></a><span class="lineno"> 6829</span>&#160;               sig_pri_open_media(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06830"></a><span class="lineno"> 6830</span>&#160;            }</div><div class="line"><a name="l06831"></a><span class="lineno"> 6831</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06832"></a><span class="lineno"> 6832</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06833"></a><span class="lineno"> 6833</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_PROCEEDING:</div><div class="line"><a name="l06834"></a><span class="lineno"> 6834</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;proceeding.channel)) {</div><div class="line"><a name="l06835"></a><span class="lineno"> 6835</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;proceeding.subcmds,</div><div class="line"><a name="l06836"></a><span class="lineno"> 6836</span>&#160;                  e-&gt;proceeding.call);</div><div class="line"><a name="l06837"></a><span class="lineno"> 6837</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06838"></a><span class="lineno"> 6838</span>&#160;            }</div><div class="line"><a name="l06839"></a><span class="lineno"> 6839</span>&#160;            chanpos = pri_find_fixup_principle(pri, e-&gt;proceeding.channel,</div><div class="line"><a name="l06840"></a><span class="lineno"> 6840</span>&#160;               e-&gt;proceeding.call);</div><div class="line"><a name="l06841"></a><span class="lineno"> 6841</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l06842"></a><span class="lineno"> 6842</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06843"></a><span class="lineno"> 6843</span>&#160;            }</div><div class="line"><a name="l06844"></a><span class="lineno"> 6844</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06845"></a><span class="lineno"> 6845</span>&#160;</div><div class="line"><a name="l06846"></a><span class="lineno"> 6846</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l06847"></a><span class="lineno"> 6847</span>&#160;</div><div class="line"><a name="l06848"></a><span class="lineno"> 6848</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;proceeding.subcmds,</div><div class="line"><a name="l06849"></a><span class="lineno"> 6849</span>&#160;               e-&gt;proceeding.call);</div><div class="line"><a name="l06850"></a><span class="lineno"> 6850</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a60273beaf5da6262358cc2add8aa2765">SIG_PRI_CALL_LEVEL_PROCEEDING</a>) {</div><div class="line"><a name="l06851"></a><span class="lineno"> 6851</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a60273beaf5da6262358cc2add8aa2765">SIG_PRI_CALL_LEVEL_PROCEEDING</a>;</div><div class="line"><a name="l06852"></a><span class="lineno"> 6852</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1,</div><div class="line"><a name="l06853"></a><span class="lineno"> 6853</span>&#160;                  <span class="stringliteral">&quot;Queuing frame from PRI_EVENT_PROCEEDING on channel %d/%d span %d\n&quot;</span>,</div><div class="line"><a name="l06854"></a><span class="lineno"> 6854</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>,</div><div class="line"><a name="l06855"></a><span class="lineno"> 6855</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06856"></a><span class="lineno"> 6856</span>&#160;               pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>);</div><div class="line"><a name="l06857"></a><span class="lineno"> 6857</span>&#160;            }</div><div class="line"><a name="l06858"></a><span class="lineno"> 6858</span>&#160;            <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a></div><div class="line"><a name="l06859"></a><span class="lineno"> 6859</span>&#160;               &amp;&amp; !pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a></div><div class="line"><a name="l06860"></a><span class="lineno"> 6860</span>&#160;#ifdef PRI_PROGRESS_MASK</div><div class="line"><a name="l06861"></a><span class="lineno"> 6861</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l06862"></a><span class="lineno"> 6862</span>&#160;<span class="comment">                * We only care about PRI_PROG_INBAND_AVAILABLE to open the</span></div><div class="line"><a name="l06863"></a><span class="lineno"> 6863</span>&#160;<span class="comment">                * voice path.</span></div><div class="line"><a name="l06864"></a><span class="lineno"> 6864</span>&#160;<span class="comment">                *</span></div><div class="line"><a name="l06865"></a><span class="lineno"> 6865</span>&#160;<span class="comment">                * We explicitly DO NOT want to check PRI_PROG_CALL_NOT_E2E_ISDN</span></div><div class="line"><a name="l06866"></a><span class="lineno"> 6866</span>&#160;<span class="comment">                * because it will mess up ISDN to SIP interoperability for</span></div><div class="line"><a name="l06867"></a><span class="lineno"> 6867</span>&#160;<span class="comment">                * the ALERTING message.</span></div><div class="line"><a name="l06868"></a><span class="lineno"> 6868</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l06869"></a><span class="lineno"> 6869</span>&#160;               &amp;&amp; (e-&gt;proceeding.progressmask &amp; PRI_PROG_INBAND_AVAILABLE)</div><div class="line"><a name="l06870"></a><span class="lineno"> 6870</span>&#160;#<span class="keywordflow">else</span></div><div class="line"><a name="l06871"></a><span class="lineno"> 6871</span>&#160;               &amp;&amp; e-&gt;proceeding.progress == 8</div><div class="line"><a name="l06872"></a><span class="lineno"> 6872</span>&#160;#endif</div><div class="line"><a name="l06873"></a><span class="lineno"> 6873</span>&#160;               ) {</div><div class="line"><a name="l06874"></a><span class="lineno"> 6874</span>&#160;               <span class="comment">/* Bring voice path up */</span></div><div class="line"><a name="l06875"></a><span class="lineno"> 6875</span>&#160;               pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>);</div><div class="line"><a name="l06876"></a><span class="lineno"> 6876</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> = 1;</div><div class="line"><a name="l06877"></a><span class="lineno"> 6877</span>&#160;               sig_pri_set_dialing(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], 0);</div><div class="line"><a name="l06878"></a><span class="lineno"> 6878</span>&#160;               sig_pri_open_media(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06879"></a><span class="lineno"> 6879</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a5a3260750dabe2ed9d7bd1e2e892329d">inband_on_proceeding</a>) {</div><div class="line"><a name="l06880"></a><span class="lineno"> 6880</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l06881"></a><span class="lineno"> 6881</span>&#160;<span class="comment">                * XXX This is to accomodate a broken switch that sends a</span></div><div class="line"><a name="l06882"></a><span class="lineno"> 6882</span>&#160;<span class="comment">                * PROCEEDING without any progress indication ie for</span></div><div class="line"><a name="l06883"></a><span class="lineno"> 6883</span>&#160;<span class="comment">                * inband audio.  This should be part of the conditional</span></div><div class="line"><a name="l06884"></a><span class="lineno"> 6884</span>&#160;<span class="comment">                * test above to bring the voice path up.</span></div><div class="line"><a name="l06885"></a><span class="lineno"> 6885</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l06886"></a><span class="lineno"> 6886</span>&#160;               sig_pri_set_dialing(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], 0);</div><div class="line"><a name="l06887"></a><span class="lineno"> 6887</span>&#160;            }</div><div class="line"><a name="l06888"></a><span class="lineno"> 6888</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06889"></a><span class="lineno"> 6889</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06890"></a><span class="lineno"> 6890</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_FACILITY:</div><div class="line"><a name="l06891"></a><span class="lineno"> 6891</span>&#160;            <span class="keywordflow">if</span> (!e-&gt;facility.call || sig_pri_is_cis_call(e-&gt;facility.channel)) {</div><div class="line"><a name="l06892"></a><span class="lineno"> 6892</span>&#160;               <span class="comment">/* Event came in on the dummy channel or a CIS call. */</span></div><div class="line"><a name="l06893"></a><span class="lineno"> 6893</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_REROUTING)</span></div><div class="line"><a name="l06894"></a><span class="lineno"> 6894</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;facility.subcmds,</div><div class="line"><a name="l06895"></a><span class="lineno"> 6895</span>&#160;                  e-&gt;facility.subcall);</div><div class="line"><a name="l06896"></a><span class="lineno"> 6896</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l06897"></a><span class="lineno"> 6897</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;facility.subcmds,</div><div class="line"><a name="l06898"></a><span class="lineno"> 6898</span>&#160;                  e-&gt;facility.call);</div><div class="line"><a name="l06899"></a><span class="lineno"> 6899</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* !defined(HAVE_PRI_CALL_REROUTING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l06900"></a><span class="lineno"> 6900</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06901"></a><span class="lineno"> 6901</span>&#160;            }</div><div class="line"><a name="l06902"></a><span class="lineno"> 6902</span>&#160;            chanpos = pri_find_principle_by_call(pri, e-&gt;facility.call);</div><div class="line"><a name="l06903"></a><span class="lineno"> 6903</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l06904"></a><span class="lineno"> 6904</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Span %d: Received facility for unknown call.\n&quot;</span>,</div><div class="line"><a name="l06905"></a><span class="lineno"> 6905</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06906"></a><span class="lineno"> 6906</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06907"></a><span class="lineno"> 6907</span>&#160;            }</div><div class="line"><a name="l06908"></a><span class="lineno"> 6908</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06909"></a><span class="lineno"> 6909</span>&#160;</div><div class="line"><a name="l06910"></a><span class="lineno"> 6910</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l06911"></a><span class="lineno"> 6911</span>&#160;</div><div class="line"><a name="l06912"></a><span class="lineno"> 6912</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_REROUTING)</span></div><div class="line"><a name="l06913"></a><span class="lineno"> 6913</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;facility.subcmds,</div><div class="line"><a name="l06914"></a><span class="lineno"> 6914</span>&#160;               e-&gt;facility.subcall);</div><div class="line"><a name="l06915"></a><span class="lineno"> 6915</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l06916"></a><span class="lineno"> 6916</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;facility.subcmds,</div><div class="line"><a name="l06917"></a><span class="lineno"> 6917</span>&#160;               e-&gt;facility.call);</div><div class="line"><a name="l06918"></a><span class="lineno"> 6918</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* !defined(HAVE_PRI_CALL_REROUTING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l06919"></a><span class="lineno"> 6919</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06920"></a><span class="lineno"> 6920</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06921"></a><span class="lineno"> 6921</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_ANSWER:</div><div class="line"><a name="l06922"></a><span class="lineno"> 6922</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;answer.channel)) {</div><div class="line"><a name="l06923"></a><span class="lineno"> 6923</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l06924"></a><span class="lineno"> 6924</span>&#160;               <span class="comment">/* Call is CIS so do normal CONNECT_ACKNOWLEDGE. */</span></div><div class="line"><a name="l06925"></a><span class="lineno"> 6925</span>&#160;               pri_connect_ack(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;answer.call, 0);</div><div class="line"><a name="l06926"></a><span class="lineno"> 6926</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l06927"></a><span class="lineno"> 6927</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;answer.subcmds,</div><div class="line"><a name="l06928"></a><span class="lineno"> 6928</span>&#160;                  e-&gt;answer.call);</div><div class="line"><a name="l06929"></a><span class="lineno"> 6929</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06930"></a><span class="lineno"> 6930</span>&#160;            }</div><div class="line"><a name="l06931"></a><span class="lineno"> 6931</span>&#160;            chanpos = pri_find_fixup_principle(pri, e-&gt;answer.channel, e-&gt;answer.call);</div><div class="line"><a name="l06932"></a><span class="lineno"> 6932</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l06933"></a><span class="lineno"> 6933</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l06934"></a><span class="lineno"> 6934</span>&#160;            }</div><div class="line"><a name="l06935"></a><span class="lineno"> 6935</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l06936"></a><span class="lineno"> 6936</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;is_call_waiting) {</div><div class="line"><a name="l06937"></a><span class="lineno"> 6937</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a>) {</div><div class="line"><a name="l06938"></a><span class="lineno"> 6938</span>&#160;                  <span class="keywordtype">int</span> new_chanpos;</div><div class="line"><a name="l06939"></a><span class="lineno"> 6939</span>&#160;</div><div class="line"><a name="l06940"></a><span class="lineno"> 6940</span>&#160;                  <span class="comment">/*</span></div><div class="line"><a name="l06941"></a><span class="lineno"> 6941</span>&#160;<span class="comment">                   * Need to find a free channel now or</span></div><div class="line"><a name="l06942"></a><span class="lineno"> 6942</span>&#160;<span class="comment">                   * kill the call with PRI_CAUSE_NORMAL_CIRCUIT_CONGESTION.</span></div><div class="line"><a name="l06943"></a><span class="lineno"> 6943</span>&#160;<span class="comment">                   */</span></div><div class="line"><a name="l06944"></a><span class="lineno"> 6944</span>&#160;                  new_chanpos = pri_find_empty_chan(pri, 1);</div><div class="line"><a name="l06945"></a><span class="lineno"> 6945</span>&#160;                  <span class="keywordflow">if</span> (0 &lt;= new_chanpos) {</div><div class="line"><a name="l06946"></a><span class="lineno"> 6946</span>&#160;                     new_chanpos = pri_fixup_principle(pri, new_chanpos,</div><div class="line"><a name="l06947"></a><span class="lineno"> 6947</span>&#160;                        e-&gt;answer.call);</div><div class="line"><a name="l06948"></a><span class="lineno"> 6948</span>&#160;                  }</div><div class="line"><a name="l06949"></a><span class="lineno"> 6949</span>&#160;                  <span class="keywordflow">if</span> (new_chanpos &lt; 0) {</div><div class="line"><a name="l06950"></a><span class="lineno"> 6950</span>&#160;                     <span class="comment">/*</span></div><div class="line"><a name="l06951"></a><span class="lineno"> 6951</span>&#160;<span class="comment">                      * Either no channel was available or someone stole</span></div><div class="line"><a name="l06952"></a><span class="lineno"> 6952</span>&#160;<span class="comment">                      * the channel!</span></div><div class="line"><a name="l06953"></a><span class="lineno"> 6953</span>&#160;<span class="comment">                      */</span></div><div class="line"><a name="l06954"></a><span class="lineno"> 6954</span>&#160;                     <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,</div><div class="line"><a name="l06955"></a><span class="lineno"> 6955</span>&#160;                        <span class="stringliteral">&quot;Span %d: Channel not available for call waiting call.\n&quot;</span>,</div><div class="line"><a name="l06956"></a><span class="lineno"> 6956</span>&#160;                        pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l06957"></a><span class="lineno"> 6957</span>&#160;                     sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06958"></a><span class="lineno"> 6958</span>&#160;                     sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;answer.subcmds,</div><div class="line"><a name="l06959"></a><span class="lineno"> 6959</span>&#160;                        e-&gt;answer.call);</div><div class="line"><a name="l06960"></a><span class="lineno"> 6960</span>&#160;                     sig_pri_cc_generic_check(pri, chanpos, <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530a64c2fae63ae9df0696a2092477c6fcb2">AST_CC_CCBS</a>);</div><div class="line"><a name="l06961"></a><span class="lineno"> 6961</span>&#160;                     sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l06962"></a><span class="lineno"> 6962</span>&#160;                     <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l06963"></a><span class="lineno"> 6963</span>&#160;                        <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, PRI_CAUSE_NORMAL_CIRCUIT_CONGESTION);</div><div class="line"><a name="l06964"></a><span class="lineno"> 6964</span>&#160;                        <span class="keywordflow">switch</span> (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {</div><div class="line"><a name="l06965"></a><span class="lineno"> 6965</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591">AST_STATE_BUSY</a>:</div><div class="line"><a name="l06966"></a><span class="lineno"> 6966</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>:</div><div class="line"><a name="l06967"></a><span class="lineno"> 6967</span>&#160;                           <a class="code" href="../../d5/d7b/channel_8h.html#ae90da1877e143b996d202d4c88a9c862">ast_softhangup_nolock</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);</div><div class="line"><a name="l06968"></a><span class="lineno"> 6968</span>&#160;                           <span class="keywordflow">break</span>;</div><div class="line"><a name="l06969"></a><span class="lineno"> 6969</span>&#160;                        <span class="keywordflow">default</span>:</div><div class="line"><a name="l06970"></a><span class="lineno"> 6970</span>&#160;                           pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>);</div><div class="line"><a name="l06971"></a><span class="lineno"> 6971</span>&#160;                           <span class="keywordflow">break</span>;</div><div class="line"><a name="l06972"></a><span class="lineno"> 6972</span>&#160;                        }</div><div class="line"><a name="l06973"></a><span class="lineno"> 6973</span>&#160;                        <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l06974"></a><span class="lineno"> 6974</span>&#160;                     } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06975"></a><span class="lineno"> 6975</span>&#160;                        pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;is_call_waiting = 0;</div><div class="line"><a name="l06976"></a><span class="lineno"> 6976</span>&#160;                        <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;pri-&gt;num_call_waiting_calls, -1);</div><div class="line"><a name="l06977"></a><span class="lineno"> 6977</span>&#160;                        pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;answer.call, PRI_CAUSE_NORMAL_CIRCUIT_CONGESTION);</div><div class="line"><a name="l06978"></a><span class="lineno"> 6978</span>&#160;                        pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06979"></a><span class="lineno"> 6979</span>&#160;                     }</div><div class="line"><a name="l06980"></a><span class="lineno"> 6980</span>&#160;                     sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06981"></a><span class="lineno"> 6981</span>&#160;                     sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l06982"></a><span class="lineno"> 6982</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l06983"></a><span class="lineno"> 6983</span>&#160;                  }</div><div class="line"><a name="l06984"></a><span class="lineno"> 6984</span>&#160;                  chanpos = new_chanpos;</div><div class="line"><a name="l06985"></a><span class="lineno"> 6985</span>&#160;               }</div><div class="line"><a name="l06986"></a><span class="lineno"> 6986</span>&#160;               pri_connect_ack(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;answer.call, PVT_TO_CHANNEL(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]));</div><div class="line"><a name="l06987"></a><span class="lineno"> 6987</span>&#160;               sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l06988"></a><span class="lineno"> 6988</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06989"></a><span class="lineno"> 6989</span>&#160;               <span class="comment">/* Call is normal so do normal CONNECT_ACKNOWLEDGE. */</span></div><div class="line"><a name="l06990"></a><span class="lineno"> 6990</span>&#160;               pri_connect_ack(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;answer.call, 0);</div><div class="line"><a name="l06991"></a><span class="lineno"> 6991</span>&#160;            }</div><div class="line"><a name="l06992"></a><span class="lineno"> 6992</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l06993"></a><span class="lineno"> 6993</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l06994"></a><span class="lineno"> 6994</span>&#160;</div><div class="line"><a name="l06995"></a><span class="lineno"> 6995</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l06996"></a><span class="lineno"> 6996</span>&#160;</div><div class="line"><a name="l06997"></a><span class="lineno"> 6997</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l06998"></a><span class="lineno"> 6998</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;is_call_waiting) {</div><div class="line"><a name="l06999"></a><span class="lineno"> 6999</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;is_call_waiting = 0;</div><div class="line"><a name="l07000"></a><span class="lineno"> 7000</span>&#160;               <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;pri-&gt;num_call_waiting_calls, -1);</div><div class="line"><a name="l07001"></a><span class="lineno"> 7001</span>&#160;            }</div><div class="line"><a name="l07002"></a><span class="lineno"> 7002</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07003"></a><span class="lineno"> 7003</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;answer.subcmds,</div><div class="line"><a name="l07004"></a><span class="lineno"> 7004</span>&#160;               e-&gt;answer.call);</div><div class="line"><a name="l07005"></a><span class="lineno"> 7005</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aa31218f7cda0b552305b7daed3a4a58d">deferred_digits</a>)) {</div><div class="line"><a name="l07006"></a><span class="lineno"> 7006</span>&#160;               <span class="comment">/* We have some &#39;w&#39; deferred digits to dial now. */</span></div><div class="line"><a name="l07007"></a><span class="lineno"> 7007</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,</div><div class="line"><a name="l07008"></a><span class="lineno"> 7008</span>&#160;                  <span class="stringliteral">&quot;Span %d: Channel %d/%d dialing deferred digit string: %s\n&quot;</span>,</div><div class="line"><a name="l07009"></a><span class="lineno"> 7009</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>,</div><div class="line"><a name="l07010"></a><span class="lineno"> 7010</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>,</div><div class="line"><a name="l07011"></a><span class="lineno"> 7011</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aa31218f7cda0b552305b7daed3a4a58d">deferred_digits</a>);</div><div class="line"><a name="l07012"></a><span class="lineno"> 7012</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a97a62807945f1318b8d4f643c3709c94">SIG_PRI_CALL_LEVEL_DEFER_DIAL</a>) {</div><div class="line"><a name="l07013"></a><span class="lineno"> 7013</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a97a62807945f1318b8d4f643c3709c94">SIG_PRI_CALL_LEVEL_DEFER_DIAL</a>;</div><div class="line"><a name="l07014"></a><span class="lineno"> 7014</span>&#160;               }</div><div class="line"><a name="l07015"></a><span class="lineno"> 7015</span>&#160;               sig_pri_dial_digits(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos],</div><div class="line"><a name="l07016"></a><span class="lineno"> 7016</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aa31218f7cda0b552305b7daed3a4a58d">deferred_digits</a>);</div><div class="line"><a name="l07017"></a><span class="lineno"> 7017</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07018"></a><span class="lineno"> 7018</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822">SIG_PRI_CALL_LEVEL_CONNECT</a>) {</div><div class="line"><a name="l07019"></a><span class="lineno"> 7019</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822">SIG_PRI_CALL_LEVEL_CONNECT</a>;</div><div class="line"><a name="l07020"></a><span class="lineno"> 7020</span>&#160;               }</div><div class="line"><a name="l07021"></a><span class="lineno"> 7021</span>&#160;               sig_pri_open_media(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07022"></a><span class="lineno"> 7022</span>&#160;               pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>);</div><div class="line"><a name="l07023"></a><span class="lineno"> 7023</span>&#160;               sig_pri_set_dialing(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], 0);</div><div class="line"><a name="l07024"></a><span class="lineno"> 7024</span>&#160;               <span class="comment">/* Enable echo cancellation if it&#39;s not on already */</span></div><div class="line"><a name="l07025"></a><span class="lineno"> 7025</span>&#160;               sig_pri_set_echocanceller(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], 1);</div><div class="line"><a name="l07026"></a><span class="lineno"> 7026</span>&#160;            }</div><div class="line"><a name="l07027"></a><span class="lineno"> 7027</span>&#160;</div><div class="line"><a name="l07028"></a><span class="lineno"> 7028</span>&#160;<span class="preprocessor">#ifdef SUPPORT_USERUSER</span></div><div class="line"><a name="l07029"></a><span class="lineno"> 7029</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(e-&gt;answer.useruserinfo)) {</div><div class="line"><a name="l07030"></a><span class="lineno"> 7030</span>&#160;               <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner;</div><div class="line"><a name="l07031"></a><span class="lineno"> 7031</span>&#160;</div><div class="line"><a name="l07032"></a><span class="lineno"> 7032</span>&#160;               sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l07033"></a><span class="lineno"> 7033</span>&#160;               owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l07034"></a><span class="lineno"> 7034</span>&#160;               <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l07035"></a><span class="lineno"> 7035</span>&#160;                  <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;USERUSERINFO&quot;</span>,</div><div class="line"><a name="l07036"></a><span class="lineno"> 7036</span>&#160;                     e-&gt;answer.useruserinfo);</div><div class="line"><a name="l07037"></a><span class="lineno"> 7037</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l07038"></a><span class="lineno"> 7038</span>&#160;               }</div><div class="line"><a name="l07039"></a><span class="lineno"> 7039</span>&#160;            }</div><div class="line"><a name="l07040"></a><span class="lineno"> 7040</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l07041"></a><span class="lineno"> 7041</span>&#160;</div><div class="line"><a name="l07042"></a><span class="lineno"> 7042</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07043"></a><span class="lineno"> 7043</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07044"></a><span class="lineno"> 7044</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l07045"></a><span class="lineno"> 7045</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_CONNECT_ACK:</div><div class="line"><a name="l07046"></a><span class="lineno"> 7046</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;connect_ack.channel)) {</div><div class="line"><a name="l07047"></a><span class="lineno"> 7047</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;connect_ack.subcmds,</div><div class="line"><a name="l07048"></a><span class="lineno"> 7048</span>&#160;                  e-&gt;connect_ack.call);</div><div class="line"><a name="l07049"></a><span class="lineno"> 7049</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07050"></a><span class="lineno"> 7050</span>&#160;            }</div><div class="line"><a name="l07051"></a><span class="lineno"> 7051</span>&#160;            chanpos = pri_find_fixup_principle(pri, e-&gt;connect_ack.channel,</div><div class="line"><a name="l07052"></a><span class="lineno"> 7052</span>&#160;               e-&gt;connect_ack.call);</div><div class="line"><a name="l07053"></a><span class="lineno"> 7053</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l07054"></a><span class="lineno"> 7054</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07055"></a><span class="lineno"> 7055</span>&#160;            }</div><div class="line"><a name="l07056"></a><span class="lineno"> 7056</span>&#160;</div><div class="line"><a name="l07057"></a><span class="lineno"> 7057</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07058"></a><span class="lineno"> 7058</span>&#160;</div><div class="line"><a name="l07059"></a><span class="lineno"> 7059</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l07060"></a><span class="lineno"> 7060</span>&#160;</div><div class="line"><a name="l07061"></a><span class="lineno"> 7061</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;connect_ack.subcmds,</div><div class="line"><a name="l07062"></a><span class="lineno"> 7062</span>&#160;               e-&gt;connect_ack.call);</div><div class="line"><a name="l07063"></a><span class="lineno"> 7063</span>&#160;            sig_pri_open_media(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07064"></a><span class="lineno"> 7064</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07065"></a><span class="lineno"> 7065</span>&#160;            sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l07066"></a><span class="lineno"> 7066</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07067"></a><span class="lineno"> 7067</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07068"></a><span class="lineno"> 7068</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_HANGUP:</div><div class="line"><a name="l07069"></a><span class="lineno"> 7069</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;hangup.channel)) {</div><div class="line"><a name="l07070"></a><span class="lineno"> 7070</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;hangup.subcmds,</div><div class="line"><a name="l07071"></a><span class="lineno"> 7071</span>&#160;                  e-&gt;hangup.call);</div><div class="line"><a name="l07072"></a><span class="lineno"> 7072</span>&#160;               pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;hangup.call, e-&gt;hangup.cause);</div><div class="line"><a name="l07073"></a><span class="lineno"> 7073</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07074"></a><span class="lineno"> 7074</span>&#160;            }</div><div class="line"><a name="l07075"></a><span class="lineno"> 7075</span>&#160;            chanpos = pri_find_principle_by_call(pri, e-&gt;hangup.call);</div><div class="line"><a name="l07076"></a><span class="lineno"> 7076</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l07077"></a><span class="lineno"> 7077</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l07078"></a><span class="lineno"> 7078</span>&#160;<span class="comment">                * Continue hanging up the call even though</span></div><div class="line"><a name="l07079"></a><span class="lineno"> 7079</span>&#160;<span class="comment">                * we do not remember it (if we ever did).</span></div><div class="line"><a name="l07080"></a><span class="lineno"> 7080</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l07081"></a><span class="lineno"> 7081</span>&#160;               pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;hangup.call, e-&gt;hangup.cause);</div><div class="line"><a name="l07082"></a><span class="lineno"> 7082</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07083"></a><span class="lineno"> 7083</span>&#160;            }</div><div class="line"><a name="l07084"></a><span class="lineno"> 7084</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07085"></a><span class="lineno"> 7085</span>&#160;</div><div class="line"><a name="l07086"></a><span class="lineno"> 7086</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l07087"></a><span class="lineno"> 7087</span>&#160;</div><div class="line"><a name="l07088"></a><span class="lineno"> 7088</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;hangup.subcmds,</div><div class="line"><a name="l07089"></a><span class="lineno"> 7089</span>&#160;               e-&gt;hangup.call);</div><div class="line"><a name="l07090"></a><span class="lineno"> 7090</span>&#160;            <span class="keywordflow">switch</span> (e-&gt;hangup.cause) {</div><div class="line"><a name="l07091"></a><span class="lineno"> 7091</span>&#160;            <span class="keywordflow">case</span> PRI_CAUSE_INVALID_CALL_REFERENCE:</div><div class="line"><a name="l07092"></a><span class="lineno"> 7092</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l07093"></a><span class="lineno"> 7093</span>&#160;<span class="comment">                * The peer denies the existence of this call so we must</span></div><div class="line"><a name="l07094"></a><span class="lineno"> 7094</span>&#160;<span class="comment">                * continue hanging it up and forget about it.</span></div><div class="line"><a name="l07095"></a><span class="lineno"> 7095</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l07096"></a><span class="lineno"> 7096</span>&#160;               pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;hangup.call, e-&gt;hangup.cause);</div><div class="line"><a name="l07097"></a><span class="lineno"> 7097</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07098"></a><span class="lineno"> 7098</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07099"></a><span class="lineno"> 7099</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l07100"></a><span class="lineno"> 7100</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07101"></a><span class="lineno"> 7101</span>&#160;            }</div><div class="line"><a name="l07102"></a><span class="lineno"> 7102</span>&#160;            <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af530b38fefaa05e6fa4f0ebe72c73455">alreadyhungup</a>) {</div><div class="line"><a name="l07103"></a><span class="lineno"> 7103</span>&#160;               <span class="comment">/* we&#39;re calling here dahdi_hangup so once we get there we need to clear p-&gt;call after calling pri_hangup */</span></div><div class="line"><a name="l07104"></a><span class="lineno"> 7104</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af530b38fefaa05e6fa4f0ebe72c73455">alreadyhungup</a> = 1;</div><div class="line"><a name="l07105"></a><span class="lineno"> 7105</span>&#160;               <span class="keywordflow">switch</span> (e-&gt;hangup.cause) {</div><div class="line"><a name="l07106"></a><span class="lineno"> 7106</span>&#160;               <span class="keywordflow">case</span> PRI_CAUSE_USER_BUSY:</div><div class="line"><a name="l07107"></a><span class="lineno"> 7107</span>&#160;               <span class="keywordflow">case</span> PRI_CAUSE_NORMAL_CIRCUIT_CONGESTION:</div><div class="line"><a name="l07108"></a><span class="lineno"> 7108</span>&#160;                  sig_pri_cc_generic_check(pri, chanpos, <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530a64c2fae63ae9df0696a2092477c6fcb2">AST_CC_CCBS</a>);</div><div class="line"><a name="l07109"></a><span class="lineno"> 7109</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l07110"></a><span class="lineno"> 7110</span>&#160;               <span class="keywordflow">default</span>:</div><div class="line"><a name="l07111"></a><span class="lineno"> 7111</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l07112"></a><span class="lineno"> 7112</span>&#160;               }</div><div class="line"><a name="l07113"></a><span class="lineno"> 7113</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l07114"></a><span class="lineno"> 7114</span>&#160;                  snprintf(cause_str, <span class="keyword">sizeof</span>(cause_str), <span class="stringliteral">&quot;PRI PRI_EVENT_HANGUP (%d)&quot;</span>, e-&gt;hangup.cause);</div><div class="line"><a name="l07115"></a><span class="lineno"> 7115</span>&#160;                  pri_queue_pvt_cause_data(pri, chanpos, cause_str, e-&gt;hangup.cause);</div><div class="line"><a name="l07116"></a><span class="lineno"> 7116</span>&#160;               }</div><div class="line"><a name="l07117"></a><span class="lineno"> 7117</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l07118"></a><span class="lineno"> 7118</span>&#160;                  <span class="keywordtype">int</span> do_hangup = 0;</div><div class="line"><a name="l07119"></a><span class="lineno"> 7119</span>&#160;</div><div class="line"><a name="l07120"></a><span class="lineno"> 7120</span>&#160;                  <span class="comment">/* Queue a BUSY instead of a hangup if our cause is appropriate */</span></div><div class="line"><a name="l07121"></a><span class="lineno"> 7121</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, e-&gt;hangup.cause);</div><div class="line"><a name="l07122"></a><span class="lineno"> 7122</span>&#160;                  <span class="keywordflow">switch</span> (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {</div><div class="line"><a name="l07123"></a><span class="lineno"> 7123</span>&#160;                  <span class="keywordflow">case</span> <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591">AST_STATE_BUSY</a>:</div><div class="line"><a name="l07124"></a><span class="lineno"> 7124</span>&#160;                  <span class="keywordflow">case</span> <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>:</div><div class="line"><a name="l07125"></a><span class="lineno"> 7125</span>&#160;                     do_hangup = 1;</div><div class="line"><a name="l07126"></a><span class="lineno"> 7126</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l07127"></a><span class="lineno"> 7127</span>&#160;                  <span class="keywordflow">default</span>:</div><div class="line"><a name="l07128"></a><span class="lineno"> 7128</span>&#160;                     <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a>) {</div><div class="line"><a name="l07129"></a><span class="lineno"> 7129</span>&#160;                        <span class="comment">/*</span></div><div class="line"><a name="l07130"></a><span class="lineno"> 7130</span>&#160;<span class="comment">                         * The incoming call leg hung up before getting</span></div><div class="line"><a name="l07131"></a><span class="lineno"> 7131</span>&#160;<span class="comment">                         * connected so just hangup the call.</span></div><div class="line"><a name="l07132"></a><span class="lineno"> 7132</span>&#160;<span class="comment">                         */</span></div><div class="line"><a name="l07133"></a><span class="lineno"> 7133</span>&#160;                        do_hangup = 1;</div><div class="line"><a name="l07134"></a><span class="lineno"> 7134</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l07135"></a><span class="lineno"> 7135</span>&#160;                     }</div><div class="line"><a name="l07136"></a><span class="lineno"> 7136</span>&#160;                     <span class="keywordflow">switch</span> (e-&gt;hangup.cause) {</div><div class="line"><a name="l07137"></a><span class="lineno"> 7137</span>&#160;                     <span class="keywordflow">case</span> PRI_CAUSE_USER_BUSY:</div><div class="line"><a name="l07138"></a><span class="lineno"> 7138</span>&#160;                        pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>);</div><div class="line"><a name="l07139"></a><span class="lineno"> 7139</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l07140"></a><span class="lineno"> 7140</span>&#160;                     <span class="keywordflow">case</span> PRI_CAUSE_CALL_REJECTED:</div><div class="line"><a name="l07141"></a><span class="lineno"> 7141</span>&#160;                     <span class="keywordflow">case</span> PRI_CAUSE_NETWORK_OUT_OF_ORDER:</div><div class="line"><a name="l07142"></a><span class="lineno"> 7142</span>&#160;                     <span class="keywordflow">case</span> PRI_CAUSE_NORMAL_CIRCUIT_CONGESTION:</div><div class="line"><a name="l07143"></a><span class="lineno"> 7143</span>&#160;                     <span class="keywordflow">case</span> PRI_CAUSE_SWITCH_CONGESTION:</div><div class="line"><a name="l07144"></a><span class="lineno"> 7144</span>&#160;                     <span class="keywordflow">case</span> PRI_CAUSE_DESTINATION_OUT_OF_ORDER:</div><div class="line"><a name="l07145"></a><span class="lineno"> 7145</span>&#160;                     <span class="keywordflow">case</span> PRI_CAUSE_NORMAL_TEMPORARY_FAILURE:</div><div class="line"><a name="l07146"></a><span class="lineno"> 7146</span>&#160;                        pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>);</div><div class="line"><a name="l07147"></a><span class="lineno"> 7147</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l07148"></a><span class="lineno"> 7148</span>&#160;                     <span class="keywordflow">default</span>:</div><div class="line"><a name="l07149"></a><span class="lineno"> 7149</span>&#160;                        do_hangup = 1;</div><div class="line"><a name="l07150"></a><span class="lineno"> 7150</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l07151"></a><span class="lineno"> 7151</span>&#160;                     }</div><div class="line"><a name="l07152"></a><span class="lineno"> 7152</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l07153"></a><span class="lineno"> 7153</span>&#160;                  }</div><div class="line"><a name="l07154"></a><span class="lineno"> 7154</span>&#160;</div><div class="line"><a name="l07155"></a><span class="lineno"> 7155</span>&#160;                  <span class="keywordflow">if</span> (do_hangup) {</div><div class="line"><a name="l07156"></a><span class="lineno"> 7156</span>&#160;                     sig_pri_queue_hangup(pri, chanpos);</div><div class="line"><a name="l07157"></a><span class="lineno"> 7157</span>&#160;                  }</div><div class="line"><a name="l07158"></a><span class="lineno"> 7158</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07159"></a><span class="lineno"> 7159</span>&#160;                  <span class="comment">/*</span></div><div class="line"><a name="l07160"></a><span class="lineno"> 7160</span>&#160;<span class="comment">                   * Continue hanging up the call even though</span></div><div class="line"><a name="l07161"></a><span class="lineno"> 7161</span>&#160;<span class="comment">                   * we do not have an owner.</span></div><div class="line"><a name="l07162"></a><span class="lineno"> 7162</span>&#160;<span class="comment">                   */</span></div><div class="line"><a name="l07163"></a><span class="lineno"> 7163</span>&#160;                  pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, e-&gt;hangup.cause);</div><div class="line"><a name="l07164"></a><span class="lineno"> 7164</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07165"></a><span class="lineno"> 7165</span>&#160;               }</div><div class="line"><a name="l07166"></a><span class="lineno"> 7166</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Span %d: Channel %d/%d got hangup, cause %d\n&quot;</span>,</div><div class="line"><a name="l07167"></a><span class="lineno"> 7167</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>,</div><div class="line"><a name="l07168"></a><span class="lineno"> 7168</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>, e-&gt;hangup.cause);</div><div class="line"><a name="l07169"></a><span class="lineno"> 7169</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07170"></a><span class="lineno"> 7170</span>&#160;               <span class="comment">/* Continue hanging up the call. */</span></div><div class="line"><a name="l07171"></a><span class="lineno"> 7171</span>&#160;               pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, e-&gt;hangup.cause);</div><div class="line"><a name="l07172"></a><span class="lineno"> 7172</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07173"></a><span class="lineno"> 7173</span>&#160;            }</div><div class="line"><a name="l07174"></a><span class="lineno"> 7174</span>&#160;            <span class="keywordflow">if</span> (e-&gt;hangup.cause == PRI_CAUSE_REQUESTED_CHAN_UNAVAIL</div><div class="line"><a name="l07175"></a><span class="lineno"> 7175</span>&#160;               &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="../../d5/db3/chan__dahdi_8h.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a> &amp;&amp; !pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a></div><div class="line"><a name="l07176"></a><span class="lineno"> 7176</span>&#160;               &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad44ab156cfb784ec704fbd1d4faec1ea">force_restart_unavailable_chans</a></div><div class="line"><a name="l07177"></a><span class="lineno"> 7177</span>&#160;               &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> == <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3">SIG_PRI_RESET_IDLE</a>) {</div><div class="line"><a name="l07178"></a><span class="lineno"> 7178</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,</div><div class="line"><a name="l07179"></a><span class="lineno"> 7179</span>&#160;                  <span class="stringliteral">&quot;Span %d: Forcing restart of channel %d/%d since channel reported in use\n&quot;</span>,</div><div class="line"><a name="l07180"></a><span class="lineno"> 7180</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>,</div><div class="line"><a name="l07181"></a><span class="lineno"> 7181</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>);</div><div class="line"><a name="l07182"></a><span class="lineno"> 7182</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaad73773a22eaed64af27f4c0905f239dc">SIG_PRI_RESET_ACTIVE</a>;</div><div class="line"><a name="l07183"></a><span class="lineno"> 7183</span>&#160;               pri_reset(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, PVT_TO_CHANNEL(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]));</div><div class="line"><a name="l07184"></a><span class="lineno"> 7184</span>&#160;            }</div><div class="line"><a name="l07185"></a><span class="lineno"> 7185</span>&#160;            <span class="keywordflow">if</span> (e-&gt;hangup.aoc_units &gt; -1)</div><div class="line"><a name="l07186"></a><span class="lineno"> 7186</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Channel %d/%d, span %d received AOC-E charging %d unit%s\n&quot;</span>,</div><div class="line"><a name="l07187"></a><span class="lineno"> 7187</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, (<span class="keywordtype">int</span>)e-&gt;hangup.aoc_units, (e-&gt;hangup.aoc_units == 1) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;s&quot;</span>);</div><div class="line"><a name="l07188"></a><span class="lineno"> 7188</span>&#160;</div><div class="line"><a name="l07189"></a><span class="lineno"> 7189</span>&#160;<span class="preprocessor">#ifdef SUPPORT_USERUSER</span></div><div class="line"><a name="l07190"></a><span class="lineno"> 7190</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(e-&gt;hangup.useruserinfo)) {</div><div class="line"><a name="l07191"></a><span class="lineno"> 7191</span>&#160;               <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner;</div><div class="line"><a name="l07192"></a><span class="lineno"> 7192</span>&#160;</div><div class="line"><a name="l07193"></a><span class="lineno"> 7193</span>&#160;               sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l07194"></a><span class="lineno"> 7194</span>&#160;               owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l07195"></a><span class="lineno"> 7195</span>&#160;               <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l07196"></a><span class="lineno"> 7196</span>&#160;                  <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;USERUSERINFO&quot;</span>,</div><div class="line"><a name="l07197"></a><span class="lineno"> 7197</span>&#160;                     e-&gt;hangup.useruserinfo);</div><div class="line"><a name="l07198"></a><span class="lineno"> 7198</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l07199"></a><span class="lineno"> 7199</span>&#160;               }</div><div class="line"><a name="l07200"></a><span class="lineno"> 7200</span>&#160;            }</div><div class="line"><a name="l07201"></a><span class="lineno"> 7201</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l07202"></a><span class="lineno"> 7202</span>&#160;</div><div class="line"><a name="l07203"></a><span class="lineno"> 7203</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07204"></a><span class="lineno"> 7204</span>&#160;            sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l07205"></a><span class="lineno"> 7205</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07206"></a><span class="lineno"> 7206</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_HANGUP_REQ:</div><div class="line"><a name="l07207"></a><span class="lineno"> 7207</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;hangup.channel)) {</div><div class="line"><a name="l07208"></a><span class="lineno"> 7208</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;hangup.subcmds,</div><div class="line"><a name="l07209"></a><span class="lineno"> 7209</span>&#160;                  e-&gt;hangup.call);</div><div class="line"><a name="l07210"></a><span class="lineno"> 7210</span>&#160;               pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;hangup.call, e-&gt;hangup.cause);</div><div class="line"><a name="l07211"></a><span class="lineno"> 7211</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07212"></a><span class="lineno"> 7212</span>&#160;            }</div><div class="line"><a name="l07213"></a><span class="lineno"> 7213</span>&#160;            chanpos = pri_find_principle_by_call(pri, e-&gt;hangup.call);</div><div class="line"><a name="l07214"></a><span class="lineno"> 7214</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l07215"></a><span class="lineno"> 7215</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l07216"></a><span class="lineno"> 7216</span>&#160;<span class="comment">                * Continue hanging up the call even though</span></div><div class="line"><a name="l07217"></a><span class="lineno"> 7217</span>&#160;<span class="comment">                * we do not remember it (if we ever did).</span></div><div class="line"><a name="l07218"></a><span class="lineno"> 7218</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l07219"></a><span class="lineno"> 7219</span>&#160;               pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;hangup.call, e-&gt;hangup.cause);</div><div class="line"><a name="l07220"></a><span class="lineno"> 7220</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07221"></a><span class="lineno"> 7221</span>&#160;            }</div><div class="line"><a name="l07222"></a><span class="lineno"> 7222</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07223"></a><span class="lineno"> 7223</span>&#160;</div><div class="line"><a name="l07224"></a><span class="lineno"> 7224</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l07225"></a><span class="lineno"> 7225</span>&#160;</div><div class="line"><a name="l07226"></a><span class="lineno"> 7226</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;hangup.subcmds,</div><div class="line"><a name="l07227"></a><span class="lineno"> 7227</span>&#160;               e-&gt;hangup.call);</div><div class="line"><a name="l07228"></a><span class="lineno"> 7228</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l07229"></a><span class="lineno"> 7229</span>&#160;            <span class="keywordflow">if</span> (e-&gt;hangup.call_active &amp;&amp; e-&gt;hangup.call_held</div><div class="line"><a name="l07230"></a><span class="lineno"> 7230</span>&#160;               &amp;&amp; pri-&gt;hold_disconnect_transfer) {</div><div class="line"><a name="l07231"></a><span class="lineno"> 7231</span>&#160;               <span class="comment">/* We are to transfer the call instead of simply hanging up. */</span></div><div class="line"><a name="l07232"></a><span class="lineno"> 7232</span>&#160;               sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07233"></a><span class="lineno"> 7233</span>&#160;               <span class="keywordflow">if</span> (!sig_pri_attempt_transfer(pri, e-&gt;hangup.call_held, 1,</div><div class="line"><a name="l07234"></a><span class="lineno"> 7234</span>&#160;                  e-&gt;hangup.call_active, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l07235"></a><span class="lineno"> 7235</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l07236"></a><span class="lineno"> 7236</span>&#160;               }</div><div class="line"><a name="l07237"></a><span class="lineno"> 7237</span>&#160;               sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07238"></a><span class="lineno"> 7238</span>&#160;            }</div><div class="line"><a name="l07239"></a><span class="lineno"> 7239</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07240"></a><span class="lineno"> 7240</span>&#160;            <span class="keywordflow">switch</span> (e-&gt;hangup.cause) {</div><div class="line"><a name="l07241"></a><span class="lineno"> 7241</span>&#160;            <span class="keywordflow">case</span> PRI_CAUSE_USER_BUSY:</div><div class="line"><a name="l07242"></a><span class="lineno"> 7242</span>&#160;            <span class="keywordflow">case</span> PRI_CAUSE_NORMAL_CIRCUIT_CONGESTION:</div><div class="line"><a name="l07243"></a><span class="lineno"> 7243</span>&#160;               sig_pri_cc_generic_check(pri, chanpos, <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530a64c2fae63ae9df0696a2092477c6fcb2">AST_CC_CCBS</a>);</div><div class="line"><a name="l07244"></a><span class="lineno"> 7244</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07245"></a><span class="lineno"> 7245</span>&#160;            <span class="keywordflow">case</span> PRI_CAUSE_INVALID_CALL_REFERENCE:</div><div class="line"><a name="l07246"></a><span class="lineno"> 7246</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l07247"></a><span class="lineno"> 7247</span>&#160;<span class="comment">                * The peer denies the existence of this call so we must</span></div><div class="line"><a name="l07248"></a><span class="lineno"> 7248</span>&#160;<span class="comment">                * continue hanging it up and forget about it.  We should not</span></div><div class="line"><a name="l07249"></a><span class="lineno"> 7249</span>&#160;<span class="comment">                * get this cause here, but for completeness we will handle it</span></div><div class="line"><a name="l07250"></a><span class="lineno"> 7250</span>&#160;<span class="comment">                * anyway.</span></div><div class="line"><a name="l07251"></a><span class="lineno"> 7251</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l07252"></a><span class="lineno"> 7252</span>&#160;               pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;hangup.call, e-&gt;hangup.cause);</div><div class="line"><a name="l07253"></a><span class="lineno"> 7253</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07254"></a><span class="lineno"> 7254</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07255"></a><span class="lineno"> 7255</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l07256"></a><span class="lineno"> 7256</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07257"></a><span class="lineno"> 7257</span>&#160;            }</div><div class="line"><a name="l07258"></a><span class="lineno"> 7258</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l07259"></a><span class="lineno"> 7259</span>&#160;               snprintf(cause_str, <span class="keyword">sizeof</span>(cause_str), <span class="stringliteral">&quot;PRI PRI_EVENT_HANGUP_REQ (%d)&quot;</span>, e-&gt;hangup.cause);</div><div class="line"><a name="l07260"></a><span class="lineno"> 7260</span>&#160;               pri_queue_pvt_cause_data(pri, chanpos, cause_str, e-&gt;hangup.cause);</div><div class="line"><a name="l07261"></a><span class="lineno"> 7261</span>&#160;            }</div><div class="line"><a name="l07262"></a><span class="lineno"> 7262</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l07263"></a><span class="lineno"> 7263</span>&#160;               <span class="keywordtype">int</span> do_hangup = 0;</div><div class="line"><a name="l07264"></a><span class="lineno"> 7264</span>&#160;</div><div class="line"><a name="l07265"></a><span class="lineno"> 7265</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, e-&gt;hangup.cause);</div><div class="line"><a name="l07266"></a><span class="lineno"> 7266</span>&#160;               <span class="keywordflow">switch</span> (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {</div><div class="line"><a name="l07267"></a><span class="lineno"> 7267</span>&#160;               <span class="keywordflow">case</span> <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591">AST_STATE_BUSY</a>:</div><div class="line"><a name="l07268"></a><span class="lineno"> 7268</span>&#160;               <span class="keywordflow">case</span> <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>:</div><div class="line"><a name="l07269"></a><span class="lineno"> 7269</span>&#160;                  do_hangup = 1;</div><div class="line"><a name="l07270"></a><span class="lineno"> 7270</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l07271"></a><span class="lineno"> 7271</span>&#160;               <span class="keywordflow">default</span>:</div><div class="line"><a name="l07272"></a><span class="lineno"> 7272</span>&#160;                  <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a>) {</div><div class="line"><a name="l07273"></a><span class="lineno"> 7273</span>&#160;                     <span class="comment">/*</span></div><div class="line"><a name="l07274"></a><span class="lineno"> 7274</span>&#160;<span class="comment">                      * The incoming call leg hung up before getting</span></div><div class="line"><a name="l07275"></a><span class="lineno"> 7275</span>&#160;<span class="comment">                      * connected so just hangup the call.</span></div><div class="line"><a name="l07276"></a><span class="lineno"> 7276</span>&#160;<span class="comment">                      */</span></div><div class="line"><a name="l07277"></a><span class="lineno"> 7277</span>&#160;                     do_hangup = 1;</div><div class="line"><a name="l07278"></a><span class="lineno"> 7278</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l07279"></a><span class="lineno"> 7279</span>&#160;                  }</div><div class="line"><a name="l07280"></a><span class="lineno"> 7280</span>&#160;                  <span class="keywordflow">switch</span> (e-&gt;hangup.cause) {</div><div class="line"><a name="l07281"></a><span class="lineno"> 7281</span>&#160;                  <span class="keywordflow">case</span> PRI_CAUSE_USER_BUSY:</div><div class="line"><a name="l07282"></a><span class="lineno"> 7282</span>&#160;                     pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>);</div><div class="line"><a name="l07283"></a><span class="lineno"> 7283</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l07284"></a><span class="lineno"> 7284</span>&#160;                  <span class="keywordflow">case</span> PRI_CAUSE_CALL_REJECTED:</div><div class="line"><a name="l07285"></a><span class="lineno"> 7285</span>&#160;                  <span class="keywordflow">case</span> PRI_CAUSE_NETWORK_OUT_OF_ORDER:</div><div class="line"><a name="l07286"></a><span class="lineno"> 7286</span>&#160;                  <span class="keywordflow">case</span> PRI_CAUSE_NORMAL_CIRCUIT_CONGESTION:</div><div class="line"><a name="l07287"></a><span class="lineno"> 7287</span>&#160;                  <span class="keywordflow">case</span> PRI_CAUSE_SWITCH_CONGESTION:</div><div class="line"><a name="l07288"></a><span class="lineno"> 7288</span>&#160;                  <span class="keywordflow">case</span> PRI_CAUSE_DESTINATION_OUT_OF_ORDER:</div><div class="line"><a name="l07289"></a><span class="lineno"> 7289</span>&#160;                  <span class="keywordflow">case</span> PRI_CAUSE_NORMAL_TEMPORARY_FAILURE:</div><div class="line"><a name="l07290"></a><span class="lineno"> 7290</span>&#160;                     pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>);</div><div class="line"><a name="l07291"></a><span class="lineno"> 7291</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l07292"></a><span class="lineno"> 7292</span>&#160;                  <span class="keywordflow">default</span>:</div><div class="line"><a name="l07293"></a><span class="lineno"> 7293</span>&#160;                     do_hangup = 1;</div><div class="line"><a name="l07294"></a><span class="lineno"> 7294</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l07295"></a><span class="lineno"> 7295</span>&#160;                  }</div><div class="line"><a name="l07296"></a><span class="lineno"> 7296</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l07297"></a><span class="lineno"> 7297</span>&#160;               }</div><div class="line"><a name="l07298"></a><span class="lineno"> 7298</span>&#160;</div><div class="line"><a name="l07299"></a><span class="lineno"> 7299</span>&#160;               <span class="keywordflow">if</span> (do_hangup) {</div><div class="line"><a name="l07300"></a><span class="lineno"> 7300</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l07301"></a><span class="lineno"> 7301</span>&#160;                  <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;holding_aoce</div><div class="line"><a name="l07302"></a><span class="lineno"> 7302</span>&#160;                     &amp;&amp; pri-&gt;aoce_delayhangup</div><div class="line"><a name="l07303"></a><span class="lineno"> 7303</span>&#160;                     &amp;&amp; <a class="code" href="../../d5/d7b/channel_8h.html#aa0a52e573af67cb0f29095177128d186">ast_channel_is_bridged</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {</div><div class="line"><a name="l07304"></a><span class="lineno"> 7304</span>&#160;                     sig_pri_send_aoce_termination_request(pri, chanpos,</div><div class="line"><a name="l07305"></a><span class="lineno"> 7305</span>&#160;                        pri_get_timer(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, PRI_TIMER_T305) / 2);</div><div class="line"><a name="l07306"></a><span class="lineno"> 7306</span>&#160;                  } <span class="keywordflow">else</span></div><div class="line"><a name="l07307"></a><span class="lineno"> 7307</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07308"></a><span class="lineno"> 7308</span>&#160;                  {</div><div class="line"><a name="l07309"></a><span class="lineno"> 7309</span>&#160;                     sig_pri_queue_hangup(pri, chanpos);</div><div class="line"><a name="l07310"></a><span class="lineno"> 7310</span>&#160;                  }</div><div class="line"><a name="l07311"></a><span class="lineno"> 7311</span>&#160;               }</div><div class="line"><a name="l07312"></a><span class="lineno"> 7312</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Span %d: Channel %d/%d got hangup request, cause %d\n&quot;</span>,</div><div class="line"><a name="l07313"></a><span class="lineno"> 7313</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>,</div><div class="line"><a name="l07314"></a><span class="lineno"> 7314</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>, e-&gt;hangup.cause);</div><div class="line"><a name="l07315"></a><span class="lineno"> 7315</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07316"></a><span class="lineno"> 7316</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l07317"></a><span class="lineno"> 7317</span>&#160;<span class="comment">                * Continue hanging up the call even though</span></div><div class="line"><a name="l07318"></a><span class="lineno"> 7318</span>&#160;<span class="comment">                * we do not have an owner.</span></div><div class="line"><a name="l07319"></a><span class="lineno"> 7319</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l07320"></a><span class="lineno"> 7320</span>&#160;               pri_hangup(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, e-&gt;hangup.cause);</div><div class="line"><a name="l07321"></a><span class="lineno"> 7321</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07322"></a><span class="lineno"> 7322</span>&#160;            }</div><div class="line"><a name="l07323"></a><span class="lineno"> 7323</span>&#160;            <span class="keywordflow">if</span> (e-&gt;hangup.cause == PRI_CAUSE_REQUESTED_CHAN_UNAVAIL</div><div class="line"><a name="l07324"></a><span class="lineno"> 7324</span>&#160;               &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="../../d5/db3/chan__dahdi_8h.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a> &amp;&amp; !pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a></div><div class="line"><a name="l07325"></a><span class="lineno"> 7325</span>&#160;               &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad44ab156cfb784ec704fbd1d4faec1ea">force_restart_unavailable_chans</a></div><div class="line"><a name="l07326"></a><span class="lineno"> 7326</span>&#160;               &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> == <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3">SIG_PRI_RESET_IDLE</a>) {</div><div class="line"><a name="l07327"></a><span class="lineno"> 7327</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,</div><div class="line"><a name="l07328"></a><span class="lineno"> 7328</span>&#160;                  <span class="stringliteral">&quot;Span %d: Forcing restart of channel %d/%d since channel reported in use\n&quot;</span>,</div><div class="line"><a name="l07329"></a><span class="lineno"> 7329</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>,</div><div class="line"><a name="l07330"></a><span class="lineno"> 7330</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>);</div><div class="line"><a name="l07331"></a><span class="lineno"> 7331</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaad73773a22eaed64af27f4c0905f239dc">SIG_PRI_RESET_ACTIVE</a>;</div><div class="line"><a name="l07332"></a><span class="lineno"> 7332</span>&#160;               pri_reset(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, PVT_TO_CHANNEL(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]));</div><div class="line"><a name="l07333"></a><span class="lineno"> 7333</span>&#160;            }</div><div class="line"><a name="l07334"></a><span class="lineno"> 7334</span>&#160;</div><div class="line"><a name="l07335"></a><span class="lineno"> 7335</span>&#160;<span class="preprocessor">#ifdef SUPPORT_USERUSER</span></div><div class="line"><a name="l07336"></a><span class="lineno"> 7336</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(e-&gt;hangup.useruserinfo)) {</div><div class="line"><a name="l07337"></a><span class="lineno"> 7337</span>&#160;               <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner;</div><div class="line"><a name="l07338"></a><span class="lineno"> 7338</span>&#160;</div><div class="line"><a name="l07339"></a><span class="lineno"> 7339</span>&#160;               sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l07340"></a><span class="lineno"> 7340</span>&#160;               owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l07341"></a><span class="lineno"> 7341</span>&#160;               <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l07342"></a><span class="lineno"> 7342</span>&#160;                  <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;USERUSERINFO&quot;</span>,</div><div class="line"><a name="l07343"></a><span class="lineno"> 7343</span>&#160;                     e-&gt;hangup.useruserinfo);</div><div class="line"><a name="l07344"></a><span class="lineno"> 7344</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l07345"></a><span class="lineno"> 7345</span>&#160;               }</div><div class="line"><a name="l07346"></a><span class="lineno"> 7346</span>&#160;            }</div><div class="line"><a name="l07347"></a><span class="lineno"> 7347</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l07348"></a><span class="lineno"> 7348</span>&#160;</div><div class="line"><a name="l07349"></a><span class="lineno"> 7349</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07350"></a><span class="lineno"> 7350</span>&#160;            sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l07351"></a><span class="lineno"> 7351</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07352"></a><span class="lineno"> 7352</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_HANGUP_ACK:</div><div class="line"><a name="l07353"></a><span class="lineno"> 7353</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;hangup.channel)) {</div><div class="line"><a name="l07354"></a><span class="lineno"> 7354</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;hangup.subcmds,</div><div class="line"><a name="l07355"></a><span class="lineno"> 7355</span>&#160;                  e-&gt;hangup.call);</div><div class="line"><a name="l07356"></a><span class="lineno"> 7356</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07357"></a><span class="lineno"> 7357</span>&#160;            }</div><div class="line"><a name="l07358"></a><span class="lineno"> 7358</span>&#160;            chanpos = pri_find_principle_by_call(pri, e-&gt;hangup.call);</div><div class="line"><a name="l07359"></a><span class="lineno"> 7359</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l07360"></a><span class="lineno"> 7360</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07361"></a><span class="lineno"> 7361</span>&#160;            }</div><div class="line"><a name="l07362"></a><span class="lineno"> 7362</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07363"></a><span class="lineno"> 7363</span>&#160;</div><div class="line"><a name="l07364"></a><span class="lineno"> 7364</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l07365"></a><span class="lineno"> 7365</span>&#160;</div><div class="line"><a name="l07366"></a><span class="lineno"> 7366</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07367"></a><span class="lineno"> 7367</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l07368"></a><span class="lineno"> 7368</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Span %d: Channel %d/%d got hangup ACK\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>,</div><div class="line"><a name="l07369"></a><span class="lineno"> 7369</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>);</div><div class="line"><a name="l07370"></a><span class="lineno"> 7370</span>&#160;            }</div><div class="line"><a name="l07371"></a><span class="lineno"> 7371</span>&#160;<span class="preprocessor">#ifdef SUPPORT_USERUSER</span></div><div class="line"><a name="l07372"></a><span class="lineno"> 7372</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(e-&gt;hangup.useruserinfo)) {</div><div class="line"><a name="l07373"></a><span class="lineno"> 7373</span>&#160;               <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *owner;</div><div class="line"><a name="l07374"></a><span class="lineno"> 7374</span>&#160;</div><div class="line"><a name="l07375"></a><span class="lineno"> 7375</span>&#160;               sig_pri_lock_owner(pri, chanpos);</div><div class="line"><a name="l07376"></a><span class="lineno"> 7376</span>&#160;               owner = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l07377"></a><span class="lineno"> 7377</span>&#160;               <span class="keywordflow">if</span> (owner) {</div><div class="line"><a name="l07378"></a><span class="lineno"> 7378</span>&#160;                  <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(owner, <span class="stringliteral">&quot;USERUSERINFO&quot;</span>,</div><div class="line"><a name="l07379"></a><span class="lineno"> 7379</span>&#160;                     e-&gt;hangup.useruserinfo);</div><div class="line"><a name="l07380"></a><span class="lineno"> 7380</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(owner);</div><div class="line"><a name="l07381"></a><span class="lineno"> 7381</span>&#160;               }</div><div class="line"><a name="l07382"></a><span class="lineno"> 7382</span>&#160;            }</div><div class="line"><a name="l07383"></a><span class="lineno"> 7383</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l07384"></a><span class="lineno"> 7384</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07385"></a><span class="lineno"> 7385</span>&#160;            sig_pri_span_devstate_changed(pri);</div><div class="line"><a name="l07386"></a><span class="lineno"> 7386</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07387"></a><span class="lineno"> 7387</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_CONFIG_ERR:</div><div class="line"><a name="l07388"></a><span class="lineno"> 7388</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;PRI Error on span %d: %s\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, e-&gt;err.err);</div><div class="line"><a name="l07389"></a><span class="lineno"> 7389</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07390"></a><span class="lineno"> 7390</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_RESTART_ACK:</div><div class="line"><a name="l07391"></a><span class="lineno"> 7391</span>&#160;            chanpos = pri_find_principle(pri, e-&gt;restartack.channel, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l07392"></a><span class="lineno"> 7392</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l07393"></a><span class="lineno"> 7393</span>&#160;               <span class="comment">/* Sometime switches (e.g. I421 / British Telecom) don&#39;t give us the</span></div><div class="line"><a name="l07394"></a><span class="lineno"> 7394</span>&#160;<span class="comment">                  channel number, so we have to figure it out...  This must be why</span></div><div class="line"><a name="l07395"></a><span class="lineno"> 7395</span>&#160;<span class="comment">                  everybody resets exactly a channel at a time. */</span></div><div class="line"><a name="l07396"></a><span class="lineno"> 7396</span>&#160;               <span class="keywordflow">for</span> (x = 0; x &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; x++) {</div><div class="line"><a name="l07397"></a><span class="lineno"> 7397</span>&#160;                  <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]</div><div class="line"><a name="l07398"></a><span class="lineno"> 7398</span>&#160;                     &amp;&amp; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[x]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> != <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3">SIG_PRI_RESET_IDLE</a>) {</div><div class="line"><a name="l07399"></a><span class="lineno"> 7399</span>&#160;                     chanpos = <a class="code" href="../../df/d3c/structast__channel.html#ab06e9aa782b61ccfb42f7c48996f6ed4">x</a>;</div><div class="line"><a name="l07400"></a><span class="lineno"> 7400</span>&#160;                     sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07401"></a><span class="lineno"> 7401</span>&#160;                     <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1,</div><div class="line"><a name="l07402"></a><span class="lineno"> 7402</span>&#160;                        <span class="stringliteral">&quot;Span %d: Assuming restart ack is for channel %d/%d\n&quot;</span>,</div><div class="line"><a name="l07403"></a><span class="lineno"> 7403</span>&#160;                        pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>,</div><div class="line"><a name="l07404"></a><span class="lineno"> 7404</span>&#160;                        pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>);</div><div class="line"><a name="l07405"></a><span class="lineno"> 7405</span>&#160;                     <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l07406"></a><span class="lineno"> 7406</span>&#160;                        <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l07407"></a><span class="lineno"> 7407</span>&#160;                           <span class="stringliteral">&quot;Span %d: Got restart ack on channel %d/%d with owner\n&quot;</span>,</div><div class="line"><a name="l07408"></a><span class="lineno"> 7408</span>&#160;                           pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>,</div><div class="line"><a name="l07409"></a><span class="lineno"> 7409</span>&#160;                           pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>);</div><div class="line"><a name="l07410"></a><span class="lineno"> 7410</span>&#160;                        <a class="code" href="../../d5/d7b/channel_8h.html#ab683c21c4a34450c4bfb8b672a7b4045">ast_channel_softhangup_internal_flag_add</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);</div><div class="line"><a name="l07411"></a><span class="lineno"> 7411</span>&#160;                     }</div><div class="line"><a name="l07412"></a><span class="lineno"> 7412</span>&#160;                     pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3">SIG_PRI_RESET_IDLE</a>;</div><div class="line"><a name="l07413"></a><span class="lineno"> 7413</span>&#160;                     <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,</div><div class="line"><a name="l07414"></a><span class="lineno"> 7414</span>&#160;                        <span class="stringliteral">&quot;Span %d: Channel %d/%d successfully restarted\n&quot;</span>,</div><div class="line"><a name="l07415"></a><span class="lineno"> 7415</span>&#160;                        pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>,</div><div class="line"><a name="l07416"></a><span class="lineno"> 7416</span>&#160;                        pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>);</div><div class="line"><a name="l07417"></a><span class="lineno"> 7417</span>&#160;                     sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07418"></a><span class="lineno"> 7418</span>&#160;                     <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a>)</div><div class="line"><a name="l07419"></a><span class="lineno"> 7419</span>&#160;                        pri_check_restart(pri);</div><div class="line"><a name="l07420"></a><span class="lineno"> 7420</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l07421"></a><span class="lineno"> 7421</span>&#160;                  }</div><div class="line"><a name="l07422"></a><span class="lineno"> 7422</span>&#160;               }</div><div class="line"><a name="l07423"></a><span class="lineno"> 7423</span>&#160;               <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l07424"></a><span class="lineno"> 7424</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l07425"></a><span class="lineno"> 7425</span>&#160;                     <span class="stringliteral">&quot;Span %d: Restart ACK on strange channel %d/%d\n&quot;</span>,</div><div class="line"><a name="l07426"></a><span class="lineno"> 7426</span>&#160;                     pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, PRI_SPAN(e-&gt;restartack.channel),</div><div class="line"><a name="l07427"></a><span class="lineno"> 7427</span>&#160;                     PRI_CHANNEL(e-&gt;restartack.channel));</div><div class="line"><a name="l07428"></a><span class="lineno"> 7428</span>&#160;               }</div><div class="line"><a name="l07429"></a><span class="lineno"> 7429</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07430"></a><span class="lineno"> 7430</span>&#160;               sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07431"></a><span class="lineno"> 7431</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> == <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3">SIG_PRI_RESET_IDLE</a>) {</div><div class="line"><a name="l07432"></a><span class="lineno"> 7432</span>&#160;                  <span class="comment">/* The channel is not in the resetting state. */</span></div><div class="line"><a name="l07433"></a><span class="lineno"> 7433</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1,</div><div class="line"><a name="l07434"></a><span class="lineno"> 7434</span>&#160;                     <span class="stringliteral">&quot;Span %d: Unexpected or late restart ack on channel %d/%d (Ignoring)\n&quot;</span>,</div><div class="line"><a name="l07435"></a><span class="lineno"> 7435</span>&#160;                     pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>,</div><div class="line"><a name="l07436"></a><span class="lineno"> 7436</span>&#160;                     pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>);</div><div class="line"><a name="l07437"></a><span class="lineno"> 7437</span>&#160;                  sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07438"></a><span class="lineno"> 7438</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l07439"></a><span class="lineno"> 7439</span>&#160;               }</div><div class="line"><a name="l07440"></a><span class="lineno"> 7440</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l07441"></a><span class="lineno"> 7441</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l07442"></a><span class="lineno"> 7442</span>&#160;                     <span class="stringliteral">&quot;Span %d: Got restart ack on channel %d/%d with owner\n&quot;</span>,</div><div class="line"><a name="l07443"></a><span class="lineno"> 7443</span>&#160;                     pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>,</div><div class="line"><a name="l07444"></a><span class="lineno"> 7444</span>&#160;                     pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>);</div><div class="line"><a name="l07445"></a><span class="lineno"> 7445</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#ab683c21c4a34450c4bfb8b672a7b4045">ast_channel_softhangup_internal_flag_add</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);</div><div class="line"><a name="l07446"></a><span class="lineno"> 7446</span>&#160;               }</div><div class="line"><a name="l07447"></a><span class="lineno"> 7447</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">resetting</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3">SIG_PRI_RESET_IDLE</a>;</div><div class="line"><a name="l07448"></a><span class="lineno"> 7448</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,</div><div class="line"><a name="l07449"></a><span class="lineno"> 7449</span>&#160;                  <span class="stringliteral">&quot;Span %d: Channel %d/%d successfully restarted\n&quot;</span>,</div><div class="line"><a name="l07450"></a><span class="lineno"> 7450</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>,</div><div class="line"><a name="l07451"></a><span class="lineno"> 7451</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a>);</div><div class="line"><a name="l07452"></a><span class="lineno"> 7452</span>&#160;               sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07453"></a><span class="lineno"> 7453</span>&#160;               <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">resetting</a>)</div><div class="line"><a name="l07454"></a><span class="lineno"> 7454</span>&#160;                  pri_check_restart(pri);</div><div class="line"><a name="l07455"></a><span class="lineno"> 7455</span>&#160;            }</div><div class="line"><a name="l07456"></a><span class="lineno"> 7456</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07457"></a><span class="lineno"> 7457</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_SETUP_ACK:</div><div class="line"><a name="l07458"></a><span class="lineno"> 7458</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;setup_ack.channel)) {</div><div class="line"><a name="l07459"></a><span class="lineno"> 7459</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;setup_ack.subcmds,</div><div class="line"><a name="l07460"></a><span class="lineno"> 7460</span>&#160;                  e-&gt;setup_ack.call);</div><div class="line"><a name="l07461"></a><span class="lineno"> 7461</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07462"></a><span class="lineno"> 7462</span>&#160;            }</div><div class="line"><a name="l07463"></a><span class="lineno"> 7463</span>&#160;            chanpos = pri_find_fixup_principle(pri, e-&gt;setup_ack.channel,</div><div class="line"><a name="l07464"></a><span class="lineno"> 7464</span>&#160;               e-&gt;setup_ack.call);</div><div class="line"><a name="l07465"></a><span class="lineno"> 7465</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l07466"></a><span class="lineno"> 7466</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07467"></a><span class="lineno"> 7467</span>&#160;            }</div><div class="line"><a name="l07468"></a><span class="lineno"> 7468</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07469"></a><span class="lineno"> 7469</span>&#160;</div><div class="line"><a name="l07470"></a><span class="lineno"> 7470</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l07471"></a><span class="lineno"> 7471</span>&#160;</div><div class="line"><a name="l07472"></a><span class="lineno"> 7472</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;setup_ack.subcmds,</div><div class="line"><a name="l07473"></a><span class="lineno"> 7473</span>&#160;               e-&gt;setup_ack.call);</div><div class="line"><a name="l07474"></a><span class="lineno"> 7474</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a56a6bdb3a08f47f53f414ba014b47980">SIG_PRI_CALL_LEVEL_OVERLAP</a>) {</div><div class="line"><a name="l07475"></a><span class="lineno"> 7475</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a56a6bdb3a08f47f53f414ba014b47980">SIG_PRI_CALL_LEVEL_OVERLAP</a>;</div><div class="line"><a name="l07476"></a><span class="lineno"> 7476</span>&#160;            }</div><div class="line"><a name="l07477"></a><span class="lineno"> 7477</span>&#160;</div><div class="line"><a name="l07478"></a><span class="lineno"> 7478</span>&#160;            <span class="comment">/* Send any queued digits */</span></div><div class="line"><a name="l07479"></a><span class="lineno"> 7479</span>&#160;            len = strlen(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a0368d49962f1bf26c2603ade03cd8ee9">dialdest</a>);</div><div class="line"><a name="l07480"></a><span class="lineno"> 7480</span>&#160;            <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>; ++<a class="code" href="../../df/d3c/structast__channel.html#ab06e9aa782b61ccfb42f7c48996f6ed4">x</a>) {</div><div class="line"><a name="l07481"></a><span class="lineno"> 7481</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Sending pending digit &#39;%c&#39;\n&quot;</span>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a0368d49962f1bf26c2603ade03cd8ee9">dialdest</a>[x]);</div><div class="line"><a name="l07482"></a><span class="lineno"> 7482</span>&#160;               pri_information(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>,</div><div class="line"><a name="l07483"></a><span class="lineno"> 7483</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a0368d49962f1bf26c2603ade03cd8ee9">dialdest</a>[x]);</div><div class="line"><a name="l07484"></a><span class="lineno"> 7484</span>&#160;            }</div><div class="line"><a name="l07485"></a><span class="lineno"> 7485</span>&#160;</div><div class="line"><a name="l07486"></a><span class="lineno"> 7486</span>&#160;            <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a></div><div class="line"><a name="l07487"></a><span class="lineno"> 7487</span>&#160;               &amp;&amp; (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">overlapdial</a> &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a4bccf90ead0cf7c93b177e59cbe5b3be">DAHDI_OVERLAPDIAL_OUTGOING</a>)</div><div class="line"><a name="l07488"></a><span class="lineno"> 7488</span>&#160;               &amp;&amp; !pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf54768a4327f86de3a234648305c4a4">digital</a></div><div class="line"><a name="l07489"></a><span class="lineno"> 7489</span>&#160;               &amp;&amp; !pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a></div><div class="line"><a name="l07490"></a><span class="lineno"> 7490</span>&#160;#<span class="keywordflow">if</span> defined(HAVE_PRI_SETUP_ACK_INBAND)</div><div class="line"><a name="l07491"></a><span class="lineno"> 7491</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l07492"></a><span class="lineno"> 7492</span>&#160;<span class="comment">                * We only care about PRI_PROG_INBAND_AVAILABLE to open the</span></div><div class="line"><a name="l07493"></a><span class="lineno"> 7493</span>&#160;<span class="comment">                * voice path.</span></div><div class="line"><a name="l07494"></a><span class="lineno"> 7494</span>&#160;<span class="comment">                *</span></div><div class="line"><a name="l07495"></a><span class="lineno"> 7495</span>&#160;<span class="comment">                * We explicitly DO NOT want to check PRI_PROG_CALL_NOT_E2E_ISDN</span></div><div class="line"><a name="l07496"></a><span class="lineno"> 7496</span>&#160;<span class="comment">                * because it will mess up ISDN to SIP interoperability for</span></div><div class="line"><a name="l07497"></a><span class="lineno"> 7497</span>&#160;<span class="comment">                * the ALERTING message.</span></div><div class="line"><a name="l07498"></a><span class="lineno"> 7498</span>&#160;<span class="comment">                *</span></div><div class="line"><a name="l07499"></a><span class="lineno"> 7499</span>&#160;<span class="comment">                * Q.931 Section 5.1.3 says that in scenarios with overlap</span></div><div class="line"><a name="l07500"></a><span class="lineno"> 7500</span>&#160;<span class="comment">                * dialing where no called digits are received and the tone</span></div><div class="line"><a name="l07501"></a><span class="lineno"> 7501</span>&#160;<span class="comment">                * option requires dialtone, the switch MAY send an inband</span></div><div class="line"><a name="l07502"></a><span class="lineno"> 7502</span>&#160;<span class="comment">                * progress indication ie to indicate dialtone presence in</span></div><div class="line"><a name="l07503"></a><span class="lineno"> 7503</span>&#160;<span class="comment">                * the SETUP ACKNOWLEDGE.  Therefore, if we did not send any</span></div><div class="line"><a name="l07504"></a><span class="lineno"> 7504</span>&#160;<span class="comment">                * digits with the SETUP then we must assume that dialtone</span></div><div class="line"><a name="l07505"></a><span class="lineno"> 7505</span>&#160;<span class="comment">                * is present and open the voice path.  Fortunately when</span></div><div class="line"><a name="l07506"></a><span class="lineno"> 7506</span>&#160;<span class="comment">                * interoperating with SIP, we should be sending digits.</span></div><div class="line"><a name="l07507"></a><span class="lineno"> 7507</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l07508"></a><span class="lineno"> 7508</span>&#160;               &amp;&amp; ((e-&gt;setup_ack.progressmask &amp; PRI_PROG_INBAND_AVAILABLE)</div><div class="line"><a name="l07509"></a><span class="lineno"> 7509</span>&#160;                  || pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3bfe76d33901513c27781d0d5a1b07dd">inband_on_setup_ack</a></div><div class="line"><a name="l07510"></a><span class="lineno"> 7510</span>&#160;                  || pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;no_dialed_digits)</div><div class="line"><a name="l07511"></a><span class="lineno"> 7511</span>&#160;#endif   <span class="comment">/* defined(HAVE_PRI_SETUP_ACK_INBAND) */</span></div><div class="line"><a name="l07512"></a><span class="lineno"> 7512</span>&#160;               ) {</div><div class="line"><a name="l07513"></a><span class="lineno"> 7513</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l07514"></a><span class="lineno"> 7514</span>&#160;<span class="comment">                * Call has a channel.</span></div><div class="line"><a name="l07515"></a><span class="lineno"> 7515</span>&#160;<span class="comment">                * Indicate for overlap dialing that dialtone may be present.</span></div><div class="line"><a name="l07516"></a><span class="lineno"> 7516</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l07517"></a><span class="lineno"> 7517</span>&#160;               pri_queue_control(pri, chanpos, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>);</div><div class="line"><a name="l07518"></a><span class="lineno"> 7518</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> = 1;<span class="comment">/* Claim to have seen inband-information */</span></div><div class="line"><a name="l07519"></a><span class="lineno"> 7519</span>&#160;               sig_pri_set_dialing(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos], 0);</div><div class="line"><a name="l07520"></a><span class="lineno"> 7520</span>&#160;               sig_pri_open_media(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07521"></a><span class="lineno"> 7521</span>&#160;            }</div><div class="line"><a name="l07522"></a><span class="lineno"> 7522</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07523"></a><span class="lineno"> 7523</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07524"></a><span class="lineno"> 7524</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_NOTIFY:</div><div class="line"><a name="l07525"></a><span class="lineno"> 7525</span>&#160;            <span class="keywordflow">if</span> (sig_pri_is_cis_call(e-&gt;notify.channel)) {</div><div class="line"><a name="l07526"></a><span class="lineno"> 7526</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l07527"></a><span class="lineno"> 7527</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;notify.subcmds,</div><div class="line"><a name="l07528"></a><span class="lineno"> 7528</span>&#160;                  e-&gt;notify.call);</div><div class="line"><a name="l07529"></a><span class="lineno"> 7529</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l07530"></a><span class="lineno"> 7530</span>&#160;               sig_pri_handle_cis_subcmds(pri, e-&gt;e, e-&gt;notify.subcmds, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l07531"></a><span class="lineno"> 7531</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* !defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07532"></a><span class="lineno"> 7532</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07533"></a><span class="lineno"> 7533</span>&#160;            }</div><div class="line"><a name="l07534"></a><span class="lineno"> 7534</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l07535"></a><span class="lineno"> 7535</span>&#160;            chanpos = pri_find_principle_by_call(pri, e-&gt;notify.call);</div><div class="line"><a name="l07536"></a><span class="lineno"> 7536</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l07537"></a><span class="lineno"> 7537</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Span %d: Received NOTIFY for unknown call.\n&quot;</span>,</div><div class="line"><a name="l07538"></a><span class="lineno"> 7538</span>&#160;                  pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l07539"></a><span class="lineno"> 7539</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07540"></a><span class="lineno"> 7540</span>&#160;            }</div><div class="line"><a name="l07541"></a><span class="lineno"> 7541</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l07542"></a><span class="lineno"> 7542</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l07543"></a><span class="lineno"> 7543</span>&#160;<span class="comment">             * This version of libpri does not supply a call pointer for</span></div><div class="line"><a name="l07544"></a><span class="lineno"> 7544</span>&#160;<span class="comment">             * this message.  We are just going to have to trust that the</span></div><div class="line"><a name="l07545"></a><span class="lineno"> 7545</span>&#160;<span class="comment">             * correct principle is found.</span></div><div class="line"><a name="l07546"></a><span class="lineno"> 7546</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l07547"></a><span class="lineno"> 7547</span>&#160;            chanpos = pri_find_principle(pri, e-&gt;notify.channel, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l07548"></a><span class="lineno"> 7548</span>&#160;            <span class="keywordflow">if</span> (chanpos &lt; 0) {</div><div class="line"><a name="l07549"></a><span class="lineno"> 7549</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Received NOTIFY on unconfigured channel %d/%d span %d\n&quot;</span>,</div><div class="line"><a name="l07550"></a><span class="lineno"> 7550</span>&#160;                  PRI_SPAN(e-&gt;notify.channel), PRI_CHANNEL(e-&gt;notify.channel), pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);</div><div class="line"><a name="l07551"></a><span class="lineno"> 7551</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07552"></a><span class="lineno"> 7552</span>&#160;            }</div><div class="line"><a name="l07553"></a><span class="lineno"> 7553</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* !defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07554"></a><span class="lineno"> 7554</span>&#160;            sig_pri_lock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07555"></a><span class="lineno"> 7555</span>&#160;</div><div class="line"><a name="l07556"></a><span class="lineno"> 7556</span>&#160;            callid = func_pri_dchannel_chanpos_callid(pri, chanpos);</div><div class="line"><a name="l07557"></a><span class="lineno"> 7557</span>&#160;</div><div class="line"><a name="l07558"></a><span class="lineno"> 7558</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l07559"></a><span class="lineno"> 7559</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;notify.subcmds,</div><div class="line"><a name="l07560"></a><span class="lineno"> 7560</span>&#160;               e-&gt;notify.call);</div><div class="line"><a name="l07561"></a><span class="lineno"> 7561</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l07562"></a><span class="lineno"> 7562</span>&#160;            sig_pri_handle_subcmds(pri, chanpos, e-&gt;e, e-&gt;notify.subcmds, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l07563"></a><span class="lineno"> 7563</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* !defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07564"></a><span class="lineno"> 7564</span>&#160;            <span class="keywordflow">switch</span> (e-&gt;notify.info) {</div><div class="line"><a name="l07565"></a><span class="lineno"> 7565</span>&#160;            <span class="keywordflow">case</span> PRI_NOTIFY_REMOTE_HOLD:</div><div class="line"><a name="l07566"></a><span class="lineno"> 7566</span>&#160;               <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a4a3d11608d70f167d526b4b2312fec9c">discardremoteholdretrieval</a>) {</div><div class="line"><a name="l07567"></a><span class="lineno"> 7567</span>&#160;                  sig_pri_queue_hold(pri, chanpos);</div><div class="line"><a name="l07568"></a><span class="lineno"> 7568</span>&#160;               }</div><div class="line"><a name="l07569"></a><span class="lineno"> 7569</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07570"></a><span class="lineno"> 7570</span>&#160;            <span class="keywordflow">case</span> PRI_NOTIFY_REMOTE_RETRIEVAL:</div><div class="line"><a name="l07571"></a><span class="lineno"> 7571</span>&#160;               <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a4a3d11608d70f167d526b4b2312fec9c">discardremoteholdretrieval</a>) {</div><div class="line"><a name="l07572"></a><span class="lineno"> 7572</span>&#160;                  sig_pri_queue_unhold(pri, chanpos);</div><div class="line"><a name="l07573"></a><span class="lineno"> 7573</span>&#160;               }</div><div class="line"><a name="l07574"></a><span class="lineno"> 7574</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07575"></a><span class="lineno"> 7575</span>&#160;            }</div><div class="line"><a name="l07576"></a><span class="lineno"> 7576</span>&#160;            sig_pri_unlock_private(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[chanpos]);</div><div class="line"><a name="l07577"></a><span class="lineno"> 7577</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07578"></a><span class="lineno"> 7578</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l07579"></a><span class="lineno"> 7579</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_HOLD:</div><div class="line"><a name="l07580"></a><span class="lineno"> 7580</span>&#160;            <span class="comment">/* We should not be getting any CIS calls with this message type. */</span></div><div class="line"><a name="l07581"></a><span class="lineno"> 7581</span>&#160;            <span class="keywordflow">if</span> (sig_pri_handle_hold(pri, e)) {</div><div class="line"><a name="l07582"></a><span class="lineno"> 7582</span>&#160;               pri_hold_rej(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;hold.call,</div><div class="line"><a name="l07583"></a><span class="lineno"> 7583</span>&#160;                  PRI_CAUSE_RESOURCE_UNAVAIL_UNSPECIFIED);</div><div class="line"><a name="l07584"></a><span class="lineno"> 7584</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07585"></a><span class="lineno"> 7585</span>&#160;               pri_hold_ack(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, e-&gt;hold.call);</div><div class="line"><a name="l07586"></a><span class="lineno"> 7586</span>&#160;            }</div><div class="line"><a name="l07587"></a><span class="lineno"> 7587</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07588"></a><span class="lineno"> 7588</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07589"></a><span class="lineno"> 7589</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l07590"></a><span class="lineno"> 7590</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_HOLD_ACK:</div><div class="line"><a name="l07591"></a><span class="lineno"> 7591</span>&#160;            <span class="comment">/* We should not be getting any CIS calls with this message type. */</span></div><div class="line"><a name="l07592"></a><span class="lineno"> 7592</span>&#160;            sig_pri_handle_hold_ack(pri, e);</div><div class="line"><a name="l07593"></a><span class="lineno"> 7593</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07594"></a><span class="lineno"> 7594</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07595"></a><span class="lineno"> 7595</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l07596"></a><span class="lineno"> 7596</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_HOLD_REJ:</div><div class="line"><a name="l07597"></a><span class="lineno"> 7597</span>&#160;            <span class="comment">/* We should not be getting any CIS calls with this message type. */</span></div><div class="line"><a name="l07598"></a><span class="lineno"> 7598</span>&#160;            sig_pri_handle_hold_rej(pri, e);</div><div class="line"><a name="l07599"></a><span class="lineno"> 7599</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07600"></a><span class="lineno"> 7600</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07601"></a><span class="lineno"> 7601</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l07602"></a><span class="lineno"> 7602</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_RETRIEVE:</div><div class="line"><a name="l07603"></a><span class="lineno"> 7603</span>&#160;            <span class="comment">/* We should not be getting any CIS calls with this message type. */</span></div><div class="line"><a name="l07604"></a><span class="lineno"> 7604</span>&#160;            sig_pri_handle_retrieve(pri, e);</div><div class="line"><a name="l07605"></a><span class="lineno"> 7605</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07606"></a><span class="lineno"> 7606</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07607"></a><span class="lineno"> 7607</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l07608"></a><span class="lineno"> 7608</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_RETRIEVE_ACK:</div><div class="line"><a name="l07609"></a><span class="lineno"> 7609</span>&#160;            <span class="comment">/* We should not be getting any CIS calls with this message type. */</span></div><div class="line"><a name="l07610"></a><span class="lineno"> 7610</span>&#160;            sig_pri_handle_retrieve_ack(pri, e);</div><div class="line"><a name="l07611"></a><span class="lineno"> 7611</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07612"></a><span class="lineno"> 7612</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07613"></a><span class="lineno"> 7613</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l07614"></a><span class="lineno"> 7614</span>&#160;         <span class="keywordflow">case</span> PRI_EVENT_RETRIEVE_REJ:</div><div class="line"><a name="l07615"></a><span class="lineno"> 7615</span>&#160;            <span class="comment">/* We should not be getting any CIS calls with this message type. */</span></div><div class="line"><a name="l07616"></a><span class="lineno"> 7616</span>&#160;            sig_pri_handle_retrieve_rej(pri, e);</div><div class="line"><a name="l07617"></a><span class="lineno"> 7617</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07618"></a><span class="lineno"> 7618</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07619"></a><span class="lineno"> 7619</span>&#160;         <span class="keywordflow">default</span>:</div><div class="line"><a name="l07620"></a><span class="lineno"> 7620</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Span: %d Unhandled event: %s(%d)\n&quot;</span>,</div><div class="line"><a name="l07621"></a><span class="lineno"> 7621</span>&#160;               pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri_event2str(e-&gt;e), e-&gt;e);</div><div class="line"><a name="l07622"></a><span class="lineno"> 7622</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l07623"></a><span class="lineno"> 7623</span>&#160;         }</div><div class="line"><a name="l07624"></a><span class="lineno"> 7624</span>&#160;</div><div class="line"><a name="l07625"></a><span class="lineno"> 7625</span>&#160;         <span class="comment">/* If a callid was set, we need to remove it from thread storage. */</span></div><div class="line"><a name="l07626"></a><span class="lineno"> 7626</span>&#160;         <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l07627"></a><span class="lineno"> 7627</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a9e325f2d0c2872627a05feff17423f80">ast_callid_threadassoc_remove</a>();</div><div class="line"><a name="l07628"></a><span class="lineno"> 7628</span>&#160;         }</div><div class="line"><a name="l07629"></a><span class="lineno"> 7629</span>&#160;      }</div><div class="line"><a name="l07630"></a><span class="lineno"> 7630</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l07631"></a><span class="lineno"> 7631</span>&#160;   }</div><div class="line"><a name="l07632"></a><span class="lineno"> 7632</span>&#160;   <span class="comment">/* Never reached */</span></div><div class="line"><a name="l07633"></a><span class="lineno"> 7633</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07634"></a><span class="lineno"> 7634</span>&#160;}</div><div class="line"><a name="l07635"></a><span class="lineno"> 7635</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07636"></a><span class="lineno"> 7636</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l07637"></a><span class="lineno"> 7637</span>&#160;<span class="comment"> * \brief Output AMI show spans response events for the given PRI span.</span></div><div class="line"><a name="l07638"></a><span class="lineno"> 7638</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l07639"></a><span class="lineno"> 7639</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07640"></a><span class="lineno"> 7640</span>&#160;<span class="comment"> * \param show_cmd AMI command name</span></div><div class="line"><a name="l07641"></a><span class="lineno"> 7641</span>&#160;<span class="comment"> * \param s AMI session to output span information.</span></div><div class="line"><a name="l07642"></a><span class="lineno"> 7642</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l07643"></a><span class="lineno"> 7643</span>&#160;<span class="comment"> * \param dchannels Array of D channel channel numbers.</span></div><div class="line"><a name="l07644"></a><span class="lineno"> 7644</span>&#160;<span class="comment"> * \param action_id Action ID line to use.</span></div><div class="line"><a name="l07645"></a><span class="lineno"> 7645</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07646"></a><span class="lineno"> 7646</span>&#160;<span class="comment"> * \return Number of D channels on this span.</span></div><div class="line"><a name="l07647"></a><span class="lineno"> 7647</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l07648"></a><span class="lineno"> 7648</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0b72d1d5eced390aeb8711c6ed61649f">sig_pri_ami_show_spans</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keywordtype">char</span> *show_cmd, <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keyword">const</span> <span class="keywordtype">int</span> *dchannels, <span class="keyword">const</span> <span class="keywordtype">char</span> *action_id)</div><div class="line"><a name="l07649"></a><span class="lineno"> 7649</span>&#160;{</div><div class="line"><a name="l07650"></a><span class="lineno"> 7650</span>&#160;   <span class="keywordtype">int</span> count;</div><div class="line"><a name="l07651"></a><span class="lineno"> 7651</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../df/d3c/structast__channel.html#ab06e9aa782b61ccfb42f7c48996f6ed4">x</a>;</div><div class="line"><a name="l07652"></a><span class="lineno"> 7652</span>&#160;</div><div class="line"><a name="l07653"></a><span class="lineno"> 7653</span>&#160;   count = 0;</div><div class="line"><a name="l07654"></a><span class="lineno"> 7654</span>&#160;   <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>); ++<a class="code" href="../../df/d3c/structast__channel.html#ab06e9aa782b61ccfb42f7c48996f6ed4">x</a>) {</div><div class="line"><a name="l07655"></a><span class="lineno"> 7655</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[x]) {</div><div class="line"><a name="l07656"></a><span class="lineno"> 7656</span>&#160;         ++count;</div><div class="line"><a name="l07657"></a><span class="lineno"> 7657</span>&#160;</div><div class="line"><a name="l07658"></a><span class="lineno"> 7658</span>&#160;         <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s,</div><div class="line"><a name="l07659"></a><span class="lineno"> 7659</span>&#160;            <span class="stringliteral">&quot;Event: %s\r\n&quot;</span></div><div class="line"><a name="l07660"></a><span class="lineno"> 7660</span>&#160;            <span class="stringliteral">&quot;Span: %d\r\n&quot;</span></div><div class="line"><a name="l07661"></a><span class="lineno"> 7661</span>&#160;            <span class="stringliteral">&quot;DChannel: %d\r\n&quot;</span></div><div class="line"><a name="l07662"></a><span class="lineno"> 7662</span>&#160;            <span class="stringliteral">&quot;Order: %s\r\n&quot;</span></div><div class="line"><a name="l07663"></a><span class="lineno"> 7663</span>&#160;            <span class="stringliteral">&quot;Active: %s\r\n&quot;</span></div><div class="line"><a name="l07664"></a><span class="lineno"> 7664</span>&#160;            <span class="stringliteral">&quot;Alarm: %s\r\n&quot;</span></div><div class="line"><a name="l07665"></a><span class="lineno"> 7665</span>&#160;            <span class="stringliteral">&quot;Up: %s\r\n&quot;</span></div><div class="line"><a name="l07666"></a><span class="lineno"> 7666</span>&#160;            <span class="stringliteral">&quot;%s&quot;</span></div><div class="line"><a name="l07667"></a><span class="lineno"> 7667</span>&#160;            <span class="stringliteral">&quot;\r\n&quot;</span>,</div><div class="line"><a name="l07668"></a><span class="lineno"> 7668</span>&#160;            show_cmd,</div><div class="line"><a name="l07669"></a><span class="lineno"> 7669</span>&#160;            pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>,</div><div class="line"><a name="l07670"></a><span class="lineno"> 7670</span>&#160;            dchannels[x],</div><div class="line"><a name="l07671"></a><span class="lineno"> 7671</span>&#160;            pri_order(x),</div><div class="line"><a name="l07672"></a><span class="lineno"> 7672</span>&#160;            (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[x] == pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>,</div><div class="line"><a name="l07673"></a><span class="lineno"> 7673</span>&#160;            (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">dchanavail</a>[x] &amp; DCHAN_NOTINALARM) ? <span class="stringliteral">&quot;No&quot;</span> : <span class="stringliteral">&quot;Yes&quot;</span>,</div><div class="line"><a name="l07674"></a><span class="lineno"> 7674</span>&#160;            (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">dchanavail</a>[x] &amp; DCHAN_UP) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>,</div><div class="line"><a name="l07675"></a><span class="lineno"> 7675</span>&#160;            action_id</div><div class="line"><a name="l07676"></a><span class="lineno"> 7676</span>&#160;            );</div><div class="line"><a name="l07677"></a><span class="lineno"> 7677</span>&#160;      }</div><div class="line"><a name="l07678"></a><span class="lineno"> 7678</span>&#160;   }</div><div class="line"><a name="l07679"></a><span class="lineno"> 7679</span>&#160;   <span class="keywordflow">return</span> count;</div><div class="line"><a name="l07680"></a><span class="lineno"> 7680</span>&#160;}</div><div class="line"><a name="l07681"></a><span class="lineno"> 7681</span>&#160;</div><div class="line"><a name="l07682"></a><span class="lineno"> 7682</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a7a4b7cc6cdb12c93fb29608a110614dc">sig_pri_init_pri</a>(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l07683"></a><span class="lineno"> 7683</span>&#160;{</div><div class="line"><a name="l07684"></a><span class="lineno"> 7684</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l07685"></a><span class="lineno"> 7685</span>&#160;</div><div class="line"><a name="l07686"></a><span class="lineno"> 7686</span>&#160;   memset(pri, 0, <span class="keyword">sizeof</span>(*pri));</div><div class="line"><a name="l07687"></a><span class="lineno"> 7687</span>&#160;</div><div class="line"><a name="l07688"></a><span class="lineno"> 7688</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l07689"></a><span class="lineno"> 7689</span>&#160;</div><div class="line"><a name="l07690"></a><span class="lineno"> 7690</span>&#160;   pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9e187fd6e33fd32a888531467786c773">master</a> = <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;</div><div class="line"><a name="l07691"></a><span class="lineno"> 7691</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; i++)</div><div class="line"><a name="l07692"></a><span class="lineno"> 7692</span>&#160;      pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i] = -1;</div><div class="line"><a name="l07693"></a><span class="lineno"> 7693</span>&#160;}</div><div class="line"><a name="l07694"></a><span class="lineno"> 7694</span>&#160;</div><div class="line"><a name="l07695"></a><span class="lineno"> 7695</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a3b4d33874153cde6eb4337024fdbf66e">sig_pri_hangup</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *ast)</div><div class="line"><a name="l07696"></a><span class="lineno"> 7696</span>&#160;{</div><div class="line"><a name="l07697"></a><span class="lineno"> 7697</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;%s %d\n&quot;</span>, __FUNCTION__, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);</div><div class="line"><a name="l07698"></a><span class="lineno"> 7698</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7b/channel_8h.html#a3dc9d235c0e16ab0a6812b4aa6572cce">ast_channel_tech_pvt</a>(ast)) {</div><div class="line"><a name="l07699"></a><span class="lineno"> 7699</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Asked to hangup channel not connected\n&quot;</span>);</div><div class="line"><a name="l07700"></a><span class="lineno"> 7700</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l07701"></a><span class="lineno"> 7701</span>&#160;   }</div><div class="line"><a name="l07702"></a><span class="lineno"> 7702</span>&#160;</div><div class="line"><a name="l07703"></a><span class="lineno"> 7703</span>&#160;   sig_pri_set_outgoing(p, 0);</div><div class="line"><a name="l07704"></a><span class="lineno"> 7704</span>&#160;   sig_pri_set_digital(p, 0); <span class="comment">/* push up to parent for EC*/</span></div><div class="line"><a name="l07705"></a><span class="lineno"> 7705</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l07706"></a><span class="lineno"> 7706</span>&#160;   <span class="keywordflow">if</span> (p-&gt;is_call_waiting) {</div><div class="line"><a name="l07707"></a><span class="lineno"> 7707</span>&#160;      p-&gt;is_call_waiting = 0;</div><div class="line"><a name="l07708"></a><span class="lineno"> 7708</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;num_call_waiting_calls, -1);</div><div class="line"><a name="l07709"></a><span class="lineno"> 7709</span>&#160;   }</div><div class="line"><a name="l07710"></a><span class="lineno"> 7710</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07711"></a><span class="lineno"> 7711</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a160bf6ebcaf7f83a1d419472aa594e8c">SIG_PRI_CALL_LEVEL_IDLE</a>;</div><div class="line"><a name="l07712"></a><span class="lineno"> 7712</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> = 0;</div><div class="line"><a name="l07713"></a><span class="lineno"> 7713</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l07714"></a><span class="lineno"> 7714</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a16348e587eb42db97d2169c6c11ebe46">cid_subaddr</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l07715"></a><span class="lineno"> 7715</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l07716"></a><span class="lineno"> 7716</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l07717"></a><span class="lineno"> 7717</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">exten</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l07718"></a><span class="lineno"> 7718</span>&#160;   sig_pri_set_dialing(p, 0);</div><div class="line"><a name="l07719"></a><span class="lineno"> 7719</span>&#160;</div><div class="line"><a name="l07720"></a><span class="lineno"> 7720</span>&#160;   <span class="comment">/* Make sure we really have a call */</span></div><div class="line"><a name="l07721"></a><span class="lineno"> 7721</span>&#160;   pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l07722"></a><span class="lineno"> 7722</span>&#160;   sig_pri_moh_fsm_event(ast, p, <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7">SIG_PRI_MOH_EVENT_RESET</a>);</div><div class="line"><a name="l07723"></a><span class="lineno"> 7723</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>) {</div><div class="line"><a name="l07724"></a><span class="lineno"> 7724</span>&#160;<span class="preprocessor">#if defined(SUPPORT_USERUSER)</span></div><div class="line"><a name="l07725"></a><span class="lineno"> 7725</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *useruser = <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;USERUSERINFO&quot;</span>);</div><div class="line"><a name="l07726"></a><span class="lineno"> 7726</span>&#160;</div><div class="line"><a name="l07727"></a><span class="lineno"> 7727</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(useruser)) {</div><div class="line"><a name="l07728"></a><span class="lineno"> 7728</span>&#160;         pri_call_set_useruser(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, useruser);</div><div class="line"><a name="l07729"></a><span class="lineno"> 7729</span>&#160;      }</div><div class="line"><a name="l07730"></a><span class="lineno"> 7730</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(SUPPORT_USERUSER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07731"></a><span class="lineno"> 7731</span>&#160;</div><div class="line"><a name="l07732"></a><span class="lineno"> 7732</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l07733"></a><span class="lineno"> 7733</span>&#160;      <span class="keywordflow">if</span> (p-&gt;xfer_data) {</div><div class="line"><a name="l07734"></a><span class="lineno"> 7734</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l07735"></a><span class="lineno"> 7735</span>&#160;<span class="comment">          * The transferrer call leg is disconnecting.  It must mean that</span></div><div class="line"><a name="l07736"></a><span class="lineno"> 7736</span>&#160;<span class="comment">          * the transfer was successful and the core is disconnecting the</span></div><div class="line"><a name="l07737"></a><span class="lineno"> 7737</span>&#160;<span class="comment">          * call legs involved.</span></div><div class="line"><a name="l07738"></a><span class="lineno"> 7738</span>&#160;<span class="comment">          *</span></div><div class="line"><a name="l07739"></a><span class="lineno"> 7739</span>&#160;<span class="comment">          * The transfer protocol response message must go out before the</span></div><div class="line"><a name="l07740"></a><span class="lineno"> 7740</span>&#160;<span class="comment">          * call leg is disconnected.</span></div><div class="line"><a name="l07741"></a><span class="lineno"> 7741</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l07742"></a><span class="lineno"> 7742</span>&#160;         sig_pri_transfer_rsp(p-&gt;xfer_data, 1);</div><div class="line"><a name="l07743"></a><span class="lineno"> 7743</span>&#160;      }</div><div class="line"><a name="l07744"></a><span class="lineno"> 7744</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07745"></a><span class="lineno"> 7745</span>&#160;</div><div class="line"><a name="l07746"></a><span class="lineno"> 7746</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l07747"></a><span class="lineno"> 7747</span>&#160;      <span class="keywordflow">if</span> (p-&gt;holding_aoce) {</div><div class="line"><a name="l07748"></a><span class="lineno"> 7748</span>&#160;         pri_aoc_e_send(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, &amp;p-&gt;aoc_e);</div><div class="line"><a name="l07749"></a><span class="lineno"> 7749</span>&#160;      }</div><div class="line"><a name="l07750"></a><span class="lineno"> 7750</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07751"></a><span class="lineno"> 7751</span>&#160;</div><div class="line"><a name="l07752"></a><span class="lineno"> 7752</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af530b38fefaa05e6fa4f0ebe72c73455">alreadyhungup</a>) {</div><div class="line"><a name="l07753"></a><span class="lineno"> 7753</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Already hungup...  Calling hangup once, and clearing call\n&quot;</span>);</div><div class="line"><a name="l07754"></a><span class="lineno"> 7754</span>&#160;</div><div class="line"><a name="l07755"></a><span class="lineno"> 7755</span>&#160;         pri_hangup(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, -1);</div><div class="line"><a name="l07756"></a><span class="lineno"> 7756</span>&#160;         p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07757"></a><span class="lineno"> 7757</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07758"></a><span class="lineno"> 7758</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *cause = <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(ast,<span class="stringliteral">&quot;PRI_CAUSE&quot;</span>);</div><div class="line"><a name="l07759"></a><span class="lineno"> 7759</span>&#160;         <span class="keywordtype">int</span> icause = <a class="code" href="../../d5/d7b/channel_8h.html#aa04afa262d7e1b211ee32d17c949a275">ast_channel_hangupcause</a>(ast) ? <a class="code" href="../../d5/d7b/channel_8h.html#aa04afa262d7e1b211ee32d17c949a275">ast_channel_hangupcause</a>(ast) : -1;</div><div class="line"><a name="l07760"></a><span class="lineno"> 7760</span>&#160;</div><div class="line"><a name="l07761"></a><span class="lineno"> 7761</span>&#160;         p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af530b38fefaa05e6fa4f0ebe72c73455">alreadyhungup</a> = 1;</div><div class="line"><a name="l07762"></a><span class="lineno"> 7762</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cause)) {</div><div class="line"><a name="l07763"></a><span class="lineno"> 7763</span>&#160;            <span class="keywordflow">if</span> (atoi(cause)) {</div><div class="line"><a name="l07764"></a><span class="lineno"> 7764</span>&#160;               icause = atoi(cause);</div><div class="line"><a name="l07765"></a><span class="lineno"> 7765</span>&#160;            }</div><div class="line"><a name="l07766"></a><span class="lineno"> 7766</span>&#160;         }</div><div class="line"><a name="l07767"></a><span class="lineno"> 7767</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1,</div><div class="line"><a name="l07768"></a><span class="lineno"> 7768</span>&#160;            <span class="stringliteral">&quot;Not yet hungup...  Calling hangup with cause %d, and clearing call\n&quot;</span>,</div><div class="line"><a name="l07769"></a><span class="lineno"> 7769</span>&#160;            icause);</div><div class="line"><a name="l07770"></a><span class="lineno"> 7770</span>&#160;</div><div class="line"><a name="l07771"></a><span class="lineno"> 7771</span>&#160;         pri_hangup(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, icause);</div><div class="line"><a name="l07772"></a><span class="lineno"> 7772</span>&#160;      }</div><div class="line"><a name="l07773"></a><span class="lineno"> 7773</span>&#160;   }</div><div class="line"><a name="l07774"></a><span class="lineno"> 7774</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l07775"></a><span class="lineno"> 7775</span>&#160;   p-&gt;xfer_data = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07776"></a><span class="lineno"> 7776</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07777"></a><span class="lineno"> 7777</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l07778"></a><span class="lineno"> 7778</span>&#160;   p-&gt;aoc_s_request_invoke_id_valid = 0;</div><div class="line"><a name="l07779"></a><span class="lineno"> 7779</span>&#160;   p-&gt;holding_aoce = 0;</div><div class="line"><a name="l07780"></a><span class="lineno"> 7780</span>&#160;   p-&gt;waiting_for_aoce = 0;</div><div class="line"><a name="l07781"></a><span class="lineno"> 7781</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07782"></a><span class="lineno"> 7782</span>&#160;</div><div class="line"><a name="l07783"></a><span class="lineno"> 7783</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a44ac4c6a3693f3d2fa34a50428e42237">allocated</a> = 0;</div><div class="line"><a name="l07784"></a><span class="lineno"> 7784</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07785"></a><span class="lineno"> 7785</span>&#160;</div><div class="line"><a name="l07786"></a><span class="lineno"> 7786</span>&#160;   sig_pri_span_devstate_changed(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l07787"></a><span class="lineno"> 7787</span>&#160;   pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l07788"></a><span class="lineno"> 7788</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l07789"></a><span class="lineno"> 7789</span>&#160;}</div><div class="line"><a name="l07790"></a><span class="lineno"> 7790</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07791"></a><span class="lineno"> 7791</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l07792"></a><span class="lineno"> 7792</span>&#160;<span class="comment"> * \brief Extract the called number and subaddress from the dial string.</span></div><div class="line"><a name="l07793"></a><span class="lineno"> 7793</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l07794"></a><span class="lineno"> 7794</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07795"></a><span class="lineno"> 7795</span>&#160;<span class="comment"> * \param p sig_pri channel structure.</span></div><div class="line"><a name="l07796"></a><span class="lineno"> 7796</span>&#160;<span class="comment"> * \param rdest Dial string buffer to extract called number and subaddress.</span></div><div class="line"><a name="l07797"></a><span class="lineno"> 7797</span>&#160;<span class="comment"> * \param called Buffer to fill with extracted &lt;number&gt;[:&lt;subaddress&gt;]</span></div><div class="line"><a name="l07798"></a><span class="lineno"> 7798</span>&#160;<span class="comment"> * \param called_buff_size Size of buffer to fill.</span></div><div class="line"><a name="l07799"></a><span class="lineno"> 7799</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07800"></a><span class="lineno"> 7800</span>&#160;<span class="comment"> * \note Parsing must remain in sync with sig_pri_call().</span></div><div class="line"><a name="l07801"></a><span class="lineno"> 7801</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07802"></a><span class="lineno"> 7802</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l07803"></a><span class="lineno"> 7803</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l07804"></a><span class="lineno"> 7804</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a2233cac6ec393376a4d82418b4f158c9">sig_pri_extract_called_num_subaddr</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *rdest, <span class="keywordtype">char</span> *called, <span class="keywordtype">size_t</span> called_buff_size)</div><div class="line"><a name="l07805"></a><span class="lineno"> 7805</span>&#160;{</div><div class="line"><a name="l07806"></a><span class="lineno"> 7806</span>&#160;   <span class="keywordtype">char</span> *dial;</div><div class="line"><a name="l07807"></a><span class="lineno"> 7807</span>&#160;   <span class="keywordtype">char</span> *number;</div><div class="line"><a name="l07808"></a><span class="lineno"> 7808</span>&#160;   <span class="keywordtype">char</span> *subaddr;</div><div class="line"><a name="l07809"></a><span class="lineno"> 7809</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l07810"></a><span class="lineno"> 7810</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../d3/d08/structgroup.html">group</a>);  <span class="comment">/* channel/group token */</span></div><div class="line"><a name="l07811"></a><span class="lineno"> 7811</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../dd/d43/http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>); <span class="comment">/* extension token */</span></div><div class="line"><a name="l07812"></a><span class="lineno"> 7812</span>&#160;      <span class="comment">//AST_APP_ARG(opts); /* options token */</span></div><div class="line"><a name="l07813"></a><span class="lineno"> 7813</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(other);  <span class="comment">/* Any remining unused arguments */</span></div><div class="line"><a name="l07814"></a><span class="lineno"> 7814</span>&#160;   );</div><div class="line"><a name="l07815"></a><span class="lineno"> 7815</span>&#160;</div><div class="line"><a name="l07816"></a><span class="lineno"> 7816</span>&#160;   <span class="comment">/* Get private copy of dial string and break it up. */</span></div><div class="line"><a name="l07817"></a><span class="lineno"> 7817</span>&#160;   dial = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(rdest);</div><div class="line"><a name="l07818"></a><span class="lineno"> 7818</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#accfcb380df76a64251d88ef49c2dd4e3">AST_NONSTANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, dial, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l07819"></a><span class="lineno"> 7819</span>&#160;</div><div class="line"><a name="l07820"></a><span class="lineno"> 7820</span>&#160;   number = <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.ext;</div><div class="line"><a name="l07821"></a><span class="lineno"> 7821</span>&#160;   <span class="keywordflow">if</span> (!number) {</div><div class="line"><a name="l07822"></a><span class="lineno"> 7822</span>&#160;      number = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l07823"></a><span class="lineno"> 7823</span>&#160;   }</div><div class="line"><a name="l07824"></a><span class="lineno"> 7824</span>&#160;</div><div class="line"><a name="l07825"></a><span class="lineno"> 7825</span>&#160;   <span class="comment">/* Find and extract dialed_subaddress */</span></div><div class="line"><a name="l07826"></a><span class="lineno"> 7826</span>&#160;   subaddr = strchr(number, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l07827"></a><span class="lineno"> 7827</span>&#160;   <span class="keywordflow">if</span> (subaddr) {</div><div class="line"><a name="l07828"></a><span class="lineno"> 7828</span>&#160;      *subaddr++ = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l07829"></a><span class="lineno"> 7829</span>&#160;</div><div class="line"><a name="l07830"></a><span class="lineno"> 7830</span>&#160;      <span class="comment">/* Skip subaddress type prefix. */</span></div><div class="line"><a name="l07831"></a><span class="lineno"> 7831</span>&#160;      <span class="keywordflow">switch</span> (*subaddr) {</div><div class="line"><a name="l07832"></a><span class="lineno"> 7832</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>:</div><div class="line"><a name="l07833"></a><span class="lineno"> 7833</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>:</div><div class="line"><a name="l07834"></a><span class="lineno"> 7834</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div><div class="line"><a name="l07835"></a><span class="lineno"> 7835</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div><div class="line"><a name="l07836"></a><span class="lineno"> 7836</span>&#160;         ++subaddr;</div><div class="line"><a name="l07837"></a><span class="lineno"> 7837</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l07838"></a><span class="lineno"> 7838</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l07839"></a><span class="lineno"> 7839</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l07840"></a><span class="lineno"> 7840</span>&#160;      }</div><div class="line"><a name="l07841"></a><span class="lineno"> 7841</span>&#160;   }</div><div class="line"><a name="l07842"></a><span class="lineno"> 7842</span>&#160;</div><div class="line"><a name="l07843"></a><span class="lineno"> 7843</span>&#160;   <span class="comment">/* Skip type-of-number/dial-plan prefix characters. */</span></div><div class="line"><a name="l07844"></a><span class="lineno"> 7844</span>&#160;   <span class="keywordflow">if</span> (strlen(number) &lt; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>) {</div><div class="line"><a name="l07845"></a><span class="lineno"> 7845</span>&#160;      number = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l07846"></a><span class="lineno"> 7846</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07847"></a><span class="lineno"> 7847</span>&#160;      <span class="keywordtype">char</span> *deferred;</div><div class="line"><a name="l07848"></a><span class="lineno"> 7848</span>&#160;</div><div class="line"><a name="l07849"></a><span class="lineno"> 7849</span>&#160;      number += p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>;</div><div class="line"><a name="l07850"></a><span class="lineno"> 7850</span>&#160;      deferred = strchr(number, <span class="charliteral">&#39;w&#39;</span>);</div><div class="line"><a name="l07851"></a><span class="lineno"> 7851</span>&#160;      <span class="keywordflow">if</span> (deferred) {</div><div class="line"><a name="l07852"></a><span class="lineno"> 7852</span>&#160;         <span class="comment">/* Remove any &#39;w&#39; deferred digits. */</span></div><div class="line"><a name="l07853"></a><span class="lineno"> 7853</span>&#160;         *deferred = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l07854"></a><span class="lineno"> 7854</span>&#160;      }</div><div class="line"><a name="l07855"></a><span class="lineno"> 7855</span>&#160;      <span class="keywordflow">while</span> (isalpha(*number)) {</div><div class="line"><a name="l07856"></a><span class="lineno"> 7856</span>&#160;         ++number;</div><div class="line"><a name="l07857"></a><span class="lineno"> 7857</span>&#160;      }</div><div class="line"><a name="l07858"></a><span class="lineno"> 7858</span>&#160;   }</div><div class="line"><a name="l07859"></a><span class="lineno"> 7859</span>&#160;</div><div class="line"><a name="l07860"></a><span class="lineno"> 7860</span>&#160;   <span class="comment">/* Fill buffer with extracted number and subaddress. */</span></div><div class="line"><a name="l07861"></a><span class="lineno"> 7861</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(subaddr)) {</div><div class="line"><a name="l07862"></a><span class="lineno"> 7862</span>&#160;      <span class="comment">/* Put in called number only since there is no subaddress. */</span></div><div class="line"><a name="l07863"></a><span class="lineno"> 7863</span>&#160;      snprintf(called, called_buff_size, <span class="stringliteral">&quot;%s&quot;</span>, number);</div><div class="line"><a name="l07864"></a><span class="lineno"> 7864</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07865"></a><span class="lineno"> 7865</span>&#160;      <span class="comment">/* Put in called number and subaddress. */</span></div><div class="line"><a name="l07866"></a><span class="lineno"> 7866</span>&#160;      snprintf(called, called_buff_size, <span class="stringliteral">&quot;%s:%s&quot;</span>, number, subaddr);</div><div class="line"><a name="l07867"></a><span class="lineno"> 7867</span>&#160;   }</div><div class="line"><a name="l07868"></a><span class="lineno"> 7868</span>&#160;}</div><div class="line"><a name="l07869"></a><span class="lineno"> 7869</span>&#160;</div><div class="line"><a name="l07870"></a><span class="lineno"> 7870</span>&#160;<span class="keyword">enum</span> SIG_PRI_CALL_OPT_FLAGS {</div><div class="line"><a name="l07871"></a><span class="lineno"> 7871</span>&#160;   OPT_KEYPAD =         (1 &lt;&lt; 0),</div><div class="line"><a name="l07872"></a><span class="lineno"> 7872</span>&#160;   OPT_REVERSE_CHARGE = (1 &lt;&lt; 1),   <span class="comment">/* Collect call */</span></div><div class="line"><a name="l07873"></a><span class="lineno"> 7873</span>&#160;   OPT_AOC_REQUEST =    (1 &lt;&lt; 2),   <span class="comment">/* AOC Request */</span></div><div class="line"><a name="l07874"></a><span class="lineno"> 7874</span>&#160;};</div><div class="line"><a name="l07875"></a><span class="lineno"> 7875</span>&#160;<span class="keyword">enum</span> SIG_PRI_CALL_OPT_ARGS {</div><div class="line"><a name="l07876"></a><span class="lineno"> 7876</span>&#160;   OPT_ARG_KEYPAD = 0,</div><div class="line"><a name="l07877"></a><span class="lineno"> 7877</span>&#160;   OPT_ARG_AOC_REQUEST,</div><div class="line"><a name="l07878"></a><span class="lineno"> 7878</span>&#160;</div><div class="line"><a name="l07879"></a><span class="lineno"> 7879</span>&#160;   <span class="comment">/* note: this entry _MUST_ be the last one in the enum */</span></div><div class="line"><a name="l07880"></a><span class="lineno"> 7880</span>&#160;   <a class="code" href="../../dc/d22/app__bridgewait_8c.html#a419d14e40598b9d3c973cb693dd91297aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a>,</div><div class="line"><a name="l07881"></a><span class="lineno"> 7881</span>&#160;};</div><div class="line"><a name="l07882"></a><span class="lineno"> 7882</span>&#160;</div><div class="line"><a name="l07883"></a><span class="lineno"> 7883</span>&#160;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a520a3c6b7d57903d9a616051da1a019d">AST_APP_OPTIONS</a>(sig_pri_call_opts, <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ab451a4653176c211d131b899e1f91bde">BEGIN_OPTIONS</a></div><div class="line"><a name="l07884"></a><span class="lineno"> 7884</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a7549377df87038be737e8cae73acaa9d">AST_APP_OPTION_ARG</a>(<span class="charliteral">&#39;K&#39;</span>, OPT_KEYPAD, OPT_ARG_KEYPAD),</div><div class="line"><a name="l07885"></a><span class="lineno"> 7885</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;R&#39;</span>, OPT_REVERSE_CHARGE),</div><div class="line"><a name="l07886"></a><span class="lineno"> 7886</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a7549377df87038be737e8cae73acaa9d">AST_APP_OPTION_ARG</a>(<span class="charliteral">&#39;A&#39;</span>, OPT_AOC_REQUEST, OPT_ARG_AOC_REQUEST),</div><div class="line"><a name="l07887"></a><span class="lineno"> 7887</span>&#160;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a2a1890787b3e55318c417c0a3e1432c7">END_OPTIONS</a>);</div><div class="line"><a name="l07888"></a><span class="lineno"> 7888</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07889"></a><span class="lineno"> 7889</span>&#160;<span class="comment">/*! \note Parsing must remain in sync with sig_pri_extract_called_num_subaddr(). */</span></div><div class="line"><a name="l07890"></a><span class="lineno"> 7890</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a45c2e617c2ffdd76d9dc9956e8fe4de8">sig_pri_call</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *ast, <span class="keyword">const</span> <span class="keywordtype">char</span> *rdest, <span class="keywordtype">int</span> timeout, <span class="keywordtype">int</span> layer1)</div><div class="line"><a name="l07891"></a><span class="lineno"> 7891</span>&#160;{</div><div class="line"><a name="l07892"></a><span class="lineno"> 7892</span>&#160;   <span class="keywordtype">char</span> dest[256]; <span class="comment">/* must be same length as p-&gt;dialdest */</span></div><div class="line"><a name="l07893"></a><span class="lineno"> 7893</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d41/structast__party__subaddress.html">ast_party_subaddress</a> dialed_subaddress; <span class="comment">/* Called subaddress */</span></div><div class="line"><a name="l07894"></a><span class="lineno"> 7894</span>&#160;   <span class="keyword">struct </span>pri_sr *sr;</div><div class="line"><a name="l07895"></a><span class="lineno"> 7895</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, *l, *n, *s;</div><div class="line"><a name="l07896"></a><span class="lineno"> 7896</span>&#160;<span class="preprocessor">#ifdef SUPPORT_USERUSER</span></div><div class="line"><a name="l07897"></a><span class="lineno"> 7897</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *useruser;</div><div class="line"><a name="l07898"></a><span class="lineno"> 7898</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l07899"></a><span class="lineno"> 7899</span>&#160;   <span class="keywordtype">int</span> core_id;</div><div class="line"><a name="l07900"></a><span class="lineno"> 7900</span>&#160;   <span class="keywordtype">int</span> pridialplan;</div><div class="line"><a name="l07901"></a><span class="lineno"> 7901</span>&#160;   <span class="keywordtype">int</span> dp_strip;</div><div class="line"><a name="l07902"></a><span class="lineno"> 7902</span>&#160;   <span class="keywordtype">int</span> prilocaldialplan;</div><div class="line"><a name="l07903"></a><span class="lineno"> 7903</span>&#160;   <span class="keywordtype">int</span> ldp_strip;</div><div class="line"><a name="l07904"></a><span class="lineno"> 7904</span>&#160;   <span class="keywordtype">int</span> exclusive;</div><div class="line"><a name="l07905"></a><span class="lineno"> 7905</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SETUP_KEYPAD)</span></div><div class="line"><a name="l07906"></a><span class="lineno"> 7906</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *keypad;</div><div class="line"><a name="l07907"></a><span class="lineno"> 7907</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SETUP_KEYPAD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l07908"></a><span class="lineno"> 7908</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l07909"></a><span class="lineno"> 7909</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../d3/d08/structgroup.html">group</a>);  <span class="comment">/* channel/group token */</span></div><div class="line"><a name="l07910"></a><span class="lineno"> 7910</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../dd/d43/http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>); <span class="comment">/* extension token */</span></div><div class="line"><a name="l07911"></a><span class="lineno"> 7911</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(opts);   <span class="comment">/* options token */</span></div><div class="line"><a name="l07912"></a><span class="lineno"> 7912</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(other);  <span class="comment">/* Any remining unused arguments */</span></div><div class="line"><a name="l07913"></a><span class="lineno"> 7913</span>&#160;   );</div><div class="line"><a name="l07914"></a><span class="lineno"> 7914</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> opts;</div><div class="line"><a name="l07915"></a><span class="lineno"> 7915</span>&#160;   <span class="keywordtype">char</span> *opt_args[<a class="code" href="../../dc/d22/app__bridgewait_8c.html#a419d14e40598b9d3c973cb693dd91297aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a>];</div><div class="line"><a name="l07916"></a><span class="lineno"> 7916</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/dcb/structast__party__id.html">ast_party_id</a> connected_id = <a class="code" href="../../d5/d7b/channel_8h.html#abd6165fa9617e1bb5efee3befa3e963d">ast_channel_connected_effective_id</a>(ast);</div><div class="line"><a name="l07917"></a><span class="lineno"> 7917</span>&#160;</div><div class="line"><a name="l07918"></a><span class="lineno"> 7918</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;CALLER NAME: %s NUM: %s\n&quot;</span>,</div><div class="line"><a name="l07919"></a><span class="lineno"> 7919</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>, connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l07920"></a><span class="lineno"> 7920</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>, connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l07921"></a><span class="lineno"> 7921</span>&#160;</div><div class="line"><a name="l07922"></a><span class="lineno"> 7922</span>&#160;   <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>) {</div><div class="line"><a name="l07923"></a><span class="lineno"> 7923</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not find pri on channel %d\n&quot;</span>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);</div><div class="line"><a name="l07924"></a><span class="lineno"> 7924</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07925"></a><span class="lineno"> 7925</span>&#160;   }</div><div class="line"><a name="l07926"></a><span class="lineno"> 7926</span>&#160;</div><div class="line"><a name="l07927"></a><span class="lineno"> 7927</span>&#160;   <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(ast) != <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>) &amp;&amp; (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(ast) != <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>)) {</div><div class="line"><a name="l07928"></a><span class="lineno"> 7928</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;sig_pri_call called on %s, neither down nor reserved\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(ast));</div><div class="line"><a name="l07929"></a><span class="lineno"> 7929</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07930"></a><span class="lineno"> 7930</span>&#160;   }</div><div class="line"><a name="l07931"></a><span class="lineno"> 7931</span>&#160;</div><div class="line"><a name="l07932"></a><span class="lineno"> 7932</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a0368d49962f1bf26c2603ade03cd8ee9">dialdest</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l07933"></a><span class="lineno"> 7933</span>&#160;   sig_pri_set_outgoing(p, 1);</div><div class="line"><a name="l07934"></a><span class="lineno"> 7934</span>&#160;</div><div class="line"><a name="l07935"></a><span class="lineno"> 7935</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(dest, rdest, <span class="keyword">sizeof</span>(dest));</div><div class="line"><a name="l07936"></a><span class="lineno"> 7936</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#accfcb380df76a64251d88ef49c2dd4e3">AST_NONSTANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, dest, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l07937"></a><span class="lineno"> 7937</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb">ast_app_parse_options</a>(sig_pri_call_opts, &amp;opts, opt_args, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.opts)) {</div><div class="line"><a name="l07938"></a><span class="lineno"> 7938</span>&#160;      <span class="comment">/* General invalid option syntax. */</span></div><div class="line"><a name="l07939"></a><span class="lineno"> 7939</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07940"></a><span class="lineno"> 7940</span>&#160;   }</div><div class="line"><a name="l07941"></a><span class="lineno"> 7941</span>&#160;</div><div class="line"><a name="l07942"></a><span class="lineno"> 7942</span>&#160;   c = <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.ext;</div><div class="line"><a name="l07943"></a><span class="lineno"> 7943</span>&#160;   <span class="keywordflow">if</span> (!c) {</div><div class="line"><a name="l07944"></a><span class="lineno"> 7944</span>&#160;      c = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l07945"></a><span class="lineno"> 7945</span>&#160;   }</div><div class="line"><a name="l07946"></a><span class="lineno"> 7946</span>&#160;</div><div class="line"><a name="l07947"></a><span class="lineno"> 7947</span>&#160;   <span class="comment">/* setup dialed_subaddress if found */</span></div><div class="line"><a name="l07948"></a><span class="lineno"> 7948</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a40230121458bf94386b685b2e3270880">ast_party_subaddress_init</a>(&amp;dialed_subaddress);</div><div class="line"><a name="l07949"></a><span class="lineno"> 7949</span>&#160;   s = strchr(c, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l07950"></a><span class="lineno"> 7950</span>&#160;   <span class="keywordflow">if</span> (s) {</div><div class="line"><a name="l07951"></a><span class="lineno"> 7951</span>&#160;      *s = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l07952"></a><span class="lineno"> 7952</span>&#160;      s++;</div><div class="line"><a name="l07953"></a><span class="lineno"> 7953</span>&#160;      <span class="comment">/* prefix */</span></div><div class="line"><a name="l07954"></a><span class="lineno"> 7954</span>&#160;      <span class="comment">/* &#39;n&#39; = NSAP */</span></div><div class="line"><a name="l07955"></a><span class="lineno"> 7955</span>&#160;      <span class="comment">/* &#39;u&#39; = User Specified */</span></div><div class="line"><a name="l07956"></a><span class="lineno"> 7956</span>&#160;      <span class="comment">/* Default = NSAP */</span></div><div class="line"><a name="l07957"></a><span class="lineno"> 7957</span>&#160;      <span class="keywordflow">switch</span> (*s) {</div><div class="line"><a name="l07958"></a><span class="lineno"> 7958</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>:</div><div class="line"><a name="l07959"></a><span class="lineno"> 7959</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>:</div><div class="line"><a name="l07960"></a><span class="lineno"> 7960</span>&#160;         s++;</div><div class="line"><a name="l07961"></a><span class="lineno"> 7961</span>&#160;         dialed_subaddress.type = 2;</div><div class="line"><a name="l07962"></a><span class="lineno"> 7962</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l07963"></a><span class="lineno"> 7963</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div><div class="line"><a name="l07964"></a><span class="lineno"> 7964</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div><div class="line"><a name="l07965"></a><span class="lineno"> 7965</span>&#160;         s++;</div><div class="line"><a name="l07966"></a><span class="lineno"> 7966</span>&#160;         <span class="comment">/* default already covered with ast_party_subaddress_init */</span></div><div class="line"><a name="l07967"></a><span class="lineno"> 7967</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l07968"></a><span class="lineno"> 7968</span>&#160;      }</div><div class="line"><a name="l07969"></a><span class="lineno"> 7969</span>&#160;      dialed_subaddress.str = s;</div><div class="line"><a name="l07970"></a><span class="lineno"> 7970</span>&#160;      dialed_subaddress.valid = 1;</div><div class="line"><a name="l07971"></a><span class="lineno"> 7971</span>&#160;   }</div><div class="line"><a name="l07972"></a><span class="lineno"> 7972</span>&#160;</div><div class="line"><a name="l07973"></a><span class="lineno"> 7973</span>&#160;   l = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07974"></a><span class="lineno"> 7974</span>&#160;   n = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07975"></a><span class="lineno"> 7975</span>&#160;   <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a8c5bb01611cd9890c062782fa0366459">hidecallerid</a>) {</div><div class="line"><a name="l07976"></a><span class="lineno"> 7976</span>&#160;      <span class="keywordflow">if</span> (connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>) {</div><div class="line"><a name="l07977"></a><span class="lineno"> 7977</span>&#160;         <span class="comment">/* If we get to the end of this loop without breaking, there&#39;s no</span></div><div class="line"><a name="l07978"></a><span class="lineno"> 7978</span>&#160;<span class="comment">          * calleridnum.  This is done instead of testing for &quot;unknown&quot; or</span></div><div class="line"><a name="l07979"></a><span class="lineno"> 7979</span>&#160;<span class="comment">          * the thousands of other ways that the calleridnum could be</span></div><div class="line"><a name="l07980"></a><span class="lineno"> 7980</span>&#160;<span class="comment">          * invalid. */</span></div><div class="line"><a name="l07981"></a><span class="lineno"> 7981</span>&#160;         <span class="keywordflow">for</span> (l = connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>; l &amp;&amp; *l; l++) {</div><div class="line"><a name="l07982"></a><span class="lineno"> 7982</span>&#160;            <span class="keywordflow">if</span> (strchr(<span class="stringliteral">&quot;0123456789&quot;</span>, *l)) {</div><div class="line"><a name="l07983"></a><span class="lineno"> 7983</span>&#160;               l = connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>;</div><div class="line"><a name="l07984"></a><span class="lineno"> 7984</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l07985"></a><span class="lineno"> 7985</span>&#160;            }</div><div class="line"><a name="l07986"></a><span class="lineno"> 7986</span>&#160;         }</div><div class="line"><a name="l07987"></a><span class="lineno"> 7987</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07988"></a><span class="lineno"> 7988</span>&#160;         l = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07989"></a><span class="lineno"> 7989</span>&#160;      }</div><div class="line"><a name="l07990"></a><span class="lineno"> 7990</span>&#160;      <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ab9a2fe4dd3d880dcb9fec85b60814978">hidecalleridname</a>) {</div><div class="line"><a name="l07991"></a><span class="lineno"> 7991</span>&#160;         n = connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">valid</a> ? connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07992"></a><span class="lineno"> 7992</span>&#160;      }</div><div class="line"><a name="l07993"></a><span class="lineno"> 7993</span>&#160;   }</div><div class="line"><a name="l07994"></a><span class="lineno"> 7994</span>&#160;</div><div class="line"><a name="l07995"></a><span class="lineno"> 7995</span>&#160;   <span class="keywordflow">if</span> (strlen(c) &lt; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>) {</div><div class="line"><a name="l07996"></a><span class="lineno"> 7996</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Number &#39;%s&#39; is shorter than stripmsd (%d)\n&quot;</span>, c, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>);</div><div class="line"><a name="l07997"></a><span class="lineno"> 7997</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07998"></a><span class="lineno"> 7998</span>&#160;   }</div><div class="line"><a name="l07999"></a><span class="lineno"> 7999</span>&#160;</div><div class="line"><a name="l08000"></a><span class="lineno"> 8000</span>&#160;   <span class="comment">/* Extract any &#39;w&#39; deferred digits. */</span></div><div class="line"><a name="l08001"></a><span class="lineno"> 8001</span>&#160;   s = strchr(c + p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>, <span class="charliteral">&#39;w&#39;</span>);</div><div class="line"><a name="l08002"></a><span class="lineno"> 8002</span>&#160;   <span class="keywordflow">if</span> (s) {</div><div class="line"><a name="l08003"></a><span class="lineno"> 8003</span>&#160;      *s++ = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l08004"></a><span class="lineno"> 8004</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aa31218f7cda0b552305b7daed3a4a58d">deferred_digits</a>, s, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aa31218f7cda0b552305b7daed3a4a58d">deferred_digits</a>));</div><div class="line"><a name="l08005"></a><span class="lineno"> 8005</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l08006"></a><span class="lineno"> 8006</span>&#160;<span class="comment">       * Since we have a &#39;w&#39;, this means that there will not be any</span></div><div class="line"><a name="l08007"></a><span class="lineno"> 8007</span>&#160;<span class="comment">       * more normal dialed digits.  Therefore, the sending complete</span></div><div class="line"><a name="l08008"></a><span class="lineno"> 8008</span>&#160;<span class="comment">       * ie needs to be sent with any normal digits.</span></div><div class="line"><a name="l08009"></a><span class="lineno"> 8009</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l08010"></a><span class="lineno"> 8010</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08011"></a><span class="lineno"> 8011</span>&#160;      p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#aa31218f7cda0b552305b7daed3a4a58d">deferred_digits</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l08012"></a><span class="lineno"> 8012</span>&#160;   }</div><div class="line"><a name="l08013"></a><span class="lineno"> 8013</span>&#160;</div><div class="line"><a name="l08014"></a><span class="lineno"> 8014</span>&#160;   pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08015"></a><span class="lineno"> 8015</span>&#160;   <span class="keywordflow">if</span> (!(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = pri_new_call(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>))) {</div><div class="line"><a name="l08016"></a><span class="lineno"> 8016</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create call on channel %d\n&quot;</span>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);</div><div class="line"><a name="l08017"></a><span class="lineno"> 8017</span>&#160;      pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08018"></a><span class="lineno"> 8018</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l08019"></a><span class="lineno"> 8019</span>&#160;   }</div><div class="line"><a name="l08020"></a><span class="lineno"> 8020</span>&#160;   <span class="keywordflow">if</span> (!(sr = pri_sr_new())) {</div><div class="line"><a name="l08021"></a><span class="lineno"> 8021</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to allocate setup request on channel %d\n&quot;</span>,</div><div class="line"><a name="l08022"></a><span class="lineno"> 8022</span>&#160;         p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);</div><div class="line"><a name="l08023"></a><span class="lineno"> 8023</span>&#160;      pri_destroycall(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>);</div><div class="line"><a name="l08024"></a><span class="lineno"> 8024</span>&#160;      p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08025"></a><span class="lineno"> 8025</span>&#160;      pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08026"></a><span class="lineno"> 8026</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l08027"></a><span class="lineno"> 8027</span>&#160;   }</div><div class="line"><a name="l08028"></a><span class="lineno"> 8028</span>&#160;</div><div class="line"><a name="l08029"></a><span class="lineno"> 8029</span>&#160;   sig_pri_set_digital(p, <a class="code" href="../../d7/d86/transcap_8h.html#a5e35948d3406bb03e04e1725ad491cb0">IS_DIGITAL</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a57b29a2e12f8d2695625942049f81a2c">ast_channel_transfercapability</a>(ast)));   <span class="comment">/* push up to parent for EC */</span></div><div class="line"><a name="l08030"></a><span class="lineno"> 8030</span>&#160;</div><div class="line"><a name="l08031"></a><span class="lineno"> 8031</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l08032"></a><span class="lineno"> 8032</span>&#160;   <span class="keywordflow">if</span> (p-&gt;is_call_waiting) {</div><div class="line"><a name="l08033"></a><span class="lineno"> 8033</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l08034"></a><span class="lineno"> 8034</span>&#160;<span class="comment">       * Indicate that this is a call waiting call.</span></div><div class="line"><a name="l08035"></a><span class="lineno"> 8035</span>&#160;<span class="comment">       * i.e., Normal call but with no B channel.</span></div><div class="line"><a name="l08036"></a><span class="lineno"> 8036</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l08037"></a><span class="lineno"> 8037</span>&#160;      pri_sr_set_channel(sr, 0, 0, 1);</div><div class="line"><a name="l08038"></a><span class="lineno"> 8038</span>&#160;   } <span class="keywordflow">else</span></div><div class="line"><a name="l08039"></a><span class="lineno"> 8039</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08040"></a><span class="lineno"> 8040</span>&#160;   {</div><div class="line"><a name="l08041"></a><span class="lineno"> 8041</span>&#160;      <span class="comment">/* Should the picked channel be used exclusively? */</span></div><div class="line"><a name="l08042"></a><span class="lineno"> 8042</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a6ae2ff84731ea1e81a24412800030423">priexclusive</a> || p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">nodetype</a> == PRI_NETWORK) {</div><div class="line"><a name="l08043"></a><span class="lineno"> 8043</span>&#160;         exclusive = 1;</div><div class="line"><a name="l08044"></a><span class="lineno"> 8044</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08045"></a><span class="lineno"> 8045</span>&#160;         exclusive = 0;</div><div class="line"><a name="l08046"></a><span class="lineno"> 8046</span>&#160;      }</div><div class="line"><a name="l08047"></a><span class="lineno"> 8047</span>&#160;      pri_sr_set_channel(sr, PVT_TO_CHANNEL(p), exclusive, 1);</div><div class="line"><a name="l08048"></a><span class="lineno"> 8048</span>&#160;   }</div><div class="line"><a name="l08049"></a><span class="lineno"> 8049</span>&#160;</div><div class="line"><a name="l08050"></a><span class="lineno"> 8050</span>&#160;   pri_sr_set_bearer(sr, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf54768a4327f86de3a234648305c4a4">digital</a> ? <a class="code" href="../../de/d26/isdn__lib_8h.html#a7c03637dce11d369a3e96ad5767607c0">PRI_TRANS_CAP_DIGITAL</a> : <a class="code" href="../../d5/d7b/channel_8h.html#a57b29a2e12f8d2695625942049f81a2c">ast_channel_transfercapability</a>(ast),</div><div class="line"><a name="l08051"></a><span class="lineno"> 8051</span>&#160;      (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf54768a4327f86de3a234648305c4a4">digital</a> ? -1 : layer1));</div><div class="line"><a name="l08052"></a><span class="lineno"> 8052</span>&#160;</div><div class="line"><a name="l08053"></a><span class="lineno"> 8053</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a14c883368db3f3426581d323f33a87e0">facilityenable</a>)</div><div class="line"><a name="l08054"></a><span class="lineno"> 8054</span>&#160;      pri_facility_enable(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>);</div><div class="line"><a name="l08055"></a><span class="lineno"> 8055</span>&#160;</div><div class="line"><a name="l08056"></a><span class="lineno"> 8056</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Requested transfer capability: 0x%02hx - %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a57b29a2e12f8d2695625942049f81a2c">ast_channel_transfercapability</a>(ast), <a class="code" href="../../d5/d7b/channel_8h.html#acb027b361350d81e4b94b540fbdfe4e4">ast_transfercapability2str</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a57b29a2e12f8d2695625942049f81a2c">ast_channel_transfercapability</a>(ast)));</div><div class="line"><a name="l08057"></a><span class="lineno"> 8057</span>&#160;   dp_strip = 0;</div><div class="line"><a name="l08058"></a><span class="lineno"> 8058</span>&#160;   pridialplan = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abc70b7ddc748da4f3bfac3ac3e22d8bb">dialplan</a> - 1;</div><div class="line"><a name="l08059"></a><span class="lineno"> 8059</span>&#160;   <span class="keywordflow">if</span> (pridialplan == -2 || pridialplan == -3) { <span class="comment">/* compute dynamically */</span></div><div class="line"><a name="l08060"></a><span class="lineno"> 8060</span>&#160;      <span class="keywordflow">if</span> (strncmp(c + p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae384fc9ad39051984beca025ded44f41">internationalprefix</a>, strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae384fc9ad39051984beca025ded44f41">internationalprefix</a>)) == 0) {</div><div class="line"><a name="l08061"></a><span class="lineno"> 8061</span>&#160;         <span class="keywordflow">if</span> (pridialplan == -2) {</div><div class="line"><a name="l08062"></a><span class="lineno"> 8062</span>&#160;            dp_strip = strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae384fc9ad39051984beca025ded44f41">internationalprefix</a>);</div><div class="line"><a name="l08063"></a><span class="lineno"> 8063</span>&#160;         }</div><div class="line"><a name="l08064"></a><span class="lineno"> 8064</span>&#160;         pridialplan = PRI_INTERNATIONAL_ISDN;</div><div class="line"><a name="l08065"></a><span class="lineno"> 8065</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(c + p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a74f03b8f0dd671a3f916bdd8fe6cfb75">nationalprefix</a>, strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a74f03b8f0dd671a3f916bdd8fe6cfb75">nationalprefix</a>)) == 0) {</div><div class="line"><a name="l08066"></a><span class="lineno"> 8066</span>&#160;         <span class="keywordflow">if</span> (pridialplan == -2) {</div><div class="line"><a name="l08067"></a><span class="lineno"> 8067</span>&#160;            dp_strip = strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a74f03b8f0dd671a3f916bdd8fe6cfb75">nationalprefix</a>);</div><div class="line"><a name="l08068"></a><span class="lineno"> 8068</span>&#160;         }</div><div class="line"><a name="l08069"></a><span class="lineno"> 8069</span>&#160;         pridialplan = PRI_NATIONAL_ISDN;</div><div class="line"><a name="l08070"></a><span class="lineno"> 8070</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08071"></a><span class="lineno"> 8071</span>&#160;         pridialplan = PRI_LOCAL_ISDN;</div><div class="line"><a name="l08072"></a><span class="lineno"> 8072</span>&#160;      }</div><div class="line"><a name="l08073"></a><span class="lineno"> 8073</span>&#160;   }</div><div class="line"><a name="l08074"></a><span class="lineno"> 8074</span>&#160;   <span class="keywordflow">while</span> (c[p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>] &gt; <span class="charliteral">&#39;9&#39;</span> &amp;&amp; c[p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>] != <span class="charliteral">&#39;*&#39;</span> &amp;&amp; c[p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>] != <span class="charliteral">&#39;#&#39;</span>) {</div><div class="line"><a name="l08075"></a><span class="lineno"> 8075</span>&#160;      <span class="keywordflow">switch</span> (c[p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>]) {</div><div class="line"><a name="l08076"></a><span class="lineno"> 8076</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>:</div><div class="line"><a name="l08077"></a><span class="lineno"> 8077</span>&#160;         pridialplan = (PRI_TON_UNKNOWN &lt;&lt; 4) | (pridialplan &amp; 0xf);</div><div class="line"><a name="l08078"></a><span class="lineno"> 8078</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08079"></a><span class="lineno"> 8079</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;I&#39;</span>:</div><div class="line"><a name="l08080"></a><span class="lineno"> 8080</span>&#160;         pridialplan = (PRI_TON_INTERNATIONAL &lt;&lt; 4) | (pridialplan &amp; 0xf);</div><div class="line"><a name="l08081"></a><span class="lineno"> 8081</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08082"></a><span class="lineno"> 8082</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div><div class="line"><a name="l08083"></a><span class="lineno"> 8083</span>&#160;         pridialplan = (PRI_TON_NATIONAL &lt;&lt; 4) | (pridialplan &amp; 0xf);</div><div class="line"><a name="l08084"></a><span class="lineno"> 8084</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08085"></a><span class="lineno"> 8085</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>:</div><div class="line"><a name="l08086"></a><span class="lineno"> 8086</span>&#160;         pridialplan = (PRI_TON_NET_SPECIFIC &lt;&lt; 4) | (pridialplan &amp; 0xf);</div><div class="line"><a name="l08087"></a><span class="lineno"> 8087</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08088"></a><span class="lineno"> 8088</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:</div><div class="line"><a name="l08089"></a><span class="lineno"> 8089</span>&#160;         pridialplan = (PRI_TON_SUBSCRIBER &lt;&lt; 4) | (pridialplan &amp; 0xf);</div><div class="line"><a name="l08090"></a><span class="lineno"> 8090</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08091"></a><span class="lineno"> 8091</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:</div><div class="line"><a name="l08092"></a><span class="lineno"> 8092</span>&#160;         pridialplan = (PRI_TON_ABBREVIATED &lt;&lt; 4) | (pridialplan &amp; 0xf);</div><div class="line"><a name="l08093"></a><span class="lineno"> 8093</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08094"></a><span class="lineno"> 8094</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>:</div><div class="line"><a name="l08095"></a><span class="lineno"> 8095</span>&#160;         pridialplan = (PRI_TON_RESERVED &lt;&lt; 4) | (pridialplan &amp; 0xf);</div><div class="line"><a name="l08096"></a><span class="lineno"> 8096</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08097"></a><span class="lineno"> 8097</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>:</div><div class="line"><a name="l08098"></a><span class="lineno"> 8098</span>&#160;         pridialplan = PRI_NPI_UNKNOWN | (pridialplan &amp; 0xf0);</div><div class="line"><a name="l08099"></a><span class="lineno"> 8099</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08100"></a><span class="lineno"> 8100</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:</div><div class="line"><a name="l08101"></a><span class="lineno"> 8101</span>&#160;         pridialplan = PRI_NPI_E163_E164 | (pridialplan &amp; 0xf0);</div><div class="line"><a name="l08102"></a><span class="lineno"> 8102</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08103"></a><span class="lineno"> 8103</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div><div class="line"><a name="l08104"></a><span class="lineno"> 8104</span>&#160;         pridialplan = PRI_NPI_X121 | (pridialplan &amp; 0xf0);</div><div class="line"><a name="l08105"></a><span class="lineno"> 8105</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08106"></a><span class="lineno"> 8106</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div><div class="line"><a name="l08107"></a><span class="lineno"> 8107</span>&#160;         pridialplan = PRI_NPI_F69 | (pridialplan &amp; 0xf0);</div><div class="line"><a name="l08108"></a><span class="lineno"> 8108</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08109"></a><span class="lineno"> 8109</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div><div class="line"><a name="l08110"></a><span class="lineno"> 8110</span>&#160;         pridialplan = PRI_NPI_NATIONAL | (pridialplan &amp; 0xf0);</div><div class="line"><a name="l08111"></a><span class="lineno"> 8111</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08112"></a><span class="lineno"> 8112</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div><div class="line"><a name="l08113"></a><span class="lineno"> 8113</span>&#160;         pridialplan = PRI_NPI_PRIVATE | (pridialplan &amp; 0xf0);</div><div class="line"><a name="l08114"></a><span class="lineno"> 8114</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08115"></a><span class="lineno"> 8115</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div><div class="line"><a name="l08116"></a><span class="lineno"> 8116</span>&#160;         pridialplan = PRI_NPI_RESERVED | (pridialplan &amp; 0xf0);</div><div class="line"><a name="l08117"></a><span class="lineno"> 8117</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08118"></a><span class="lineno"> 8118</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l08119"></a><span class="lineno"> 8119</span>&#160;         <span class="keywordflow">if</span> (isalpha(c[p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>])) {</div><div class="line"><a name="l08120"></a><span class="lineno"> 8120</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unrecognized pridialplan %s modifier: %c\n&quot;</span>,</div><div class="line"><a name="l08121"></a><span class="lineno"> 8121</span>&#160;               c[p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>] &gt; <span class="charliteral">&#39;Z&#39;</span> ? <span class="stringliteral">&quot;NPI&quot;</span> : <span class="stringliteral">&quot;TON&quot;</span>, c[p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a>]);</div><div class="line"><a name="l08122"></a><span class="lineno"> 8122</span>&#160;         }</div><div class="line"><a name="l08123"></a><span class="lineno"> 8123</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08124"></a><span class="lineno"> 8124</span>&#160;      }</div><div class="line"><a name="l08125"></a><span class="lineno"> 8125</span>&#160;      c++;</div><div class="line"><a name="l08126"></a><span class="lineno"> 8126</span>&#160;   }</div><div class="line"><a name="l08127"></a><span class="lineno"> 8127</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SETUP_KEYPAD)</span></div><div class="line"><a name="l08128"></a><span class="lineno"> 8128</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, OPT_KEYPAD)</div><div class="line"><a name="l08129"></a><span class="lineno"> 8129</span>&#160;      &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(opt_args[OPT_ARG_KEYPAD])) {</div><div class="line"><a name="l08130"></a><span class="lineno"> 8130</span>&#160;      <span class="comment">/* We have a keypad facility digits option with digits. */</span></div><div class="line"><a name="l08131"></a><span class="lineno"> 8131</span>&#160;      keypad = opt_args[OPT_ARG_KEYPAD];</div><div class="line"><a name="l08132"></a><span class="lineno"> 8132</span>&#160;      pri_sr_set_keypad_digits(sr, keypad);</div><div class="line"><a name="l08133"></a><span class="lineno"> 8133</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08134"></a><span class="lineno"> 8134</span>&#160;      keypad = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08135"></a><span class="lineno"> 8135</span>&#160;   }</div><div class="line"><a name="l08136"></a><span class="lineno"> 8136</span>&#160;   <span class="keywordflow">if</span> (!keypad || !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(c + p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a> + dp_strip))</div><div class="line"><a name="l08137"></a><span class="lineno"> 8137</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SETUP_KEYPAD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08138"></a><span class="lineno"> 8138</span>&#160;   {</div><div class="line"><a name="l08139"></a><span class="lineno"> 8139</span>&#160;      <span class="keywordtype">char</span> *called = c + p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a> + dp_strip;</div><div class="line"><a name="l08140"></a><span class="lineno"> 8140</span>&#160;</div><div class="line"><a name="l08141"></a><span class="lineno"> 8141</span>&#160;      pri_sr_set_called(sr, called, pridialplan, s ? 1 : 0);</div><div class="line"><a name="l08142"></a><span class="lineno"> 8142</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SETUP_ACK_INBAND)</span></div><div class="line"><a name="l08143"></a><span class="lineno"> 8143</span>&#160;      p-&gt;no_dialed_digits = !called[0];</div><div class="line"><a name="l08144"></a><span class="lineno"> 8144</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SETUP_ACK_INBAND) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08145"></a><span class="lineno"> 8145</span>&#160;   }</div><div class="line"><a name="l08146"></a><span class="lineno"> 8146</span>&#160;</div><div class="line"><a name="l08147"></a><span class="lineno"> 8147</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SUBADDR)</span></div><div class="line"><a name="l08148"></a><span class="lineno"> 8148</span>&#160;   <span class="keywordflow">if</span> (dialed_subaddress.valid) {</div><div class="line"><a name="l08149"></a><span class="lineno"> 8149</span>&#160;      <span class="keyword">struct </span>pri_party_subaddress subaddress;</div><div class="line"><a name="l08150"></a><span class="lineno"> 8150</span>&#160;</div><div class="line"><a name="l08151"></a><span class="lineno"> 8151</span>&#160;      memset(&amp;subaddress, 0, <span class="keyword">sizeof</span>(subaddress));</div><div class="line"><a name="l08152"></a><span class="lineno"> 8152</span>&#160;      sig_pri_party_subaddress_from_ast(&amp;subaddress, &amp;dialed_subaddress);</div><div class="line"><a name="l08153"></a><span class="lineno"> 8153</span>&#160;      pri_sr_set_called_subaddress(sr, &amp;subaddress);</div><div class="line"><a name="l08154"></a><span class="lineno"> 8154</span>&#160;   }</div><div class="line"><a name="l08155"></a><span class="lineno"> 8155</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SUBADDR) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08156"></a><span class="lineno"> 8156</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_REVERSE_CHARGE)</span></div><div class="line"><a name="l08157"></a><span class="lineno"> 8157</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, OPT_REVERSE_CHARGE)) {</div><div class="line"><a name="l08158"></a><span class="lineno"> 8158</span>&#160;      pri_sr_set_reversecharge(sr, PRI_REVERSECHARGE_REQUESTED);</div><div class="line"><a name="l08159"></a><span class="lineno"> 8159</span>&#160;   }</div><div class="line"><a name="l08160"></a><span class="lineno"> 8160</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_REVERSE_CHARGE) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08161"></a><span class="lineno"> 8161</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l08162"></a><span class="lineno"> 8162</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, OPT_AOC_REQUEST)</div><div class="line"><a name="l08163"></a><span class="lineno"> 8163</span>&#160;      &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(opt_args[OPT_ARG_AOC_REQUEST])) {</div><div class="line"><a name="l08164"></a><span class="lineno"> 8164</span>&#160;      <span class="keywordflow">if</span> (strchr(opt_args[OPT_ARG_AOC_REQUEST], <span class="charliteral">&#39;s&#39;</span>)) {</div><div class="line"><a name="l08165"></a><span class="lineno"> 8165</span>&#160;         pri_sr_set_aoc_charging_request(sr, PRI_AOC_REQUEST_S);</div><div class="line"><a name="l08166"></a><span class="lineno"> 8166</span>&#160;      }</div><div class="line"><a name="l08167"></a><span class="lineno"> 8167</span>&#160;      <span class="keywordflow">if</span> (strchr(opt_args[OPT_ARG_AOC_REQUEST], <span class="charliteral">&#39;d&#39;</span>)) {</div><div class="line"><a name="l08168"></a><span class="lineno"> 8168</span>&#160;         pri_sr_set_aoc_charging_request(sr, PRI_AOC_REQUEST_D);</div><div class="line"><a name="l08169"></a><span class="lineno"> 8169</span>&#160;      }</div><div class="line"><a name="l08170"></a><span class="lineno"> 8170</span>&#160;      <span class="keywordflow">if</span> (strchr(opt_args[OPT_ARG_AOC_REQUEST], <span class="charliteral">&#39;e&#39;</span>)) {</div><div class="line"><a name="l08171"></a><span class="lineno"> 8171</span>&#160;         pri_sr_set_aoc_charging_request(sr, PRI_AOC_REQUEST_E);</div><div class="line"><a name="l08172"></a><span class="lineno"> 8172</span>&#160;      }</div><div class="line"><a name="l08173"></a><span class="lineno"> 8173</span>&#160;   }</div><div class="line"><a name="l08174"></a><span class="lineno"> 8174</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08175"></a><span class="lineno"> 8175</span>&#160;</div><div class="line"><a name="l08176"></a><span class="lineno"> 8176</span>&#160;   <span class="comment">/* Setup the user tag for party id&#39;s from this device for this call. */</span></div><div class="line"><a name="l08177"></a><span class="lineno"> 8177</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a798fd91893ed411125afa28a5a7addc7">append_msn_to_user_tag</a>) {</div><div class="line"><a name="l08178"></a><span class="lineno"> 8178</span>&#160;      snprintf(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>), <span class="stringliteral">&quot;%s_%s&quot;</span>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#af985df4218702eebfb4949ccd29657ca">initial_user_tag</a>,</div><div class="line"><a name="l08179"></a><span class="lineno"> 8179</span>&#160;         p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">nodetype</a> == PRI_NETWORK</div><div class="line"><a name="l08180"></a><span class="lineno"> 8180</span>&#160;            ? c + p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a> + dp_strip</div><div class="line"><a name="l08181"></a><span class="lineno"> 8181</span>&#160;            : <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a10f23f1907b804485f62973f66cd9aef">ast_channel_connected</a>(ast)-&gt;<span class="keywordtype">id</span>.number.valid,</div><div class="line"><a name="l08182"></a><span class="lineno"> 8182</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a10f23f1907b804485f62973f66cd9aef">ast_channel_connected</a>(ast)-&gt;<span class="keywordtype">id</span>.number.str, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l08183"></a><span class="lineno"> 8183</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08184"></a><span class="lineno"> 8184</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#af985df4218702eebfb4949ccd29657ca">initial_user_tag</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>));</div><div class="line"><a name="l08185"></a><span class="lineno"> 8185</span>&#160;   }</div><div class="line"><a name="l08186"></a><span class="lineno"> 8186</span>&#160;</div><div class="line"><a name="l08187"></a><span class="lineno"> 8187</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l08188"></a><span class="lineno"> 8188</span>&#160;<span class="comment">    * Replace the caller id tag from the channel creation</span></div><div class="line"><a name="l08189"></a><span class="lineno"> 8189</span>&#160;<span class="comment">    * with the actual tag value.</span></div><div class="line"><a name="l08190"></a><span class="lineno"> 8190</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l08191"></a><span class="lineno"> 8191</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(ast)-&gt;<span class="keywordtype">id</span>.tag);</div><div class="line"><a name="l08192"></a><span class="lineno"> 8192</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(ast)-&gt;<a class="code" href="../../d4/d77/structast__party__caller.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#a7bb5e40c10df6a41df64bda1f4bb3e26">tag</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">user_tag</a>);</div><div class="line"><a name="l08193"></a><span class="lineno"> 8193</span>&#160;</div><div class="line"><a name="l08194"></a><span class="lineno"> 8194</span>&#160;   ldp_strip = 0;</div><div class="line"><a name="l08195"></a><span class="lineno"> 8195</span>&#160;   prilocaldialplan = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a62ee3212e1b83895e0e9c5095cb63cb6">localdialplan</a> - 1;</div><div class="line"><a name="l08196"></a><span class="lineno"> 8196</span>&#160;   <span class="keywordflow">if</span> ((l != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (prilocaldialplan == -2 || prilocaldialplan == -3)) { <span class="comment">/* compute dynamically */</span></div><div class="line"><a name="l08197"></a><span class="lineno"> 8197</span>&#160;      <span class="keywordflow">if</span> (strncmp(l, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae384fc9ad39051984beca025ded44f41">internationalprefix</a>, strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae384fc9ad39051984beca025ded44f41">internationalprefix</a>)) == 0) {</div><div class="line"><a name="l08198"></a><span class="lineno"> 8198</span>&#160;         <span class="keywordflow">if</span> (prilocaldialplan == -2) {</div><div class="line"><a name="l08199"></a><span class="lineno"> 8199</span>&#160;            ldp_strip = strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae384fc9ad39051984beca025ded44f41">internationalprefix</a>);</div><div class="line"><a name="l08200"></a><span class="lineno"> 8200</span>&#160;         }</div><div class="line"><a name="l08201"></a><span class="lineno"> 8201</span>&#160;         prilocaldialplan = PRI_INTERNATIONAL_ISDN;</div><div class="line"><a name="l08202"></a><span class="lineno"> 8202</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(l, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a74f03b8f0dd671a3f916bdd8fe6cfb75">nationalprefix</a>, strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a74f03b8f0dd671a3f916bdd8fe6cfb75">nationalprefix</a>)) == 0) {</div><div class="line"><a name="l08203"></a><span class="lineno"> 8203</span>&#160;         <span class="keywordflow">if</span> (prilocaldialplan == -2) {</div><div class="line"><a name="l08204"></a><span class="lineno"> 8204</span>&#160;            ldp_strip = strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a74f03b8f0dd671a3f916bdd8fe6cfb75">nationalprefix</a>);</div><div class="line"><a name="l08205"></a><span class="lineno"> 8205</span>&#160;         }</div><div class="line"><a name="l08206"></a><span class="lineno"> 8206</span>&#160;         prilocaldialplan = PRI_NATIONAL_ISDN;</div><div class="line"><a name="l08207"></a><span class="lineno"> 8207</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08208"></a><span class="lineno"> 8208</span>&#160;         prilocaldialplan = PRI_LOCAL_ISDN;</div><div class="line"><a name="l08209"></a><span class="lineno"> 8209</span>&#160;      }</div><div class="line"><a name="l08210"></a><span class="lineno"> 8210</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prilocaldialplan == -1) {</div><div class="line"><a name="l08211"></a><span class="lineno"> 8211</span>&#160;      <span class="comment">/* Use the numbering plan passed in. */</span></div><div class="line"><a name="l08212"></a><span class="lineno"> 8212</span>&#160;      prilocaldialplan = connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ad1f8db563cb99d404b72e02cf8f78cd1">plan</a>;</div><div class="line"><a name="l08213"></a><span class="lineno"> 8213</span>&#160;   }</div><div class="line"><a name="l08214"></a><span class="lineno"> 8214</span>&#160;   <span class="keywordflow">if</span> (l != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div><div class="line"><a name="l08215"></a><span class="lineno"> 8215</span>&#160;      <span class="keywordflow">while</span> (*l &gt; <span class="charliteral">&#39;9&#39;</span> &amp;&amp; *l != <span class="charliteral">&#39;*&#39;</span> &amp;&amp; *l != <span class="charliteral">&#39;#&#39;</span>) {</div><div class="line"><a name="l08216"></a><span class="lineno"> 8216</span>&#160;         <span class="keywordflow">switch</span> (*l) {</div><div class="line"><a name="l08217"></a><span class="lineno"> 8217</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>:</div><div class="line"><a name="l08218"></a><span class="lineno"> 8218</span>&#160;            prilocaldialplan = (PRI_TON_UNKNOWN &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);</div><div class="line"><a name="l08219"></a><span class="lineno"> 8219</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08220"></a><span class="lineno"> 8220</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;I&#39;</span>:</div><div class="line"><a name="l08221"></a><span class="lineno"> 8221</span>&#160;            prilocaldialplan = (PRI_TON_INTERNATIONAL &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);</div><div class="line"><a name="l08222"></a><span class="lineno"> 8222</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08223"></a><span class="lineno"> 8223</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div><div class="line"><a name="l08224"></a><span class="lineno"> 8224</span>&#160;            prilocaldialplan = (PRI_TON_NATIONAL &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);</div><div class="line"><a name="l08225"></a><span class="lineno"> 8225</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08226"></a><span class="lineno"> 8226</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>:</div><div class="line"><a name="l08227"></a><span class="lineno"> 8227</span>&#160;            prilocaldialplan = (PRI_TON_NET_SPECIFIC &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);</div><div class="line"><a name="l08228"></a><span class="lineno"> 8228</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08229"></a><span class="lineno"> 8229</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:</div><div class="line"><a name="l08230"></a><span class="lineno"> 8230</span>&#160;            prilocaldialplan = (PRI_TON_SUBSCRIBER &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);</div><div class="line"><a name="l08231"></a><span class="lineno"> 8231</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08232"></a><span class="lineno"> 8232</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:</div><div class="line"><a name="l08233"></a><span class="lineno"> 8233</span>&#160;            prilocaldialplan = (PRI_TON_ABBREVIATED &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);</div><div class="line"><a name="l08234"></a><span class="lineno"> 8234</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08235"></a><span class="lineno"> 8235</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>:</div><div class="line"><a name="l08236"></a><span class="lineno"> 8236</span>&#160;            prilocaldialplan = (PRI_TON_RESERVED &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);</div><div class="line"><a name="l08237"></a><span class="lineno"> 8237</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08238"></a><span class="lineno"> 8238</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>:</div><div class="line"><a name="l08239"></a><span class="lineno"> 8239</span>&#160;            prilocaldialplan = PRI_NPI_UNKNOWN | (prilocaldialplan &amp; 0xf0);</div><div class="line"><a name="l08240"></a><span class="lineno"> 8240</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08241"></a><span class="lineno"> 8241</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:</div><div class="line"><a name="l08242"></a><span class="lineno"> 8242</span>&#160;            prilocaldialplan = PRI_NPI_E163_E164 | (prilocaldialplan &amp; 0xf0);</div><div class="line"><a name="l08243"></a><span class="lineno"> 8243</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08244"></a><span class="lineno"> 8244</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div><div class="line"><a name="l08245"></a><span class="lineno"> 8245</span>&#160;            prilocaldialplan = PRI_NPI_X121 | (prilocaldialplan &amp; 0xf0);</div><div class="line"><a name="l08246"></a><span class="lineno"> 8246</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08247"></a><span class="lineno"> 8247</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div><div class="line"><a name="l08248"></a><span class="lineno"> 8248</span>&#160;            prilocaldialplan = PRI_NPI_F69 | (prilocaldialplan &amp; 0xf0);</div><div class="line"><a name="l08249"></a><span class="lineno"> 8249</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08250"></a><span class="lineno"> 8250</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div><div class="line"><a name="l08251"></a><span class="lineno"> 8251</span>&#160;            prilocaldialplan = PRI_NPI_NATIONAL | (prilocaldialplan &amp; 0xf0);</div><div class="line"><a name="l08252"></a><span class="lineno"> 8252</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08253"></a><span class="lineno"> 8253</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div><div class="line"><a name="l08254"></a><span class="lineno"> 8254</span>&#160;            prilocaldialplan = PRI_NPI_PRIVATE | (prilocaldialplan &amp; 0xf0);</div><div class="line"><a name="l08255"></a><span class="lineno"> 8255</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08256"></a><span class="lineno"> 8256</span>&#160;         <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div><div class="line"><a name="l08257"></a><span class="lineno"> 8257</span>&#160;            prilocaldialplan = PRI_NPI_RESERVED | (prilocaldialplan &amp; 0xf0);</div><div class="line"><a name="l08258"></a><span class="lineno"> 8258</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08259"></a><span class="lineno"> 8259</span>&#160;         <span class="keywordflow">default</span>:</div><div class="line"><a name="l08260"></a><span class="lineno"> 8260</span>&#160;            <span class="keywordflow">if</span> (isalpha(*l)) {</div><div class="line"><a name="l08261"></a><span class="lineno"> 8261</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l08262"></a><span class="lineno"> 8262</span>&#160;                  <span class="stringliteral">&quot;Unrecognized prilocaldialplan %s modifier: %c\n&quot;</span>,</div><div class="line"><a name="l08263"></a><span class="lineno"> 8263</span>&#160;                  *l &gt; <span class="charliteral">&#39;Z&#39;</span> ? <span class="stringliteral">&quot;NPI&quot;</span> : <span class="stringliteral">&quot;TON&quot;</span>, *l);</div><div class="line"><a name="l08264"></a><span class="lineno"> 8264</span>&#160;            }</div><div class="line"><a name="l08265"></a><span class="lineno"> 8265</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08266"></a><span class="lineno"> 8266</span>&#160;         }</div><div class="line"><a name="l08267"></a><span class="lineno"> 8267</span>&#160;         l++;</div><div class="line"><a name="l08268"></a><span class="lineno"> 8268</span>&#160;      }</div><div class="line"><a name="l08269"></a><span class="lineno"> 8269</span>&#160;   }</div><div class="line"><a name="l08270"></a><span class="lineno"> 8270</span>&#160;   pri_sr_set_caller(sr, l ? (l + ldp_strip) : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, n, prilocaldialplan,</div><div class="line"><a name="l08271"></a><span class="lineno"> 8271</span>&#160;      p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a6799914e39462ec4cfef0e6b310e7104">use_callingpres</a> ? connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#a3df9119032baa1743f2db71344bd7cac">presentation</a> : (l ? PRES_ALLOWED_USER_NUMBER_PASSED_SCREEN : PRES_NUMBER_NOT_AVAILABLE));</div><div class="line"><a name="l08272"></a><span class="lineno"> 8272</span>&#160;</div><div class="line"><a name="l08273"></a><span class="lineno"> 8273</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SUBADDR)</span></div><div class="line"><a name="l08274"></a><span class="lineno"> 8274</span>&#160;   <span class="keywordflow">if</span> (connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#a10023f503341f2b8c82117b31a0cc531">subaddress</a>.<a class="code" href="../../d7/d41/structast__party__subaddress.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>) {</div><div class="line"><a name="l08275"></a><span class="lineno"> 8275</span>&#160;      <span class="keyword">struct </span>pri_party_subaddress subaddress;</div><div class="line"><a name="l08276"></a><span class="lineno"> 8276</span>&#160;</div><div class="line"><a name="l08277"></a><span class="lineno"> 8277</span>&#160;      memset(&amp;subaddress, 0, <span class="keyword">sizeof</span>(subaddress));</div><div class="line"><a name="l08278"></a><span class="lineno"> 8278</span>&#160;      sig_pri_party_subaddress_from_ast(&amp;subaddress, &amp;connected_id.<a class="code" href="../../d1/dcb/structast__party__id.html#a10023f503341f2b8c82117b31a0cc531">subaddress</a>);</div><div class="line"><a name="l08279"></a><span class="lineno"> 8279</span>&#160;      pri_sr_set_caller_subaddress(sr, &amp;subaddress);</div><div class="line"><a name="l08280"></a><span class="lineno"> 8280</span>&#160;   }</div><div class="line"><a name="l08281"></a><span class="lineno"> 8281</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SUBADDR) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08282"></a><span class="lineno"> 8282</span>&#160;</div><div class="line"><a name="l08283"></a><span class="lineno"> 8283</span>&#160;   sig_pri_redirecting_update(p, ast);</div><div class="line"><a name="l08284"></a><span class="lineno"> 8284</span>&#160;</div><div class="line"><a name="l08285"></a><span class="lineno"> 8285</span>&#160;<span class="preprocessor">#ifdef SUPPORT_USERUSER</span></div><div class="line"><a name="l08286"></a><span class="lineno"> 8286</span>&#160;   <span class="comment">/* User-user info */</span></div><div class="line"><a name="l08287"></a><span class="lineno"> 8287</span>&#160;   useruser = <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <span class="stringliteral">&quot;USERUSERINFO&quot;</span>);</div><div class="line"><a name="l08288"></a><span class="lineno"> 8288</span>&#160;   <span class="keywordflow">if</span> (useruser)</div><div class="line"><a name="l08289"></a><span class="lineno"> 8289</span>&#160;      pri_sr_set_useruser(sr, useruser);</div><div class="line"><a name="l08290"></a><span class="lineno"> 8290</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l08291"></a><span class="lineno"> 8291</span>&#160;</div><div class="line"><a name="l08292"></a><span class="lineno"> 8292</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l08293"></a><span class="lineno"> 8293</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/dc8/ccss_8h.html#a2fd3a95509d01b9ed748148277b753f6">ast_cc_is_recall</a>(ast, &amp;core_id, sig_pri_cc_type_name)) {</div><div class="line"><a name="l08294"></a><span class="lineno"> 8294</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d0/d6e/structast__cc__monitor.html">ast_cc_monitor</a> *<a class="code" href="../../da/dde/chan__phone_8c.html#a4e40373706bcf5cdb9409dac3166d280">monitor</a>;</div><div class="line"><a name="l08295"></a><span class="lineno"> 8295</span>&#160;      <span class="keywordtype">char</span> device_name[<a class="code" href="../../d5/d7b/channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>];</div><div class="line"><a name="l08296"></a><span class="lineno"> 8296</span>&#160;</div><div class="line"><a name="l08297"></a><span class="lineno"> 8297</span>&#160;      <span class="comment">/* This is a CC recall call. */</span></div><div class="line"><a name="l08298"></a><span class="lineno"> 8298</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a1677fd1f6e2cab646aeb76db8a044c2e">ast_channel_get_device_name</a>(ast, device_name, <span class="keyword">sizeof</span>(device_name));</div><div class="line"><a name="l08299"></a><span class="lineno"> 8299</span>&#160;      monitor = <a class="code" href="../../de/dc8/ccss_8h.html#a05d18d9e83ba249ca1e5f23c537f2535">ast_cc_get_monitor_by_recall_core_id</a>(core_id, device_name);</div><div class="line"><a name="l08300"></a><span class="lineno"> 8300</span>&#160;      <span class="keywordflow">if</span> (monitor) {</div><div class="line"><a name="l08301"></a><span class="lineno"> 8301</span>&#160;         <span class="keyword">struct </span>sig_pri_cc_monitor_instance *instance;</div><div class="line"><a name="l08302"></a><span class="lineno"> 8302</span>&#160;</div><div class="line"><a name="l08303"></a><span class="lineno"> 8303</span>&#160;         instance = monitor-&gt;<a class="code" href="../../d0/d6e/structast__cc__monitor.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l08304"></a><span class="lineno"> 8304</span>&#160;</div><div class="line"><a name="l08305"></a><span class="lineno"> 8305</span>&#160;         <span class="comment">/* If this fails then we have monitor instance ambiguity. */</span></div><div class="line"><a name="l08306"></a><span class="lineno"> 8306</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a> == instance-&gt;pri);</div><div class="line"><a name="l08307"></a><span class="lineno"> 8307</span>&#160;</div><div class="line"><a name="l08308"></a><span class="lineno"> 8308</span>&#160;         <span class="keywordflow">if</span> (pri_cc_call(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, instance-&gt;cc_id, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, sr)) {</div><div class="line"><a name="l08309"></a><span class="lineno"> 8309</span>&#160;            <span class="comment">/* The CC recall call failed for some reason. */</span></div><div class="line"><a name="l08310"></a><span class="lineno"> 8310</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to setup CC recall call to device %s\n&quot;</span>,</div><div class="line"><a name="l08311"></a><span class="lineno"> 8311</span>&#160;               device_name);</div><div class="line"><a name="l08312"></a><span class="lineno"> 8312</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l08313"></a><span class="lineno"> 8313</span>&#160;            pri_destroycall(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>);</div><div class="line"><a name="l08314"></a><span class="lineno"> 8314</span>&#160;            p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08315"></a><span class="lineno"> 8315</span>&#160;            pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08316"></a><span class="lineno"> 8316</span>&#160;            pri_sr_free(sr);</div><div class="line"><a name="l08317"></a><span class="lineno"> 8317</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l08318"></a><span class="lineno"> 8318</span>&#160;         }</div><div class="line"><a name="l08319"></a><span class="lineno"> 8319</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l08320"></a><span class="lineno"> 8320</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08321"></a><span class="lineno"> 8321</span>&#160;         core_id = -1;</div><div class="line"><a name="l08322"></a><span class="lineno"> 8322</span>&#160;      }</div><div class="line"><a name="l08323"></a><span class="lineno"> 8323</span>&#160;   } <span class="keywordflow">else</span></div><div class="line"><a name="l08324"></a><span class="lineno"> 8324</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08325"></a><span class="lineno"> 8325</span>&#160;   {</div><div class="line"><a name="l08326"></a><span class="lineno"> 8326</span>&#160;      core_id = -1;</div><div class="line"><a name="l08327"></a><span class="lineno"> 8327</span>&#160;   }</div><div class="line"><a name="l08328"></a><span class="lineno"> 8328</span>&#160;   <span class="keywordflow">if</span> (core_id == -1 &amp;&amp; pri_setup(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, sr)) {</div><div class="line"><a name="l08329"></a><span class="lineno"> 8329</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to setup call to %s (using %s)\n&quot;</span>,</div><div class="line"><a name="l08330"></a><span class="lineno"> 8330</span>&#160;         c + p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">stripmsd</a> + dp_strip, dialplan2str(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abc70b7ddc748da4f3bfac3ac3e22d8bb">dialplan</a>));</div><div class="line"><a name="l08331"></a><span class="lineno"> 8331</span>&#160;      pri_destroycall(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>);</div><div class="line"><a name="l08332"></a><span class="lineno"> 8332</span>&#160;      p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08333"></a><span class="lineno"> 8333</span>&#160;      pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08334"></a><span class="lineno"> 8334</span>&#160;      pri_sr_free(sr);</div><div class="line"><a name="l08335"></a><span class="lineno"> 8335</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l08336"></a><span class="lineno"> 8336</span>&#160;   }</div><div class="line"><a name="l08337"></a><span class="lineno"> 8337</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aebff40bc07274874bba2159ad5b22d73">SIG_PRI_CALL_LEVEL_SETUP</a>;</div><div class="line"><a name="l08338"></a><span class="lineno"> 8338</span>&#160;   pri_sr_free(sr);</div><div class="line"><a name="l08339"></a><span class="lineno"> 8339</span>&#160;   <a class="code" href="../../d9/d95/channelstate_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448">ast_setstate</a>(ast, <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>);</div><div class="line"><a name="l08340"></a><span class="lineno"> 8340</span>&#160;   sig_pri_set_dialing(p, 1);</div><div class="line"><a name="l08341"></a><span class="lineno"> 8341</span>&#160;   pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08342"></a><span class="lineno"> 8342</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08343"></a><span class="lineno"> 8343</span>&#160;}</div><div class="line"><a name="l08344"></a><span class="lineno"> 8344</span>&#160;</div><div class="line"><a name="l08345"></a><span class="lineno"> 8345</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a1f2b8458e88cb20f51d2b1503f764155">sig_pri_indicate</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keywordtype">int</span> condition, <span class="keyword">const</span> <span class="keywordtype">void</span> *data, <span class="keywordtype">size_t</span> datalen)</div><div class="line"><a name="l08346"></a><span class="lineno"> 8346</span>&#160;{</div><div class="line"><a name="l08347"></a><span class="lineno"> 8347</span>&#160;   <span class="keywordtype">int</span> res = -1;</div><div class="line"><a name="l08348"></a><span class="lineno"> 8348</span>&#160;</div><div class="line"><a name="l08349"></a><span class="lineno"> 8349</span>&#160;   <span class="keywordflow">switch</span> (condition) {</div><div class="line"><a name="l08350"></a><span class="lineno"> 8350</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:</div><div class="line"><a name="l08351"></a><span class="lineno"> 8351</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ab7d3c3f03d40ad5cea4721e94cb64e40">priindication_oob</a> || p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a>) {</div><div class="line"><a name="l08352"></a><span class="lineno"> 8352</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(chan, <a class="code" href="../../d4/da3/causes_8h.html#aff0e956cb3ef657557fa468a17416c0b">AST_CAUSE_USER_BUSY</a>);</div><div class="line"><a name="l08353"></a><span class="lineno"> 8353</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ab683c21c4a34450c4bfb8b672a7b4045">ast_channel_softhangup_internal_flag_add</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);</div><div class="line"><a name="l08354"></a><span class="lineno"> 8354</span>&#160;         res = 0;</div><div class="line"><a name="l08355"></a><span class="lineno"> 8355</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08356"></a><span class="lineno"> 8356</span>&#160;      }</div><div class="line"><a name="l08357"></a><span class="lineno"> 8357</span>&#160;      res = sig_pri_play_tone(p, <a class="code" href="../../d7/d6c/sig__pri_8h.html#ae264fa3d1f9d29c2c76c99bfa13ce95ca95fc0cfdbf646707ffc820daff31fbb3">SIG_PRI_TONE_BUSY</a>);</div><div class="line"><a name="l08358"></a><span class="lineno"> 8358</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aadfde2210c446742a8276382cb57a960">SIG_PRI_CALL_LEVEL_ALERTING</a> &amp;&amp; !p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a>) {</div><div class="line"><a name="l08359"></a><span class="lineno"> 8359</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(chan, <a class="code" href="../../d4/da3/causes_8h.html#aff0e956cb3ef657557fa468a17416c0b">AST_CAUSE_USER_BUSY</a>);</div><div class="line"><a name="l08360"></a><span class="lineno"> 8360</span>&#160;         p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> = 1;<span class="comment">/* No need to send plain PROGRESS after this. */</span></div><div class="line"><a name="l08361"></a><span class="lineno"> 8361</span>&#160;         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a> &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>) {</div><div class="line"><a name="l08362"></a><span class="lineno"> 8362</span>&#160;            pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08363"></a><span class="lineno"> 8363</span>&#160;<span class="preprocessor">#ifdef HAVE_PRI_PROG_W_CAUSE</span></div><div class="line"><a name="l08364"></a><span class="lineno"> 8364</span>&#160;            pri_progress_with_cause(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, PVT_TO_CHANNEL(p), 1, <a class="code" href="../../d5/d7b/channel_8h.html#aa04afa262d7e1b211ee32d17c949a275">ast_channel_hangupcause</a>(chan));</div><div class="line"><a name="l08365"></a><span class="lineno"> 8365</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l08366"></a><span class="lineno"> 8366</span>&#160;            pri_progress(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>,p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, PVT_TO_CHANNEL(p), 1);</div><div class="line"><a name="l08367"></a><span class="lineno"> 8367</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l08368"></a><span class="lineno"> 8368</span>&#160;            pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08369"></a><span class="lineno"> 8369</span>&#160;         }</div><div class="line"><a name="l08370"></a><span class="lineno"> 8370</span>&#160;      }</div><div class="line"><a name="l08371"></a><span class="lineno"> 8371</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08372"></a><span class="lineno"> 8372</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:</div><div class="line"><a name="l08373"></a><span class="lineno"> 8373</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aadfde2210c446742a8276382cb57a960">SIG_PRI_CALL_LEVEL_ALERTING</a> &amp;&amp; !p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a>) {</div><div class="line"><a name="l08374"></a><span class="lineno"> 8374</span>&#160;         p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aadfde2210c446742a8276382cb57a960">SIG_PRI_CALL_LEVEL_ALERTING</a>;</div><div class="line"><a name="l08375"></a><span class="lineno"> 8375</span>&#160;         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a> &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>) {</div><div class="line"><a name="l08376"></a><span class="lineno"> 8376</span>&#160;            pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08377"></a><span class="lineno"> 8377</span>&#160;            pri_acknowledge(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>,p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, PVT_TO_CHANNEL(p),</div><div class="line"><a name="l08378"></a><span class="lineno"> 8378</span>&#160;               p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a> || p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf54768a4327f86de3a234648305c4a4">digital</a> ? 0 : 1);</div><div class="line"><a name="l08379"></a><span class="lineno"> 8379</span>&#160;            pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08380"></a><span class="lineno"> 8380</span>&#160;         }</div><div class="line"><a name="l08381"></a><span class="lineno"> 8381</span>&#160;      }</div><div class="line"><a name="l08382"></a><span class="lineno"> 8382</span>&#160;      res = sig_pri_play_tone(p, <a class="code" href="../../d7/d6c/sig__pri_8h.html#ae264fa3d1f9d29c2c76c99bfa13ce95ca139c33a85a3c32eb483419e56d08d385">SIG_PRI_TONE_RINGTONE</a>);</div><div class="line"><a name="l08383"></a><span class="lineno"> 8383</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(chan) != <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {</div><div class="line"><a name="l08384"></a><span class="lineno"> 8384</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(chan) != <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>)</div><div class="line"><a name="l08385"></a><span class="lineno"> 8385</span>&#160;            <a class="code" href="../../d9/d95/channelstate_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448">ast_setstate</a>(chan, <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>);</div><div class="line"><a name="l08386"></a><span class="lineno"> 8386</span>&#160;      }</div><div class="line"><a name="l08387"></a><span class="lineno"> 8387</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08388"></a><span class="lineno"> 8388</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>:</div><div class="line"><a name="l08389"></a><span class="lineno"> 8389</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Received AST_CONTROL_PROCEEDING on %s\n&quot;</span>,<a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l08390"></a><span class="lineno"> 8390</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a60273beaf5da6262358cc2add8aa2765">SIG_PRI_CALL_LEVEL_PROCEEDING</a> &amp;&amp; !p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a>) {</div><div class="line"><a name="l08391"></a><span class="lineno"> 8391</span>&#160;         p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a60273beaf5da6262358cc2add8aa2765">SIG_PRI_CALL_LEVEL_PROCEEDING</a>;</div><div class="line"><a name="l08392"></a><span class="lineno"> 8392</span>&#160;         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a> &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>) {</div><div class="line"><a name="l08393"></a><span class="lineno"> 8393</span>&#160;            pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08394"></a><span class="lineno"> 8394</span>&#160;            pri_proceeding(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>,p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, PVT_TO_CHANNEL(p), 0);</div><div class="line"><a name="l08395"></a><span class="lineno"> 8395</span>&#160;            pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08396"></a><span class="lineno"> 8396</span>&#160;         }</div><div class="line"><a name="l08397"></a><span class="lineno"> 8397</span>&#160;      }</div><div class="line"><a name="l08398"></a><span class="lineno"> 8398</span>&#160;      <span class="comment">/* don&#39;t continue in ast_indicate */</span></div><div class="line"><a name="l08399"></a><span class="lineno"> 8399</span>&#160;      res = 0;</div><div class="line"><a name="l08400"></a><span class="lineno"> 8400</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08401"></a><span class="lineno"> 8401</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>:</div><div class="line"><a name="l08402"></a><span class="lineno"> 8402</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Received AST_CONTROL_PROGRESS on %s\n&quot;</span>,<a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l08403"></a><span class="lineno"> 8403</span>&#160;      sig_pri_set_digital(p, 0); <span class="comment">/* Digital-only calls isn&#39;t allowing any inband progress messages */</span></div><div class="line"><a name="l08404"></a><span class="lineno"> 8404</span>&#160;      <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aadfde2210c446742a8276382cb57a960">SIG_PRI_CALL_LEVEL_ALERTING</a> &amp;&amp; !p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a></div><div class="line"><a name="l08405"></a><span class="lineno"> 8405</span>&#160;         &amp;&amp; !p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a>) {</div><div class="line"><a name="l08406"></a><span class="lineno"> 8406</span>&#160;         p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> = 1;<span class="comment">/* No need to send plain PROGRESS again. */</span></div><div class="line"><a name="l08407"></a><span class="lineno"> 8407</span>&#160;         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a> &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>) {</div><div class="line"><a name="l08408"></a><span class="lineno"> 8408</span>&#160;            pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08409"></a><span class="lineno"> 8409</span>&#160;<span class="preprocessor">#ifdef HAVE_PRI_PROG_W_CAUSE</span></div><div class="line"><a name="l08410"></a><span class="lineno"> 8410</span>&#160;            pri_progress_with_cause(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>,p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, PVT_TO_CHANNEL(p), 1, -1);  <span class="comment">/* no cause at all */</span></div><div class="line"><a name="l08411"></a><span class="lineno"> 8411</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l08412"></a><span class="lineno"> 8412</span>&#160;            pri_progress(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>,p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, PVT_TO_CHANNEL(p), 1);</div><div class="line"><a name="l08413"></a><span class="lineno"> 8413</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l08414"></a><span class="lineno"> 8414</span>&#160;            pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08415"></a><span class="lineno"> 8415</span>&#160;         }</div><div class="line"><a name="l08416"></a><span class="lineno"> 8416</span>&#160;      }</div><div class="line"><a name="l08417"></a><span class="lineno"> 8417</span>&#160;      <span class="comment">/* don&#39;t continue in ast_indicate */</span></div><div class="line"><a name="l08418"></a><span class="lineno"> 8418</span>&#160;      res = 0;</div><div class="line"><a name="l08419"></a><span class="lineno"> 8419</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08420"></a><span class="lineno"> 8420</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390af3bdb353330f1908e9558180b5bb9e16">AST_CONTROL_INCOMPLETE</a>:</div><div class="line"><a name="l08421"></a><span class="lineno"> 8421</span>&#160;      <span class="comment">/* If we are connected or if we support overlap dialing, wait for additional digits */</span></div><div class="line"><a name="l08422"></a><span class="lineno"> 8422</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> == <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822">SIG_PRI_CALL_LEVEL_CONNECT</a> || (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">overlapdial</a> &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>)) {</div><div class="line"><a name="l08423"></a><span class="lineno"> 8423</span>&#160;         res = 0;</div><div class="line"><a name="l08424"></a><span class="lineno"> 8424</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08425"></a><span class="lineno"> 8425</span>&#160;      }</div><div class="line"><a name="l08426"></a><span class="lineno"> 8426</span>&#160;      <span class="comment">/* Otherwise, treat as congestion */</span></div><div class="line"><a name="l08427"></a><span class="lineno"> 8427</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(chan, <a class="code" href="../../d4/da3/causes_8h.html#a29549b982646ee60f116fc4f55c711e5">AST_CAUSE_INVALID_NUMBER_FORMAT</a>);</div><div class="line"><a name="l08428"></a><span class="lineno"> 8428</span>&#160;      <span class="comment">/* Falls through */</span></div><div class="line"><a name="l08429"></a><span class="lineno"> 8429</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:</div><div class="line"><a name="l08430"></a><span class="lineno"> 8430</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ab7d3c3f03d40ad5cea4721e94cb64e40">priindication_oob</a> || p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a>) {</div><div class="line"><a name="l08431"></a><span class="lineno"> 8431</span>&#160;         <span class="comment">/* There are many cause codes that generate an AST_CONTROL_CONGESTION. */</span></div><div class="line"><a name="l08432"></a><span class="lineno"> 8432</span>&#160;         <span class="keywordflow">switch</span> (<a class="code" href="../../d5/d7b/channel_8h.html#aa04afa262d7e1b211ee32d17c949a275">ast_channel_hangupcause</a>(chan)) {</div><div class="line"><a name="l08433"></a><span class="lineno"> 8433</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#aff0e956cb3ef657557fa468a17416c0b">AST_CAUSE_USER_BUSY</a>:</div><div class="line"><a name="l08434"></a><span class="lineno"> 8434</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#af2235eb1c27925e4020ce286255d165f">AST_CAUSE_NORMAL_CLEARING</a>:</div><div class="line"><a name="l08435"></a><span class="lineno"> 8435</span>&#160;         <span class="keywordflow">case</span> 0:<span class="comment">/* Cause has not been set. */</span></div><div class="line"><a name="l08436"></a><span class="lineno"> 8436</span>&#160;            <span class="comment">/* Supply a more appropriate cause. */</span></div><div class="line"><a name="l08437"></a><span class="lineno"> 8437</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(chan, <a class="code" href="../../d4/da3/causes_8h.html#a02b3785262e0be6843e8e9d235d8d78d">AST_CAUSE_SWITCH_CONGESTION</a>);</div><div class="line"><a name="l08438"></a><span class="lineno"> 8438</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08439"></a><span class="lineno"> 8439</span>&#160;         <span class="keywordflow">default</span>:</div><div class="line"><a name="l08440"></a><span class="lineno"> 8440</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08441"></a><span class="lineno"> 8441</span>&#160;         }</div><div class="line"><a name="l08442"></a><span class="lineno"> 8442</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ab683c21c4a34450c4bfb8b672a7b4045">ast_channel_softhangup_internal_flag_add</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);</div><div class="line"><a name="l08443"></a><span class="lineno"> 8443</span>&#160;         res = 0;</div><div class="line"><a name="l08444"></a><span class="lineno"> 8444</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08445"></a><span class="lineno"> 8445</span>&#160;      }</div><div class="line"><a name="l08446"></a><span class="lineno"> 8446</span>&#160;      res = sig_pri_play_tone(p, <a class="code" href="../../d7/d6c/sig__pri_8h.html#ae264fa3d1f9d29c2c76c99bfa13ce95caec52e17e178b0d502ca928de88f4f811">SIG_PRI_TONE_CONGESTION</a>);</div><div class="line"><a name="l08447"></a><span class="lineno"> 8447</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aadfde2210c446742a8276382cb57a960">SIG_PRI_CALL_LEVEL_ALERTING</a> &amp;&amp; !p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a>) {</div><div class="line"><a name="l08448"></a><span class="lineno"> 8448</span>&#160;         <span class="comment">/* There are many cause codes that generate an AST_CONTROL_CONGESTION. */</span></div><div class="line"><a name="l08449"></a><span class="lineno"> 8449</span>&#160;         <span class="keywordflow">switch</span> (<a class="code" href="../../d5/d7b/channel_8h.html#aa04afa262d7e1b211ee32d17c949a275">ast_channel_hangupcause</a>(chan)) {</div><div class="line"><a name="l08450"></a><span class="lineno"> 8450</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#aff0e956cb3ef657557fa468a17416c0b">AST_CAUSE_USER_BUSY</a>:</div><div class="line"><a name="l08451"></a><span class="lineno"> 8451</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#af2235eb1c27925e4020ce286255d165f">AST_CAUSE_NORMAL_CLEARING</a>:</div><div class="line"><a name="l08452"></a><span class="lineno"> 8452</span>&#160;         <span class="keywordflow">case</span> 0:<span class="comment">/* Cause has not been set. */</span></div><div class="line"><a name="l08453"></a><span class="lineno"> 8453</span>&#160;            <span class="comment">/* Supply a more appropriate cause. */</span></div><div class="line"><a name="l08454"></a><span class="lineno"> 8454</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(chan, <a class="code" href="../../d4/da3/causes_8h.html#a02b3785262e0be6843e8e9d235d8d78d">AST_CAUSE_SWITCH_CONGESTION</a>);</div><div class="line"><a name="l08455"></a><span class="lineno"> 8455</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08456"></a><span class="lineno"> 8456</span>&#160;         <span class="keywordflow">default</span>:</div><div class="line"><a name="l08457"></a><span class="lineno"> 8457</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08458"></a><span class="lineno"> 8458</span>&#160;         }</div><div class="line"><a name="l08459"></a><span class="lineno"> 8459</span>&#160;         p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">progress</a> = 1;<span class="comment">/* No need to send plain PROGRESS after this. */</span></div><div class="line"><a name="l08460"></a><span class="lineno"> 8460</span>&#160;         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a> &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>) {</div><div class="line"><a name="l08461"></a><span class="lineno"> 8461</span>&#160;            pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08462"></a><span class="lineno"> 8462</span>&#160;<span class="preprocessor">#ifdef HAVE_PRI_PROG_W_CAUSE</span></div><div class="line"><a name="l08463"></a><span class="lineno"> 8463</span>&#160;            pri_progress_with_cause(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, PVT_TO_CHANNEL(p), 1, <a class="code" href="../../d5/d7b/channel_8h.html#aa04afa262d7e1b211ee32d17c949a275">ast_channel_hangupcause</a>(chan));</div><div class="line"><a name="l08464"></a><span class="lineno"> 8464</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l08465"></a><span class="lineno"> 8465</span>&#160;            pri_progress(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>,p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, PVT_TO_CHANNEL(p), 1);</div><div class="line"><a name="l08466"></a><span class="lineno"> 8466</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l08467"></a><span class="lineno"> 8467</span>&#160;            pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08468"></a><span class="lineno"> 8468</span>&#160;         }</div><div class="line"><a name="l08469"></a><span class="lineno"> 8469</span>&#160;      }</div><div class="line"><a name="l08470"></a><span class="lineno"> 8470</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08471"></a><span class="lineno"> 8471</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:</div><div class="line"><a name="l08472"></a><span class="lineno"> 8472</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(data, <span class="stringliteral">&quot;&quot;</span>), <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">moh_suggested</a>));</div><div class="line"><a name="l08473"></a><span class="lineno"> 8473</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>) {</div><div class="line"><a name="l08474"></a><span class="lineno"> 8474</span>&#160;         pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08475"></a><span class="lineno"> 8475</span>&#160;         sig_pri_moh_fsm_event(chan, p, <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba656e095f1a501561bcd791e27dc4cb1b">SIG_PRI_MOH_EVENT_HOLD</a>);</div><div class="line"><a name="l08476"></a><span class="lineno"> 8476</span>&#160;         pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08477"></a><span class="lineno"> 8477</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08478"></a><span class="lineno"> 8478</span>&#160;         <span class="comment">/* Something is wrong here.  A PRI channel without the pri pointer? */</span></div><div class="line"><a name="l08479"></a><span class="lineno"> 8479</span>&#160;         <a class="code" href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a>(chan, data, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);</div><div class="line"><a name="l08480"></a><span class="lineno"> 8480</span>&#160;      }</div><div class="line"><a name="l08481"></a><span class="lineno"> 8481</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08482"></a><span class="lineno"> 8482</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:</div><div class="line"><a name="l08483"></a><span class="lineno"> 8483</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>) {</div><div class="line"><a name="l08484"></a><span class="lineno"> 8484</span>&#160;         pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08485"></a><span class="lineno"> 8485</span>&#160;         sig_pri_moh_fsm_event(chan, p, <a class="code" href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1baa19137c862a2cea0ffde7a9424297d92">SIG_PRI_MOH_EVENT_UNHOLD</a>);</div><div class="line"><a name="l08486"></a><span class="lineno"> 8486</span>&#160;         pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08487"></a><span class="lineno"> 8487</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08488"></a><span class="lineno"> 8488</span>&#160;         <span class="comment">/* Something is wrong here.  A PRI channel without the pri pointer? */</span></div><div class="line"><a name="l08489"></a><span class="lineno"> 8489</span>&#160;         <a class="code" href="../../dc/d07/musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149">ast_moh_stop</a>(chan);</div><div class="line"><a name="l08490"></a><span class="lineno"> 8490</span>&#160;      }</div><div class="line"><a name="l08491"></a><span class="lineno"> 8491</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08492"></a><span class="lineno"> 8492</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>:</div><div class="line"><a name="l08493"></a><span class="lineno"> 8493</span>&#160;      res = 0;</div><div class="line"><a name="l08494"></a><span class="lineno"> 8494</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08495"></a><span class="lineno"> 8495</span>&#160;   <span class="keywordflow">case</span> -1:</div><div class="line"><a name="l08496"></a><span class="lineno"> 8496</span>&#160;      res = sig_pri_play_tone(p, -1);</div><div class="line"><a name="l08497"></a><span class="lineno"> 8497</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08498"></a><span class="lineno"> 8498</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390ac976c01c12ae70e36b99b16dbfa3dda7">AST_CONTROL_CONNECTED_LINE</a>:</div><div class="line"><a name="l08499"></a><span class="lineno"> 8499</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Received AST_CONTROL_CONNECTED_LINE on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l08500"></a><span class="lineno"> 8500</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>) {</div><div class="line"><a name="l08501"></a><span class="lineno"> 8501</span>&#160;         <span class="keyword">struct </span>pri_party_connected_line connected;</div><div class="line"><a name="l08502"></a><span class="lineno"> 8502</span>&#160;         <span class="keywordtype">int</span> dialplan;</div><div class="line"><a name="l08503"></a><span class="lineno"> 8503</span>&#160;         <span class="keywordtype">int</span> prefix_strip;</div><div class="line"><a name="l08504"></a><span class="lineno"> 8504</span>&#160;         <span class="keywordtype">int</span> colp_allowed = 0;</div><div class="line"><a name="l08505"></a><span class="lineno"> 8505</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d1/dcb/structast__party__id.html">ast_party_id</a> connected_id = <a class="code" href="../../d5/d7b/channel_8h.html#abd6165fa9617e1bb5efee3befa3e963d">ast_channel_connected_effective_id</a>(chan);</div><div class="line"><a name="l08506"></a><span class="lineno"> 8506</span>&#160;</div><div class="line"><a name="l08507"></a><span class="lineno"> 8507</span>&#160;         pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08508"></a><span class="lineno"> 8508</span>&#160;</div><div class="line"><a name="l08509"></a><span class="lineno"> 8509</span>&#160;         <span class="comment">/* Check if a connected line update is allowed at this time. */</span></div><div class="line"><a name="l08510"></a><span class="lineno"> 8510</span>&#160;         <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ab29381dc8b7d60e0cb9cf74bf8c51ed8">colp_send</a>) {</div><div class="line"><a name="l08511"></a><span class="lineno"> 8511</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a08eff0a108d52d3ab42e222ab8707f36aedcd61adf92f45a8e0173d6335aebb48">SIG_PRI_COLP_BLOCK</a>:</div><div class="line"><a name="l08512"></a><span class="lineno"> 8512</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08513"></a><span class="lineno"> 8513</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a08eff0a108d52d3ab42e222ab8707f36aa26897325f83250eee7b19061f9b6fd1">SIG_PRI_COLP_CONNECT</a>:</div><div class="line"><a name="l08514"></a><span class="lineno"> 8514</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l08515"></a><span class="lineno"> 8515</span>&#160;<span class="comment">             * Outgoing calls receive CONNECT and act like an update before</span></div><div class="line"><a name="l08516"></a><span class="lineno"> 8516</span>&#160;<span class="comment">             * the call is connected.</span></div><div class="line"><a name="l08517"></a><span class="lineno"> 8517</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l08518"></a><span class="lineno"> 8518</span>&#160;            <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt;= <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aadfde2210c446742a8276382cb57a960">SIG_PRI_CALL_LEVEL_ALERTING</a> &amp;&amp; !p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">outgoing</a>) {</div><div class="line"><a name="l08519"></a><span class="lineno"> 8519</span>&#160;               colp_allowed = 1;</div><div class="line"><a name="l08520"></a><span class="lineno"> 8520</span>&#160;            }</div><div class="line"><a name="l08521"></a><span class="lineno"> 8521</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08522"></a><span class="lineno"> 8522</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a08eff0a108d52d3ab42e222ab8707f36a3cad5609441f008cb3d157b2d3e51ecf">SIG_PRI_COLP_UPDATE</a>:</div><div class="line"><a name="l08523"></a><span class="lineno"> 8523</span>&#160;            colp_allowed = 1;</div><div class="line"><a name="l08524"></a><span class="lineno"> 8524</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08525"></a><span class="lineno"> 8525</span>&#160;         }</div><div class="line"><a name="l08526"></a><span class="lineno"> 8526</span>&#160;         <span class="keywordflow">if</span> (!colp_allowed) {</div><div class="line"><a name="l08527"></a><span class="lineno"> 8527</span>&#160;            pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08528"></a><span class="lineno"> 8528</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Blocked AST_CONTROL_CONNECTED_LINE on %s\n&quot;</span>,</div><div class="line"><a name="l08529"></a><span class="lineno"> 8529</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l08530"></a><span class="lineno"> 8530</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08531"></a><span class="lineno"> 8531</span>&#160;         }</div><div class="line"><a name="l08532"></a><span class="lineno"> 8532</span>&#160;</div><div class="line"><a name="l08533"></a><span class="lineno"> 8533</span>&#160;         memset(&amp;connected, 0, <span class="keyword">sizeof</span>(connected));</div><div class="line"><a name="l08534"></a><span class="lineno"> 8534</span>&#160;         sig_pri_party_id_from_ast(&amp;connected.id, &amp;connected_id);</div><div class="line"><a name="l08535"></a><span class="lineno"> 8535</span>&#160;</div><div class="line"><a name="l08536"></a><span class="lineno"> 8536</span>&#160;         <span class="comment">/* Determine the connected line numbering plan to actually use. */</span></div><div class="line"><a name="l08537"></a><span class="lineno"> 8537</span>&#160;         <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a146a5e74b46d8d30984c92fcbea2b596">cpndialplan</a>) {</div><div class="line"><a name="l08538"></a><span class="lineno"> 8538</span>&#160;         <span class="keywordflow">case</span> -2:<span class="comment">/* redundant */</span></div><div class="line"><a name="l08539"></a><span class="lineno"> 8539</span>&#160;         <span class="keywordflow">case</span> -1:<span class="comment">/* dynamic */</span></div><div class="line"><a name="l08540"></a><span class="lineno"> 8540</span>&#160;            <span class="comment">/* compute dynamically */</span></div><div class="line"><a name="l08541"></a><span class="lineno"> 8541</span>&#160;            prefix_strip = 0;</div><div class="line"><a name="l08542"></a><span class="lineno"> 8542</span>&#160;            <span class="keywordflow">if</span> (!strncmp(connected.id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae384fc9ad39051984beca025ded44f41">internationalprefix</a>,</div><div class="line"><a name="l08543"></a><span class="lineno"> 8543</span>&#160;               strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae384fc9ad39051984beca025ded44f41">internationalprefix</a>))) {</div><div class="line"><a name="l08544"></a><span class="lineno"> 8544</span>&#160;               prefix_strip = strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae384fc9ad39051984beca025ded44f41">internationalprefix</a>);</div><div class="line"><a name="l08545"></a><span class="lineno"> 8545</span>&#160;               dialplan = PRI_INTERNATIONAL_ISDN;</div><div class="line"><a name="l08546"></a><span class="lineno"> 8546</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(connected.id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a74f03b8f0dd671a3f916bdd8fe6cfb75">nationalprefix</a>,</div><div class="line"><a name="l08547"></a><span class="lineno"> 8547</span>&#160;               strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a74f03b8f0dd671a3f916bdd8fe6cfb75">nationalprefix</a>))) {</div><div class="line"><a name="l08548"></a><span class="lineno"> 8548</span>&#160;               prefix_strip = strlen(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a74f03b8f0dd671a3f916bdd8fe6cfb75">nationalprefix</a>);</div><div class="line"><a name="l08549"></a><span class="lineno"> 8549</span>&#160;               dialplan = PRI_NATIONAL_ISDN;</div><div class="line"><a name="l08550"></a><span class="lineno"> 8550</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08551"></a><span class="lineno"> 8551</span>&#160;               dialplan = PRI_LOCAL_ISDN;</div><div class="line"><a name="l08552"></a><span class="lineno"> 8552</span>&#160;            }</div><div class="line"><a name="l08553"></a><span class="lineno"> 8553</span>&#160;            connected.id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ad1f8db563cb99d404b72e02cf8f78cd1">plan</a> = dialplan;</div><div class="line"><a name="l08554"></a><span class="lineno"> 8554</span>&#160;</div><div class="line"><a name="l08555"></a><span class="lineno"> 8555</span>&#160;            <span class="keywordflow">if</span> (prefix_strip &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a146a5e74b46d8d30984c92fcbea2b596">cpndialplan</a> != -2) {</div><div class="line"><a name="l08556"></a><span class="lineno"> 8556</span>&#160;               <span class="comment">/* Strip the prefix from the connected line number. */</span></div><div class="line"><a name="l08557"></a><span class="lineno"> 8557</span>&#160;               memmove(connected.id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>,</div><div class="line"><a name="l08558"></a><span class="lineno"> 8558</span>&#160;                  connected.id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> + prefix_strip,</div><div class="line"><a name="l08559"></a><span class="lineno"> 8559</span>&#160;                  strlen(connected.id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> + prefix_strip) + 1);</div><div class="line"><a name="l08560"></a><span class="lineno"> 8560</span>&#160;            }</div><div class="line"><a name="l08561"></a><span class="lineno"> 8561</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08562"></a><span class="lineno"> 8562</span>&#160;         <span class="keywordflow">case</span> 0:<span class="comment">/* from_channel */</span></div><div class="line"><a name="l08563"></a><span class="lineno"> 8563</span>&#160;            <span class="comment">/* Use the numbering plan passed in. */</span></div><div class="line"><a name="l08564"></a><span class="lineno"> 8564</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08565"></a><span class="lineno"> 8565</span>&#160;         <span class="keywordflow">default</span>:</div><div class="line"><a name="l08566"></a><span class="lineno"> 8566</span>&#160;            connected.id.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ad1f8db563cb99d404b72e02cf8f78cd1">plan</a> = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a146a5e74b46d8d30984c92fcbea2b596">cpndialplan</a> - 1;</div><div class="line"><a name="l08567"></a><span class="lineno"> 8567</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l08568"></a><span class="lineno"> 8568</span>&#160;         }</div><div class="line"><a name="l08569"></a><span class="lineno"> 8569</span>&#160;</div><div class="line"><a name="l08570"></a><span class="lineno"> 8570</span>&#160;         pri_connected_line_update(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, &amp;connected);</div><div class="line"><a name="l08571"></a><span class="lineno"> 8571</span>&#160;         pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08572"></a><span class="lineno"> 8572</span>&#160;      }</div><div class="line"><a name="l08573"></a><span class="lineno"> 8573</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08574"></a><span class="lineno"> 8574</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a5344deefcbdcca938001314e81ea195a">AST_CONTROL_REDIRECTING</a>:</div><div class="line"><a name="l08575"></a><span class="lineno"> 8575</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Received AST_CONTROL_REDIRECTING on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l08576"></a><span class="lineno"> 8576</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>) {</div><div class="line"><a name="l08577"></a><span class="lineno"> 8577</span>&#160;         pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08578"></a><span class="lineno"> 8578</span>&#160;         sig_pri_redirecting_update(p, chan);</div><div class="line"><a name="l08579"></a><span class="lineno"> 8579</span>&#160;         pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08580"></a><span class="lineno"> 8580</span>&#160;      }</div><div class="line"><a name="l08581"></a><span class="lineno"> 8581</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08582"></a><span class="lineno"> 8582</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390af10845d12981bce4e141a5b0ed431494">AST_CONTROL_AOC</a>:</div><div class="line"><a name="l08583"></a><span class="lineno"> 8583</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l08584"></a><span class="lineno"> 8584</span>&#160;      {</div><div class="line"><a name="l08585"></a><span class="lineno"> 8585</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d9/dca/structast__aoc__decoded.html">ast_aoc_decoded</a> *decoded</div><div class="line"><a name="l08586"></a><span class="lineno"> 8586</span>&#160;            = <a class="code" href="../../d6/db3/aoc_8h.html#a3849b484bd42840860ada0ac3db4f96d">ast_aoc_decode</a>((<span class="keyword">struct</span> <a class="code" href="../../d8/d72/structast__aoc__encoded.html">ast_aoc_encoded</a> *) data, datalen, chan);</div><div class="line"><a name="l08587"></a><span class="lineno"> 8587</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Received AST_CONTROL_AOC on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l08588"></a><span class="lineno"> 8588</span>&#160;         <span class="keywordflow">if</span> (decoded &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>) {</div><div class="line"><a name="l08589"></a><span class="lineno"> 8589</span>&#160;            pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08590"></a><span class="lineno"> 8590</span>&#160;            <span class="keywordflow">switch</span> (<a class="code" href="../../d6/db3/aoc_8h.html#a34cb435b356514ce26df36a7bff4dfeb">ast_aoc_get_msg_type</a>(decoded)) {</div><div class="line"><a name="l08591"></a><span class="lineno"> 8591</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548a3cdee929459fa195eabd19f5c156c7ec">AST_AOC_S</a>:</div><div class="line"><a name="l08592"></a><span class="lineno"> 8592</span>&#160;               <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;aoc_passthrough_flag &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ae1ccf2737a073b7016533eacd4ecaa1f">SIG_PRI_AOC_GRANT_S</a>) {</div><div class="line"><a name="l08593"></a><span class="lineno"> 8593</span>&#160;                  sig_pri_aoc_s_from_ast(p, decoded);</div><div class="line"><a name="l08594"></a><span class="lineno"> 8594</span>&#160;               }</div><div class="line"><a name="l08595"></a><span class="lineno"> 8595</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l08596"></a><span class="lineno"> 8596</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548a463d1c225066e20d4cc56abee5a5b239">AST_AOC_D</a>:</div><div class="line"><a name="l08597"></a><span class="lineno"> 8597</span>&#160;               <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;aoc_passthrough_flag &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a7da4d7e4aa12411980e8ad434eba04b4">SIG_PRI_AOC_GRANT_D</a>) {</div><div class="line"><a name="l08598"></a><span class="lineno"> 8598</span>&#160;                  sig_pri_aoc_d_from_ast(p, decoded);</div><div class="line"><a name="l08599"></a><span class="lineno"> 8599</span>&#160;               }</div><div class="line"><a name="l08600"></a><span class="lineno"> 8600</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l08601"></a><span class="lineno"> 8601</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548a98adf1ef32c4d9b775cc595795ac4693">AST_AOC_E</a>:</div><div class="line"><a name="l08602"></a><span class="lineno"> 8602</span>&#160;               <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;aoc_passthrough_flag &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab85195824a5cbc6eebb66dc1709f3626">SIG_PRI_AOC_GRANT_E</a>) {</div><div class="line"><a name="l08603"></a><span class="lineno"> 8603</span>&#160;                  sig_pri_aoc_e_from_ast(p, decoded);</div><div class="line"><a name="l08604"></a><span class="lineno"> 8604</span>&#160;               }</div><div class="line"><a name="l08605"></a><span class="lineno"> 8605</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l08606"></a><span class="lineno"> 8606</span>&#160;<span class="comment">                * If hangup was delayed for this AOC-E msg, waiting_for_aoc</span></div><div class="line"><a name="l08607"></a><span class="lineno"> 8607</span>&#160;<span class="comment">                * will be set.  A hangup is already occuring via a timeout during</span></div><div class="line"><a name="l08608"></a><span class="lineno"> 8608</span>&#160;<span class="comment">                * this delay.  Instead of waiting for that timeout to occur, go ahead</span></div><div class="line"><a name="l08609"></a><span class="lineno"> 8609</span>&#160;<span class="comment">                * and initiate the hangup since the delay is no longer necessary.</span></div><div class="line"><a name="l08610"></a><span class="lineno"> 8610</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l08611"></a><span class="lineno"> 8611</span>&#160;               <span class="keywordflow">if</span> (p-&gt;waiting_for_aoce) {</div><div class="line"><a name="l08612"></a><span class="lineno"> 8612</span>&#160;                  p-&gt;waiting_for_aoce = 0;</div><div class="line"><a name="l08613"></a><span class="lineno"> 8613</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1,</div><div class="line"><a name="l08614"></a><span class="lineno"> 8614</span>&#160;                     <span class="stringliteral">&quot;Received final AOC-E msg, continue with hangup on %s\n&quot;</span>,</div><div class="line"><a name="l08615"></a><span class="lineno"> 8615</span>&#160;                     <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l08616"></a><span class="lineno"> 8616</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#a30bcf0418189567bc84ff32034f79f28">ast_queue_hangup</a>(chan);</div><div class="line"><a name="l08617"></a><span class="lineno"> 8617</span>&#160;               }</div><div class="line"><a name="l08618"></a><span class="lineno"> 8618</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l08619"></a><span class="lineno"> 8619</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548abe386d5c13914197811b47e6d3fcdfc9">AST_AOC_REQUEST</a>:</div><div class="line"><a name="l08620"></a><span class="lineno"> 8620</span>&#160;               <span class="comment">/* We do not pass through AOC requests, So unless this</span></div><div class="line"><a name="l08621"></a><span class="lineno"> 8621</span>&#160;<span class="comment">                * is an AOC termination request it will be ignored */</span></div><div class="line"><a name="l08622"></a><span class="lineno"> 8622</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="../../d6/db3/aoc_8h.html#a3ec7164b379d453d184d3d3bf3f049d8">ast_aoc_get_termination_request</a>(decoded)) {</div><div class="line"><a name="l08623"></a><span class="lineno"> 8623</span>&#160;                  pri_hangup(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, -1);</div><div class="line"><a name="l08624"></a><span class="lineno"> 8624</span>&#160;               }</div><div class="line"><a name="l08625"></a><span class="lineno"> 8625</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l08626"></a><span class="lineno"> 8626</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l08627"></a><span class="lineno"> 8627</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l08628"></a><span class="lineno"> 8628</span>&#160;            }</div><div class="line"><a name="l08629"></a><span class="lineno"> 8629</span>&#160;            pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08630"></a><span class="lineno"> 8630</span>&#160;         }</div><div class="line"><a name="l08631"></a><span class="lineno"> 8631</span>&#160;         <a class="code" href="../../d6/db3/aoc_8h.html#a33b761090d3debbfd4cdb0c800a13bb2">ast_aoc_destroy_decoded</a>(decoded);</div><div class="line"><a name="l08632"></a><span class="lineno"> 8632</span>&#160;      }</div><div class="line"><a name="l08633"></a><span class="lineno"> 8633</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08634"></a><span class="lineno"> 8634</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08635"></a><span class="lineno"> 8635</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MCID)</span></div><div class="line"><a name="l08636"></a><span class="lineno"> 8636</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a6265e05e606bb17be5cd81a309cf98a2">AST_CONTROL_MCID</a>:</div><div class="line"><a name="l08637"></a><span class="lineno"> 8637</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a> &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a> &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;mcid_send) {</div><div class="line"><a name="l08638"></a><span class="lineno"> 8638</span>&#160;         pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08639"></a><span class="lineno"> 8639</span>&#160;         pri_mcid_req_send(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>);</div><div class="line"><a name="l08640"></a><span class="lineno"> 8640</span>&#160;         pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08641"></a><span class="lineno"> 8641</span>&#160;      }</div><div class="line"><a name="l08642"></a><span class="lineno"> 8642</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08643"></a><span class="lineno"> 8643</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MCID) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08644"></a><span class="lineno"> 8644</span>&#160;   }</div><div class="line"><a name="l08645"></a><span class="lineno"> 8645</span>&#160;</div><div class="line"><a name="l08646"></a><span class="lineno"> 8646</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l08647"></a><span class="lineno"> 8647</span>&#160;}</div><div class="line"><a name="l08648"></a><span class="lineno"> 8648</span>&#160;</div><div class="line"><a name="l08649"></a><span class="lineno"> 8649</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#adff38e4d09b72c5e03a6532a6d84f133">sig_pri_answer</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *ast)</div><div class="line"><a name="l08650"></a><span class="lineno"> 8650</span>&#160;{</div><div class="line"><a name="l08651"></a><span class="lineno"> 8651</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l08652"></a><span class="lineno"> 8652</span>&#160;</div><div class="line"><a name="l08653"></a><span class="lineno"> 8653</span>&#160;   <span class="comment">/* Send a pri acknowledge */</span></div><div class="line"><a name="l08654"></a><span class="lineno"> 8654</span>&#160;   pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08655"></a><span class="lineno"> 8655</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l08656"></a><span class="lineno"> 8656</span>&#160;   <span class="keywordflow">if</span> (p-&gt;aoc_s_request_invoke_id_valid) {</div><div class="line"><a name="l08657"></a><span class="lineno"> 8657</span>&#160;      <span class="comment">/* if AOC-S was requested and the invoke id is still present on answer.  That means</span></div><div class="line"><a name="l08658"></a><span class="lineno"> 8658</span>&#160;<span class="comment">       * no AOC-S rate list was provided, so send a NULL response which will indicate that</span></div><div class="line"><a name="l08659"></a><span class="lineno"> 8659</span>&#160;<span class="comment">       * AOC-S is not available */</span></div><div class="line"><a name="l08660"></a><span class="lineno"> 8660</span>&#160;      pri_aoc_s_request_response_send(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>,</div><div class="line"><a name="l08661"></a><span class="lineno"> 8661</span>&#160;         p-&gt;aoc_s_request_invoke_id, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l08662"></a><span class="lineno"> 8662</span>&#160;      p-&gt;aoc_s_request_invoke_id_valid = 0;</div><div class="line"><a name="l08663"></a><span class="lineno"> 8663</span>&#160;   }</div><div class="line"><a name="l08664"></a><span class="lineno"> 8664</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08665"></a><span class="lineno"> 8665</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822">SIG_PRI_CALL_LEVEL_CONNECT</a>) {</div><div class="line"><a name="l08666"></a><span class="lineno"> 8666</span>&#160;      p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822">SIG_PRI_CALL_LEVEL_CONNECT</a>;</div><div class="line"><a name="l08667"></a><span class="lineno"> 8667</span>&#160;   }</div><div class="line"><a name="l08668"></a><span class="lineno"> 8668</span>&#160;   sig_pri_set_dialing(p, 0);</div><div class="line"><a name="l08669"></a><span class="lineno"> 8669</span>&#160;   sig_pri_open_media(p);</div><div class="line"><a name="l08670"></a><span class="lineno"> 8670</span>&#160;   res = pri_answer(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, 0, !p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf54768a4327f86de3a234648305c4a4">digital</a>);</div><div class="line"><a name="l08671"></a><span class="lineno"> 8671</span>&#160;   pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08672"></a><span class="lineno"> 8672</span>&#160;   <a class="code" href="../../d9/d95/channelstate_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448">ast_setstate</a>(ast, <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);</div><div class="line"><a name="l08673"></a><span class="lineno"> 8673</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l08674"></a><span class="lineno"> 8674</span>&#160;}</div><div class="line"><a name="l08675"></a><span class="lineno"> 8675</span>&#160;<span class="comment"></span></div><div class="line"><a name="l08676"></a><span class="lineno"> 8676</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l08677"></a><span class="lineno"> 8677</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l08678"></a><span class="lineno"> 8678</span>&#160;<span class="comment"> * \brief Simple check if the channel is available to use.</span></div><div class="line"><a name="l08679"></a><span class="lineno"> 8679</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l08680"></a><span class="lineno"> 8680</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08681"></a><span class="lineno"> 8681</span>&#160;<span class="comment"> * \param pvt Private channel control structure.</span></div><div class="line"><a name="l08682"></a><span class="lineno"> 8682</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08683"></a><span class="lineno"> 8683</span>&#160;<span class="comment"> * \retval 0 Interface not available.</span></div><div class="line"><a name="l08684"></a><span class="lineno"> 8684</span>&#160;<span class="comment"> * \retval 1 Interface is available.</span></div><div class="line"><a name="l08685"></a><span class="lineno"> 8685</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08686"></a><span class="lineno"> 8686</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_available_check(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt)</div><div class="line"><a name="l08687"></a><span class="lineno"> 8687</span>&#160;{</div><div class="line"><a name="l08688"></a><span class="lineno"> 8688</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l08689"></a><span class="lineno"> 8689</span>&#160;<span class="comment">    * If interface has a B channel and is available for use</span></div><div class="line"><a name="l08690"></a><span class="lineno"> 8690</span>&#160;<span class="comment">    * then the channel is available.</span></div><div class="line"><a name="l08691"></a><span class="lineno"> 8691</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l08692"></a><span class="lineno"> 8692</span>&#160;   <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a> &amp;&amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a03805c1c05301a1e86967ad671dec748">sig_pri_is_chan_available</a>(pvt)) {</div><div class="line"><a name="l08693"></a><span class="lineno"> 8693</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l08694"></a><span class="lineno"> 8694</span>&#160;   }</div><div class="line"><a name="l08695"></a><span class="lineno"> 8695</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08696"></a><span class="lineno"> 8696</span>&#160;}</div><div class="line"><a name="l08697"></a><span class="lineno"> 8697</span>&#160;</div><div class="line"><a name="l08698"></a><span class="lineno"> 8698</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l08699"></a><span class="lineno"> 8699</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l08700"></a><span class="lineno"> 8700</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l08701"></a><span class="lineno"> 8701</span>&#160;<span class="comment"> * \brief Get an available call waiting interface.</span></div><div class="line"><a name="l08702"></a><span class="lineno"> 8702</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l08703"></a><span class="lineno"> 8703</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08704"></a><span class="lineno"> 8704</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l08705"></a><span class="lineno"> 8705</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08706"></a><span class="lineno"> 8706</span>&#160;<span class="comment"> * \note Assumes the pri-&gt;lock is already obtained.</span></div><div class="line"><a name="l08707"></a><span class="lineno"> 8707</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08708"></a><span class="lineno"> 8708</span>&#160;<span class="comment"> * \retval cw Call waiting interface to use.</span></div><div class="line"><a name="l08709"></a><span class="lineno"> 8709</span>&#160;<span class="comment"> * \retval NULL if no call waiting interface available.</span></div><div class="line"><a name="l08710"></a><span class="lineno"> 8710</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08711"></a><span class="lineno"> 8711</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *sig_pri_cw_available(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l08712"></a><span class="lineno"> 8712</span>&#160;{</div><div class="line"><a name="l08713"></a><span class="lineno"> 8713</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *cw;</div><div class="line"><a name="l08714"></a><span class="lineno"> 8714</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l08715"></a><span class="lineno"> 8715</span>&#160;</div><div class="line"><a name="l08716"></a><span class="lineno"> 8716</span>&#160;   cw = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08717"></a><span class="lineno"> 8717</span>&#160;   <span class="keywordflow">if</span> (pri-&gt;num_call_waiting_calls &lt; pri-&gt;max_call_waiting_calls) {</div><div class="line"><a name="l08718"></a><span class="lineno"> 8718</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;num_call_waiting_calls) {</div><div class="line"><a name="l08719"></a><span class="lineno"> 8719</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l08720"></a><span class="lineno"> 8720</span>&#160;<span class="comment">          * There are no outstanding call waiting calls.  Check to see</span></div><div class="line"><a name="l08721"></a><span class="lineno"> 8721</span>&#160;<span class="comment">          * if the span is in a congested state for the first call</span></div><div class="line"><a name="l08722"></a><span class="lineno"> 8722</span>&#160;<span class="comment">          * waiting call.</span></div><div class="line"><a name="l08723"></a><span class="lineno"> 8723</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l08724"></a><span class="lineno"> 8724</span>&#160;         <span class="keywordflow">for</span> (idx = 0; idx &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; ++idx) {</div><div class="line"><a name="l08725"></a><span class="lineno"> 8725</span>&#160;            <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[idx] &amp;&amp; sig_pri_available_check(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[idx])) {</div><div class="line"><a name="l08726"></a><span class="lineno"> 8726</span>&#160;               <span class="comment">/* There is another channel that is available on this span. */</span></div><div class="line"><a name="l08727"></a><span class="lineno"> 8727</span>&#160;               <span class="keywordflow">return</span> cw;</div><div class="line"><a name="l08728"></a><span class="lineno"> 8728</span>&#160;            }</div><div class="line"><a name="l08729"></a><span class="lineno"> 8729</span>&#160;         }</div><div class="line"><a name="l08730"></a><span class="lineno"> 8730</span>&#160;      }</div><div class="line"><a name="l08731"></a><span class="lineno"> 8731</span>&#160;      idx = pri_find_empty_nobch(pri);</div><div class="line"><a name="l08732"></a><span class="lineno"> 8732</span>&#160;      <span class="keywordflow">if</span> (0 &lt;= idx) {</div><div class="line"><a name="l08733"></a><span class="lineno"> 8733</span>&#160;         <span class="comment">/* Setup the call waiting interface to use. */</span></div><div class="line"><a name="l08734"></a><span class="lineno"> 8734</span>&#160;         cw = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[idx];</div><div class="line"><a name="l08735"></a><span class="lineno"> 8735</span>&#160;         cw-&gt;is_call_waiting = 1;</div><div class="line"><a name="l08736"></a><span class="lineno"> 8736</span>&#160;         sig_pri_init_config(cw, pri);</div><div class="line"><a name="l08737"></a><span class="lineno"> 8737</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;pri-&gt;num_call_waiting_calls, 1);</div><div class="line"><a name="l08738"></a><span class="lineno"> 8738</span>&#160;      }</div><div class="line"><a name="l08739"></a><span class="lineno"> 8739</span>&#160;   }</div><div class="line"><a name="l08740"></a><span class="lineno"> 8740</span>&#160;   <span class="keywordflow">return</span> cw;</div><div class="line"><a name="l08741"></a><span class="lineno"> 8741</span>&#160;}</div><div class="line"><a name="l08742"></a><span class="lineno"> 8742</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08743"></a><span class="lineno"> 8743</span>&#160;</div><div class="line"><a name="l08744"></a><span class="lineno"> 8744</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a45c267e1a632ddf4a622ee8e975b048f">sig_pri_available</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> **pvt, <span class="keywordtype">int</span> is_specific_channel)</div><div class="line"><a name="l08745"></a><span class="lineno"> 8745</span>&#160;{</div><div class="line"><a name="l08746"></a><span class="lineno"> 8746</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p = *pvt;</div><div class="line"><a name="l08747"></a><span class="lineno"> 8747</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>;</div><div class="line"><a name="l08748"></a><span class="lineno"> 8748</span>&#160;</div><div class="line"><a name="l08749"></a><span class="lineno"> 8749</span>&#160;   <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>) {</div><div class="line"><a name="l08750"></a><span class="lineno"> 8750</span>&#160;      <span class="comment">/* Something is wrong here.  A PRI channel without the pri pointer? */</span></div><div class="line"><a name="l08751"></a><span class="lineno"> 8751</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08752"></a><span class="lineno"> 8752</span>&#160;   }</div><div class="line"><a name="l08753"></a><span class="lineno"> 8753</span>&#160;   pri = p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>;</div><div class="line"><a name="l08754"></a><span class="lineno"> 8754</span>&#160;</div><div class="line"><a name="l08755"></a><span class="lineno"> 8755</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l08756"></a><span class="lineno"> 8756</span>&#160;   <span class="keywordflow">if</span> (</div><div class="line"><a name="l08757"></a><span class="lineno"> 8757</span>&#160;#<span class="keywordflow">if</span> defined(HAVE_PRI_CALL_WAITING)</div><div class="line"><a name="l08758"></a><span class="lineno"> 8758</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l08759"></a><span class="lineno"> 8759</span>&#160;<span class="comment">       * Only do call waiting calls if we have any</span></div><div class="line"><a name="l08760"></a><span class="lineno"> 8760</span>&#160;<span class="comment">       * call waiting call outstanding.  We do not</span></div><div class="line"><a name="l08761"></a><span class="lineno"> 8761</span>&#160;<span class="comment">       * want new calls to steal a B channel</span></div><div class="line"><a name="l08762"></a><span class="lineno"> 8762</span>&#160;<span class="comment">       * freed for an earlier call waiting call.</span></div><div class="line"><a name="l08763"></a><span class="lineno"> 8763</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l08764"></a><span class="lineno"> 8764</span>&#160;      !pri-&gt;num_call_waiting_calls &amp;&amp;</div><div class="line"><a name="l08765"></a><span class="lineno"> 8765</span>&#160;#endif   <span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span></div><div class="line"><a name="l08766"></a><span class="lineno"> 8766</span>&#160;      sig_pri_available_check(p)) {</div><div class="line"><a name="l08767"></a><span class="lineno"> 8767</span>&#160;      p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a44ac4c6a3693f3d2fa34a50428e42237">allocated</a> = 1;</div><div class="line"><a name="l08768"></a><span class="lineno"> 8768</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l08769"></a><span class="lineno"> 8769</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l08770"></a><span class="lineno"> 8770</span>&#160;   }</div><div class="line"><a name="l08771"></a><span class="lineno"> 8771</span>&#160;</div><div class="line"><a name="l08772"></a><span class="lineno"> 8772</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l08773"></a><span class="lineno"> 8773</span>&#160;   <span class="keywordflow">if</span> (!is_specific_channel) {</div><div class="line"><a name="l08774"></a><span class="lineno"> 8774</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *cw;</div><div class="line"><a name="l08775"></a><span class="lineno"> 8775</span>&#160;</div><div class="line"><a name="l08776"></a><span class="lineno"> 8776</span>&#160;      cw = sig_pri_cw_available(pri);</div><div class="line"><a name="l08777"></a><span class="lineno"> 8777</span>&#160;      <span class="keywordflow">if</span> (cw) {</div><div class="line"><a name="l08778"></a><span class="lineno"> 8778</span>&#160;         <span class="comment">/* We have a call waiting interface to use instead. */</span></div><div class="line"><a name="l08779"></a><span class="lineno"> 8779</span>&#160;         cw-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a44ac4c6a3693f3d2fa34a50428e42237">allocated</a> = 1;</div><div class="line"><a name="l08780"></a><span class="lineno"> 8780</span>&#160;         *pvt = cw;</div><div class="line"><a name="l08781"></a><span class="lineno"> 8781</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l08782"></a><span class="lineno"> 8782</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l08783"></a><span class="lineno"> 8783</span>&#160;      }</div><div class="line"><a name="l08784"></a><span class="lineno"> 8784</span>&#160;   }</div><div class="line"><a name="l08785"></a><span class="lineno"> 8785</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08786"></a><span class="lineno"> 8786</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l08787"></a><span class="lineno"> 8787</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08788"></a><span class="lineno"> 8788</span>&#160;}</div><div class="line"><a name="l08789"></a><span class="lineno"> 8789</span>&#160;</div><div class="line"><a name="l08790"></a><span class="lineno"> 8790</span>&#160;<span class="comment">/* If return 0, it means this function was able to handle it (pre setup digits).  If non zero, the user of this</span></div><div class="line"><a name="l08791"></a><span class="lineno"> 8791</span>&#160;<span class="comment"> * functions should handle it normally (generate inband DTMF) */</span></div><div class="line"><a name="l08792"></a><span class="lineno"> 8792</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#af8cc34b0aa438a6a8d66d2807a6291af">sig_pri_digit_begin</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *ast, <span class="keywordtype">char</span> <a class="code" href="../../dc/d5c/app__alarmreceiver_8c.html#ac2c887b7f7b359bfdda8a128980f5081">digit</a>)</div><div class="line"><a name="l08793"></a><span class="lineno"> 8793</span>&#160;{</div><div class="line"><a name="l08794"></a><span class="lineno"> 8794</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(ast) == <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>) {</div><div class="line"><a name="l08795"></a><span class="lineno"> 8795</span>&#160;      <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a56a6bdb3a08f47f53f414ba014b47980">SIG_PRI_CALL_LEVEL_OVERLAP</a>) {</div><div class="line"><a name="l08796"></a><span class="lineno"> 8796</span>&#160;         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l08797"></a><span class="lineno"> 8797</span>&#160;</div><div class="line"><a name="l08798"></a><span class="lineno"> 8798</span>&#160;         len = strlen(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a0368d49962f1bf26c2603ade03cd8ee9">dialdest</a>);</div><div class="line"><a name="l08799"></a><span class="lineno"> 8799</span>&#160;         <span class="keywordflow">if</span> (len &lt; <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a0368d49962f1bf26c2603ade03cd8ee9">dialdest</a>) - 1) {</div><div class="line"><a name="l08800"></a><span class="lineno"> 8800</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Queueing digit &#39;%c&#39; since setup_ack not yet received\n&quot;</span>,</div><div class="line"><a name="l08801"></a><span class="lineno"> 8801</span>&#160;               digit);</div><div class="line"><a name="l08802"></a><span class="lineno"> 8802</span>&#160;            pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a0368d49962f1bf26c2603ade03cd8ee9">dialdest</a>[len++] = <a class="code" href="../../dc/d5c/app__alarmreceiver_8c.html#ac2c887b7f7b359bfdda8a128980f5081">digit</a>;</div><div class="line"><a name="l08803"></a><span class="lineno"> 8803</span>&#160;            pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a0368d49962f1bf26c2603ade03cd8ee9">dialdest</a>[<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l08804"></a><span class="lineno"> 8804</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08805"></a><span class="lineno"> 8805</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l08806"></a><span class="lineno"> 8806</span>&#160;               <span class="stringliteral">&quot;Span %d: Deferred digit buffer overflow for digit &#39;%c&#39;.\n&quot;</span>,</div><div class="line"><a name="l08807"></a><span class="lineno"> 8807</span>&#160;               pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, digit);</div><div class="line"><a name="l08808"></a><span class="lineno"> 8808</span>&#160;         }</div><div class="line"><a name="l08809"></a><span class="lineno"> 8809</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08810"></a><span class="lineno"> 8810</span>&#160;      }</div><div class="line"><a name="l08811"></a><span class="lineno"> 8811</span>&#160;      <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a60273beaf5da6262358cc2add8aa2765">SIG_PRI_CALL_LEVEL_PROCEEDING</a>) {</div><div class="line"><a name="l08812"></a><span class="lineno"> 8812</span>&#160;         pri_grab(pvt, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08813"></a><span class="lineno"> 8813</span>&#160;         pri_information(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, digit);</div><div class="line"><a name="l08814"></a><span class="lineno"> 8814</span>&#160;         pri_rel(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l08815"></a><span class="lineno"> 8815</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08816"></a><span class="lineno"> 8816</span>&#160;      }</div><div class="line"><a name="l08817"></a><span class="lineno"> 8817</span>&#160;      <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822">SIG_PRI_CALL_LEVEL_CONNECT</a>) {</div><div class="line"><a name="l08818"></a><span class="lineno"> 8818</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l08819"></a><span class="lineno"> 8819</span>&#160;            <span class="stringliteral">&quot;Span %d: Digit &#39;%c&#39; may be ignored by peer. (Call level:%u(%s))\n&quot;</span>,</div><div class="line"><a name="l08820"></a><span class="lineno"> 8820</span>&#160;            pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, digit, pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a>,</div><div class="line"><a name="l08821"></a><span class="lineno"> 8821</span>&#160;            sig_pri_call_level2str(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a>));</div><div class="line"><a name="l08822"></a><span class="lineno"> 8822</span>&#160;      }</div><div class="line"><a name="l08823"></a><span class="lineno"> 8823</span>&#160;   }</div><div class="line"><a name="l08824"></a><span class="lineno"> 8824</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l08825"></a><span class="lineno"> 8825</span>&#160;}</div><div class="line"><a name="l08826"></a><span class="lineno"> 8826</span>&#160;<span class="comment"></span></div><div class="line"><a name="l08827"></a><span class="lineno"> 8827</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l08828"></a><span class="lineno"> 8828</span>&#160;<span class="comment"> * \brief DTMF dial string complete.</span></div><div class="line"><a name="l08829"></a><span class="lineno"> 8829</span>&#160;<span class="comment"> * \since 1.8.11</span></div><div class="line"><a name="l08830"></a><span class="lineno"> 8830</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08831"></a><span class="lineno"> 8831</span>&#160;<span class="comment"> * \param pvt sig_pri private channel structure.</span></div><div class="line"><a name="l08832"></a><span class="lineno"> 8832</span>&#160;<span class="comment"> * \param ast Asterisk channel</span></div><div class="line"><a name="l08833"></a><span class="lineno"> 8833</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08834"></a><span class="lineno"> 8834</span>&#160;<span class="comment"> * \note Channel and private lock are already held.</span></div><div class="line"><a name="l08835"></a><span class="lineno"> 8835</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08836"></a><span class="lineno"> 8836</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l08837"></a><span class="lineno"> 8837</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08838"></a><span class="lineno"> 8838</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#ac195190da30da13bd36e3c39d818dc77">sig_pri_dial_complete</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *ast)</div><div class="line"><a name="l08839"></a><span class="lineno"> 8839</span>&#160;{</div><div class="line"><a name="l08840"></a><span class="lineno"> 8840</span>&#160;   <span class="comment">/* If we just completed &#39;w&#39; deferred dialing digits, we need to answer now. */</span></div><div class="line"><a name="l08841"></a><span class="lineno"> 8841</span>&#160;   <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> == <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a97a62807945f1318b8d4f643c3709c94">SIG_PRI_CALL_LEVEL_DEFER_DIAL</a>) {</div><div class="line"><a name="l08842"></a><span class="lineno"> 8842</span>&#160;      pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a> = <a class="code" href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822">SIG_PRI_CALL_LEVEL_CONNECT</a>;</div><div class="line"><a name="l08843"></a><span class="lineno"> 8843</span>&#160;</div><div class="line"><a name="l08844"></a><span class="lineno"> 8844</span>&#160;      sig_pri_open_media(pvt);</div><div class="line"><a name="l08845"></a><span class="lineno"> 8845</span>&#160;      {</div><div class="line"><a name="l08846"></a><span class="lineno"> 8846</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> f = {<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>, };</div><div class="line"><a name="l08847"></a><span class="lineno"> 8847</span>&#160;</div><div class="line"><a name="l08848"></a><span class="lineno"> 8848</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a37d6733b3c615f45c446c2671f3d7b6e">queue_control</a>) {</div><div class="line"><a name="l08849"></a><span class="lineno"> 8849</span>&#160;            <a class="code" href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a>.<a class="code" href="../../d3/da2/structsig__pri__callback.html#a37d6733b3c615f45c446c2671f3d7b6e">queue_control</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a>, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>);</div><div class="line"><a name="l08850"></a><span class="lineno"> 8850</span>&#160;         }</div><div class="line"><a name="l08851"></a><span class="lineno"> 8851</span>&#160;</div><div class="line"><a name="l08852"></a><span class="lineno"> 8852</span>&#160;         f.<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>;</div><div class="line"><a name="l08853"></a><span class="lineno"> 8853</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a6cbcba5661d55216968cde8fdf913c89">ast_queue_frame</a>(ast, &amp;f);</div><div class="line"><a name="l08854"></a><span class="lineno"> 8854</span>&#160;      }</div><div class="line"><a name="l08855"></a><span class="lineno"> 8855</span>&#160;      sig_pri_set_dialing(pvt, 0);</div><div class="line"><a name="l08856"></a><span class="lineno"> 8856</span>&#160;      <span class="comment">/* Enable echo cancellation if it&#39;s not on already */</span></div><div class="line"><a name="l08857"></a><span class="lineno"> 8857</span>&#160;      sig_pri_set_echocanceller(pvt, 1);</div><div class="line"><a name="l08858"></a><span class="lineno"> 8858</span>&#160;   }</div><div class="line"><a name="l08859"></a><span class="lineno"> 8859</span>&#160;}</div><div class="line"><a name="l08860"></a><span class="lineno"> 8860</span>&#160;</div><div class="line"><a name="l08861"></a><span class="lineno"> 8861</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MWI)</span></div><div class="line"><a name="l08862"></a><span class="lineno"> 8862</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l08863"></a><span class="lineno"> 8863</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l08864"></a><span class="lineno"> 8864</span>&#160;<span class="comment"> * \brief Send a MWI indication to the given span.</span></div><div class="line"><a name="l08865"></a><span class="lineno"> 8865</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l08866"></a><span class="lineno"> 8866</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08867"></a><span class="lineno"> 8867</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l08868"></a><span class="lineno"> 8868</span>&#160;<span class="comment"> * \param vm_number Voicemail controlling number (NULL if not present).</span></div><div class="line"><a name="l08869"></a><span class="lineno"> 8869</span>&#160;<span class="comment"> * \param vm_box Voicemail mailbox number</span></div><div class="line"><a name="l08870"></a><span class="lineno"> 8870</span>&#160;<span class="comment"> * \param mbox_id Mailbox id</span></div><div class="line"><a name="l08871"></a><span class="lineno"> 8871</span>&#160;<span class="comment"> * \param num_messages Number of messages waiting.</span></div><div class="line"><a name="l08872"></a><span class="lineno"> 8872</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08873"></a><span class="lineno"> 8873</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l08874"></a><span class="lineno"> 8874</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08875"></a><span class="lineno"> 8875</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_send_mwi_indication(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keyword">const</span> <span class="keywordtype">char</span> *vm_number, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/df4/app__voicemail_8c.html#aa8ca9b5f9691b29d6124f113ca609b64">vm_box</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *mbox_id, <span class="keywordtype">int</span> num_messages)</div><div class="line"><a name="l08876"></a><span class="lineno"> 8876</span>&#160;{</div><div class="line"><a name="l08877"></a><span class="lineno"> 8877</span>&#160;   <span class="keyword">struct </span>pri_party_id voicemail;</div><div class="line"><a name="l08878"></a><span class="lineno"> 8878</span>&#160;   <span class="keyword">struct </span>pri_party_id <a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>;</div><div class="line"><a name="l08879"></a><span class="lineno"> 8879</span>&#160;</div><div class="line"><a name="l08880"></a><span class="lineno"> 8880</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Send MWI indication for %s(%s) vm_number:%s num_messages:%d\n&quot;</span>,</div><div class="line"><a name="l08881"></a><span class="lineno"> 8881</span>&#160;      vm_box, mbox_id, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(vm_number, <span class="stringliteral">&quot;&lt;not-present&gt;&quot;</span>), num_messages);</div><div class="line"><a name="l08882"></a><span class="lineno"> 8882</span>&#160;</div><div class="line"><a name="l08883"></a><span class="lineno"> 8883</span>&#160;   memset(&amp;<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>));</div><div class="line"><a name="l08884"></a><span class="lineno"> 8884</span>&#160;   <a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>.number.valid = 1;</div><div class="line"><a name="l08885"></a><span class="lineno"> 8885</span>&#160;   <a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>.number.presentation = PRES_ALLOWED_USER_NUMBER_NOT_SCREENED;</div><div class="line"><a name="l08886"></a><span class="lineno"> 8886</span>&#160;   <a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>.number.plan = (PRI_TON_UNKNOWN &lt;&lt; 4) | PRI_NPI_UNKNOWN;</div><div class="line"><a name="l08887"></a><span class="lineno"> 8887</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>.number.str, vm_box, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>.number.str));</div><div class="line"><a name="l08888"></a><span class="lineno"> 8888</span>&#160;</div><div class="line"><a name="l08889"></a><span class="lineno"> 8889</span>&#160;   memset(&amp;voicemail, 0, <span class="keyword">sizeof</span>(voicemail));</div><div class="line"><a name="l08890"></a><span class="lineno"> 8890</span>&#160;   voicemail.number.valid = 1;</div><div class="line"><a name="l08891"></a><span class="lineno"> 8891</span>&#160;   voicemail.number.presentation = PRES_ALLOWED_USER_NUMBER_NOT_SCREENED;</div><div class="line"><a name="l08892"></a><span class="lineno"> 8892</span>&#160;   voicemail.number.plan = (PRI_TON_UNKNOWN &lt;&lt; 4) | PRI_NPI_UNKNOWN;</div><div class="line"><a name="l08893"></a><span class="lineno"> 8893</span>&#160;   <span class="keywordflow">if</span> (vm_number) {</div><div class="line"><a name="l08894"></a><span class="lineno"> 8894</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(voicemail.number.str, vm_number, <span class="keyword">sizeof</span>(voicemail.number.str));</div><div class="line"><a name="l08895"></a><span class="lineno"> 8895</span>&#160;   }</div><div class="line"><a name="l08896"></a><span class="lineno"> 8896</span>&#160;</div><div class="line"><a name="l08897"></a><span class="lineno"> 8897</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l08898"></a><span class="lineno"> 8898</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MWI_V2)</span></div><div class="line"><a name="l08899"></a><span class="lineno"> 8899</span>&#160;   pri_mwi_indicate_v2(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, &amp;<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, &amp;voicemail, 1 <span class="comment">/* speech */</span>, num_messages,</div><div class="line"><a name="l08900"></a><span class="lineno"> 8900</span>&#160;      <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -1, 0);</div><div class="line"><a name="l08901"></a><span class="lineno"> 8901</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* !defined(HAVE_PRI_MWI_V2) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08902"></a><span class="lineno"> 8902</span>&#160;   pri_mwi_indicate(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, &amp;<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, 1 <span class="comment">/* speech */</span>, num_messages, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -1, 0);</div><div class="line"><a name="l08903"></a><span class="lineno"> 8903</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* !defined(HAVE_PRI_MWI_V2) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08904"></a><span class="lineno"> 8904</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l08905"></a><span class="lineno"> 8905</span>&#160;}</div><div class="line"><a name="l08906"></a><span class="lineno"> 8906</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MWI) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08907"></a><span class="lineno"> 8907</span>&#160;</div><div class="line"><a name="l08908"></a><span class="lineno"> 8908</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MWI)</span></div><div class="line"><a name="l08909"></a><span class="lineno"> 8909</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l08910"></a><span class="lineno"> 8910</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l08911"></a><span class="lineno"> 8911</span>&#160;<span class="comment"> * \brief MWI subscription event callback.</span></div><div class="line"><a name="l08912"></a><span class="lineno"> 8912</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l08913"></a><span class="lineno"> 8913</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08914"></a><span class="lineno"> 8914</span>&#160;<span class="comment"> * \param userdata the data provider in the call to stasis_subscribe()</span></div><div class="line"><a name="l08915"></a><span class="lineno"> 8915</span>&#160;<span class="comment"> * \param sub the subscription to which the message was delivered for this callback</span></div><div class="line"><a name="l08916"></a><span class="lineno"> 8916</span>&#160;<span class="comment"> * \param topic the topic on which the message was published</span></div><div class="line"><a name="l08917"></a><span class="lineno"> 8917</span>&#160;<span class="comment"> * \param msg the message being passed to the subscriber</span></div><div class="line"><a name="l08918"></a><span class="lineno"> 8918</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08919"></a><span class="lineno"> 8919</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l08920"></a><span class="lineno"> 8920</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08921"></a><span class="lineno"> 8921</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_mwi_event_cb(<span class="keywordtype">void</span> *userdata, <span class="keyword">struct</span> <a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg)</div><div class="line"><a name="l08922"></a><span class="lineno"> 8922</span>&#160;{</div><div class="line"><a name="l08923"></a><span class="lineno"> 8923</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri = userdata;</div><div class="line"><a name="l08924"></a><span class="lineno"> 8924</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l08925"></a><span class="lineno"> 8925</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *mwi_state;</div><div class="line"><a name="l08926"></a><span class="lineno"> 8926</span>&#160;</div><div class="line"><a name="l08927"></a><span class="lineno"> 8927</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a>() != <a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(msg)) {</div><div class="line"><a name="l08928"></a><span class="lineno"> 8928</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l08929"></a><span class="lineno"> 8929</span>&#160;   }</div><div class="line"><a name="l08930"></a><span class="lineno"> 8930</span>&#160;</div><div class="line"><a name="l08931"></a><span class="lineno"> 8931</span>&#160;   mwi_state = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(msg);</div><div class="line"><a name="l08932"></a><span class="lineno"> 8932</span>&#160;</div><div class="line"><a name="l08933"></a><span class="lineno"> 8933</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(pri-&gt;mbox); ++idx) {</div><div class="line"><a name="l08934"></a><span class="lineno"> 8934</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;mbox[idx].sub) {</div><div class="line"><a name="l08935"></a><span class="lineno"> 8935</span>&#160;         <span class="comment">/* Mailbox slot is empty */</span></div><div class="line"><a name="l08936"></a><span class="lineno"> 8936</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l08937"></a><span class="lineno"> 8937</span>&#160;      }</div><div class="line"><a name="l08938"></a><span class="lineno"> 8938</span>&#160;</div><div class="line"><a name="l08939"></a><span class="lineno"> 8939</span>&#160;      <span class="keywordflow">if</span> (!strcmp(pri-&gt;mbox[idx].uniqueid, mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">uniqueid</a>)) {</div><div class="line"><a name="l08940"></a><span class="lineno"> 8940</span>&#160;         <span class="comment">/* Found the mailbox. */</span></div><div class="line"><a name="l08941"></a><span class="lineno"> 8941</span>&#160;         sig_pri_send_mwi_indication(pri, pri-&gt;mbox[idx].vm_number,</div><div class="line"><a name="l08942"></a><span class="lineno"> 8942</span>&#160;            pri-&gt;mbox[idx].vm_box, pri-&gt;mbox[idx].uniqueid, mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga70de9f16a229e2c5bf1a973372949d3e">new_msgs</a>);</div><div class="line"><a name="l08943"></a><span class="lineno"> 8943</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08944"></a><span class="lineno"> 8944</span>&#160;      }</div><div class="line"><a name="l08945"></a><span class="lineno"> 8945</span>&#160;   }</div><div class="line"><a name="l08946"></a><span class="lineno"> 8946</span>&#160;}</div><div class="line"><a name="l08947"></a><span class="lineno"> 8947</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MWI) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08948"></a><span class="lineno"> 8948</span>&#160;</div><div class="line"><a name="l08949"></a><span class="lineno"> 8949</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MWI)</span></div><div class="line"><a name="l08950"></a><span class="lineno"> 8950</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l08951"></a><span class="lineno"> 8951</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l08952"></a><span class="lineno"> 8952</span>&#160;<span class="comment"> * \brief Send update MWI indications from the event cache.</span></div><div class="line"><a name="l08953"></a><span class="lineno"> 8953</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l08954"></a><span class="lineno"> 8954</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08955"></a><span class="lineno"> 8955</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l08956"></a><span class="lineno"> 8956</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08957"></a><span class="lineno"> 8957</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l08958"></a><span class="lineno"> 8958</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08959"></a><span class="lineno"> 8959</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_mwi_cache_update(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l08960"></a><span class="lineno"> 8960</span>&#160;{</div><div class="line"><a name="l08961"></a><span class="lineno"> 8961</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l08962"></a><span class="lineno"> 8962</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *mwi_state;</div><div class="line"><a name="l08963"></a><span class="lineno"> 8963</span>&#160;</div><div class="line"><a name="l08964"></a><span class="lineno"> 8964</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(pri-&gt;mbox); ++idx) {</div><div class="line"><a name="l08965"></a><span class="lineno"> 8965</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *, msg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l08966"></a><span class="lineno"> 8966</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;mbox[idx].sub) {</div><div class="line"><a name="l08967"></a><span class="lineno"> 8967</span>&#160;         <span class="comment">/* Mailbox slot is empty */</span></div><div class="line"><a name="l08968"></a><span class="lineno"> 8968</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l08969"></a><span class="lineno"> 8969</span>&#160;      }</div><div class="line"><a name="l08970"></a><span class="lineno"> 8970</span>&#160;</div><div class="line"><a name="l08971"></a><span class="lineno"> 8971</span>&#160;      msg = <a class="code" href="../../dd/d79/stasis_8h.html#ab3da17290725793258020b83f56e4df6">stasis_cache_get</a>(<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga7fc6473ab80d2117f1bcb1359721fdce">ast_mwi_state_cache</a>(), <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a>(),</div><div class="line"><a name="l08972"></a><span class="lineno"> 8972</span>&#160;         pri-&gt;mbox[idx].uniqueid);</div><div class="line"><a name="l08973"></a><span class="lineno"> 8973</span>&#160;      <span class="keywordflow">if</span> (!msg) {</div><div class="line"><a name="l08974"></a><span class="lineno"> 8974</span>&#160;         <span class="comment">/* No cached event for this mailbox. */</span></div><div class="line"><a name="l08975"></a><span class="lineno"> 8975</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l08976"></a><span class="lineno"> 8976</span>&#160;      }</div><div class="line"><a name="l08977"></a><span class="lineno"> 8977</span>&#160;</div><div class="line"><a name="l08978"></a><span class="lineno"> 8978</span>&#160;      mwi_state = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(msg);</div><div class="line"><a name="l08979"></a><span class="lineno"> 8979</span>&#160;      sig_pri_send_mwi_indication(pri, pri-&gt;mbox[idx].vm_number, pri-&gt;mbox[idx].vm_box,</div><div class="line"><a name="l08980"></a><span class="lineno"> 8980</span>&#160;         pri-&gt;mbox[idx].uniqueid, mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga70de9f16a229e2c5bf1a973372949d3e">new_msgs</a>);</div><div class="line"><a name="l08981"></a><span class="lineno"> 8981</span>&#160;   }</div><div class="line"><a name="l08982"></a><span class="lineno"> 8982</span>&#160;}</div><div class="line"><a name="l08983"></a><span class="lineno"> 8983</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MWI) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08984"></a><span class="lineno"> 8984</span>&#160;<span class="comment"></span></div><div class="line"><a name="l08985"></a><span class="lineno"> 8985</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l08986"></a><span class="lineno"> 8986</span>&#160;<span class="comment"> * \brief Stop PRI span.</span></div><div class="line"><a name="l08987"></a><span class="lineno"> 8987</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l08988"></a><span class="lineno"> 8988</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08989"></a><span class="lineno"> 8989</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l08990"></a><span class="lineno"> 8990</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08991"></a><span class="lineno"> 8991</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l08992"></a><span class="lineno"> 8992</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08993"></a><span class="lineno"> 8993</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a713dfbe873628068511c7d6bfcb7aa1b">sig_pri_stop_pri</a>(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l08994"></a><span class="lineno"> 8994</span>&#160;{</div><div class="line"><a name="l08995"></a><span class="lineno"> 8995</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MWI)</span></div><div class="line"><a name="l08996"></a><span class="lineno"> 8996</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l08997"></a><span class="lineno"> 8997</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MWI) */</span><span class="preprocessor"></span></div><div class="line"><a name="l08998"></a><span class="lineno"> 8998</span>&#160;</div><div class="line"><a name="l08999"></a><span class="lineno"> 8999</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MWI)</span></div><div class="line"><a name="l09000"></a><span class="lineno"> 9000</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(pri-&gt;mbox); ++idx) {</div><div class="line"><a name="l09001"></a><span class="lineno"> 9001</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;mbox[idx].sub) {</div><div class="line"><a name="l09002"></a><span class="lineno"> 9002</span>&#160;         pri-&gt;mbox[idx].sub = <a class="code" href="../../dc/d33/mwi_8h.html#acf8d474c4029156d9c49a4ddea50d01b">ast_mwi_unsubscribe_and_join</a>(pri-&gt;mbox[idx].sub);</div><div class="line"><a name="l09003"></a><span class="lineno"> 9003</span>&#160;      }</div><div class="line"><a name="l09004"></a><span class="lineno"> 9004</span>&#160;   }</div><div class="line"><a name="l09005"></a><span class="lineno"> 9005</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MWI) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09006"></a><span class="lineno"> 9006</span>&#160;}</div><div class="line"><a name="l09007"></a><span class="lineno"> 9007</span>&#160;<span class="comment"></span></div><div class="line"><a name="l09008"></a><span class="lineno"> 9008</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09009"></a><span class="lineno"> 9009</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l09010"></a><span class="lineno"> 9010</span>&#160;<span class="comment"> * \brief qsort comparison function.</span></div><div class="line"><a name="l09011"></a><span class="lineno"> 9011</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09012"></a><span class="lineno"> 9012</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09013"></a><span class="lineno"> 9013</span>&#160;<span class="comment"> * \param left Ptr to sig_pri_chan ptr to compare.</span></div><div class="line"><a name="l09014"></a><span class="lineno"> 9014</span>&#160;<span class="comment"> * \param right Ptr to sig_pri_chan ptr to compare.</span></div><div class="line"><a name="l09015"></a><span class="lineno"> 9015</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09016"></a><span class="lineno"> 9016</span>&#160;<span class="comment"> * \retval &lt;0 if left &lt; right.</span></div><div class="line"><a name="l09017"></a><span class="lineno"> 9017</span>&#160;<span class="comment"> * \retval =0 if left == right.</span></div><div class="line"><a name="l09018"></a><span class="lineno"> 9018</span>&#160;<span class="comment"> * \retval &gt;0 if left &gt; right.</span></div><div class="line"><a name="l09019"></a><span class="lineno"> 9019</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09020"></a><span class="lineno"> 9020</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_cmp_pri_chans(<span class="keyword">const</span> <span class="keywordtype">void</span> *left, <span class="keyword">const</span> <span class="keywordtype">void</span> *right)</div><div class="line"><a name="l09021"></a><span class="lineno"> 9021</span>&#160;{</div><div class="line"><a name="l09022"></a><span class="lineno"> 9022</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt_left;</div><div class="line"><a name="l09023"></a><span class="lineno"> 9023</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt_right;</div><div class="line"><a name="l09024"></a><span class="lineno"> 9024</span>&#160;</div><div class="line"><a name="l09025"></a><span class="lineno"> 9025</span>&#160;   pvt_left = *(<span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> **) left;</div><div class="line"><a name="l09026"></a><span class="lineno"> 9026</span>&#160;   pvt_right = *(<span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> **) right;</div><div class="line"><a name="l09027"></a><span class="lineno"> 9027</span>&#160;   <span class="keywordflow">if</span> (!pvt_left) {</div><div class="line"><a name="l09028"></a><span class="lineno"> 9028</span>&#160;      <span class="keywordflow">if</span> (!pvt_right) {</div><div class="line"><a name="l09029"></a><span class="lineno"> 9029</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l09030"></a><span class="lineno"> 9030</span>&#160;      }</div><div class="line"><a name="l09031"></a><span class="lineno"> 9031</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l09032"></a><span class="lineno"> 9032</span>&#160;   }</div><div class="line"><a name="l09033"></a><span class="lineno"> 9033</span>&#160;   <span class="keywordflow">if</span> (!pvt_right) {</div><div class="line"><a name="l09034"></a><span class="lineno"> 9034</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l09035"></a><span class="lineno"> 9035</span>&#160;   }</div><div class="line"><a name="l09036"></a><span class="lineno"> 9036</span>&#160;</div><div class="line"><a name="l09037"></a><span class="lineno"> 9037</span>&#160;   <span class="keywordflow">return</span> pvt_left-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> - pvt_right-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>;</div><div class="line"><a name="l09038"></a><span class="lineno"> 9038</span>&#160;}</div><div class="line"><a name="l09039"></a><span class="lineno"> 9039</span>&#160;<span class="comment"></span></div><div class="line"><a name="l09040"></a><span class="lineno"> 9040</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09041"></a><span class="lineno"> 9041</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l09042"></a><span class="lineno"> 9042</span>&#160;<span class="comment"> * \brief Sort the PRI B channel private pointer array.</span></div><div class="line"><a name="l09043"></a><span class="lineno"> 9043</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09044"></a><span class="lineno"> 9044</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09045"></a><span class="lineno"> 9045</span>&#160;<span class="comment"> * \param pri PRI span control structure.</span></div><div class="line"><a name="l09046"></a><span class="lineno"> 9046</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09047"></a><span class="lineno"> 9047</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09048"></a><span class="lineno"> 9048</span>&#160;<span class="comment"> * Since the chan_dahdi.conf file can declare channels in any order, we need to sort</span></div><div class="line"><a name="l09049"></a><span class="lineno"> 9049</span>&#160;<span class="comment"> * the private channel pointer array.</span></div><div class="line"><a name="l09050"></a><span class="lineno"> 9050</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09051"></a><span class="lineno"> 9051</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l09052"></a><span class="lineno"> 9052</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09053"></a><span class="lineno"> 9053</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sig_pri_sort_pri_chans(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l09054"></a><span class="lineno"> 9054</span>&#160;{</div><div class="line"><a name="l09055"></a><span class="lineno"> 9055</span>&#160;   qsort(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>, <span class="keyword">sizeof</span>(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[0]), sig_pri_cmp_pri_chans);</div><div class="line"><a name="l09056"></a><span class="lineno"> 9056</span>&#160;}</div><div class="line"><a name="l09057"></a><span class="lineno"> 9057</span>&#160;</div><div class="line"><a name="l09058"></a><span class="lineno"> 9058</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a53f043834d01332ee7187ee47ffce91d">sig_pri_start_pri</a>(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l09059"></a><span class="lineno"> 9059</span>&#160;{</div><div class="line"><a name="l09060"></a><span class="lineno"> 9060</span>&#160;   <span class="keywordtype">int</span> x;</div><div class="line"><a name="l09061"></a><span class="lineno"> 9061</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l09062"></a><span class="lineno"> 9062</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MWI)</span></div><div class="line"><a name="l09063"></a><span class="lineno"> 9063</span>&#160;   <span class="keywordtype">char</span> *saveptr;</div><div class="line"><a name="l09064"></a><span class="lineno"> 9064</span>&#160;   <span class="keywordtype">char</span> *prev_vm_number;</div><div class="line"><a name="l09065"></a><span class="lineno"> 9065</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MWI) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09066"></a><span class="lineno"> 9066</span>&#160;</div><div class="line"><a name="l09067"></a><span class="lineno"> 9067</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MWI)</span></div><div class="line"><a name="l09068"></a><span class="lineno"> 9068</span>&#160;   <span class="comment">/* Prepare the mbox[] for use. */</span></div><div class="line"><a name="l09069"></a><span class="lineno"> 9069</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(pri-&gt;mbox); ++i) {</div><div class="line"><a name="l09070"></a><span class="lineno"> 9070</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;mbox[i].sub) {</div><div class="line"><a name="l09071"></a><span class="lineno"> 9071</span>&#160;         pri-&gt;mbox[i].sub = <a class="code" href="../../dc/d33/mwi_8h.html#a82c6cbb5215eec5348715e4824f5f575">ast_mwi_unsubscribe</a>(pri-&gt;mbox[i].sub);</div><div class="line"><a name="l09072"></a><span class="lineno"> 9072</span>&#160;      }</div><div class="line"><a name="l09073"></a><span class="lineno"> 9073</span>&#160;   }</div><div class="line"><a name="l09074"></a><span class="lineno"> 9074</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MWI) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09075"></a><span class="lineno"> 9075</span>&#160;</div><div class="line"><a name="l09076"></a><span class="lineno"> 9076</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l09077"></a><span class="lineno"> 9077</span>&#160;   sig_pri_sort_pri_chans(pri);</div><div class="line"><a name="l09078"></a><span class="lineno"> 9078</span>&#160;</div><div class="line"><a name="l09079"></a><span class="lineno"> 9079</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MWI)</span></div><div class="line"><a name="l09080"></a><span class="lineno"> 9080</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l09081"></a><span class="lineno"> 9081</span>&#160;<span class="comment">    * Split the mwi_vm_numbers configuration string into the mbox[].vm_number:</span></div><div class="line"><a name="l09082"></a><span class="lineno"> 9082</span>&#160;<span class="comment">    * vm_number{,vm_number}</span></div><div class="line"><a name="l09083"></a><span class="lineno"> 9083</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l09084"></a><span class="lineno"> 9084</span>&#160;   prev_vm_number = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l09085"></a><span class="lineno"> 9085</span>&#160;   saveptr = pri-&gt;mwi_vm_numbers;</div><div class="line"><a name="l09086"></a><span class="lineno"> 9086</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(pri-&gt;mbox); ++i) {</div><div class="line"><a name="l09087"></a><span class="lineno"> 9087</span>&#160;      <span class="keywordtype">char</span> *vm_number;</div><div class="line"><a name="l09088"></a><span class="lineno"> 9088</span>&#160;</div><div class="line"><a name="l09089"></a><span class="lineno"> 9089</span>&#160;      vm_number = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;saveptr, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l09090"></a><span class="lineno"> 9090</span>&#160;      <span class="keywordflow">if</span> (vm_number) {</div><div class="line"><a name="l09091"></a><span class="lineno"> 9091</span>&#160;         vm_number = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(vm_number);</div><div class="line"><a name="l09092"></a><span class="lineno"> 9092</span>&#160;      }</div><div class="line"><a name="l09093"></a><span class="lineno"> 9093</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vm_number)) {</div><div class="line"><a name="l09094"></a><span class="lineno"> 9094</span>&#160;         <span class="comment">/* There was no number so reuse the previous number. */</span></div><div class="line"><a name="l09095"></a><span class="lineno"> 9095</span>&#160;         vm_number = prev_vm_number;</div><div class="line"><a name="l09096"></a><span class="lineno"> 9096</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l09097"></a><span class="lineno"> 9097</span>&#160;         <span class="comment">/* We have a new number. */</span></div><div class="line"><a name="l09098"></a><span class="lineno"> 9098</span>&#160;         prev_vm_number = vm_number;</div><div class="line"><a name="l09099"></a><span class="lineno"> 9099</span>&#160;      }</div><div class="line"><a name="l09100"></a><span class="lineno"> 9100</span>&#160;      pri-&gt;mbox[i].vm_number = vm_number;</div><div class="line"><a name="l09101"></a><span class="lineno"> 9101</span>&#160;   }</div><div class="line"><a name="l09102"></a><span class="lineno"> 9102</span>&#160;</div><div class="line"><a name="l09103"></a><span class="lineno"> 9103</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l09104"></a><span class="lineno"> 9104</span>&#160;<span class="comment">    * Split the mwi_vm_boxes configuration string into the mbox[].vm_box:</span></div><div class="line"><a name="l09105"></a><span class="lineno"> 9105</span>&#160;<span class="comment">    * vm_box{,vm_box}</span></div><div class="line"><a name="l09106"></a><span class="lineno"> 9106</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l09107"></a><span class="lineno"> 9107</span>&#160;   saveptr = pri-&gt;mwi_vm_boxes;</div><div class="line"><a name="l09108"></a><span class="lineno"> 9108</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(pri-&gt;mbox); ++i) {</div><div class="line"><a name="l09109"></a><span class="lineno"> 9109</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="../../dc/df4/app__voicemail_8c.html#aa8ca9b5f9691b29d6124f113ca609b64">vm_box</a>;</div><div class="line"><a name="l09110"></a><span class="lineno"> 9110</span>&#160;</div><div class="line"><a name="l09111"></a><span class="lineno"> 9111</span>&#160;      vm_box = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;saveptr, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l09112"></a><span class="lineno"> 9112</span>&#160;      <span class="keywordflow">if</span> (vm_box) {</div><div class="line"><a name="l09113"></a><span class="lineno"> 9113</span>&#160;         vm_box = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(vm_box);</div><div class="line"><a name="l09114"></a><span class="lineno"> 9114</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vm_box)) {</div><div class="line"><a name="l09115"></a><span class="lineno"> 9115</span>&#160;            vm_box = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l09116"></a><span class="lineno"> 9116</span>&#160;         }</div><div class="line"><a name="l09117"></a><span class="lineno"> 9117</span>&#160;      }</div><div class="line"><a name="l09118"></a><span class="lineno"> 9118</span>&#160;      pri-&gt;mbox[i].vm_box = <a class="code" href="../../dc/df4/app__voicemail_8c.html#aa8ca9b5f9691b29d6124f113ca609b64">vm_box</a>;</div><div class="line"><a name="l09119"></a><span class="lineno"> 9119</span>&#160;   }</div><div class="line"><a name="l09120"></a><span class="lineno"> 9120</span>&#160;</div><div class="line"><a name="l09121"></a><span class="lineno"> 9121</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l09122"></a><span class="lineno"> 9122</span>&#160;<span class="comment">    * Split the mwi_mailboxes configuration string into the mbox[]:</span></div><div class="line"><a name="l09123"></a><span class="lineno"> 9123</span>&#160;<span class="comment">    * vm_mailbox{,vm_mailbox}</span></div><div class="line"><a name="l09124"></a><span class="lineno"> 9124</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l09125"></a><span class="lineno"> 9125</span>&#160;   saveptr = pri-&gt;mwi_mailboxes;</div><div class="line"><a name="l09126"></a><span class="lineno"> 9126</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(pri-&gt;mbox); ++i) {</div><div class="line"><a name="l09127"></a><span class="lineno"> 9127</span>&#160;      <span class="keywordtype">char</span> *mbox_id;</div><div class="line"><a name="l09128"></a><span class="lineno"> 9128</span>&#160;</div><div class="line"><a name="l09129"></a><span class="lineno"> 9129</span>&#160;      mbox_id = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;saveptr, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l09130"></a><span class="lineno"> 9130</span>&#160;      <span class="keywordflow">if</span> (mbox_id) {</div><div class="line"><a name="l09131"></a><span class="lineno"> 9131</span>&#160;         mbox_id = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(mbox_id);</div><div class="line"><a name="l09132"></a><span class="lineno"> 9132</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(mbox_id)) {</div><div class="line"><a name="l09133"></a><span class="lineno"> 9133</span>&#160;            mbox_id = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l09134"></a><span class="lineno"> 9134</span>&#160;         }</div><div class="line"><a name="l09135"></a><span class="lineno"> 9135</span>&#160;      }</div><div class="line"><a name="l09136"></a><span class="lineno"> 9136</span>&#160;      pri-&gt;mbox[i].uniqueid = mbox_id;</div><div class="line"><a name="l09137"></a><span class="lineno"> 9137</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;mbox[i].vm_box || !mbox_id) {</div><div class="line"><a name="l09138"></a><span class="lineno"> 9138</span>&#160;         <span class="comment">/* The mailbox position is disabled. */</span></div><div class="line"><a name="l09139"></a><span class="lineno"> 9139</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;%s span %d MWI position %d disabled.  vm_box:%s mbox_id:%s.\n&quot;</span>,</div><div class="line"><a name="l09140"></a><span class="lineno"> 9140</span>&#160;            sig_pri_cc_type_name, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, i,</div><div class="line"><a name="l09141"></a><span class="lineno"> 9141</span>&#160;            pri-&gt;mbox[i].vm_box ?: <span class="stringliteral">&quot;&lt;missing&gt;&quot;</span>,</div><div class="line"><a name="l09142"></a><span class="lineno"> 9142</span>&#160;            mbox_id ?: <span class="stringliteral">&quot;&lt;missing&gt;&quot;</span>);</div><div class="line"><a name="l09143"></a><span class="lineno"> 9143</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l09144"></a><span class="lineno"> 9144</span>&#160;      }</div><div class="line"><a name="l09145"></a><span class="lineno"> 9145</span>&#160;</div><div class="line"><a name="l09146"></a><span class="lineno"> 9146</span>&#160;      pri-&gt;mbox[i].sub = <a class="code" href="../../dc/d33/mwi_8h.html#ad83d6c9c09755c8b274a8f07fb2c64f7">ast_mwi_subscribe_pool</a>(mbox_id, sig_pri_mwi_event_cb, pri);</div><div class="line"><a name="l09147"></a><span class="lineno"> 9147</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;mbox[i].sub) {</div><div class="line"><a name="l09148"></a><span class="lineno"> 9148</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s span %d could not subscribe to MWI events for %s(%s).\n&quot;</span>,</div><div class="line"><a name="l09149"></a><span class="lineno"> 9149</span>&#160;            sig_pri_cc_type_name, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;mbox[i].vm_box, mbox_id);</div><div class="line"><a name="l09150"></a><span class="lineno"> 9150</span>&#160;      }</div><div class="line"><a name="l09151"></a><span class="lineno"> 9151</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MWI_V2)</span></div><div class="line"><a name="l09152"></a><span class="lineno"> 9152</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(pri-&gt;mbox[i].vm_number)) {</div><div class="line"><a name="l09153"></a><span class="lineno"> 9153</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s span %d MWI voicemail number for %s(%s) is empty.\n&quot;</span>,</div><div class="line"><a name="l09154"></a><span class="lineno"> 9154</span>&#160;            sig_pri_cc_type_name, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>, pri-&gt;mbox[i].vm_box, mbox_id);</div><div class="line"><a name="l09155"></a><span class="lineno"> 9155</span>&#160;      }</div><div class="line"><a name="l09156"></a><span class="lineno"> 9156</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MWI_V2) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09157"></a><span class="lineno"> 9157</span>&#160;   }</div><div class="line"><a name="l09158"></a><span class="lineno"> 9158</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MWI) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09159"></a><span class="lineno"> 9159</span>&#160;</div><div class="line"><a name="l09160"></a><span class="lineno"> 9160</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; i++) {</div><div class="line"><a name="l09161"></a><span class="lineno"> 9161</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i] == -1) {</div><div class="line"><a name="l09162"></a><span class="lineno"> 9162</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l09163"></a><span class="lineno"> 9163</span>&#160;      }</div><div class="line"><a name="l09164"></a><span class="lineno"> 9164</span>&#160;</div><div class="line"><a name="l09165"></a><span class="lineno"> 9165</span>&#160;      <span class="keywordflow">switch</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {</div><div class="line"><a name="l09166"></a><span class="lineno"> 9166</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d5/db3/chan__dahdi_8h.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>:</div><div class="line"><a name="l09167"></a><span class="lineno"> 9167</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i] = pri_new_bri(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i], 1, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">nodetype</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3308f9fadc7b0c6c044b363e9bd731ae">switchtype</a>);</div><div class="line"><a name="l09168"></a><span class="lineno"> 9168</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l09169"></a><span class="lineno"> 9169</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d5/db3/chan__dahdi_8h.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>:</div><div class="line"><a name="l09170"></a><span class="lineno"> 9170</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i] = pri_new_bri(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i], 0, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">nodetype</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3308f9fadc7b0c6c044b363e9bd731ae">switchtype</a>);</div><div class="line"><a name="l09171"></a><span class="lineno"> 9171</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l09172"></a><span class="lineno"> 9172</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l09173"></a><span class="lineno"> 9173</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i] = pri_new(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i], pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">nodetype</a>, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3308f9fadc7b0c6c044b363e9bd731ae">switchtype</a>);</div><div class="line"><a name="l09174"></a><span class="lineno"> 9174</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SERVICE_MESSAGES)</span></div><div class="line"><a name="l09175"></a><span class="lineno"> 9175</span>&#160;         <span class="keywordflow">if</span> (pri-&gt;enable_service_message_support) {</div><div class="line"><a name="l09176"></a><span class="lineno"> 9176</span>&#160;            pri_set_service_message_support(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i], 1);</div><div class="line"><a name="l09177"></a><span class="lineno"> 9177</span>&#160;         }</div><div class="line"><a name="l09178"></a><span class="lineno"> 9178</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SERVICE_MESSAGES) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09179"></a><span class="lineno"> 9179</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l09180"></a><span class="lineno"> 9180</span>&#160;      }</div><div class="line"><a name="l09181"></a><span class="lineno"> 9181</span>&#160;</div><div class="line"><a name="l09182"></a><span class="lineno"> 9182</span>&#160;      pri_set_overlapdial(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i], (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">overlapdial</a> &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a4bccf90ead0cf7c93b177e59cbe5b3be">DAHDI_OVERLAPDIAL_OUTGOING</a>) ? 1 : 0);</div><div class="line"><a name="l09183"></a><span class="lineno"> 9183</span>&#160;<span class="preprocessor">#ifdef HAVE_PRI_PROG_W_CAUSE</span></div><div class="line"><a name="l09184"></a><span class="lineno"> 9184</span>&#160;      pri_set_chan_mapping_logical(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i], pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ae01f9ae44f2c09425d128bb826fc3dde">qsigchannelmapping</a> == <a class="code" href="../../d7/d6c/sig__pri_8h.html#aa65ac97c8c851bb8c7e1b80c523670f2">DAHDI_CHAN_MAPPING_LOGICAL</a>);</div><div class="line"><a name="l09185"></a><span class="lineno"> 9185</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l09186"></a><span class="lineno"> 9186</span>&#160;<span class="preprocessor">#ifdef HAVE_PRI_INBANDDISCONNECT</span></div><div class="line"><a name="l09187"></a><span class="lineno"> 9187</span>&#160;      pri_set_inbanddisconnect(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i], pri-&gt;inbanddisconnect);</div><div class="line"><a name="l09188"></a><span class="lineno"> 9188</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l09189"></a><span class="lineno"> 9189</span>&#160;      <span class="comment">/* Enslave to master if appropriate */</span></div><div class="line"><a name="l09190"></a><span class="lineno"> 9190</span>&#160;      <span class="keywordflow">if</span> (i)</div><div class="line"><a name="l09191"></a><span class="lineno"> 9191</span>&#160;         pri_enslave(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[0], pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i]);</div><div class="line"><a name="l09192"></a><span class="lineno"> 9192</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i]) {</div><div class="line"><a name="l09193"></a><span class="lineno"> 9193</span>&#160;         <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i] &gt; 0)</div><div class="line"><a name="l09194"></a><span class="lineno"> 9194</span>&#160;            close(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i]);</div><div class="line"><a name="l09195"></a><span class="lineno"> 9195</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i] = -1;</div><div class="line"><a name="l09196"></a><span class="lineno"> 9196</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create PRI structure\n&quot;</span>);</div><div class="line"><a name="l09197"></a><span class="lineno"> 9197</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l09198"></a><span class="lineno"> 9198</span>&#160;      }</div><div class="line"><a name="l09199"></a><span class="lineno"> 9199</span>&#160;      pri_set_debug(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i], <a class="code" href="../../d7/d6c/sig__pri_8h.html#a63b68dece9c6cdaf9e240667bdc21f6b">SIG_PRI_DEBUG_DEFAULT</a>);</div><div class="line"><a name="l09200"></a><span class="lineno"> 9200</span>&#160;      pri_set_nsf(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i], pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a35ab02b1fbf5754847e92fbd6583073c">nsf</a>);</div><div class="line"><a name="l09201"></a><span class="lineno"> 9201</span>&#160;<span class="preprocessor">#ifdef PRI_GETSET_TIMERS</span></div><div class="line"><a name="l09202"></a><span class="lineno"> 9202</span>&#160;      <span class="keywordflow">for</span> (x = 0; x &lt; PRI_MAX_TIMERS; x++) {</div><div class="line"><a name="l09203"></a><span class="lineno"> 9203</span>&#160;         <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a83859c0d9f6323aa52b700c8f344f1ad">pritimers</a>[x] != 0)</div><div class="line"><a name="l09204"></a><span class="lineno"> 9204</span>&#160;            pri_set_timer(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i], x, pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a83859c0d9f6323aa52b700c8f344f1ad">pritimers</a>[x]);</div><div class="line"><a name="l09205"></a><span class="lineno"> 9205</span>&#160;      }</div><div class="line"><a name="l09206"></a><span class="lineno"> 9206</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l09207"></a><span class="lineno"> 9207</span>&#160;   }</div><div class="line"><a name="l09208"></a><span class="lineno"> 9208</span>&#160;</div><div class="line"><a name="l09209"></a><span class="lineno"> 9209</span>&#160;   <span class="comment">/* Assume primary is the one we use */</span></div><div class="line"><a name="l09210"></a><span class="lineno"> 9210</span>&#160;   pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a> = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[0];</div><div class="line"><a name="l09211"></a><span class="lineno"> 9211</span>&#160;</div><div class="line"><a name="l09212"></a><span class="lineno"> 9212</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_HOLD)</span></div><div class="line"><a name="l09213"></a><span class="lineno"> 9213</span>&#160;   pri_hold_enable(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, 1);</div><div class="line"><a name="l09214"></a><span class="lineno"> 9214</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_HOLD) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09215"></a><span class="lineno"> 9215</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_REROUTING)</span></div><div class="line"><a name="l09216"></a><span class="lineno"> 9216</span>&#160;   pri_reroute_enable(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, 1);</div><div class="line"><a name="l09217"></a><span class="lineno"> 9217</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_REROUTING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09218"></a><span class="lineno"> 9218</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_HANGUP_FIX)</span></div><div class="line"><a name="l09219"></a><span class="lineno"> 9219</span>&#160;   pri_hangup_fix_enable(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, 1);</div><div class="line"><a name="l09220"></a><span class="lineno"> 9220</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_HANGUP_FIX) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09221"></a><span class="lineno"> 9221</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09222"></a><span class="lineno"> 9222</span>&#160;   pri_cc_enable(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, 1);</div><div class="line"><a name="l09223"></a><span class="lineno"> 9223</span>&#160;   pri_cc_recall_mode(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;cc_ptmp_recall_mode);</div><div class="line"><a name="l09224"></a><span class="lineno"> 9224</span>&#160;   pri_cc_retain_signaling_req(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;cc_qsig_signaling_link_req);</div><div class="line"><a name="l09225"></a><span class="lineno"> 9225</span>&#160;   pri_cc_retain_signaling_rsp(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;cc_qsig_signaling_link_rsp);</div><div class="line"><a name="l09226"></a><span class="lineno"> 9226</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09227"></a><span class="lineno"> 9227</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_TRANSFER)</span></div><div class="line"><a name="l09228"></a><span class="lineno"> 9228</span>&#160;   pri_transfer_enable(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, 1);</div><div class="line"><a name="l09229"></a><span class="lineno"> 9229</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_TRANSFER) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09230"></a><span class="lineno"> 9230</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_AOC_EVENTS)</span></div><div class="line"><a name="l09231"></a><span class="lineno"> 9231</span>&#160;   pri_aoc_events_enable(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, 1);</div><div class="line"><a name="l09232"></a><span class="lineno"> 9232</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_AOC_EVENTS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09233"></a><span class="lineno"> 9233</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CALL_WAITING)</span></div><div class="line"><a name="l09234"></a><span class="lineno"> 9234</span>&#160;   pri_connect_ack_enable(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, 1);</div><div class="line"><a name="l09235"></a><span class="lineno"> 9235</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CALL_WAITING) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09236"></a><span class="lineno"> 9236</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MCID)</span></div><div class="line"><a name="l09237"></a><span class="lineno"> 9237</span>&#160;   pri_mcid_enable(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, 1);</div><div class="line"><a name="l09238"></a><span class="lineno"> 9238</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MCID) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09239"></a><span class="lineno"> 9239</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_DISPLAY_TEXT)</span></div><div class="line"><a name="l09240"></a><span class="lineno"> 9240</span>&#160;   pri_display_options_send(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;display_flags_send);</div><div class="line"><a name="l09241"></a><span class="lineno"> 9241</span>&#160;   pri_display_options_receive(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;display_flags_receive);</div><div class="line"><a name="l09242"></a><span class="lineno"> 9242</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_DISPLAY_TEXT) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09243"></a><span class="lineno"> 9243</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_DATETIME_SEND)</span></div><div class="line"><a name="l09244"></a><span class="lineno"> 9244</span>&#160;   pri_date_time_send_option(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;datetime_send);</div><div class="line"><a name="l09245"></a><span class="lineno"> 9245</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_DATETIME_SEND) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09246"></a><span class="lineno"> 9246</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_L2_PERSISTENCE)</span></div><div class="line"><a name="l09247"></a><span class="lineno"> 9247</span>&#160;   pri_persistent_layer2_option(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pri-&gt;l2_persistence);</div><div class="line"><a name="l09248"></a><span class="lineno"> 9248</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_L2_PERSISTENCE) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09249"></a><span class="lineno"> 9249</span>&#160;</div><div class="line"><a name="l09250"></a><span class="lineno"> 9250</span>&#160;   pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">resetpos</a> = -1;</div><div class="line"><a name="l09251"></a><span class="lineno"> 9251</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9e187fd6e33fd32a888531467786c773">master</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pri_dchannel, pri)) {</div><div class="line"><a name="l09252"></a><span class="lineno"> 9252</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; i++) {</div><div class="line"><a name="l09253"></a><span class="lineno"> 9253</span>&#160;         <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[i])</div><div class="line"><a name="l09254"></a><span class="lineno"> 9254</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l09255"></a><span class="lineno"> 9255</span>&#160;         <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i] &gt; 0)</div><div class="line"><a name="l09256"></a><span class="lineno"> 9256</span>&#160;            close(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i]);</div><div class="line"><a name="l09257"></a><span class="lineno"> 9257</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">fds</a>[i] = -1;</div><div class="line"><a name="l09258"></a><span class="lineno"> 9258</span>&#160;      }</div><div class="line"><a name="l09259"></a><span class="lineno"> 9259</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to spawn D-channel: %s\n&quot;</span>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l09260"></a><span class="lineno"> 9260</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l09261"></a><span class="lineno"> 9261</span>&#160;   }</div><div class="line"><a name="l09262"></a><span class="lineno"> 9262</span>&#160;</div><div class="line"><a name="l09263"></a><span class="lineno"> 9263</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MWI)</span></div><div class="line"><a name="l09264"></a><span class="lineno"> 9264</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l09265"></a><span class="lineno"> 9265</span>&#160;<span class="comment">    * Send the initial MWI indications from the event cache for this span.</span></div><div class="line"><a name="l09266"></a><span class="lineno"> 9266</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l09267"></a><span class="lineno"> 9267</span>&#160;<span class="comment">    * If we were loaded after app_voicemail the event would already be in</span></div><div class="line"><a name="l09268"></a><span class="lineno"> 9268</span>&#160;<span class="comment">    * the cache.  If we were loaded before app_voicemail the event would not</span></div><div class="line"><a name="l09269"></a><span class="lineno"> 9269</span>&#160;<span class="comment">    * be in the cache yet and app_voicemail will send the event when it</span></div><div class="line"><a name="l09270"></a><span class="lineno"> 9270</span>&#160;<span class="comment">    * gets loaded.</span></div><div class="line"><a name="l09271"></a><span class="lineno"> 9271</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l09272"></a><span class="lineno"> 9272</span>&#160;   sig_pri_mwi_cache_update(pri);</div><div class="line"><a name="l09273"></a><span class="lineno"> 9273</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MWI) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09274"></a><span class="lineno"> 9274</span>&#160;</div><div class="line"><a name="l09275"></a><span class="lineno"> 9275</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l09276"></a><span class="lineno"> 9276</span>&#160;}</div><div class="line"><a name="l09277"></a><span class="lineno"> 9277</span>&#160;<span class="comment"></span></div><div class="line"><a name="l09278"></a><span class="lineno"> 9278</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09279"></a><span class="lineno"> 9279</span>&#160;<span class="comment"> * \brief Notify new alarm status.</span></div><div class="line"><a name="l09280"></a><span class="lineno"> 9280</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09281"></a><span class="lineno"> 9281</span>&#160;<span class="comment"> * \param p Channel private pointer.</span></div><div class="line"><a name="l09282"></a><span class="lineno"> 9282</span>&#160;<span class="comment"> * \param noalarm Non-zero if not in alarm mode.</span></div><div class="line"><a name="l09283"></a><span class="lineno"> 9283</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09284"></a><span class="lineno"> 9284</span>&#160;<span class="comment"> * \note Assumes the sig_pri_lock_private(p) is already obtained.</span></div><div class="line"><a name="l09285"></a><span class="lineno"> 9285</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09286"></a><span class="lineno"> 9286</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l09287"></a><span class="lineno"> 9287</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09288"></a><span class="lineno"> 9288</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aaabec1a9689f202696348b6473804e4f">sig_pri_chan_alarm_notify</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keywordtype">int</span> noalarm)</div><div class="line"><a name="l09289"></a><span class="lineno"> 9289</span>&#160;{</div><div class="line"><a name="l09290"></a><span class="lineno"> 9290</span>&#160;   pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l09291"></a><span class="lineno"> 9291</span>&#160;   <a class="code" href="../../d7/d6c/sig__pri_8h.html#aefda8988d1ad788713126dbeb4d002ec">sig_pri_set_alarm</a>(p, !noalarm);</div><div class="line"><a name="l09292"></a><span class="lineno"> 9292</span>&#160;   <span class="keywordflow">if</span> (!noalarm) {</div><div class="line"><a name="l09293"></a><span class="lineno"> 9293</span>&#160;      <span class="keywordflow">if</span> (pri_get_timer(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, PRI_TIMER_T309) &lt; 0) {</div><div class="line"><a name="l09294"></a><span class="lineno"> 9294</span>&#160;         <span class="comment">/* T309 is not enabled : destroy calls when alarm occurs */</span></div><div class="line"><a name="l09295"></a><span class="lineno"> 9295</span>&#160;         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>) {</div><div class="line"><a name="l09296"></a><span class="lineno"> 9296</span>&#160;            pri_destroycall(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>);</div><div class="line"><a name="l09297"></a><span class="lineno"> 9297</span>&#160;            p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l09298"></a><span class="lineno"> 9298</span>&#160;         }</div><div class="line"><a name="l09299"></a><span class="lineno"> 9299</span>&#160;         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)</div><div class="line"><a name="l09300"></a><span class="lineno"> 9300</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ab683c21c4a34450c4bfb8b672a7b4045">ast_channel_softhangup_internal_flag_add</a>(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>);</div><div class="line"><a name="l09301"></a><span class="lineno"> 9301</span>&#160;      }</div><div class="line"><a name="l09302"></a><span class="lineno"> 9302</span>&#160;   }</div><div class="line"><a name="l09303"></a><span class="lineno"> 9303</span>&#160;   sig_pri_span_devstate_changed(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l09304"></a><span class="lineno"> 9304</span>&#160;   pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l09305"></a><span class="lineno"> 9305</span>&#160;}</div><div class="line"><a name="l09306"></a><span class="lineno"> 9306</span>&#160;<span class="comment"></span></div><div class="line"><a name="l09307"></a><span class="lineno"> 9307</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09308"></a><span class="lineno"> 9308</span>&#160;<span class="comment"> * \brief Determine if layer 1 alarms are ignored.</span></div><div class="line"><a name="l09309"></a><span class="lineno"> 9309</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09310"></a><span class="lineno"> 9310</span>&#160;<span class="comment"> * \param p Channel private pointer.</span></div><div class="line"><a name="l09311"></a><span class="lineno"> 9311</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09312"></a><span class="lineno"> 9312</span>&#160;<span class="comment"> * \return TRUE if the alarm is ignored.</span></div><div class="line"><a name="l09313"></a><span class="lineno"> 9313</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09314"></a><span class="lineno"> 9314</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a4c8e5865974440593998fff35afa83d7">sig_pri_is_alarm_ignored</a>(<span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l09315"></a><span class="lineno"> 9315</span>&#160;{</div><div class="line"><a name="l09316"></a><span class="lineno"> 9316</span>&#160;   <span class="keywordflow">return</span> pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a8add65c8e545478ee9b9a7cf97012683">layer1_ignored</a>;</div><div class="line"><a name="l09317"></a><span class="lineno"> 9317</span>&#160;}</div><div class="line"><a name="l09318"></a><span class="lineno"> 9318</span>&#160;</div><div class="line"><a name="l09319"></a><span class="lineno"> 9319</span>&#160;<span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *<a class="code" href="../../d7/d6c/sig__pri_8h.html#ad8cb5b22c9cefdcd96297dc50836dc5a">sig_pri_chan_new</a>(<span class="keywordtype">void</span> *pvt_data, <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri, <span class="keywordtype">int</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>, <span class="keywordtype">int</span> channo, <span class="keywordtype">int</span> trunkgroup)</div><div class="line"><a name="l09320"></a><span class="lineno"> 9320</span>&#160;{</div><div class="line"><a name="l09321"></a><span class="lineno"> 9321</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p;</div><div class="line"><a name="l09322"></a><span class="lineno"> 9322</span>&#160;</div><div class="line"><a name="l09323"></a><span class="lineno"> 9323</span>&#160;   p = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*p));</div><div class="line"><a name="l09324"></a><span class="lineno"> 9324</span>&#160;   <span class="keywordflow">if</span> (!p)</div><div class="line"><a name="l09325"></a><span class="lineno"> 9325</span>&#160;      <span class="keywordflow">return</span> p;</div><div class="line"><a name="l09326"></a><span class="lineno"> 9326</span>&#160;</div><div class="line"><a name="l09327"></a><span class="lineno"> 9327</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a> = <a class="code" href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">logicalspan</a>;</div><div class="line"><a name="l09328"></a><span class="lineno"> 9328</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">prioffset</a> = channo;</div><div class="line"><a name="l09329"></a><span class="lineno"> 9329</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#acf6f33eb3b0b5cc3ffa093f595e8b7e7">mastertrunkgroup</a> = trunkgroup;</div><div class="line"><a name="l09330"></a><span class="lineno"> 9330</span>&#160;</div><div class="line"><a name="l09331"></a><span class="lineno"> 9331</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">chan_pvt</a> = pvt_data;</div><div class="line"><a name="l09332"></a><span class="lineno"> 9332</span>&#160;</div><div class="line"><a name="l09333"></a><span class="lineno"> 9333</span>&#160;   p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a> = <a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>;</div><div class="line"><a name="l09334"></a><span class="lineno"> 9334</span>&#160;</div><div class="line"><a name="l09335"></a><span class="lineno"> 9335</span>&#160;   <span class="keywordflow">return</span> p;</div><div class="line"><a name="l09336"></a><span class="lineno"> 9336</span>&#160;}</div><div class="line"><a name="l09337"></a><span class="lineno"> 9337</span>&#160;<span class="comment"></span></div><div class="line"><a name="l09338"></a><span class="lineno"> 9338</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09339"></a><span class="lineno"> 9339</span>&#160;<span class="comment"> * \brief Delete the sig_pri private channel structure.</span></div><div class="line"><a name="l09340"></a><span class="lineno"> 9340</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09341"></a><span class="lineno"> 9341</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09342"></a><span class="lineno"> 9342</span>&#160;<span class="comment"> * \param doomed sig_pri private channel structure to delete.</span></div><div class="line"><a name="l09343"></a><span class="lineno"> 9343</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09344"></a><span class="lineno"> 9344</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l09345"></a><span class="lineno"> 9345</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09346"></a><span class="lineno"> 9346</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#ad69ef058dd74d02cb40cf536d959dbc3">sig_pri_chan_delete</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *doomed)</div><div class="line"><a name="l09347"></a><span class="lineno"> 9347</span>&#160;{</div><div class="line"><a name="l09348"></a><span class="lineno"> 9348</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(doomed);</div><div class="line"><a name="l09349"></a><span class="lineno"> 9349</span>&#160;}</div><div class="line"><a name="l09350"></a><span class="lineno"> 9350</span>&#160;</div><div class="line"><a name="l09351"></a><span class="lineno"> 9351</span>&#160;<span class="preprocessor">#define SIG_PRI_SC_HEADER  &quot;%-4s %4s %-4s %-4s %-10s %-4s %s\n&quot;</span></div><div class="line"><a name="l09352"></a><span class="lineno"> 9352</span>&#160;<span class="preprocessor">#define SIG_PRI_SC_LINE     &quot;%4d %4d %-4s %-4s %-10s %-4s %s&quot;</span></div><div class="line"><a name="l09353"></a><span class="lineno"> 9353</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aefcf5347053f2bb03c5a6d16ae222a57">sig_pri_cli_show_channels_header</a>(<span class="keywordtype">int</span> fd)</div><div class="line"><a name="l09354"></a><span class="lineno"> 9354</span>&#160;{</div><div class="line"><a name="l09355"></a><span class="lineno"> 9355</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, SIG_PRI_SC_HEADER, <span class="stringliteral">&quot;PRI&quot;</span>,  <span class="stringliteral">&quot;&quot;</span>,     <span class="stringliteral">&quot;B&quot;</span>,    <span class="stringliteral">&quot;Chan&quot;</span>, <span class="stringliteral">&quot;Call&quot;</span>,  <span class="stringliteral">&quot;PRI&quot;</span>,  <span class="stringliteral">&quot;Channel&quot;</span>);</div><div class="line"><a name="l09356"></a><span class="lineno"> 9356</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, SIG_PRI_SC_HEADER, <span class="stringliteral">&quot;Span&quot;</span>, <span class="stringliteral">&quot;Chan&quot;</span>, <span class="stringliteral">&quot;Chan&quot;</span>, <span class="stringliteral">&quot;Idle&quot;</span>, <span class="stringliteral">&quot;Level&quot;</span>, <span class="stringliteral">&quot;Call&quot;</span>, <span class="stringliteral">&quot;Name&quot;</span>);</div><div class="line"><a name="l09357"></a><span class="lineno"> 9357</span>&#160;}</div><div class="line"><a name="l09358"></a><span class="lineno"> 9358</span>&#160;</div><div class="line"><a name="l09359"></a><span class="lineno"> 9359</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a58d3fa23e5b660576c24c3f497d029db">sig_pri_cli_show_channels</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l09360"></a><span class="lineno"> 9360</span>&#160;{</div><div class="line"><a name="l09361"></a><span class="lineno"> 9361</span>&#160;   <span class="keywordtype">char</span> line[256];</div><div class="line"><a name="l09362"></a><span class="lineno"> 9362</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l09363"></a><span class="lineno"> 9363</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt;</div><div class="line"><a name="l09364"></a><span class="lineno"> 9364</span>&#160;</div><div class="line"><a name="l09365"></a><span class="lineno"> 9365</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l09366"></a><span class="lineno"> 9366</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">numchans</a>; ++idx) {</div><div class="line"><a name="l09367"></a><span class="lineno"> 9367</span>&#160;      <span class="keywordflow">if</span> (!pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[idx]) {</div><div class="line"><a name="l09368"></a><span class="lineno"> 9368</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l09369"></a><span class="lineno"> 9369</span>&#160;      }</div><div class="line"><a name="l09370"></a><span class="lineno"> 9370</span>&#160;      pvt = pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">pvts</a>[idx];</div><div class="line"><a name="l09371"></a><span class="lineno"> 9371</span>&#160;      sig_pri_lock_private(pvt);</div><div class="line"><a name="l09372"></a><span class="lineno"> 9372</span>&#160;      sig_pri_lock_owner(pri, idx);</div><div class="line"><a name="l09373"></a><span class="lineno"> 9373</span>&#160;      <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a> &amp;&amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a03805c1c05301a1e86967ad671dec748">sig_pri_is_chan_available</a>(pvt)) {</div><div class="line"><a name="l09374"></a><span class="lineno"> 9374</span>&#160;         <span class="comment">/* Don&#39;t show held/call-waiting channels if they are not in use. */</span></div><div class="line"><a name="l09375"></a><span class="lineno"> 9375</span>&#160;         sig_pri_unlock_private(pvt);</div><div class="line"><a name="l09376"></a><span class="lineno"> 9376</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l09377"></a><span class="lineno"> 9377</span>&#160;      }</div><div class="line"><a name="l09378"></a><span class="lineno"> 9378</span>&#160;</div><div class="line"><a name="l09379"></a><span class="lineno"> 9379</span>&#160;      snprintf(line, <span class="keyword">sizeof</span>(line), SIG_PRI_SC_LINE,</div><div class="line"><a name="l09380"></a><span class="lineno"> 9380</span>&#160;         pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">span</a>,</div><div class="line"><a name="l09381"></a><span class="lineno"> 9381</span>&#160;         pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>,</div><div class="line"><a name="l09382"></a><span class="lineno"> 9382</span>&#160;         pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">no_b_channel</a> ? <span class="stringliteral">&quot;No&quot;</span> : <span class="stringliteral">&quot;Yes&quot;</span>,<span class="comment">/* Has media */</span></div><div class="line"><a name="l09383"></a><span class="lineno"> 9383</span>&#160;         <a class="code" href="../../d7/d6c/sig__pri_8h.html#a03805c1c05301a1e86967ad671dec748">sig_pri_is_chan_available</a>(pvt) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>,</div><div class="line"><a name="l09384"></a><span class="lineno"> 9384</span>&#160;         sig_pri_call_level2str(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">call_level</a>),</div><div class="line"><a name="l09385"></a><span class="lineno"> 9385</span>&#160;         pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a> ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>,</div><div class="line"><a name="l09386"></a><span class="lineno"> 9386</span>&#160;         pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l09387"></a><span class="lineno"> 9387</span>&#160;</div><div class="line"><a name="l09388"></a><span class="lineno"> 9388</span>&#160;      <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l09389"></a><span class="lineno"> 9389</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(pvt-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);</div><div class="line"><a name="l09390"></a><span class="lineno"> 9390</span>&#160;      }</div><div class="line"><a name="l09391"></a><span class="lineno"> 9391</span>&#160;      sig_pri_unlock_private(pvt);</div><div class="line"><a name="l09392"></a><span class="lineno"> 9392</span>&#160;</div><div class="line"><a name="l09393"></a><span class="lineno"> 9393</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l09394"></a><span class="lineno"> 9394</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s\n&quot;</span>, line);</div><div class="line"><a name="l09395"></a><span class="lineno"> 9395</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l09396"></a><span class="lineno"> 9396</span>&#160;   }</div><div class="line"><a name="l09397"></a><span class="lineno"> 9397</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l09398"></a><span class="lineno"> 9398</span>&#160;}</div><div class="line"><a name="l09399"></a><span class="lineno"> 9399</span>&#160;</div><div class="line"><a name="l09400"></a><span class="lineno"> 9400</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dfd/isdn__msg__parser_8c.html#a139bfa19a96fc46c46a86ca405ec630d">build_status</a>(<span class="keywordtype">char</span> *s, <span class="keywordtype">size_t</span> len, <span class="keywordtype">int</span> <a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>, <span class="keywordtype">int</span> active)</div><div class="line"><a name="l09401"></a><span class="lineno"> 9401</span>&#160;{</div><div class="line"><a name="l09402"></a><span class="lineno"> 9402</span>&#160;   <span class="keywordflow">if</span> (!s || len &lt; 1) {</div><div class="line"><a name="l09403"></a><span class="lineno"> 9403</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l09404"></a><span class="lineno"> 9404</span>&#160;   }</div><div class="line"><a name="l09405"></a><span class="lineno"> 9405</span>&#160;   snprintf(s, len, <span class="stringliteral">&quot;%s%s, %s&quot;</span>,</div><div class="line"><a name="l09406"></a><span class="lineno"> 9406</span>&#160;      (status &amp; DCHAN_NOTINALARM) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;In Alarm, &quot;</span>,</div><div class="line"><a name="l09407"></a><span class="lineno"> 9407</span>&#160;      (status &amp; DCHAN_UP) ? <span class="stringliteral">&quot;Up&quot;</span> : <span class="stringliteral">&quot;Down&quot;</span>,</div><div class="line"><a name="l09408"></a><span class="lineno"> 9408</span>&#160;      (active) ? <span class="stringliteral">&quot;Active&quot;</span> : <span class="stringliteral">&quot;Standby&quot;</span>);</div><div class="line"><a name="l09409"></a><span class="lineno"> 9409</span>&#160;}</div><div class="line"><a name="l09410"></a><span class="lineno"> 9410</span>&#160;</div><div class="line"><a name="l09411"></a><span class="lineno"> 9411</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a76debc5bbce46bf2abe47ebfee97b341">sig_pri_cli_show_spans</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> span, <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l09412"></a><span class="lineno"> 9412</span>&#160;{</div><div class="line"><a name="l09413"></a><span class="lineno"> 9413</span>&#160;   <span class="keywordtype">char</span> status[256];</div><div class="line"><a name="l09414"></a><span class="lineno"> 9414</span>&#160;   <span class="keywordtype">int</span> x;</div><div class="line"><a name="l09415"></a><span class="lineno"> 9415</span>&#160;   <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; x++) {</div><div class="line"><a name="l09416"></a><span class="lineno"> 9416</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[x]) {</div><div class="line"><a name="l09417"></a><span class="lineno"> 9417</span>&#160;         <a class="code" href="../../de/dfd/isdn__msg__parser_8c.html#a139bfa19a96fc46c46a86ca405ec630d">build_status</a>(status, <span class="keyword">sizeof</span>(status), pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">dchanavail</a>[x], pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[x] == pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>);</div><div class="line"><a name="l09418"></a><span class="lineno"> 9418</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;PRI span %d/%d: %s\n&quot;</span>, span, x, status);</div><div class="line"><a name="l09419"></a><span class="lineno"> 9419</span>&#160;      }</div><div class="line"><a name="l09420"></a><span class="lineno"> 9420</span>&#160;   }</div><div class="line"><a name="l09421"></a><span class="lineno"> 9421</span>&#160;}</div><div class="line"><a name="l09422"></a><span class="lineno"> 9422</span>&#160;</div><div class="line"><a name="l09423"></a><span class="lineno"> 9423</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#ad5fe88d754393d4c6095d812cf813cf9">sig_pri_cli_show_span</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> *dchannels, <span class="keyword">struct</span> <a class="code" href="../../df/db1/structsig__pri__span.html">sig_pri_span</a> *pri)</div><div class="line"><a name="l09424"></a><span class="lineno"> 9424</span>&#160;{</div><div class="line"><a name="l09425"></a><span class="lineno"> 9425</span>&#160;   <span class="keywordtype">int</span> x;</div><div class="line"><a name="l09426"></a><span class="lineno"> 9426</span>&#160;   <span class="keywordtype">char</span> status[256];</div><div class="line"><a name="l09427"></a><span class="lineno"> 9427</span>&#160;</div><div class="line"><a name="l09428"></a><span class="lineno"> 9428</span>&#160;   <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a>; x++) {</div><div class="line"><a name="l09429"></a><span class="lineno"> 9429</span>&#160;      <span class="keywordflow">if</span> (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[x]) {</div><div class="line"><a name="l09430"></a><span class="lineno"> 9430</span>&#160;<span class="preprocessor">#ifdef PRI_DUMP_INFO_STR</span></div><div class="line"><a name="l09431"></a><span class="lineno"> 9431</span>&#160;         <span class="keywordtype">char</span> *info_str = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l09432"></a><span class="lineno"> 9432</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l09433"></a><span class="lineno"> 9433</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s D-channel: %d\n&quot;</span>, pri_order(x), dchannels[x]);</div><div class="line"><a name="l09434"></a><span class="lineno"> 9434</span>&#160;         <a class="code" href="../../de/dfd/isdn__msg__parser_8c.html#a139bfa19a96fc46c46a86ca405ec630d">build_status</a>(status, <span class="keyword">sizeof</span>(status), pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">dchanavail</a>[x], pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">dchans</a>[x] == pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>);</div><div class="line"><a name="l09435"></a><span class="lineno"> 9435</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Status: %s\n&quot;</span>, status);</div><div class="line"><a name="l09436"></a><span class="lineno"> 9436</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l09437"></a><span class="lineno"> 9437</span>&#160;<span class="preprocessor">#ifdef PRI_DUMP_INFO_STR</span></div><div class="line"><a name="l09438"></a><span class="lineno"> 9438</span>&#160;         info_str = pri_dump_info_str(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>);</div><div class="line"><a name="l09439"></a><span class="lineno"> 9439</span>&#160;         <span class="keywordflow">if</span> (info_str) {</div><div class="line"><a name="l09440"></a><span class="lineno"> 9440</span>&#160;            <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s&quot;</span>, info_str);</div><div class="line"><a name="l09441"></a><span class="lineno"> 9441</span>&#160;            <a class="code" href="../../d8/d8a/astmm_8h.html#a1b7699f7e51f653f1032daa2df2319cd">ast_std_free</a>(info_str);</div><div class="line"><a name="l09442"></a><span class="lineno"> 9442</span>&#160;         }</div><div class="line"><a name="l09443"></a><span class="lineno"> 9443</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l09444"></a><span class="lineno"> 9444</span>&#160;         pri_dump_info(pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>);</div><div class="line"><a name="l09445"></a><span class="lineno"> 9445</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l09446"></a><span class="lineno"> 9446</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l09447"></a><span class="lineno"> 9447</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Overlap Recv: %s\n\n&quot;</span>, (pri-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">overlapdial</a> &amp; <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>)?<span class="stringliteral">&quot;Yes&quot;</span>:<span class="stringliteral">&quot;No&quot;</span>);</div><div class="line"><a name="l09448"></a><span class="lineno"> 9448</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l09449"></a><span class="lineno"> 9449</span>&#160;      }</div><div class="line"><a name="l09450"></a><span class="lineno"> 9450</span>&#160;   }</div><div class="line"><a name="l09451"></a><span class="lineno"> 9451</span>&#160;}</div><div class="line"><a name="l09452"></a><span class="lineno"> 9452</span>&#160;</div><div class="line"><a name="l09453"></a><span class="lineno"> 9453</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#afcdccfdff4540316777dbfbc930d4c28">pri_send_keypad_facility_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *digits)</div><div class="line"><a name="l09454"></a><span class="lineno"> 9454</span>&#160;{</div><div class="line"><a name="l09455"></a><span class="lineno"> 9455</span>&#160;   sig_pri_lock_private(p);</div><div class="line"><a name="l09456"></a><span class="lineno"> 9456</span>&#160;</div><div class="line"><a name="l09457"></a><span class="lineno"> 9457</span>&#160;   <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a> || !p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>) {</div><div class="line"><a name="l09458"></a><span class="lineno"> 9458</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to find pri or call on channel!\n&quot;</span>);</div><div class="line"><a name="l09459"></a><span class="lineno"> 9459</span>&#160;      sig_pri_unlock_private(p);</div><div class="line"><a name="l09460"></a><span class="lineno"> 9460</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l09461"></a><span class="lineno"> 9461</span>&#160;   }</div><div class="line"><a name="l09462"></a><span class="lineno"> 9462</span>&#160;</div><div class="line"><a name="l09463"></a><span class="lineno"> 9463</span>&#160;   pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l09464"></a><span class="lineno"> 9464</span>&#160;   pri_keypad_facility(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, digits);</div><div class="line"><a name="l09465"></a><span class="lineno"> 9465</span>&#160;   pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l09466"></a><span class="lineno"> 9466</span>&#160;</div><div class="line"><a name="l09467"></a><span class="lineno"> 9467</span>&#160;   sig_pri_unlock_private(p);</div><div class="line"><a name="l09468"></a><span class="lineno"> 9468</span>&#160;</div><div class="line"><a name="l09469"></a><span class="lineno"> 9469</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l09470"></a><span class="lineno"> 9470</span>&#160;}</div><div class="line"><a name="l09471"></a><span class="lineno"> 9471</span>&#160;</div><div class="line"><a name="l09472"></a><span class="lineno"> 9472</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0a2447a4cf8a5af504d4a006ebaf1b75">pri_send_callrerouting_facility_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">enum</span> <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a> chanstate, <span class="keyword">const</span> <span class="keywordtype">char</span> *destination, <span class="keyword">const</span> <span class="keywordtype">char</span> *original, <span class="keyword">const</span> <span class="keywordtype">char</span> *reason)</div><div class="line"><a name="l09473"></a><span class="lineno"> 9473</span>&#160;{</div><div class="line"><a name="l09474"></a><span class="lineno"> 9474</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l09475"></a><span class="lineno"> 9475</span>&#160;</div><div class="line"><a name="l09476"></a><span class="lineno"> 9476</span>&#160;   sig_pri_lock_private(p);</div><div class="line"><a name="l09477"></a><span class="lineno"> 9477</span>&#160;</div><div class="line"><a name="l09478"></a><span class="lineno"> 9478</span>&#160;   <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a> || !p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>) {</div><div class="line"><a name="l09479"></a><span class="lineno"> 9479</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to find pri or call on channel!\n&quot;</span>);</div><div class="line"><a name="l09480"></a><span class="lineno"> 9480</span>&#160;      sig_pri_unlock_private(p);</div><div class="line"><a name="l09481"></a><span class="lineno"> 9481</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l09482"></a><span class="lineno"> 9482</span>&#160;   }</div><div class="line"><a name="l09483"></a><span class="lineno"> 9483</span>&#160;</div><div class="line"><a name="l09484"></a><span class="lineno"> 9484</span>&#160;   pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l09485"></a><span class="lineno"> 9485</span>&#160;   res = pri_callrerouting_facility(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, destination, original, reason);</div><div class="line"><a name="l09486"></a><span class="lineno"> 9486</span>&#160;   pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l09487"></a><span class="lineno"> 9487</span>&#160;</div><div class="line"><a name="l09488"></a><span class="lineno"> 9488</span>&#160;   sig_pri_unlock_private(p);</div><div class="line"><a name="l09489"></a><span class="lineno"> 9489</span>&#160;</div><div class="line"><a name="l09490"></a><span class="lineno"> 9490</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l09491"></a><span class="lineno"> 9491</span>&#160;}</div><div class="line"><a name="l09492"></a><span class="lineno"> 9492</span>&#160;</div><div class="line"><a name="l09493"></a><span class="lineno"> 9493</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_SERVICE_MESSAGES)</span></div><div class="line"><a name="l09494"></a><span class="lineno"> 9494</span>&#160;<span class="keywordtype">int</span> pri_maintenance_bservice(<span class="keyword">struct</span> pri *pri, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keywordtype">int</span> changestatus)</div><div class="line"><a name="l09495"></a><span class="lineno"> 9495</span>&#160;{</div><div class="line"><a name="l09496"></a><span class="lineno"> 9496</span>&#160;   <span class="keywordtype">int</span> channel = PVT_TO_CHANNEL(p);</div><div class="line"><a name="l09497"></a><span class="lineno"> 9497</span>&#160;   <span class="keywordtype">int</span> span = PRI_SPAN(channel);</div><div class="line"><a name="l09498"></a><span class="lineno"> 9498</span>&#160;</div><div class="line"><a name="l09499"></a><span class="lineno"> 9499</span>&#160;   <span class="keywordflow">return</span> pri_maintenance_service(pri, span, channel, changestatus);</div><div class="line"><a name="l09500"></a><span class="lineno"> 9500</span>&#160;}</div><div class="line"><a name="l09501"></a><span class="lineno"> 9501</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_SERVICE_MESSAGES) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09502"></a><span class="lineno"> 9502</span>&#160;</div><div class="line"><a name="l09503"></a><span class="lineno"> 9503</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#abd93953b68d33c35320c5d4eeb991ea3">sig_pri_fixup</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *oldchan, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *newchan, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pchan)</div><div class="line"><a name="l09504"></a><span class="lineno"> 9504</span>&#160;{</div><div class="line"><a name="l09505"></a><span class="lineno"> 9505</span>&#160;   <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == oldchan) {</div><div class="line"><a name="l09506"></a><span class="lineno"> 9506</span>&#160;      pchan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = newchan;</div><div class="line"><a name="l09507"></a><span class="lineno"> 9507</span>&#160;   }</div><div class="line"><a name="l09508"></a><span class="lineno"> 9508</span>&#160;}</div><div class="line"><a name="l09509"></a><span class="lineno"> 9509</span>&#160;</div><div class="line"><a name="l09510"></a><span class="lineno"> 9510</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_DISPLAY_TEXT)</span></div><div class="line"><a name="l09511"></a><span class="lineno"> 9511</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09512"></a><span class="lineno"> 9512</span>&#160;<span class="comment"> * \brief Send display text.</span></div><div class="line"><a name="l09513"></a><span class="lineno"> 9513</span>&#160;<span class="comment"> * \since 10.0</span></div><div class="line"><a name="l09514"></a><span class="lineno"> 9514</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09515"></a><span class="lineno"> 9515</span>&#160;<span class="comment"> * \param p Channel to send text over</span></div><div class="line"><a name="l09516"></a><span class="lineno"> 9516</span>&#160;<span class="comment"> * \param text Text to send.</span></div><div class="line"><a name="l09517"></a><span class="lineno"> 9517</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09518"></a><span class="lineno"> 9518</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l09519"></a><span class="lineno"> 9519</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09520"></a><span class="lineno"> 9520</span>&#160;<span class="keywordtype">void</span> sig_pri_sendtext(<span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/dfb/app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>)</div><div class="line"><a name="l09521"></a><span class="lineno"> 9521</span>&#160;{</div><div class="line"><a name="l09522"></a><span class="lineno"> 9522</span>&#160;   <span class="keyword">struct </span>pri_subcmd_display_txt display;</div><div class="line"><a name="l09523"></a><span class="lineno"> 9523</span>&#160;</div><div class="line"><a name="l09524"></a><span class="lineno"> 9524</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a> &amp;&amp; p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>) {</div><div class="line"><a name="l09525"></a><span class="lineno"> 9525</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(display.text, text, <span class="keyword">sizeof</span>(display.text));</div><div class="line"><a name="l09526"></a><span class="lineno"> 9526</span>&#160;      display.length = strlen(display.text);</div><div class="line"><a name="l09527"></a><span class="lineno"> 9527</span>&#160;      display.char_set = 0;<span class="comment">/* unknown(0) */</span></div><div class="line"><a name="l09528"></a><span class="lineno"> 9528</span>&#160;      pri_grab(p, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l09529"></a><span class="lineno"> 9529</span>&#160;      pri_display_text(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>, &amp;display);</div><div class="line"><a name="l09530"></a><span class="lineno"> 9530</span>&#160;      pri_rel(p-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>);</div><div class="line"><a name="l09531"></a><span class="lineno"> 9531</span>&#160;   }</div><div class="line"><a name="l09532"></a><span class="lineno"> 9532</span>&#160;}</div><div class="line"><a name="l09533"></a><span class="lineno"> 9533</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_DISPLAY_TEXT) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09534"></a><span class="lineno"> 9534</span>&#160;</div><div class="line"><a name="l09535"></a><span class="lineno"> 9535</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09536"></a><span class="lineno"> 9536</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09537"></a><span class="lineno"> 9537</span>&#160;<span class="comment"> * \brief PRI CC agent initialization.</span></div><div class="line"><a name="l09538"></a><span class="lineno"> 9538</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09539"></a><span class="lineno"> 9539</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09540"></a><span class="lineno"> 9540</span>&#160;<span class="comment"> * \param agent CC core agent control.</span></div><div class="line"><a name="l09541"></a><span class="lineno"> 9541</span>&#160;<span class="comment"> * \param pvt_chan Original channel the agent will attempt to recall.</span></div><div class="line"><a name="l09542"></a><span class="lineno"> 9542</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09543"></a><span class="lineno"> 9543</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09544"></a><span class="lineno"> 9544</span>&#160;<span class="comment"> * This callback is called when the CC core is initialized.  Agents should allocate</span></div><div class="line"><a name="l09545"></a><span class="lineno"> 9545</span>&#160;<span class="comment"> * any private data necessary for the call and assign it to the private_data</span></div><div class="line"><a name="l09546"></a><span class="lineno"> 9546</span>&#160;<span class="comment"> * on the agent.  Additionally, if any ast_cc_agent_flags are pertinent to the</span></div><div class="line"><a name="l09547"></a><span class="lineno"> 9547</span>&#160;<span class="comment"> * specific agent type, they should be set in this function as well.</span></div><div class="line"><a name="l09548"></a><span class="lineno"> 9548</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09549"></a><span class="lineno"> 9549</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l09550"></a><span class="lineno"> 9550</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l09551"></a><span class="lineno"> 9551</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09552"></a><span class="lineno"> 9552</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aa9345e8f9251db64f8ce82593ce40677">sig_pri_cc_agent_init</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent, <span class="keyword">struct</span> <a class="code" href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a> *pvt_chan)</div><div class="line"><a name="l09553"></a><span class="lineno"> 9553</span>&#160;{</div><div class="line"><a name="l09554"></a><span class="lineno"> 9554</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_agent_prv *cc_pvt;</div><div class="line"><a name="l09555"></a><span class="lineno"> 9555</span>&#160;</div><div class="line"><a name="l09556"></a><span class="lineno"> 9556</span>&#160;   cc_pvt = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*cc_pvt));</div><div class="line"><a name="l09557"></a><span class="lineno"> 9557</span>&#160;   <span class="keywordflow">if</span> (!cc_pvt) {</div><div class="line"><a name="l09558"></a><span class="lineno"> 9558</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l09559"></a><span class="lineno"> 9559</span>&#160;   }</div><div class="line"><a name="l09560"></a><span class="lineno"> 9560</span>&#160;</div><div class="line"><a name="l09561"></a><span class="lineno"> 9561</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;pvt_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l09562"></a><span class="lineno"> 9562</span>&#160;   cc_pvt-&gt;pri = pvt_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>;</div><div class="line"><a name="l09563"></a><span class="lineno"> 9563</span>&#160;   cc_pvt-&gt;cc_id = pri_cc_available(pvt_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">pri</a>, pvt_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">call</a>);</div><div class="line"><a name="l09564"></a><span class="lineno"> 9564</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;pvt_chan-&gt;<a class="code" href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">pri</a>-&gt;<a class="code" href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l09565"></a><span class="lineno"> 9565</span>&#160;   <span class="keywordflow">if</span> (cc_pvt-&gt;cc_id == -1) {</div><div class="line"><a name="l09566"></a><span class="lineno"> 9566</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cc_pvt);</div><div class="line"><a name="l09567"></a><span class="lineno"> 9567</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l09568"></a><span class="lineno"> 9568</span>&#160;   }</div><div class="line"><a name="l09569"></a><span class="lineno"> 9569</span>&#160;   agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#ad517770dac2061381b2008850ff12e6c">private_data</a> = cc_pvt;</div><div class="line"><a name="l09570"></a><span class="lineno"> 9570</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l09571"></a><span class="lineno"> 9571</span>&#160;}</div><div class="line"><a name="l09572"></a><span class="lineno"> 9572</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09573"></a><span class="lineno"> 9573</span>&#160;</div><div class="line"><a name="l09574"></a><span class="lineno"> 9574</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09575"></a><span class="lineno"> 9575</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09576"></a><span class="lineno"> 9576</span>&#160;<span class="comment"> * \brief Start the offer timer.</span></div><div class="line"><a name="l09577"></a><span class="lineno"> 9577</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09578"></a><span class="lineno"> 9578</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09579"></a><span class="lineno"> 9579</span>&#160;<span class="comment"> * \param agent CC core agent control.</span></div><div class="line"><a name="l09580"></a><span class="lineno"> 9580</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09581"></a><span class="lineno"> 9581</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09582"></a><span class="lineno"> 9582</span>&#160;<span class="comment"> * This is called by the core when the caller hangs up after</span></div><div class="line"><a name="l09583"></a><span class="lineno"> 9583</span>&#160;<span class="comment"> * a call for which CC may be requested. The agent should</span></div><div class="line"><a name="l09584"></a><span class="lineno"> 9584</span>&#160;<span class="comment"> * begin the timer as configured.</span></div><div class="line"><a name="l09585"></a><span class="lineno"> 9585</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09586"></a><span class="lineno"> 9586</span>&#160;<span class="comment"> * The primary reason why this functionality is left to</span></div><div class="line"><a name="l09587"></a><span class="lineno"> 9587</span>&#160;<span class="comment"> * the specific agent implementations is due to the differing</span></div><div class="line"><a name="l09588"></a><span class="lineno"> 9588</span>&#160;<span class="comment"> * use of schedulers throughout the code. Some channel drivers</span></div><div class="line"><a name="l09589"></a><span class="lineno"> 9589</span>&#160;<span class="comment"> * may already have a scheduler context they wish to use, and</span></div><div class="line"><a name="l09590"></a><span class="lineno"> 9590</span>&#160;<span class="comment"> * amongst those, some may use the ast_sched API while others</span></div><div class="line"><a name="l09591"></a><span class="lineno"> 9591</span>&#160;<span class="comment"> * may use the ast_sched_thread API, which are incompatible.</span></div><div class="line"><a name="l09592"></a><span class="lineno"> 9592</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09593"></a><span class="lineno"> 9593</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l09594"></a><span class="lineno"> 9594</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l09595"></a><span class="lineno"> 9595</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09596"></a><span class="lineno"> 9596</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a36ca3adf0a7157210b997c3b42e3b77e">sig_pri_cc_agent_start_offer_timer</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent)</div><div class="line"><a name="l09597"></a><span class="lineno"> 9597</span>&#160;{</div><div class="line"><a name="l09598"></a><span class="lineno"> 9598</span>&#160;   <span class="comment">/* libpri maintains it&#39;s own offer timer in the form of T_RETENTION. */</span></div><div class="line"><a name="l09599"></a><span class="lineno"> 9599</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l09600"></a><span class="lineno"> 9600</span>&#160;}</div><div class="line"><a name="l09601"></a><span class="lineno"> 9601</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09602"></a><span class="lineno"> 9602</span>&#160;</div><div class="line"><a name="l09603"></a><span class="lineno"> 9603</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09604"></a><span class="lineno"> 9604</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09605"></a><span class="lineno"> 9605</span>&#160;<span class="comment"> * \brief Stop the offer timer.</span></div><div class="line"><a name="l09606"></a><span class="lineno"> 9606</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09607"></a><span class="lineno"> 9607</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09608"></a><span class="lineno"> 9608</span>&#160;<span class="comment"> * \param agent CC core agent control.</span></div><div class="line"><a name="l09609"></a><span class="lineno"> 9609</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09610"></a><span class="lineno"> 9610</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09611"></a><span class="lineno"> 9611</span>&#160;<span class="comment"> * This callback is called by the CC core when the caller</span></div><div class="line"><a name="l09612"></a><span class="lineno"> 9612</span>&#160;<span class="comment"> * has requested CC.</span></div><div class="line"><a name="l09613"></a><span class="lineno"> 9613</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09614"></a><span class="lineno"> 9614</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l09615"></a><span class="lineno"> 9615</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l09616"></a><span class="lineno"> 9616</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09617"></a><span class="lineno"> 9617</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aeca5e12f49bcbeceadba0ccff253a527">sig_pri_cc_agent_stop_offer_timer</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent)</div><div class="line"><a name="l09618"></a><span class="lineno"> 9618</span>&#160;{</div><div class="line"><a name="l09619"></a><span class="lineno"> 9619</span>&#160;   <span class="comment">/* libpri maintains it&#39;s own offer timer in the form of T_RETENTION. */</span></div><div class="line"><a name="l09620"></a><span class="lineno"> 9620</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l09621"></a><span class="lineno"> 9621</span>&#160;}</div><div class="line"><a name="l09622"></a><span class="lineno"> 9622</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09623"></a><span class="lineno"> 9623</span>&#160;</div><div class="line"><a name="l09624"></a><span class="lineno"> 9624</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09625"></a><span class="lineno"> 9625</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09626"></a><span class="lineno"> 9626</span>&#160;<span class="comment"> * \brief Response to a CC request.</span></div><div class="line"><a name="l09627"></a><span class="lineno"> 9627</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09628"></a><span class="lineno"> 9628</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09629"></a><span class="lineno"> 9629</span>&#160;<span class="comment"> * \param agent CC core agent control.</span></div><div class="line"><a name="l09630"></a><span class="lineno"> 9630</span>&#160;<span class="comment"> * \param reason CC request response status.</span></div><div class="line"><a name="l09631"></a><span class="lineno"> 9631</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09632"></a><span class="lineno"> 9632</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09633"></a><span class="lineno"> 9633</span>&#160;<span class="comment"> * When the core receives knowledge that a called</span></div><div class="line"><a name="l09634"></a><span class="lineno"> 9634</span>&#160;<span class="comment"> * party has accepted a CC request, it will call</span></div><div class="line"><a name="l09635"></a><span class="lineno"> 9635</span>&#160;<span class="comment"> * this callback.  The core may also call this</span></div><div class="line"><a name="l09636"></a><span class="lineno"> 9636</span>&#160;<span class="comment"> * if there is some error when attempting to process</span></div><div class="line"><a name="l09637"></a><span class="lineno"> 9637</span>&#160;<span class="comment"> * the incoming CC request.</span></div><div class="line"><a name="l09638"></a><span class="lineno"> 9638</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09639"></a><span class="lineno"> 9639</span>&#160;<span class="comment"> * The duty of this is to issue a propper response to a</span></div><div class="line"><a name="l09640"></a><span class="lineno"> 9640</span>&#160;<span class="comment"> * CC request from the caller by acknowledging receipt</span></div><div class="line"><a name="l09641"></a><span class="lineno"> 9641</span>&#160;<span class="comment"> * of that request or rejecting it.</span></div><div class="line"><a name="l09642"></a><span class="lineno"> 9642</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09643"></a><span class="lineno"> 9643</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l09644"></a><span class="lineno"> 9644</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09645"></a><span class="lineno"> 9645</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5d91ced5d12d3dece11e38106bcfc827">sig_pri_cc_agent_req_rsp</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent, <span class="keyword">enum</span> <a class="code" href="../../de/dc8/ccss_8h.html#a4dc7abb083c6d920fc6ed652f1b3e40f">ast_cc_agent_response_reason</a> reason)</div><div class="line"><a name="l09646"></a><span class="lineno"> 9646</span>&#160;{</div><div class="line"><a name="l09647"></a><span class="lineno"> 9647</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_agent_prv *cc_pvt;</div><div class="line"><a name="l09648"></a><span class="lineno"> 9648</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l09649"></a><span class="lineno"> 9649</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;</div><div class="line"><a name="l09650"></a><span class="lineno"> 9650</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *failed_msg;</div><div class="line"><a name="l09651"></a><span class="lineno"> 9651</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *failed_to_send = <span class="stringliteral">&quot;Failed to send the CC request response.&quot;</span>;</div><div class="line"><a name="l09652"></a><span class="lineno"> 9652</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *not_accepted = <span class="stringliteral">&quot;The core declined the CC request.&quot;</span>;</div><div class="line"><a name="l09653"></a><span class="lineno"> 9653</span>&#160;</div><div class="line"><a name="l09654"></a><span class="lineno"> 9654</span>&#160;   cc_pvt = agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l09655"></a><span class="lineno"> 9655</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09656"></a><span class="lineno"> 9656</span>&#160;   <span class="keywordflow">if</span> (cc_pvt-&gt;cc_request_response_pending) {</div><div class="line"><a name="l09657"></a><span class="lineno"> 9657</span>&#160;      cc_pvt-&gt;cc_request_response_pending = 0;</div><div class="line"><a name="l09658"></a><span class="lineno"> 9658</span>&#160;</div><div class="line"><a name="l09659"></a><span class="lineno"> 9659</span>&#160;      <span class="comment">/* Convert core response reason to ISDN response status. */</span></div><div class="line"><a name="l09660"></a><span class="lineno"> 9660</span>&#160;      status = 2;<span class="comment">/* short_term_denial */</span></div><div class="line"><a name="l09661"></a><span class="lineno"> 9661</span>&#160;      <span class="keywordflow">switch</span> (reason) {</div><div class="line"><a name="l09662"></a><span class="lineno"> 9662</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a4dc7abb083c6d920fc6ed652f1b3e40fa2c35ce5050e874998baefd43036f10f4">AST_CC_AGENT_RESPONSE_SUCCESS</a>:</div><div class="line"><a name="l09663"></a><span class="lineno"> 9663</span>&#160;         status = 0;<span class="comment">/* success */</span></div><div class="line"><a name="l09664"></a><span class="lineno"> 9664</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l09665"></a><span class="lineno"> 9665</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a4dc7abb083c6d920fc6ed652f1b3e40fa1f46b662ae0b626724d2c8d90143c93a">AST_CC_AGENT_RESPONSE_FAILURE_INVALID</a>:</div><div class="line"><a name="l09666"></a><span class="lineno"> 9666</span>&#160;         status = 2;<span class="comment">/* short_term_denial */</span></div><div class="line"><a name="l09667"></a><span class="lineno"> 9667</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l09668"></a><span class="lineno"> 9668</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a4dc7abb083c6d920fc6ed652f1b3e40fafd230e8ed54f4d0d5158d571eeb57e3c">AST_CC_AGENT_RESPONSE_FAILURE_TOO_MANY</a>:</div><div class="line"><a name="l09669"></a><span class="lineno"> 9669</span>&#160;         status = 5;<span class="comment">/* queue_full */</span></div><div class="line"><a name="l09670"></a><span class="lineno"> 9670</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l09671"></a><span class="lineno"> 9671</span>&#160;      }</div><div class="line"><a name="l09672"></a><span class="lineno"> 9672</span>&#160;</div><div class="line"><a name="l09673"></a><span class="lineno"> 9673</span>&#160;      res = pri_cc_req_rsp(cc_pvt-&gt;pri-&gt;pri, cc_pvt-&gt;cc_id, status);</div><div class="line"><a name="l09674"></a><span class="lineno"> 9674</span>&#160;      <span class="keywordflow">if</span> (!status) {</div><div class="line"><a name="l09675"></a><span class="lineno"> 9675</span>&#160;         <span class="comment">/* CC core request was accepted. */</span></div><div class="line"><a name="l09676"></a><span class="lineno"> 9676</span>&#160;         <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l09677"></a><span class="lineno"> 9677</span>&#160;            failed_msg = failed_to_send;</div><div class="line"><a name="l09678"></a><span class="lineno"> 9678</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l09679"></a><span class="lineno"> 9679</span>&#160;            failed_msg = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l09680"></a><span class="lineno"> 9680</span>&#160;         }</div><div class="line"><a name="l09681"></a><span class="lineno"> 9681</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l09682"></a><span class="lineno"> 9682</span>&#160;         <span class="comment">/* CC core request was declined. */</span></div><div class="line"><a name="l09683"></a><span class="lineno"> 9683</span>&#160;         <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l09684"></a><span class="lineno"> 9684</span>&#160;            failed_msg = failed_to_send;</div><div class="line"><a name="l09685"></a><span class="lineno"> 9685</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l09686"></a><span class="lineno"> 9686</span>&#160;            failed_msg = not_accepted;</div><div class="line"><a name="l09687"></a><span class="lineno"> 9687</span>&#160;         }</div><div class="line"><a name="l09688"></a><span class="lineno"> 9688</span>&#160;      }</div><div class="line"><a name="l09689"></a><span class="lineno"> 9689</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l09690"></a><span class="lineno"> 9690</span>&#160;      failed_msg = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l09691"></a><span class="lineno"> 9691</span>&#160;   }</div><div class="line"><a name="l09692"></a><span class="lineno"> 9692</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09693"></a><span class="lineno"> 9693</span>&#160;   <span class="keywordflow">if</span> (failed_msg) {</div><div class="line"><a name="l09694"></a><span class="lineno"> 9694</span>&#160;      <a class="code" href="../../de/dc8/ccss_8h.html#ad25ea527a36ed77fcba9eb1eba0b4186">ast_cc_failed</a>(agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#a48e5b8fb1ab4916549247ea116b8f5b9">core_id</a>, <span class="stringliteral">&quot;%s agent: %s&quot;</span>, sig_pri_cc_type_name, failed_msg);</div><div class="line"><a name="l09695"></a><span class="lineno"> 9695</span>&#160;   }</div><div class="line"><a name="l09696"></a><span class="lineno"> 9696</span>&#160;}</div><div class="line"><a name="l09697"></a><span class="lineno"> 9697</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09698"></a><span class="lineno"> 9698</span>&#160;</div><div class="line"><a name="l09699"></a><span class="lineno"> 9699</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09700"></a><span class="lineno"> 9700</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09701"></a><span class="lineno"> 9701</span>&#160;<span class="comment"> * \brief Request the status of the agent&#39;s device.</span></div><div class="line"><a name="l09702"></a><span class="lineno"> 9702</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09703"></a><span class="lineno"> 9703</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09704"></a><span class="lineno"> 9704</span>&#160;<span class="comment"> * \param agent CC core agent control.</span></div><div class="line"><a name="l09705"></a><span class="lineno"> 9705</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09706"></a><span class="lineno"> 9706</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09707"></a><span class="lineno"> 9707</span>&#160;<span class="comment"> * Asynchronous request for the status of any caller</span></div><div class="line"><a name="l09708"></a><span class="lineno"> 9708</span>&#160;<span class="comment"> * which may be a valid caller for the CC transaction.</span></div><div class="line"><a name="l09709"></a><span class="lineno"> 9709</span>&#160;<span class="comment"> * Status responses should be made using the</span></div><div class="line"><a name="l09710"></a><span class="lineno"> 9710</span>&#160;<span class="comment"> * ast_cc_status_response function.</span></div><div class="line"><a name="l09711"></a><span class="lineno"> 9711</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09712"></a><span class="lineno"> 9712</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l09713"></a><span class="lineno"> 9713</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l09714"></a><span class="lineno"> 9714</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09715"></a><span class="lineno"> 9715</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a0d00c58c39ee81f43bdeef1081ec26e6">sig_pri_cc_agent_status_req</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent)</div><div class="line"><a name="l09716"></a><span class="lineno"> 9716</span>&#160;{</div><div class="line"><a name="l09717"></a><span class="lineno"> 9717</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_agent_prv *cc_pvt;</div><div class="line"><a name="l09718"></a><span class="lineno"> 9718</span>&#160;</div><div class="line"><a name="l09719"></a><span class="lineno"> 9719</span>&#160;   cc_pvt = agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l09720"></a><span class="lineno"> 9720</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09721"></a><span class="lineno"> 9721</span>&#160;   pri_cc_status_req(cc_pvt-&gt;pri-&gt;pri, cc_pvt-&gt;cc_id);</div><div class="line"><a name="l09722"></a><span class="lineno"> 9722</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09723"></a><span class="lineno"> 9723</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l09724"></a><span class="lineno"> 9724</span>&#160;}</div><div class="line"><a name="l09725"></a><span class="lineno"> 9725</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09726"></a><span class="lineno"> 9726</span>&#160;</div><div class="line"><a name="l09727"></a><span class="lineno"> 9727</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09728"></a><span class="lineno"> 9728</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09729"></a><span class="lineno"> 9729</span>&#160;<span class="comment"> * \brief Request for an agent&#39;s phone to stop ringing.</span></div><div class="line"><a name="l09730"></a><span class="lineno"> 9730</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09731"></a><span class="lineno"> 9731</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09732"></a><span class="lineno"> 9732</span>&#160;<span class="comment"> * \param agent CC core agent control.</span></div><div class="line"><a name="l09733"></a><span class="lineno"> 9733</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09734"></a><span class="lineno"> 9734</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09735"></a><span class="lineno"> 9735</span>&#160;<span class="comment"> * The usefulness of this is quite limited. The only specific</span></div><div class="line"><a name="l09736"></a><span class="lineno"> 9736</span>&#160;<span class="comment"> * known case for this is if Asterisk requests CC over an ISDN</span></div><div class="line"><a name="l09737"></a><span class="lineno"> 9737</span>&#160;<span class="comment"> * PTMP link as the TE side. If other phones are in the same</span></div><div class="line"><a name="l09738"></a><span class="lineno"> 9738</span>&#160;<span class="comment"> * recall group as the Asterisk server, and one of those phones</span></div><div class="line"><a name="l09739"></a><span class="lineno"> 9739</span>&#160;<span class="comment"> * picks up the recall notice, then Asterisk will receive a</span></div><div class="line"><a name="l09740"></a><span class="lineno"> 9740</span>&#160;<span class="comment"> * &quot;stop ringing&quot; notification from the NT side of the PTMP</span></div><div class="line"><a name="l09741"></a><span class="lineno"> 9741</span>&#160;<span class="comment"> * link. This indication needs to be passed to the phone</span></div><div class="line"><a name="l09742"></a><span class="lineno"> 9742</span>&#160;<span class="comment"> * on the other side of the Asterisk server which originally</span></div><div class="line"><a name="l09743"></a><span class="lineno"> 9743</span>&#160;<span class="comment"> * placed the call so that it will stop ringing. Since the</span></div><div class="line"><a name="l09744"></a><span class="lineno"> 9744</span>&#160;<span class="comment"> * phone may be of any type, it is necessary to have a callback</span></div><div class="line"><a name="l09745"></a><span class="lineno"> 9745</span>&#160;<span class="comment"> * that the core can know about.</span></div><div class="line"><a name="l09746"></a><span class="lineno"> 9746</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09747"></a><span class="lineno"> 9747</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l09748"></a><span class="lineno"> 9748</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l09749"></a><span class="lineno"> 9749</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09750"></a><span class="lineno"> 9750</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#af7cb1e2aed71f615817a08e3b27044c0">sig_pri_cc_agent_stop_ringing</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent)</div><div class="line"><a name="l09751"></a><span class="lineno"> 9751</span>&#160;{</div><div class="line"><a name="l09752"></a><span class="lineno"> 9752</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_agent_prv *cc_pvt;</div><div class="line"><a name="l09753"></a><span class="lineno"> 9753</span>&#160;</div><div class="line"><a name="l09754"></a><span class="lineno"> 9754</span>&#160;   cc_pvt = agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l09755"></a><span class="lineno"> 9755</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09756"></a><span class="lineno"> 9756</span>&#160;   pri_cc_stop_alerting(cc_pvt-&gt;pri-&gt;pri, cc_pvt-&gt;cc_id);</div><div class="line"><a name="l09757"></a><span class="lineno"> 9757</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09758"></a><span class="lineno"> 9758</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l09759"></a><span class="lineno"> 9759</span>&#160;}</div><div class="line"><a name="l09760"></a><span class="lineno"> 9760</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09761"></a><span class="lineno"> 9761</span>&#160;</div><div class="line"><a name="l09762"></a><span class="lineno"> 9762</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09763"></a><span class="lineno"> 9763</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09764"></a><span class="lineno"> 9764</span>&#160;<span class="comment"> * \brief Let the caller know that the callee has become free</span></div><div class="line"><a name="l09765"></a><span class="lineno"> 9765</span>&#160;<span class="comment"> * but that the caller cannot attempt to call back because</span></div><div class="line"><a name="l09766"></a><span class="lineno"> 9766</span>&#160;<span class="comment"> * he is either busy or there is congestion on his line.</span></div><div class="line"><a name="l09767"></a><span class="lineno"> 9767</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09768"></a><span class="lineno"> 9768</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09769"></a><span class="lineno"> 9769</span>&#160;<span class="comment"> * \param agent CC core agent control.</span></div><div class="line"><a name="l09770"></a><span class="lineno"> 9770</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09771"></a><span class="lineno"> 9771</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09772"></a><span class="lineno"> 9772</span>&#160;<span class="comment"> * This is something that really only affects a scenario where</span></div><div class="line"><a name="l09773"></a><span class="lineno"> 9773</span>&#160;<span class="comment"> * a phone places a call over ISDN PTMP to Asterisk, who then</span></div><div class="line"><a name="l09774"></a><span class="lineno"> 9774</span>&#160;<span class="comment"> * connects over PTMP again to the ISDN network. For most agent</span></div><div class="line"><a name="l09775"></a><span class="lineno"> 9775</span>&#160;<span class="comment"> * types, there is no need to implement this callback at all</span></div><div class="line"><a name="l09776"></a><span class="lineno"> 9776</span>&#160;<span class="comment"> * because they don&#39;t really need to actually do anything in</span></div><div class="line"><a name="l09777"></a><span class="lineno"> 9777</span>&#160;<span class="comment"> * this situation. If you&#39;re having trouble understanding what</span></div><div class="line"><a name="l09778"></a><span class="lineno"> 9778</span>&#160;<span class="comment"> * the purpose of this callback is, then you can be safe simply</span></div><div class="line"><a name="l09779"></a><span class="lineno"> 9779</span>&#160;<span class="comment"> * not implementing it.</span></div><div class="line"><a name="l09780"></a><span class="lineno"> 9780</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09781"></a><span class="lineno"> 9781</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l09782"></a><span class="lineno"> 9782</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l09783"></a><span class="lineno"> 9783</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09784"></a><span class="lineno"> 9784</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#af0809ef4acdb1aeaba5efa8359efad8b">sig_pri_cc_agent_party_b_free</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent)</div><div class="line"><a name="l09785"></a><span class="lineno"> 9785</span>&#160;{</div><div class="line"><a name="l09786"></a><span class="lineno"> 9786</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_agent_prv *cc_pvt;</div><div class="line"><a name="l09787"></a><span class="lineno"> 9787</span>&#160;</div><div class="line"><a name="l09788"></a><span class="lineno"> 9788</span>&#160;   cc_pvt = agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l09789"></a><span class="lineno"> 9789</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09790"></a><span class="lineno"> 9790</span>&#160;   pri_cc_b_free(cc_pvt-&gt;pri-&gt;pri, cc_pvt-&gt;cc_id);</div><div class="line"><a name="l09791"></a><span class="lineno"> 9791</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09792"></a><span class="lineno"> 9792</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l09793"></a><span class="lineno"> 9793</span>&#160;}</div><div class="line"><a name="l09794"></a><span class="lineno"> 9794</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09795"></a><span class="lineno"> 9795</span>&#160;</div><div class="line"><a name="l09796"></a><span class="lineno"> 9796</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09797"></a><span class="lineno"> 9797</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09798"></a><span class="lineno"> 9798</span>&#160;<span class="comment"> * \brief Begin monitoring a busy device.</span></div><div class="line"><a name="l09799"></a><span class="lineno"> 9799</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09800"></a><span class="lineno"> 9800</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09801"></a><span class="lineno"> 9801</span>&#160;<span class="comment"> * \param agent CC core agent control.</span></div><div class="line"><a name="l09802"></a><span class="lineno"> 9802</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09803"></a><span class="lineno"> 9803</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09804"></a><span class="lineno"> 9804</span>&#160;<span class="comment"> * The core will call this callback if the callee becomes</span></div><div class="line"><a name="l09805"></a><span class="lineno"> 9805</span>&#160;<span class="comment"> * available but the caller has reported that he is busy.</span></div><div class="line"><a name="l09806"></a><span class="lineno"> 9806</span>&#160;<span class="comment"> * The agent should begin monitoring the caller&#39;s device.</span></div><div class="line"><a name="l09807"></a><span class="lineno"> 9807</span>&#160;<span class="comment"> * When the caller becomes available again, the agent should</span></div><div class="line"><a name="l09808"></a><span class="lineno"> 9808</span>&#160;<span class="comment"> * call ast_cc_agent_caller_available.</span></div><div class="line"><a name="l09809"></a><span class="lineno"> 9809</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09810"></a><span class="lineno"> 9810</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l09811"></a><span class="lineno"> 9811</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l09812"></a><span class="lineno"> 9812</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09813"></a><span class="lineno"> 9813</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a944dc3eea387d9850e13ad734fd31ca8">sig_pri_cc_agent_start_monitoring</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent)</div><div class="line"><a name="l09814"></a><span class="lineno"> 9814</span>&#160;{</div><div class="line"><a name="l09815"></a><span class="lineno"> 9815</span>&#160;   <span class="comment">/* libpri already knows when and how it needs to monitor Party A. */</span></div><div class="line"><a name="l09816"></a><span class="lineno"> 9816</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l09817"></a><span class="lineno"> 9817</span>&#160;}</div><div class="line"><a name="l09818"></a><span class="lineno"> 9818</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09819"></a><span class="lineno"> 9819</span>&#160;</div><div class="line"><a name="l09820"></a><span class="lineno"> 9820</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09821"></a><span class="lineno"> 9821</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09822"></a><span class="lineno"> 9822</span>&#160;<span class="comment"> * \brief Alert the caller that it is time to try recalling.</span></div><div class="line"><a name="l09823"></a><span class="lineno"> 9823</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09824"></a><span class="lineno"> 9824</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09825"></a><span class="lineno"> 9825</span>&#160;<span class="comment"> * \param agent CC core agent control.</span></div><div class="line"><a name="l09826"></a><span class="lineno"> 9826</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09827"></a><span class="lineno"> 9827</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09828"></a><span class="lineno"> 9828</span>&#160;<span class="comment"> * The core will call this function when it receives notice</span></div><div class="line"><a name="l09829"></a><span class="lineno"> 9829</span>&#160;<span class="comment"> * that a monitored party has become available.</span></div><div class="line"><a name="l09830"></a><span class="lineno"> 9830</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09831"></a><span class="lineno"> 9831</span>&#160;<span class="comment"> * The agent&#39;s job is to send a message to the caller to</span></div><div class="line"><a name="l09832"></a><span class="lineno"> 9832</span>&#160;<span class="comment"> * notify it of such a change. If the agent is able to</span></div><div class="line"><a name="l09833"></a><span class="lineno"> 9833</span>&#160;<span class="comment"> * discern that the caller is currently unavailable, then</span></div><div class="line"><a name="l09834"></a><span class="lineno"> 9834</span>&#160;<span class="comment"> * the agent should react by calling the ast_cc_caller_unavailable</span></div><div class="line"><a name="l09835"></a><span class="lineno"> 9835</span>&#160;<span class="comment"> * function.</span></div><div class="line"><a name="l09836"></a><span class="lineno"> 9836</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09837"></a><span class="lineno"> 9837</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l09838"></a><span class="lineno"> 9838</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l09839"></a><span class="lineno"> 9839</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09840"></a><span class="lineno"> 9840</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#ab09fc5ec29ebd5412a3bac5f10969da8">sig_pri_cc_agent_callee_available</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent)</div><div class="line"><a name="l09841"></a><span class="lineno"> 9841</span>&#160;{</div><div class="line"><a name="l09842"></a><span class="lineno"> 9842</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_agent_prv *cc_pvt;</div><div class="line"><a name="l09843"></a><span class="lineno"> 9843</span>&#160;</div><div class="line"><a name="l09844"></a><span class="lineno"> 9844</span>&#160;   cc_pvt = agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l09845"></a><span class="lineno"> 9845</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09846"></a><span class="lineno"> 9846</span>&#160;   pri_cc_remote_user_free(cc_pvt-&gt;pri-&gt;pri, cc_pvt-&gt;cc_id);</div><div class="line"><a name="l09847"></a><span class="lineno"> 9847</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09848"></a><span class="lineno"> 9848</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l09849"></a><span class="lineno"> 9849</span>&#160;}</div><div class="line"><a name="l09850"></a><span class="lineno"> 9850</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09851"></a><span class="lineno"> 9851</span>&#160;</div><div class="line"><a name="l09852"></a><span class="lineno"> 9852</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09853"></a><span class="lineno"> 9853</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09854"></a><span class="lineno"> 9854</span>&#160;<span class="comment"> * \brief Destroy private data on the agent.</span></div><div class="line"><a name="l09855"></a><span class="lineno"> 9855</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09856"></a><span class="lineno"> 9856</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09857"></a><span class="lineno"> 9857</span>&#160;<span class="comment"> * \param agent CC core agent control.</span></div><div class="line"><a name="l09858"></a><span class="lineno"> 9858</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09859"></a><span class="lineno"> 9859</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09860"></a><span class="lineno"> 9860</span>&#160;<span class="comment"> * The core will call this function upon completion</span></div><div class="line"><a name="l09861"></a><span class="lineno"> 9861</span>&#160;<span class="comment"> * or failure of CC.</span></div><div class="line"><a name="l09862"></a><span class="lineno"> 9862</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09863"></a><span class="lineno"> 9863</span>&#160;<span class="comment"> * \note</span></div><div class="line"><a name="l09864"></a><span class="lineno"> 9864</span>&#160;<span class="comment"> * The agent private_data pointer may be NULL if the agent</span></div><div class="line"><a name="l09865"></a><span class="lineno"> 9865</span>&#160;<span class="comment"> * constructor failed.</span></div><div class="line"><a name="l09866"></a><span class="lineno"> 9866</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09867"></a><span class="lineno"> 9867</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l09868"></a><span class="lineno"> 9868</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09869"></a><span class="lineno"> 9869</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a75d243fa9c5b62ff56a7d8a63740ede8">sig_pri_cc_agent_destructor</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a> *agent)</div><div class="line"><a name="l09870"></a><span class="lineno"> 9870</span>&#160;{</div><div class="line"><a name="l09871"></a><span class="lineno"> 9871</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_agent_prv *cc_pvt;</div><div class="line"><a name="l09872"></a><span class="lineno"> 9872</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l09873"></a><span class="lineno"> 9873</span>&#160;</div><div class="line"><a name="l09874"></a><span class="lineno"> 9874</span>&#160;   cc_pvt = agent-&gt;<a class="code" href="../../d0/db3/structast__cc__agent.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l09875"></a><span class="lineno"> 9875</span>&#160;   <span class="keywordflow">if</span> (!cc_pvt) {</div><div class="line"><a name="l09876"></a><span class="lineno"> 9876</span>&#160;      <span class="comment">/* The agent constructor probably failed. */</span></div><div class="line"><a name="l09877"></a><span class="lineno"> 9877</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l09878"></a><span class="lineno"> 9878</span>&#160;   }</div><div class="line"><a name="l09879"></a><span class="lineno"> 9879</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09880"></a><span class="lineno"> 9880</span>&#160;   res = -1;</div><div class="line"><a name="l09881"></a><span class="lineno"> 9881</span>&#160;   <span class="keywordflow">if</span> (cc_pvt-&gt;cc_request_response_pending) {</div><div class="line"><a name="l09882"></a><span class="lineno"> 9882</span>&#160;      res = pri_cc_req_rsp(cc_pvt-&gt;pri-&gt;pri, cc_pvt-&gt;cc_id, 2<span class="comment">/* short_term_denial */</span>);</div><div class="line"><a name="l09883"></a><span class="lineno"> 9883</span>&#160;   }</div><div class="line"><a name="l09884"></a><span class="lineno"> 9884</span>&#160;   <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l09885"></a><span class="lineno"> 9885</span>&#160;      pri_cc_cancel(cc_pvt-&gt;pri-&gt;pri, cc_pvt-&gt;cc_id);</div><div class="line"><a name="l09886"></a><span class="lineno"> 9886</span>&#160;   }</div><div class="line"><a name="l09887"></a><span class="lineno"> 9887</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;cc_pvt-&gt;pri-&gt;lock);</div><div class="line"><a name="l09888"></a><span class="lineno"> 9888</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cc_pvt);</div><div class="line"><a name="l09889"></a><span class="lineno"> 9889</span>&#160;}</div><div class="line"><a name="l09890"></a><span class="lineno"> 9890</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09891"></a><span class="lineno"> 9891</span>&#160;</div><div class="line"><a name="l09892"></a><span class="lineno"> 9892</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09893"></a><span class="lineno"> 9893</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09894"></a><span class="lineno"> 9894</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l09895"></a><span class="lineno"> 9895</span>&#160;<span class="comment"> * \brief Return the hash value of the given CC monitor instance object.</span></div><div class="line"><a name="l09896"></a><span class="lineno"> 9896</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09897"></a><span class="lineno"> 9897</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09898"></a><span class="lineno"> 9898</span>&#160;<span class="comment"> * \param obj pointer to the (user-defined part) of an object.</span></div><div class="line"><a name="l09899"></a><span class="lineno"> 9899</span>&#160;<span class="comment"> * \param flags flags from ao2_callback().  Ignored at the moment.</span></div><div class="line"><a name="l09900"></a><span class="lineno"> 9900</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09901"></a><span class="lineno"> 9901</span>&#160;<span class="comment"> * \retval core_id</span></div><div class="line"><a name="l09902"></a><span class="lineno"> 9902</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09903"></a><span class="lineno"> 9903</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_cc_monitor_instance_hash_fn(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l09904"></a><span class="lineno"> 9904</span>&#160;{</div><div class="line"><a name="l09905"></a><span class="lineno"> 9905</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span>sig_pri_cc_monitor_instance *monitor_instance = obj;</div><div class="line"><a name="l09906"></a><span class="lineno"> 9906</span>&#160;</div><div class="line"><a name="l09907"></a><span class="lineno"> 9907</span>&#160;   <span class="keywordflow">return</span> monitor_instance-&gt;core_id;</div><div class="line"><a name="l09908"></a><span class="lineno"> 9908</span>&#160;}</div><div class="line"><a name="l09909"></a><span class="lineno"> 9909</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09910"></a><span class="lineno"> 9910</span>&#160;</div><div class="line"><a name="l09911"></a><span class="lineno"> 9911</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09912"></a><span class="lineno"> 9912</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09913"></a><span class="lineno"> 9913</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l09914"></a><span class="lineno"> 9914</span>&#160;<span class="comment"> * \brief Compere the monitor instance core_id key value.</span></div><div class="line"><a name="l09915"></a><span class="lineno"> 9915</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09916"></a><span class="lineno"> 9916</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09917"></a><span class="lineno"> 9917</span>&#160;<span class="comment"> * \param obj pointer to the (user-defined part) of an object.</span></div><div class="line"><a name="l09918"></a><span class="lineno"> 9918</span>&#160;<span class="comment"> * \param arg callback argument from ao2_callback()</span></div><div class="line"><a name="l09919"></a><span class="lineno"> 9919</span>&#160;<span class="comment"> * \param flags flags from ao2_callback()</span></div><div class="line"><a name="l09920"></a><span class="lineno"> 9920</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09921"></a><span class="lineno"> 9921</span>&#160;<span class="comment"> * \return values are a combination of enum _cb_results.</span></div><div class="line"><a name="l09922"></a><span class="lineno"> 9922</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09923"></a><span class="lineno"> 9923</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sig_pri_cc_monitor_instance_cmp_fn(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l09924"></a><span class="lineno"> 9924</span>&#160;{</div><div class="line"><a name="l09925"></a><span class="lineno"> 9925</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *monitor_1 = obj;</div><div class="line"><a name="l09926"></a><span class="lineno"> 9926</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *monitor_2 = arg;</div><div class="line"><a name="l09927"></a><span class="lineno"> 9927</span>&#160;</div><div class="line"><a name="l09928"></a><span class="lineno"> 9928</span>&#160;   <span class="keywordflow">return</span> monitor_1-&gt;core_id == monitor_2-&gt;core_id ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;</div><div class="line"><a name="l09929"></a><span class="lineno"> 9929</span>&#160;}</div><div class="line"><a name="l09930"></a><span class="lineno"> 9930</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09931"></a><span class="lineno"> 9931</span>&#160;</div><div class="line"><a name="l09932"></a><span class="lineno"> 9932</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09933"></a><span class="lineno"> 9933</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09934"></a><span class="lineno"> 9934</span>&#160;<span class="comment"> * \brief Request CCSS.</span></div><div class="line"><a name="l09935"></a><span class="lineno"> 9935</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09936"></a><span class="lineno"> 9936</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09937"></a><span class="lineno"> 9937</span>&#160;<span class="comment"> * \param monitor CC core monitor control.</span></div><div class="line"><a name="l09938"></a><span class="lineno"> 9938</span>&#160;<span class="comment"> * \param available_timer_id Where to put the available timer scheduler id.</span></div><div class="line"><a name="l09939"></a><span class="lineno"> 9939</span>&#160;<span class="comment"> * Will never be NULL for a device monitor.</span></div><div class="line"><a name="l09940"></a><span class="lineno"> 9940</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09941"></a><span class="lineno"> 9941</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09942"></a><span class="lineno"> 9942</span>&#160;<span class="comment"> * Perform whatever steps are necessary in order to request CC.</span></div><div class="line"><a name="l09943"></a><span class="lineno"> 9943</span>&#160;<span class="comment"> * In addition, the monitor implementation is responsible for</span></div><div class="line"><a name="l09944"></a><span class="lineno"> 9944</span>&#160;<span class="comment"> * starting the available timer in this callback. The scheduler</span></div><div class="line"><a name="l09945"></a><span class="lineno"> 9945</span>&#160;<span class="comment"> * ID for the callback must be stored in the parent_link&#39;s child_avail_id</span></div><div class="line"><a name="l09946"></a><span class="lineno"> 9946</span>&#160;<span class="comment"> * field.</span></div><div class="line"><a name="l09947"></a><span class="lineno"> 9947</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09948"></a><span class="lineno"> 9948</span>&#160;<span class="comment"> * \retval 0 on success</span></div><div class="line"><a name="l09949"></a><span class="lineno"> 9949</span>&#160;<span class="comment"> * \retval -1 on failure.</span></div><div class="line"><a name="l09950"></a><span class="lineno"> 9950</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09951"></a><span class="lineno"> 9951</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a53bfe77af5cb1063c3de97a09a97bbeb">sig_pri_cc_monitor_req_cc</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d6e/structast__cc__monitor.html">ast_cc_monitor</a> *monitor, <span class="keywordtype">int</span> *available_timer_id)</div><div class="line"><a name="l09952"></a><span class="lineno"> 9952</span>&#160;{</div><div class="line"><a name="l09953"></a><span class="lineno"> 9953</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *instance;</div><div class="line"><a name="l09954"></a><span class="lineno"> 9954</span>&#160;   <span class="keywordtype">int</span> cc_mode;</div><div class="line"><a name="l09955"></a><span class="lineno"> 9955</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l09956"></a><span class="lineno"> 9956</span>&#160;</div><div class="line"><a name="l09957"></a><span class="lineno"> 9957</span>&#160;   <span class="keywordflow">switch</span> (monitor-&gt;<a class="code" href="../../d0/d6e/structast__cc__monitor.html#ade92ed8ed7a6fa7c3bb9a0e91db6e192">service_offered</a>) {</div><div class="line"><a name="l09958"></a><span class="lineno"> 9958</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530a64c2fae63ae9df0696a2092477c6fcb2">AST_CC_CCBS</a>:</div><div class="line"><a name="l09959"></a><span class="lineno"> 9959</span>&#160;      cc_mode = 0;<span class="comment">/* CCBS */</span></div><div class="line"><a name="l09960"></a><span class="lineno"> 9960</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l09961"></a><span class="lineno"> 9961</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530aec12fa6bbd080be709806e28f8bade1e">AST_CC_CCNR</a>:</div><div class="line"><a name="l09962"></a><span class="lineno"> 9962</span>&#160;      cc_mode = 1;<span class="comment">/* CCNR */</span></div><div class="line"><a name="l09963"></a><span class="lineno"> 9963</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l09964"></a><span class="lineno"> 9964</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l09965"></a><span class="lineno"> 9965</span>&#160;      <span class="comment">/* CC service not supported by ISDN. */</span></div><div class="line"><a name="l09966"></a><span class="lineno"> 9966</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l09967"></a><span class="lineno"> 9967</span>&#160;   }</div><div class="line"><a name="l09968"></a><span class="lineno"> 9968</span>&#160;</div><div class="line"><a name="l09969"></a><span class="lineno"> 9969</span>&#160;   instance = monitor-&gt;<a class="code" href="../../d0/d6e/structast__cc__monitor.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l09970"></a><span class="lineno"> 9970</span>&#160;</div><div class="line"><a name="l09971"></a><span class="lineno"> 9971</span>&#160;   <span class="comment">/* libpri handles it&#39;s own available timer. */</span></div><div class="line"><a name="l09972"></a><span class="lineno"> 9972</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;instance-&gt;pri-&gt;lock);</div><div class="line"><a name="l09973"></a><span class="lineno"> 9973</span>&#160;   res = pri_cc_req(instance-&gt;pri-&gt;pri, instance-&gt;cc_id, cc_mode);</div><div class="line"><a name="l09974"></a><span class="lineno"> 9974</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;instance-&gt;pri-&gt;lock);</div><div class="line"><a name="l09975"></a><span class="lineno"> 9975</span>&#160;</div><div class="line"><a name="l09976"></a><span class="lineno"> 9976</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l09977"></a><span class="lineno"> 9977</span>&#160;}</div><div class="line"><a name="l09978"></a><span class="lineno"> 9978</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l09979"></a><span class="lineno"> 9979</span>&#160;</div><div class="line"><a name="l09980"></a><span class="lineno"> 9980</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l09981"></a><span class="lineno"> 9981</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l09982"></a><span class="lineno"> 9982</span>&#160;<span class="comment"> * \brief Suspend monitoring.</span></div><div class="line"><a name="l09983"></a><span class="lineno"> 9983</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l09984"></a><span class="lineno"> 9984</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09985"></a><span class="lineno"> 9985</span>&#160;<span class="comment"> * \param monitor CC core monitor control.</span></div><div class="line"><a name="l09986"></a><span class="lineno"> 9986</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09987"></a><span class="lineno"> 9987</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l09988"></a><span class="lineno"> 9988</span>&#160;<span class="comment"> * Implementers must perform the necessary steps to suspend</span></div><div class="line"><a name="l09989"></a><span class="lineno"> 9989</span>&#160;<span class="comment"> * monitoring.</span></div><div class="line"><a name="l09990"></a><span class="lineno"> 9990</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l09991"></a><span class="lineno"> 9991</span>&#160;<span class="comment"> * \retval 0 on success</span></div><div class="line"><a name="l09992"></a><span class="lineno"> 9992</span>&#160;<span class="comment"> * \retval -1 on failure.</span></div><div class="line"><a name="l09993"></a><span class="lineno"> 9993</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l09994"></a><span class="lineno"> 9994</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a5fdc348e299e23c06ee12d835c0f170d">sig_pri_cc_monitor_suspend</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d6e/structast__cc__monitor.html">ast_cc_monitor</a> *monitor)</div><div class="line"><a name="l09995"></a><span class="lineno"> 9995</span>&#160;{</div><div class="line"><a name="l09996"></a><span class="lineno"> 9996</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *instance;</div><div class="line"><a name="l09997"></a><span class="lineno"> 9997</span>&#160;</div><div class="line"><a name="l09998"></a><span class="lineno"> 9998</span>&#160;   instance = monitor-&gt;<a class="code" href="../../d0/d6e/structast__cc__monitor.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l09999"></a><span class="lineno"> 9999</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;instance-&gt;pri-&gt;lock);</div><div class="line"><a name="l10000"></a><span class="lineno">10000</span>&#160;   pri_cc_status(instance-&gt;pri-&gt;pri, instance-&gt;cc_id, 1<span class="comment">/* busy */</span>);</div><div class="line"><a name="l10001"></a><span class="lineno">10001</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;instance-&gt;pri-&gt;lock);</div><div class="line"><a name="l10002"></a><span class="lineno">10002</span>&#160;</div><div class="line"><a name="l10003"></a><span class="lineno">10003</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l10004"></a><span class="lineno">10004</span>&#160;}</div><div class="line"><a name="l10005"></a><span class="lineno">10005</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l10006"></a><span class="lineno">10006</span>&#160;</div><div class="line"><a name="l10007"></a><span class="lineno">10007</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l10008"></a><span class="lineno">10008</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l10009"></a><span class="lineno">10009</span>&#160;<span class="comment"> * \brief Unsuspend monitoring.</span></div><div class="line"><a name="l10010"></a><span class="lineno">10010</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l10011"></a><span class="lineno">10011</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10012"></a><span class="lineno">10012</span>&#160;<span class="comment"> * \param monitor CC core monitor control.</span></div><div class="line"><a name="l10013"></a><span class="lineno">10013</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10014"></a><span class="lineno">10014</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l10015"></a><span class="lineno">10015</span>&#160;<span class="comment"> * Perform the necessary steps to unsuspend monitoring.</span></div><div class="line"><a name="l10016"></a><span class="lineno">10016</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10017"></a><span class="lineno">10017</span>&#160;<span class="comment"> * \retval 0 on success</span></div><div class="line"><a name="l10018"></a><span class="lineno">10018</span>&#160;<span class="comment"> * \retval -1 on failure.</span></div><div class="line"><a name="l10019"></a><span class="lineno">10019</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l10020"></a><span class="lineno">10020</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a3e0d7c07861c991009d688caa738e81d">sig_pri_cc_monitor_unsuspend</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d6e/structast__cc__monitor.html">ast_cc_monitor</a> *monitor)</div><div class="line"><a name="l10021"></a><span class="lineno">10021</span>&#160;{</div><div class="line"><a name="l10022"></a><span class="lineno">10022</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *instance;</div><div class="line"><a name="l10023"></a><span class="lineno">10023</span>&#160;</div><div class="line"><a name="l10024"></a><span class="lineno">10024</span>&#160;   instance = monitor-&gt;<a class="code" href="../../d0/d6e/structast__cc__monitor.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l10025"></a><span class="lineno">10025</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;instance-&gt;pri-&gt;lock);</div><div class="line"><a name="l10026"></a><span class="lineno">10026</span>&#160;   pri_cc_status(instance-&gt;pri-&gt;pri, instance-&gt;cc_id, 0<span class="comment">/* free */</span>);</div><div class="line"><a name="l10027"></a><span class="lineno">10027</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;instance-&gt;pri-&gt;lock);</div><div class="line"><a name="l10028"></a><span class="lineno">10028</span>&#160;</div><div class="line"><a name="l10029"></a><span class="lineno">10029</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l10030"></a><span class="lineno">10030</span>&#160;}</div><div class="line"><a name="l10031"></a><span class="lineno">10031</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l10032"></a><span class="lineno">10032</span>&#160;</div><div class="line"><a name="l10033"></a><span class="lineno">10033</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l10034"></a><span class="lineno">10034</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l10035"></a><span class="lineno">10035</span>&#160;<span class="comment"> * \brief Status response to an ast_cc_monitor_status_request().</span></div><div class="line"><a name="l10036"></a><span class="lineno">10036</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l10037"></a><span class="lineno">10037</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10038"></a><span class="lineno">10038</span>&#160;<span class="comment"> * \param monitor CC core monitor control.</span></div><div class="line"><a name="l10039"></a><span class="lineno">10039</span>&#160;<span class="comment"> * \param devstate Current status of a Party A device.</span></div><div class="line"><a name="l10040"></a><span class="lineno">10040</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10041"></a><span class="lineno">10041</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l10042"></a><span class="lineno">10042</span>&#160;<span class="comment"> * Alert a monitor as to the status of the agent for which</span></div><div class="line"><a name="l10043"></a><span class="lineno">10043</span>&#160;<span class="comment"> * the monitor had previously requested a status request.</span></div><div class="line"><a name="l10044"></a><span class="lineno">10044</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10045"></a><span class="lineno">10045</span>&#160;<span class="comment"> * \note Zero or more responses may come as a result.</span></div><div class="line"><a name="l10046"></a><span class="lineno">10046</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10047"></a><span class="lineno">10047</span>&#160;<span class="comment"> * \retval 0 on success</span></div><div class="line"><a name="l10048"></a><span class="lineno">10048</span>&#160;<span class="comment"> * \retval -1 on failure.</span></div><div class="line"><a name="l10049"></a><span class="lineno">10049</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l10050"></a><span class="lineno">10050</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#af207080da27c2f4b6cd60702190f4ce1">sig_pri_cc_monitor_status_rsp</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d6e/structast__cc__monitor.html">ast_cc_monitor</a> *monitor, <span class="keyword">enum</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> devstate)</div><div class="line"><a name="l10051"></a><span class="lineno">10051</span>&#160;{</div><div class="line"><a name="l10052"></a><span class="lineno">10052</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *instance;</div><div class="line"><a name="l10053"></a><span class="lineno">10053</span>&#160;   <span class="keywordtype">int</span> cc_status;</div><div class="line"><a name="l10054"></a><span class="lineno">10054</span>&#160;</div><div class="line"><a name="l10055"></a><span class="lineno">10055</span>&#160;   <span class="keywordflow">switch</span> (devstate) {</div><div class="line"><a name="l10056"></a><span class="lineno">10056</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>:</div><div class="line"><a name="l10057"></a><span class="lineno">10057</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>:</div><div class="line"><a name="l10058"></a><span class="lineno">10058</span>&#160;      cc_status = 0;<span class="comment">/* free */</span></div><div class="line"><a name="l10059"></a><span class="lineno">10059</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l10060"></a><span class="lineno">10060</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>:</div><div class="line"><a name="l10061"></a><span class="lineno">10061</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>:</div><div class="line"><a name="l10062"></a><span class="lineno">10062</span>&#160;      cc_status = 1;<span class="comment">/* busy */</span></div><div class="line"><a name="l10063"></a><span class="lineno">10063</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l10064"></a><span class="lineno">10064</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l10065"></a><span class="lineno">10065</span>&#160;      <span class="comment">/* Don&#39;t know how to interpret this device state into free/busy status. */</span></div><div class="line"><a name="l10066"></a><span class="lineno">10066</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l10067"></a><span class="lineno">10067</span>&#160;   }</div><div class="line"><a name="l10068"></a><span class="lineno">10068</span>&#160;   instance = monitor-&gt;<a class="code" href="../../d0/d6e/structast__cc__monitor.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;</div><div class="line"><a name="l10069"></a><span class="lineno">10069</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;instance-&gt;pri-&gt;lock);</div><div class="line"><a name="l10070"></a><span class="lineno">10070</span>&#160;   pri_cc_status_req_rsp(instance-&gt;pri-&gt;pri, instance-&gt;cc_id, cc_status);</div><div class="line"><a name="l10071"></a><span class="lineno">10071</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;instance-&gt;pri-&gt;lock);</div><div class="line"><a name="l10072"></a><span class="lineno">10072</span>&#160;</div><div class="line"><a name="l10073"></a><span class="lineno">10073</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l10074"></a><span class="lineno">10074</span>&#160;}</div><div class="line"><a name="l10075"></a><span class="lineno">10075</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l10076"></a><span class="lineno">10076</span>&#160;</div><div class="line"><a name="l10077"></a><span class="lineno">10077</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l10078"></a><span class="lineno">10078</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l10079"></a><span class="lineno">10079</span>&#160;<span class="comment"> * \brief Cancel the running available timer.</span></div><div class="line"><a name="l10080"></a><span class="lineno">10080</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l10081"></a><span class="lineno">10081</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10082"></a><span class="lineno">10082</span>&#160;<span class="comment"> * \param monitor CC core monitor control.</span></div><div class="line"><a name="l10083"></a><span class="lineno">10083</span>&#160;<span class="comment"> * \param sched_id Available timer scheduler id to cancel.</span></div><div class="line"><a name="l10084"></a><span class="lineno">10084</span>&#160;<span class="comment"> * Will never be NULL for a device monitor.</span></div><div class="line"><a name="l10085"></a><span class="lineno">10085</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10086"></a><span class="lineno">10086</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l10087"></a><span class="lineno">10087</span>&#160;<span class="comment"> * In most cases, this function will likely consist of just a</span></div><div class="line"><a name="l10088"></a><span class="lineno">10088</span>&#160;<span class="comment"> * call to AST_SCHED_DEL. It might have been possible to do this</span></div><div class="line"><a name="l10089"></a><span class="lineno">10089</span>&#160;<span class="comment"> * within the core, but unfortunately the mixture of sched_thread</span></div><div class="line"><a name="l10090"></a><span class="lineno">10090</span>&#160;<span class="comment"> * and sched usage in Asterisk prevents such usage.</span></div><div class="line"><a name="l10091"></a><span class="lineno">10091</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10092"></a><span class="lineno">10092</span>&#160;<span class="comment"> * \retval 0 on success</span></div><div class="line"><a name="l10093"></a><span class="lineno">10093</span>&#160;<span class="comment"> * \retval -1 on failure.</span></div><div class="line"><a name="l10094"></a><span class="lineno">10094</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l10095"></a><span class="lineno">10095</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a56415faa5c5e128797e8a3ebcc5eaff4">sig_pri_cc_monitor_cancel_available_timer</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d6e/structast__cc__monitor.html">ast_cc_monitor</a> *monitor, <span class="keywordtype">int</span> *<a class="code" href="../../d1/dab/structsched__id.html">sched_id</a>)</div><div class="line"><a name="l10096"></a><span class="lineno">10096</span>&#160;{</div><div class="line"><a name="l10097"></a><span class="lineno">10097</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l10098"></a><span class="lineno">10098</span>&#160;<span class="comment">    * libpri maintains it&#39;s own available timer as one of:</span></div><div class="line"><a name="l10099"></a><span class="lineno">10099</span>&#160;<span class="comment">    * T_CCBS2/T_CCBS5/T_CCBS6/QSIG_CCBS_T2</span></div><div class="line"><a name="l10100"></a><span class="lineno">10100</span>&#160;<span class="comment">    * T_CCNR2/T_CCNR5/T_CCNR6/QSIG_CCNR_T2</span></div><div class="line"><a name="l10101"></a><span class="lineno">10101</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l10102"></a><span class="lineno">10102</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l10103"></a><span class="lineno">10103</span>&#160;}</div><div class="line"><a name="l10104"></a><span class="lineno">10104</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l10105"></a><span class="lineno">10105</span>&#160;</div><div class="line"><a name="l10106"></a><span class="lineno">10106</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l10107"></a><span class="lineno">10107</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l10108"></a><span class="lineno">10108</span>&#160;<span class="comment"> * \brief Destroy PRI private data on the monitor.</span></div><div class="line"><a name="l10109"></a><span class="lineno">10109</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l10110"></a><span class="lineno">10110</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10111"></a><span class="lineno">10111</span>&#160;<span class="comment"> * \param monitor_pvt CC device monitor private data pointer.</span></div><div class="line"><a name="l10112"></a><span class="lineno">10112</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10113"></a><span class="lineno">10113</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l10114"></a><span class="lineno">10114</span>&#160;<span class="comment"> * Implementers of this callback are responsible for destroying</span></div><div class="line"><a name="l10115"></a><span class="lineno">10115</span>&#160;<span class="comment"> * all heap-allocated data in the monitor&#39;s private_data pointer, including</span></div><div class="line"><a name="l10116"></a><span class="lineno">10116</span>&#160;<span class="comment"> * the private_data itself.</span></div><div class="line"><a name="l10117"></a><span class="lineno">10117</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l10118"></a><span class="lineno">10118</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#ac0c7c7fae90e258872bd02cb899d7dae">sig_pri_cc_monitor_destructor</a>(<span class="keywordtype">void</span> *monitor_pvt)</div><div class="line"><a name="l10119"></a><span class="lineno">10119</span>&#160;{</div><div class="line"><a name="l10120"></a><span class="lineno">10120</span>&#160;   <span class="keyword">struct </span>sig_pri_cc_monitor_instance *instance;</div><div class="line"><a name="l10121"></a><span class="lineno">10121</span>&#160;</div><div class="line"><a name="l10122"></a><span class="lineno">10122</span>&#160;   instance = monitor_pvt;</div><div class="line"><a name="l10123"></a><span class="lineno">10123</span>&#160;   <span class="keywordflow">if</span> (!instance) {</div><div class="line"><a name="l10124"></a><span class="lineno">10124</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l10125"></a><span class="lineno">10125</span>&#160;   }</div><div class="line"><a name="l10126"></a><span class="lineno">10126</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(sig_pri_cc_monitors, instance);</div><div class="line"><a name="l10127"></a><span class="lineno">10127</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(instance, -1);</div><div class="line"><a name="l10128"></a><span class="lineno">10128</span>&#160;}</div><div class="line"><a name="l10129"></a><span class="lineno">10129</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l10130"></a><span class="lineno">10130</span>&#160;<span class="comment"></span></div><div class="line"><a name="l10131"></a><span class="lineno">10131</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l10132"></a><span class="lineno">10132</span>&#160;<span class="comment"> * \brief Load the sig_pri submodule.</span></div><div class="line"><a name="l10133"></a><span class="lineno">10133</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l10134"></a><span class="lineno">10134</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10135"></a><span class="lineno">10135</span>&#160;<span class="comment"> * \param cc_type_name CC type name to use when looking up agent/monitor.</span></div><div class="line"><a name="l10136"></a><span class="lineno">10136</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10137"></a><span class="lineno">10137</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l10138"></a><span class="lineno">10138</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l10139"></a><span class="lineno">10139</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l10140"></a><span class="lineno">10140</span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#aadcd9dd828806b44aac0c6308d2df08a">sig_pri_load</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *cc_type_name)</div><div class="line"><a name="l10141"></a><span class="lineno">10141</span>&#160;{</div><div class="line"><a name="l10142"></a><span class="lineno">10142</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MCID)</span></div><div class="line"><a name="l10143"></a><span class="lineno">10143</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d79/stasis_8h.html#a70cd046d8e3fd50de5c51aecb2830d2a">STASIS_MESSAGE_TYPE_INIT</a>(mcid_type)) {</div><div class="line"><a name="l10144"></a><span class="lineno">10144</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l10145"></a><span class="lineno">10145</span>&#160;   }</div><div class="line"><a name="l10146"></a><span class="lineno">10146</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MCID) */</span><span class="preprocessor"></span></div><div class="line"><a name="l10147"></a><span class="lineno">10147</span>&#160;</div><div class="line"><a name="l10148"></a><span class="lineno">10148</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l10149"></a><span class="lineno">10149</span>&#160;   sig_pri_cc_type_name = cc_type_name;</div><div class="line"><a name="l10150"></a><span class="lineno">10150</span>&#160;   sig_pri_cc_monitors = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0, 37,</div><div class="line"><a name="l10151"></a><span class="lineno">10151</span>&#160;      sig_pri_cc_monitor_instance_hash_fn, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, sig_pri_cc_monitor_instance_cmp_fn);</div><div class="line"><a name="l10152"></a><span class="lineno">10152</span>&#160;   <span class="keywordflow">if</span> (!sig_pri_cc_monitors) {</div><div class="line"><a name="l10153"></a><span class="lineno">10153</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l10154"></a><span class="lineno">10154</span>&#160;   }</div><div class="line"><a name="l10155"></a><span class="lineno">10155</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l10156"></a><span class="lineno">10156</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l10157"></a><span class="lineno">10157</span>&#160;}</div><div class="line"><a name="l10158"></a><span class="lineno">10158</span>&#160;<span class="comment"></span></div><div class="line"><a name="l10159"></a><span class="lineno">10159</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l10160"></a><span class="lineno">10160</span>&#160;<span class="comment"> * \brief Unload the sig_pri submodule.</span></div><div class="line"><a name="l10161"></a><span class="lineno">10161</span>&#160;<span class="comment"> * \since 1.8</span></div><div class="line"><a name="l10162"></a><span class="lineno">10162</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l10163"></a><span class="lineno">10163</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l10164"></a><span class="lineno">10164</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l10165"></a><span class="lineno">10165</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d6c/sig__pri_8h.html#a04d81917b5b4a26949ed26643f8250fe">sig_pri_unload</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l10166"></a><span class="lineno">10166</span>&#160;{</div><div class="line"><a name="l10167"></a><span class="lineno">10167</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_CCSS)</span></div><div class="line"><a name="l10168"></a><span class="lineno">10168</span>&#160;   <span class="keywordflow">if</span> (sig_pri_cc_monitors) {</div><div class="line"><a name="l10169"></a><span class="lineno">10169</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sig_pri_cc_monitors, -1);</div><div class="line"><a name="l10170"></a><span class="lineno">10170</span>&#160;      sig_pri_cc_monitors = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l10171"></a><span class="lineno">10171</span>&#160;   }</div><div class="line"><a name="l10172"></a><span class="lineno">10172</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_CCSS) */</span><span class="preprocessor"></span></div><div class="line"><a name="l10173"></a><span class="lineno">10173</span>&#160;</div><div class="line"><a name="l10174"></a><span class="lineno">10174</span>&#160;<span class="preprocessor">#if defined(HAVE_PRI_MCID)</span></div><div class="line"><a name="l10175"></a><span class="lineno">10175</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a31197e193b1dfd6c122ff6d7c7f6b3fa">STASIS_MESSAGE_TYPE_CLEANUP</a>(mcid_type);</div><div class="line"><a name="l10176"></a><span class="lineno">10176</span>&#160;<span class="preprocessor">#endif   </span><span class="comment">/* defined(HAVE_PRI_MCID) */</span><span class="preprocessor"></span></div><div class="line"><a name="l10177"></a><span class="lineno">10177</span>&#160;}</div><div class="line"><a name="l10178"></a><span class="lineno">10178</span>&#160;</div><div class="line"><a name="l10179"></a><span class="lineno">10179</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_PRI */</span><span class="preprocessor"></span></div><div class="ttc" id="structsig__pri__callback_html_abe550d126d8f98b2e177cf80f4c2119b"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#abe550d126d8f98b2e177cf80f4c2119b">sig_pri_callback::lock_private</a></div><div class="ttdeci">void(*const lock_private)(void *pvt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00180">sig_pri.h:180</a></div></div>
<div class="ttc" id="aoc_8h_html_a2c726e954f606dc71b37ba93be286ff9a44da551e5cfa1d51b072685591df0800"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a44da551e5cfa1d51b072685591df0800">AST_AOC_CHARGE_FREE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00071">aoc.h:71</a></div></div>
<div class="ttc" id="channel_8h_html_ac2dc872b606534943c98304aed841b34"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a></div><div class="ttdeci">struct ast_party_caller * ast_channel_caller(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00888">channel_internal_api.c:888</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00293">include/asterisk/frame.h:293</a></div></div>
<div class="ttc" id="aoc_8h_html_a64a0b1ab9b0b18a58861ef59bb5ea8a7a5aaaededce99757a5c1aaf025f4c7e6d"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a64a0b1ab9b0b18a58861ef59bb5ea8a7a5aaaededce99757a5c1aaf025f4c7e6d">AST_AOC_CHARGING_ASSOCIATION_ID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00188">aoc.h:188</a></div></div>
<div class="ttc" id="ccss_8h_html_ad179ffd63f6ff74454f58c58d7248368"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#ad179ffd63f6ff74454f58c58d7248368">ast_cc_monitor_failed</a></div><div class="ttdeci">int ast_cc_monitor_failed(int core_id, const char *const monitor_name, const char *const debug,...)</div><div class="ttdoc">Indicate that a failure has occurred on a specific monitor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03941">ccss.c:3941</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_aff456ca48d31a9813584e799064cf88e"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#aff456ca48d31a9813584e799064cf88e">sig_pri_chan::cid_ton</a></div><div class="ttdeci">int cid_ton</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00296">sig_pri.h:296</a></div></div>
<div class="ttc" id="structast__aoc__volume__rate_html_a8e9f2604f702639994f22f5f3911b86b"><div class="ttname"><a href="../../db/d83/structast__aoc__volume__rate.html#a8e9f2604f702639994f22f5f3911b86b">ast_aoc_volume_rate::volume_unit</a></div><div class="ttdeci">uint16_t volume_unit</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00134">aoc.h:134</a></div></div>
<div class="ttc" id="channel_8h_html_a30bcf0418189567bc84ff32034f79f28"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a30bcf0418189567bc84ff32034f79f28">ast_queue_hangup</a></div><div class="ttdeci">int ast_queue_hangup(struct ast_channel *chan)</div><div class="ttdoc">Queue a hangup frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01150">channel.c:1150</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a4d63fdfe5451ec2248c16a2739190c56"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a></div><div class="ttdeci">static const char type[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00109">chan_ooh323.c:109</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a04d81917b5b4a26949ed26643f8250fe"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a04d81917b5b4a26949ed26643f8250fe">sig_pri_unload</a></div><div class="ttdeci">void sig_pri_unload(void)</div></div>
<div class="ttc" id="structast__manager__event__blob_html"><div class="ttname"><a href="../../dd/d96/structast__manager__event__blob.html">ast_manager_event_blob</a></div><div class="ttdoc">Struct containing info for an AMI event to send out. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00491">manager.h:491</a></div></div>
<div class="ttc" id="structast__party__id_html"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html">ast_party_id</a></div><div class="ttdoc">Information needed to identify an endpoint in a call. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00339">channel.h:339</a></div></div>
<div class="ttc" id="callerid_8h_html_a84c18283fee396ec5947fc497dd39169a44d73d03e9d22a95d04fecb97a4a96a5"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169a44d73d03e9d22a95d04fecb97a4a96a5">AST_REDIRECTING_REASON_NO_ANSWER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00393">callerid.h:393</a></div></div>
<div class="ttc" id="channel_8h_html_abf514b9d96a1821a33fec8c64ee4e26f"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#abf514b9d96a1821a33fec8c64ee4e26f">ast_party_connected_line_init</a></div><div class="ttdeci">void ast_party_connected_line_init(struct ast_party_connected_line *init)</div><div class="ttdoc">Initialize the given connected line structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02022">channel.c:2022</a></div></div>
<div class="ttc" id="structast__party__name_html_a3df9119032baa1743f2db71344bd7cac"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html#a3df9119032baa1743f2db71344bd7cac">ast_party_name::presentation</a></div><div class="ttdeci">int presentation</div><div class="ttdoc">Q.931 encoded presentation-indicator encoded field. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00278">channel.h:278</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a3e0d7c07861c991009d688caa738e81d"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a3e0d7c07861c991009d688caa738e81d">sig_pri_cc_monitor_unsuspend</a></div><div class="ttdeci">int sig_pri_cc_monitor_unsuspend(struct ast_cc_monitor *monitor)</div></div>
<div class="ttc" id="structsig__pri__span_html_a099384aa298c908fc76777075d5ef0e8"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a099384aa298c908fc76777075d5ef0e8">sig_pri_span::nodetype</a></div><div class="ttdeci">int nodetype</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00557">sig_pri.h:557</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aaabec1a9689f202696348b6473804e4f"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aaabec1a9689f202696348b6473804e4f">sig_pri_chan_alarm_notify</a></div><div class="ttdeci">void sig_pri_chan_alarm_notify(struct sig_pri_chan *p, int noalarm)</div></div>
<div class="ttc" id="astmm_8h_html_a1b7699f7e51f653f1032daa2df2319cd"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a1b7699f7e51f653f1032daa2df2319cd">ast_std_free</a></div><div class="ttdeci">void ast_std_free(void *ptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db0/astmm_8c_source.html#l01766">astmm.c:1766</a></div></div>
<div class="ttc" id="app__alarmreceiver_8c_html_ac2c887b7f7b359bfdda8a128980f5081"><div class="ttname"><a href="../../dc/d5c/app__alarmreceiver_8c.html#ac2c887b7f7b359bfdda8a128980f5081">digit</a></div><div class="ttdeci">char digit</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d5c/app__alarmreceiver_8c_source.html#l00131">app_alarmreceiver.c:131</a></div></div>
<div class="ttc" id="structsig__pri__span_html_af352101854fcf60ed3f0015542f943dc"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#af352101854fcf60ed3f0015542f943dc">sig_pri_span::dchan_logical_span</a></div><div class="ttdeci">int dchan_logical_span[SIG_PRI_NUM_DCHANS]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00458">sig_pri.h:458</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a095eb5749876ec9c9f28a5dab2bf05b0"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a095eb5749876ec9c9f28a5dab2bf05b0">sig_pri_span::resetinterval</a></div><div class="ttdeci">long resetinterval</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00517">sig_pri.h:517</a></div></div>
<div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="pbx_8h_html_ac359af75b9494f50904583d2168a7577"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ac359af75b9494f50904583d2168a7577">ast_matchmore_extension</a></div><div class="ttdeci">int ast_matchmore_extension(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)</div><div class="ttdoc">Looks to see if adding anything to this extension might match something. (exists ^ canmatch) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04199">pbx.c:4199</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ab30dead77fa070cbe51316f43fcea8a2"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a></div><div class="ttdeci">#define DAHDI_OVERLAPDIAL_INCOMING</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00255">sig_pri.h:255</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a05edaa81495770d1da9a146edfb1fa23"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a05edaa81495770d1da9a146edfb1fa23">sig_pri_chan::user_tag</a></div><div class="ttdeci">char user_tag[AST_MAX_EXTENSION *2]</div><div class="ttdoc">User tag for party id&amp;#39;s sent from this device driver. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00303">sig_pri.h:303</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_a78d4847658b695383d849efd12399b38"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a></div><div class="ttdeci">static char exten[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00118">chan_alsa.c:118</a></div></div>
<div class="ttc" id="ccss_8h_html_a9a078a59bc29f1ace8486ab9ecb774c4a8f6c86645c00c1789fec227c20bfa66e"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4a8f6c86645c00c1789fec227c20bfa66e">AST_CC_MONITOR_NATIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00078">ccss.h:78</a></div></div>
<div class="ttc" id="structast__aoc__unit__entry_html_a7dd39f0ed064eccd86e7b98ee0834b67"><div class="ttname"><a href="../../df/d18/structast__aoc__unit__entry.html#a7dd39f0ed064eccd86e7b98ee0834b67">ast_aoc_unit_entry::valid_amount</a></div><div class="ttdeci">char valid_amount</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00179">aoc.h:179</a></div></div>
<div class="ttc" id="aoc_8h_html_a1e39f2e893091c0780856e2080c57360"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a1e39f2e893091c0780856e2080c57360">ast_aoc_s_add_rate_duration</a></div><div class="ttdeci">int ast_aoc_s_add_rate_duration(struct ast_aoc_decoded *decoded, enum ast_aoc_s_charged_item charged_item, unsigned int amount, enum ast_aoc_currency_multiplier multiplier, const char *currency_name, unsigned long time, enum ast_aoc_time_scale time_scale, unsigned long granularity_time, enum ast_aoc_time_scale granularity_time_scale, int step_function)</div><div class="ttdoc">Add AOC-S duration rate entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00770">aoc.c:770</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="structast__party__dialed_html_a436a3700bd4ae24751d7fad4538466aa"><div class="ttname"><a href="../../d1/dd1/structast__party__dialed.html#a436a3700bd4ae24751d7fad4538466aa">ast_party_dialed::number</a></div><div class="ttdeci">struct ast_party_dialed::@246 number</div><div class="ttdoc">Dialed/Called number. </div></div>
<div class="ttc" id="musiconhold_8h_html"><div class="ttname"><a href="../../dc/d07/musiconhold_8h.html">musiconhold.h</a></div><div class="ttdoc">Music on hold handling. </div></div>
<div class="ttc" id="structsig__pri__chan_html_ad6ff485ac8e31fb1624065520ddc9820"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#ad6ff485ac8e31fb1624065520ddc9820">sig_pri_chan::logicalspan</a></div><div class="ttdeci">int logicalspan</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00369">sig_pri.h:369</a></div></div>
<div class="ttc" id="sig__pri_8h_html_af0809ef4acdb1aeaba5efa8359efad8b"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#af0809ef4acdb1aeaba5efa8359efad8b">sig_pri_cc_agent_party_b_free</a></div><div class="ttdeci">int sig_pri_cc_agent_party_b_free(struct ast_cc_agent *agent)</div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eee"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a></div><div class="ttdeci">ast_device_state</div><div class="ttdoc">Device States. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00052">devicestate.h:52</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_af530b38fefaa05e6fa4f0ebe72c73455"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#af530b38fefaa05e6fa4f0ebe72c73455">sig_pri_chan::alreadyhungup</a></div><div class="ttdeci">unsigned int alreadyhungup</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00327">sig_pri.h:327</a></div></div>
<div class="ttc" id="structast__party__dialed_html_ad1f8db563cb99d404b72e02cf8f78cd1"><div class="ttname"><a href="../../d1/dd1/structast__party__dialed.html#ad1f8db563cb99d404b72e02cf8f78cd1">ast_party_dialed::plan</a></div><div class="ttdeci">int plan</div><div class="ttdoc">Q.931 Type-Of-Number and Numbering-Plan encoded fields. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00389">channel.h:389</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a45c267e1a632ddf4a622ee8e975b048f"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a45c267e1a632ddf4a622ee8e975b048f">sig_pri_available</a></div><div class="ttdeci">int sig_pri_available(struct sig_pri_chan **pvt, int is_specific_channel)</div></div>
<div class="ttc" id="structast__party__number_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_number::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber phone number (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00292">channel.h:292</a></div></div>
<div class="ttc" id="transcap_8h_html"><div class="ttname"><a href="../../d7/d86/transcap_8h.html">transcap.h</a></div><div class="ttdoc">General Asterisk channel transcoding definitions. </div></div>
<div class="ttc" id="aoc_8h_html_a49977b1a5a71ee19edfc3f77f448e089ab00c5e861fc1c84070bb4af0ae15690b"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089ab00c5e861fc1c84070bb4af0ae15690b">AST_AOC_MULT_THOUSAND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00041">aoc.h:41</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a6ae2ff84731ea1e81a24412800030423"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a6ae2ff84731ea1e81a24412800030423">sig_pri_chan::priexclusive</a></div><div class="ttdeci">unsigned int priexclusive</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00285">sig_pri.h:285</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7afa90d4afb1aba555d9adb4bbbac13bec">SIG_PRI_MOH_STATE_IDLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00086">sig_pri.h:86</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac2d42f7be13c532b6a70d50f1b8983d2"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a></div><div class="ttdeci">void astman_append(struct mansession *s, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03080">manager.c:3080</a></div></div>
<div class="ttc" id="stasis__channels_8h_html"><div class="ttname"><a href="../../d9/d4a/stasis__channels_8h.html">stasis_channels.h</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="sig__pri_8h_html_a1f2b8458e88cb20f51d2b1503f764155"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a1f2b8458e88cb20f51d2b1503f764155">sig_pri_indicate</a></div><div class="ttdeci">int sig_pri_indicate(struct sig_pri_chan *p, struct ast_channel *chan, int condition, const void *data, size_t datalen)</div></div>
<div class="ttc" id="aoc_8h_html_a2c726e954f606dc71b37ba93be286ff9a5816131a38e568febf50d316c850c44b"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a5816131a38e568febf50d316c850c44b">AST_AOC_CHARGE_UNIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00073">aoc.h:73</a></div></div>
<div class="ttc" id="mwi_8h_html_a82c6cbb5215eec5348715e4824f5f575"><div class="ttname"><a href="../../dc/d33/mwi_8h.html#a82c6cbb5215eec5348715e4824f5f575">ast_mwi_unsubscribe</a></div><div class="ttdeci">void * ast_mwi_unsubscribe(struct ast_mwi_subscriber *sub)</div><div class="ttdoc">Unsubscribe from the stasis topic and MWI. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00249">mwi.c:249</a></div></div>
<div class="ttc" id="callerid_8h_html_a84c18283fee396ec5947fc497dd39169a1cf63751ca0805657b57f0ca36069f41"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169a1cf63751ca0805657b57f0ca36069f41">AST_REDIRECTING_REASON_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00391">callerid.h:391</a></div></div>
<div class="ttc" id="bridge_8h_html_aec45146e91e4d8bc2a7d2cf083c4dac0"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#aec45146e91e4d8bc2a7d2cf083c4dac0">ast_bridge_transfer_attended</a></div><div class="ttdeci">enum ast_transfer_result ast_bridge_transfer_attended(struct ast_channel *to_transferee, struct ast_channel *to_transfer_target)</div><div class="ttdoc">Attended transfer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d95/bridge_8c_source.html#l04729">bridge.c:4729</a></div></div>
<div class="ttc" id="structast__party__redirecting_html_a99c02430b9b95b394cc2eb49ece959ad"><div class="ttname"><a href="../../df/d44/structast__party__redirecting.html#a99c02430b9b95b394cc2eb49ece959ad">ast_party_redirecting::priv_to</a></div><div class="ttdeci">struct ast_party_id priv_to</div><div class="ttdoc">Call is redirecting to a new party (Sent to the caller) - private representation. ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00540">channel.h:540</a></div></div>
<div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="channel_8h_html_aa36854cfee90c77c4124e94273e42dffa8914ca0a52908f74f9579814362289ba"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa8914ca0a52908f74f9579814362289ba">AST_PARTY_CHAR_SET_WITHDRAWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00246">channel.h:246</a></div></div>
<div class="ttc" id="structast__frame_html_aed7ea92f45bd273dde380a45ddced592"><div class="ttname"><a href="../../d0/d99/structast__frame.html#aed7ea92f45bd273dde380a45ddced592">ast_frame::offset</a></div><div class="ttdeci">int offset</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00179">include/asterisk/frame.h:179</a></div></div>
<div class="ttc" id="structast__party__dialed_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d1/dd1/structast__party__dialed.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_dialed::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber phone number (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00387">channel.h:387</a></div></div>
<div class="ttc" id="structast__control__pvt__cause__code_html_a933d9bf113023b81a5bc4820f617c068"><div class="ttname"><a href="../../d9/d2d/structast__control__pvt__cause__code.html#a933d9bf113023b81a5bc4820f617c068">ast_control_pvt_cause_code::chan_name</a></div><div class="ttdeci">char chan_name[AST_CHANNEL_NAME]</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00414">include/asterisk/frame.h:414</a></div></div>
<div class="ttc" id="channel_8h_html_a46837c158733334d2bb155bbd827ddb8"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a46837c158733334d2bb155bbd827ddb8">ast_channel_set_caller_event</a></div><div class="ttdeci">void ast_channel_set_caller_event(struct ast_channel *chan, const struct ast_party_caller *caller, const struct ast_set_party_caller *update)</div><div class="ttdoc">Set the caller id information in the Asterisk channel and generate an AMI event if the caller id name...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l07472">channel.c:7472</a></div></div>
<div class="ttc" id="transcap_8h_html_a5e35948d3406bb03e04e1725ad491cb0"><div class="ttname"><a href="../../d7/d86/transcap_8h.html#a5e35948d3406bb03e04e1725ad491cb0">IS_DIGITAL</a></div><div class="ttdeci">#define IS_DIGITAL(cap)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d86/transcap_8h_source.html#l00043">transcap.h:43</a></div></div>
<div class="ttc" id="channel_8h_html_a60f9d2b0ab8b7a839902313321163b28"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a60f9d2b0ab8b7a839902313321163b28">ast_queue_control</a></div><div class="ttdeci">int ast_queue_control(struct ast_channel *chan, enum ast_control_frame_type control)</div><div class="ttdoc">Queue a control frame without payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01231">channel.c:1231</a></div></div>
<div class="ttc" id="json_8h_html_a99715667e822b2ad409b34ca041e535d"><div class="ttname"><a href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a></div><div class="ttdeci">struct ast_json * ast_json_pack(char const *format,...)</div><div class="ttdoc">Helper for creating complex JSON values. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00591">json.c:591</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00036">channelstate.h:36</a></div></div>
<div class="ttc" id="channel_8h_html_a20d25ecd953d8ab838fa96d3cb6f06a1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a20d25ecd953d8ab838fa96d3cb6f06a1">ast_channel_redirecting_effective_from</a></div><div class="ttdeci">struct ast_party_id ast_channel_redirecting_effective_from(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00916">channel_internal_api.c:916</a></div></div>
<div class="ttc" id="channel_8h_html_aa36854cfee90c77c4124e94273e42dffab6ad448c18f5068ecb0c530ea2cf2a9b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffab6ad448c18f5068ecb0c530ea2cf2a9b">AST_PARTY_CHAR_SET_ISO8859_7</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00251">channel.h:251</a></div></div>
<div class="ttc" id="aoc_8h_html_ae89259b25941770bf1e0eaa1fe1e051c"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#ae89259b25941770bf1e0eaa1fe1e051c">ast_aoc_set_termination_request</a></div><div class="ttdeci">int ast_aoc_set_termination_request(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">Mark the AST_AOC_REQUEST message as a termination request. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l01069">aoc.c:1069</a></div></div>
<div class="ttc" id="channel_8h_html_a57b29a2e12f8d2695625942049f81a2c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a57b29a2e12f8d2695625942049f81a2c">ast_channel_transfercapability</a></div><div class="ttdeci">unsigned short ast_channel_transfercapability(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00501">channel_internal_api.c:501</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aae184c2fe57fb65661772d4772bd9444a160bf6ebcaf7f83a1d419472aa594e8c"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a160bf6ebcaf7f83a1d419472aa594e8c">SIG_PRI_CALL_LEVEL_IDLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00137">sig_pri.h:137</a></div></div>
<div class="ttc" id="ccss_8h_html_ad25ea527a36ed77fcba9eb1eba0b4186"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#ad25ea527a36ed77fcba9eb1eba0b4186">ast_cc_failed</a></div><div class="ttdeci">int ast_cc_failed(int core_id, const char *const debug,...)</div><div class="ttdoc">Indicate failure has occurred. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03879">ccss.c:3879</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a6799914e39462ec4cfef0e6b310e7104"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a6799914e39462ec4cfef0e6b310e7104">sig_pri_chan::use_callingpres</a></div><div class="ttdeci">unsigned int use_callingpres</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00288">sig_pri.h:288</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_abd29b99884a9fc8a54fc021555190fb8"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#abd29b99884a9fc8a54fc021555190fb8">sig_pri_chan::callingpres</a></div><div class="ttdeci">int callingpres</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00297">sig_pri.h:297</a></div></div>
<div class="ttc" id="channel_8h_html_aa36854cfee90c77c4124e94273e42dffa98e85ca7dd343ed5651fa79541037d47"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa98e85ca7dd343ed5651fa79541037d47">AST_PARTY_CHAR_SET_ISO8859_5</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00250">channel.h:250</a></div></div>
<div class="ttc" id="json_8h_html_ae312205990ae66d95f79f11a0ab50a31"><div class="ttname"><a href="../../d4/d05/json_8h.html#ae312205990ae66d95f79f11a0ab50a31">ast_json_party_id</a></div><div class="ttdeci">struct ast_json * ast_json_party_id(struct ast_party_id *party)</div><div class="ttdoc">Construct an ast_party_id as JSON. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00784">json.c:784</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ad5fe88d754393d4c6095d812cf813cf9"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ad5fe88d754393d4c6095d812cf813cf9">sig_pri_cli_show_span</a></div><div class="ttdeci">void sig_pri_cli_show_span(int fd, int *dchannels, struct sig_pri_span *pri)</div></div>
<div class="ttc" id="structast__party__number_html_a3df9119032baa1743f2db71344bd7cac"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#a3df9119032baa1743f2db71344bd7cac">ast_party_number::presentation</a></div><div class="ttdeci">int presentation</div><div class="ttdoc">Q.931 presentation-indicator and screening-indicator encoded fields. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00296">channel.h:296</a></div></div>
<div class="ttc" id="callerid_8h_html_a84c18283fee396ec5947fc497dd39169aeb1c62f996a259e85eed7e6e529addaf"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169aeb1c62f996a259e85eed7e6e529addaf">AST_REDIRECTING_REASON_USER_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00392">callerid.h:392</a></div></div>
<div class="ttc" id="structast__cc__agent_html_ad517770dac2061381b2008850ff12e6c"><div class="ttname"><a href="../../d0/db3/structast__cc__agent.html#ad517770dac2061381b2008850ff12e6c">ast_cc_agent::private_data</a></div><div class="ttdeci">void * private_data</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00871">ccss.h:871</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00114">include/asterisk/frame.h:114</a></div></div>
<div class="ttc" id="callerid_8h_html"><div class="ttname"><a href="../../de/d47/callerid_8h.html">callerid.h</a></div><div class="ttdoc">CallerID (and other GR30) management and generation Includes code and algorithms from the Zapata libr...</div></div>
<div class="ttc" id="sig__pri_8h_html_a76debc5bbce46bf2abe47ebfee97b341"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a76debc5bbce46bf2abe47ebfee97b341">sig_pri_cli_show_spans</a></div><div class="ttdeci">void sig_pri_cli_show_spans(int fd, int span, struct sig_pri_span *pri)</div></div>
<div class="ttc" id="utils_8h_html_a832647380b1f97e7ac1b4492f8816d46"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a></div><div class="ttdeci">#define ast_pthread_create_detached(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00563">utils.h:563</a></div></div>
<div class="ttc" id="aoc_8h_html_a6e8ab2944e2d6d1f783b3ebcd7b3c272"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a6e8ab2944e2d6d1f783b3ebcd7b3c272">ast_aoc_add_unit_entry</a></div><div class="ttdeci">int ast_aoc_add_unit_entry(struct ast_aoc_decoded *decoded, const unsigned int amount_is_present, const unsigned int amount, const unsigned int type_is_present, const unsigned int type)</div><div class="ttdoc">Adds a unit entry into the list of units. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00977">aoc.c:977</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a37e39aab51e06fe8a823525c8cb18396"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a37e39aab51e06fe8a823525c8cb18396">sig_pri_callback::init_config</a></div><div class="ttdeci">void(*const init_config)(void *pvt, struct sig_pri_span *pri)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00212">sig_pri.h:212</a></div></div>
<div class="ttc" id="ccss_8h_html_af78031bab9c298a15d07a5f30ed0c3df"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#af78031bab9c298a15d07a5f30ed0c3df">ast_cc_get_current_core_id</a></div><div class="ttdeci">int ast_cc_get_current_core_id(struct ast_channel *chan)</div><div class="ttdoc">Get the core id for the current call. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l02487">ccss.c:2487</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a58d3fa23e5b660576c24c3f497d029db"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a58d3fa23e5b660576c24c3f497d029db">sig_pri_cli_show_channels</a></div><div class="ttdeci">void sig_pri_cli_show_channels(int fd, struct sig_pri_span *pri)</div></div>
<div class="ttc" id="sig__pri_8h_html_aefcf5347053f2bb03c5a6d16ae222a57"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aefcf5347053f2bb03c5a6d16ae222a57">sig_pri_cli_show_channels_header</a></div><div class="ttdeci">void sig_pri_cli_show_channels_header(int fd)</div></div>
<div class="ttc" id="channel_8h_html_a3dc9d235c0e16ab0a6812b4aa6572cce"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a3dc9d235c0e16ab0a6812b4aa6572cce">ast_channel_tech_pvt</a></div><div class="ttdeci">void * ast_channel_tech_pvt(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00565">channel_internal_api.c:565</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a15d8af230a5c303359f79b7d1d3e3a1b"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1b">sig_pri_moh_event</a></div><div class="ttdeci">sig_pri_moh_event</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00110">sig_pri.h:110</a></div></div>
<div class="ttc" id="channel_8h_html_ab733a7825810b895a89b629e0ea89380"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a></div><div class="ttdeci">#define ast_channel_unref(c)</div><div class="ttdoc">Decrease channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02981">channel.h:2981</a></div></div>
<div class="ttc" id="app__bridgewait_8c_html_a419d14e40598b9d3c973cb693dd91297aec7326f60e7edad15d96ff935e5616d6"><div class="ttname"><a href="../../dc/d22/app__bridgewait_8c.html#a419d14e40598b9d3c973cb693dd91297aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d22/app__bridgewait_8c_source.html#l00195">app_bridgewait.c:195</a></div></div>
<div class="ttc" id="aoc_8h_html_a27f54e31b500e4b6e7396d345d5ed411a8caefba33453702b9c8a342908e9a31e"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a8caefba33453702b9c8a342908e9a31e">AST_AOC_CHARGED_ITEM_CALL_SETUP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00150">aoc.h:150</a></div></div>
<div class="ttc" id="utils_8h_html_a00d4c9254c9827d6fa44f17a326744a5"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a></div><div class="ttdeci">#define ast_test_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00063">utils.h:63</a></div></div>
<div class="ttc" id="causes_8h_html_a02b3785262e0be6843e8e9d235d8d78d"><div class="ttname"><a href="../../d4/da3/causes_8h.html#a02b3785262e0be6843e8e9d235d8d78d">AST_CAUSE_SWITCH_CONGESTION</a></div><div class="ttdeci">#define AST_CAUSE_SWITCH_CONGESTION</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00122">causes.h:122</a></div></div>
<div class="ttc" id="structast__party__redirecting_html_adf35ee8c2640d03e5c0d311d3e76fd45"><div class="ttname"><a href="../../df/d44/structast__party__redirecting.html#adf35ee8c2640d03e5c0d311d3e76fd45">ast_party_redirecting::priv_orig</a></div><div class="ttdeci">struct ast_party_id priv_orig</div><div class="ttdoc">Who originally redirected the call (Sent to the party the call is redirected toward) - private repres...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00534">channel.h:534</a></div></div>
<div class="ttc" id="channel_8h_html_ac03c2ec5ac8e7a6ef9c5d92f91880927"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ac03c2ec5ac8e7a6ef9c5d92f91880927">ast_channel_setwhentohangup_tv</a></div><div class="ttdeci">void ast_channel_setwhentohangup_tv(struct ast_channel *chan, struct timeval offset)</div><div class="ttdoc">Set when to hang a channel up. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l00510">channel.c:510</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_ab7d3c3f03d40ad5cea4721e94cb64e40"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#ab7d3c3f03d40ad5cea4721e94cb64e40">sig_pri_chan::priindication_oob</a></div><div class="ttdeci">unsigned int priindication_oob</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00286">sig_pri.h:286</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_ab451a4653176c211d131b899e1f91bde"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#ab451a4653176c211d131b899e1f91bde">BEGIN_OPTIONS</a></div><div class="ttdeci">#define BEGIN_OPTIONS</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01343">include/asterisk/app.h:1343</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_aee1feef8ad729d208a3ab28f0de46658"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#aee1feef8ad729d208a3ab28f0de46658">sig_pri_chan::use_callerid</a></div><div class="ttdeci">unsigned int use_callerid</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00287">sig_pri.h:287</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a16be7012a9efbe71bd98228d48c7c89b"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a16be7012a9efbe71bd98228d48c7c89b">sig_pri_span::idleext</a></div><div class="ttdeci">char idleext[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00552">sig_pri.h:552</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00040">channelstate.h:40</a></div></div>
<div class="ttc" id="json_8h_html_a33bcd9181e613a659eefe411ec42c87c"><div class="ttname"><a href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a></div><div class="ttdeci">void ast_json_unref(struct ast_json *value)</div><div class="ttdoc">Decrease refcount on value. If refcount reaches zero, value is freed. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00073">json.c:73</a></div></div>
<div class="ttc" id="structast__party__id_html_aab4036618469f3fa9ab26a22726ba2db"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">ast_party_id::name</a></div><div class="ttdeci">struct ast_party_name name</div><div class="ttdoc">Subscriber name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00341">channel.h:341</a></div></div>
<div class="ttc" id="structast__aoc__charging__association_html_ac7dfe3b37208afd58d8c6bbaa7c97ffb"><div class="ttname"><a href="../../d0/dad/structast__aoc__charging__association.html#ac7dfe3b37208afd58d8c6bbaa7c97ffb">ast_aoc_charging_association::charge</a></div><div class="ttdeci">union ast_aoc_charging_association::@221 charge</div></div>
<div class="ttc" id="structast__party__redirecting_html_acf09e8312b8b4396ec42c5147cdf9b5b"><div class="ttname"><a href="../../df/d44/structast__party__redirecting.html#acf09e8312b8b4396ec42c5147cdf9b5b">ast_party_redirecting::from</a></div><div class="ttdeci">struct ast_party_id from</div><div class="ttdoc">Who is redirecting the call (Sent to the party the call is redirected toward) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00528">channel.h:528</a></div></div>
<div class="ttc" id="structast__frame_html_add9af9569af79ec26dd741fb226b38ba"><div class="ttname"><a href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ast_frame::ptr</a></div><div class="ttdeci">void * ptr</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00183">include/asterisk/frame.h:183</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="causes_8h_html_a131d8780af378d0c4ef5075949902785"><div class="ttname"><a href="../../d4/da3/causes_8h.html#a131d8780af378d0c4ef5075949902785">AST_CAUSE_UNALLOCATED</a></div><div class="ttdeci">#define AST_CAUSE_UNALLOCATED</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00097">causes.h:97</a></div></div>
<div class="ttc" id="channel_8h_html_ae6b4b7ba458e88fdbb2df9f39d935337"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a></div><div class="ttdeci">void ast_channel_hangupcause_set(struct ast_channel *chan, int value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00431">channel_internal_api.c:431</a></div></div>
<div class="ttc" id="structast__channel__blob_html_ad2b8e22df32b99651f727cd9a8dcb9f3"><div class="ttname"><a href="../../db/df0/structast__channel__blob.html#ad2b8e22df32b99651f727cd9a8dcb9f3">ast_channel_blob::blob</a></div><div class="ttdeci">struct ast_json * blob</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/stasis__channels_8h_source.html#l00188">stasis_channels.h:188</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ae340d6d4a8b26ed4c604768d817fff0c"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ae340d6d4a8b26ed4c604768d817fff0c">pri_event_alarm</a></div><div class="ttdeci">void pri_event_alarm(struct sig_pri_span *pri, int index, int before_start_pri)</div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga7fc6473ab80d2117f1bcb1359721fdce"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga7fc6473ab80d2117f1bcb1359721fdce">ast_mwi_state_cache</a></div><div class="ttdeci">struct stasis_cache * ast_mwi_state_cache(void)</div><div class="ttdoc">Backend cache for ast_mwi_topic_cached(). </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00090">mwi.c:90</a></div></div>
<div class="ttc" id="stasis_8h_html_a70cd046d8e3fd50de5c51aecb2830d2a"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a70cd046d8e3fd50de5c51aecb2830d2a">STASIS_MESSAGE_TYPE_INIT</a></div><div class="ttdeci">#define STASIS_MESSAGE_TYPE_INIT(name)</div><div class="ttdoc">Boiler-plate messaging macro for initializing message types. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l01501">stasis.h:1501</a></div></div>
<div class="ttc" id="channel_8h_html_aada21a9f55151c285a1537613ff9197a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aada21a9f55151c285a1537613ff9197a">ast_queue_unhold</a></div><div class="ttdeci">int ast_queue_unhold(struct ast_channel *chan)</div><div class="ttdoc">Queue an unhold frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01216">channel.c:1216</a></div></div>
<div class="ttc" id="structast__channel__blob_html_a36584c0251e54a7af4892d63f7a28c77"><div class="ttname"><a href="../../db/df0/structast__channel__blob.html#a36584c0251e54a7af4892d63f7a28c77">ast_channel_blob::snapshot</a></div><div class="ttdeci">struct ast_channel_snapshot * snapshot</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/stasis__channels_8h_source.html#l00186">stasis_channels.h:186</a></div></div>
<div class="ttc" id="aoc_8h_html_a7558fd4fc6c76430875d931bd16b7b1da848e7e562e4048e4b0ea85d176afa76c"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da848e7e562e4048e4b0ea85d176afa76c">AST_AOC_BILLING_CALL_DEFLECTION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00057">aoc.h:57</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aaefb9d75efc555db41e739129925f90ea8fad76df1a5826da082efe6d6a0f5d4d"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aaefb9d75efc555db41e739129925f90ea8fad76df1a5826da082efe6d6a0f5d4d">SIG_PRI_MOH_SIGNALING_NOTIFY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00077">sig_pri.h:77</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aeca5e12f49bcbeceadba0ccff253a527"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aeca5e12f49bcbeceadba0ccff253a527">sig_pri_cc_agent_stop_offer_timer</a></div><div class="ttdeci">int sig_pri_cc_agent_stop_offer_timer(struct ast_cc_agent *agent)</div></div>
<div class="ttc" id="sig__pri_8h_html_ae264fa3d1f9d29c2c76c99bfa13ce95ca139c33a85a3c32eb483419e56d08d385"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ae264fa3d1f9d29c2c76c99bfa13ce95ca139c33a85a3c32eb483419e56d08d385">SIG_PRI_TONE_RINGTONE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00058">sig_pri.h:58</a></div></div>
<div class="ttc" id="structsig__pri__span_html_ad9e41a9a2b63c1e9bad00df4c2bfc92e"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#ad9e41a9a2b63c1e9bad00df4c2bfc92e">sig_pri_span::transfer</a></div><div class="ttdeci">unsigned int transfer</div><div class="ttdoc">TRUE if call transfer is enabled for the span. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00480">sig_pri.h:480</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a105fe1e505838c9eff868f02718316a0"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a105fe1e505838c9eff868f02718316a0">sig_pri_callbacks</a></div><div class="ttdeci">struct sig_pri_callback sig_pri_callbacks</div></div>
<div class="ttc" id="aoc_8h_html_afd4aa65b3a57ed3e33e0cd5f7ff9c136a40a01cc0779b0eb6eaada7827a0c8c86"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136a40a01cc0779b0eb6eaada7827a0c8c86">AST_AOC_RATE_TYPE_FREE_FROM_BEGINNING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00158">aoc.h:158</a></div></div>
<div class="ttc" id="structast__aoc__s__entry_html_ac8692012a6454afe71a9472e22f57fcb"><div class="ttname"><a href="../../d4/de4/structast__aoc__s__entry.html#ac8692012a6454afe71a9472e22f57fcb">ast_aoc_s_entry::duration</a></div><div class="ttdeci">struct ast_aoc_duration_rate duration</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00171">aoc.h:171</a></div></div>
<div class="ttc" id="lock_8h_html_a851106e971b4611a38cb4be8b39d9fcf"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a851106e971b4611a38cb4be8b39d9fcf">DEADLOCK_AVOIDANCE</a></div><div class="ttdeci">#define DEADLOCK_AVOIDANCE(lock)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00374">lock.h:374</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a14c883368db3f3426581d323f33a87e0"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a14c883368db3f3426581d323f33a87e0">sig_pri_span::facilityenable</a></div><div class="ttdeci">int facilityenable</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00453">sig_pri.h:453</a></div></div>
<div class="ttc" id="sig__pri_8h_html"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html">sig_pri.h</a></div><div class="ttdoc">Interface header for PRI signaling module. </div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="aoc_8h_html_a27f54e31b500e4b6e7396d345d5ed411a90ab9e785008e0919573fd09f088334c"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a90ab9e785008e0919573fd09f088334c">AST_AOC_CHARGED_ITEM_SUPPLEMENTARY_SERVICE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00152">aoc.h:152</a></div></div>
<div class="ttc" id="pbx_8h_html_a9a937fbb3b5f4e68880a9c5714a29ce5"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5">ast_pbx_start</a></div><div class="ttdeci">enum ast_pbx_result ast_pbx_start(struct ast_channel *c)</div><div class="ttdoc">Create a new thread and start the PBX. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04712">pbx.c:4712</a></div></div>
<div class="ttc" id="aoc_8h_html_a2c726e954f606dc71b37ba93be286ff9ad60d324867080b1a1ca3b13db29b27c2"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9ad60d324867080b1a1ca3b13db29b27c2">AST_AOC_CHARGE_NA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00070">aoc.h:70</a></div></div>
<div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="aoc_8h_html_a27f54e31b500e4b6e7396d345d5ed411a25788b7cfbb10de1565909f726083407"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a25788b7cfbb10de1565909f726083407">AST_AOC_CHARGED_ITEM_BASIC_COMMUNICATION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00148">aoc.h:148</a></div></div>
<div class="ttc" id="aoc_8h_html_a91718e9eba530fcfee96c53e68021dbc"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a91718e9eba530fcfee96c53e68021dbc">ast_aoc_s_add_rate_flat</a></div><div class="ttdeci">int ast_aoc_s_add_rate_flat(struct ast_aoc_decoded *decoded, enum ast_aoc_s_charged_item charged_item, unsigned int amount, enum ast_aoc_currency_multiplier multiplier, const char *currency_name)</div><div class="ttdoc">Add AOC-S flat rate entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00801">aoc.c:801</a></div></div>
<div class="ttc" id="aoc_8h_html_a328e01991ff5489d6289285654cb9402a794877492ffef9d20af12d1faaada02d"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402a794877492ffef9d20af12d1faaada02d">AST_AOC_TIME_SCALE_TEN_SECOND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00091">aoc.h:91</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a74f03b8f0dd671a3f916bdd8fe6cfb75"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a74f03b8f0dd671a3f916bdd8fe6cfb75">sig_pri_span::nationalprefix</a></div><div class="ttdeci">char nationalprefix[10]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00510">sig_pri.h:510</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a53bfe77af5cb1063c3de97a09a97bbeb"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a53bfe77af5cb1063c3de97a09a97bbeb">sig_pri_cc_monitor_req_cc</a></div><div class="ttdeci">int sig_pri_cc_monitor_req_cc(struct ast_cc_monitor *monitor, int *available_timer_id)</div></div>
<div class="ttc" id="structsig__pri__chan_html_afde29e654386c491ae2a188a6375f22f"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#afde29e654386c491ae2a188a6375f22f">sig_pri_chan::call</a></div><div class="ttdeci">q931_call * call</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00358">sig_pri.h:358</a></div></div>
<div class="ttc" id="channel_8h_html_a39aac47fef1240391fd97e055522fd83"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a39aac47fef1240391fd97e055522fd83">ast_party_id_presentation</a></div><div class="ttdeci">int ast_party_id_presentation(const struct ast_party_id *id)</div><div class="ttdoc">Determine the overall presentation value for the given party. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01821">channel.c:1821</a></div></div>
<div class="ttc" id="astobj2_8h_html_a47857055118a703ae87ea5ebaf4842ed"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a></div><div class="ttdeci">#define ao2_callback(c, flags, cb_fn, arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01716">astobj2.h:1716</a></div></div>
<div class="ttc" id="structast__aoc__s__entry_html"><div class="ttname"><a href="../../d4/de4/structast__aoc__s__entry.html">ast_aoc_s_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00165">aoc.h:165</a></div></div>
<div class="ttc" id="aoc_8h_html_a328e01991ff5489d6289285654cb9402a89a323e13121bee405e164653d824913"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402a89a323e13121bee405e164653d824913">AST_AOC_TIME_SCALE_DAY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00094">aoc.h:94</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00281">include/asterisk/frame.h:281</a></div></div>
<div class="ttc" id="aoc_8h_html_a27f54e31b500e4b6e7396d345d5ed411a2b26875eb31f0e8bebcaeacfaf72c934"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a2b26875eb31f0e8bebcaeacfaf72c934">AST_AOC_CHARGED_ITEM_SPECIAL_ARRANGEMENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00147">aoc.h:147</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aae184c2fe57fb65661772d4772bd9444a60273beaf5da6262358cc2add8aa2765"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a60273beaf5da6262358cc2add8aa2765">SIG_PRI_CALL_LEVEL_PROCEEDING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00143">sig_pri.h:143</a></div></div>
<div class="ttc" id="structast__control__pvt__cause__code_html_a24429ec0f2cac0778a905f215a5e1d4e"><div class="ttname"><a href="../../d9/d2d/structast__control__pvt__cause__code.html#a24429ec0f2cac0778a905f215a5e1d4e">ast_control_pvt_cause_code::ast_cause</a></div><div class="ttdeci">int ast_cause</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00416">include/asterisk/frame.h:416</a></div></div>
<div class="ttc" id="structast__aoc__volume__rate_html_a070da2496793ccf8efc39f311bcda914"><div class="ttname"><a href="../../db/d83/structast__aoc__volume__rate.html#a070da2496793ccf8efc39f311bcda914">ast_aoc_volume_rate::amount</a></div><div class="ttdeci">uint32_t amount</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00132">aoc.h:132</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a913fb926ae93fdb85797605a0ae68995"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a913fb926ae93fdb85797605a0ae68995">sig_pri_chan::progress</a></div><div class="ttdeci">unsigned int progress</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00329">sig_pri.h:329</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a></div><div class="ttdeci">static int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00086">cdr_mysql.c:86</a></div></div>
<div class="ttc" id="structast__party__redirecting_html_ac1e6e2d7f1a76e125a3c2361607afc18"><div class="ttname"><a href="../../df/d44/structast__party__redirecting.html#ac1e6e2d7f1a76e125a3c2361607afc18">ast_party_redirecting::priv_from</a></div><div class="ttdeci">struct ast_party_id priv_from</div><div class="ttdoc">Who is redirecting the call (Sent to the party the call is redirected toward) - private representatio...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00537">channel.h:537</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a5fdc348e299e23c06ee12d835c0f170d"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a5fdc348e299e23c06ee12d835c0f170d">sig_pri_cc_monitor_suspend</a></div><div class="ttdeci">int sig_pri_cc_monitor_suspend(struct ast_cc_monitor *monitor)</div></div>
<div class="ttc" id="ccss_8h_html_a0a815b8982e8b9183a38a2e2c785d155"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a0a815b8982e8b9183a38a2e2c785d155">ast_cc_agent_caller_busy</a></div><div class="ttdeci">int ast_cc_agent_caller_busy(int core_id, const char *const debug,...)</div><div class="ttdoc">Indicate that the caller is busy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03809">ccss.c:3809</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a15d8af230a5c303359f79b7d1d3e3a1baa19137c862a2cea0ffde7a9424297d92"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1baa19137c862a2cea0ffde7a9424297d92">SIG_PRI_MOH_EVENT_UNHOLD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00116">sig_pri.h:116</a></div></div>
<div class="ttc" id="structsig__pri__span_html_aab9ab1e6f772f75d5f179e4ecf57d830"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#aab9ab1e6f772f75d5f179e4ecf57d830">sig_pri_span::idlecontext</a></div><div class="ttdeci">char idlecontext[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00553">sig_pri.h:553</a></div></div>
<div class="ttc" id="aoc_8h_html_afd4aa65b3a57ed3e33e0cd5f7ff9c136a2c59202ac651d099a355efdb2acf0ebf"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136a2c59202ac651d099a355efdb2acf0ebf">AST_AOC_RATE_TYPE_VOLUME</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00161">aoc.h:161</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00037">channelstate.h:37</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a9241175b397dfd032c4cadbc8c9c2d05"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a9241175b397dfd032c4cadbc8c9c2d05">sig_pri_chan::owner</a></div><div class="ttdeci">struct ast_channel * owner</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00355">sig_pri.h:355</a></div></div>
<div class="ttc" id="structmsn__list_html"><div class="ttname"><a href="../../d4/d60/structmsn__list.html">msn_list</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dfb/misdn__config_8c_source.html#l00075">misdn_config.c:75</a></div></div>
<div class="ttc" id="structast__aoc__unit__entry_html_a4bfea42429249a1f65204f0c0f34704a"><div class="ttname"><a href="../../df/d18/structast__aoc__unit__entry.html#a4bfea42429249a1f65204f0c0f34704a">ast_aoc_unit_entry::type</a></div><div class="ttdeci">unsigned int type</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00182">aoc.h:182</a></div></div>
<div class="ttc" id="json_8h_html_ae19fc17ca5bc416b135feb64bfeb6b9e"><div class="ttname"><a href="../../d4/d05/json_8h.html#ae19fc17ca5bc416b135feb64bfeb6b9e">ast_json_is_true</a></div><div class="ttdeci">int ast_json_is_true(const struct ast_json *value)</div><div class="ttdoc">Check if value is JSON true. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00253">json.c:253</a></div></div>
<div class="ttc" id="channel_8h_html_a1b732eb4ed203140b1a3aae9e7dec2c1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1b732eb4ed203140b1a3aae9e7dec2c1">ast_call</a></div><div class="ttdeci">int ast_call(struct ast_channel *chan, const char *addr, int timeout)</div><div class="ttdoc">Make a call. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l06553">channel.c:6553</a></div></div>
<div class="ttc" id="ccss_8h_html_acdc7eb3bf93834fe45f72829ff9abe16"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#acdc7eb3bf93834fe45f72829ff9abe16">ast_cc_agent_status_response</a></div><div class="ttdeci">int ast_cc_agent_status_response(int core_id, enum ast_device_state devstate)</div><div class="ttdoc">Response with a caller&amp;#39;s current status. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l04093">ccss.c:4093</a></div></div>
<div class="ttc" id="aoc_8h_html_a232365978b35ceaeb76bd634a601aa80"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a232365978b35ceaeb76bd634a601aa80">ast_aoc_get_total_type</a></div><div class="ttdeci">enum ast_aoc_total_type ast_aoc_get_total_type(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">get the type of total for a AOC-D message </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00914">aoc.c:914</a></div></div>
<div class="ttc" id="structast__aoc__charging__association_html_a4f6be1c174ff49ae4c0c696e75cccfcf"><div class="ttname"><a href="../../d0/dad/structast__aoc__charging__association.html#a4f6be1c174ff49ae4c0c696e75cccfcf">ast_aoc_charging_association::charging_type</a></div><div class="ttdeci">uint8_t charging_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00200">aoc.h:200</a></div></div>
<div class="ttc" id="ccss_8h_html_a64d38b6c2631ece08ca6f32620e02635"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a64d38b6c2631ece08ca6f32620e02635">ast_cc_monitor_request_acked</a></div><div class="ttdeci">int ast_cc_monitor_request_acked(int core_id, const char *const debug,...)</div><div class="ttdoc">Indicate that an outbound entity has accepted our CC request. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03787">ccss.c:3787</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_af1b1c1bbbca6309f8fe1071cd27aff80"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#af1b1c1bbbca6309f8fe1071cd27aff80">sig_pri_chan::cid_ani</a></div><div class="ttdeci">char cid_ani[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00301">sig_pri.h:301</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a83b017fb4ce4ea3a7754c4765231a2d0"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a83b017fb4ce4ea3a7754c4765231a2d0">sig_pri_callback::set_rdnis</a></div><div class="ttdeci">void(*const set_rdnis)(void *pvt, const char *rdnis)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00209">sig_pri.h:209</a></div></div>
<div class="ttc" id="structstasis__subscription_html"><div class="ttname"><a href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00681">stasis.c:681</a></div></div>
<div class="ttc" id="structast__aoc__charging__association_html_af21aeb9c83a66eea1b467b61bdb730f9"><div class="ttname"><a href="../../d0/dad/structast__aoc__charging__association.html#af21aeb9c83a66eea1b467b61bdb730f9">ast_aoc_charging_association::number</a></div><div class="ttdeci">struct ast_aoc_charging_association_number number</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00197">aoc.h:197</a></div></div>
<div class="ttc" id="channel_8h_html_a7ef6737309dc9e8b6c4a7cb4800638b1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a></div><div class="ttdeci">struct ast_frame * ast_read(struct ast_channel *chan)</div><div class="ttdoc">Reads a frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l04302">channel.c:4302</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a6d2c2c9d0c6665ccf044be9f3caddee8"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a6d2c2c9d0c6665ccf044be9f3caddee8">sig_pri_span::minidle</a></div><div class="ttdeci">int minidle</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00556">sig_pri.h:556</a></div></div>
<div class="ttc" id="stasis_8h_html_a31197e193b1dfd6c122ff6d7c7f6b3fa"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a31197e193b1dfd6c122ff6d7c7f6b3fa">STASIS_MESSAGE_TYPE_CLEANUP</a></div><div class="ttdeci">#define STASIS_MESSAGE_TYPE_CLEANUP(name)</div><div class="ttdoc">Boiler-plate messaging macro for cleaning up message types. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l01523">stasis.h:1523</a></div></div>
<div class="ttc" id="ccss_8h_html_a1400673f64bff290fb66d7c2bd8b7830"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a1400673f64bff290fb66d7c2bd8b7830">ast_cc_monitor_party_b_free</a></div><div class="ttdeci">int ast_cc_monitor_party_b_free(int core_id)</div><div class="ttdoc">Alert a caller that though the callee has become free, the caller himself is not and may not call bac...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l04051">ccss.c:4051</a></div></div>
<div class="ttc" id="chan__sip_8c_html_a495cc24c1947d49a2b6de488a45c9d72"><div class="ttname"><a href="../../d5/dfe/chan__sip_8c.html#a495cc24c1947d49a2b6de488a45c9d72">service</a></div><div class="ttdeci">enum ast_cc_service_type service</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dfe/chan__sip_8c_source.html#l00949">chan_sip.c:949</a></div></div>
<div class="ttc" id="callerid_8h_html_ab103476cd94e4c3dfeadf3dff48bb51f"><div class="ttname"><a href="../../de/d47/callerid_8h.html#ab103476cd94e4c3dfeadf3dff48bb51f">AST_PRES_USER_NUMBER_FAILED_SCREEN</a></div><div class="ttdeci">#define AST_PRES_USER_NUMBER_FAILED_SCREEN</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00320">callerid.h:320</a></div></div>
<div class="ttc" id="manager_8h_html_ab5db3cc603d7e798d61cb4cd94fbb4e2"><div class="ttname"><a href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a></div><div class="ttdeci">#define EVENT_FLAG_CALL</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00072">manager.h:72</a></div></div>
<div class="ttc" id="structast__party__name_html_a1fb9f03e5de01bf0a8f221e627fa9a7b"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html#a1fb9f03e5de01bf0a8f221e627fa9a7b">ast_party_name::char_set</a></div><div class="ttdeci">int char_set</div><div class="ttdoc">Character set the name is using. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00273">channel.h:273</a></div></div>
<div class="ttc" id="aoc_8h_html_a33b761090d3debbfd4cdb0c800a13bb2"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a33b761090d3debbfd4cdb0c800a13bb2">ast_aoc_destroy_decoded</a></div><div class="ttdeci">void * ast_aoc_destroy_decoded(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">free an ast_aoc_decoded object </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00307">aoc.c:307</a></div></div>
<div class="ttc" id="channel_8h_html_aa36854cfee90c77c4124e94273e42dffaf8519bddc355ac6ee509060476ad61cb"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffaf8519bddc355ac6ee509060476ad61cb">AST_PARTY_CHAR_SET_ISO8859_3</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00248">channel.h:248</a></div></div>
<div class="ttc" id="stasis_8h_html_a9356e8a29344ca4eac93088198ccff89"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_message_type(const struct stasis_message *msg)</div><div class="ttdoc">Get the message type for a stasis_message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00187">stasis_message.c:187</a></div></div>
<div class="ttc" id="structast__assigned__ids_html"><div class="ttname"><a href="../../da/de5/structast__assigned__ids.html">ast_assigned_ids</a></div><div class="ttdoc">Structure to pass both assignedid values to channel drivers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00605">channel.h:605</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a57a8b48f8536584c41c24d1672cf311f"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a57a8b48f8536584c41c24d1672cf311f">sig_pri_callback::deadlock_avoidance_private</a></div><div class="ttdeci">void(*const deadlock_avoidance_private)(void *pvt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00182">sig_pri.h:182</a></div></div>
<div class="ttc" id="pbx_8h_html_aa73d176ed4f1ce51e5db6beafba45fe3"><div class="ttname"><a href="../../db/de0/pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3">ast_ignore_pattern</a></div><div class="ttdeci">int ast_ignore_pattern(const char *context, const char *pattern)</div><div class="ttdoc">Checks to see if a number should be ignored. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06921">pbx.c:6921</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a5b02e99831df16498dcd2420091d2140"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a5b02e99831df16498dcd2420091d2140">sig_pri_callback::set_dialing</a></div><div class="ttdeci">void(*const set_dialing)(void *pvt, int is_dialing)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00204">sig_pri.h:204</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a></div><div class="ttdeci">ast_channel_state</div><div class="ttdoc">ast_channel states </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00035">channelstate.h:35</a></div></div>
<div class="ttc" id="channel_8h_html_a9e9505a91a84992d04ba4e85217fb4e4a2e185ce313026e13ed90ae3a319c9cb7"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l01122">channel.h:1122</a></div></div>
<div class="ttc" id="structast__party__name_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_name::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber name (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00265">channel.h:265</a></div></div>
<div class="ttc" id="structevent_html"><div class="ttname"><a href="../../df/d7d/structevent.html">event</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d4d/astman_8c_source.html#l00222">astman.c:222</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0d9283abd601d66a96d067641fbaa5e7a06b6af75bdaf9eac2404a54607d47644"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7a06b6af75bdaf9eac2404a54607d47644">SIG_PRI_MOH_STATE_NOTIFY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00088">sig_pri.h:88</a></div></div>
<div class="ttc" id="structsig__pri__chan_html"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html">sig_pri_chan</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00280">sig_pri.h:280</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a3127abc168dc41a3d2f0c953dc530945"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a3127abc168dc41a3d2f0c953dc530945">sig_pri_chan::resetting</a></div><div class="ttdeci">enum sig_pri_reset_state resetting</div><div class="ttdoc">Channel reset/restart state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00363">sig_pri.h:363</a></div></div>
<div class="ttc" id="structsched__id_html"><div class="ttname"><a href="../../d1/dab/structsched__id.html">sched_id</a></div><div class="ttdoc">Scheduler ID holder. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/sched_8c_source.html#l00070">sched.c:70</a></div></div>
<div class="ttc" id="aoc_8h_html_a3af9ee383a42048c9922f10ad0fc9e92"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a3af9ee383a42048c9922f10ad0fc9e92">ast_aoc_s_add_rate_special_charge_code</a></div><div class="ttdeci">int ast_aoc_s_add_rate_special_charge_code(struct ast_aoc_decoded *decoded, enum ast_aoc_s_charged_item charged_item, unsigned int code)</div><div class="ttdoc">Add AOC-S special rate entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00844">aoc.c:844</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a4bccf90ead0cf7c93b177e59cbe5b3be"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a4bccf90ead0cf7c93b177e59cbe5b3be">DAHDI_OVERLAPDIAL_OUTGOING</a></div><div class="ttdeci">#define DAHDI_OVERLAPDIAL_OUTGOING</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00254">sig_pri.h:254</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_adba320747780d0d17a681365e421af19"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#adba320747780d0d17a681365e421af19">sig_pri_chan::moh_state</a></div><div class="ttdeci">enum sig_pri_moh_state moh_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00317">sig_pri.h:317</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_aea53d06676b28028fe5faeb3e2124fde"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#aea53d06676b28028fe5faeb3e2124fde">sig_pri_chan::isidlecall</a></div><div class="ttdeci">unsigned int isidlecall</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00328">sig_pri.h:328</a></div></div>
<div class="ttc" id="bridge_8h_html_aadbf879fadde4b1bb7832b1390cc8c17a6b0053a1a47d100ef5f155f068c08934"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17a6b0053a1a47d100ef5f155f068c08934">AST_BRIDGE_TRANSFER_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d56/bridge_8h_source.html#l01117">bridge.h:1117</a></div></div>
<div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="strings_8h_html_a1088afdd862a49b0fce34ebe02df8ca1"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a></div><div class="ttdeci">int ast_str_append(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Append to a thread local dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01091">strings.h:1091</a></div></div>
<div class="ttc" id="chan__dahdi_8h_html_abcfd568d75fdb269f9c69cc5c6d980cd"><div class="ttname"><a href="../../d5/db3/chan__dahdi_8h.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a></div><div class="ttdeci">#define SIG_BRI_PTMP</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/db3/chan__dahdi_8h_source.html#l00747">chan_dahdi.h:747</a></div></div>
<div class="ttc" id="channel_8h_html_a1f58aea6d9e9c644a5ec802f45c6245d"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1f58aea6d9e9c644a5ec802f45c6245d">ast_channel_redirecting_effective_to</a></div><div class="ttdeci">struct ast_party_id ast_channel_redirecting_effective_to(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00920">channel_internal_api.c:920</a></div></div>
<div class="ttc" id="structast__party__subaddress_html_aaa04218f9e3a9065afa8be2491da8904"><div class="ttname"><a href="../../d7/d41/structast__party__subaddress.html#aaa04218f9e3a9065afa8be2491da8904">ast_party_subaddress::valid</a></div><div class="ttdeci">unsigned char valid</div><div class="ttdoc">TRUE if the subaddress information is valid/present. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00329">channel.h:329</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_ae1afa444c144734e495d110a36dfdb93"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#ae1afa444c144734e495d110a36dfdb93">sig_pri_chan::no_b_channel</a></div><div class="ttdeci">unsigned int no_b_channel</div><div class="ttdoc">TRUE if this interface has no B channel. (call hold and call waiting) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00345">sig_pri.h:345</a></div></div>
<div class="ttc" id="channel_8h_html_aab9499820db0745b46667b349932effe"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aab9499820db0745b46667b349932effe">ast_channel_redirecting_effective_orig</a></div><div class="ttdeci">struct ast_party_id ast_channel_redirecting_effective_orig(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00912">channel_internal_api.c:912</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a7573e5cc4c6a59a40ed97b5a09c799e2"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a7573e5cc4c6a59a40ed97b5a09c799e2">sig_pri_callback::set_callerid</a></div><div class="ttdeci">void(*const set_callerid)(void *pvt, const struct ast_party_caller *caller)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00207">sig_pri.h:207</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaaf5bdd6b252352433baf700ebf48546e3">SIG_PRI_RESET_IDLE</a></div><div class="ttdoc">The channel is not being RESTARTed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00154">sig_pri.h:154</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0b72d1d5eced390aeb8711c6ed61649f"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0b72d1d5eced390aeb8711c6ed61649f">sig_pri_ami_show_spans</a></div><div class="ttdeci">int sig_pri_ami_show_spans(struct mansession *s, const char *show_cmd, struct sig_pri_span *pri, const int *dchannels, const char *action_id)</div></div>
<div class="ttc" id="logger_8h_html_a6db44a7e26f0bc42801fc7225817c6a1"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a></div><div class="ttdeci">unsigned int ast_callid</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00087">logger.h:87</a></div></div>
<div class="ttc" id="structast__aoc__s__entry_html_a3b28fa9fd5a6e01aa753b433867531ab"><div class="ttname"><a href="../../d4/de4/structast__aoc__s__entry.html#a3b28fa9fd5a6e01aa753b433867531ab">ast_aoc_s_entry::charged_item</a></div><div class="ttdeci">uint16_t charged_item</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00166">aoc.h:166</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a5344deefcbdcca938001314e81ea195a"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a5344deefcbdcca938001314e81ea195a">AST_CONTROL_REDIRECTING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00300">include/asterisk/frame.h:300</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_ab68aa97314690deafd5da58f34579cb5"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#ab68aa97314690deafd5da58f34579cb5">sig_pri_callback::fixup_chans</a></div><div class="ttdeci">void(*const fixup_chans)(void *old_chan, void *new_chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00199">sig_pri.h:199</a></div></div>
<div class="ttc" id="structast__aoc__duration__rate_html_a4f6be1c174ff49ae4c0c696e75cccfcf"><div class="ttname"><a href="../../d6/d53/structast__aoc__duration__rate.html#a4f6be1c174ff49ae4c0c696e75cccfcf">ast_aoc_duration_rate::charging_type</a></div><div class="ttdeci">uint8_t charging_type</div><div class="ttdoc">Charging interval type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00122">aoc.h:122</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba28be7af387d47bea3bd030d452bd9ca7">SIG_PRI_MOH_EVENT_RESET</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00112">sig_pri.h:112</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00042">channelstate.h:42</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00282">include/asterisk/frame.h:282</a></div></div>
<div class="ttc" id="structsig__pri__span_html_abc70b7ddc748da4f3bfac3ac3e22d8bb"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#abc70b7ddc748da4f3bfac3ac3e22d8bb">sig_pri_span::dialplan</a></div><div class="ttdeci">int dialplan</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00506">sig_pri.h:506</a></div></div>
<div class="ttc" id="aoc_8h_html_a49977b1a5a71ee19edfc3f77f448e089a27a0c84a4d31cb0060200d36100c1c75"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a27a0c84a4d31cb0060200d36100c1c75">AST_AOC_MULT_HUNDRED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00040">aoc.h:40</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a62ee3212e1b83895e0e9c5095cb63cb6"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a62ee3212e1b83895e0e9c5095cb63cb6">sig_pri_span::localdialplan</a></div><div class="ttdeci">int localdialplan</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00507">sig_pri.h:507</a></div></div>
<div class="ttc" id="ccss_8h_html_a4dc7abb083c6d920fc6ed652f1b3e40fa1f46b662ae0b626724d2c8d90143c93a"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a4dc7abb083c6d920fc6ed652f1b3e40fa1f46b662ae0b626724d2c8d90143c93a">AST_CC_AGENT_RESPONSE_FAILURE_INVALID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00882">ccss.h:882</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_acd9db00336027462cfb25b97b5356883"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a></div><div class="ttdeci">static struct test_val c</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00048">test_linkedlists.c:48</a></div></div>
<div class="ttc" id="structchannel_html"><div class="ttname"><a href="../../d4/d84/structchannel.html">channel</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8a/muted_8c_source.html#l00095">muted.c:95</a></div></div>
<div class="ttc" id="app__queue_8c_html_a5633b1433389cec21ade3811bbe9ca5b"><div class="ttname"><a href="../../da/dfb/app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a></div><div class="ttdeci">char * text</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dfb/app__queue_8c_source.html#l01508">app_queue.c:1508</a></div></div>
<div class="ttc" id="time_8h_html_aca4ecdab7d8d3519062aad9a90fcb29d"><div class="ttname"><a href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a></div><div class="ttdeci">int64_t ast_tvdiff_ms(struct timeval end, struct timeval start)</div><div class="ttdoc">Computes the difference (in milliseconds) between two struct timeval instances. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00098">time.h:98</a></div></div>
<div class="ttc" id="extconf_8c_html_a81d26348827b996085d4cb6be3e2c348"><div class="ttname"><a href="../../d4/dc5/extconf_8c.html#a81d26348827b996085d4cb6be3e2c348">ast_verbose</a></div><div class="ttdeci">void ast_verbose(const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l02207">extconf.c:2207</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a82888352b7fb9230e3052d9aa0820199"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a82888352b7fb9230e3052d9aa0820199">sig_pri_span::localprefix</a></div><div class="ttdeci">char localprefix[20]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00511">sig_pri.h:511</a></div></div>
<div class="ttc" id="channel_8h_html_a5399dc7357197254794b990b263a2b7b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a5399dc7357197254794b990b263a2b7b">ast_party_id_free</a></div><div class="ttdeci">void ast_party_id_free(struct ast_party_id *doomed)</div><div class="ttdoc">Destroy the party id contents. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01811">channel.c:1811</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01032">astobj2.h:1032</a></div></div>
<div class="ttc" id="chan__pjsip_8c_html_acc941e909d1ca6a0997028d9562d78da"><div class="ttname"><a href="../../d0/d29/chan__pjsip_8c.html#acc941e909d1ca6a0997028d9562d78da">call</a></div><div class="ttdeci">static int call(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/chan__pjsip_8c_source.html#l02358">chan_pjsip.c:2358</a></div></div>
<div class="ttc" id="channel_8h_html_a40fc421536e02d30fecaa51a255b4144"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a40fc421536e02d30fecaa51a255b4144">ast_party_connected_line_free</a></div><div class="ttdeci">void ast_party_connected_line_free(struct ast_party_connected_line *doomed)</div><div class="ttdoc">Destroy the connected line information contents. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02072">channel.c:2072</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aae184c2fe57fb65661772d4772bd9444aebff40bc07274874bba2159ad5b22d73"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aebff40bc07274874bba2159ad5b22d73">SIG_PRI_CALL_LEVEL_SETUP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00139">sig_pri.h:139</a></div></div>
<div class="ttc" id="aoc_8h_html_aa49f963b5a453a69ff3480457aa4415a"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#aa49f963b5a453a69ff3480457aa4415a">ast_aoc_s_add_rate_volume</a></div><div class="ttdeci">int ast_aoc_s_add_rate_volume(struct ast_aoc_decoded *decoded, enum ast_aoc_s_charged_item charged_item, enum ast_aoc_volume_unit volume_unit, unsigned int amount, enum ast_aoc_currency_multiplier multiplier, const char *currency_name)</div><div class="ttdoc">Add AOC-S volume rate entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00822">aoc.c:822</a></div></div>
<div class="ttc" id="aoc_8h_html_a49977b1a5a71ee19edfc3f77f448e089"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089">ast_aoc_currency_multiplier</a></div><div class="ttdeci">ast_aoc_currency_multiplier</div><div class="ttdoc">Defines the currency multiplier for an aoc message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00034">aoc.h:34</a></div></div>
<div class="ttc" id="app__jack_8c_html_af25d6dc49269fa2003ac7c7fa6f13915"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></div><div class="ttdeci">const char * str</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00147">app_jack.c:147</a></div></div>
<div class="ttc" id="aoc_8h_html_a27f54e31b500e4b6e7396d345d5ed411a2d7ad212799bb6b541f626bcaf181168"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a2d7ad212799bb6b541f626bcaf181168">AST_AOC_CHARGED_ITEM_NA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00146">aoc.h:146</a></div></div>
<div class="ttc" id="ccss_8h_html_a4dc7abb083c6d920fc6ed652f1b3e40f"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a4dc7abb083c6d920fc6ed652f1b3e40f">ast_cc_agent_response_reason</a></div><div class="ttdeci">ast_cc_agent_response_reason</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00878">ccss.h:878</a></div></div>
<div class="ttc" id="file_8h_html"><div class="ttname"><a href="../../d2/d4d/file_8h.html">file.h</a></div><div class="ttdoc">Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include mod_format.h. </div></div>
<div class="ttc" id="structsig__pri__span_html_a3308f9fadc7b0c6c044b363e9bd731ae"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a3308f9fadc7b0c6c044b363e9bd731ae">sig_pri_span::switchtype</a></div><div class="ttdeci">int switchtype</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00558">sig_pri.h:558</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_adbe10c4b12619d6cb58b1ad14bc437af"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#adbe10c4b12619d6cb58b1ad14bc437af">sig_pri_chan::inalarm</a></div><div class="ttdeci">unsigned int inalarm</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00326">sig_pri.h:326</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ae1ccf2737a073b7016533eacd4ecaa1f"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ae1ccf2737a073b7016533eacd4ecaa1f">SIG_PRI_AOC_GRANT_S</a></div><div class="ttdeci">#define SIG_PRI_AOC_GRANT_S</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00053">sig_pri.h:53</a></div></div>
<div class="ttc" id="structsig__pri__span_html_abf9ffafb000af3843bc2a46a44927aa9"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#abf9ffafb000af3843bc2a46a44927aa9">sig_pri_span::dchanavail</a></div><div class="ttdeci">int dchanavail[SIG_PRI_NUM_DCHANS]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00592">sig_pri.h:592</a></div></div>
<div class="ttc" id="test__func__file_8c_html_a7df83d295429a2562396f1ec127a46c0"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a></div><div class="ttdeci">const char * args</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00046">test_func_file.c:46</a></div></div>
<div class="ttc" id="aoc_8h_html_ae2665f609286429cb5007507d7c800de"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#ae2665f609286429cb5007507d7c800de">ast_aoc_manager_event</a></div><div class="ttdeci">int ast_aoc_manager_event(const struct ast_aoc_decoded *decoded, struct ast_channel *chan)</div><div class="ttdoc">generate AOC manager event for an AOC-S, AOC-D, or AOC-E msg </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l01928">aoc.c:1928</a></div></div>
<div class="ttc" id="ccss_8h_html_ac83e01d7016c2eca52aa5748e91e1cd9"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#ac83e01d7016c2eca52aa5748e91e1cd9">ast_queue_cc_frame</a></div><div class="ttdeci">int ast_queue_cc_frame(struct ast_channel *chan, const char *const monitor_type, const char *const dialstring, enum ast_cc_service_type service, void *private_data)</div><div class="ttdoc">Queue an AST_CONTROL_CC frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l04149">ccss.c:4149</a></div></div>
<div class="ttc" id="aoc_8h_html_a328e01991ff5489d6289285654cb9402"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402">ast_aoc_time_scale</a></div><div class="ttdeci">ast_aoc_time_scale</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00087">aoc.h:87</a></div></div>
<div class="ttc" id="structast__party__subaddress_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d7/d41/structast__party__subaddress.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_subaddress::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Malloced subaddress string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00314">channel.h:314</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__channel_html_a8f64897c7ccc5c13f276d1d07c4e7095"><div class="ttname"><a href="../../df/d3c/structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">ast_channel::data</a></div><div class="ttdeci">const char * data</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00083">channel_internal_api.c:83</a></div></div>
<div class="ttc" id="ccss_8h_html_a037cc988c277a5a296ad1af1fb05f5a4"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a037cc988c277a5a296ad1af1fb05f5a4">ast_cc_agent_accept_request</a></div><div class="ttdeci">int ast_cc_agent_accept_request(int core_id, const char *const debug,...)</div><div class="ttdoc">Accept inbound CC request. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03776">ccss.c:3776</a></div></div>
<div class="ttc" id="structsig__pri__span_html_ae01f9ae44f2c09425d128bb826fc3dde"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#ae01f9ae44f2c09425d128bb826fc3dde">sig_pri_span::qsigchannelmapping</a></div><div class="ttdeci">int qsigchannelmapping</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00451">sig_pri.h:451</a></div></div>
<div class="ttc" id="structast__aoc__duration__rate_html_a070da2496793ccf8efc39f311bcda914"><div class="ttname"><a href="../../d6/d53/structast__aoc__duration__rate.html#a070da2496793ccf8efc39f311bcda914">ast_aoc_duration_rate::amount</a></div><div class="ttdeci">uint32_t amount</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00104">aoc.h:104</a></div></div>
<div class="ttc" id="structast__cc__monitor_html"><div class="ttname"><a href="../../d0/d6e/structast__cc__monitor.html">ast_cc_monitor</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00510">ccss.h:510</a></div></div>
<div class="ttc" id="structast__aoc__charging__association__number_html_a4c36514e1f80f8b79273614b4029d173"><div class="ttname"><a href="../../d9/d54/structast__aoc__charging__association__number.html#a4c36514e1f80f8b79273614b4029d173">ast_aoc_charging_association_number::plan</a></div><div class="ttdeci">uint8_t plan</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00191">aoc.h:191</a></div></div>
<div class="ttc" id="callerid_8h_html_a5cdbc47cd18e7f41d450e9caea186b1bac0f31b03872d178b92b054fb07358495"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a5cdbc47cd18e7f41d450e9caea186b1bac0f31b03872d178b92b054fb07358495">AST_CONNECTED_LINE_UPDATE_SOURCE_ANSWER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00446">callerid.h:446</a></div></div>
<div class="ttc" id="aoc_8h_html_a786ba86b9ee2950a6d9639ea85592d72"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a786ba86b9ee2950a6d9639ea85592d72">ast_aoc_s_add_rate_free</a></div><div class="ttdeci">int ast_aoc_s_add_rate_free(struct ast_aoc_decoded *decoded, enum ast_aoc_s_charged_item charged_item, int from_beginning)</div><div class="ttdoc">Add AOC-S indicating charge item is free. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00857">aoc.c:857</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a3f5929b7e2c310dc5d852c140402b0d6"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a3f5929b7e2c310dc5d852c140402b0d6">sig_pri_callback::dial_digits</a></div><div class="ttdeci">void(*const dial_digits)(void *pvt, const char *dial_string)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00216">sig_pri.h:216</a></div></div>
<div class="ttc" id="structsig__pri__span_html_ab29381dc8b7d60e0cb9cf74bf8c51ed8"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#ab29381dc8b7d60e0cb9cf74bf8c51ed8">sig_pri_span::colp_send</a></div><div class="ttdeci">enum sig_pri_colp_signaling colp_send</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00516">sig_pri.h:516</a></div></div>
<div class="ttc" id="ccss_8h_html_a4dc7abb083c6d920fc6ed652f1b3e40fa2c35ce5050e874998baefd43036f10f4"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a4dc7abb083c6d920fc6ed652f1b3e40fa2c35ce5050e874998baefd43036f10f4">AST_CC_AGENT_RESPONSE_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00880">ccss.h:880</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="cli_8h_html_a791bf9f5637185bee5e8f0907c762130"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a></div><div class="ttdeci">void ast_cli(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00006">clicompat.c:6</a></div></div>
<div class="ttc" id="bridge_8h_html_aadbf879fadde4b1bb7832b1390cc8c17"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17">ast_transfer_result</a></div><div class="ttdeci">ast_transfer_result</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d56/bridge_8h_source.html#l01115">bridge.h:1115</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a248afd6c02044259a386f6b7aee922a2"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a></div><div class="ttdeci">#define AST_FRAME_DTMF</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00139">include/asterisk/frame.h:139</a></div></div>
<div class="ttc" id="causes_8h_html_a29549b982646ee60f116fc4f55c711e5"><div class="ttname"><a href="../../d4/da3/causes_8h.html#a29549b982646ee60f116fc4f55c711e5">AST_CAUSE_INVALID_NUMBER_FORMAT</a></div><div class="ttdeci">#define AST_CAUSE_INVALID_NUMBER_FORMAT</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00115">causes.h:115</a></div></div>
<div class="ttc" id="ccss_8h_html_a6d36b7a6c430c9a9d9a773745db94354"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a6d36b7a6c430c9a9d9a773745db94354">ast_cc_agent_recalling</a></div><div class="ttdeci">int ast_cc_agent_recalling(int core_id, const char *const debug,...)</div><div class="ttdoc">Tell the CC core that a caller is currently recalling. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03831">ccss.c:3831</a></div></div>
<div class="ttc" id="aoc_8h_html_a49977b1a5a71ee19edfc3f77f448e089a865002098f4bc4e8e711bd3d2450f6bf"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a865002098f4bc4e8e711bd3d2450f6bf">AST_AOC_MULT_ONETHOUSANDTH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00035">aoc.h:35</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ae264fa3d1f9d29c2c76c99bfa13ce95ca95fc0cfdbf646707ffc820daff31fbb3"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ae264fa3d1f9d29c2c76c99bfa13ce95ca95fc0cfdbf646707ffc820daff31fbb3">SIG_PRI_TONE_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00064">sig_pri.h:64</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a3bfe76d33901513c27781d0d5a1b07dd"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a3bfe76d33901513c27781d0d5a1b07dd">sig_pri_span::inband_on_setup_ack</a></div><div class="ttdeci">unsigned int inband_on_setup_ack</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00493">sig_pri.h:493</a></div></div>
<div class="ttc" id="http_8c_html_af9b32121c4ad80b0887a3d73fd24de5f"><div class="ttname"><a href="../../dd/d43/http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a></div><div class="ttdeci">const char * ext</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00147">http.c:147</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a186c74500d7a3c1052e40dfd0d31f524"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a186c74500d7a3c1052e40dfd0d31f524">sig_pri_chan::chan_pvt</a></div><div class="ttdeci">void * chan_pvt</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00376">sig_pri.h:376</a></div></div>
<div class="ttc" id="ccss_8h_html_a50c1ff8b0de8119431904e2ce0064530"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530">ast_cc_service_type</a></div><div class="ttdeci">ast_cc_service_type</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00032">ccss.h:32</a></div></div>
<div class="ttc" id="structast__aoc__charging__association__number_html_a424ebc3ada265291282b9136b7c56555"><div class="ttname"><a href="../../d9/d54/structast__aoc__charging__association__number.html#a424ebc3ada265291282b9136b7c56555">ast_aoc_charging_association_number::number</a></div><div class="ttdeci">char number[32]</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00192">aoc.h:192</a></div></div>
<div class="ttc" id="musiconhold_8h_html_a52fead32f69533450f3c05b2e6960149"><div class="ttname"><a href="../../dc/d07/musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149">ast_moh_stop</a></div><div class="ttdeci">void ast_moh_stop(struct ast_channel *chan)</div><div class="ttdoc">Turn off music on hold on a given channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l07876">channel.c:7876</a></div></div>
<div class="ttc" id="callerid_8h_html_a681f7db5cdf14387bac29c1d220fe3b0"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a681f7db5cdf14387bac29c1d220fe3b0">AST_PRES_NETWORK_NUMBER</a></div><div class="ttdeci">#define AST_PRES_NETWORK_NUMBER</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00321">callerid.h:321</a></div></div>
<div class="ttc" id="ccss_8h_html_a9a078a59bc29f1ace8486ab9ecb774c4a302a65a5fc7468b6b96af0ec39eedae2"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4a302a65a5fc7468b6b96af0ec39eedae2">AST_CC_MONITOR_NEVER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00076">ccss.h:76</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a4cc7c3ad72e2848945d8c5a2bbdf7d68"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a4cc7c3ad72e2848945d8c5a2bbdf7d68">sig_pri_callback::module_ref</a></div><div class="ttdeci">void(* module_ref)(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00231">sig_pri.h:231</a></div></div>
<div class="ttc" id="structast__party__redirecting__reason_html_a45a5b7c00a796a23f01673cef1dbe0a9"><div class="ttname"><a href="../../d1/dee/structast__party__redirecting__reason.html#a45a5b7c00a796a23f01673cef1dbe0a9">ast_party_redirecting_reason::code</a></div><div class="ttdeci">int code</div><div class="ttdoc">enum AST_REDIRECTING_REASON value for redirection </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00511">channel.h:511</a></div></div>
<div class="ttc" id="structast__party__subaddress_html_a141590e40aa10259d3c0bc722725e7ad"><div class="ttname"><a href="../../d7/d41/structast__party__subaddress.html#a141590e40aa10259d3c0bc722725e7ad">ast_party_subaddress::odd_even_indicator</a></div><div class="ttdeci">unsigned char odd_even_indicator</div><div class="ttdoc">TRUE if odd number of address signals. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00327">channel.h:327</a></div></div>
<div class="ttc" id="logger_8h_html_ad770f83c71e237e1f64163358ce4e13d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a></div><div class="ttdeci">#define ast_verb(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00463">logger.h:463</a></div></div>
<div class="ttc" id="ccss_8h_html_a2fd3a95509d01b9ed748148277b753f6"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a2fd3a95509d01b9ed748148277b753f6">ast_cc_is_recall</a></div><div class="ttdeci">int ast_cc_is_recall(struct ast_channel *chan, int *core_id, const char *const monitor_type)</div><div class="ttdoc">Decide if a call to a particular channel is a CC recall. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03438">ccss.c:3438</a></div></div>
<div class="ttc" id="manager_8h_html_a3ace32eaf9a3fc2f7d15121c64bf8ecd"><div class="ttname"><a href="../../db/d45/manager_8h.html#a3ace32eaf9a3fc2f7d15121c64bf8ecd">ast_manager_event_blob_create</a></div><div class="ttdeci">struct ast_manager_event_blob * ast_manager_event_blob_create(int event_flags, const char *manager_event, const char *extra_fields_fmt,...)</div><div class="ttdoc">Construct a ast_manager_event_blob. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l09727">manager.c:9727</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a2233cac6ec393376a4d82418b4f158c9"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a2233cac6ec393376a4d82418b4f158c9">sig_pri_extract_called_num_subaddr</a></div><div class="ttdeci">void sig_pri_extract_called_num_subaddr(struct sig_pri_chan *p, const char *rdest, char *called, size_t called_buff_size)</div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390af9665e40f4c9ef6fcfc3e179c6986c41"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390af9665e40f4c9ef6fcfc3e179c6986c41">AST_CONTROL_PVT_CAUSE_CODE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00310">include/asterisk/frame.h:310</a></div></div>
<div class="ttc" id="lock_8h_html_a8a3bd496edfec04a95683ace66676200"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a></div><div class="ttdeci">int ast_atomic_fetchadd_int(volatile int *p, int v)</div><div class="ttdoc">Atomically add v to *p and return the previous value of *p. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00755">lock.h:755</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a5e796d7f69b1a3e73ee47bd97a119ce4"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a5e796d7f69b1a3e73ee47bd97a119ce4">sig_pri_callback::unlock_private</a></div><div class="ttdeci">void(*const unlock_private)(void *pvt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00178">sig_pri.h:178</a></div></div>
<div class="ttc" id="ccss_8h_html_a9a078a59bc29f1ace8486ab9ecb774c4"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4">ast_cc_monitor_policies</a></div><div class="ttdeci">ast_cc_monitor_policies</div><div class="ttdoc">The various possibilities for cc_monitor_policy values. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00074">ccss.h:74</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0521b3661ec0c6d0b664abe98f84c5baa580981a034a497c0a43e3c7b5eef227d"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0521b3661ec0c6d0b664abe98f84c5baa580981a034a497c0a43e3c7b5eef227d">SIG_PRI_ULAW</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00069">sig_pri.h:69</a></div></div>
<div class="ttc" id="pbx_8h_html_a93f9868530c1e8a9d9d367d1ead8782e"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a93f9868530c1e8a9d9d367d1ead8782e">ast_canmatch_extension</a></div><div class="ttdeci">int ast_canmatch_extension(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)</div><div class="ttdoc">Looks for a valid matching extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04194">pbx.c:4194</a></div></div>
<div class="ttc" id="logger_8h_html_a9e325f2d0c2872627a05feff17423f80"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a9e325f2d0c2872627a05feff17423f80">ast_callid_threadassoc_remove</a></div><div class="ttdeci">int ast_callid_threadassoc_remove(void)</div><div class="ttdoc">Removes callid from thread storage of the calling thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/logger_8c_source.html#l02003">logger.c:2003</a></div></div>
<div class="ttc" id="pbx_8h_html_a98c5425b90ec7c5e136a40f529170b1b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a></div><div class="ttdeci">const char * pbx_builtin_getvar_helper(struct ast_channel *chan, const char *name)</div><div class="ttdoc">Return a pointer to the value of the corresponding channel variable. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l01000">pbx_variables.c:1000</a></div></div>
<div class="ttc" id="aoc_8h_html_adfa4093a881618aef565ef412962cccca8a14ac00143374e3e9495680cae78ec0"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#adfa4093a881618aef565ef412962cccca8a14ac00143374e3e9495680cae78ec0">AST_AOC_REQUEST_E</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00079">aoc.h:79</a></div></div>
<div class="ttc" id="aoc_8h_html_a8ae6592d8c3d40717734be55c9c522e9"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a8ae6592d8c3d40717734be55c9c522e9">ast_aoc_s_get_rate_info</a></div><div class="ttdeci">const struct ast_aoc_s_entry * ast_aoc_s_get_rate_info(struct ast_aoc_decoded *decoded, unsigned int entry_number)</div><div class="ttdoc">get a specific AOC-S rate entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00761">aoc.c:761</a></div></div>
<div class="ttc" id="structast__frame_html_a27237c48fdcd22556401f20c693811db"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">ast_frame::subclass</a></div><div class="ttdeci">struct ast_frame_subclass subclass</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00169">include/asterisk/frame.h:169</a></div></div>
<div class="ttc" id="channel_8h_html_a7df9da0e99e443d7ae13dc07bbc57dcd"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7df9da0e99e443d7ae13dc07bbc57dcd">ast_channel_get_cc_config_params</a></div><div class="ttdeci">struct ast_cc_config_params * ast_channel_get_cc_config_params(struct ast_channel *chan)</div><div class="ttdoc">Get the CCSS parameters from a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10675">channel.c:10675</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_acf6f33eb3b0b5cc3ffa093f595e8b7e7"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#acf6f33eb3b0b5cc3ffa093f595e8b7e7">sig_pri_chan::mastertrunkgroup</a></div><div class="ttdeci">int mastertrunkgroup</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00370">sig_pri.h:370</a></div></div>
<div class="ttc" id="structsig__pri__span_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#adf04f66344e3fb0a6f6a69bf39d19902">sig_pri_span::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00618">sig_pri.h:618</a></div></div>
<div class="ttc" id="utils_8h_html"><div class="ttname"><a href="../../d5/d60/utils_8h.html">utils.h</a></div><div class="ttdoc">Utility functions. </div></div>
<div class="ttc" id="aoc_8h_html_a49977b1a5a71ee19edfc3f77f448e089ab55dc209b59be84c7162d3128565ab36"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089ab55dc209b59be84c7162d3128565ab36">AST_AOC_MULT_ONE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00038">aoc.h:38</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00292">include/asterisk/frame.h:292</a></div></div>
<div class="ttc" id="structast__channel__blob_html"><div class="ttname"><a href="../../db/df0/structast__channel__blob.html">ast_channel_blob</a></div><div class="ttdoc">Blob of data associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/stasis__channels_8h_source.html#l00184">stasis_channels.h:184</a></div></div>
<div class="ttc" id="callerid_8h_html_a405736564654ff0e5a98d4be4c57b16c"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a405736564654ff0e5a98d4be4c57b16c">AST_PRES_RESTRICTED</a></div><div class="ttdeci">#define AST_PRES_RESTRICTED</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00325">callerid.h:325</a></div></div>
<div class="ttc" id="structsig__pri__span_html_aa0e541bb0229ec83998375ddec7d4704"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#aa0e541bb0229ec83998375ddec7d4704">sig_pri_span::no_d_channels</a></div><div class="ttdeci">unsigned int no_d_channels</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00600">sig_pri.h:600</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a3b4d33874153cde6eb4337024fdbf66e"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a3b4d33874153cde6eb4337024fdbf66e">sig_pri_hangup</a></div><div class="ttdeci">int sig_pri_hangup(struct sig_pri_chan *p, struct ast_channel *ast)</div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="ccss_8h_html_aafed4bcde7e857db88ca60471e709a55"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#aafed4bcde7e857db88ca60471e709a55">ast_get_cc_monitor_policy</a></div><div class="ttdeci">enum ast_cc_monitor_policies ast_get_cc_monitor_policy(struct ast_cc_config_params *config)</div><div class="ttdoc">Get the cc_monitor_policy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l00883">ccss.c:883</a></div></div>
<div class="ttc" id="structast__aoc__duration__rate_html_a2c5b15b6851f558acabe1294d0e84e1c"><div class="ttname"><a href="../../d6/d53/structast__aoc__duration__rate.html#a2c5b15b6851f558acabe1294d0e84e1c">ast_aoc_duration_rate::multiplier</a></div><div class="ttdeci">uint16_t multiplier</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00109">aoc.h:109</a></div></div>
<div class="ttc" id="sig__pri_8h_html_afcdccfdff4540316777dbfbc930d4c28"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#afcdccfdff4540316777dbfbc930d4c28">pri_send_keypad_facility_exec</a></div><div class="ttdeci">int pri_send_keypad_facility_exec(struct sig_pri_chan *p, const char *digits)</div></div>
<div class="ttc" id="structsig__pri__callback_html_a34bcd49ca1d689da83ba4f67a5601d0e"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a34bcd49ca1d689da83ba4f67a5601d0e">sig_pri_callback::destroy_later</a></div><div class="ttdeci">void(* destroy_later)(struct sig_pri_span *pri)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00235">sig_pri.h:235</a></div></div>
<div class="ttc" id="structast__party__redirecting_html_ad91368b8b243737d0a7fb6644f35809e"><div class="ttname"><a href="../../df/d44/structast__party__redirecting.html#ad91368b8b243737d0a7fb6644f35809e">ast_party_redirecting::orig</a></div><div class="ttdeci">struct ast_party_id orig</div><div class="ttdoc">Who originally redirected the call (Sent to the party the call is redirected toward) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00525">channel.h:525</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a520a3c6b7d57903d9a616051da1a019d"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a520a3c6b7d57903d9a616051da1a019d">AST_APP_OPTIONS</a></div><div class="ttdeci">#define AST_APP_OPTIONS(holder, options...)</div><div class="ttdoc">Declares an array of options for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01393">include/asterisk/app.h:1393</a></div></div>
<div class="ttc" id="utils_8h_html_a595e2f8aa398f4bd21e381c3211235fe"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a></div><div class="ttdeci">#define ast_pthread_create_background(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00567">utils.h:567</a></div></div>
<div class="ttc" id="test__amihooks_8c_html_a5992b274cfdcacdbc1fa8347fd01ebde"><div class="ttname"><a href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a></div><div class="ttdeci">int done</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dbf/test__amihooks_8c_source.html#l00048">test_amihooks.c:48</a></div></div>
<div class="ttc" id="aoc_8h_html_a655f2e3693ef15ab3bdfc623807278a7"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a655f2e3693ef15ab3bdfc623807278a7">ast_aoc_set_association_number</a></div><div class="ttdeci">int ast_aoc_set_association_number(struct ast_aoc_decoded *decoded, const char *num, uint8_t plan)</div><div class="ttdoc">set the charging accociation number for an AOC-E message </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l01056">aoc.c:1056</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a97a6fe4247dbe0925678132c6a85cbfd"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a97a6fe4247dbe0925678132c6a85cbfd">sig_pri_callback::open_media</a></div><div class="ttdeci">void(*const open_media)(void *pvt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00218">sig_pri.h:218</a></div></div>
<div class="ttc" id="structnumber_html"><div class="ttname"><a href="../../d6/d49/structnumber.html">number</a></div><div class="ttdoc">Number structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d55/app__followme_8c_source.html#l00154">app_followme.c:154</a></div></div>
<div class="ttc" id="aoc_8h_html_ac1f3beff212225f7a1b240cdc60616b5"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#ac1f3beff212225f7a1b240cdc60616b5">ast_aoc_s_get_count</a></div><div class="ttdeci">unsigned int ast_aoc_s_get_count(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">get the number rates associated with an AOC-S message </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00756">aoc.c:756</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a4a241e7a091450755eff816444917822">SIG_PRI_CALL_LEVEL_CONNECT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00149">sig_pri.h:149</a></div></div>
<div class="ttc" id="logger_8h_html_a6956becf4d7e3906c74b6e30b834ebd8"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a6956becf4d7e3906c74b6e30b834ebd8">ast_callid_threadassoc_add</a></div><div class="ttdeci">int ast_callid_threadassoc_add(ast_callid callid)</div><div class="ttdoc">Adds a known callid to thread storage of the calling thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/logger_8c_source.html#l01984">logger.c:1984</a></div></div>
<div class="ttc" id="channel_8h_html_aa36854cfee90c77c4124e94273e42dff"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dff">AST_PARTY_CHAR_SET</a></div><div class="ttdeci">AST_PARTY_CHAR_SET</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00243">channel.h:243</a></div></div>
<div class="ttc" id="structast__party__caller_html_a8791d240f8a9c2dc271a1c8542cfe8cc"><div class="ttname"><a href="../../d4/d77/structast__party__caller.html#a8791d240f8a9c2dc271a1c8542cfe8cc">ast_party_caller::id</a></div><div class="ttdeci">struct ast_party_id id</div><div class="ttdoc">Caller party ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00421">channel.h:421</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a7a4b7cc6cdb12c93fb29608a110614dc"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a7a4b7cc6cdb12c93fb29608a110614dc">sig_pri_init_pri</a></div><div class="ttdeci">void sig_pri_init_pri(struct sig_pri_span *pri)</div></div>
<div class="ttc" id="sig__pri_8h_html_a0521b3661ec0c6d0b664abe98f84c5baab76a82ed2436d4803b139cdcf4099d82"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0521b3661ec0c6d0b664abe98f84c5baab76a82ed2436d4803b139cdcf4099d82">SIG_PRI_ALAW</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00070">sig_pri.h:70</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a3120f0107c2854fc676067477f135d86"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a3120f0107c2854fc676067477f135d86">sig_pri_callback::play_tone</a></div><div class="ttdeci">int(*const play_tone)(void *pvt, enum sig_pri_tone tone)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00189">sig_pri.h:189</a></div></div>
<div class="ttc" id="callerid_8h_html_a84c18283fee396ec5947fc497dd39169ac0b65b437eabc6c251883b9094d74b5e"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169ac0b65b437eabc6c251883b9094d74b5e">AST_REDIRECTING_REASON_UNCONDITIONAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00395">callerid.h:395</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a6b49cafa2a3d359a2e865992f551874a"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a></div><div class="ttdeci">static char mailbox[AST_MAX_MAILBOX_UNIQUEID]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00204">chan_mgcp.c:204</a></div></div>
<div class="ttc" id="structast__frame__subclass_html_adece183191b0e700e039e59101e06105"><div class="ttname"><a href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">ast_frame_subclass::integer</a></div><div class="ttdeci">int integer</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00152">include/asterisk/frame.h:152</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="channel_8h_html_aa36854cfee90c77c4124e94273e42dffaea8e3dae9ceb06346c30d6543084283c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffaea8e3dae9ceb06346c30d6543084283c">AST_PARTY_CHAR_SET_ISO10646_UTF_8STRING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00253">channel.h:253</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a56415faa5c5e128797e8a3ebcc5eaff4"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a56415faa5c5e128797e8a3ebcc5eaff4">sig_pri_cc_monitor_cancel_available_timer</a></div><div class="ttdeci">int sig_pri_cc_monitor_cancel_available_timer(struct ast_cc_monitor *monitor, int *sched_id)</div></div>
<div class="ttc" id="structsig__pri__span_html_a4149ab7462729c97cf44d6389abf0989"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a4149ab7462729c97cf44d6389abf0989">sig_pri_span::unknownprefix</a></div><div class="ttdeci">char unknownprefix[20]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00513">sig_pri.h:513</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00297">include/asterisk/frame.h:297</a></div></div>
<div class="ttc" id="aoc_8h_html"><div class="ttname"><a href="../../d6/db3/aoc_8h.html">aoc.h</a></div><div class="ttdoc">Generic Advice of Charge encode and decode routines. </div></div>
<div class="ttc" id="chan__dahdi_8h_html_ab5bfeaf991c23c5b6510ace44ae79ce9"><div class="ttname"><a href="../../d5/db3/chan__dahdi_8h.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a></div><div class="ttdeci">#define SIG_BRI</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/db3/chan__dahdi_8h_source.html#l00746">chan_dahdi.h:746</a></div></div>
<div class="ttc" id="aoc_8h_html_a3849b484bd42840860ada0ac3db4f96d"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a3849b484bd42840860ada0ac3db4f96d">ast_aoc_decode</a></div><div class="ttdeci">struct ast_aoc_decoded * ast_aoc_decode(struct ast_aoc_encoded *encoded, size_t size, struct ast_channel *chan)</div><div class="ttdoc">decodes an encoded aoc payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00449">aoc.c:449</a></div></div>
<div class="ttc" id="channel_8h_html_ade57349a78b2f32d3a7d1bc01fb3bf96"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ade57349a78b2f32d3a7d1bc01fb3bf96">ast_channel_queue_connected_line_update</a></div><div class="ttdeci">void ast_channel_queue_connected_line_update(struct ast_channel *chan, const struct ast_party_connected_line *connected, const struct ast_set_party_connected_line *update)</div><div class="ttdoc">Queue a connected line update frame on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l09202">channel.c:9202</a></div></div>
<div class="ttc" id="ccss_8h_html_ac943e39777b9c5ac58c4b4802b7347c6"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#ac943e39777b9c5ac58c4b4802b7347c6">ast_cc_agent_set_interfaces_chanvar</a></div><div class="ttdeci">int ast_cc_agent_set_interfaces_chanvar(struct ast_channel *chan)</div><div class="ttdoc">Set the first level CC_INTERFACES channel variable for a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03631">ccss.c:3631</a></div></div>
<div class="ttc" id="callerid_8h_html_a24813a6a337abb76e92c7f226f68c3cd"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a24813a6a337abb76e92c7f226f68c3cd">AST_PRES_USER_NUMBER_UNSCREENED</a></div><div class="ttdeci">#define AST_PRES_USER_NUMBER_UNSCREENED</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00318">callerid.h:318</a></div></div>
<div class="ttc" id="structast__cc__monitor_html_a72a2c55008105f91d1af2942453eca2b"><div class="ttname"><a href="../../d0/d6e/structast__cc__monitor.html#a72a2c55008105f91d1af2942453eca2b">ast_cc_monitor::core_id</a></div><div class="ttdeci">int core_id</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00528">ccss.h:528</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a5a3260750dabe2ed9d7bd1e2e892329d"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a5a3260750dabe2ed9d7bd1e2e892329d">sig_pri_span::inband_on_proceeding</a></div><div class="ttdeci">unsigned int inband_on_proceeding</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00495">sig_pri.h:495</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0521b3661ec0c6d0b664abe98f84c5ba"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0521b3661ec0c6d0b664abe98f84c5ba">sig_pri_law</a></div><div class="ttdeci">sig_pri_law</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00067">sig_pri.h:67</a></div></div>
<div class="ttc" id="structast__aoc__s__entry_html_a3864d3b889994b88c025a7819c5e0749"><div class="ttname"><a href="../../d4/de4/structast__aoc__s__entry.html#a3864d3b889994b88c025a7819c5e0749">ast_aoc_s_entry::special_code</a></div><div class="ttdeci">uint16_t special_code</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00174">aoc.h:174</a></div></div>
<div class="ttc" id="channel_8h_html_aa9a1d01546e0fc0047e56ba589790b6f"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa9a1d01546e0fc0047e56ba589790b6f">ast_set_hangupsource</a></div><div class="ttdeci">void ast_set_hangupsource(struct ast_channel *chan, const char *source, int force)</div><div class="ttdoc">Set the source of the hangup in this channel and it&amp;#39;s bridge. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02504">channel.c:2504</a></div></div>
<div class="ttc" id="lock_8h_html_a987fc536e8b6a1044689eca873610792"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a987fc536e8b6a1044689eca873610792">ast_mutex_trylock</a></div><div class="ttdeci">#define ast_mutex_trylock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00189">lock.h:189</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a0368d49962f1bf26c2603ade03cd8ee9"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a0368d49962f1bf26c2603ade03cd8ee9">sig_pri_chan::dialdest</a></div><div class="ttdeci">char dialdest[256]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00308">sig_pri.h:308</a></div></div>
<div class="ttc" id="aoc_8h_html_a27f54e31b500e4b6e7396d345d5ed411"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411">ast_aoc_s_charged_item</a></div><div class="ttdeci">ast_aoc_s_charged_item</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00145">aoc.h:145</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="aoc_8h_html_a7558fd4fc6c76430875d931bd16b7b1da83b02bda7920334b1d7cb85c53be1d50"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da83b02bda7920334b1d7cb85c53be1d50">AST_AOC_BILLING_NORMAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00051">aoc.h:51</a></div></div>
<div class="ttc" id="structast__party__redirecting_html_aa17ec85399145e14c9f08d81a2261231"><div class="ttname"><a href="../../df/d44/structast__party__redirecting.html#aa17ec85399145e14c9f08d81a2261231">ast_party_redirecting::orig_reason</a></div><div class="ttdeci">struct ast_party_redirecting_reason orig_reason</div><div class="ttdoc">Reason for the redirection by the original party. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00546">channel.h:546</a></div></div>
<div class="ttc" id="ccss_8h_html_a4dc7abb083c6d920fc6ed652f1b3e40fafd230e8ed54f4d0d5158d571eeb57e3c"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a4dc7abb083c6d920fc6ed652f1b3e40fafd230e8ed54f4d0d5158d571eeb57e3c">AST_CC_AGENT_RESPONSE_FAILURE_TOO_MANY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00884">ccss.h:884</a></div></div>
<div class="ttc" id="ccss_8h_html_a3d7883a7ab60e13e2697fccb74ed5d8d"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a3d7883a7ab60e13e2697fccb74ed5d8d">ast_setup_cc_recall_datastore</a></div><div class="ttdeci">int ast_setup_cc_recall_datastore(struct ast_channel *chan, const int core_id)</div><div class="ttdoc">Set up a CC recall datastore on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03405">ccss.c:3405</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0d9283abd601d66a96d067641fbaa5e7abc2ce0250707ac2dc988b32ba98cad31"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7abc2ce0250707ac2dc988b32ba98cad31">SIG_PRI_MOH_STATE_MOH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00090">sig_pri.h:90</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga920b9d3e484257c7e593452a8e36d8d4"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga920b9d3e484257c7e593452a8e36d8d4">ast_channel_stage_snapshot_done</a></div><div class="ttdeci">void ast_channel_stage_snapshot_done(struct ast_channel *chan)</div><div class="ttdoc">Clear flag to indicate channel snapshot is being staged, and publish snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l01043">stasis_channels.c:1043</a></div></div>
<div class="ttc" id="channel_8h_html_adaa84a3e1b57ef0c912b57699fc0ddc9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#adaa84a3e1b57ef0c912b57699fc0ddc9">ast_party_subaddress_free</a></div><div class="ttdeci">void ast_party_subaddress_free(struct ast_party_subaddress *doomed)</div><div class="ttdoc">Destroy the party subaddress contents. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01744">channel.c:1744</a></div></div>
<div class="ttc" id="channel_8h_html_a10f23f1907b804485f62973f66cd9aef"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a10f23f1907b804485f62973f66cd9aef">ast_channel_connected</a></div><div class="ttdeci">struct ast_party_connected_line * ast_channel_connected(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00892">channel_internal_api.c:892</a></div></div>
<div class="ttc" id="structast__control__pvt__cause__code_html_a9f49ca84424b69a07af7d0d8c84e612f"><div class="ttname"><a href="../../d9/d2d/structast__control__pvt__cause__code.html#a9f49ca84424b69a07af7d0d8c84e612f">ast_control_pvt_cause_code::code</a></div><div class="ttdeci">char code[1]</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00417">include/asterisk/frame.h:417</a></div></div>
<div class="ttc" id="sig__pri_8h_html_af7cb1e2aed71f615817a08e3b27044c0"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#af7cb1e2aed71f615817a08e3b27044c0">sig_pri_cc_agent_stop_ringing</a></div><div class="ttdeci">int sig_pri_cc_agent_stop_ringing(struct ast_cc_agent *agent)</div></div>
<div class="ttc" id="aoc_8h_html_ae9395e09a678474ae3a5e6bf4ab72f5f"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#ae9395e09a678474ae3a5e6bf4ab72f5f">ast_aoc_s_add_rate_na</a></div><div class="ttdeci">int ast_aoc_s_add_rate_na(struct ast_aoc_decoded *decoded, enum ast_aoc_s_charged_item charged_item)</div><div class="ttdoc">Add AOC-S entry indicating charge item is not available. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00869">aoc.c:869</a></div></div>
<div class="ttc" id="lock_8h_html_a6009440c7a72f8e2e3b1ec97641ad160"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a></div><div class="ttdeci">#define AST_PTHREADT_NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00066">lock.h:66</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_ae485b093be94ace2ac61433abb70d3f1"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#ae485b093be94ace2ac61433abb70d3f1">sig_pri_chan::stripmsd</a></div><div class="ttdeci">int stripmsd</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00291">sig_pri.h:291</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a9b9ab6e7503bed528d927cbc7fb5c54b"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a9b9ab6e7503bed528d927cbc7fb5c54b">sig_pri_chan::call_level</a></div><div class="ttdeci">enum sig_pri_call_level call_level</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00361">sig_pri.h:361</a></div></div>
<div class="ttc" id="aoc_8h_html_abbf1344a7eae88ea2cef85c1b0b6c24d"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#abbf1344a7eae88ea2cef85c1b0b6c24d">ast_aoc_encode</a></div><div class="ttdeci">struct ast_aoc_encoded * ast_aoc_encode(struct ast_aoc_decoded *decoded, size_t *out_size, struct ast_channel *chan)</div><div class="ttdoc">encodes a decoded aoc structure so it can be passed on the wire </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00650">aoc.c:650</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00053">devicestate.h:53</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_ad0f583995b62c8aaac419e06a0c5ce4b"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#ad0f583995b62c8aaac419e06a0c5ce4b">sig_pri_callback::handle_dchan_exception</a></div><div class="ttdeci">void(*const handle_dchan_exception)(struct sig_pri_span *pri, int index)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00202">sig_pri.h:202</a></div></div>
<div class="ttc" id="channel_8h_html_af4e59494f74ad9e0c50170d9e276ad31"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a></div><div class="ttdeci">#define AST_MAX_EXTENSION</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00135">channel.h:135</a></div></div>
<div class="ttc" id="callerid_8h_html_a84c18283fee396ec5947fc497dd39169ab66eaca00d890abee0495c676b5789b1"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169ab66eaca00d890abee0495c676b5789b1">AST_REDIRECTING_REASON_DEFLECTION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00398">callerid.h:398</a></div></div>
<div class="ttc" id="structast__frame_html_ad67e07841d1233e596e6f822a3c81f6b"><div class="ttname"><a href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">ast_frame::datalen</a></div><div class="ttdeci">int datalen</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00171">include/asterisk/frame.h:171</a></div></div>
<div class="ttc" id="strings_8h_html_ac92713b8d07a45720b2664be70810e55"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a></div><div class="ttdeci">char * ast_strip(char *s)</div><div class="ttdoc">Strip leading/trailing whitespace from a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00219">strings.h:219</a></div></div>
<div class="ttc" id="causes_8h_html_af2235eb1c27925e4020ce286255d165f"><div class="ttname"><a href="../../d4/da3/causes_8h.html#af2235eb1c27925e4020ce286255d165f">AST_CAUSE_NORMAL_CLEARING</a></div><div class="ttdeci">#define AST_CAUSE_NORMAL_CLEARING</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00105">causes.h:105</a></div></div>
<div class="ttc" id="structast__party__caller_html"><div class="ttname"><a href="../../d4/d77/structast__party__caller.html">ast_party_caller</a></div><div class="ttdoc">Caller Party information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00419">channel.h:419</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
<div class="ttc" id="aoc_8h_html_a7558fd4fc6c76430875d931bd16b7b1dad1092f5f7da0428ebd4c6ec4ed78d751"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1dad1092f5f7da0428ebd4c6ec4ed78d751">AST_AOC_BILLING_REVERSE_CHARGE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00052">aoc.h:52</a></div></div>
<div class="ttc" id="strings_8h_html_a38a896048b2ca84076864505f0aa8f01"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a></div><div class="ttdeci">#define S_COR(a, b, c)</div><div class="ttdoc">returns the equivalent of logic or for strings, with an additional boolean check: second one if not e...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00085">strings.h:85</a></div></div>
<div class="ttc" id="structmansession_html"><div class="ttname"><a href="../../d2/d8a/structmansession.html">mansession</a></div><div class="ttdoc">In case you didn&amp;#39;t read that giant block of text above the mansession_session struct, the struct mansession is named this solely to keep the API the same in Asterisk. This structure really represents data that is different from Manager action to Manager action. The mansession_session pointer contained within points to session-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01625">manager.c:1625</a></div></div>
<div class="ttc" id="ccss_8h_html_a50c1ff8b0de8119431904e2ce0064530aa9c4c6035dbb586ac72385084df5c16a"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530aa9c4c6035dbb586ac72385084df5c16a">AST_CC_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00034">ccss.h:34</a></div></div>
<div class="ttc" id="ccss_8h_html_ac2a5064d0e089814ba93dc2aefacdd09"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#ac2a5064d0e089814ba93dc2aefacdd09">ast_cc_agent_caller_available</a></div><div class="ttdeci">int ast_cc_agent_caller_available(int core_id, const char *const debug,...)</div><div class="ttdoc">Indicate that a previously unavailable caller has become available. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03820">ccss.c:3820</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="structast__aoc__s__entry_html_a0e300d9871c2a507068dda6d12617d30"><div class="ttname"><a href="../../d4/de4/structast__aoc__s__entry.html#a0e300d9871c2a507068dda6d12617d30">ast_aoc_s_entry::flat</a></div><div class="ttdeci">struct ast_aoc_flat_rate flat</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00172">aoc.h:172</a></div></div>
<div class="ttc" id="structsig__pri__span_html_ae384fc9ad39051984beca025ded44f41"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#ae384fc9ad39051984beca025ded44f41">sig_pri_span::internationalprefix</a></div><div class="ttdeci">char internationalprefix[10]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00509">sig_pri.h:509</a></div></div>
<div class="ttc" id="structast__aoc__flat__rate_html_a2854e091b0a0f6c8da639ced777fe99d"><div class="ttname"><a href="../../d9/d7a/structast__aoc__flat__rate.html#a2854e091b0a0f6c8da639ced777fe99d">ast_aoc_flat_rate::currency_name</a></div><div class="ttdeci">char currency_name[AOC_CURRENCY_NAME_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00142">aoc.h:142</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a15d8af230a5c303359f79b7d1d3e3a1ba656e095f1a501561bcd791e27dc4cb1b"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba656e095f1a501561bcd791e27dc4cb1b">SIG_PRI_MOH_EVENT_HOLD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00114">sig_pri.h:114</a></div></div>
<div class="ttc" id="json_8h_html_a6772fcee88746a9d4f6ec6f240b76dd0"><div class="ttname"><a href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a></div><div class="ttdeci">const char * ast_json_string_get(const struct ast_json *string)</div><div class="ttdoc">Get the value of a JSON string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00273">json.c:273</a></div></div>
<div class="ttc" id="aoc_8h_html_a64a0b1ab9b0b18a58861ef59bb5ea8a7a0a50acf15993012768155fb7263c4dc2"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a64a0b1ab9b0b18a58861ef59bb5ea8a7a0a50acf15993012768155fb7263c4dc2">AST_AOC_CHARGING_ASSOCIATION_NA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00186">aoc.h:186</a></div></div>
<div class="ttc" id="channel_8h_html_a1cb98e78f1231d96dad09ddaeaf0981d"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1cb98e78f1231d96dad09ddaeaf0981d">ast_channel_set_redirecting</a></div><div class="ttdeci">void ast_channel_set_redirecting(struct ast_channel *chan, const struct ast_party_redirecting *redirecting, const struct ast_set_party_redirecting *update)</div><div class="ttdoc">Set the redirecting id information in the Asterisk channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l09215">channel.c:9215</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a5ff087d06b6cbaa1d37cddee56e568eaad73773a22eaed64af27f4c0905f239dc"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaad73773a22eaed64af27f4c0905f239dc">SIG_PRI_RESET_ACTIVE</a></div><div class="ttdoc">The channel is being RESTARTed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00159">sig_pri.h:159</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0521b3661ec0c6d0b664abe98f84c5baa1fc5b46fc67021e72dfeb033aeab982b"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0521b3661ec0c6d0b664abe98f84c5baa1fc5b46fc67021e72dfeb033aeab982b">SIG_PRI_DEFLAW</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00068">sig_pri.h:68</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a4dec407d22aef029145eadceecd1df6d"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a4dec407d22aef029145eadceecd1df6d">sig_pri_span::privateprefix</a></div><div class="ttdeci">char privateprefix[20]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00512">sig_pri.h:512</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a15d8af230a5c303359f79b7d1d3e3a1ba136f020c1dcbe92aeb9d3e18cb0195f3"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a15d8af230a5c303359f79b7d1d3e3a1ba136f020c1dcbe92aeb9d3e18cb0195f3">SIG_PRI_MOH_EVENT_NUM</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00131">sig_pri.h:131</a></div></div>
<div class="ttc" id="aoc_8h_html_a7558fd4fc6c76430875d931bd16b7b1da5c049c80395b1353839451a4f6d790e3"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da5c049c80395b1353839451a4f6d790e3">AST_AOC_BILLING_CALL_FWD_NO_REPLY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00056">aoc.h:56</a></div></div>
<div class="ttc" id="structast__aoc__flat__rate_html_a2c5b15b6851f558acabe1294d0e84e1c"><div class="ttname"><a href="../../d9/d7a/structast__aoc__flat__rate.html#a2c5b15b6851f558acabe1294d0e84e1c">ast_aoc_flat_rate::multiplier</a></div><div class="ttdeci">uint16_t multiplier</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00140">aoc.h:140</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="aoc_8h_html_a2c726e954f606dc71b37ba93be286ff9"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9">ast_aoc_charge_type</a></div><div class="ttdeci">ast_aoc_charge_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00069">aoc.h:69</a></div></div>
<div class="ttc" id="pbx_8h_html_a64a5b8fdc919806135ad427aca9e71b7"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a></div><div class="ttdeci">int ast_exists_extension(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)</div><div class="ttdoc">Determine whether an extension exists. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04179">pbx.c:4179</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_ac3cd01d1a409f5acf3630f539be01cf3"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#ac3cd01d1a409f5acf3630f539be01cf3">sig_pri_callback::ami_channel_event</a></div><div class="ttdeci">void(*const ami_channel_event)(void *pvt, struct ast_channel *chan)</div><div class="ttdoc">Post an AMI B channel association event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00228">sig_pri.h:228</a></div></div>
<div class="ttc" id="manager_8h_html_a777cde87d12b331902f862ec44641688"><div class="ttname"><a href="../../db/d45/manager_8h.html#a777cde87d12b331902f862ec44641688">ast_manager_build_channel_state_string</a></div><div class="ttdeci">struct ast_str * ast_manager_build_channel_state_string(const struct ast_channel_snapshot *snapshot)</div><div class="ttdoc">Generate the AMI message body from a channel snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d1c/manager__channels_8c_source.html#l00561">manager_channels.c:561</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_af40039f1c49c16d0f6fa33fe9c43a0cb"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb">ast_app_parse_options</a></div><div class="ttdeci">int ast_app_parse_options(const struct ast_app_option *options, struct ast_flags *flags, char **args, char *optstr)</div><div class="ttdoc">Parses a string containing application options and sets flags/arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d83/main_2app_8c_source.html#l02906">main/app.c:2906</a></div></div>
<div class="ttc" id="channel_8h_html_ab2e0a6897707b1102ad453ea0963999f"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab2e0a6897707b1102ad453ea0963999f">ast_queue_hold</a></div><div class="ttdeci">int ast_queue_hold(struct ast_channel *chan, const char *musicclass)</div><div class="ttdoc">Queue a hold frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01191">channel.c:1191</a></div></div>
<div class="ttc" id="ccss_8h_html_a50c1ff8b0de8119431904e2ce0064530aec12fa6bbd080be709806e28f8bade1e"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530aec12fa6bbd080be709806e28f8bade1e">AST_CC_CCNR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00038">ccss.h:38</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a68be1f65e6d1f2949835d9b6b44bcf8e"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig_pri_span::sig</a></div><div class="ttdeci">int sig</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00597">sig_pri.h:597</a></div></div>
<div class="ttc" id="callerid_8h_html_a84c18283fee396ec5947fc497dd39169"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a84c18283fee396ec5947fc497dd39169">AST_REDIRECTING_REASON</a></div><div class="ttdeci">AST_REDIRECTING_REASON</div><div class="ttdoc">redirecting reason codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00390">callerid.h:390</a></div></div>
<div class="ttc" id="channel_8h_html_aa8b52fbc8168e939bc5553502367d46a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a></div><div class="ttdeci">const char * ast_channel_exten(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00353">channel_internal_api.c:353</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a3662371d2d52fccef039d6612e75342d"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a3662371d2d52fccef039d6612e75342d">sig_pri_span::overlapdial</a></div><div class="ttdeci">int overlapdial</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00450">sig_pri.h:450</a></div></div>
<div class="ttc" id="aoc_8h_html_a328e01991ff5489d6289285654cb9402ae03e07e3d0015100bb0318f555c6ddff"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402ae03e07e3d0015100bb0318f555c6ddff">AST_AOC_TIME_SCALE_HOUR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00093">aoc.h:93</a></div></div>
<div class="ttc" id="pbx_8h_html"><div class="ttname"><a href="../../db/de0/pbx_8h.html">pbx.h</a></div><div class="ttdoc">Core PBX routines and definitions. </div></div>
<div class="ttc" id="structast__aoc__volume__rate_html_a2c5b15b6851f558acabe1294d0e84e1c"><div class="ttname"><a href="../../db/d83/structast__aoc__volume__rate.html#a2c5b15b6851f558acabe1294d0e84e1c">ast_aoc_volume_rate::multiplier</a></div><div class="ttdeci">uint16_t multiplier</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00133">aoc.h:133</a></div></div>
<div class="ttc" id="aoc_8h_html_aea6890fe5889849199eeedd18a9367e7"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#aea6890fe5889849199eeedd18a9367e7">ast_aoc_get_currency_amount</a></div><div class="ttdeci">unsigned int ast_aoc_get_currency_amount(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">get the currency amount for AOC-D and AOC-E messages </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00940">aoc.c:940</a></div></div>
<div class="ttc" id="channel_8h_html_a6cbcba5661d55216968cde8fdf913c89"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6cbcba5661d55216968cde8fdf913c89">ast_queue_frame</a></div><div class="ttdeci">int ast_queue_frame(struct ast_channel *chan, struct ast_frame *f)</div><div class="ttdoc">Queue one or more frames to a channel&amp;#39;s frame queue. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01139">channel.c:1139</a></div></div>
<div class="ttc" id="structast__aoc__encoded_html"><div class="ttname"><a href="../../d8/d72/structast__aoc__encoded.html">ast_aoc_encoded</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00197">aoc.c:197</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00054">devicestate.h:54</a></div></div>
<div class="ttc" id="aoc_8h_html_afd4aa65b3a57ed3e33e0cd5f7ff9c136a73286142ba88e883850e58b7d9862ca1"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136a73286142ba88e883850e58b7d9862ca1">AST_AOC_RATE_TYPE_DURATION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00159">aoc.h:159</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aae184c2fe57fb65661772d4772bd9444a56a6bdb3a08f47f53f414ba014b47980"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a56a6bdb3a08f47f53f414ba014b47980">SIG_PRI_CALL_LEVEL_OVERLAP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00141">sig_pri.h:141</a></div></div>
<div class="ttc" id="ccss_8h_html_a9a078a59bc29f1ace8486ab9ecb774c4a7b88359e04845d054178fb03d238ea77"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4a7b88359e04845d054178fb03d238ea77">AST_CC_MONITOR_ALWAYS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00087">ccss.h:87</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00105">include/asterisk/frame.h:105</a></div></div>
<div class="ttc" id="ccss_8h_html_a1c00e4618fa5ece215682cf02519ab55"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a1c00e4618fa5ece215682cf02519ab55">AST_CC_GENERIC_MONITOR_TYPE</a></div><div class="ttdeci">#define AST_CC_GENERIC_MONITOR_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00489">ccss.h:489</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ad69ef058dd74d02cb40cf536d959dbc3"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ad69ef058dd74d02cb40cf536d959dbc3">sig_pri_chan_delete</a></div><div class="ttdeci">void sig_pri_chan_delete(struct sig_pri_chan *doomed)</div></div>
<div class="ttc" id="structsig__pri__callback_html_a9664a4459cb4009a6752625e7ebc6240"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a9664a4459cb4009a6752625e7ebc6240">sig_pri_callback::set_echocanceller</a></div><div class="ttdeci">int(*const set_echocanceller)(void *pvt, int enable)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00191">sig_pri.h:191</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_aa18eca99495b7731cf2ba16a76041e72"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#aa18eca99495b7731cf2ba16a76041e72">sig_pri_callback::dsp_reset_and_flush_digits</a></div><div class="ttdeci">int(*const dsp_reset_and_flush_digits)(void *pvt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00193">sig_pri.h:193</a></div></div>
<div class="ttc" id="channel_8h_html_aa36854cfee90c77c4124e94273e42dffa842c2a9ccda3b03230c9ee81ec8adf88"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa842c2a9ccda3b03230c9ee81ec8adf88">AST_PARTY_CHAR_SET_ISO8859_4</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00249">channel.h:249</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00056">devicestate.h:56</a></div></div>
<div class="ttc" id="manager_8h_html"><div class="ttname"><a href="../../db/d45/manager_8h.html">manager.h</a></div><div class="ttdoc">The AMI - Asterisk Manager Interface - is a TCP protocol created to manage Asterisk with third-party ...</div></div>
<div class="ttc" id="structast__aoc__duration__rate_html_a5fa7310aeb706ad22dd07d338959a9af"><div class="ttname"><a href="../../d6/d53/structast__aoc__duration__rate.html#a5fa7310aeb706ad22dd07d338959a9af">ast_aoc_duration_rate::time_scale</a></div><div class="ttdeci">uint16_t time_scale</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00110">aoc.h:110</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a4590adbfd7f743e96c1fc61ef1715016"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a4590adbfd7f743e96c1fc61ef1715016">sig_pri_chan::moh_suggested</a></div><div class="ttdeci">char moh_suggested[MAX_MUSICCLASS]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00316">sig_pri.h:316</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aa9345e8f9251db64f8ce82593ce40677"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aa9345e8f9251db64f8ce82593ce40677">sig_pri_cc_agent_init</a></div><div class="ttdeci">int sig_pri_cc_agent_init(struct ast_cc_agent *agent, struct sig_pri_chan *pvt_chan)</div></div>
<div class="ttc" id="structsig__pri__callback_html_ad1e793a256fbfeb7f8857d34de0f7d22"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#ad1e793a256fbfeb7f8857d34de0f7d22">sig_pri_callback::new_nobch_intf</a></div><div class="ttdeci">int(*const new_nobch_intf)(struct sig_pri_span *pri)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00211">sig_pri.h:211</a></div></div>
<div class="ttc" id="structast__party__id_html_a10023f503341f2b8c82117b31a0cc531"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#a10023f503341f2b8c82117b31a0cc531">ast_party_id::subaddress</a></div><div class="ttdeci">struct ast_party_subaddress subaddress</div><div class="ttdoc">Subscriber subaddress. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00345">channel.h:345</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaf195fcf1686408b5e52ad76996653cea"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaf195fcf1686408b5e52ad76996653cea">ast_channel_stage_snapshot</a></div><div class="ttdeci">void ast_channel_stage_snapshot(struct ast_channel *chan)</div><div class="ttdoc">Set flag to indicate channel snapshot is being staged. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l01038">stasis_channels.c:1038</a></div></div>
<div class="ttc" id="aoc_8h_html_a7558fd4fc6c76430875d931bd16b7b1da91a7d97d8c344b40e9aaadc39c4d9269"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da91a7d97d8c344b40e9aaadc39c4d9269">AST_AOC_BILLING_CREDIT_CARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00053">aoc.h:53</a></div></div>
<div class="ttc" id="aoc_8h_html_a7558fd4fc6c76430875d931bd16b7b1daf2aa1a3d8a87f17ac604cead1964f52f"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1daf2aa1a3d8a87f17ac604cead1964f52f">AST_AOC_BILLING_NA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00050">aoc.h:50</a></div></div>
<div class="ttc" id="channel_8h_html_aa36854cfee90c77c4124e94273e42dffa582102c3504ea0967dce72b559dcc86c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffa582102c3504ea0967dce72b559dcc86c">AST_PARTY_CHAR_SET_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00244">channel.h:244</a></div></div>
<div class="ttc" id="aoc_8h_html_a82fcf407f11289b3675f0880f2245bfe"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a82fcf407f11289b3675f0880f2245bfe">ast_aoc_set_billing_id</a></div><div class="ttdeci">int ast_aoc_set_billing_id(struct ast_aoc_decoded *decoded, const enum ast_aoc_billing_id id)</div><div class="ttdoc">set the billing id for a AOC-D or AST_AOC_E message </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l01024">aoc.c:1024</a></div></div>
<div class="ttc" id="sig__pri_8h_html_af207080da27c2f4b6cd60702190f4ce1"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#af207080da27c2f4b6cd60702190f4ce1">sig_pri_cc_monitor_status_rsp</a></div><div class="ttdeci">int sig_pri_cc_monitor_status_rsp(struct ast_cc_monitor *monitor, enum ast_device_state devstate)</div></div>
<div class="ttc" id="aoc_8h_html_a49977b1a5a71ee19edfc3f77f448e089a6060df3e95e44802a372af9f0eb5ebaf"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a6060df3e95e44802a372af9f0eb5ebaf">AST_AOC_MULT_ONETENTH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00037">aoc.h:37</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="time_8h_html_a6daa33e2052acd094bb63e78aba29733"><div class="ttname"><a href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a></div><div class="ttdeci">int ast_tvcmp(struct timeval _a, struct timeval _b)</div><div class="ttdoc">Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller, equal or greater to the second. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00128">time.h:128</a></div></div>
<div class="ttc" id="astobj2_8h_html_aefc16f8aa9087cbc5c55c70cf1dd41b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a></div><div class="ttdeci">#define ao2_container_alloc_hash(ao2_options, container_options, n_buckets, hash_fn, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01310">astobj2.h:1310</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a9e187fd6e33fd32a888531467786c773"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a9e187fd6e33fd32a888531467786c773">sig_pri_span::master</a></div><div class="ttdeci">pthread_t master</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00617">sig_pri.h:617</a></div></div>
<div class="ttc" id="channel_8h_html_a84a85d871e634a86b2421ac9354b50c6"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a84a85d871e634a86b2421ac9354b50c6">ast_party_caller_set_init</a></div><div class="ttdeci">void ast_party_caller_set_init(struct ast_party_caller *init, const struct ast_party_caller *guide)</div><div class="ttdoc">Initialize the given caller structure using the given guide for a set update operation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01999">channel.c:1999</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="structast__aoc__s__entry_html_ab73a64cdd300bc2552cf255386845b52"><div class="ttname"><a href="../../d4/de4/structast__aoc__s__entry.html#ab73a64cdd300bc2552cf255386845b52">ast_aoc_s_entry::volume</a></div><div class="ttdeci">struct ast_aoc_volume_rate volume</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00173">aoc.h:173</a></div></div>
<div class="ttc" id="logger_8h_html_a6cd2a7c20c6cfe0e3f4fed72dd2cc6b2"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a6cd2a7c20c6cfe0e3f4fed72dd2cc6b2">ast_create_callid</a></div><div class="ttdeci">ast_callid ast_create_callid(void)</div><div class="ttdoc">factory function to create a new uniquely identifying callid. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/logger_8c_source.html#l01957">logger.c:1957</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00278">include/asterisk/frame.h:278</a></div></div>
<div class="ttc" id="structsig__pri__span_html_ad44ab156cfb784ec704fbd1d4faec1ea"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#ad44ab156cfb784ec704fbd1d4faec1ea">sig_pri_span::force_restart_unavailable_chans</a></div><div class="ttdeci">unsigned int force_restart_unavailable_chans</div><div class="ttdoc">TRUE if forcing RESTART when receive cause 44 on this span. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00501">sig_pri.h:501</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a40d80acf78e1e7c7ece36c153c1d6a5f"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a40d80acf78e1e7c7ece36c153c1d6a5f">sig_pri_span::minunused</a></div><div class="ttdeci">int minunused</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00555">sig_pri.h:555</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a08eff0a108d52d3ab42e222ab8707f36aa26897325f83250eee7b19061f9b6fd1"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a08eff0a108d52d3ab42e222ab8707f36aa26897325f83250eee7b19061f9b6fd1">SIG_PRI_COLP_CONNECT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00441">sig_pri.h:441</a></div></div>
<div class="ttc" id="channel_8h_html_abd6165fa9617e1bb5efee3befa3e963d"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#abd6165fa9617e1bb5efee3befa3e963d">ast_channel_connected_effective_id</a></div><div class="ttdeci">struct ast_party_id ast_channel_connected_effective_id(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00900">channel_internal_api.c:900</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a7549377df87038be737e8cae73acaa9d"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a7549377df87038be737e8cae73acaa9d">AST_APP_OPTION_ARG</a></div><div class="ttdeci">#define AST_APP_OPTION_ARG(option, flagno, argno)</div><div class="ttdoc">Declares an application option that accepts an argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01413">include/asterisk/app.h:1413</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00055">devicestate.h:55</a></div></div>
<div class="ttc" id="aoc_8h_html_a49977b1a5a71ee19edfc3f77f448e089a20055187dd0b3834fe5cc313e1f08965"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a20055187dd0b3834fe5cc313e1f08965">AST_AOC_MULT_TEN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00039">aoc.h:39</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="structast__party__number_html_ad1f8db563cb99d404b72e02cf8f78cd1"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#ad1f8db563cb99d404b72e02cf8f78cd1">ast_party_number::plan</a></div><div class="ttdeci">int plan</div><div class="ttdoc">Q.931 Type-Of-Number and Numbering-Plan encoded fields. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00294">channel.h:294</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390ac976c01c12ae70e36b99b16dbfa3dda7"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390ac976c01c12ae70e36b99b16dbfa3dda7">AST_CONTROL_CONNECTED_LINE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00299">include/asterisk/frame.h:299</a></div></div>
<div class="ttc" id="time_8h_html_a904a6933b710e14c7fa2029a0f0cc91a"><div class="ttname"><a href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a></div><div class="ttdeci">int ast_remaining_ms(struct timeval start, int max_ms)</div><div class="ttdoc">Calculate remaining milliseconds given a starting timestamp and upper bound. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02033">main/utils.c:2033</a></div></div>
<div class="ttc" id="chan__phone_8c_html_a4e40373706bcf5cdb9409dac3166d280"><div class="ttname"><a href="../../da/dde/chan__phone_8c.html#a4e40373706bcf5cdb9409dac3166d280">monitor</a></div><div class="ttdeci">static unsigned int monitor</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dde/chan__phone_8c_source.html#l00116">chan_phone.c:116</a></div></div>
<div class="ttc" id="aoc_8h_html_a9d8bce208856acd7aa722ad0f7f280bc"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a9d8bce208856acd7aa722ad0f7f280bc">ast_aoc_get_unit_info</a></div><div class="ttdeci">const struct ast_aoc_unit_entry * ast_aoc_get_unit_info(struct ast_aoc_decoded *decoded, unsigned int entry_number)</div><div class="ttdoc">get a specific unit entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l01010">aoc.c:1010</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_accfcb380df76a64251d88ef49c2dd4e3"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#accfcb380df76a64251d88ef49c2dd4e3">AST_NONSTANDARD_APP_ARGS</a></div><div class="ttdeci">#define AST_NONSTANDARD_APP_ARGS(args, parse, sep)</div><div class="ttdoc">Performs the &amp;#39;nonstandard&amp;#39; argument separation process for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01300">include/asterisk/app.h:1300</a></div></div>
<div class="ttc" id="structsig__pri__span_html_ae752c5957f8323851102513cd35837b1"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#ae752c5957f8323851102513cd35837b1">sig_pri_span::lastreset</a></div><div class="ttdeci">time_t lastreset</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00619">sig_pri.h:619</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="structast__party__caller_html_ad3bdbbc7177d5ac309bc72f9fc3c4bee"><div class="ttname"><a href="../../d4/d77/structast__party__caller.html#ad3bdbbc7177d5ac309bc72f9fc3c4bee">ast_party_caller::ani2</a></div><div class="ttdeci">int ani2</div><div class="ttdoc">Automatic Number Identification 2 (Info Digits) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00434">channel.h:434</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="isdn__lib_8h_html_a7c03637dce11d369a3e96ad5767607c0"><div class="ttname"><a href="../../de/d26/isdn__lib_8h.html#a7c03637dce11d369a3e96ad5767607c0">PRI_TRANS_CAP_DIGITAL</a></div><div class="ttdeci">#define PRI_TRANS_CAP_DIGITAL</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d26/isdn__lib_8h_source.html#l00818">isdn_lib.h:818</a></div></div>
<div class="ttc" id="ccss_8h_html_ac9a717c8b12205435084874c2f833d8a"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#ac9a717c8b12205435084874c2f833d8a">ast_cc_agent_callback</a></div><div class="ttdeci">struct ast_cc_agent * ast_cc_agent_callback(int flags, ao2_callback_fn *function, void *arg, const char *const type)</div><div class="ttdoc">Call a callback on all agents of a specific type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l00456">ccss.c:456</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a27229fad305d4ab9c5923e5b2b69243b"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a27229fad305d4ab9c5923e5b2b69243b">SIG_PRI_NUM_DCHANS</a></div><div class="ttdeci">#define SIG_PRI_NUM_DCHANS</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00241">sig_pri.h:241</a></div></div>
<div class="ttc" id="structast__party__connected__line_html"><div class="ttname"><a href="../../dc/d9e/structast__party__connected__line.html">ast_party_connected_line</a></div><div class="ttdoc">Connected Line/Party information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00457">channel.h:457</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a146a5e74b46d8d30984c92fcbea2b596"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a146a5e74b46d8d30984c92fcbea2b596">sig_pri_span::cpndialplan</a></div><div class="ttdeci">int cpndialplan</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00508">sig_pri.h:508</a></div></div>
<div class="ttc" id="channel_8h_html_a63732831df3e7a0999b0900ec85c626a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a63732831df3e7a0999b0900ec85c626a">ast_channel_dialed</a></div><div class="ttdeci">struct ast_party_dialed * ast_channel_dialed(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00904">channel_internal_api.c:904</a></div></div>
<div class="ttc" id="musiconhold_8h_html_a2acec01f2fddd8ca494d874003815cf7"><div class="ttname"><a href="../../dc/d07/musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7">ast_moh_start</a></div><div class="ttdeci">int ast_moh_start(struct ast_channel *chan, const char *mclass, const char *interpclass)</div><div class="ttdoc">Turn on music on hold on a given channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l07866">channel.c:7866</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a02235aed739ba6bc1f3b20e796db4081"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a02235aed739ba6bc1f3b20e796db4081">sig_pri_span::pvts</a></div><div class="ttdeci">struct sig_pri_chan * pvts[SIG_PRI_MAX_CHANNELS]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00616">sig_pri.h:616</a></div></div>
<div class="ttc" id="aoc_8h_html_a3ec7164b379d453d184d3d3bf3f049d8"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a3ec7164b379d453d184d3d3bf3f049d8">ast_aoc_get_termination_request</a></div><div class="ttdeci">int ast_aoc_get_termination_request(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">get whether or not the AST_AOC_REQUEST message as a termination request. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l01079">aoc.c:1079</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a0ae638daae78c962c27f9345d441f94f"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a0ae638daae78c962c27f9345d441f94f">sig_pri_callback::set_digital</a></div><div class="ttdeci">void(*const set_digital)(void *pvt, int is_digital)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00205">sig_pri.h:205</a></div></div>
<div class="ttc" id="structsig__pri__span_html_af75747551b37515dbfc2a60a6ed24dee"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#af75747551b37515dbfc2a60a6ed24dee">sig_pri_span::idledial</a></div><div class="ttdeci">char idledial[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00554">sig_pri.h:554</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="callerid_8h_html_a69574f5c1e9be59b1d2eb727d4209bce"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a69574f5c1e9be59b1d2eb727d4209bce">AST_PRES_NUMBER_NOT_AVAILABLE</a></div><div class="ttdeci">#define AST_PRES_NUMBER_NOT_AVAILABLE</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00353">callerid.h:353</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a04e3105c0481dfd78913d4bc9796f1c3"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a04e3105c0481dfd78913d4bc9796f1c3">sig_pri_chan::immediate</a></div><div class="ttdeci">unsigned int immediate</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00284">sig_pri.h:284</a></div></div>
<div class="ttc" id="structast__party__redirecting_html"><div class="ttname"><a href="../../df/d44/structast__party__redirecting.html">ast_party_redirecting</a></div><div class="ttdoc">Redirecting Line information. RDNIS (Redirecting Directory Number Information Service) Where a call d...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00523">channel.h:523</a></div></div>
<div class="ttc" id="logger_8h_html_ad89ee324d180cdcd7defcc709ff9ca42"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a></div><div class="ttdeci">#define LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00263">logger.h:263</a></div></div>
<div class="ttc" id="aoc_8h_html_afd4aa65b3a57ed3e33e0cd5f7ff9c136a53c594c3f49d098ffcccb94a919ada67"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136a53c594c3f49d098ffcccb94a919ada67">AST_AOC_RATE_TYPE_NA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00156">aoc.h:156</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aaefb9d75efc555db41e739129925f90ea171b597e4452ea8d2fd6da561c828f9d"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aaefb9d75efc555db41e739129925f90ea171b597e4452ea8d2fd6da561c828f9d">SIG_PRI_MOH_SIGNALING_MOH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00075">sig_pri.h:75</a></div></div>
<div class="ttc" id="aoc_8h_html_a328e01991ff5489d6289285654cb9402ac64a47c6076f6dadc3a9d47594a756af"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402ac64a47c6076f6dadc3a9d47594a756af">AST_AOC_TIME_SCALE_MINUTE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00092">aoc.h:92</a></div></div>
<div class="ttc" id="channel_8h_html_ae90da1877e143b996d202d4c88a9c862"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae90da1877e143b996d202d4c88a9c862">ast_softhangup_nolock</a></div><div class="ttdeci">int ast_softhangup_nolock(struct ast_channel *chan, int reason)</div><div class="ttdoc">Softly hangup up a channel (no channel lock) </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02463">channel.c:2463</a></div></div>
<div class="ttc" id="channel_8h_html_aa0a52e573af67cb0f29095177128d186"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa0a52e573af67cb0f29095177128d186">ast_channel_is_bridged</a></div><div class="ttdeci">int ast_channel_is_bridged(const struct ast_channel *chan)</div><div class="ttdoc">Determine if a channel is in a bridge. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10746">channel.c:10746</a></div></div>
<div class="ttc" id="ccss_8h_html_a50c1ff8b0de8119431904e2ce0064530a64c2fae63ae9df0696a2092477c6fcb2"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a50c1ff8b0de8119431904e2ce0064530a64c2fae63ae9df0696a2092477c6fcb2">AST_CC_CCBS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00036">ccss.h:36</a></div></div>
<div class="ttc" id="structast__aoc__duration__rate_html_a6bf79289fabcea29afd55cee906c53d7"><div class="ttname"><a href="../../d6/d53/structast__aoc__duration__rate.html#a6bf79289fabcea29afd55cee906c53d7">ast_aoc_duration_rate::granularity_time</a></div><div class="ttdeci">uint32_t granularity_time</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00107">aoc.h:107</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a78d4847658b695383d849efd12399b38"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a78d4847658b695383d849efd12399b38">sig_pri_chan::exten</a></div><div class="ttdeci">char exten[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00304">sig_pri.h:304</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00041">channelstate.h:41</a></div></div>
<div class="ttc" id="structast__cc__agent_html_a48e5b8fb1ab4916549247ea116b8f5b9"><div class="ttname"><a href="../../d0/db3/structast__cc__agent.html#a48e5b8fb1ab4916549247ea116b8f5b9">ast_cc_agent::core_id</a></div><div class="ttdeci">unsigned int core_id</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00849">ccss.h:849</a></div></div>
<div class="ttc" id="structast__channel_html_a62f8995a6eac6c8a48205a6f3815d54b"><div class="ttname"><a href="../../df/d3c/structast__channel.html#a62f8995a6eac6c8a48205a6f3815d54b">ast_channel::callid</a></div><div class="ttdeci">ast_callid callid</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00098">channel_internal_api.c:98</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="sig__pri_8h_html_abd93953b68d33c35320c5d4eeb991ea3"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#abd93953b68d33c35320c5d4eeb991ea3">sig_pri_fixup</a></div><div class="ttdeci">void sig_pri_fixup(struct ast_channel *oldchan, struct ast_channel *newchan, struct sig_pri_chan *pchan)</div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a6265e05e606bb17be5cd81a309cf98a2"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a6265e05e606bb17be5cd81a309cf98a2">AST_CONTROL_MCID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00308">include/asterisk/frame.h:308</a></div></div>
<div class="ttc" id="aoc_8h_html_ab7eb4ba93a3c67ac3747f5731db62813"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#ab7eb4ba93a3c67ac3747f5731db62813">ast_aoc_get_billing_id</a></div><div class="ttdeci">enum ast_aoc_billing_id ast_aoc_get_billing_id(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">get the billing id for AOC-D and AOC-E messages </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l01035">aoc.c:1035</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0d9283abd601d66a96d067641fbaa5e7a55dbd776d4f654e80bdc2d1321d8939c"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7a55dbd776d4f654e80bdc2d1321d8939c">SIG_PRI_MOH_STATE_NUM</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00107">sig_pri.h:107</a></div></div>
<div class="ttc" id="ccss_8h_html_a98e261f13321084b4ed0c1bd0d4ec70e"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a98e261f13321084b4ed0c1bd0d4ec70e">ast_cc_monitor_status_request</a></div><div class="ttdeci">int ast_cc_monitor_status_request(int core_id)</div><div class="ttdoc">Request the status of a caller or callers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03986">ccss.c:3986</a></div></div>
<div class="ttc" id="structsig__pri__span_html_ad5a6484f8efb77cf1510a35cc10d753a"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#ad5a6484f8efb77cf1510a35cc10d753a">sig_pri_span::resetpos</a></div><div class="ttdeci">int resetpos</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00596">sig_pri.h:596</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a08eff0a108d52d3ab42e222ab8707f36aedcd61adf92f45a8e0173d6335aebb48"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a08eff0a108d52d3ab42e222ab8707f36aedcd61adf92f45a8e0173d6335aebb48">SIG_PRI_COLP_BLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00439">sig_pri.h:439</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_ab9a2fe4dd3d880dcb9fec85b60814978"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#ab9a2fe4dd3d880dcb9fec85b60814978">sig_pri_chan::hidecalleridname</a></div><div class="ttdeci">unsigned int hidecalleridname</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00283">sig_pri.h:283</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="aoc_8h_html_a7558fd4fc6c76430875d931bd16b7b1da204aa062b4281ee428f0709259f73116"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da204aa062b4281ee428f0709259f73116">AST_AOC_BILLING_CALL_FWD_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00055">aoc.h:55</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a3967853a8d6157831ca2c3a356092d21"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a3967853a8d6157831ca2c3a356092d21">sig_pri_callback::new_ast_channel</a></div><div class="ttdeci">struct ast_channel *(*const new_ast_channel)(void *pvt, int state, enum sig_pri_law law, char *exten, const struct ast_assigned_ids *assignedids, const struct ast_channel *requestor)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00195">sig_pri.h:195</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a798fd91893ed411125afa28a5a7addc7"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a798fd91893ed411125afa28a5a7addc7">sig_pri_span::append_msn_to_user_tag</a></div><div class="ttdeci">unsigned int append_msn_to_user_tag</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00491">sig_pri.h:491</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aefda8988d1ad788713126dbeb4d002ec"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aefda8988d1ad788713126dbeb4d002ec">sig_pri_set_alarm</a></div><div class="ttdeci">void sig_pri_set_alarm(struct sig_pri_chan *p, int in_alarm)</div></div>
<div class="ttc" id="structgroup_html"><div class="ttname"><a href="../../d3/d08/structgroup.html">group</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d35/func__dialgroup_8c_source.html#l00084">func_dialgroup.c:84</a></div></div>
<div class="ttc" id="channel_8h_html_ab57c278099ea5f8d7cedbb41eba58b56"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a></div><div class="ttdeci">#define AST_CHANNEL_NAME</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00172">channel.h:172</a></div></div>
<div class="ttc" id="pbx_8h_html_aa0e4fd3343c8c7ee979a6a44d2113495"><div class="ttname"><a href="../../db/de0/pbx_8h.html#aa0e4fd3343c8c7ee979a6a44d2113495">ast_extension_match</a></div><div class="ttdeci">int ast_extension_match(const char *pattern, const char *extension)</div><div class="ttdoc">Determine if a given extension matches a given pattern (in NXX format) </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l04297">extconf.c:4297</a></div></div>
<div class="ttc" id="structsig__pri__span_html_af985df4218702eebfb4949ccd29657ca"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#af985df4218702eebfb4949ccd29657ca">sig_pri_span::initial_user_tag</a></div><div class="ttdeci">char initial_user_tag[AST_MAX_EXTENSION]</div><div class="ttdoc">Initial user tag for party id&amp;#39;s sent from this device driver. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00550">sig_pri.h:550</a></div></div>
<div class="ttc" id="aoc_8h_html_a9dc12343996e18f696da3dcde18fabcb"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a9dc12343996e18f696da3dcde18fabcb">ast_aoc_set_total_type</a></div><div class="ttdeci">int ast_aoc_set_total_type(struct ast_aoc_decoded *decoded, const enum ast_aoc_total_type type)</div><div class="ttdoc">Sets the type of total for a AOC-D message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00907">aoc.c:907</a></div></div>
<div class="ttc" id="mwi_8h_html_acf8d474c4029156d9c49a4ddea50d01b"><div class="ttname"><a href="../../dc/d33/mwi_8h.html#acf8d474c4029156d9c49a4ddea50d01b">ast_mwi_unsubscribe_and_join</a></div><div class="ttdeci">void * ast_mwi_unsubscribe_and_join(struct ast_mwi_subscriber *sub)</div><div class="ttdoc">Unsubscribe from the stasis topic, block until the final message is received, and then unsubscribe fr...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00254">mwi.c:254</a></div></div>
<div class="ttc" id="channel_8h_html_a29557c4823f5e9c02519a01daf6a289c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a></div><div class="ttdeci">void ast_hangup(struct ast_channel *chan)</div><div class="ttdoc">Hang up a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02548">channel.c:2548</a></div></div>
<div class="ttc" id="aoc_8h_html_afd4aa65b3a57ed3e33e0cd5f7ff9c136a4bd081a66f6065f4963840d4a1a02870"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136a4bd081a66f6065f4963840d4a1a02870">AST_AOC_RATE_TYPE_SPECIAL_CODE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00162">aoc.h:162</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0d9283abd601d66a96d067641fbaa5e7"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0d9283abd601d66a96d067641fbaa5e7">sig_pri_moh_state</a></div><div class="ttdeci">sig_pri_moh_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00084">sig_pri.h:84</a></div></div>
<div class="ttc" id="aoc_8h_html_aa7dc1e0987972e9eb92627a1190eb548abe386d5c13914197811b47e6d3fcdfc9"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548abe386d5c13914197811b47e6d3fcdfc9">AST_AOC_REQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00063">aoc.h:63</a></div></div>
<div class="ttc" id="res__pjsip__exten__state_8c_html_ae8731a90be4dc2d8272b7dfd8a001d4c"><div class="ttname"><a href="../../d2/d3d/res__pjsip__exten__state_8c.html#ae8731a90be4dc2d8272b7dfd8a001d4c">to_ami</a></div><div class="ttdeci">static void to_ami(struct ast_sip_subscription *sub, struct ast_str **buf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d3d/res__pjsip__exten__state_8c_source.html#l00542">res_pjsip_exten_state.c:542</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a16348e587eb42db97d2169c6c11ebe46"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a16348e587eb42db97d2169c6c11ebe46">sig_pri_chan::cid_subaddr</a></div><div class="ttdeci">char cid_subaddr[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00299">sig_pri.h:299</a></div></div>
<div class="ttc" id="aoc_8h_html_a8f66f98f015246c294b10dc2c9350612"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a8f66f98f015246c294b10dc2c9350612">ast_aoc_destroy_encoded</a></div><div class="ttdeci">void * ast_aoc_destroy_encoded(struct ast_aoc_encoded *encoded)</div><div class="ttdoc">free an ast_aoc_encoded object </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00313">aoc.c:313</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaf226cf2d1a4dbbbf220521d58c05ac0f"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a></div><div class="ttdeci">struct stasis_message_type * ast_mwi_state_type(void)</div><div class="ttdoc">Get the Stasis Message Bus API message type for MWI messages. </div></div>
<div class="ttc" id="aoc_8h_html_a328e01991ff5489d6289285654cb9402aac5248537cff99345656f6671b1504b6"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402aac5248537cff99345656f6671b1504b6">AST_AOC_TIME_SCALE_TENTH_SECOND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00089">aoc.h:89</a></div></div>
<div class="ttc" id="structast__cc__config__params_html"><div class="ttname"><a href="../../d4/d2e/structast__cc__config__params.html">ast_cc_config_params</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l00161">ccss.c:161</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0a2447a4cf8a5af504d4a006ebaf1b75"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0a2447a4cf8a5af504d4a006ebaf1b75">pri_send_callrerouting_facility_exec</a></div><div class="ttdeci">int pri_send_callrerouting_facility_exec(struct sig_pri_chan *p, enum ast_channel_state chanstate, const char *destination, const char *original, const char *reason)</div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390af10845d12981bce4e141a5b0ed431494"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390af10845d12981bce4e141a5b0ed431494">AST_CONTROL_AOC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00305">include/asterisk/frame.h:305</a></div></div>
<div class="ttc" id="structast__aoc__duration__rate_html_a2854e091b0a0f6c8da639ced777fe99d"><div class="ttname"><a href="../../d6/d53/structast__aoc__duration__rate.html#a2854e091b0a0f6c8da639ced777fe99d">ast_aoc_duration_rate::currency_name</a></div><div class="ttdeci">char currency_name[AOC_CURRENCY_NAME_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00114">aoc.h:114</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a08eff0a108d52d3ab42e222ab8707f36a3cad5609441f008cb3d157b2d3e51ecf"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a08eff0a108d52d3ab42e222ab8707f36a3cad5609441f008cb3d157b2d3e51ecf">SIG_PRI_COLP_UPDATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00443">sig_pri.h:443</a></div></div>
<div class="ttc" id="aoc_8h_html_a43274565efa1c1e0235c1568ab0593bd"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a43274565efa1c1e0235c1568ab0593bd">ast_aoc_get_currency_name</a></div><div class="ttdeci">const char * ast_aoc_get_currency_name(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">get the currency name for AOC-D and AOC-E messages </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00972">aoc.c:972</a></div></div>
<div class="ttc" id="ccss_8h_html_ae1570706dee0c4c88406d96f47f166d3"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#ae1570706dee0c4c88406d96f47f166d3">ast_cc_request_is_within_limits</a></div><div class="ttdeci">int ast_cc_request_is_within_limits(void)</div><div class="ttdoc">Check if the incoming CC request is within the bounds set by the cc_max_requests configuration option...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l02482">ccss.c:2482</a></div></div>
<div class="ttc" id="chan__pjsip_8c_html_a4e2e6fb7d874f0d2deddd2ecfc8afb32"><div class="ttname"><a href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a></div><div class="ttdeci">static int request(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/chan__pjsip_8c_source.html#l02559">chan_pjsip.c:2559</a></div></div>
<div class="ttc" id="aoc_8h_html_a49977b1a5a71ee19edfc3f77f448e089a218074f0220f2224fa4c4cab5281834a"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a49977b1a5a71ee19edfc3f77f448e089a218074f0220f2224fa4c4cab5281834a">AST_AOC_MULT_ONEHUNDREDTH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00036">aoc.h:36</a></div></div>
<div class="ttc" id="structast__aoc__unit__entry_html_a7a39ee49c9364cb0e662f7637a323830"><div class="ttname"><a href="../../df/d18/structast__aoc__unit__entry.html#a7a39ee49c9364cb0e662f7637a323830">ast_aoc_unit_entry::valid_type</a></div><div class="ttdeci">char valid_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00181">aoc.h:181</a></div></div>
<div class="ttc" id="ccss_8h_html_a9a078a59bc29f1ace8486ab9ecb774c4af60dcecaf7e419b66f364595c3739b05"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a9a078a59bc29f1ace8486ab9ecb774c4af60dcecaf7e419b66f364595c3739b05">AST_CC_MONITOR_GENERIC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00083">ccss.h:83</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00291">include/asterisk/frame.h:291</a></div></div>
<div class="ttc" id="structstate_html"><div class="ttname"><a href="../../d4/d88/structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l00158">localtime.c:158</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ac0c7c7fae90e258872bd02cb899d7dae"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ac0c7c7fae90e258872bd02cb899d7dae">sig_pri_cc_monitor_destructor</a></div><div class="ttdeci">void sig_pri_cc_monitor_destructor(void *monitor_pvt)</div></div>
<div class="ttc" id="structsig__pri__chan_html_a29e973bd94bfbaf59d939bd1bc988c32"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a29e973bd94bfbaf59d939bd1bc988c32">sig_pri_chan::cid_num</a></div><div class="ttdeci">char cid_num[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00298">sig_pri.h:298</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a53f043834d01332ee7187ee47ffce91d"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a53f043834d01332ee7187ee47ffce91d">sig_pri_start_pri</a></div><div class="ttdeci">int sig_pri_start_pri(struct sig_pri_span *pri)</div></div>
<div class="ttc" id="structsig__pri__span_html_a42d869c4d919457e772ca8346dde0f35"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a42d869c4d919457e772ca8346dde0f35">sig_pri_span::msn_list</a></div><div class="ttdeci">char msn_list[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00551">sig_pri.h:551</a></div></div>
<div class="ttc" id="aoc_8h_html_a27f54e31b500e4b6e7396d345d5ed411a625570cd7e855a633bb7be2a2c16327f"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411a625570cd7e855a633bb7be2a2c16327f">AST_AOC_CHARGED_ITEM_USER_USER_INFO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00151">aoc.h:151</a></div></div>
<div class="ttc" id="chan__unistim_8c_html_a8bd4accafd4e712317ed9a471738a971"><div class="ttname"><a href="../../d1/d6d/chan__unistim_8c.html#a8bd4accafd4e712317ed9a471738a971">charset</a></div><div class="ttdeci">charset</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d6d/chan__unistim_8c_source.html#l00336">chan_unistim.c:336</a></div></div>
<div class="ttc" id="structast__party__redirecting_html_aa961ad9bce0cf7679c5d938519ff1885"><div class="ttname"><a href="../../df/d44/structast__party__redirecting.html#aa961ad9bce0cf7679c5d938519ff1885">ast_party_redirecting::reason</a></div><div class="ttdeci">struct ast_party_redirecting_reason reason</div><div class="ttdoc">Reason for the redirection. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00543">channel.h:543</a></div></div>
<div class="ttc" id="channel_8h_html_a2126ac3bbc1a14f6ed5ccdfcbb851776"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a2126ac3bbc1a14f6ed5ccdfcbb851776">ast_party_id_init</a></div><div class="ttdeci">void ast_party_id_init(struct ast_party_id *init)</div><div class="ttdoc">Initialize the given party id structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01757">channel.c:1757</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_aa31218f7cda0b552305b7daed3a4a58d"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#aa31218f7cda0b552305b7daed3a4a58d">sig_pri_chan::deferred_digits</a></div><div class="ttdeci">char deferred_digits[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00314">sig_pri.h:314</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a944dc3eea387d9850e13ad734fd31ca8"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a944dc3eea387d9850e13ad734fd31ca8">sig_pri_cc_agent_start_monitoring</a></div><div class="ttdeci">int sig_pri_cc_agent_start_monitoring(struct ast_cc_agent *agent)</div></div>
<div class="ttc" id="structast__flags_html"><div class="ttname"><a href="../../dc/dac/structast__flags.html">ast_flags</a></div><div class="ttdoc">Structure used to handle boolean flags. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00199">utils.h:199</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_ac03fb31b814daac55fbcee51938446b1"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#ac03fb31b814daac55fbcee51938446b1">sig_pri_callback::set_alarm</a></div><div class="ttdeci">void(*const set_alarm)(void *pvt, int in_alarm)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00203">sig_pri.h:203</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591">AST_STATE_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00043">channelstate.h:43</a></div></div>
<div class="ttc" id="structast__aoc__s__entry_html_ad721c2d995eac8725f0ec8e65a0dc36f"><div class="ttname"><a href="../../d4/de4/structast__aoc__s__entry.html#ad721c2d995eac8725f0ec8e65a0dc36f">ast_aoc_s_entry::rate</a></div><div class="ttdeci">union ast_aoc_s_entry::@220 rate</div><div class="ttdoc">Charge rate being applied. </div></div>
<div class="ttc" id="channel_8h_html_ad2334e69c466aec25ba3cbba53b7201b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ad2334e69c466aec25ba3cbba53b7201b">ast_channel_redirecting</a></div><div class="ttdeci">struct ast_party_redirecting * ast_channel_redirecting(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00908">channel_internal_api.c:908</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a0d018a79a961fe0e1a38011ffdfb2956"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a0d018a79a961fe0e1a38011ffdfb2956">sig_pri_span::numchans</a></div><div class="ttdeci">int numchans</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00615">sig_pri.h:615</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00039">channelstate.h:39</a></div></div>
<div class="ttc" id="channel_8h_html_a018b7a29cef2d62074dc46e9aaad0d1a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a></div><div class="ttdeci">void ast_channel_exten_set(struct ast_channel *chan, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00357">channel_internal_api.c:357</a></div></div>
<div class="ttc" id="pbx_8h_html_a6e5b90edb84d216267148dddcffe9b9a"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a></div><div class="ttdeci">int pbx_builtin_setvar_helper(struct ast_channel *chan, const char *name, const char *value)</div><div class="ttdoc">Add a variable to the channel variable stack, removing the most recently set value for the same name...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l01071">pbx_variables.c:1071</a></div></div>
<div class="ttc" id="aoc_8h_html_ada9b84ac8130231cee87ba4d33a5dda0"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#ada9b84ac8130231cee87ba4d33a5dda0">ast_aoc_create</a></div><div class="ttdeci">struct ast_aoc_decoded * ast_aoc_create(const enum ast_aoc_type msg_type, const enum ast_aoc_charge_type charge_type, const enum ast_aoc_request requests)</div><div class="ttdoc">creates a ast_aoc_decode object of a specific message type </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00276">aoc.c:276</a></div></div>
<div class="ttc" id="aoc_8h_html_aed3fe8e8d708e8aff42a2ad205813cb7a437decc9f64054294b48742e48089619"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#aed3fe8e8d708e8aff42a2ad205813cb7a437decc9f64054294b48742e48089619">AST_AOC_TOTAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00083">aoc.h:83</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_af203379aca2fd704fe8d86a9445596b6"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a></div><div class="ttdeci">struct ast_frame ast_null_frame</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d55/main_2frame_8c_source.html#l00079">main/frame.c:79</a></div></div>
<div class="ttc" id="channel_8h_html_a050bec9a4abc1a599b6573a6091b080c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a050bec9a4abc1a599b6573a6091b080c">ast_waitfordigit</a></div><div class="ttdeci">int ast_waitfordigit(struct ast_channel *c, int ms)</div><div class="ttdoc">Waits for a digit. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l03184">channel.c:3184</a></div></div>
<div class="ttc" id="callerid_8h_html_a373e33a23b1df10c39311947fc724b11"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a373e33a23b1df10c39311947fc724b11">AST_PRES_USER_NUMBER_PASSED_SCREEN</a></div><div class="ttdeci">#define AST_PRES_USER_NUMBER_PASSED_SCREEN</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00319">callerid.h:319</a></div></div>
<div class="ttc" id="aoc_8h_html_ae91f3998077136a2d44cc4307c7523be"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#ae91f3998077136a2d44cc4307c7523be">ast_aoc_get_charge_type</a></div><div class="ttdeci">enum ast_aoc_charge_type ast_aoc_get_charge_type(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">get the charging type for an AOC-D or AOC-E message </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00897">aoc.c:897</a></div></div>
<div class="ttc" id="structast__aoc__charging__association_html"><div class="ttname"><a href="../../d0/dad/structast__aoc__charging__association.html">ast_aoc_charging_association</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00194">aoc.h:194</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a45c2e617c2ffdd76d9dc9956e8fe4de8"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a45c2e617c2ffdd76d9dc9956e8fe4de8">sig_pri_call</a></div><div class="ttdeci">int sig_pri_call(struct sig_pri_chan *p, struct ast_channel *ast, const char *rdest, int timeout, int layer1)</div></div>
<div class="ttc" id="aoc_8h_html_a7558fd4fc6c76430875d931bd16b7b1daceee6b8982426596fe14c3948aa29987"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1daceee6b8982426596fe14c3948aa29987">AST_AOC_BILLING_CALL_FWD_UNCONDITIONAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00054">aoc.h:54</a></div></div>
<div class="ttc" id="structast__party__id_html_a7bb5e40c10df6a41df64bda1f4bb3e26"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#a7bb5e40c10df6a41df64bda1f4bb3e26">ast_party_id::tag</a></div><div class="ttdeci">char * tag</div><div class="ttdoc">User-set &quot;tag&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00355">channel.h:355</a></div></div>
<div class="ttc" id="aoc_8h_html_a2c726e954f606dc71b37ba93be286ff9a38cfbbe1a40256021b03e1599b1a23ed"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a2c726e954f606dc71b37ba93be286ff9a38cfbbe1a40256021b03e1599b1a23ed">AST_AOC_CHARGE_CURRENCY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00072">aoc.h:72</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a8c166f1770c49a3e9986c461c19cef86"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a8c166f1770c49a3e9986c461c19cef86">sig_pri_callback::set_dnid</a></div><div class="ttdeci">void(*const set_dnid)(void *pvt, const char *dnid)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00208">sig_pri.h:208</a></div></div>
<div class="ttc" id="structast__party__subaddress_html_ac765329451135abec74c45e1897abf26"><div class="ttname"><a href="../../d7/d41/structast__party__subaddress.html#ac765329451135abec74c45e1897abf26">ast_party_subaddress::type</a></div><div class="ttdeci">int type</div><div class="ttdoc">Q.931 subaddress type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00321">channel.h:321</a></div></div>
<div class="ttc" id="structsig__pri__span_html"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html">sig_pri_span</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00446">sig_pri.h:446</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a8c5bb01611cd9890c062782fa0366459"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a8c5bb01611cd9890c062782fa0366459">sig_pri_chan::hidecallerid</a></div><div class="ttdeci">unsigned int hidecallerid</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00282">sig_pri.h:282</a></div></div>
<div class="ttc" id="channel_8h_html_aa36854cfee90c77c4124e94273e42dffacc63f30dd3c3af06430f20dc48d1aac1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffacc63f30dd3c3af06430f20dc48d1aac1">AST_PARTY_CHAR_SET_ISO8859_2</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00247">channel.h:247</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390af3bdb353330f1908e9558180b5bb9e16"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390af3bdb353330f1908e9558180b5bb9e16">AST_CONTROL_INCOMPLETE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00307">include/asterisk/frame.h:307</a></div></div>
<div class="ttc" id="channel_8h_html_ac8bce0bf79829c59a7671c4eff83a31f"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ac8bce0bf79829c59a7671c4eff83a31f">ast_party_redirecting_free</a></div><div class="ttdeci">void ast_party_redirecting_free(struct ast_party_redirecting *doomed)</div><div class="ttdoc">Destroy the redirecting information contents. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02179">channel.c:2179</a></div></div>
<div class="ttc" id="sig__pri_8h_html_adff38e4d09b72c5e03a6532a6d84f133"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#adff38e4d09b72c5e03a6532a6d84f133">sig_pri_answer</a></div><div class="ttdeci">int sig_pri_answer(struct sig_pri_chan *p, struct ast_channel *ast)</div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00294">include/asterisk/frame.h:294</a></div></div>
<div class="ttc" id="structast__aoc__duration__rate_html_ae73654f333e4363463ad8c594eca1905"><div class="ttname"><a href="../../d6/d53/structast__aoc__duration__rate.html#ae73654f333e4363463ad8c594eca1905">ast_aoc_duration_rate::time</a></div><div class="ttdeci">uint32_t time</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00105">aoc.h:105</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a0ce4db5233a25ec7ff777191a7fcd8f5"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a0ce4db5233a25ec7ff777191a7fcd8f5">sig_pri_span::resetting</a></div><div class="ttdeci">int resetting</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00595">sig_pri.h:595</a></div></div>
<div class="ttc" id="structast__aoc__decoded_html"><div class="ttname"><a href="../../d9/dca/structast__aoc__decoded.html">ast_aoc_decoded</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00205">aoc.c:205</a></div></div>
<div class="ttc" id="channel_8h_html_a6801c703e767d6f760c54c8b86a30024"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a></div><div class="ttdeci">#define ast_channel_ref(c)</div><div class="ttdoc">Increase channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02970">channel.h:2970</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ae264fa3d1f9d29c2c76c99bfa13ce95c"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ae264fa3d1f9d29c2c76c99bfa13ce95c">sig_pri_tone</a></div><div class="ttdeci">sig_pri_tone</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00057">sig_pri.h:57</a></div></div>
<div class="ttc" id="channel_8h_html_a60e0bcaed001e8d5ed1ba0eb2644b3cc"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a></div><div class="ttdeci">int ast_waitfor(struct ast_channel *chan, int ms)</div><div class="ttdoc">Wait for input on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l03171">channel.c:3171</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structast__party__redirecting_html_ad43c3812e6d13e0518d9f8b8f463ffcf"><div class="ttname"><a href="../../df/d44/structast__party__redirecting.html#ad43c3812e6d13e0518d9f8b8f463ffcf">ast_party_redirecting::count</a></div><div class="ttdeci">int count</div><div class="ttdoc">Number of times the call was redirected. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00549">channel.h:549</a></div></div>
<div class="ttc" id="cli_8h_html"><div class="ttname"><a href="../../dc/db0/cli_8h.html">cli.h</a></div><div class="ttdoc">Standard Command Line Interface. </div></div>
<div class="ttc" id="structsig__pri__span_html_ac3e1795766a80ec63b157951b4b9a7d4"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#ac3e1795766a80ec63b157951b4b9a7d4">sig_pri_span::debug</a></div><div class="ttdeci">int debug</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00593">sig_pri.h:593</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0f304fe6c585e80cb10fd235d35b17f2"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0f304fe6c585e80cb10fd235d35b17f2">sig_pri_request</a></div><div class="ttdeci">struct ast_channel * sig_pri_request(struct sig_pri_chan *p, enum sig_pri_law law, const struct ast_assigned_ids *assignedids, const struct ast_channel *requestor, int transfercapability)</div></div>
<div class="ttc" id="sig__pri_8h_html_a713dfbe873628068511c7d6bfcb7aa1b"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a713dfbe873628068511c7d6bfcb7aa1b">sig_pri_stop_pri</a></div><div class="ttdeci">void sig_pri_stop_pri(struct sig_pri_span *pri)</div></div>
<div class="ttc" id="channel_8h_html_aa04afa262d7e1b211ee32d17c949a275"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa04afa262d7e1b211ee32d17c949a275">ast_channel_hangupcause</a></div><div class="ttdeci">int ast_channel_hangupcause(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00427">channel_internal_api.c:427</a></div></div>
<div class="ttc" id="astdb_8h_html_a71e8d5ab1757b184683a99125d1c8160"><div class="ttname"><a href="../../de/d4a/astdb_8h.html#a71e8d5ab1757b184683a99125d1c8160">ast_db_del</a></div><div class="ttdeci">int ast_db_del(const char *family, const char *key)</div><div class="ttdoc">Delete entry in astdb. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00429">main/db.c:429</a></div></div>
<div class="ttc" id="channel_8h_html_ab1f348349b5df2d0b662fb9eed5afcce"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab1f348349b5df2d0b662fb9eed5afcce">ast_party_id_invalidate</a></div><div class="ttdeci">void ast_party_id_invalidate(struct ast_party_id *id)</div><div class="ttdoc">Invalidate all components of the given party id. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01889">channel.c:1889</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a9540aaac76be952860ef25d607eb33fb"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a9540aaac76be952860ef25d607eb33fb">sig_pri_chan::cid_ani2</a></div><div class="ttdeci">int cid_ani2</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00295">sig_pri.h:295</a></div></div>
<div class="ttc" id="channel_8h_html_aca211972dac7b8f3f08a283bfe0aa8bf"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a></div><div class="ttdeci">void ast_channel_context_set(struct ast_channel *chan, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00348">channel_internal_api.c:348</a></div></div>
<div class="ttc" id="structast__party__redirecting_html_ad6644f992fc696511eebf8732e98e74a"><div class="ttname"><a href="../../df/d44/structast__party__redirecting.html#ad6644f992fc696511eebf8732e98e74a">ast_party_redirecting::to</a></div><div class="ttdeci">struct ast_party_id to</div><div class="ttdoc">Call is redirecting to a new party (Sent to the caller) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00531">channel.h:531</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a5ff087d06b6cbaa1d37cddee56e568eaa815b45d62e77504ff9ed13d69b4f3710"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a5ff087d06b6cbaa1d37cddee56e568eaa815b45d62e77504ff9ed13d69b4f3710">SIG_PRI_RESET_NO_ACK</a></div><div class="ttdoc">Peer may not be sending the expected RESTART ACKNOWLEDGE. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00170">sig_pri.h:170</a></div></div>
<div class="ttc" id="aoc_8h_html_a328e01991ff5489d6289285654cb9402afdac340bd7e2c98dd1f2f45a6ed1670a"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402afdac340bd7e2c98dd1f2f45a6ed1670a">AST_AOC_TIME_SCALE_HUNDREDTH_SECOND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00088">aoc.h:88</a></div></div>
<div class="ttc" id="strings_8h_html_a2faaa16929951bfd2802b7829a100ba2"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a></div><div class="ttdeci">#define S_OR(a, b)</div><div class="ttdoc">returns the equivalent of logic or for strings: first one if not empty, otherwise second one...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00079">strings.h:79</a></div></div>
<div class="ttc" id="time_8h_html_aebf04439f206cc509472ce4b6da48a5a"><div class="ttname"><a href="../../de/df7/time_8h.html#aebf04439f206cc509472ce4b6da48a5a">ast_tv</a></div><div class="ttdeci">struct timeval ast_tv(ast_time_t sec, ast_suseconds_t usec)</div><div class="ttdoc">Returns a timeval from sec, usec. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00226">time.h:226</a></div></div>
<div class="ttc" id="channel_8h_html_a40230121458bf94386b685b2e3270880"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a40230121458bf94386b685b2e3270880">ast_party_subaddress_init</a></div><div class="ttdeci">void ast_party_subaddress_init(struct ast_party_subaddress *init)</div><div class="ttdoc">Initialize the given subaddress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01697">channel.c:1697</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_ac38432875dd10cf176f4c668037fe2bc"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#ac38432875dd10cf176f4c668037fe2bc">sig_pri_callback::update_span_devstate</a></div><div class="ttdeci">void(*const update_span_devstate)(struct sig_pri_span *pri)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00215">sig_pri.h:215</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="sig__pri_8h_html_af8cc34b0aa438a6a8d66d2807a6291af"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#af8cc34b0aa438a6a8d66d2807a6291af">sig_pri_digit_begin</a></div><div class="ttdeci">int sig_pri_digit_begin(struct sig_pri_chan *pvt, struct ast_channel *ast, char digit)</div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga70de9f16a229e2c5bf1a973372949d3e"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga70de9f16a229e2c5bf1a973372949d3e">ast_mwi_state::new_msgs</a></div><div class="ttdeci">int new_msgs</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00461">mwi.h:461</a></div></div>
<div class="ttc" id="causes_8h_html_aff0e956cb3ef657557fa468a17416c0b"><div class="ttname"><a href="../../d4/da3/causes_8h.html#aff0e956cb3ef657557fa468a17416c0b">AST_CAUSE_USER_BUSY</a></div><div class="ttdeci">#define AST_CAUSE_USER_BUSY</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00106">causes.h:106</a></div></div>
<div class="ttc" id="aoc_8h_html_a7558fd4fc6c76430875d931bd16b7b1da9f62d8ce9119202ffb00eb74d5db7412"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a7558fd4fc6c76430875d931bd16b7b1da9f62d8ce9119202ffb00eb74d5db7412">AST_AOC_BILLING_CALL_TRANSFER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00058">aoc.h:58</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a75d243fa9c5b62ff56a7d8a63740ede8"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a75d243fa9c5b62ff56a7d8a63740ede8">sig_pri_cc_agent_destructor</a></div><div class="ttdeci">void sig_pri_cc_agent_destructor(struct ast_cc_agent *agent)</div></div>
<div class="ttc" id="aoc_8h_html_a64a0b1ab9b0b18a58861ef59bb5ea8a7a68edc99ae56d99d05a257c37fe4dc0d9"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a64a0b1ab9b0b18a58861ef59bb5ea8a7a68edc99ae56d99d05a257c37fe4dc0d9">AST_AOC_CHARGING_ASSOCIATION_NUMBER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00187">aoc.h:187</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga753c7b39e3284d771f13f513b003d033"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">ast_mwi_state::uniqueid</a></div><div class="ttdeci">const ast_string_field uniqueid</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00460">mwi.h:460</a></div></div>
<div class="ttc" id="channel_8h_html_ae307ed78db92c08b0dd9c13a7724ae86"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae307ed78db92c08b0dd9c13a7724ae86">ast_channel_transfercapability_set</a></div><div class="ttdeci">void ast_channel_transfercapability_set(struct ast_channel *chan, unsigned short value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00505">channel_internal_api.c:505</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a2a1890787b3e55318c417c0a3e1432c7"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a2a1890787b3e55318c417c0a3e1432c7">END_OPTIONS</a></div><div class="ttdeci">#define END_OPTIONS</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01344">include/asterisk/app.h:1344</a></div></div>
<div class="ttc" id="channelstate_8h_html_ad9d8f7d9e228b5af98a7b40db9f06448"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448">ast_setstate</a></div><div class="ttdeci">int ast_setstate(struct ast_channel *chan, enum ast_channel_state)</div><div class="ttdoc">Change the state of a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l07486">channel.c:7486</a></div></div>
<div class="ttc" id="mwi_8h_html"><div class="ttname"><a href="../../dc/d33/mwi_8h.html">mwi.h</a></div><div class="ttdoc">Asterisk MWI API. </div></div>
<div class="ttc" id="structast__party__number_html"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html">ast_party_number</a></div><div class="ttdoc">Information needed to specify a number in a call. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00290">channel.h:290</a></div></div>
<div class="ttc" id="hsearch_8c_html_ad0f0f85b3cab490a81baa02c4b9edf45"><div class="ttname"><a href="../../db/d37/hsearch_8c.html#ad0f0f85b3cab490a81baa02c4b9edf45">retval</a></div><div class="ttdeci">static ENTRY retval</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d37/hsearch_8c_source.html#l00050">hsearch.c:50</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a6440d070425a2efe8e0aa71e8d9e47b7"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a></div><div class="ttdeci">#define ast_frfree(fr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00556">include/asterisk/frame.h:556</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_adf54768a4327f86de3a234648305c4a4"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#adf54768a4327f86de3a234648305c4a4">sig_pri_chan::digital</a></div><div class="ttdeci">unsigned int digital</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00343">sig_pri.h:343</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a4a3d11608d70f167d526b4b2312fec9c"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a4a3d11608d70f167d526b4b2312fec9c">sig_pri_span::discardremoteholdretrieval</a></div><div class="ttdeci">int discardremoteholdretrieval</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00452">sig_pri.h:452</a></div></div>
<div class="ttc" id="callerid_8h_html_a4b8463f8be514e1134291b2a9ddaeb35"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a4b8463f8be514e1134291b2a9ddaeb35">AST_PRES_ALLOWED</a></div><div class="ttdeci">#define AST_PRES_ALLOWED</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00324">callerid.h:324</a></div></div>
<div class="ttc" id="channel_8h_html_acb027b361350d81e4b94b540fbdfe4e4"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#acb027b361350d81e4b94b540fbdfe4e4">ast_transfercapability2str</a></div><div class="ttdeci">char * ast_transfercapability2str(int transfercapability) attribute_const</div><div class="ttdoc">Gives the string form of a given transfer capability. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l00678">channel.c:678</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ac195190da30da13bd36e3c39d818dc77"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ac195190da30da13bd36e3c39d818dc77">sig_pri_dial_complete</a></div><div class="ttdeci">void sig_pri_dial_complete(struct sig_pri_chan *pvt, struct ast_channel *ast)</div></div>
<div class="ttc" id="channel_8h_html_a7e5e15c22564fd66351d332ad10658b5"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7e5e15c22564fd66351d332ad10658b5">ast_queue_control_data</a></div><div class="ttdeci">int ast_queue_control_data(struct ast_channel *chan, enum ast_control_frame_type control, const void *data, size_t datalen)</div><div class="ttdoc">Queue a control frame with payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01238">channel.c:1238</a></div></div>
<div class="ttc" id="pbx_8h_html_a44b6406c9220f7f2b610ac712369f405"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a44b6406c9220f7f2b610ac712369f405">ast_pbx_run</a></div><div class="ttdeci">enum ast_pbx_result ast_pbx_run(struct ast_channel *c)</div><div class="ttdoc">Execute the PBX in the current thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04759">pbx.c:4759</a></div></div>
<div class="ttc" id="structast__control__pvt__cause__code_html"><div class="ttname"><a href="../../d9/d2d/structast__control__pvt__cause__code.html">ast_control_pvt_cause_code</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00413">include/asterisk/frame.h:413</a></div></div>
<div class="ttc" id="app__voicemail_8c_html_aa8ca9b5f9691b29d6124f113ca609b64"><div class="ttname"><a href="../../dc/df4/app__voicemail_8c.html#aa8ca9b5f9691b29d6124f113ca609b64">vm_box</a></div><div class="ttdeci">vm_box</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df4/app__voicemail_8c_source.html#l00571">app_voicemail.c:571</a></div></div>
<div class="ttc" id="channel_8h_html_a1677fd1f6e2cab646aeb76db8a044c2e"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1677fd1f6e2cab646aeb76db8a044c2e">ast_channel_get_device_name</a></div><div class="ttdeci">int ast_channel_get_device_name(struct ast_channel *chan, char *device_name, size_t name_buffer_length)</div><div class="ttdoc">Get a device name given its channel structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10697">channel.c:10697</a></div></div>
<div class="ttc" id="res__corosync_8c_html_a8e51289dd0fc7415cee40e7a57b49fdf"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a></div><div class="ttdeci">struct stasis_forward * sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00240">res_corosync.c:240</a></div></div>
<div class="ttc" id="structast__frame_html"><div class="ttname"><a href="../../d0/d99/structast__frame.html">ast_frame</a></div><div class="ttdoc">Data structure associated with a single frame of data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00165">include/asterisk/frame.h:165</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aae184c2fe57fb65661772d4772bd9444"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444">sig_pri_call_level</a></div><div class="ttdeci">sig_pri_call_level</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00135">sig_pri.h:135</a></div></div>
<div class="ttc" id="causes_8h_html"><div class="ttname"><a href="../../d4/da3/causes_8h.html">causes.h</a></div><div class="ttdoc">Internal Asterisk hangup causes. </div></div>
<div class="ttc" id="channel_8h_html_a8ec95c9df838fdfbb514995efb96bf82"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a8ec95c9df838fdfbb514995efb96bf82">ast_party_redirecting_set_init</a></div><div class="ttdeci">void ast_party_redirecting_set_init(struct ast_party_redirecting *init, const struct ast_party_redirecting *guide)</div><div class="ttdoc">Initialize the given redirecting id structure using the given guide for a set update operation...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02153">channel.c:2153</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a83859c0d9f6323aa52b700c8f344f1ad"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a83859c0d9f6323aa52b700c8f344f1ad">sig_pri_span::pritimers</a></div><div class="ttdeci">int pritimers[PRI_MAX_TIMERS]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00449">sig_pri.h:449</a></div></div>
<div class="ttc" id="channel_8h_html_ab683c21c4a34450c4bfb8b672a7b4045"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab683c21c4a34450c4bfb8b672a7b4045">ast_channel_softhangup_internal_flag_add</a></div><div class="ttdeci">void ast_channel_softhangup_internal_flag_add(struct ast_channel *chan, int value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l01005">channel_internal_api.c:1005</a></div></div>
<div class="ttc" id="aoc_8h_html_aed3fe8e8d708e8aff42a2ad205813cb7aff4d08a18d17f2ffe60dd21a316ae677"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#aed3fe8e8d708e8aff42a2ad205813cb7aff4d08a18d17f2ffe60dd21a316ae677">AST_AOC_SUBTOTAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00084">aoc.h:84</a></div></div>
<div class="ttc" id="stasis_8h_html_ab3da17290725793258020b83f56e4df6"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#ab3da17290725793258020b83f56e4df6">stasis_cache_get</a></div><div class="ttdeci">struct stasis_message * stasis_cache_get(struct stasis_cache *cache, struct stasis_message_type *type, const char *id)</div><div class="ttdoc">Retrieve an item from the cache for the ast_eid_default entity. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da9/stasis__cache_8c_source.html#l00686">stasis_cache.c:686</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00280">include/asterisk/frame.h:280</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_ae82785eb6a66d7f0b80342eb4bf60242"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#ae82785eb6a66d7f0b80342eb4bf60242">sig_pri_callback::make_cc_dialstring</a></div><div class="ttdeci">void(*const make_cc_dialstring)(void *pvt, char *buf, size_t buf_size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00214">sig_pri.h:214</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a1684dac20794c5ec370f8385d9b6fc01"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a1684dac20794c5ec370f8385d9b6fc01">sig_pri_chan::pri</a></div><div class="ttdeci">struct sig_pri_span * pri</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00357">sig_pri.h:357</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="options_8h_html"><div class="ttname"><a href="../../d7/d5b/options_8h.html">options.h</a></div><div class="ttdoc">Options provided by main asterisk program. </div></div>
<div class="ttc" id="aoc_8h_html_aa7dc1e0987972e9eb92627a1190eb548a3cdee929459fa195eabd19f5c156c7ec"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548a3cdee929459fa195eabd19f5c156c7ec">AST_AOC_S</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00064">aoc.h:64</a></div></div>
<div class="ttc" id="aoc_8h_html_aa7dc1e0987972e9eb92627a1190eb548a98adf1ef32c4d9b775cc595795ac4693"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548a98adf1ef32c4d9b775cc595795ac4693">AST_AOC_E</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00066">aoc.h:66</a></div></div>
<div class="ttc" id="structast__cc__agent_html"><div class="ttname"><a href="../../d0/db3/structast__cc__agent.html">ast_cc_agent</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00844">ccss.h:844</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a8add65c8e545478ee9b9a7cf97012683"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a8add65c8e545478ee9b9a7cf97012683">sig_pri_span::layer1_ignored</a></div><div class="ttdeci">unsigned int layer1_ignored</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00486">sig_pri.h:486</a></div></div>
<div class="ttc" id="structentry_html"><div class="ttname"><a href="../../d3/d96/structentry.html">entry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d85/search_8h_source.html#l00040">search.h:40</a></div></div>
<div class="ttc" id="channel_8h_html_a582dee4d5ea9b2ff6f309f0c5239f6bd"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a></div><div class="ttdeci">const char * ast_channel_context(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00344">channel_internal_api.c:344</a></div></div>
<div class="ttc" id="astdb_8h_html_a0f14f6bff4f412c88b50aba34d3a5e35"><div class="ttname"><a href="../../de/d4a/astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a></div><div class="ttdeci">int ast_db_put(const char *family, const char *key, const char *value)</div><div class="ttdoc">Store value addressed by family/key. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00327">main/db.c:327</a></div></div>
<div class="ttc" id="aoc_8h_html_a8f4901f528a0a8c757a12e94178606e6"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a8f4901f528a0a8c757a12e94178606e6">ast_aoc_set_association_id</a></div><div class="ttdeci">int ast_aoc_set_association_id(struct ast_aoc_decoded *decoded, const int id)</div><div class="ttdoc">set the charging association id for an AST_AOC_E message </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l01040">aoc.c:1040</a></div></div>
<div class="ttc" id="time_8h_html_aa13b651c18bc6004cab21ac041d44dd8"><div class="ttname"><a href="../../de/df7/time_8h.html#aa13b651c18bc6004cab21ac041d44dd8">ast_tvsub</a></div><div class="ttdeci">struct timeval ast_tvsub(struct timeval a, struct timeval b)</div><div class="ttdoc">Returns the difference of two timevals a - b. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l02298">extconf.c:2298</a></div></div>
<div class="ttc" id="aoc_8h_html_a34cb435b356514ce26df36a7bff4dfeb"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a34cb435b356514ce26df36a7bff4dfeb">ast_aoc_get_msg_type</a></div><div class="ttdeci">enum ast_aoc_type ast_aoc_get_msg_type(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">get the message type, AOC-D, AOC-E, or AOC Request </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00892">aoc.c:892</a></div></div>
<div class="ttc" id="structast__frame_html_a4027905f872af30d910929b07e261ca5"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">ast_frame::data</a></div><div class="ttdeci">union ast_frame::@263 data</div></div>
<div class="ttc" id="sig__pri_8h_html_a03805c1c05301a1e86967ad671dec748"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a03805c1c05301a1e86967ad671dec748">sig_pri_is_chan_available</a></div><div class="ttdeci">int sig_pri_is_chan_available(struct sig_pri_chan *pvt)</div></div>
<div class="ttc" id="structast__frame_html_a6937b93c56cb473b547eda454dca7b4c"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">ast_frame::frametype</a></div><div class="ttdeci">enum ast_frame_type frametype</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00167">include/asterisk/frame.h:167</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_aa9c7fe564b39094f9db7027725d4b26a"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#aa9c7fe564b39094f9db7027725d4b26a">sig_pri_callback::set_outgoing</a></div><div class="ttdeci">void(*const set_outgoing)(void *pvt, int is_outgoing)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00206">sig_pri.h:206</a></div></div>
<div class="ttc" id="structast__cc__monitor_html_ad517770dac2061381b2008850ff12e6c"><div class="ttname"><a href="../../d0/d6e/structast__cc__monitor.html#ad517770dac2061381b2008850ff12e6c">ast_cc_monitor::private_data</a></div><div class="ttdeci">void * private_data</div><div class="ttdoc">Data that is private to a monitor technology. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00561">ccss.h:561</a></div></div>
<div class="ttc" id="channel_8h_html_a8195bba43b7c08b3063bd19b28291b55"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a8195bba43b7c08b3063bd19b28291b55">ast_channel_queue_redirecting_update</a></div><div class="ttdeci">void ast_channel_queue_redirecting_update(struct ast_channel *chan, const struct ast_party_redirecting *redirecting, const struct ast_set_party_redirecting *update)</div><div class="ttdoc">Queue a redirecting update frame on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10392">channel.c:10392</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a483dce25d11ef9e5672aa206977f66f0"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a483dce25d11ef9e5672aa206977f66f0">sig_pri_chan::prioffset</a></div><div class="ttdeci">int prioffset</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00368">sig_pri.h:368</a></div></div>
<div class="ttc" id="structast__aoc__flat__rate_html_a070da2496793ccf8efc39f311bcda914"><div class="ttname"><a href="../../d9/d7a/structast__aoc__flat__rate.html#a070da2496793ccf8efc39f311bcda914">ast_aoc_flat_rate::amount</a></div><div class="ttdeci">uint32_t amount</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00139">aoc.h:139</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aa65ac97c8c851bb8c7e1b80c523670f2"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aa65ac97c8c851bb8c7e1b80c523670f2">DAHDI_CHAN_MAPPING_LOGICAL</a></div><div class="ttdeci">#define DAHDI_CHAN_MAPPING_LOGICAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00250">sig_pri.h:250</a></div></div>
<div class="ttc" id="callerid_8h_html_a2981008d349635cf996bb8629d15a926"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a2981008d349635cf996bb8629d15a926">AST_PRES_UNAVAILABLE</a></div><div class="ttdeci">#define AST_PRES_UNAVAILABLE</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00326">callerid.h:326</a></div></div>
<div class="ttc" id="structast__channel_html_ab06e9aa782b61ccfb42f7c48996f6ed4"><div class="ttname"><a href="../../df/d3c/structast__channel.html#ab06e9aa782b61ccfb42f7c48996f6ed4">ast_channel::x</a></div><div class="ttdeci">char x</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l00081">extconf.c:81</a></div></div>
<div class="ttc" id="lock_8h_html_a76e8ed6bb354be6c6dd9e51acc1d7a1b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a></div><div class="ttdeci">#define ast_mutex_init(pmutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00184">lock.h:184</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ab85195824a5cbc6eebb66dc1709f3626"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ab85195824a5cbc6eebb66dc1709f3626">SIG_PRI_AOC_GRANT_E</a></div><div class="ttdeci">#define SIG_PRI_AOC_GRANT_E</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00055">sig_pri.h:55</a></div></div>
<div class="ttc" id="aoc_8h_html_ac7f88b403a23432d67246765a900abd3"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#ac7f88b403a23432d67246765a900abd3">ast_aoc_get_currency_multiplier</a></div><div class="ttdeci">enum ast_aoc_currency_multiplier ast_aoc_get_currency_multiplier(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">get the currency multiplier for AOC-D and AOC-E messages </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00945">aoc.c:945</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="channel_8h_html_a7dc0d696d897c864c6f41a3a1795c82e"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7dc0d696d897c864c6f41a3a1795c82e">ast_channel_trylock</a></div><div class="ttdeci">#define ast_channel_trylock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02947">channel.h:2947</a></div></div>
<div class="ttc" id="structast__party__name_html_aaa04218f9e3a9065afa8be2491da8904"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">ast_party_name::valid</a></div><div class="ttdeci">unsigned char valid</div><div class="ttdoc">TRUE if the name information is valid/present. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00280">channel.h:280</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaf03b8daa7784a26648db90614add6caa"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaf03b8daa7784a26648db90614add6caa">ast_channel_publish_blob</a></div><div class="ttdeci">void ast_channel_publish_blob(struct ast_channel *chan, struct stasis_message_type *type, struct ast_json *blob)</div><div class="ttdoc">Publish a channel blob message. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l01135">stasis_channels.c:1135</a></div></div>
<div class="ttc" id="features_8h_html"><div class="ttname"><a href="../../de/d47/features_8h.html">features.h</a></div><div class="ttdoc">Call Parking and Pickup API Includes code and algorithms from the Zapata library. ...</div></div>
<div class="ttc" id="channel_8h_html_aa36854cfee90c77c4124e94273e42dffaf206a750513cebdced73ea3a40e4fe13"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffaf206a750513cebdced73ea3a40e4fe13">AST_PARTY_CHAR_SET_ISO10646_BMPSTRING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00252">channel.h:252</a></div></div>
<div class="ttc" id="structast__party__subaddress_html"><div class="ttname"><a href="../../d7/d41/structast__party__subaddress.html">ast_party_subaddress</a></div><div class="ttdoc">Information needed to specify a subaddress in a call. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00308">channel.h:308</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_aca036489931bf5571e2472331c8ac80b"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a></div><div class="ttdeci">#define AST_APP_OPTION(option, flagno)</div><div class="ttdoc">Declares an application option that does not accept an argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01402">include/asterisk/app.h:1402</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a36ca3adf0a7157210b997c3b42e3b77e"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a36ca3adf0a7157210b997c3b42e3b77e">sig_pri_cc_agent_start_offer_timer</a></div><div class="ttdeci">int sig_pri_cc_agent_start_offer_timer(struct ast_cc_agent *agent)</div></div>
<div class="ttc" id="structast__aoc__unit__entry_html"><div class="ttname"><a href="../../df/d18/structast__aoc__unit__entry.html">ast_aoc_unit_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00178">aoc.h:178</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a40668dcb7d940b80c4f109861059a978"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a40668dcb7d940b80c4f109861059a978">sig_pri_chan::outgoing</a></div><div class="ttdeci">unsigned int outgoing</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00342">sig_pri.h:342</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aadcd9dd828806b44aac0c6308d2df08a"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aadcd9dd828806b44aac0c6308d2df08a">sig_pri_load</a></div><div class="ttdeci">int sig_pri_load(const char *cc_type_name)</div></div>
<div class="ttc" id="sig__pri_8h_html_ad8cb5b22c9cefdcd96297dc50836dc5a"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ad8cb5b22c9cefdcd96297dc50836dc5a">sig_pri_chan_new</a></div><div class="ttdeci">struct sig_pri_chan * sig_pri_chan_new(void *pvt_data, struct sig_pri_span *pri, int logicalspan, int channo, int trunkgroup)</div></div>
<div class="ttc" id="structast__aoc__s__entry_html_ae1ae65af34ec51676f3d0c860561bbfe"><div class="ttname"><a href="../../d4/de4/structast__aoc__s__entry.html#ae1ae65af34ec51676f3d0c860561bbfe">ast_aoc_s_entry::rate_type</a></div><div class="ttdeci">uint16_t rate_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00167">aoc.h:167</a></div></div>
<div class="ttc" id="aoc_8h_html_a27f54e31b500e4b6e7396d345d5ed411aade837dc9996d9f33a8b2e0ec2dd73c7"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a27f54e31b500e4b6e7396d345d5ed411aade837dc9996d9f33a8b2e0ec2dd73c7">AST_AOC_CHARGED_ITEM_CALL_ATTEMPT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00149">aoc.h:149</a></div></div>
<div class="ttc" id="callerid_8h_html_a6a61669b28d0f994e44db5e3baab6ef2"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a6a61669b28d0f994e44db5e3baab6ef2">ast_shrink_phone_number</a></div><div class="ttdeci">void ast_shrink_phone_number(char *n)</div><div class="ttdoc">Shrink a phone number in place to just digits (more accurately it just removes ()&amp;#39;s, .&amp;#39;s, and -&amp;#39;s... </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd5/callerid_8c_source.html#l00947">callerid.c:947</a></div></div>
<div class="ttc" id="structast__mwi__state_html"><div class="ttname"><a href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a></div><div class="ttdoc">The structure that contains MWI state. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00457">mwi.h:457</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_ade5a89f9bee15a492c760ec1765a292d"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#ade5a89f9bee15a492c760ec1765a292d">sig_pri_chan::cid_name</a></div><div class="ttdeci">char cid_name[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00300">sig_pri.h:300</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a1e4a0fed4f941e3e49ead503d0b461c0"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a1e4a0fed4f941e3e49ead503d0b461c0">sig_pri_span::moh_signaling</a></div><div class="ttdeci">enum sig_pri_moh_signaling moh_signaling</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00514">sig_pri.h:514</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a35ab02b1fbf5754847e92fbd6583073c"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a35ab02b1fbf5754847e92fbd6583073c">sig_pri_span::nsf</a></div><div class="ttdeci">int nsf</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00559">sig_pri.h:559</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_abdcd7b92c9774bd089a24bd5b7ca21b1"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#abdcd7b92c9774bd089a24bd5b7ca21b1">sig_pri_callback::get_orig_dialstring</a></div><div class="ttdeci">const char *(*const get_orig_dialstring)(void *pvt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00213">sig_pri.h:213</a></div></div>
<div class="ttc" id="channel_8h_html_afdaf014aa17389de35cba4df16860b0d"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#afdaf014aa17389de35cba4df16860b0d">ast_party_caller_init</a></div><div class="ttdeci">void ast_party_caller_init(struct ast_party_caller *init)</div><div class="ttdoc">Initialize the given caller structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01978">channel.c:1978</a></div></div>
<div class="ttc" id="structast__cc__monitor_html_ade92ed8ed7a6fa7c3bb9a0e91db6e192"><div class="ttname"><a href="../../d0/d6e/structast__cc__monitor.html#ade92ed8ed7a6fa7c3bb9a0e91db6e192">ast_cc_monitor::service_offered</a></div><div class="ttdeci">enum ast_cc_service_type service_offered</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc8/ccss_8h_source.html#l00532">ccss.h:532</a></div></div>
<div class="ttc" id="say_8h_html"><div class="ttname"><a href="../../db/dce/say_8h.html">say.h</a></div><div class="ttdoc">Say numbers and dates (maybe words one day too) </div></div>
<div class="ttc" id="structsig__pri__span_html_a63fc22149930803b4e3fb4c453177e5e"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a63fc22149930803b4e3fb4c453177e5e">sig_pri_span::span</a></div><div class="ttdeci">int span</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00594">sig_pri.h:594</a></div></div>
<div class="ttc" id="aoc_8h_html_a1dab5872fd399614765583200752fce8"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a1dab5872fd399614765583200752fce8">ast_aoc_get_unit_count</a></div><div class="ttdeci">unsigned int ast_aoc_get_unit_count(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">get the number of unit entries for AOC-D and AOC-E messages </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l01019">aoc.c:1019</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_a44ac4c6a3693f3d2fa34a50428e42237"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#a44ac4c6a3693f3d2fa34a50428e42237">sig_pri_chan::allocated</a></div><div class="ttdeci">unsigned int allocated</div><div class="ttdoc">TRUE when this channel is allocated. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00341">sig_pri.h:341</a></div></div>
<div class="ttc" id="channel_8h_html_ae56cab679c0cda6436b930bc74297895"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a></div><div class="ttdeci">void ast_channel_priority_set(struct ast_channel *chan, int value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00448">channel_internal_api.c:448</a></div></div>
<div class="ttc" id="bridge_8h_html"><div class="ttname"><a href="../../d4/d56/bridge_8h.html">bridge.h</a></div><div class="ttdoc">Bridging API. </div></div>
<div class="ttc" id="ccss_8h_html_a05d18d9e83ba249ca1e5f23c537f2535"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a05d18d9e83ba249ca1e5f23c537f2535">ast_cc_get_monitor_by_recall_core_id</a></div><div class="ttdeci">struct ast_cc_monitor * ast_cc_get_monitor_by_recall_core_id(const int core_id, const char *const device_name)</div><div class="ttdoc">Get the associated monitor given the device name and core_id. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03519">ccss.c:3519</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a9f2dd3bce1d278c8c3628f82eb3e53fb"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a9f2dd3bce1d278c8c3628f82eb3e53fb">sig_pri_span::dchans</a></div><div class="ttdeci">struct pri * dchans[SIG_PRI_NUM_DCHANS]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00603">sig_pri.h:603</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_a414b69d7583bb4cfc6daf5276aac6d14"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#a414b69d7583bb4cfc6daf5276aac6d14">connected</a></div><div class="ttdeci">char connected</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00082">eagi_proxy.c:82</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_ac25ea00ee3f082df06e0cf468cbde240"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#ac25ea00ee3f082df06e0cf468cbde240">sig_pri_chan::context</a></div><div class="ttdeci">char context[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00289">sig_pri.h:289</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a63b68dece9c6cdaf9e240667bdc21f6b"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a63b68dece9c6cdaf9e240667bdc21f6b">SIG_PRI_DEBUG_DEFAULT</a></div><div class="ttdeci">#define SIG_PRI_DEBUG_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00050">sig_pri.h:50</a></div></div>
<div class="ttc" id="json_8h_html_ad20fdcbab1ed5c078284a687cced2877"><div class="ttname"><a href="../../d4/d05/json_8h.html#ad20fdcbab1ed5c078284a687cced2877">ast_json_integer_get</a></div><div class="ttdeci">intmax_t ast_json_integer_get(const struct ast_json *integer)</div><div class="ttdoc">Get the value from a JSON integer. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00322">json.c:322</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ae264fa3d1f9d29c2c76c99bfa13ce95caec52e17e178b0d502ca928de88f4f811"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ae264fa3d1f9d29c2c76c99bfa13ce95caec52e17e178b0d502ca928de88f4f811">SIG_PRI_TONE_CONGESTION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00060">sig_pri.h:60</a></div></div>
<div class="ttc" id="mwi_8h_html_ad83d6c9c09755c8b274a8f07fb2c64f7"><div class="ttname"><a href="../../dc/d33/mwi_8h.html#ad83d6c9c09755c8b274a8f07fb2c64f7">ast_mwi_subscribe_pool</a></div><div class="ttdeci">struct ast_mwi_subscriber * ast_mwi_subscribe_pool(const char *mailbox, stasis_subscription_cb callback, void *data)</div><div class="ttdoc">Add an MWI state subscriber, and stasis subscription to the mailbox. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00230">mwi.c:230</a></div></div>
<div class="ttc" id="ccss_8h_html_a3ccff7da399d534b7ac4eee20fb25ae7"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a3ccff7da399d534b7ac4eee20fb25ae7">ast_cc_monitor_stop_ringing</a></div><div class="ttdeci">int ast_cc_monitor_stop_ringing(int core_id)</div><div class="ttdoc">Alert a caller to stop ringing. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l04023">ccss.c:4023</a></div></div>
<div class="ttc" id="structast__aoc__unit__entry_html_a3aaa7811b1b3c09c7945b9e090220ea1"><div class="ttname"><a href="../../df/d18/structast__aoc__unit__entry.html#a3aaa7811b1b3c09c7945b9e090220ea1">ast_aoc_unit_entry::amount</a></div><div class="ttdeci">unsigned int amount</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00180">aoc.h:180</a></div></div>
<div class="ttc" id="astdb_8h_html"><div class="ttname"><a href="../../de/d4a/astdb_8h.html">astdb.h</a></div><div class="ttdoc">Persistant data storage (akin to *doze registry) </div></div>
<div class="ttc" id="structast__party__name_html"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html">ast_party_name</a></div><div class="ttdoc">Information needed to specify a name in a call. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00263">channel.h:263</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_ad049075cd52b3f86d2524940af4c98de"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#ad049075cd52b3f86d2524940af4c98de">sig_pri_callback::module_unref</a></div><div class="ttdeci">void(* module_unref)(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00233">sig_pri.h:233</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a80cd3f6f786b59b742bcecfc0b3be7c2"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a></div><div class="ttdeci">#define AST_DECLARE_APP_ARGS(name, arglist)</div><div class="ttdoc">Declare a structure to hold an application&amp;#39;s arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01249">include/asterisk/app.h:1249</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a5d91ced5d12d3dece11e38106bcfc827"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a5d91ced5d12d3dece11e38106bcfc827">sig_pri_cc_agent_req_rsp</a></div><div class="ttdeci">void sig_pri_cc_agent_req_rsp(struct ast_cc_agent *agent, enum ast_cc_agent_response_reason reason)</div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html">app.h</a></div><div class="ttdoc">Application convenience functions, designed to give consistent look and feel to Asterisk apps...</div></div>
<div class="ttc" id="sig__pri_8h_html_a7da4d7e4aa12411980e8ad434eba04b4"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a7da4d7e4aa12411980e8ad434eba04b4">SIG_PRI_AOC_GRANT_D</a></div><div class="ttdeci">#define SIG_PRI_AOC_GRANT_D</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00054">sig_pri.h:54</a></div></div>
<div class="ttc" id="structast__party__number_html_aaa04218f9e3a9065afa8be2491da8904"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">ast_party_number::valid</a></div><div class="ttdeci">unsigned char valid</div><div class="ttdoc">TRUE if the number information is valid/present. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00298">channel.h:298</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a0910da92515b2bd2853fc489d98f6499"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a0910da92515b2bd2853fc489d98f6499">sig_pri_span::pri</a></div><div class="ttdeci">struct pri * pri</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00604">sig_pri.h:604</a></div></div>
<div class="ttc" id="structast__aoc__duration__rate_html_a4519a215298e0964839d61c49e9c85f4"><div class="ttname"><a href="../../d6/d53/structast__aoc__duration__rate.html#a4519a215298e0964839d61c49e9c85f4">ast_aoc_duration_rate::granularity_time_scale</a></div><div class="ttdeci">uint16_t granularity_time_scale</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00111">aoc.h:111</a></div></div>
<div class="ttc" id="channel_8h_html_a6c2c406bdebd477029e61774cc300abd"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6c2c406bdebd477029e61774cc300abd">ast_channel_callid</a></div><div class="ttdeci">ast_callid ast_channel_callid(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00793">channel_internal_api.c:793</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a4c8e5865974440593998fff35afa83d7"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a4c8e5865974440593998fff35afa83d7">sig_pri_is_alarm_ignored</a></div><div class="ttdeci">int sig_pri_is_alarm_ignored(struct sig_pri_span *pri)</div></div>
<div class="ttc" id="sig__pri_8h_html_ab09fc5ec29ebd5412a3bac5f10969da8"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ab09fc5ec29ebd5412a3bac5f10969da8">sig_pri_cc_agent_callee_available</a></div><div class="ttdeci">int sig_pri_cc_agent_callee_available(struct ast_cc_agent *agent)</div></div>
<div class="ttc" id="channel_8h_html_aace0c1f41b57a6599775d0f704234eaf"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aace0c1f41b57a6599775d0f704234eaf">ast_channel_hangupcause_hash_set</a></div><div class="ttdeci">void ast_channel_hangupcause_hash_set(struct ast_channel *chan, const struct ast_control_pvt_cause_code *cause_code, int datalen)</div><div class="ttdoc">Sets the HANGUPCAUSE hash and optionally the SIP_CAUSE hash on the given channel. ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l04391">channel.c:4391</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_af689da2b77d1265192a78a5b0994a1d5"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#af689da2b77d1265192a78a5b0994a1d5">sig_pri_chan::mohinterpret</a></div><div class="ttdeci">char mohinterpret[MAX_MUSICCLASS]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00290">sig_pri.h:290</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0c585919b853d8ccef6d54422f289f2b"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0c585919b853d8ccef6d54422f289f2b">pri_is_up</a></div><div class="ttdeci">int pri_is_up(struct sig_pri_span *pri)</div></div>
<div class="ttc" id="structast__aoc__charging__association_html_a2708c0bbb6f926149707c2c61fe43c3e"><div class="ttname"><a href="../../d0/dad/structast__aoc__charging__association.html#a2708c0bbb6f926149707c2c61fe43c3e">ast_aoc_charging_association::id</a></div><div class="ttdeci">int32_t id</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00196">aoc.h:196</a></div></div>
<div class="ttc" id="transcap_8h_html_a70df930118839f3fc035fc9f15dfa621"><div class="ttname"><a href="../../d7/d86/transcap_8h.html#a70df930118839f3fc035fc9f15dfa621">AST_TRANS_CAP_DIGITAL</a></div><div class="ttdeci">#define AST_TRANS_CAP_DIGITAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d86/transcap_8h_source.html#l00035">transcap.h:35</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ae264fa3d1f9d29c2c76c99bfa13ce95ca2d37f45a9668a50e609b29622d00e0c5"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ae264fa3d1f9d29c2c76c99bfa13ce95ca2d37f45a9668a50e609b29622d00e0c5">SIG_PRI_TONE_DIALTONE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00061">sig_pri.h:61</a></div></div>
<div class="ttc" id="ccss_8h_html_a8f831cfaba759c6073f1940c9b81e2a9"><div class="ttname"><a href="../../de/dc8/ccss_8h.html#a8f831cfaba759c6073f1940c9b81e2a9">ast_cc_monitor_callee_available</a></div><div class="ttdeci">int ast_cc_monitor_callee_available(const int core_id, const char *const debug,...)</div><div class="ttdoc">Alert the core that a device being monitored has become available. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5a/ccss_8c_source.html#l03798">ccss.c:3798</a></div></div>
<div class="ttc" id="structsig__pri__callback_html_a37d6733b3c615f45c446c2671f3d7b6e"><div class="ttname"><a href="../../d3/da2/structsig__pri__callback.html#a37d6733b3c615f45c446c2671f3d7b6e">sig_pri_callback::queue_control</a></div><div class="ttdeci">void(*const queue_control)(void *pvt, int subclass)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00210">sig_pri.h:210</a></div></div>
<div class="ttc" id="aoc_8h_html_afd4aa65b3a57ed3e33e0cd5f7ff9c136afcc954c074314092fc28fa66cf158f48"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136afcc954c074314092fc28fa66cf158f48">AST_AOC_RATE_TYPE_FREE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00157">aoc.h:157</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00285">include/asterisk/frame.h:285</a></div></div>
<div class="ttc" id="aoc_8h_html_afd4aa65b3a57ed3e33e0cd5f7ff9c136aae1181ffe5fdb5bfa119c3421f44e944"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#afd4aa65b3a57ed3e33e0cd5f7ff9c136aae1181ffe5fdb5bfa119c3421f44e944">AST_AOC_RATE_TYPE_FLAT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00160">aoc.h:160</a></div></div>
<div class="ttc" id="structsig__pri__span_html_a69ecd7d1df95100db1b2bdc42b0166a6"><div class="ttname"><a href="../../df/db1/structsig__pri__span.html#a69ecd7d1df95100db1b2bdc42b0166a6">sig_pri_span::fds</a></div><div class="ttdeci">int fds[SIG_PRI_NUM_DCHANS]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00459">sig_pri.h:459</a></div></div>
<div class="ttc" id="structsig__pri__chan_html_adf7dff2c57c0da9a4a2b70e3e815be31"><div class="ttname"><a href="../../d9/d9a/structsig__pri__chan.html#adf7dff2c57c0da9a4a2b70e3e815be31">sig_pri_chan::channel</a></div><div class="ttdeci">int channel</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00292">sig_pri.h:292</a></div></div>
<div class="ttc" id="stasis_8h_html_a51fb372b38f434a3bab7a5ec5e65c396"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a51fb372b38f434a3bab7a5ec5e65c396">STASIS_MESSAGE_TYPE_DEFN_LOCAL</a></div><div class="ttdeci">#define STASIS_MESSAGE_TYPE_DEFN_LOCAL(name,...)</div><div class="ttdoc">Boiler-plate messaging macro for defining local message types. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l01475">stasis.h:1475</a></div></div>
<div class="ttc" id="sig__pri_8h_html_ac78d645f6e15d770b1d413281cb0c89b"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#ac78d645f6e15d770b1d413281cb0c89b">pri_event_noalarm</a></div><div class="ttdeci">void pri_event_noalarm(struct sig_pri_span *pri, int index, int before_start_pri)</div></div>
<div class="ttc" id="app__jack_8c_html_ac191e5810fa65e63095409471eb5648f"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a></div><div class="ttdeci">jack_status_t status</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00146">app_jack.c:146</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aae184c2fe57fb65661772d4772bd9444a97a62807945f1318b8d4f643c3709c94"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444a97a62807945f1318b8d4f643c3709c94">SIG_PRI_CALL_LEVEL_DEFER_DIAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00147">sig_pri.h:147</a></div></div>
<div class="ttc" id="aoc_8h_html_aa7dc1e0987972e9eb92627a1190eb548a463d1c225066e20d4cc56abee5a5b239"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#aa7dc1e0987972e9eb92627a1190eb548a463d1c225066e20d4cc56abee5a5b239">AST_AOC_D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00065">aoc.h:65</a></div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
<div class="ttc" id="http_8c_html_a6f25bc812d09fedb86bf394c01061c56"><div class="ttname"><a href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a></div><div class="ttdeci">static char prefix[MAX_PREFIX]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00141">http.c:141</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a037e9a5b28477b17e7c9acbe7ecb21d5"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a></div><div class="ttdeci">#define AST_APP_ARG(name)</div><div class="ttdoc">Define an application argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01232">include/asterisk/app.h:1232</a></div></div>
<div class="ttc" id="structast__aoc__volume__rate_html_a2854e091b0a0f6c8da639ced777fe99d"><div class="ttname"><a href="../../db/d83/structast__aoc__volume__rate.html#a2854e091b0a0f6c8da639ced777fe99d">ast_aoc_volume_rate::currency_name</a></div><div class="ttdeci">char currency_name[AOC_CURRENCY_NAME_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00135">aoc.h:135</a></div></div>
<div class="ttc" id="aoc_8h_html_a328e01991ff5489d6289285654cb9402ae00c4894ab4f166394380b3b8ff2ea32"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a328e01991ff5489d6289285654cb9402ae00c4894ab4f166394380b3b8ff2ea32">AST_AOC_TIME_SCALE_SECOND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db3/aoc_8h_source.html#l00090">aoc.h:90</a></div></div>
<div class="ttc" id="isdn__msg__parser_8c_html_a139bfa19a96fc46c46a86ca405ec630d"><div class="ttname"><a href="../../de/dfd/isdn__msg__parser_8c.html#a139bfa19a96fc46c46a86ca405ec630d">build_status</a></div><div class="ttdeci">static msg_t * build_status(struct isdn_msg msgs[], struct misdn_bchannel *bc, int nt)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfd/isdn__msg__parser_8c_source.html#l01598">isdn_msg_parser.c:1598</a></div></div>
<div class="ttc" id="sig__pri_8h_html_a0d00c58c39ee81f43bdeef1081ec26e6"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#a0d00c58c39ee81f43bdeef1081ec26e6">sig_pri_cc_agent_status_req</a></div><div class="ttdeci">int sig_pri_cc_agent_status_req(struct ast_cc_agent *agent)</div></div>
<div class="ttc" id="channel_8h_html_aa36854cfee90c77c4124e94273e42dffae83dea89fd3ea1272aca35be3e9767e9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa36854cfee90c77c4124e94273e42dffae83dea89fd3ea1272aca35be3e9767e9">AST_PARTY_CHAR_SET_ISO8859_1</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00245">channel.h:245</a></div></div>
<div class="ttc" id="aoc_8h_html_a84cc9357bb1acbc2b24d7e80780e3b9d"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a84cc9357bb1acbc2b24d7e80780e3b9d">ast_aoc_set_currency_info</a></div><div class="ttdeci">int ast_aoc_set_currency_info(struct ast_aoc_decoded *decoded, const unsigned int amount, const enum ast_aoc_currency_multiplier multiplier, const char *name)</div><div class="ttdoc">Sets the currency values for a AOC-D or AOC-E message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l00919">aoc.c:919</a></div></div>
<div class="ttc" id="aoc_8h_html_a28da5b6a0c5bfb9caec2c753c3225f9b"><div class="ttname"><a href="../../d6/db3/aoc_8h.html#a28da5b6a0c5bfb9caec2c753c3225f9b">ast_aoc_get_association_info</a></div><div class="ttdeci">const struct ast_aoc_charging_association * ast_aoc_get_association_info(struct ast_aoc_decoded *decoded)</div><div class="ttdoc">get the charging association info for AOC-E messages </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da6/aoc_8c_source.html#l01051">aoc.c:1051</a></div></div>
<div class="ttc" id="structast__party__id_html_aca2d7de6c89f201dc8bd0a2642d2a352"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">ast_party_id::number</a></div><div class="ttdeci">struct ast_party_number number</div><div class="ttdoc">Subscriber phone number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00343">channel.h:343</a></div></div>
<div class="ttc" id="sig__pri_8h_html_aae184c2fe57fb65661772d4772bd9444aadfde2210c446742a8276382cb57a960"><div class="ttname"><a href="../../d7/d6c/sig__pri_8h.html#aae184c2fe57fb65661772d4772bd9444aadfde2210c446742a8276382cb57a960">SIG_PRI_CALL_LEVEL_ALERTING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/sig__pri_8h_source.html#l00145">sig_pri.h:145</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:14 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
