<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_pjsip_transport_websocket.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">res_pjsip_transport_websocket.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d2/db8/res__pjsip__transport__websocket_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2013, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Jason Parker &lt;jparker@digium.com&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * \brief WebSocket transport module</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">   &lt;depend&gt;pjproject&lt;/depend&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">   &lt;depend&gt;res_pjsip&lt;/depend&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">   &lt;depend&gt;res_http_websocket&lt;/depend&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">   &lt;support_level&gt;core&lt;/support_level&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;pjsip.h&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &lt;pjsip_ua.h&gt;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/module_8h.html">asterisk/module.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d0c/http__websocket_8h.html">asterisk/http_websocket.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8c/res__pjsip_8h.html">asterisk/res_pjsip.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/de7/res__pjsip__session_8h.html">asterisk/res_pjsip_session.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d1e/taskprocessor_8h.html">asterisk/taskprocessor.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#abfe278a1b1c534bd884ea904a4760873">   41</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#abfe278a1b1c534bd884ea904a4760873">transport_type_wss</a>;</div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a9fd473a87557dd7d972b451a3f9a2fa7">   42</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a9fd473a87557dd7d972b451a3f9a2fa7">transport_type_wss_ipv6</a>;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> * Used to ensure uniqueness among WS transport names</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a3995e8771694f508927701051550b84f">   47</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a3995e8771694f508927701051550b84f">ws_obj_name_serial</a>;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> * \brief Wrapper for pjsip_transport, for storing the WebSocket session</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="../../d9/df4/structws__transport.html">   52</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> {</div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">   53</a></span>&#160;   pjsip_transport <a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>;</div><div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="../../d9/df4/structws__transport.html#af99e1ed6820832031bc71b738d42d483">   54</a></span>&#160;   pjsip_rx_data <a class="code" href="../../d9/df4/structws__transport.html#af99e1ed6820832031bc71b738d42d483">rdata</a>;</div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">   55</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;};</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"> * \brief Send a message over the WebSocket connection.</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"> * Called by pjsip transport manager.</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a572c79c244e74ab8d782532614b32937">   63</a></span>&#160;<span class="keyword">static</span> pj_status_t <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a572c79c244e74ab8d782532614b32937">ws_send_msg</a>(pjsip_transport *<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>,</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                            pjsip_tx_data *tdata,</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                            <span class="keyword">const</span> pj_sockaddr_t *rem_addr,</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                            <span class="keywordtype">int</span> addr_len,</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                            <span class="keywordtype">void</span> *token,</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                            pjsip_transport_callback callback)</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;{</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> *wstransport = (<span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> *)transport;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;   uint64_t <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = tdata-&gt;buf.cur - tdata-&gt;buf.start;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a1a6e44db94d8b4e8c06bf456bb0174ad">ast_websocket_write</a>(wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>, <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0">AST_WEBSOCKET_OPCODE_TEXT</a>, tdata-&gt;buf.start, len)) {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordflow">return</span> PJ_EUNKNOWN;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;   <span class="keywordflow">return</span> PJ_SUCCESS;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> * \brief Destroy the pjsip transport.</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"> * Called by pjsip transport manager.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac68f1faebab308de8bef88e6dd87c611">   85</a></span>&#160;<span class="keyword">static</span> pj_status_t <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac68f1faebab308de8bef88e6dd87c611">ws_destroy</a>(pjsip_transport *<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>)</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;{</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> *wstransport = (<span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> *)transport;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;   <span class="keywordtype">int</span> fd = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a874ca6ebfa7b35e92557cc97af1d41be">ast_websocket_fd</a>(wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   <span class="keywordflow">if</span> (fd &gt; 0) {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a>(wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>, 1000);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      shutdown(fd, SHUT_RDWR);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(wstransport, -1);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   <span class="keywordflow">return</span> PJ_SUCCESS;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;}</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a303e8e7473dacff22f987d57fbc060b7">  100</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a303e8e7473dacff22f987d57fbc060b7">transport_dtor</a>(<span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;{</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> *wstransport = arg;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;   <span class="keywordflow">if</span> (wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>) {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#af03daa0a59002330aacdfcb44da59db9">ast_websocket_unref</a>(wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;   <span class="keywordflow">if</span> (wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.ref_cnt) {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      pj_atomic_destroy(wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.ref_cnt);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;   <span class="keywordflow">if</span> (wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.lock) {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      pj_lock_destroy(wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.lock);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;   }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;   <span class="keywordflow">if</span> (wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.endpt &amp;&amp; wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.pool) {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      pjsip_endpt_release_pool(wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.endpt, wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.pool);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;   }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;   <span class="keywordflow">if</span> (wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#af99e1ed6820832031bc71b738d42d483">rdata</a>.tp_info.pool) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      pjsip_endpt_release_pool(wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.endpt, wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#af99e1ed6820832031bc71b738d42d483">rdata</a>.tp_info.pool);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;   }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac091c7e5f5bce000ae13583024204a9b">  125</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac091c7e5f5bce000ae13583024204a9b">transport_shutdown</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;{</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> *wstransport = data;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;   <span class="keywordflow">if</span> (!wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.is_shutdown &amp;&amp; !wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.is_destroying) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      pjsip_transport_shutdown(&amp;wstransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;   <span class="comment">/* Note that the destructor calls PJSIP functions,</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">    * therefore it must be called in a PJSIP thread.</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(wstransport, -1);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="../../de/d91/structtransport__create__data.html">  141</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../de/d91/structtransport__create__data.html">transport_create_data</a> {</div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="../../de/d91/structtransport__create__data.html#a38daabbdc7a8284a525ab4df6541f6fc">  142</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> *<a class="code" href="../../de/d91/structtransport__create__data.html#a38daabbdc7a8284a525ab4df6541f6fc">transport</a>;</div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="../../de/d91/structtransport__create__data.html#ac342f8822c2fee73e38fa6785b03997e">  143</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="code" href="../../de/d91/structtransport__create__data.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;};</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"> * \brief Create a pjsip transport.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a6834da3f36d1802a36a8efbf7818e008">  149</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a6834da3f36d1802a36a8efbf7818e008">transport_create</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;{</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/d91/structtransport__create__data.html">transport_create_data</a> *create_data = data;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> *newtransport = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   pjsip_tp_state_callback state_cb;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;   pjsip_endpoint *endpt = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>();</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   <span class="keyword">struct </span>pjsip_tpmgr *tpmgr = pjsip_endpt_get_tpmgr(endpt);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;   <span class="keywordtype">char</span> *ws_addr_str;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;   pj_pool_t *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;   pj_str_t <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;   pj_status_t <a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   newtransport = <a class="code" href="../../d5/da5/astobj2_8h.html#a7d8e253a1db2dc47ed4af636c3ea89ce">ao2_t_alloc_options</a>(<span class="keyword">sizeof</span>(*newtransport), <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a303e8e7473dacff22f987d57fbc060b7">transport_dtor</a>,</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, <span class="stringliteral">&quot;pjsip websocket transport&quot;</span>);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;   <span class="keywordflow">if</span> (!newtransport) {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate WebSocket transport.\n&quot;</span>);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="keywordflow">goto</span> on_error;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;   }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;   <span class="comment">/* Give websocket transport a unique name for its lifetime */</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;   snprintf(newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.obj_name, PJ_MAX_OBJ_NAME, <span class="stringliteral">&quot;ws%p-%d&quot;</span>,</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      &amp;newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>, <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a3995e8771694f508927701051550b84f">ws_obj_name_serial</a>, 1));</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.endpt = endpt;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;   <span class="keywordflow">if</span> (!(pool = pjsip_endpt_create_pool(endpt, <span class="stringliteral">&quot;ws&quot;</span>, 512, 512))) {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate WebSocket endpoint pool.\n&quot;</span>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordflow">goto</span> on_error;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;   }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.pool = <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a> = create_data-&gt;<a class="code" href="../../de/d91/structtransport__create__data.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;   <span class="comment">/* Keep the session until transport dies */</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a050ca80ad7ca07b7643d5ffab2474473">ast_websocket_ref</a>(newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   status = pj_atomic_create(pool, 0, &amp;newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.ref_cnt);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   <span class="keywordflow">if</span> (status != PJ_SUCCESS) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keywordflow">goto</span> on_error;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;   status = pj_lock_create_recursive_mutex(pool, pool-&gt;obj_name, &amp;newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.lock);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;   <span class="keywordflow">if</span> (status != PJ_SUCCESS) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">goto</span> on_error;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">    * The type_name here is mostly used by log messages eihter in</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">    * pjproject or Asterisk.  Other places are reconstituting subscriptions</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">    * after a restart (which could never work for a websocket connection anyway),</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">    * received MESSAGE requests to set PJSIP_TRANSPORT, and most importantly</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">    * by pjproject when generating the Via header.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.type_name = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a638aea4c786e326ded80afaecb09745c">ast_websocket_is_secure</a>(newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>)</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      ? <span class="stringliteral">&quot;WSS&quot;</span> : <span class="stringliteral">&quot;WS&quot;</span>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;   ws_addr_str = <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(<a class="code" href="../../de/d4c/res__http__websocket_8c.html#aa854546175b8c60844ecdf14c33b6e97">ast_websocket_remote_address</a>(newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>));</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;Creating websocket transport for %s:%s\n&quot;</span>,</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.type_name, ws_addr_str);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.info = (<span class="keywordtype">char</span> *) pj_pool_alloc(newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.pool,</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      strlen(newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.type_name) + strlen(ws_addr_str) + <span class="keyword">sizeof</span>(<span class="stringliteral">&quot; to &quot;</span>));</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   sprintf(newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.info, <span class="stringliteral">&quot;%s to %s&quot;</span>, newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.type_name, ws_addr_str);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   pj_sockaddr_parse(pj_AF_UNSPEC(), 0, pj_cstr(&amp;buf, ws_addr_str), &amp;newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.key.rem_addr);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   <span class="keywordflow">if</span> (newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.key.rem_addr.addr.sa_family == pj_AF_INET6()) {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.key.type = <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a9fd473a87557dd7d972b451a3f9a2fa7">transport_type_wss_ipv6</a>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.key.type = <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#abfe278a1b1c534bd884ea904a4760873">transport_type_wss</a>;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.addr_len = pj_sockaddr_get_len(&amp;newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.key.rem_addr);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   ws_addr_str = <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a9e80e75c690108f7466085cf3f956244">ast_websocket_local_address</a>(newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>));</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;   pj_sockaddr_parse(pj_AF_UNSPEC(), 0, pj_cstr(&amp;buf, ws_addr_str), &amp;newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.local_addr);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;   pj_strdup2(pool, &amp;newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.local_name.host, <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a9e80e75c690108f7466085cf3f956244">ast_websocket_local_address</a>(newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>)));</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.local_name.port = <a class="code" href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a>(<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a9e80e75c690108f7466085cf3f956244">ast_websocket_local_address</a>(newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>));</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.flag = pjsip_transport_get_flag_from_type((pjsip_transport_type_e)newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.key.type);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.dir = PJSIP_TP_DIR_INCOMING;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.tpmgr = tpmgr;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.send_msg = &amp;<a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a572c79c244e74ab8d782532614b32937">ws_send_msg</a>;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.destroy = &amp;<a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac68f1faebab308de8bef88e6dd87c611">ws_destroy</a>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   status = pjsip_transport_register(newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>.tpmgr,</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;         (pjsip_transport *)newtransport);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   <span class="keywordflow">if</span> (status != PJ_SUCCESS) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordflow">goto</span> on_error;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;   }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;   <span class="comment">/* Add a reference for pjsip transport manager */</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(newtransport, +1);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   newtransport-&gt;rdata.tp_info.transport = &amp;newtransport-&gt;transport;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   newtransport-&gt;rdata.tp_info.pool = pjsip_endpt_create_pool(endpt, <span class="stringliteral">&quot;rtd%p&quot;</span>,</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      PJSIP_POOL_RDATA_LEN, PJSIP_POOL_RDATA_INC);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   <span class="keywordflow">if</span> (!newtransport-&gt;rdata.tp_info.pool) {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate WebSocket rdata.\n&quot;</span>);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      pjsip_transport_destroy((pjsip_transport *)newtransport);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">goto</span> on_error;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   create_data-&gt;<a class="code" href="../../de/d91/structtransport__create__data.html#a38daabbdc7a8284a525ab4df6541f6fc">transport</a> = newtransport;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <span class="comment">/* Notify application of transport state */</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   state_cb = pjsip_tpmgr_get_state_cb(newtransport-&gt;transport.tpmgr);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   <span class="keywordflow">if</span> (state_cb) {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      pjsip_transport_state_info state_info;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      memset(&amp;state_info, 0, <span class="keyword">sizeof</span>(state_info));</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      state_cb(&amp;newtransport-&gt;transport, PJSIP_TP_STATE_CONNECTED, &amp;state_info);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;   }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;on_error:</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(newtransport);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;}</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="../../de/d62/structtransport__read__data.html">  271</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../de/d62/structtransport__read__data.html">transport_read_data</a> {</div><div class="line"><a name="l00272"></a><span class="lineno"><a class="line" href="../../de/d62/structtransport__read__data.html#a38daabbdc7a8284a525ab4df6541f6fc">  272</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> *<a class="code" href="../../de/d62/structtransport__read__data.html#a38daabbdc7a8284a525ab4df6541f6fc">transport</a>;</div><div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="../../de/d62/structtransport__read__data.html#a18f141cb2726073503afb9f1d6c85efb">  273</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../de/d62/structtransport__read__data.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>;</div><div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="../../de/d62/structtransport__read__data.html#ae8c81c5ddc738c582eb1ee3962d41394">  274</a></span>&#160;   uint64_t <a class="code" href="../../de/d62/structtransport__read__data.html#ae8c81c5ddc738c582eb1ee3962d41394">payload_len</a>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;};</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"> * \brief Pass WebSocket data into pjsip transport manager.</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#acd95df9a5374ed8350f7ea624b16f991">  280</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#acd95df9a5374ed8350f7ea624b16f991">transport_read</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;{</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/d62/structtransport__read__data.html">transport_read_data</a> *read_data = data;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> *newtransport = read_data-&gt;<a class="code" href="../../de/d62/structtransport__read__data.html#a38daabbdc7a8284a525ab4df6541f6fc">transport</a>;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a> = newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a>;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;   pjsip_rx_data *<a class="code" href="../../d9/df4/structws__transport.html#af99e1ed6820832031bc71b738d42d483">rdata</a> = &amp;newtransport-&gt;<a class="code" href="../../d9/df4/structws__transport.html#af99e1ed6820832031bc71b738d42d483">rdata</a>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;   <span class="keywordtype">int</span> recvd;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;   pj_str_t <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;   <span class="keywordtype">int</span> pjsip_pkt_len;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   pj_gettimeofday(&amp;rdata-&gt;pkt_info.timestamp);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;   pjsip_pkt_len = PJSIP_MAX_PKT_LEN &lt; read_data-&gt;<a class="code" href="../../de/d62/structtransport__read__data.html#ae8c81c5ddc738c582eb1ee3962d41394">payload_len</a> ? PJSIP_MAX_PKT_LEN : read_data-&gt;<a class="code" href="../../de/d62/structtransport__read__data.html#ae8c81c5ddc738c582eb1ee3962d41394">payload_len</a>;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;   pj_memcpy(rdata-&gt;pkt_info.packet, read_data-&gt;<a class="code" href="../../de/d62/structtransport__read__data.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>, pjsip_pkt_len);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;   rdata-&gt;pkt_info.len = pjsip_pkt_len;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;   rdata-&gt;pkt_info.zero = 0;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   pj_sockaddr_parse(pj_AF_UNSPEC(), 0, pj_cstr(&amp;buf, <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(<a class="code" href="../../de/d4c/res__http__websocket_8c.html#aa854546175b8c60844ecdf14c33b6e97">ast_websocket_remote_address</a>(session))), &amp;rdata-&gt;pkt_info.src_addr);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;   rdata-&gt;pkt_info.src_addr_len = <span class="keyword">sizeof</span>(rdata-&gt;pkt_info.src_addr);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   pj_ansi_strcpy(rdata-&gt;pkt_info.src_name, <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(<a class="code" href="../../de/d4c/res__http__websocket_8c.html#aa854546175b8c60844ecdf14c33b6e97">ast_websocket_remote_address</a>(session)));</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   rdata-&gt;pkt_info.src_port = <a class="code" href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a>(<a class="code" href="../../de/d4c/res__http__websocket_8c.html#aa854546175b8c60844ecdf14c33b6e97">ast_websocket_remote_address</a>(session));</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   recvd = pjsip_tpmgr_receive_packet(rdata-&gt;tp_info.transport-&gt;tpmgr, rdata);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;   pj_pool_reset(rdata-&gt;tp_info.pool);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   <span class="keywordflow">return</span> (read_data-&gt;<a class="code" href="../../de/d62/structtransport__read__data.html#ae8c81c5ddc738c582eb1ee3962d41394">payload_len</a> == recvd) ? 0 : -1;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;}</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a36e1dc178732a0de5bf2343313832662">  311</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a36e1dc178732a0de5bf2343313832662">get_write_timeout</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;{</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;   <span class="keywordtype">int</span> write_timeout = -1;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d3/d17/config__transport_8c.html#afcddeb3e731b920c647149af910906e6">transport_states</a>;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   transport_states = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7739cc1c2dda386e264c2e90855d4e3e">ast_sip_get_transport_states</a>();</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   <span class="keywordflow">if</span> (transport_states) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> it_transport_states = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(transport_states, 0);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../db/dac/structast__sip__transport__state.html">ast_sip_transport_state</a> *transport_state;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">for</span> (; (transport_state = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;it_transport_states)); <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(transport_state)) {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d1/d04/structast__sip__transport.html">ast_sip_transport</a> *<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;         <span class="keywordflow">if</span> (transport_state-&gt;<a class="code" href="../../db/dac/structast__sip__transport__state.html#a412bcf75e793ebae3f463f57410a6046">type</a> != <a class="code" href="../../db/df1/netsock2_8h.html#aa2785c5990a086943fea750c980abbc3a6d8ef74bba673bd5a95d9b2da8116b4f">AST_TRANSPORT_WS</a> &amp;&amp; transport_state-&gt;<a class="code" href="../../db/dac/structast__sip__transport__state.html#a412bcf75e793ebae3f463f57410a6046">type</a> != <a class="code" href="../../db/df1/netsock2_8h.html#aa2785c5990a086943fea750c980abbc3a611d4a9fc154cea78fe3f7f768185c4d">AST_TRANSPORT_WSS</a>) {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;         }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;         transport = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;transport&quot;</span>, transport_state-&gt;<a class="code" href="../../db/dac/structast__sip__transport__state.html#aecb3b0d045ada529257a2fbf8f829599">id</a>);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;         <span class="keywordflow">if</span> (!transport) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;         }</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;Found %s transport with write timeout: %d\n&quot;</span>,</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            transport-&gt;<a class="code" href="../../d1/d04/structast__sip__transport.html#a412bcf75e793ebae3f463f57410a6046">type</a> == <a class="code" href="../../db/df1/netsock2_8h.html#aa2785c5990a086943fea750c980abbc3a6d8ef74bba673bd5a95d9b2da8116b4f">AST_TRANSPORT_WS</a> ? <span class="stringliteral">&quot;WS&quot;</span> : <span class="stringliteral">&quot;WSS&quot;</span>,</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            transport-&gt;<a class="code" href="../../d1/d04/structast__sip__transport.html#a199f91b67127c0be666a283e3e600c56">write_timeout</a>);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;         write_timeout = <a class="code" href="../../d5/d60/utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(write_timeout, transport-&gt;<a class="code" href="../../d1/d04/structast__sip__transport.html#a199f91b67127c0be666a283e3e600c56">write_timeout</a>);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;it_transport_states);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(transport_states);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;   }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;   <span class="keywordflow">if</span> (write_timeout &lt; 0) {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      write_timeout = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a88147fdf589f09cb59e2687fbf74f835">AST_DEFAULT_WEBSOCKET_WRITE_TIMEOUT</a>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;   }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Write timeout for WS/WSS transports: %d\n&quot;</span>, write_timeout);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/d04/structast__sip__transport.html#a199f91b67127c0be666a283e3e600c56">write_timeout</a>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;}</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a0eb7d60c4ca7a7540b5581367df30ba4">  349</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *<a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a0eb7d60c4ca7a7540b5581367df30ba4">create_websocket_serializer</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;{</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   <span class="keywordtype">char</span> tps_name[<a class="code" href="../../d0/d1e/taskprocessor_8h.html#adf4c5a237767eb6db5b1db41ccdfc689">AST_TASKPROCESSOR_MAX_NAME</a> + 1];</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <span class="comment">/* Create name with seq number appended. */</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ab47623e207bf2cdd0edfa613d91894e5">ast_taskprocessor_build_name</a>(tps_name, <span class="keyword">sizeof</span>(tps_name), <span class="stringliteral">&quot;pjsip/websocket&quot;</span>);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d7/dfa/group__pjsip__threading.html#gad57aa0b914fbd6adbf8ee2fe176e1fb1">ast_sip_create_serializer</a>(tps_name);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">/*! \brief WebSocket connection handler. */</span></div><div class="line"><a name="l00360"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#abe5fa424121952d3029a10729b996772">  360</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#abe5fa424121952d3029a10729b996772">websocket_cb</a>(<span class="keyword">struct</span> <a class="code" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *parameters, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *headers)</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;{</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *<a class="code" href="../../d9/d47/structserializer.html">serializer</a>;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/d91/structtransport__create__data.html">transport_create_data</a> create_data;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/df4/structws__transport.html">ws_transport</a> *<a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/d62/structtransport__read__data.html">transport_read_data</a> read_data;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#ab549e9a066a7c7738330e31b0b083177">ast_websocket_set_nonblock</a>(session)) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#af03daa0a59002330aacdfcb44da59db9">ast_websocket_unref</a>(session);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;   }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#adc1ab49fc86302e5de5b0c25308ad2da">ast_websocket_set_timeout</a>(session, <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a36e1dc178732a0de5bf2343313832662">get_write_timeout</a>())) {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#af03daa0a59002330aacdfcb44da59db9">ast_websocket_unref</a>(session);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;   }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   serializer = <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a0eb7d60c4ca7a7540b5581367df30ba4">create_websocket_serializer</a>();</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;   <span class="keywordflow">if</span> (!serializer) {</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#af03daa0a59002330aacdfcb44da59db9">ast_websocket_unref</a>(session);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   create_data.<a class="code" href="../../de/d91/structtransport__create__data.html#ac342f8822c2fee73e38fa6785b03997e">ws_session</a> = <a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#gac231880459dcf8feacf1bb272b60472a">ast_sip_push_task_wait_serializer</a>(serializer, <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a6834da3f36d1802a36a8efbf7818e008">transport_create</a>, &amp;create_data)) {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not create WebSocket transport.\n&quot;</span>);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a>(serializer);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#af03daa0a59002330aacdfcb44da59db9">ast_websocket_unref</a>(session);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;   transport = create_data.<a class="code" href="../../de/d91/structtransport__create__data.html#a38daabbdc7a8284a525ab4df6541f6fc">transport</a>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;   read_data.<a class="code" href="../../de/d62/structtransport__read__data.html#a38daabbdc7a8284a525ab4df6541f6fc">transport</a> = <a class="code" href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">transport</a>;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a838ccd8bed44b43d4b95025bc3bea4c8">ast_websocket_wait_for_input</a>(session, -1) &gt; 0) {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="keyword">enum</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a> opcode;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordtype">int</span> fragmented;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae16416016e8876c9dc2bd937278dcc4e">ast_websocket_read</a>(session, &amp;read_data.<a class="code" href="../../de/d62/structtransport__read__data.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>, &amp;read_data.<a class="code" href="../../de/d62/structtransport__read__data.html#ae8c81c5ddc738c582eb1ee3962d41394">payload_len</a>, &amp;opcode, &amp;fragmented)) {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">if</span> (opcode == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0">AST_WEBSOCKET_OPCODE_TEXT</a> || opcode == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3c4b23cd6b0016f8683525e726b4a810">AST_WEBSOCKET_OPCODE_BINARY</a>) {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;         <span class="keywordflow">if</span> (read_data.<a class="code" href="../../de/d62/structtransport__read__data.html#ae8c81c5ddc738c582eb1ee3962d41394">payload_len</a>) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <a class="code" href="../../d7/dfa/group__pjsip__threading.html#gac231880459dcf8feacf1bb272b60472a">ast_sip_push_task_wait_serializer</a>(serializer, <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#acd95df9a5374ed8350f7ea624b16f991">transport_read</a>, &amp;read_data);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;         }</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opcode == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a>) {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      }</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;   <a class="code" href="../../d7/dfa/group__pjsip__threading.html#gac231880459dcf8feacf1bb272b60472a">ast_sip_push_task_wait_serializer</a>(serializer, <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac091c7e5f5bce000ae13583024204a9b">transport_shutdown</a>, transport);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a>(serializer);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;   <a class="code" href="../../de/d4c/res__http__websocket_8c.html#af03daa0a59002330aacdfcb44da59db9">ast_websocket_unref</a>(session);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;}</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"> * \brief Store the transport a message came in on, so it can be used for outbound messages to that contact.</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00421"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ad133a50885bd5fef3c26607a08b6e34e">  421</a></span>&#160;<span class="keyword">static</span> pj_bool_t <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ad133a50885bd5fef3c26607a08b6e34e">websocket_on_rx_msg</a>(pjsip_rx_data *<a class="code" href="../../d9/df4/structws__transport.html#af99e1ed6820832031bc71b738d42d483">rdata</a>)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;{</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t STR_WS = { <span class="stringliteral">&quot;ws&quot;</span>, 2 };</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   pjsip_contact_hdr *<a class="code" href="../../d9/d03/structcontact.html">contact</a>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;   <span class="keywordtype">long</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a> = rdata-&gt;tp_info.transport-&gt;key.type;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;   <span class="keywordflow">if</span> (type != (<span class="keywordtype">long</span>) <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#abfe278a1b1c534bd884ea904a4760873">transport_type_wss</a> &amp;&amp; type != (<span class="keywordtype">long</span>) <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a9fd473a87557dd7d972b451a3f9a2fa7">transport_type_wss_ipv6</a>) {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">return</span> PJ_FALSE;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;   }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   contact = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_CONTACT, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <span class="keywordflow">if</span> (contact</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      &amp;&amp; !contact-&gt;star</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      &amp;&amp; (PJSIP_URI_SCHEME_IS_SIP(contact-&gt;uri) || PJSIP_URI_SCHEME_IS_SIPS(contact-&gt;uri))) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      pjsip_sip_uri *uri = pjsip_uri_get_uri(contact-&gt;uri);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keyword">const</span> pj_str_t *txp_str = &amp;STR_WS;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8c/logger_8h.html#a33f6031de4ab6d1406465a7a3ee18e86">DEBUG_ATLEAST</a>(4)) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;         <span class="keywordtype">char</span> src_addr_buffer[<a class="code" href="../../db/df1/netsock2_8h.html#aded4d9ff3f772448b4716fd90ed47c8d">AST_SOCKADDR_BUFLEN</a>];</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *ipv6_s = <span class="stringliteral">&quot;&quot;</span>, *ipv6_e = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;         <span class="keywordflow">if</span> (pj_strchr(&amp;uri-&gt;host, <span class="charliteral">&#39;:&#39;</span>)) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            ipv6_s = <span class="stringliteral">&quot;[&quot;</span>;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            ipv6_e = <span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;         }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;%s re-writing Contact URI from %s%.*s%s:%d%s%.*s to %s;transport=%s\n&quot;</span>,</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            pjsip_rx_data_get_info(rdata),</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            ipv6_s, (<span class="keywordtype">int</span>) pj_strlen(&amp;uri-&gt;host), pj_strbuf(&amp;uri-&gt;host), ipv6_e, uri-&gt;port,</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            pj_strlen(&amp;uri-&gt;transport_param) ? <span class="stringliteral">&quot;;transport=&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            (<span class="keywordtype">int</span>) pj_strlen(&amp;uri-&gt;transport_param), pj_strbuf(&amp;uri-&gt;transport_param),</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            pj_sockaddr_print(&amp;rdata-&gt;pkt_info.src_addr, src_addr_buffer, <span class="keyword">sizeof</span>(src_addr_buffer), 3),</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            pj_strbuf(txp_str));</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      }</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      pj_strdup2(rdata-&gt;tp_info.pool, &amp;uri-&gt;host, rdata-&gt;pkt_info.src_name);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      uri-&gt;port = rdata-&gt;pkt_info.src_port;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      pj_strdup(rdata-&gt;tp_info.pool, &amp;uri-&gt;transport_param, txp_str);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   }</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;   rdata-&gt;msg_info.via-&gt;rport_param = 0;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;   <span class="keywordflow">return</span> PJ_FALSE;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;}</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a59a401897b806c6370638ad43a1942b1">  467</a></span>&#160;<span class="keyword">static</span> pjsip_module <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a59a401897b806c6370638ad43a1942b1">websocket_module</a> = {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;   .name = { <span class="stringliteral">&quot;WebSocket Transport Module&quot;</span>, 26 },</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   .id = -1,</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;   .priority = PJSIP_MOD_PRIORITY_TRANSPORT_LAYER,</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   .on_rx_request = <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ad133a50885bd5fef3c26607a08b6e34e">websocket_on_rx_msg</a>,</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;   .on_rx_response = <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ad133a50885bd5fef3c26607a08b6e34e">websocket_on_rx_msg</a>,</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;};</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">/*! \brief Function called when an INVITE goes out */</span></div><div class="line"><a name="l00476"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a4e56a2f4c5f40a033c0f7d1225f6d4b2">  476</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a4e56a2f4c5f40a033c0f7d1225f6d4b2">websocket_outgoing_invite_request</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, <span class="keyword">struct</span> pjsip_tx_data *tdata)</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;{</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;   <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;state == PJSIP_INV_STATE_NULL) {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      pjsip_dlg_add_usage(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg, &amp;<a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a59a401897b806c6370638ad43a1942b1">websocket_module</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;   }</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;}</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">/*! \brief Supplement for adding Websocket functionality to dialog */</span></div><div class="line"><a name="l00484"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ab746ceb219d71a891383acc1f5901498">  484</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/db8/structast__sip__session__supplement.html">ast_sip_session_supplement</a> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ab746ceb219d71a891383acc1f5901498">websocket_supplement</a> = {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   .<a class="code" href="../../df/db8/structast__sip__session__supplement.html#a8b44a03925325ceaf2de7b079b1541a1">method</a> = <span class="stringliteral">&quot;INVITE&quot;</span>,</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;   .priority = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a6e3c5164d38b50bc0f4f22040dedb2ceace76d1cc82383cae30af1ef879a1d347">AST_SIP_SUPPLEMENT_PRIORITY_FIRST</a> + 1,</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;   .outgoing_request = <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a4e56a2f4c5f40a033c0f7d1225f6d4b2">websocket_outgoing_invite_request</a>,</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;};</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">  490</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;{</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">    * We only need one transport type name (ws) defined.  Firefox</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">    * and Chrome do not support anything other than secure websockets</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">    * anymore.</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">    * Also we really cannot have two transports with the same name</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">    * and address family because it would be ambiguous.  Outgoing</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">    * requests may try to find the transport by name and pjproject</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">    * only finds the first one registered.</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;   pjsip_transport_register_type(PJSIP_TRANSPORT_RELIABLE | PJSIP_TRANSPORT_SECURE, <span class="stringliteral">&quot;ws&quot;</span>, 5060, &amp;<a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#abfe278a1b1c534bd884ea904a4760873">transport_type_wss</a>);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   pjsip_transport_register_type(PJSIP_TRANSPORT_RELIABLE | PJSIP_TRANSPORT_SECURE | PJSIP_TRANSPORT_IPV6, <span class="stringliteral">&quot;ws&quot;</span>, 5060, &amp;<a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a9fd473a87557dd7d972b451a3f9a2fa7">transport_type_wss_ipv6</a>);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a2d923ef44f62dffc05178f762b88f084">ast_sip_register_service</a>(&amp;<a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a59a401897b806c6370638ad43a1942b1">websocket_module</a>) != PJ_SUCCESS) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;   }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;   <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aa21df5d2fdfb2d6e2734a3056ec3db7c">ast_sip_session_register_supplement</a>(&amp;websocket_supplement);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a099ab917f200dce4bcb7d0aadb2fb52a">ast_websocket_add_protocol</a>(<span class="stringliteral">&quot;sip&quot;</span>, <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#abe5fa424121952d3029a10729b996772">websocket_cb</a>)) {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aae89632996ffdcf888ab251c14dc6cdb">ast_sip_session_unregister_supplement</a>(&amp;websocket_supplement);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a15aa09d9084763cdd20b7467a4cd381a">ast_sip_unregister_service</a>(&amp;<a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a59a401897b806c6370638ad43a1942b1">websocket_module</a>);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;   }</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;}</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ad09fa931f468002152a3cc2d5ce25eae">  520</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;{</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a15aa09d9084763cdd20b7467a4cd381a">ast_sip_unregister_service</a>(&amp;<a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a59a401897b806c6370638ad43a1942b1">websocket_module</a>);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;   <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aae89632996ffdcf888ab251c14dc6cdb">ast_sip_session_unregister_supplement</a>(&amp;websocket_supplement);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;   <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae810879a31a3cc6ef5ccd4b922e1e4ab">ast_websocket_remove_protocol</a>(<span class="stringliteral">&quot;sip&quot;</span>, <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#abe5fa424121952d3029a10729b996772">websocket_cb</a>);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;}</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<a class="code" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a>(<a class="code" href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a>, <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a>, <span class="stringliteral">&quot;PJSIP WebSocket Transport Support&quot;</span>,</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;   .support_level = <a class="code" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>,</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;   .load = <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;   .unload = <a class="code" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>,</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   .load_pri = <a class="code" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a08d902290b0d6cbffd8e607d5e399a06">AST_MODPRI_APP_DEPEND</a>,</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;   .requires = <span class="stringliteral">&quot;res_pjsip,res_http_websocket&quot;</span>,</div><div class="line"><a name="l00535"></a><span class="lineno"><a class="line" href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae">  535</a></span>&#160;);</div><div class="ttc" id="netsock2_8h_html_a6bf0e68e74c0a9ca9d25251b22e4d64a"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a></div><div class="ttdeci">static char * ast_sockaddr_stringify_addr(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() to return an address only. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00290">netsock2.h:290</a></div></div>
<div class="ttc" id="structast__sip__transport__state_html_a412bcf75e793ebae3f463f57410a6046"><div class="ttname"><a href="../../db/dac/structast__sip__transport__state.html#a412bcf75e793ebae3f463f57410a6046">ast_sip_transport_state::type</a></div><div class="ttdeci">enum ast_transport type</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00101">res_pjsip.h:101</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ae16416016e8876c9dc2bd937278dcc4e"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ae16416016e8876c9dc2bd937278dcc4e">ast_websocket_read</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_read(struct ast_websocket *session, char **payload, uint64_t *payload_len, enum ast_websocket_opcode *opcode, int *fragmented)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00602">res_http_websocket.c:602</a></div></div>
<div class="ttc" id="netsock2_8h_html_aa2785c5990a086943fea750c980abbc3a611d4a9fc154cea78fe3f7f768185c4d"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aa2785c5990a086943fea750c980abbc3a611d4a9fc154cea78fe3f7f768185c4d">AST_TRANSPORT_WSS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00064">netsock2.h:64</a></div></div>
<div class="ttc" id="structtransport__create__data_html_a38daabbdc7a8284a525ab4df6541f6fc"><div class="ttname"><a href="../../de/d91/structtransport__create__data.html#a38daabbdc7a8284a525ab4df6541f6fc">transport_create_data::transport</a></div><div class="ttdeci">struct ws_transport * transport</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00142">res_pjsip_transport_websocket.c:142</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a4d63fdfe5451ec2248c16a2739190c56"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a></div><div class="ttdeci">static const char type[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00109">chan_ooh323.c:109</a></div></div>
<div class="ttc" id="structast__sip__transport_html_a199f91b67127c0be666a283e3e600c56"><div class="ttname"><a href="../../d1/d04/structast__sip__transport.html#a199f91b67127c0be666a283e3e600c56">ast_sip_transport::write_timeout</a></div><div class="ttdeci">int write_timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00245">res_pjsip.h:245</a></div></div>
<div class="ttc" id="netsock2_8h_html_aded4d9ff3f772448b4716fd90ed47c8d"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aded4d9ff3f772448b4716fd90ed47c8d">AST_SOCKADDR_BUFLEN</a></div><div class="ttdeci">#define AST_SOCKADDR_BUFLEN</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00046">netsock2.h:46</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ab47623e207bf2cdd0edfa613d91894e5"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ab47623e207bf2cdd0edfa613d91894e5">ast_taskprocessor_build_name</a></div><div class="ttdeci">void ast_taskprocessor_build_name(char *buf, unsigned int size, const char *format,...)</div><div class="ttdoc">Build a taskprocessor name with a sequence number on the end. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01295">taskprocessor.c:1295</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00369">astobj2.h:369</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="module_8h_html_ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15"><div class="ttname"><a href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00121">module.h:121</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a6e3c5164d38b50bc0f4f22040dedb2ceace76d1cc82383cae30af1ef879a1d347"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a6e3c5164d38b50bc0f4f22040dedb2ceace76d1cc82383cae30af1ef879a1d347">AST_SIP_SUPPLEMENT_PRIORITY_FIRST</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02871">res_pjsip.h:2871</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a638aea4c786e326ded80afaecb09745c"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a638aea4c786e326ded80afaecb09745c">ast_websocket_is_secure</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_is_secure(struct ast_websocket *session)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00481">res_http_websocket.c:481</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_a6834da3f36d1802a36a8efbf7818e008"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a6834da3f36d1802a36a8efbf7818e008">transport_create</a></div><div class="ttdeci">static int transport_create(void *data)</div><div class="ttdoc">Create a pjsip transport. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00149">res_pjsip_transport_websocket.c:149</a></div></div>
<div class="ttc" id="structast__sip__transport__state_html_aecb3b0d045ada529257a2fbf8f829599"><div class="ttname"><a href="../../db/dac/structast__sip__transport__state.html#aecb3b0d045ada529257a2fbf8f829599">ast_sip_transport_state::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00096">res_pjsip.h:96</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_a4e56a2f4c5f40a033c0f7d1225f6d4b2"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a4e56a2f4c5f40a033c0f7d1225f6d4b2">websocket_outgoing_invite_request</a></div><div class="ttdeci">static void websocket_outgoing_invite_request(struct ast_sip_session *session, struct pjsip_tx_data *tdata)</div><div class="ttdoc">Function called when an INVITE goes out. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00476">res_pjsip_transport_websocket.c:476</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="structast__sip__session__supplement_html_a8b44a03925325ceaf2de7b079b1541a1"><div class="ttname"><a href="../../df/db8/structast__sip__session__supplement.html#a8b44a03925325ceaf2de7b079b1541a1">ast_sip_session_supplement::method</a></div><div class="ttdeci">const char * method</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00290">res_pjsip_session.h:290</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_ac091c7e5f5bce000ae13583024204a9b"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac091c7e5f5bce000ae13583024204a9b">transport_shutdown</a></div><div class="ttdeci">static int transport_shutdown(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00125">res_pjsip_transport_websocket.c:125</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a9e80e75c690108f7466085cf3f956244"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a9e80e75c690108f7466085cf3f956244">ast_websocket_local_address</a></div><div class="ttdeci">struct ast_sockaddr *AST_OPTIONAL_API_NAME() ast_websocket_local_address(struct ast_websocket *session)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00476">res_http_websocket.c:476</a></div></div>
<div class="ttc" id="structast__variable_html"><div class="ttname"><a href="../../dd/d02/structast__variable.html">ast_variable</a></div><div class="ttdoc">Structure for variables, used for configurations and for channel variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00083">include/asterisk/config.h:83</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_ad133a50885bd5fef3c26607a08b6e34e"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ad133a50885bd5fef3c26607a08b6e34e">websocket_on_rx_msg</a></div><div class="ttdeci">static pj_bool_t websocket_on_rx_msg(pjsip_rx_data *rdata)</div><div class="ttdoc">Store the transport a message came in on, so it can be used for outbound messages to that contact...</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00421">res_pjsip_transport_websocket.c:421</a></div></div>
<div class="ttc" id="config__transport_8c_html_afcddeb3e731b920c647149af910906e6"><div class="ttname"><a href="../../d3/d17/config__transport_8c.html#afcddeb3e731b920c647149af910906e6">transport_states</a></div><div class="ttdeci">static struct ao2_container * transport_states</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d17/config__transport_8c_source.html#l00040">config_transport.c:40</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ae4851ff13b6e90c8b88d5717465644ea"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_close(struct ast_websocket *session, uint16_t reason)</div><div class="ttdoc">Close function for websocket session. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00308">res_http_websocket.c:308</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad36841ab6daa3997f7ca7047ad2d033a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a></div><div class="ttdeci">void ao2_iterator_destroy(struct ao2_iterator *iter)</div><div class="ttdoc">Destroy a container iterator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00534">astobj2_container.c:534</a></div></div>
<div class="ttc" id="astobj2_8h_html_a7d8e253a1db2dc47ed4af636c3ea89ce"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a7d8e253a1db2dc47ed4af636c3ea89ce">ao2_t_alloc_options</a></div><div class="ttdeci">#define ao2_t_alloc_options(data_size, destructor_fn, options, debug_msg)</div><div class="ttdoc">Allocate and initialize an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00404">astobj2.h:404</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_aae89632996ffdcf888ab251c14dc6cdb"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aae89632996ffdcf888ab251c14dc6cdb">ast_sip_session_unregister_supplement</a></div><div class="ttdeci">void ast_sip_session_unregister_supplement(struct ast_sip_session_supplement *supplement)</div><div class="ttdoc">Unregister a an supplement to SIP session processing. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dc0/pjsip__session_8c_source.html#l00063">pjsip_session.c:63</a></div></div>
<div class="ttc" id="structtransport__read__data_html_ae8c81c5ddc738c582eb1ee3962d41394"><div class="ttname"><a href="../../de/d62/structtransport__read__data.html#ae8c81c5ddc738c582eb1ee3962d41394">transport_read_data::payload_len</a></div><div class="ttdeci">uint64_t payload_len</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00274">res_pjsip_transport_websocket.c:274</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_adf4c5a237767eb6db5b1db41ccdfc689"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#adf4c5a237767eb6db5b1db41ccdfc689">AST_TASKPROCESSOR_MAX_NAME</a></div><div class="ttdeci">#define AST_TASKPROCESSOR_MAX_NAME</div><div class="ttdoc">Suggested maximum taskprocessor name length (less null terminator). </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d1e/taskprocessor_8h_source.html#l00060">taskprocessor.h:60</a></div></div>
<div class="ttc" id="structast__sip__session_html_ab9fd713b198a122cb52c7f10bd66d1c6"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">ast_sip_session::inv_session</a></div><div class="ttdeci">struct pjsip_inv_session * inv_session</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00187">res_pjsip_session.h:187</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_a59a401897b806c6370638ad43a1942b1"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a59a401897b806c6370638ad43a1942b1">websocket_module</a></div><div class="ttdeci">static pjsip_module websocket_module</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00467">res_pjsip_transport_websocket.c:467</a></div></div>
<div class="ttc" id="logger_8h_html_a6ff63e8955665c4a58b1598f2b07c51a"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a></div><div class="ttdeci">#define LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00241">logger.h:241</a></div></div>
<div class="ttc" id="structast__sip__transport_html_a412bcf75e793ebae3f463f57410a6046"><div class="ttname"><a href="../../d1/d04/structast__sip__transport.html#a412bcf75e793ebae3f463f57410a6046">ast_sip_transport::type</a></div><div class="ttdeci">enum ast_transport type</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00193">res_pjsip.h:193</a></div></div>
<div class="ttc" id="structast__sip__session_html"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html">ast_sip_session</a></div><div class="ttdoc">A structure describing a SIP session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00179">res_pjsip_session.h:179</a></div></div>
<div class="ttc" id="lock_8h_html_a8a3bd496edfec04a95683ace66676200"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a></div><div class="ttdeci">int ast_atomic_fetchadd_int(volatile int *p, int v)</div><div class="ttdoc">Atomically add v to *p and return the previous value of *p. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00755">lock.h:755</a></div></div>
<div class="ttc" id="sorcery_8h_html_a100106a82d72aa59a66513ef3ad161c8"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a></div><div class="ttdeci">void * ast_sorcery_retrieve_by_id(const struct ast_sorcery *sorcery, const char *type, const char *id)</div><div class="ttdoc">Retrieve an object using its unique identifier. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01853">sorcery.c:1853</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a874ca6ebfa7b35e92557cc97af1d41be"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a874ca6ebfa7b35e92557cc97af1d41be">ast_websocket_fd</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_fd(struct ast_websocket *session)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00461">res_http_websocket.c:461</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a099ab917f200dce4bcb7d0aadb2fb52a"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a099ab917f200dce4bcb7d0aadb2fb52a">ast_websocket_add_protocol</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_add_protocol(const char *name, ast_websocket_callback callback)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01052">res_http_websocket.c:1052</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_ac3382bf6da54c56b37069bd76bbdf4f9"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a></div><div class="ttdeci">static int load_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00490">res_pjsip_transport_websocket.c:490</a></div></div>
<div class="ttc" id="netsock2_8h_html_a51e2841175bf3ad58a4e11ad9fb2453f"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a></div><div class="ttdeci">#define ast_sockaddr_port(addr)</div><div class="ttdoc">Get the port number of a socket address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00521">netsock2.h:521</a></div></div>
<div class="ttc" id="structws__transport_html_af99e1ed6820832031bc71b738d42d483"><div class="ttname"><a href="../../d9/df4/structws__transport.html#af99e1ed6820832031bc71b738d42d483">ws_transport::rdata</a></div><div class="ttdeci">pjsip_rx_data rdata</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00054">res_pjsip_transport_websocket.c:54</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00055">http_websocket.h:55</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="structtransport__read__data_html_a18f141cb2726073503afb9f1d6c85efb"><div class="ttname"><a href="../../de/d62/structtransport__read__data.html#a18f141cb2726073503afb9f1d6c85efb">transport_read_data::payload</a></div><div class="ttdeci">char * payload</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00273">res_pjsip_transport_websocket.c:273</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="utils_8h_html_afa99ec4acc4ecb2dc3c2d05da15d0e3f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a></div><div class="ttdeci">#define MAX(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00228">utils.h:228</a></div></div>
<div class="ttc" id="structast__sip__transport__state_html"><div class="ttname"><a href="../../db/dac/structast__sip__transport__state.html">ast_sip_transport_state</a></div><div class="ttdoc">Structure for SIP transport information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00087">res_pjsip.h:87</a></div></div>
<div class="ttc" id="structws__transport_html_a6bd411e7cd50a1b14b7c35358d5447eb"><div class="ttname"><a href="../../d9/df4/structws__transport.html#a6bd411e7cd50a1b14b7c35358d5447eb">ws_transport::transport</a></div><div class="ttdeci">pjsip_transport transport</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00053">res_pjsip_transport_websocket.c:53</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00317">module.h:317</a></div></div>
<div class="ttc" id="structtransport__read__data_html"><div class="ttname"><a href="../../de/d62/structtransport__read__data.html">transport_read_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00271">res_pjsip_transport_websocket.c:271</a></div></div>
<div class="ttc" id="astman_8c_html_ac4a6ae0400e4457f0b35beddec80c93d"><div class="ttname"><a href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a></div><div class="ttdeci">static struct ast_mansession session</div></div>
<div class="ttc" id="group__pjsip__threading_html_gac231880459dcf8feacf1bb272b60472a"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#gac231880459dcf8feacf1bb272b60472a">ast_sip_push_task_wait_serializer</a></div><div class="ttdeci">int ast_sip_push_task_wait_serializer(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Push a task to the serializer and wait for it to complete. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05218">res_pjsip.c:5218</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a050ca80ad7ca07b7643d5ffab2474473"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a050ca80ad7ca07b7643d5ffab2474473">ast_websocket_ref</a></div><div class="ttdeci">void AST_OPTIONAL_API_NAME() ast_websocket_ref(struct ast_websocket *session)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00451">res_http_websocket.c:451</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_a36e1dc178732a0de5bf2343313832662"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a36e1dc178732a0de5bf2343313832662">get_write_timeout</a></div><div class="ttdeci">static int get_write_timeout(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00311">res_pjsip_transport_websocket.c:311</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_aa854546175b8c60844ecdf14c33b6e97"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#aa854546175b8c60844ecdf14c33b6e97">ast_websocket_remote_address</a></div><div class="ttdeci">struct ast_sockaddr *AST_OPTIONAL_API_NAME() ast_websocket_remote_address(struct ast_websocket *session)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00471">res_http_websocket.c:471</a></div></div>
<div class="ttc" id="structtransport__read__data_html_a38daabbdc7a8284a525ab4df6541f6fc"><div class="ttname"><a href="../../de/d62/structtransport__read__data.html#a38daabbdc7a8284a525ab4df6541f6fc">transport_read_data::transport</a></div><div class="ttdeci">struct ws_transport * transport</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00272">res_pjsip_transport_websocket.c:272</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_a572c79c244e74ab8d782532614b32937"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a572c79c244e74ab8d782532614b32937">ws_send_msg</a></div><div class="ttdeci">static pj_status_t ws_send_msg(pjsip_transport *transport, pjsip_tx_data *tdata, const pj_sockaddr_t *rem_addr, int addr_len, void *token, pjsip_transport_callback callback)</div><div class="ttdoc">Send a message over the WebSocket connection. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00063">res_pjsip_transport_websocket.c:63</a></div></div>
<div class="ttc" id="http__websocket_8h_html"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html">http_websocket.h</a></div><div class="ttdoc">Support for WebSocket connections within the Asterisk HTTP server and client WebSocket connections to...</div></div>
<div class="ttc" id="res__http__websocket_8c_html_ae810879a31a3cc6ef5ccd4b922e1e4ab"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ae810879a31a3cc6ef5ccd4b922e1e4ab">ast_websocket_remove_protocol</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_remove_protocol(const char *name, ast_websocket_callback callback)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01081">res_http_websocket.c:1081</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a2d923ef44f62dffc05178f762b88f084"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a2d923ef44f62dffc05178f762b88f084">ast_sip_register_service</a></div><div class="ttdeci">int ast_sip_register_service(pjsip_module *module)</div><div class="ttdoc">Register a SIP service in Asterisk. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03315">res_pjsip.c:3315</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a7739cc1c2dda386e264c2e90855d4e3e"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a7739cc1c2dda386e264c2e90855d4e3e">ast_sip_get_transport_states</a></div><div class="ttdeci">struct ao2_container * ast_sip_get_transport_states(void)</div><div class="ttdoc">Retrieves all transport states. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d17/config__transport_8c_source.html#l01604">config_transport.c:1604</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a88147fdf589f09cb59e2687fbf74f835"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a88147fdf589f09cb59e2687fbf74f835">AST_DEFAULT_WEBSOCKET_WRITE_TIMEOUT</a></div><div class="ttdeci">#define AST_DEFAULT_WEBSOCKET_WRITE_TIMEOUT</div><div class="ttdoc">Default websocket write timeout, in ms. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00028">http_websocket.h:28</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_ab746ceb219d71a891383acc1f5901498"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ab746ceb219d71a891383acc1f5901498">websocket_supplement</a></div><div class="ttdeci">static struct ast_sip_session_supplement websocket_supplement</div><div class="ttdoc">Supplement for adding Websocket functionality to dialog. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00484">res_pjsip_transport_websocket.c:484</a></div></div>
<div class="ttc" id="structast__sip__transport_html"><div class="ttname"><a href="../../d1/d04/structast__sip__transport.html">ast_sip_transport</a></div><div class="ttdoc">Transport to bind to. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00171">res_pjsip.h:171</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0">AST_WEBSOCKET_OPCODE_TEXT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00051">http_websocket.h:51</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="structtransport__create__data_html"><div class="ttname"><a href="../../de/d91/structtransport__create__data.html">transport_create_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00141">res_pjsip_transport_websocket.c:141</a></div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_gad57aa0b914fbd6adbf8ee2fe176e1fb1"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#gad57aa0b914fbd6adbf8ee2fe176e1fb1">ast_sip_create_serializer</a></div><div class="ttdeci">struct ast_taskprocessor * ast_sip_create_serializer(const char *name)</div><div class="ttdoc">Create a new serializer for SIP tasks. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05133">res_pjsip.c:5133</a></div></div>
<div class="ttc" id="astobj2_8h_html_a17990ea630db7dbd1252ef0132133a2b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a></div><div class="ttdeci">#define ao2_iterator_next(iter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01933">astobj2.h:1933</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_adc1ab49fc86302e5de5b0c25308ad2da"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#adc1ab49fc86302e5de5b0c25308ad2da">ast_websocket_set_timeout</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_set_timeout(struct ast_websocket *session, int timeout)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00493">res_http_websocket.c:493</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a1a6e44db94d8b4e8c06bf456bb0174ad"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a1a6e44db94d8b4e8c06bf456bb0174ad">ast_websocket_write</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_write(struct ast_websocket *session, enum ast_websocket_opcode opcode, char *payload, uint64_t payload_size)</div><div class="ttdoc">Write function for websocket traffic. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00374">res_http_websocket.c:374</a></div></div>
<div class="ttc" id="structast__websocket_html"><div class="ttname"><a href="../../db/db6/structast__websocket.html">ast_websocket</a></div><div class="ttdoc">Structure definition for session. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00088">res_http_websocket.c:88</a></div></div>
<div class="ttc" id="structserializer_html"><div class="ttname"><a href="../../d9/d47/structserializer.html">serializer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01315">threadpool.c:1315</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_abfe278a1b1c534bd884ea904a4760873"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#abfe278a1b1c534bd884ea904a4760873">transport_type_wss</a></div><div class="ttdeci">static int transport_type_wss</div><div class="ttdoc">WebSocket transport module. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00041">res_pjsip_transport_websocket.c:41</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="taskprocessor_8h_html"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html">taskprocessor.h</a></div><div class="ttdoc">An API for managing task processing threads that can be shared across modules. </div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_ac68f1faebab308de8bef88e6dd87c611"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ac68f1faebab308de8bef88e6dd87c611">ws_destroy</a></div><div class="ttdeci">static pj_status_t ws_destroy(pjsip_transport *transport)</div><div class="ttdoc">Destroy the pjsip transport. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00085">res_pjsip_transport_websocket.c:85</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_a3995e8771694f508927701051550b84f"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a3995e8771694f508927701051550b84f">ws_obj_name_serial</a></div><div class="ttdeci">static int ws_obj_name_serial</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00047">res_pjsip_transport_websocket.c:47</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_acd95df9a5374ed8350f7ea624b16f991"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#acd95df9a5374ed8350f7ea624b16f991">transport_read</a></div><div class="ttdeci">static int transport_read(void *data)</div><div class="ttdoc">Pass WebSocket data into pjsip transport manager. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00280">res_pjsip_transport_websocket.c:280</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bca3c4b23cd6b0016f8683525e726b4a810"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3c4b23cd6b0016f8683525e726b4a810">AST_WEBSOCKET_OPCODE_BINARY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00052">http_websocket.h:52</a></div></div>
<div class="ttc" id="res__phoneprov_8c_html_addaa208b0ed785225e24490fb9f28a80"><div class="ttname"><a href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a></div><div class="ttdeci">AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_GLOBAL_SYMBOLS|AST_MODFLAG_LOAD_ORDER, &quot;HTTP Phone Provisioning&quot;,.support_level=AST_MODULE_SUPPORT_EXTENDED,.load=load_module,.unload=unload_module,.reload=reload,.load_pri=AST_MODPRI_CHANNEL_DEPEND,.requires=&quot;http&quot;,)</div></div>
<div class="ttc" id="structws__transport_html_ac342f8822c2fee73e38fa6785b03997e"><div class="ttname"><a href="../../d9/df4/structws__transport.html#ac342f8822c2fee73e38fa6785b03997e">ws_transport::ws_session</a></div><div class="ttdeci">struct ast_websocket * ws_session</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00055">res_pjsip_transport_websocket.c:55</a></div></div>
<div class="ttc" id="structast__sip__session__supplement_html"><div class="ttname"><a href="../../df/db8/structast__sip__session__supplement.html">ast_sip_session_supplement</a></div><div class="ttdoc">A supplement to SIP message processing. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00286">res_pjsip_session.h:286</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a785afb501e315c8a97ad476fb6a8be1d"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a></div><div class="ttdeci">pjsip_endpoint * ast_sip_get_pjsip_endpoint(void)</div><div class="ttdoc">Get a pointer to the PJSIP endpoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03718">res_pjsip.c:3718</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a838ccd8bed44b43d4b95025bc3bea4c8"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a838ccd8bed44b43d4b95025bc3bea4c8">ast_websocket_wait_for_input</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_wait_for_input(struct ast_websocket *session, int timeout)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00466">res_http_websocket.c:466</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_a303e8e7473dacff22f987d57fbc060b7"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a303e8e7473dacff22f987d57fbc060b7">transport_dtor</a></div><div class="ttdeci">static void transport_dtor(void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00100">res_pjsip_transport_websocket.c:100</a></div></div>
<div class="ttc" id="structast__taskprocessor_html"><div class="ttname"><a href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a></div><div class="ttdoc">A ast_taskprocessor structure is a singleton by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00069">taskprocessor.c:69</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a5572d52daf1a841b0f9308df901448c8"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a></div><div class="ttdeci">struct ast_sorcery * ast_sip_get_sorcery(void)</div><div class="ttdoc">Get a pointer to the SIP sorcery structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/pjsip__configuration_8c_source.html#l02404">pjsip_configuration.c:2404</a></div></div>
<div class="ttc" id="structao2__iterator_html"><div class="ttname"><a href="../../d9/d97/structao2__iterator.html">ao2_iterator</a></div><div class="ttdoc">When we need to walk through a container, we use an ao2_iterator to keep track of the current positio...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01841">astobj2.h:1841</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_a9fd473a87557dd7d972b451a3f9a2fa7"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a9fd473a87557dd7d972b451a3f9a2fa7">transport_type_wss_ipv6</a></div><div class="ttdeci">static int transport_type_wss_ipv6</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00042">res_pjsip_transport_websocket.c:42</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a32492eb2480cb8c46ad669622cff8556"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a></div><div class="ttdeci">void * ast_taskprocessor_unreference(struct ast_taskprocessor *tps)</div><div class="ttdoc">Unreference the specified taskprocessor and its reference count will decrement. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01109">taskprocessor.c:1109</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a15aa09d9084763cdd20b7467a4cd381a"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a15aa09d9084763cdd20b7467a4cd381a">ast_sip_unregister_service</a></div><div class="ttdeci">void ast_sip_unregister_service(pjsip_module *module)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03331">res_pjsip.c:3331</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_ad09fa931f468002152a3cc2d5ce25eae"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a></div><div class="ttdeci">static int unload_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00520">res_pjsip_transport_websocket.c:520</a></div></div>
<div class="ttc" id="structcontact_html"><div class="ttname"><a href="../../d9/d03/structcontact.html">contact</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8f/reqresp__parser_8h_source.html#l00035">reqresp_parser.h:35</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ab549e9a066a7c7738330e31b0b083177"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ab549e9a066a7c7738330e31b0b083177">ast_websocket_set_nonblock</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_set_nonblock(struct ast_websocket *session)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00486">res_http_websocket.c:486</a></div></div>
<div class="ttc" id="module_8h_html_aa4f734041ffd9d75b07cefb0291e1e58a08d902290b0d6cbffd8e607d5e399a06"><div class="ttname"><a href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a08d902290b0d6cbffd8e607d5e399a06">AST_MODPRI_APP_DEPEND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00328">module.h:328</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_af03daa0a59002330aacdfcb44da59db9"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#af03daa0a59002330aacdfcb44da59db9">ast_websocket_unref</a></div><div class="ttdeci">void AST_OPTIONAL_API_NAME() ast_websocket_unref(struct ast_websocket *session)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00456">res_http_websocket.c:456</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_abe5fa424121952d3029a10729b996772"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#abe5fa424121952d3029a10729b996772">websocket_cb</a></div><div class="ttdeci">static void websocket_cb(struct ast_websocket *session, struct ast_variable *parameters, struct ast_variable *headers)</div><div class="ttdoc">WebSocket connection handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00360">res_pjsip_transport_websocket.c:360</a></div></div>
<div class="ttc" id="module_8h_html_aba2c8d4be709a254658b21a834f8294a"><div class="ttname"><a href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a></div><div class="ttdeci">#define ASTERISK_GPL_KEY</div><div class="ttdoc">The text the key() function should return. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00046">module.h:46</a></div></div>
<div class="ttc" id="logger_8h_html_a33f6031de4ab6d1406465a7a3ee18e86"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a33f6031de4ab6d1406465a7a3ee18e86">DEBUG_ATLEAST</a></div><div class="ttdeci">#define DEBUG_ATLEAST(level)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00441">logger.h:441</a></div></div>
<div class="ttc" id="module_8h_html"><div class="ttname"><a href="../../d5/d16/module_8h.html">module.h</a></div><div class="ttdoc">Asterisk module definitions. </div></div>
<div class="ttc" id="res__pjsip_8h_html"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html">res_pjsip.h</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bc"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a></div><div class="ttdeci">ast_websocket_opcode</div><div class="ttdoc">WebSocket operation codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00050">http_websocket.h:50</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html">res_pjsip_session.h</a></div></div>
<div class="ttc" id="astobj2_8h_html_a91d5d37d00874ae7a92d1a15c0a3b3a6"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a></div><div class="ttdeci">struct ao2_iterator ao2_iterator_init(struct ao2_container *c, int flags) attribute_warn_unused_result</div><div class="ttdoc">Create an iterator for a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00485">astobj2_container.c:485</a></div></div>
<div class="ttc" id="app__jack_8c_html_ac191e5810fa65e63095409471eb5648f"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a></div><div class="ttdeci">jack_status_t status</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00146">app_jack.c:146</a></div></div>
<div class="ttc" id="structtransport__create__data_html_ac342f8822c2fee73e38fa6785b03997e"><div class="ttname"><a href="../../de/d91/structtransport__create__data.html#ac342f8822c2fee73e38fa6785b03997e">transport_create_data::ws_session</a></div><div class="ttdeci">struct ast_websocket * ws_session</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00143">res_pjsip_transport_websocket.c:143</a></div></div>
<div class="ttc" id="netsock2_8h_html_aa2785c5990a086943fea750c980abbc3a6d8ef74bba673bd5a95d9b2da8116b4f"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aa2785c5990a086943fea750c980abbc3a6d8ef74bba673bd5a95d9b2da8116b4f">AST_TRANSPORT_WS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00063">netsock2.h:63</a></div></div>
<div class="ttc" id="structws__transport_html"><div class="ttname"><a href="../../d9/df4/structws__transport.html">ws_transport</a></div><div class="ttdoc">Wrapper for pjsip_transport, for storing the WebSocket session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00052">res_pjsip_transport_websocket.c:52</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_aa21df5d2fdfb2d6e2734a3056ec3db7c"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aa21df5d2fdfb2d6e2734a3056ec3db7c">ast_sip_session_register_supplement</a></div><div class="ttdeci">#define ast_sip_session_register_supplement(supplement)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00616">res_pjsip_session.h:616</a></div></div>
<div class="ttc" id="res__pjsip__transport__websocket_8c_html_a0eb7d60c4ca7a7540b5581367df30ba4"><div class="ttname"><a href="../../d2/db8/res__pjsip__transport__websocket_8c.html#a0eb7d60c4ca7a7540b5581367df30ba4">create_websocket_serializer</a></div><div class="ttdeci">static struct ast_taskprocessor * create_websocket_serializer(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00349">res_pjsip_transport_websocket.c:349</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:07 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
