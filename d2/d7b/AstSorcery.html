<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: Data Access Layer API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Data Access Layer API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Sorcery is a unifying data access layer which utilizes the configuration framework, realtime, and astdb to allow object creation, retrieval, updating, and deletion.</p>
<dl class="section user"><dt>Initialization</dt><dd></dd></dl>
<p>Usage of sorcery is accomplished by first opening a sorcery structure. This structure holds all information about the object types, object fields, and object mappings. All API functions require the sorcery structure to operate. When sorcery is no longer needed the structure can be unreferenced using <a class="el" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a></p>
<p>Once opened the sorcery structure must have object mappings applied to it. This maps the object types to their respective wizards (object storage modules). If the developer would like to allow the user to configure this using the sorcery.conf configuration file the <a class="el" href="../../d8/d25/sorcery_8h.html#a9db9fd1cf5ec967af2ad3a63c27e0233">ast_sorcery_apply_config</a> API call can be used to read in the configuration file and apply the mappings. <a class="el" href="../../d8/d25/sorcery_8h.html#ad60f3b81bed748245f8045cb48fadee2">ast_sorcery_open</a> will automatically call <a class="el" href="../../d8/d25/sorcery_8h.html#a9db9fd1cf5ec967af2ad3a63c27e0233">ast_sorcery_apply_config</a> to allow for configuration of objects using the same category name as the module that is opening the sorcery instance. Direct calls to <a class="el" href="../../d8/d25/sorcery_8h.html#a9db9fd1cf5ec967af2ad3a63c27e0233">ast_sorcery_apply_config</a> should only be performed if a module wishes to allow for additional configuration sections in sorcery.conf to be used. If the storage of the object types are such that a default wizard can be used this can be applied using the <a class="el" href="../../d8/d25/sorcery_8h.html#ad1165cf9d45ed5ffa1555371be9ae770">ast_sorcery_apply_default</a> API call. Note that the default mappings will not override configured mappings. They are only used in the case where no configured mapping exists.</p>
<p>Configuring object mappings implicitly creates a basic version of an object type. The object type must be fully registered, however, using the <a class="el" href="../../d8/d25/sorcery_8h.html#a5ee86f00f6e2240f74772d59edf0f74a">ast_sorcery_object_register</a> API call before any objects of the type can be allocated, created, or retrieved.</p>
<p>Once the object type itself has been fully registered the individual fields within the object must be registered using the <a class="el" href="../../d8/d25/sorcery_8h.html#aa7102b6e71e4fa6525b24a6123a2f6d4">ast_sorcery_object_field_register</a> API call. Note that not all fields <em>need</em> be registered. Only fields that should be accessible using the sorcery API have to be registered.</p>
<dl class="section user"><dt>Creating Objects</dt><dd></dd></dl>
<p>Before an object can be created within the sorcery API it must first be allocated using the <a class="el" href="../../d7/d69/sorcery_8c.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a> API call. This allocates a new instance of the object, sets sorcery specific details, and applies default values to the object. A unique identifier can optionally be specified when allocating an object. If it is not provided one will be automatically generated. Allocating an object does not create it within any object storage mechanisms that are configured for the object type. Creation must explicitly be done using the <a class="el" href="../../d7/d69/sorcery_8c.html#a575dfe8fd872c033d2b902549df502ea">ast_sorcery_create</a> API call. This API call passes the object to each configured object storage mechanism for the object type until one successfully persists the object.</p>
<dl class="section user"><dt>Retrieving Objects</dt><dd></dd></dl>
<p>To retrieve a single object using its unique identifier the <a class="el" href="../../d7/d69/sorcery_8c.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a> API call can be used.</p>
<p>To retrieve potentially multiple objects using specific fields the <a class="el" href="../../d7/d69/sorcery_8c.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a> API call can be used. The behavior of this API call is controlled using different flags. If the AST_RETRIEVE_FLAG_MULTIPLE flag is used a container will be returned which contains all matching objects. To retrieve all objects the AST_RETRIEVE_FLAG_ALL flag can be specified. Note that when specifying this flag you do not need to pass any fields.</p>
<p>Both API calls return shared objects. Modification of the object can not occur until it has been copied.</p>
<dl class="section user"><dt>Updating Objects</dt><dd></dd></dl>
<p>As retrieved objects may be shared the first step to updating the object with new details is creating a copy using the <a class="el" href="../../d7/d69/sorcery_8c.html#acb3b46997c4a11e6da3ac21e7a38d96c">ast_sorcery_copy</a> API call. This will return a new object which is specific to the caller. Any field within the object may be modified as needed. Once changes are done the changes can be committed using the <a class="el" href="../../d7/d69/sorcery_8c.html#ab9184a8cdeb14537309e5e020948ecd3">ast_sorcery_update</a> API call. Note that as the copied object is specific to the caller it must be unreferenced after use.</p>
<dl class="section user"><dt>Deleting Objects</dt><dd></dd></dl>
<p>To delete an object simply call the <a class="el" href="../../d7/d69/sorcery_8c.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a> API call with an object retrieved using the ast_sorcery_retrieve_by_* API calls or a copy returned from <a class="el" href="../../d7/d69/sorcery_8c.html#acb3b46997c4a11e6da3ac21e7a38d96c">ast_sorcery_copy</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:47:15 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
