<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: pickup.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">pickup.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Routines implementing call pickup.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dd/dbc/pickup_8h_source.html">asterisk/pickup.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d7b/channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/de0/pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html">asterisk/app.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../de/d47/callerid_8h_source.html">asterisk/callerid.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d4/da3/causes_8h_source.html">asterisk/causes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dd/d79/stasis_8h_source.html">asterisk/stasis.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d9/d4a/stasis__channels_8h_source.html">asterisk/stasis_channels.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/daa/include_2asterisk_2features__config_8h_source.html">asterisk/features_config.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for pickup.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../dc/d9c/pickup_8c__incl.png" border="0" usemap="#pickup_8c" alt=""/></div>
<map name="pickup_8c" id="pickup_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="373,453,457,480"/>
<area shape="rect" id="node12" href="../../dd/dbc/pickup_8h.html" title="Call Pickup API. " alt="" coords="1279,80,1409,107"/>
<area shape="rect" id="node13" href="../../d5/d7b/channel_8h.html" title="General Asterisk PBX channel definitions. " alt="" coords="1387,155,1525,181"/>
<area shape="rect" id="node35" href="../../dd/d79/stasis_8h.html" title="Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. " alt="" coords="2100,229,2225,256"/>
<area shape="rect" id="node41" href="../../db/de0/pbx_8h.html" title="Core PBX routines and definitions. " alt="" coords="1535,80,1646,107"/>
<area shape="rect" id="node45" href="../../d3/d93/include_2asterisk_2app_8h.html" title="Application convenience functions, designed to give consistent look and feel to Asterisk apps..." alt="" coords="2632,155,2744,181"/>
<area shape="rect" id="node47" href="../../de/d47/callerid_8h.html" title="CallerID (and other GR30) management and generation Includes code and algorithms from the Zapata libr..." alt="" coords="43,155,176,181"/>
<area shape="rect" id="node48" href="../../d4/da3/causes_8h.html" title="Internal Asterisk hangup causes. " alt="" coords="2332,80,2465,107"/>
<area shape="rect" id="node49" href="../../d9/d4a/stasis__channels_8h.html" title="asterisk/stasis_channels.h" alt="" coords="2119,80,2308,107"/>
<area shape="rect" id="node50" href="../../d0/daa/include_2asterisk_2features__config_8h.html" title="asterisk/features_config.h" alt="" coords="2791,80,2977,107"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="215,528,369,555"/>
<area shape="rect" id="node5" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="442,603,579,629"/>
<area shape="rect" id="node11" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="445,528,579,555"/>
<area shape="rect" id="node4" href="../../dc/dba/buildopts_8h.html" title="asterisk/buildopts.h" alt="" coords="219,603,365,629"/>
<area shape="rect" id="node6" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="829,752,971,779"/>
<area shape="rect" id="node14" href="../../dc/d4d/alertpipe_8h.html" title="asterisk/alertpipe.h" alt="" coords="1492,304,1636,331"/>
<area shape="rect" id="node15" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="1753,379,1868,405"/>
<area shape="rect" id="node16" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="1271,677,1385,704"/>
<area shape="rect" id="node17" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="2559,453,2716,480"/>
<area shape="rect" id="node20" href="../../d5/da5/astobj2_8h.html" title="asterisk/astobj2.h" alt="" coords="1442,528,1577,555"/>
<area shape="rect" id="node21" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="1253,603,1403,629"/>
<area shape="rect" id="node22" href="../../dc/d14/abstract__jb_8h.html" title="Common implementation&#45;independent jitterbuffer stuff. " alt="" coords="251,304,410,331"/>
<area shape="rect" id="node24" href="../../d4/dfb/poll-compat_8h.html" title="asterisk/poll&#45;compat.h" alt="" coords="886,229,1050,256"/>
<area shape="rect" id="node25" href="../../d6/d66/include_2asterisk_2frame_8h.html" title="Asterisk internal frame definitions. " alt="" coords="537,304,663,331"/>
<area shape="rect" id="node26" href="../../d9/de7/chanvars_8h.html" title="Channel Variables. " alt="" coords="1544,229,1691,256"/>
<area shape="rect" id="node27" href="../../d3/de6/include_2asterisk_2config_8h.html" title="Configuration File Parser. " alt="" coords="1661,304,1787,331"/>
<area shape="rect" id="node28" href="../../dc/d07/cdr_8h.html" title="Call Detail Record API. " alt="" coords="1075,229,1181,256"/>
<area shape="rect" id="node29" href="../../d9/db6/datastore_8h.html" title="Asterisk datastore objects. " alt="" coords="1391,379,1542,405"/>
<area shape="rect" id="node30" href="../../d0/d3c/format__cap_8h.html" title="Format Capabilities API. " alt="" coords="1206,229,1367,256"/>
<area shape="rect" id="node31" href="../../d9/d95/channelstate_8h.html" title="Channel states. " alt="" coords="363,379,533,405"/>
<area shape="rect" id="node32" href="../../de/dc8/ccss_8h.html" title="Call Completion Supplementary Services API. " alt="" coords="694,229,810,256"/>
<area shape="rect" id="node34" href="../../db/d3c/framehook_8h.html" title="FrameHook Architecture. " alt="" coords="512,229,669,256"/>
<area shape="rect" id="node40" href="../../d4/d61/endpoints_8h.html" title="Endpoint abstractions. " alt="" coords="1867,229,2018,256"/>
<area shape="rect" id="node18" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="1745,453,1876,480"/>
<area shape="rect" id="node19" href="../../dc/d7d/threadstorage_8h.html" title="Definitions to aid in the use of thread local storage. " alt="" coords="1601,528,1780,555"/>
<area shape="rect" id="node23" href="../../d0/d0a/format_8h.html" title="Media Format API. " alt="" coords="204,379,335,405"/>
<area shape="rect" id="node33" href="../../da/da2/devicestate_8h.html" title="Device state management. " alt="" coords="959,304,1121,331"/>
<area shape="rect" id="node36" href="../../d4/d05/json_8h.html" title="Asterisk JSON abstraction layer. " alt="" coords="1863,304,1977,331"/>
<area shape="rect" id="node37" href="../../db/d45/manager_8h.html" title="The AMI &#45; Asterisk Manager Interface &#45; is a TCP protocol created to manage Asterisk with third&#45;party ..." alt="" coords="2251,304,2397,331"/>
<area shape="rect" id="node39" href="../../dd/d20/event_8h.html" title="asterisk/event.h" alt="" coords="2103,304,2227,331"/>
<area shape="rect" id="node38" href="../../d1/d99/xmldoc_8h.html" title="Asterisk XML Documentation API. " alt="" coords="2105,379,2239,405"/>
<area shape="rect" id="node42" href="../../d7/d00/sched_8h.html" title="Scheduler Routines (derived from cheops) " alt="" coords="1629,155,1755,181"/>
<area shape="rect" id="node43" href="../../d6/dd7/presencestate_8h.html" title="Presence state management. " alt="" coords="251,155,431,181"/>
<area shape="rect" id="node44" href="../../d6/da0/hashtab_8h.html" title="Generic (perhaps overly so) hashtable implementation Hash Table support in Asterisk. " alt="" coords="490,453,630,480"/>
<area shape="rect" id="node46" href="../../d2/d4d/file_8h.html" title="Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include mod_format.h. " alt="" coords="2725,229,2832,256"/>
</map>
</div>
</div>
<p><a href="../../d9/dbf/pickup_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab8425437dfb158abc67493460a0f6944"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/dbf/pickup_8c.html#ab8425437dfb158abc67493460a0f6944">ast_can_pickup</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan)</td></tr>
<tr class="memdesc:ab8425437dfb158abc67493460a0f6944"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test if a channel can be picked up.  <a href="#ab8425437dfb158abc67493460a0f6944">More...</a><br /></td></tr>
<tr class="separator:ab8425437dfb158abc67493460a0f6944"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb429cfe4b537c01e51ecb82b49c31ea"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/dbf/pickup_8c.html#abb429cfe4b537c01e51ecb82b49c31ea">ast_do_pickup</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *target)</td></tr>
<tr class="memdesc:abb429cfe4b537c01e51ecb82b49c31ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pickup a call target.  <a href="#abb429cfe4b537c01e51ecb82b49c31ea">More...</a><br /></td></tr>
<tr class="separator:abb429cfe4b537c01e51ecb82b49c31ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4890be42c2add5f52028705d6bc02201"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/dbf/pickup_8c.html#a4890be42c2add5f52028705d6bc02201">ast_pickup_call</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan)</td></tr>
<tr class="memdesc:a4890be42c2add5f52028705d6bc02201"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pickup a call.  <a href="#a4890be42c2add5f52028705d6bc02201">More...</a><br /></td></tr>
<tr class="separator:a4890be42c2add5f52028705d6bc02201"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc7090d6928faf9cc0dc9c1436f50c82"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/dbf/pickup_8c.html#afc7090d6928faf9cc0dc9c1436f50c82">ast_pickup_find_by_group</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan)</td></tr>
<tr class="memdesc:afc7090d6928faf9cc0dc9c1436f50c82"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find a pickup channel target by group.  <a href="#afc7090d6928faf9cc0dc9c1436f50c82">More...</a><br /></td></tr>
<tr class="separator:afc7090d6928faf9cc0dc9c1436f50c82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9910076549cb71ff910510eb9e6d5f87"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/dbf/pickup_8c.html#a9910076549cb71ff910510eb9e6d5f87">ast_pickup_init</a> (void)</td></tr>
<tr class="memdesc:a9910076549cb71ff910510eb9e6d5f87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize pickup.  <a href="#a9910076549cb71ff910510eb9e6d5f87">More...</a><br /></td></tr>
<tr class="separator:a9910076549cb71ff910510eb9e6d5f87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adff86eccdca70e67e66468e6682074ce"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d96/structast__manager__event__blob.html">ast_manager_event_blob</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/dbf/pickup_8c.html#adff86eccdca70e67e66468e6682074ce">call_pickup_to_ami</a> (struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *<a class="el" href="../../d8/d9e/structmessage.html">message</a>)</td></tr>
<tr class="separator:adff86eccdca70e67e66468e6682074ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2473db24e4139565312fa90497c8ad79"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/dbf/pickup_8c.html#a2473db24e4139565312fa90497c8ad79">find_channel_by_group</a> (void *obj, void *arg, void *data, int flags)</td></tr>
<tr class="separator:a2473db24e4139565312fa90497c8ad79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5aca635640dafce83abcf0c5edc697e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/dbf/pickup_8c.html#aa5aca635640dafce83abcf0c5edc697e">pickup_shutdown</a> (void)</td></tr>
<tr class="separator:aa5aca635640dafce83abcf0c5edc697e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4727061b89ae2fac9cf4ed6709005b7"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/dbf/pickup_8c.html#ad4727061b89ae2fac9cf4ed6709005b7">send_call_pickup_stasis_message</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *picking_up, struct <a class="el" href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a> *chan, struct <a class="el" href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a> *target)</td></tr>
<tr class="separator:ad4727061b89ae2fac9cf4ed6709005b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a028c751c5889944f975f70233159a4e4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/dbf/pickup_8c.html#a028c751c5889944f975f70233159a4e4">STASIS_MESSAGE_TYPE_DEFN</a> (<a class="el" href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type</a>,.<a class="el" href="../../d2/d3d/res__pjsip__exten__state_8c.html#ae8731a90be4dc2d8272b7dfd8a001d4c">to_ami</a>=<a class="el" href="../../d9/dbf/pickup_8c.html#adff86eccdca70e67e66468e6682074ce">call_pickup_to_ami</a>)</td></tr>
<tr class="separator:a028c751c5889944f975f70233159a4e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a42d2cca4342fa5ac6f73880b9d33528b"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/dbf/pickup_8c.html#a42d2cca4342fa5ac6f73880b9d33528b">pickup_active</a></td></tr>
<tr class="separator:a42d2cca4342fa5ac6f73880b9d33528b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Routines implementing call pickup. </p>
<dl class="section author"><dt>Author</dt><dd>Matt Jordan <a href="#" onclick="location.href='mai'+'lto:'+'mjo'+'rd'+'an@'+'di'+'giu'+'m.'+'com'; return false;">mjord<span style="display: none;">.nosp@m.</span>an@d<span style="display: none;">.nosp@m.</span>igium<span style="display: none;">.nosp@m.</span>.com</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="../../d9/dbf/pickup_8c_source.html">pickup.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ab8425437dfb158abc67493460a0f6944"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8425437dfb158abc67493460a0f6944">&#9670;&nbsp;</a></span>ast_can_pickup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_can_pickup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Test if a channel can be picked up. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chan</td><td>Channel to test if can be picked up.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function assumes that chan is locked.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE if channel can be picked up. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00077">77</a> of file <a class="el" href="../../d9/dbf/pickup_8c_source.html">pickup.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/d28/channel_8c_source.html#l02404">ast_channel_datastore_find()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l01260">ast_channel_flags()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00597">ast_channel_masq()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00721">ast_channel_pbx()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l00988">AST_FLAG_ZOMBIE</a>, <a class="el" href="../../d9/d95/channelstate_8h_source.html#l00036">AST_STATE_DOWN</a>, <a class="el" href="../../d9/d95/channelstate_8h_source.html#l00040">AST_STATE_RING</a>, <a class="el" href="../../d9/d95/channelstate_8h_source.html#l00041">AST_STATE_RINGING</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00063">ast_test_flag</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00133">ast_pickup_find_by_group()</a>, <a class="el" href="../../d9/db1/app__directed__pickup_8c_source.html#l00268">find_by_mark()</a>, <a class="el" href="../../d9/db1/app__directed__pickup_8c_source.html#l00137">find_by_name()</a>, <a class="el" href="../../d9/db1/app__directed__pickup_8c_source.html#l00158">find_by_uniqueid()</a>, <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00095">find_channel_by_group()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l25984">handle_invite_replaces()</a>, and <a class="el" href="../../d9/db1/app__directed__pickup_8c_source.html#l00237">pickup_by_exten()</a>.</p>
<div class="fragment"><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;{</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a>(chan) &amp;&amp; !<a class="code" href="../../d5/d7b/channel_8h.html#a96d7e5eca937b7e71f27acc4360c3ee1">ast_channel_masq</a>(chan) &amp;&amp; !<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a>)</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      &amp;&amp; (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(chan) == <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;         || <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(chan) == <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">          * Check the down state as well because some SIP devices do not</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">          * give 180 ringing when they can just give 183 session progress</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">          * instead.  Issue 14005.  (Some ISDN switches as well for that</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">          * matter.)</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;         || <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(chan) == <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>)</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      &amp;&amp; !<a class="code" href="../../d5/d7b/channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c">ast_channel_datastore_find</a>(chan, &amp;<a class="code" href="../../d9/dbf/pickup_8c.html#a42d2cca4342fa5ac6f73880b9d33528b">pickup_active</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;   }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;}</div><div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00036">channelstate.h:36</a></div></div>
<div class="ttc" id="utils_8h_html_a00d4c9254c9827d6fa44f17a326744a5"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a></div><div class="ttdeci">#define ast_test_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00063">utils.h:63</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00040">channelstate.h:40</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a></div><div class="ttdeci">ast_channel_state</div><div class="ttdoc">ast_channel states </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00035">channelstate.h:35</a></div></div>
<div class="ttc" id="channel_8h_html_aad1e09cd7c79237d05cffb45d6cdfd7c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c">ast_channel_datastore_find</a></div><div class="ttdeci">struct ast_datastore * ast_channel_datastore_find(struct ast_channel *chan, const struct ast_datastore_info *info, const char *uid)</div><div class="ttdoc">Find a datastore on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02404">channel.c:2404</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="channel_8h_html_a488b7d6f7488bedc53be45d4ef4471c9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a></div><div class="ttdeci">struct ast_pbx * ast_channel_pbx(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00721">channel_internal_api.c:721</a></div></div>
<div class="ttc" id="channel_8h_html_a96d7e5eca937b7e71f27acc4360c3ee1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a96d7e5eca937b7e71f27acc4360c3ee1">ast_channel_masq</a></div><div class="ttdeci">struct ast_channel * ast_channel_masq(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00597">channel_internal_api.c:597</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00041">channelstate.h:41</a></div></div>
<div class="ttc" id="channel_8h_html_a82f2c6e4d47f62f6b65c5887eb096fd5a26796fa52cc5857446eec8d16a4b718d"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a26796fa52cc5857446eec8d16a4b718d">AST_FLAG_ZOMBIE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00988">channel.h:988</a></div></div>
<div class="ttc" id="pickup_8c_html_a42d2cca4342fa5ac6f73880b9d33528b"><div class="ttname"><a href="../../d9/dbf/pickup_8c.html#a42d2cca4342fa5ac6f73880b9d33528b">pickup_active</a></div><div class="ttdeci">static const struct ast_datastore_info pickup_active</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbf/pickup_8c_source.html#l00073">pickup.c:73</a></div></div>
<div class="ttc" id="channel_8h_html_a91de92158876186d28ba1773877f2732"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a></div><div class="ttdeci">struct ast_flags * ast_channel_flags(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l01260">channel_internal_api.c:1260</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abb429cfe4b537c01e51ecb82b49c31ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb429cfe4b537c01e51ecb82b49c31ea">&#9670;&nbsp;</a></span>ast_do_pickup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_do_pickup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>target</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pickup a call target. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chan</td><td>channel that initiated pickup. </td></tr>
    <tr><td class="paramname">target</td><td>channel to be picked up.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function assumes that target is locked.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success. </td></tr>
    <tr><td class="paramname">-1</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>
<p>&lt; A masquerade changes channel names.</p>
<p>&lt; A masquerade changes channel names. </p>

<p class="definition">Definition at line <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00302">302</a> of file <a class="el" href="../../d9/dbf/pickup_8c_source.html">pickup.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l02814">ast_answer()</a>, <a class="el" href="../../d4/da3/causes_8h_source.html#l00113">AST_CAUSE_ANSWERED_ELSEWHERE</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00888">ast_channel_caller()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00892">ast_channel_connected()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l10435">ast_channel_connected_line_macro()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l10539">ast_channel_connected_line_sub()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l02390">ast_channel_datastore_add()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l02399">ast_channel_datastore_remove()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00431">ast_channel_hangupcause_set()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l10867">ast_channel_move()</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l09202">ast_channel_queue_connected_line_update()</a>, <a class="el" href="../../dc/d2b/stasis__channels_8c_source.html#l00451">ast_channel_snapshot_create()</a>, <a class="el" href="../../dc/d2b/stasis__channels_8c_source.html#l00903">ast_channel_snapshot_get_latest()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00305">ast_channel_uniqueid()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l09189">ast_channel_update_connected_line()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l08389">ast_connected_line_copy_from_caller()</a>, <a class="el" href="../../de/d47/callerid_8h_source.html#l00446">AST_CONNECTED_LINE_UPDATE_SOURCE_ANSWER</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00281">AST_CONTROL_ANSWER</a>, <a class="el" href="../../d9/db6/datastore_8h_source.html#l00089">ast_datastore_alloc</a>, <a class="el" href="../../d7/d7a/datastore_8c_source.html#l00068">ast_datastore_free()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l02031">ast_party_connected_line_copy()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l02072">ast_party_connected_line_free()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l02022">ast_party_connected_line_init()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l01896">ast_party_id_reset()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l01231">ast_queue_control()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00300">ast_strdupa</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l00469">ast_party_connected_line::priv</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00278">send_call_pickup_stasis_message()</a>, and <a class="el" href="../../d5/d7b/channel_8h_source.html#l00483">ast_party_connected_line::source</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00200">ast_pickup_call()</a>, <a class="el" href="../../db/dc4/test__cel_8c_source.html#l01561">AST_TEST_DEFINE()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l25984">handle_invite_replaces()</a>, <a class="el" href="../../d9/db1/app__directed__pickup_8c_source.html#l00220">pickup_by_channel()</a>, <a class="el" href="../../d9/db1/app__directed__pickup_8c_source.html#l00237">pickup_by_exten()</a>, <a class="el" href="../../d9/db1/app__directed__pickup_8c_source.html#l00308">pickup_by_group()</a>, <a class="el" href="../../d9/db1/app__directed__pickup_8c_source.html#l00292">pickup_by_mark()</a>, and <a class="el" href="../../d9/db1/app__directed__pickup_8c_source.html#l00395">pickup_by_part()</a>.</p>
<div class="fragment"><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;{</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d9e/structast__party__connected__line.html">ast_party_connected_line</a> connected_caller;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *ds_pickup;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *chan_name;<span class="comment">/*!&lt; A masquerade changes channel names. */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *target_name;<span class="comment">/*!&lt; A masquerade changes channel names. */</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   <span class="keywordtype">int</span> res = -1;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a> *, chan_snapshot, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a> *, target_snapshot, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;   target_name = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(target));</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Call pickup on &#39;%s&#39; by &#39;%s&#39;\n&quot;</span>, target_name, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   <span class="comment">/* Mark the target to block any call pickup race. */</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;   ds_pickup = <a class="code" href="../../d9/db6/datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a>(&amp;<a class="code" href="../../d9/dbf/pickup_8c.html#a42d2cca4342fa5ac6f73880b9d33528b">pickup_active</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   <span class="keywordflow">if</span> (!ds_pickup) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;         <span class="stringliteral">&quot;Unable to create channel datastore on &#39;%s&#39; for call pickup\n&quot;</span>, target_name);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   }</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a1ed3e98d33d5587948a0e2ef67a81f52">ast_channel_datastore_add</a>(target, ds_pickup);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#abf514b9d96a1821a33fec8c64ee4e26f">ast_party_connected_line_init</a>(&amp;connected_caller);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a5d3c15fe1dffda82e6dc03ca7b26526a">ast_party_connected_line_copy</a>(&amp;connected_caller, <a class="code" href="../../d5/d7b/channel_8h.html#a10f23f1907b804485f62973f66cd9aef">ast_channel_connected</a>(target));</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(target);<span class="comment">/* The pickup race is avoided so we do not need the lock anymore. */</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   <span class="comment">/* Reset any earlier private connected id representation */</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ab1c04d237cea67fefadaacc3f79497fa">ast_party_id_reset</a>(&amp;connected_caller.priv);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;   connected_caller.source = <a class="code" href="../../de/d47/callerid_8h.html#a5cdbc47cd18e7f41d450e9caea186b1bac0f31b03872d178b92b054fb07358495">AST_CONNECTED_LINE_UPDATE_SOURCE_ANSWER</a>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a2661f0a9305c7a9ab779f55f4e57c1ad">ast_channel_connected_line_sub</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, chan, &amp;connected_caller, 0) &amp;&amp;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#aa9958d9d3c90bdc9a37fff1243b4709b">ast_channel_connected_line_macro</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, chan, &amp;connected_caller, 0, 0)) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a7ee3ff7bf7773329e9e20143f0ba2f69">ast_channel_update_connected_line</a>(chan, &amp;connected_caller, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a40fc421536e02d30fecaa51a255b4144">ast_party_connected_line_free</a>(&amp;connected_caller);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;   chan_name = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#accf4e9753bd5d7316f4988e74486552b">ast_connected_line_copy_from_caller</a>(&amp;connected_caller, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan));</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;   connected_caller.source = <a class="code" href="../../de/d47/callerid_8h.html#a5cdbc47cd18e7f41d450e9caea186b1bac0f31b03872d178b92b054fb07358495">AST_CONNECTED_LINE_UPDATE_SOURCE_ANSWER</a>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a>(chan)) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to answer &#39;%s&#39;\n&quot;</span>, chan_name);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordflow">goto</span> pickup_failed;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a60f9d2b0ab8b7a839902313321163b28">ast_queue_control</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>)) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to queue answer on &#39;%s&#39;\n&quot;</span>, chan_name);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordflow">goto</span> pickup_failed;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ade57349a78b2f32d3a7d1bc01fb3bf96">ast_channel_queue_connected_line_update</a>(chan, &amp;connected_caller, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <span class="comment">/* setting the HANGUPCAUSE so the ringing channel knows this call was not a missed call */</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(chan, <a class="code" href="../../d4/da3/causes_8h.html#aa71419a0c598e31312477c5a644e7440">AST_CAUSE_ANSWERED_ELSEWHERE</a>);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;   chan_snapshot = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga7f4919ce97dcdee0a98979ca4de29242">ast_channel_snapshot_create</a>(chan);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   <span class="keywordflow">if</span> (!chan_snapshot) {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordflow">goto</span> pickup_failed;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   }</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;   target_snapshot = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga68c55b443ba97dc157b493aafd05c876">ast_channel_snapshot_get_latest</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(target));</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;   <span class="keywordflow">if</span> (!target_snapshot) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordflow">goto</span> pickup_failed;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;   }</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a8043e35bcff5fb2d410dd161ac6e4360">ast_channel_move</a>(target, chan)) {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to complete call pickup of &#39;%s&#39; with &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;         chan_name, target_name);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordflow">goto</span> pickup_failed;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;   }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   <span class="comment">/* target points to the channel that did the pickup at this point, so use that channel&#39;s topic instead of chan */</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;   <a class="code" href="../../d9/dbf/pickup_8c.html#ad4727061b89ae2fac9cf4ed6709005b7">send_call_pickup_stasis_message</a>(target, chan_snapshot, target_snapshot);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   res = 0;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;pickup_failed:</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(target);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7b/channel_8h.html#a1ff1c62b6d50823da93a920575c9c0c9">ast_channel_datastore_remove</a>(target, ds_pickup)) {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <a class="code" href="../../d9/db6/datastore_8h.html#aee27286888b30c6448a9bce928040a14">ast_datastore_free</a>(ds_pickup);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a40fc421536e02d30fecaa51a255b4144">ast_party_connected_line_free</a>(&amp;connected_caller);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;}</div><div class="ttc" id="channel_8h_html_ac2dc872b606534943c98304aed841b34"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a></div><div class="ttdeci">struct ast_party_caller * ast_channel_caller(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00888">channel_internal_api.c:888</a></div></div>
<div class="ttc" id="channel_8h_html_abf514b9d96a1821a33fec8c64ee4e26f"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#abf514b9d96a1821a33fec8c64ee4e26f">ast_party_connected_line_init</a></div><div class="ttdeci">void ast_party_connected_line_init(struct ast_party_connected_line *init)</div><div class="ttdoc">Initialize the given connected line structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02022">channel.c:2022</a></div></div>
<div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="channel_8h_html_aa9958d9d3c90bdc9a37fff1243b4709b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa9958d9d3c90bdc9a37fff1243b4709b">ast_channel_connected_line_macro</a></div><div class="ttdeci">int ast_channel_connected_line_macro(struct ast_channel *autoservice_chan, struct ast_channel *macro_chan, const void *connected_info, int is_caller, int frame)</div><div class="ttdoc">Run a connected line interception macro and update a channel&amp;#39;s connected line information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10435">channel.c:10435</a></div></div>
<div class="ttc" id="channel_8h_html_a60f9d2b0ab8b7a839902313321163b28"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a60f9d2b0ab8b7a839902313321163b28">ast_queue_control</a></div><div class="ttdeci">int ast_queue_control(struct ast_channel *chan, enum ast_control_frame_type control)</div><div class="ttdoc">Queue a control frame without payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01231">channel.c:1231</a></div></div>
<div class="ttc" id="channel_8h_html_ab1c04d237cea67fefadaacc3f79497fa"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab1c04d237cea67fefadaacc3f79497fa">ast_party_id_reset</a></div><div class="ttdeci">void ast_party_id_reset(struct ast_party_id *id)</div><div class="ttdoc">Destroy and initialize the given party id structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01896">channel.c:1896</a></div></div>
<div class="ttc" id="channel_8h_html_ae6b4b7ba458e88fdbb2df9f39d935337"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a></div><div class="ttdeci">void ast_channel_hangupcause_set(struct ast_channel *chan, int value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00431">channel_internal_api.c:431</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="channel_8h_html_a7ee3ff7bf7773329e9e20143f0ba2f69"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ee3ff7bf7773329e9e20143f0ba2f69">ast_channel_update_connected_line</a></div><div class="ttdeci">void ast_channel_update_connected_line(struct ast_channel *chan, const struct ast_party_connected_line *connected, const struct ast_set_party_connected_line *update)</div><div class="ttdoc">Indicate that the connected line information has changed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l09189">channel.c:9189</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00281">include/asterisk/frame.h:281</a></div></div>
<div class="ttc" id="structast__channel__snapshot_html"><div class="ttname"><a href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a></div><div class="ttdoc">Structure representing a snapshot of channel state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/stasis__channels_8h_source.html#l00145">stasis_channels.h:145</a></div></div>
<div class="ttc" id="pickup_8c_html_ad4727061b89ae2fac9cf4ed6709005b7"><div class="ttname"><a href="../../d9/dbf/pickup_8c.html#ad4727061b89ae2fac9cf4ed6709005b7">send_call_pickup_stasis_message</a></div><div class="ttdeci">static int send_call_pickup_stasis_message(struct ast_channel *picking_up, struct ast_channel_snapshot *chan, struct ast_channel_snapshot *target)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbf/pickup_8c_source.html#l00278">pickup.c:278</a></div></div>
<div class="ttc" id="structast__datastore_html"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html">ast_datastore</a></div><div class="ttdoc">Structure for a data store object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00068">datastore.h:68</a></div></div>
<div class="ttc" id="channel_8h_html_a40fc421536e02d30fecaa51a255b4144"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a40fc421536e02d30fecaa51a255b4144">ast_party_connected_line_free</a></div><div class="ttdeci">void ast_party_connected_line_free(struct ast_party_connected_line *doomed)</div><div class="ttdoc">Destroy the connected line information contents. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02072">channel.c:2072</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="callerid_8h_html_a5cdbc47cd18e7f41d450e9caea186b1bac0f31b03872d178b92b054fb07358495"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a5cdbc47cd18e7f41d450e9caea186b1bac0f31b03872d178b92b054fb07358495">AST_CONNECTED_LINE_UPDATE_SOURCE_ANSWER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00446">callerid.h:446</a></div></div>
<div class="ttc" id="channel_8h_html_a8043e35bcff5fb2d410dd161ac6e4360"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a8043e35bcff5fb2d410dd161ac6e4360">ast_channel_move</a></div><div class="ttdeci">int ast_channel_move(struct ast_channel *dest, struct ast_channel *source)</div><div class="ttdoc">Move a channel from its current location to a new location. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10867">channel.c:10867</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga7f4919ce97dcdee0a98979ca4de29242"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga7f4919ce97dcdee0a98979ca4de29242">ast_channel_snapshot_create</a></div><div class="ttdeci">struct ast_channel_snapshot * ast_channel_snapshot_create(struct ast_channel *chan)</div><div class="ttdoc">Generate a snapshot of the channel state. This is an ao2 object, so ao2_cleanup() to deallocate...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l00451">stasis_channels.c:451</a></div></div>
<div class="ttc" id="datastore_8h_html_aee27286888b30c6448a9bce928040a14"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#aee27286888b30c6448a9bce928040a14">ast_datastore_free</a></div><div class="ttdeci">int ast_datastore_free(struct ast_datastore *datastore)</div><div class="ttdoc">Free a data store object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d7a/datastore_8c_source.html#l00068">datastore.c:68</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="channel_8h_html_ade57349a78b2f32d3a7d1bc01fb3bf96"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ade57349a78b2f32d3a7d1bc01fb3bf96">ast_channel_queue_connected_line_update</a></div><div class="ttdeci">void ast_channel_queue_connected_line_update(struct ast_channel *chan, const struct ast_party_connected_line *connected, const struct ast_set_party_connected_line *update)</div><div class="ttdoc">Queue a connected line update frame on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l09202">channel.c:9202</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="channel_8h_html_a10f23f1907b804485f62973f66cd9aef"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a10f23f1907b804485f62973f66cd9aef">ast_channel_connected</a></div><div class="ttdeci">struct ast_party_connected_line * ast_channel_connected(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00892">channel_internal_api.c:892</a></div></div>
<div class="ttc" id="causes_8h_html_aa71419a0c598e31312477c5a644e7440"><div class="ttname"><a href="../../d4/da3/causes_8h.html#aa71419a0c598e31312477c5a644e7440">AST_CAUSE_ANSWERED_ELSEWHERE</a></div><div class="ttdeci">#define AST_CAUSE_ANSWERED_ELSEWHERE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00113">causes.h:113</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="channel_8h_html_a3b6254f6d3832ef928f0a727113b1c63"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a></div><div class="ttdeci">const char * ast_channel_uniqueid(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00305">channel_internal_api.c:305</a></div></div>
<div class="ttc" id="channel_8h_html_a2661f0a9305c7a9ab779f55f4e57c1ad"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a2661f0a9305c7a9ab779f55f4e57c1ad">ast_channel_connected_line_sub</a></div><div class="ttdeci">int ast_channel_connected_line_sub(struct ast_channel *autoservice_chan, struct ast_channel *sub_chan, const void *connected_info, int frame)</div><div class="ttdoc">Run a connected line interception subroutine and update a channel&amp;#39;s connected line information...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10539">channel.c:10539</a></div></div>
<div class="ttc" id="structast__party__connected__line_html"><div class="ttname"><a href="../../dc/d9e/structast__party__connected__line.html">ast_party_connected_line</a></div><div class="ttdoc">Connected Line/Party information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00457">channel.h:457</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="pickup_8c_html_a42d2cca4342fa5ac6f73880b9d33528b"><div class="ttname"><a href="../../d9/dbf/pickup_8c.html#a42d2cca4342fa5ac6f73880b9d33528b">pickup_active</a></div><div class="ttdeci">static const struct ast_datastore_info pickup_active</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbf/pickup_8c_source.html#l00073">pickup.c:73</a></div></div>
<div class="ttc" id="channel_8h_html_a5d3c15fe1dffda82e6dc03ca7b26526a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a5d3c15fe1dffda82e6dc03ca7b26526a">ast_party_connected_line_copy</a></div><div class="ttdeci">void ast_party_connected_line_copy(struct ast_party_connected_line *dest, const struct ast_party_connected_line *src)</div><div class="ttdoc">Copy the source connected line information to the destination connected line. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02031">channel.c:2031</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga68c55b443ba97dc157b493aafd05c876"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga68c55b443ba97dc157b493aafd05c876">ast_channel_snapshot_get_latest</a></div><div class="ttdeci">struct ast_channel_snapshot * ast_channel_snapshot_get_latest(const char *uniqueid)</div><div class="ttdoc">Obtain the latest ast_channel_snapshot from the Stasis Message Bus API cache. This is an ao2 object...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l00903">stasis_channels.c:903</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="channel_8h_html_accf4e9753bd5d7316f4988e74486552b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#accf4e9753bd5d7316f4988e74486552b">ast_connected_line_copy_from_caller</a></div><div class="ttdeci">void ast_connected_line_copy_from_caller(struct ast_party_connected_line *dest, const struct ast_party_caller *src)</div><div class="ttdoc">Copy the caller information to the connected line information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l08389">channel.c:8389</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="channel_8h_html_aec583a3e25358ee552a4f3df53914cd0"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a></div><div class="ttdeci">int ast_answer(struct ast_channel *chan)</div><div class="ttdoc">Answer a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02814">channel.c:2814</a></div></div>
<div class="ttc" id="datastore_8h_html_a666afb07fd77d50782cc10f83e029159"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a></div><div class="ttdeci">#define ast_datastore_alloc(info, uid)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00089">datastore.h:89</a></div></div>
<div class="ttc" id="channel_8h_html_a1ed3e98d33d5587948a0e2ef67a81f52"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1ed3e98d33d5587948a0e2ef67a81f52">ast_channel_datastore_add</a></div><div class="ttdeci">int ast_channel_datastore_add(struct ast_channel *chan, struct ast_datastore *datastore)</div><div class="ttdoc">Add a datastore to a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02390">channel.c:2390</a></div></div>
<div class="ttc" id="channel_8h_html_a1ff1c62b6d50823da93a920575c9c0c9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1ff1c62b6d50823da93a920575c9c0c9">ast_channel_datastore_remove</a></div><div class="ttdeci">int ast_channel_datastore_remove(struct ast_channel *chan, struct ast_datastore *datastore)</div><div class="ttdoc">Remove a datastore from a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02399">channel.c:2399</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4890be42c2add5f52028705d6bc02201"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4890be42c2add5f52028705d6bc02201">&#9670;&nbsp;</a></span>ast_pickup_call()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_pickup_call </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pickup a call. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chan</td><td>channel that initiated pickup.</td></tr>
  </table>
  </dd>
</dl>
<p>Walk list of channels, checking it is not itself, channel is pbx one, check that the callgroup for both channels are the same and the channel is ringing. Answer calling channel, flag channel as answered on queue, masq channels together. </p>
<p>&lt; Potential pickup target </p>

<p class="definition">Definition at line <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00200">200</a> of file <a class="el" href="../../d9/dbf/pickup_8c_source.html">pickup.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l02814">ast_answer()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02981">ast_channel_unref</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00302">ast_do_pickup()</a>, <a class="el" href="../../de/d71/features__config_8c_source.html#l01193">ast_get_chan_features_pickup_config()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00133">ast_pickup_find_by_group()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00300">ast_strdupa</a>, <a class="el" href="../../d6/d13/file_8c_source.html#l01814">ast_stream_and_wait()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00263">LOG_NOTICE</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d3/d8c/pbx__variables_8c_source.html#l01071">pbx_builtin_setvar_helper()</a>, and <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d2/d09/sig__analog_8c_source.html#l01711">__analog_ss_thread()</a>, <a class="el" href="../../d1/d97/chan__dahdi_8c_source.html#l09512">analog_ss_thread()</a>, <a class="el" href="../../d0/d29/chan__pjsip_8c_source.html#l03065">call_pickup_incoming_request()</a>, <a class="el" href="../../d7/d9b/chan__misdn_8c_source.html#l09917">cb_events()</a>, <a class="el" href="../../d1/d6d/chan__unistim_8c_source.html#l03111">handle_call_outgoing()</a>, <a class="el" href="../../d0/d80/chan__skinny_8c_source.html#l06974">handle_soft_key_event_message()</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l03000">mgcp_ss()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l25616">sip_pickup_thread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;{</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *target;<span class="comment">/*!&lt; Potential pickup target */</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;   <span class="keywordtype">int</span> res = -1;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d6f/structast__features__pickup__config.html">ast_features_pickup_config</a> *, pickup_cfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *pickup_sound;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *fail_sound;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Pickup attempt by %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;   pickup_cfg = <a class="code" href="../../d0/daa/include_2asterisk_2features__config_8h.html#ad9d12b10a3d0c3bca1d0b033bc139dab">ast_get_chan_features_pickup_config</a>(chan);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;   <span class="keywordflow">if</span> (!pickup_cfg) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to retrieve pickup configuration. Unable to play pickup sounds\n&quot;</span>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;   pickup_sound = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(pickup_cfg ? pickup_cfg-&gt;pickupsound : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   fail_sound = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(pickup_cfg ? pickup_cfg-&gt;pickupfailsound : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   <span class="comment">/* The found channel is already locked. */</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;   target = <a class="code" href="../../d9/dbf/pickup_8c.html#afc7090d6928faf9cc0dc9c1436f50c82">ast_pickup_find_by_group</a>(chan);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   <span class="keywordflow">if</span> (target) {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Pickup %s attempt by %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(target), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      res = <a class="code" href="../../d9/dbf/pickup_8c.html#abb429cfe4b537c01e51ecb82b49c31ea">ast_do_pickup</a>(chan, target);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(target);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keywordflow">if</span> (!res) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(pickup_sound)) {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(target, <span class="stringliteral">&quot;BRIDGE_PLAY_SOUND&quot;</span>, pickup_sound);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;         }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Pickup %s failed by %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(target), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      target = <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(target);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   }</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   <span class="keywordflow">if</span> (res &lt; 0) {</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;No call pickup possible... for %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(fail_sound)) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a>(chan);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;         <a class="code" href="../../d2/d4d/file_8h.html#a95b94a020720147325a486e210b36775">ast_stream_and_wait</a>(chan, fail_sound, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;   }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div><div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="include_2asterisk_2features__config_8h_html_ad9d12b10a3d0c3bca1d0b033bc139dab"><div class="ttname"><a href="../../d0/daa/include_2asterisk_2features__config_8h.html#ad9d12b10a3d0c3bca1d0b033bc139dab">ast_get_chan_features_pickup_config</a></div><div class="ttdeci">struct ast_features_pickup_config * ast_get_chan_features_pickup_config(struct ast_channel *chan)</div><div class="ttdoc">Get the pickup configuration options for a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d71/features__config_8c_source.html#l01193">features_config.c:1193</a></div></div>
<div class="ttc" id="channel_8h_html_ab733a7825810b895a89b629e0ea89380"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a></div><div class="ttdeci">#define ast_channel_unref(c)</div><div class="ttdoc">Decrease channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02981">channel.h:2981</a></div></div>
<div class="ttc" id="pickup_8c_html_afc7090d6928faf9cc0dc9c1436f50c82"><div class="ttname"><a href="../../d9/dbf/pickup_8c.html#afc7090d6928faf9cc0dc9c1436f50c82">ast_pickup_find_by_group</a></div><div class="ttdeci">struct ast_channel * ast_pickup_find_by_group(struct ast_channel *chan)</div><div class="ttdoc">Find a pickup channel target by group. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbf/pickup_8c_source.html#l00133">pickup.c:133</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="logger_8h_html_ad89ee324d180cdcd7defcc709ff9ca42"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a></div><div class="ttdeci">#define LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00263">logger.h:263</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="file_8h_html_a95b94a020720147325a486e210b36775"><div class="ttname"><a href="../../d2/d4d/file_8h.html#a95b94a020720147325a486e210b36775">ast_stream_and_wait</a></div><div class="ttdeci">int ast_stream_and_wait(struct ast_channel *chan, const char *file, const char *digits)</div><div class="ttdoc">stream file until digit If the file name is non-empty, try to play it. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/file_8c_source.html#l01814">file.c:1814</a></div></div>
<div class="ttc" id="pickup_8c_html_abb429cfe4b537c01e51ecb82b49c31ea"><div class="ttname"><a href="../../d9/dbf/pickup_8c.html#abb429cfe4b537c01e51ecb82b49c31ea">ast_do_pickup</a></div><div class="ttdeci">int ast_do_pickup(struct ast_channel *chan, struct ast_channel *target)</div><div class="ttdoc">Pickup a call target. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbf/pickup_8c_source.html#l00302">pickup.c:302</a></div></div>
<div class="ttc" id="pbx_8h_html_a6e5b90edb84d216267148dddcffe9b9a"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a></div><div class="ttdeci">int pbx_builtin_setvar_helper(struct ast_channel *chan, const char *name, const char *value)</div><div class="ttdoc">Add a variable to the channel variable stack, removing the most recently set value for the same name...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l01071">pbx_variables.c:1071</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="channel_8h_html_aec583a3e25358ee552a4f3df53914cd0"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a></div><div class="ttdeci">int ast_answer(struct ast_channel *chan)</div><div class="ttdoc">Answer a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02814">channel.c:2814</a></div></div>
<div class="ttc" id="structast__features__pickup__config_html"><div class="ttname"><a href="../../d2/d6f/structast__features__pickup__config.html">ast_features_pickup_config</a></div><div class="ttdoc">Configuration relating to call pickup. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/daa/include_2asterisk_2features__config_8h_source.html#l00137">include/asterisk/features_config.h:137</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afc7090d6928faf9cc0dc9c1436f50c82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc7090d6928faf9cc0dc9c1436f50c82">&#9670;&nbsp;</a></span>ast_pickup_find_by_group()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a>* ast_pickup_find_by_group </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find a pickup channel target by group. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chan</td><td>channel that initiated pickup.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">target</td><td>on success. The returned channel is locked and reffed. </td></tr>
    <tr><td class="paramname">NULL</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>
<p>&lt; Candidate channels found to pickup.</p>
<p>&lt; Potential pickup target</p>
<p>&lt; Potential new older target </p>

<p class="definition">Definition at line <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00133">133</a> of file <a class="el" href="../../d9/dbf/pickup_8c_source.html">pickup.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00369">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01335">ao2_container_alloc_list</a>, <a class="el" href="../../d7/d22/astobj2__container_8c_source.html#l00534">ao2_iterator_destroy()</a>, <a class="el" href="../../d7/d22/astobj2__container_8c_source.html#l00485">ao2_iterator_init()</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01933">ao2_iterator_next</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01598">ao2_unlink</a>, <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00077">ast_can_pickup()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l01278">ast_channel_callback()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00976">ast_channel_creationtime()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02981">ast_channel_unref</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00128">ast_tvcmp()</a>, <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00095">find_channel_by_group()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00200">ast_pickup_call()</a>, and <a class="el" href="../../d9/db1/app__directed__pickup_8c_source.html#l00308">pickup_by_group()</a>.</p>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *candidates;<span class="comment">/*!&lt; Candidate channels found to pickup. */</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *target;<span class="comment">/*!&lt; Potential pickup target */</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;   candidates = <a class="code" href="../../d5/da5/astobj2_8h.html#add41bd9979cb8642f81dd38aa2dfcd6d">ao2_container_alloc_list</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;   <span class="keywordflow">if</span> (!candidates) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;   }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;   <span class="comment">/* Find all candidate targets by group. */</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a23323032f4b0fbab003874dd2c74d1e4">ast_channel_callback</a>(<a class="code" href="../../d9/dbf/pickup_8c.html#a2473db24e4139565312fa90497c8ad79">find_channel_by_group</a>, chan, candidates, 0);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;   <span class="comment">/* Find the oldest pickup target candidate */</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;   target = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *candidate;<span class="comment">/*!&lt; Potential new older target */</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> iter;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      iter = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(candidates, 0);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="keywordflow">while</span> ((candidate = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;iter))) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;         <span class="keywordflow">if</span> (!target) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="comment">/* First target. */</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            target = candidate;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;         }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a8873859a4dbc3d0d053d696667e49012">ast_channel_creationtime</a>(candidate), <a class="code" href="../../d5/d7b/channel_8h.html#a8873859a4dbc3d0d053d696667e49012">ast_channel_creationtime</a>(target)) &lt; 0) {</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="comment">/* We have a new target. */</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(target);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            target = candidate;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;         }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(candidate);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;iter);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordflow">if</span> (!target) {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;         <span class="comment">/* No candidates found. */</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="comment">/* The found channel must be locked and ref&#39;d. */</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(target);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="comment">/* Recheck pickup ability */</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/dbf/pickup_8c.html#ab8425437dfb158abc67493460a0f6944">ast_can_pickup</a>(target)) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;         <span class="comment">/* This is the channel to pickup. */</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="comment">/* Someone else picked it up or the call went away. */</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(target);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(candidates, target);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      target = <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(target);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;   }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(candidates, -1);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;   <span class="keywordflow">return</span> target;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div><div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00369">astobj2.h:369</a></div></div>
<div class="ttc" id="channel_8h_html_ab733a7825810b895a89b629e0ea89380"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a></div><div class="ttdeci">#define ast_channel_unref(c)</div><div class="ttdoc">Decrease channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02981">channel.h:2981</a></div></div>
<div class="ttc" id="astobj2_8h_html_add41bd9979cb8642f81dd38aa2dfcd6d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#add41bd9979cb8642f81dd38aa2dfcd6d">ao2_container_alloc_list</a></div><div class="ttdeci">#define ao2_container_alloc_list(ao2_options, container_options, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01335">astobj2.h:1335</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad36841ab6daa3997f7ca7047ad2d033a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a></div><div class="ttdeci">void ao2_iterator_destroy(struct ao2_iterator *iter)</div><div class="ttdoc">Destroy a container iterator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00534">astobj2_container.c:534</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="pickup_8c_html_a2473db24e4139565312fa90497c8ad79"><div class="ttname"><a href="../../d9/dbf/pickup_8c.html#a2473db24e4139565312fa90497c8ad79">find_channel_by_group</a></div><div class="ttdeci">static int find_channel_by_group(void *obj, void *arg, void *data, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbf/pickup_8c_source.html#l00095">pickup.c:95</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="channel_8h_html_a23323032f4b0fbab003874dd2c74d1e4"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a23323032f4b0fbab003874dd2c74d1e4">ast_channel_callback</a></div><div class="ttdeci">struct ast_channel * ast_channel_callback(ao2_callback_data_fn *cb_fn, void *arg, void *data, int ao2_flags)</div><div class="ttdoc">Call a function with every active channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01278">channel.c:1278</a></div></div>
<div class="ttc" id="time_8h_html_a6daa33e2052acd094bb63e78aba29733"><div class="ttname"><a href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a></div><div class="ttdeci">int ast_tvcmp(struct timeval _a, struct timeval _b)</div><div class="ttdoc">Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller, equal or greater to the second. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00128">time.h:128</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="astobj2_8h_html_a17990ea630db7dbd1252ef0132133a2b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a></div><div class="ttdeci">#define ao2_iterator_next(iter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01933">astobj2.h:1933</a></div></div>
<div class="ttc" id="channel_8h_html_a8873859a4dbc3d0d053d696667e49012"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a8873859a4dbc3d0d053d696667e49012">ast_channel_creationtime</a></div><div class="ttdeci">struct timeval ast_channel_creationtime(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00976">channel_internal_api.c:976</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="pickup_8c_html_ab8425437dfb158abc67493460a0f6944"><div class="ttname"><a href="../../d9/dbf/pickup_8c.html#ab8425437dfb158abc67493460a0f6944">ast_can_pickup</a></div><div class="ttdeci">int ast_can_pickup(struct ast_channel *chan)</div><div class="ttdoc">Test if a channel can be picked up. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbf/pickup_8c_source.html#l00077">pickup.c:77</a></div></div>
<div class="ttc" id="structao2__iterator_html"><div class="ttname"><a href="../../d9/d97/structao2__iterator.html">ao2_iterator</a></div><div class="ttdoc">When we need to walk through a container, we use an ao2_iterator to keep track of the current positio...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01841">astobj2.h:1841</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="astobj2_8h_html_a91d5d37d00874ae7a92d1a15c0a3b3a6"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a></div><div class="ttdeci">struct ao2_iterator ao2_iterator_init(struct ao2_container *c, int flags) attribute_warn_unused_result</div><div class="ttdoc">Create an iterator for a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00485">astobj2_container.c:485</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9910076549cb71ff910510eb9e6d5f87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9910076549cb71ff910510eb9e6d5f87">&#9670;&nbsp;</a></span>ast_pickup_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_pickup_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize pickup. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">non-zero</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00401">401</a> of file <a class="el" href="../../d9/dbf/pickup_8c_source.html">pickup.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type()</a>, <a class="el" href="../../da/d4d/clicompat_8c_source.html#l00019">ast_register_cleanup()</a>, <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00396">pickup_shutdown()</a>, and <a class="el" href="../../dd/d79/stasis_8h_source.html#l01501">STASIS_MESSAGE_TYPE_INIT</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d03/asterisk_8c_source.html#l03947">asterisk_daemon()</a>.</p>
<div class="fragment"><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;{</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a70cd046d8e3fd50de5c51aecb2830d2a">STASIS_MESSAGE_TYPE_INIT</a>(<a class="code" href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type</a>);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;   <a class="code" href="../../db/db2/asterisk_8h.html#a412442e1beffe5bec07ed2e9ea72afc3">ast_register_cleanup</a>(<a class="code" href="../../d9/dbf/pickup_8c.html#aa5aca635640dafce83abcf0c5edc697e">pickup_shutdown</a>);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;}</div><div class="ttc" id="pickup_8c_html_aa5aca635640dafce83abcf0c5edc697e"><div class="ttname"><a href="../../d9/dbf/pickup_8c.html#aa5aca635640dafce83abcf0c5edc697e">pickup_shutdown</a></div><div class="ttdeci">static void pickup_shutdown(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbf/pickup_8c_source.html#l00396">pickup.c:396</a></div></div>
<div class="ttc" id="stasis_8h_html_a70cd046d8e3fd50de5c51aecb2830d2a"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a70cd046d8e3fd50de5c51aecb2830d2a">STASIS_MESSAGE_TYPE_INIT</a></div><div class="ttdeci">#define STASIS_MESSAGE_TYPE_INIT(name)</div><div class="ttdoc">Boiler-plate messaging macro for initializing message types. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l01501">stasis.h:1501</a></div></div>
<div class="ttc" id="asterisk_8h_html_a412442e1beffe5bec07ed2e9ea72afc3"><div class="ttname"><a href="../../db/db2/asterisk_8h.html#a412442e1beffe5bec07ed2e9ea72afc3">ast_register_cleanup</a></div><div class="ttdeci">int ast_register_cleanup(void(*func)(void))</div><div class="ttdoc">Register a function to be executed before Asterisk gracefully exits. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00019">clicompat.c:19</a></div></div>
<div class="ttc" id="pickup_8h_html_aee13f6ef760e25f0169c41cbb38fbab4"><div class="ttname"><a href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type</a></div><div class="ttdeci">struct stasis_message_type * ast_call_pickup_type(void)</div><div class="ttdoc">accessor for call pickup message type </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adff86eccdca70e67e66468e6682074ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adff86eccdca70e67e66468e6682074ce">&#9670;&nbsp;</a></span>call_pickup_to_ami()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../dd/d96/structast__manager__event__blob.html">ast_manager_event_blob</a> * call_pickup_to_ami </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00246">246</a> of file <a class="el" href="../../d9/dbf/pickup_8c_source.html">pickup.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d0/d1c/manager__channels_8c_source.html#l00561">ast_manager_build_channel_state_string()</a>, <a class="el" href="../../d0/d1c/manager__channels_8c_source.html#l00487">ast_manager_build_channel_state_string_prefix()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l09727">ast_manager_event_blob_create()</a>, <a class="el" href="../../dc/d2b/stasis__channels_8c_source.html#l00977">ast_multi_channel_blob_get_channel()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00714">ast_str_buffer()</a>, <a class="el" href="../../d5/dde/test__func__file_8c_source.html#l00045">contents</a>, <a class="el" href="../../db/d45/manager_8h_source.html#l00072">EVENT_FLAG_CALL</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, and <a class="el" href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message_data()</a>.</p>
<div class="fragment"><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;{</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dcb/structast__multi__channel__blob.html">ast_multi_channel_blob</a> *<a class="code" href="../../d5/dde/test__func__file_8c.html#aedde4c44231f9adaad3339ebe693e8d8">contents</a> = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(message);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a> *chan;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a> *target;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d96/structast__manager__event__blob.html">ast_manager_event_blob</a> *res;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *, channel_str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *, target_str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   chan = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gac6cf4ef94e11b14625a81ba56f89a183">ast_multi_channel_blob_get_channel</a>(contents, <span class="stringliteral">&quot;channel&quot;</span>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   target = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gac6cf4ef94e11b14625a81ba56f89a183">ast_multi_channel_blob_get_channel</a>(contents, <span class="stringliteral">&quot;target&quot;</span>);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(chan != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; target != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;   <span class="keywordflow">if</span> (!(channel_str = <a class="code" href="../../db/d45/manager_8h.html#a777cde87d12b331902f862ec44641688">ast_manager_build_channel_state_string</a>(chan))) {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   <span class="keywordflow">if</span> (!(target_str = <a class="code" href="../../db/d45/manager_8h.html#ab71472ea55b4114f460a4459e3dcd18b">ast_manager_build_channel_state_string_prefix</a>(target, <span class="stringliteral">&quot;Target&quot;</span>))) {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   res = <a class="code" href="../../db/d45/manager_8h.html#a3ace32eaf9a3fc2f7d15121c64bf8ecd">ast_manager_event_blob_create</a>(<a class="code" href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;Pickup&quot;</span>,</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="stringliteral">&quot;%s&quot;</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="stringliteral">&quot;%s&quot;</span>,</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(channel_str),</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(target_str));</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div><div class="ttc" id="structast__manager__event__blob_html"><div class="ttname"><a href="../../dd/d96/structast__manager__event__blob.html">ast_manager_event_blob</a></div><div class="ttdoc">Struct containing info for an AMI event to send out. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00491">manager.h:491</a></div></div>
<div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="structast__channel__snapshot_html"><div class="ttname"><a href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a></div><div class="ttdoc">Structure representing a snapshot of channel state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/stasis__channels_8h_source.html#l00145">stasis_channels.h:145</a></div></div>
<div class="ttc" id="manager_8h_html_ab71472ea55b4114f460a4459e3dcd18b"><div class="ttname"><a href="../../db/d45/manager_8h.html#ab71472ea55b4114f460a4459e3dcd18b">ast_manager_build_channel_state_string_prefix</a></div><div class="ttdeci">struct ast_str * ast_manager_build_channel_state_string_prefix(const struct ast_channel_snapshot *snapshot, const char *prefix)</div><div class="ttdoc">Generate the AMI message body from a channel snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d1c/manager__channels_8c_source.html#l00487">manager_channels.c:487</a></div></div>
<div class="ttc" id="manager_8h_html_ab5db3cc603d7e798d61cb4cd94fbb4e2"><div class="ttname"><a href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a></div><div class="ttdeci">#define EVENT_FLAG_CALL</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00072">manager.h:72</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="manager_8h_html_a3ace32eaf9a3fc2f7d15121c64bf8ecd"><div class="ttname"><a href="../../db/d45/manager_8h.html#a3ace32eaf9a3fc2f7d15121c64bf8ecd">ast_manager_event_blob_create</a></div><div class="ttdeci">struct ast_manager_event_blob * ast_manager_event_blob_create(int event_flags, const char *manager_event, const char *extra_fields_fmt,...)</div><div class="ttdoc">Construct a ast_manager_event_blob. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l09727">manager.c:9727</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="test__func__file_8c_html_aedde4c44231f9adaad3339ebe693e8d8"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#aedde4c44231f9adaad3339ebe693e8d8">contents</a></div><div class="ttdeci">const char * contents</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00045">test_func_file.c:45</a></div></div>
<div class="ttc" id="manager_8h_html_a777cde87d12b331902f862ec44641688"><div class="ttname"><a href="../../db/d45/manager_8h.html#a777cde87d12b331902f862ec44641688">ast_manager_build_channel_state_string</a></div><div class="ttdeci">struct ast_str * ast_manager_build_channel_state_string(const struct ast_channel_snapshot *snapshot)</div><div class="ttdoc">Generate the AMI message body from a channel snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d1c/manager__channels_8c_source.html#l00561">manager_channels.c:561</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gac6cf4ef94e11b14625a81ba56f89a183"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gac6cf4ef94e11b14625a81ba56f89a183">ast_multi_channel_blob_get_channel</a></div><div class="ttdeci">struct ast_channel_snapshot * ast_multi_channel_blob_get_channel(struct ast_multi_channel_blob *obj, const char *role)</div><div class="ttdoc">Retrieve a channel snapshot associated with a specific role from a ast_multi_channel_blob. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l00977">stasis_channels.c:977</a></div></div>
<div class="ttc" id="structast__multi__channel__blob_html"><div class="ttname"><a href="../../df/dcb/structast__multi__channel__blob.html">ast_multi_channel_blob</a></div><div class="ttdoc">A multi channel blob data structure for multi_channel_blob stasis messages. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l00811">stasis_channels.c:811</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2473db24e4139565312fa90497c8ad79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2473db24e4139565312fa90497c8ad79">&#9670;&nbsp;</a></span>find_channel_by_group()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int find_channel_by_group </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>&lt; Potential pickup target</p>
<p>&lt; Channel wanting to pickup call</p>
<p>&lt; Candidate channels found. </p>

<p class="definition">Definition at line <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00095">95</a> of file <a class="el" href="../../d9/dbf/pickup_8c_source.html">pickup.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01549">ao2_link</a>, <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00077">ast_can_pickup()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l01074">ast_channel_callgroup()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l01090">ast_channel_named_callgroups()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l01099">ast_channel_named_pickupgroups()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l01082">ast_channel_pickupgroup()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02947">ast_channel_trylock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, and <a class="el" href="../../d4/d28/channel_8c_source.html#l08192">ast_namedgroups_intersect()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00133">ast_pickup_find_by_group()</a>.</p>
<div class="fragment"><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;{</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *target = obj; <span class="comment">/*!&lt; Potential pickup target */</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan = arg;   <span class="comment">/*!&lt; Channel wanting to pickup call */</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;   <span class="keywordflow">if</span> (chan == target) {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;   }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(target);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/dbf/pickup_8c.html#ab8425437dfb158abc67493460a0f6944">ast_can_pickup</a>(target)) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="comment">/* Lock both channels. */</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="keywordflow">while</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a7dc0d696d897c864c6f41a3a1795c82e">ast_channel_trylock</a>(chan)) {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(target);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;         sched_yield();</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(target);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">       * Both callgroup and namedcallgroup pickup variants are</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">       * matched independently.  Checking for named group match is</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">       * done last since it&#39;s a more expensive operation.</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d7b/channel_8h.html#a5812578dedc2371e255eec8503bd50d6">ast_channel_pickupgroup</a>(chan) &amp; <a class="code" href="../../d5/d7b/channel_8h.html#abd38558261afd18f7c08f05b89625313">ast_channel_callgroup</a>(target))</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;         || (<a class="code" href="../../d5/d7b/channel_8h.html#a6cd21b1843ef2c21455fd943549e8781">ast_namedgroups_intersect</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a10e532f033ac9ff6de644b0be25049a0">ast_channel_named_pickupgroups</a>(chan),</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a9ea65331eb2efc6c95d94c6c697f4dee">ast_channel_named_callgroups</a>(target)))) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *candidates = data;<span class="comment">/*!&lt; Candidate channels found. */</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;         <span class="comment">/* This is a candidate to pickup */</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(candidates, target);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(target);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div><div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="channel_8h_html_a9ea65331eb2efc6c95d94c6c697f4dee"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9ea65331eb2efc6c95d94c6c697f4dee">ast_channel_named_callgroups</a></div><div class="ttdeci">struct ast_namedgroups * ast_channel_named_callgroups(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l01090">channel_internal_api.c:1090</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="pickup_8c_html_ab8425437dfb158abc67493460a0f6944"><div class="ttname"><a href="../../d9/dbf/pickup_8c.html#ab8425437dfb158abc67493460a0f6944">ast_can_pickup</a></div><div class="ttdeci">int ast_can_pickup(struct ast_channel *chan)</div><div class="ttdoc">Test if a channel can be picked up. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbf/pickup_8c_source.html#l00077">pickup.c:77</a></div></div>
<div class="ttc" id="channel_8h_html_a6cd21b1843ef2c21455fd943549e8781"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6cd21b1843ef2c21455fd943549e8781">ast_namedgroups_intersect</a></div><div class="ttdeci">int ast_namedgroups_intersect(struct ast_namedgroups *a, struct ast_namedgroups *b)</div><div class="ttdoc">Return TRUE if group a and b contain at least one common groupname. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l08192">channel.c:8192</a></div></div>
<div class="ttc" id="channel_8h_html_a10e532f033ac9ff6de644b0be25049a0"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a10e532f033ac9ff6de644b0be25049a0">ast_channel_named_pickupgroups</a></div><div class="ttdeci">struct ast_namedgroups * ast_channel_named_pickupgroups(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l01099">channel_internal_api.c:1099</a></div></div>
<div class="ttc" id="channel_8h_html_a5812578dedc2371e255eec8503bd50d6"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a5812578dedc2371e255eec8503bd50d6">ast_channel_pickupgroup</a></div><div class="ttdeci">ast_group_t ast_channel_pickupgroup(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l01082">channel_internal_api.c:1082</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="channel_8h_html_a7dc0d696d897c864c6f41a3a1795c82e"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7dc0d696d897c864c6f41a3a1795c82e">ast_channel_trylock</a></div><div class="ttdeci">#define ast_channel_trylock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02947">channel.h:2947</a></div></div>
<div class="ttc" id="channel_8h_html_abd38558261afd18f7c08f05b89625313"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#abd38558261afd18f7c08f05b89625313">ast_channel_callgroup</a></div><div class="ttdeci">ast_group_t ast_channel_callgroup(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l01074">channel_internal_api.c:1074</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa5aca635640dafce83abcf0c5edc697e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5aca635640dafce83abcf0c5edc697e">&#9670;&nbsp;</a></span>pickup_shutdown()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void pickup_shutdown </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00396">396</a> of file <a class="el" href="../../d9/dbf/pickup_8c_source.html">pickup.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type()</a>, and <a class="el" href="../../dd/d79/stasis_8h_source.html#l01523">STASIS_MESSAGE_TYPE_CLEANUP</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00401">ast_pickup_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;{</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a31197e193b1dfd6c122ff6d7c7f6b3fa">STASIS_MESSAGE_TYPE_CLEANUP</a>(<a class="code" href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type</a>);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;}</div><div class="ttc" id="stasis_8h_html_a31197e193b1dfd6c122ff6d7c7f6b3fa"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a31197e193b1dfd6c122ff6d7c7f6b3fa">STASIS_MESSAGE_TYPE_CLEANUP</a></div><div class="ttdeci">#define STASIS_MESSAGE_TYPE_CLEANUP(name)</div><div class="ttdoc">Boiler-plate messaging macro for cleaning up message types. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l01523">stasis.h:1523</a></div></div>
<div class="ttc" id="pickup_8h_html_aee13f6ef760e25f0169c41cbb38fbab4"><div class="ttname"><a href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type</a></div><div class="ttdeci">struct stasis_message_type * ast_call_pickup_type(void)</div><div class="ttdoc">accessor for call pickup message type </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad4727061b89ae2fac9cf4ed6709005b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4727061b89ae2fac9cf4ed6709005b7">&#9670;&nbsp;</a></span>send_call_pickup_stasis_message()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int send_call_pickup_stasis_message </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>picking_up</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a> *&#160;</td>
          <td class="paramname"><em>target</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00278">278</a> of file <a class="el" href="../../d9/dbf/pickup_8c_source.html">pickup.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l01502">ast_channel_topic()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00248">ast_json_null()</a>, <a class="el" href="../../dc/d2b/stasis__channels_8c_source.html#l00956">ast_multi_channel_blob_add_channel()</a>, <a class="el" href="../../dc/d2b/stasis__channels_8c_source.html#l00881">ast_multi_channel_blob_create()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d2/db9/stasis__message_8c_source.html#l00174">stasis_message_create()</a>, and <a class="el" href="../../d0/df4/stasis_8c_source.html#l01511">stasis_publish()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00302">ast_do_pickup()</a>.</p>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;{</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/dcb/structast__multi__channel__blob.html">ast_multi_channel_blob</a> *, pickup_payload, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *, msg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type</a>()) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;   }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;   <span class="keywordflow">if</span> (!(pickup_payload = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gafe90e356833a3ec8ba6020a39d0689b9">ast_multi_channel_blob_create</a>(<a class="code" href="../../d4/d05/json_8h.html#a8055cb3a9f4d7d5842826e6157ae00db">ast_json_null</a>()))) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;   }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga9a3ff91f86f5f2e7e60571246c8e5873">ast_multi_channel_blob_add_channel</a>(pickup_payload, <span class="stringliteral">&quot;channel&quot;</span>, chan);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga9a3ff91f86f5f2e7e60571246c8e5873">ast_multi_channel_blob_add_channel</a>(pickup_payload, <span class="stringliteral">&quot;target&quot;</span>, target);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;   <span class="keywordflow">if</span> (!(msg = <a class="code" href="../../dd/d79/stasis_8h.html#a72a06fdaec039fdfb5f36892e725f9ec">stasis_message_create</a>(<a class="code" href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type</a>(), pickup_payload))) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;   }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a>(<a class="code" href="../../d5/d7b/channel_8h.html#afdeaf9abb1aecc715313a4f62c1cf9c9">ast_channel_topic</a>(picking_up), msg);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div><div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="json_8h_html_a8055cb3a9f4d7d5842826e6157ae00db"><div class="ttname"><a href="../../d4/d05/json_8h.html#a8055cb3a9f4d7d5842826e6157ae00db">ast_json_null</a></div><div class="ttdeci">struct ast_json * ast_json_null(void)</div><div class="ttdoc">Get the JSON null value. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00248">json.c:248</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga9a3ff91f86f5f2e7e60571246c8e5873"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga9a3ff91f86f5f2e7e60571246c8e5873">ast_multi_channel_blob_add_channel</a></div><div class="ttdeci">void ast_multi_channel_blob_add_channel(struct ast_multi_channel_blob *obj, const char *role, struct ast_channel_snapshot *snapshot)</div><div class="ttdoc">Add a ast_channel_snapshot to a ast_multi_channel_blob object. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l00956">stasis_channels.c:956</a></div></div>
<div class="ttc" id="channel_8h_html_afdeaf9abb1aecc715313a4f62c1cf9c9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#afdeaf9abb1aecc715313a4f62c1cf9c9">ast_channel_topic</a></div><div class="ttdeci">struct stasis_topic * ast_channel_topic(struct ast_channel *chan)</div><div class="ttdoc">A topic which publishes the events for a particular channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l01502">channel_internal_api.c:1502</a></div></div>
<div class="ttc" id="pickup_8h_html_aee13f6ef760e25f0169c41cbb38fbab4"><div class="ttname"><a href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type</a></div><div class="ttdeci">struct stasis_message_type * ast_call_pickup_type(void)</div><div class="ttdoc">accessor for call pickup message type </div></div>
<div class="ttc" id="stasis_8h_html_a72a06fdaec039fdfb5f36892e725f9ec"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a72a06fdaec039fdfb5f36892e725f9ec">stasis_message_create</a></div><div class="ttdeci">struct stasis_message * stasis_message_create(struct stasis_message_type *type, void *data)</div><div class="ttdoc">Create a new message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00174">stasis_message.c:174</a></div></div>
<div class="ttc" id="stasis_8h_html_ac43d0a33d111e9f34b441b285c166cfc"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a></div><div class="ttdeci">void stasis_publish(struct stasis_topic *topic, struct stasis_message *message)</div><div class="ttdoc">Publish a message to a topic&amp;#39;s subscribers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01511">stasis.c:1511</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structast__multi__channel__blob_html"><div class="ttname"><a href="../../df/dcb/structast__multi__channel__blob.html">ast_multi_channel_blob</a></div><div class="ttdoc">A multi channel blob data structure for multi_channel_blob stasis messages. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l00811">stasis_channels.c:811</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gafe90e356833a3ec8ba6020a39d0689b9"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gafe90e356833a3ec8ba6020a39d0689b9">ast_multi_channel_blob_create</a></div><div class="ttdeci">struct ast_multi_channel_blob * ast_multi_channel_blob_create(struct ast_json *blob)</div><div class="ttdoc">Create a ast_multi_channel_blob suitable for a stasis_message. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l00881">stasis_channels.c:881</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a028c751c5889944f975f70233159a4e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a028c751c5889944f975f70233159a4e4">&#9670;&nbsp;</a></span>STASIS_MESSAGE_TYPE_DEFN()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STASIS_MESSAGE_TYPE_DEFN </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/dbc/pickup_8h.html#aee13f6ef760e25f0169c41cbb38fbab4">ast_call_pickup_type</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&#160;</td>
          <td class="paramname"><em>to_ami</em> = <code><a class="el" href="../../d9/dbf/pickup_8c.html#adff86eccdca70e67e66468e6682074ce">call_pickup_to_ami</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a42d2cca4342fa5ac6f73880b9d33528b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42d2cca4342fa5ac6f73880b9d33528b">&#9670;&nbsp;</a></span>pickup_active</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a> pickup_active</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .type = <span class="stringliteral">&quot;pickup-active&quot;</span>,</div><div class="line">}</div></div><!-- fragment --><p>The presence of this datastore on the channel indicates that someone is attemting to pickup or has picked up the channel. The purpose is to prevent a race between two channels attempting to pickup the same channel. </p>

<p class="definition">Definition at line <a class="el" href="../../d9/dbf/pickup_8c_source.html#l00073">73</a> of file <a class="el" href="../../d9/dbf/pickup_8c_source.html">pickup.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:15 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
