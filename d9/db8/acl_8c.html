<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: acl.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">acl.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Various sorts of access control.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d9/d94/network_8h_source.html">asterisk/network.h</a>&quot;</code><br />
<code>#include &lt;ifaddrs.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d59/acl_8h_source.html">asterisk/acl.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d7b/channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d60/utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dd/d42/lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d60/srv_8h_source.html">asterisk/srv.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dc/db0/cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for acl.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../d5/dab/acl_8c__incl.png" border="0" usemap="#acl_8c" alt=""/></div>
<map name="acl_8c" id="acl_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="2973,229,3057,256"/>
<area shape="rect" id="node12" href="../../d9/d94/network_8h.html" title="Wrapper for network related headers, masking differences between various operating systems..." alt="" coords="588,304,727,331"/>
<area shape="rect" id="node23" href="../../d5/d59/acl_8h.html" title="Access Control of various sorts. " alt="" coords="705,155,812,181"/>
<area shape="rect" id="node25" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="2133,528,2246,555"/>
<area shape="rect" id="node31" href="../../d5/d7b/channel_8h.html" title="General Asterisk PBX channel definitions. " alt="" coords="1949,80,2088,107"/>
<area shape="rect" id="node33" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="1328,229,1443,256"/>
<area shape="rect" id="node49" href="../../d5/d60/srv_8h.html" title="Support for DNS SRV records, used in to locate SIP services. " alt="" coords="3093,80,3200,107"/>
<area shape="rect" id="node50" href="../../dc/db0/cli_8h.html" title="Standard Command Line Interface. " alt="" coords="1911,229,2012,256"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="2788,304,2943,331"/>
<area shape="rect" id="node5" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="2367,453,2505,480"/>
<area shape="rect" id="node11" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="2967,304,3102,331"/>
<area shape="rect" id="node4" href="../../dc/dba/buildopts_8h.html" title="asterisk/buildopts.h" alt="" coords="2792,379,2939,405"/>
<area shape="rect" id="node6" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="2341,603,2483,629"/>
<area shape="rect" id="node24" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="2123,453,2274,480"/>
<area shape="rect" id="node28" href="../../db/df1/netsock2_8h.html" title="Network socket handling. " alt="" coords="772,304,919,331"/>
<area shape="rect" id="node29" href="../../dc/dac/io_8h.html" title="I/O Management (derived from Cheops&#45;NG) " alt="" coords="796,229,895,256"/>
<area shape="rect" id="node26" href="../../d1/d8c/logger_8h.html" title="Support for logging to various files, console and syslog Configuration in file logger.conf. " alt="" coords="1170,603,1297,629"/>
<area shape="rect" id="node27" href="../../d5/d9d/inline__api_8h.html" title="Inlinable API function macro. " alt="" coords="1388,603,1535,629"/>
<area shape="rect" id="node30" href="../../d4/dfb/poll-compat_8h.html" title="asterisk/poll&#45;compat.h" alt="" coords="943,304,1107,331"/>
<area shape="rect" id="node32" href="../../dc/d4d/alertpipe_8h.html" title="asterisk/alertpipe.h" alt="" coords="1639,155,1783,181"/>
<area shape="rect" id="node34" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="1473,304,1631,331"/>
<area shape="rect" id="node36" href="../../d5/da5/astobj2_8h.html" title="asterisk/astobj2.h" alt="" coords="1653,379,1787,405"/>
<area shape="rect" id="node37" href="../../dc/d14/abstract__jb_8h.html" title="Common implementation&#45;independent jitterbuffer stuff. " alt="" coords="2519,155,2678,181"/>
<area shape="rect" id="node38" href="../../d6/d66/include_2asterisk_2frame_8h.html" title="Asterisk internal frame definitions. " alt="" coords="2434,229,2561,256"/>
<area shape="rect" id="node39" href="../../d9/de7/chanvars_8h.html" title="Channel Variables. " alt="" coords="2212,229,2359,256"/>
<area shape="rect" id="node40" href="../../d3/de6/include_2asterisk_2config_8h.html" title="Configuration File Parser. " alt="" coords="970,155,1097,181"/>
<area shape="rect" id="node41" href="../../dc/d07/cdr_8h.html" title="Call Detail Record API. " alt="" coords="1121,155,1228,181"/>
<area shape="rect" id="node42" href="../../d9/db6/datastore_8h.html" title="Asterisk datastore objects. " alt="" coords="2037,229,2187,256"/>
<area shape="rect" id="node43" href="../../d0/d3c/format__cap_8h.html" title="Format Capabilities API. " alt="" coords="1303,155,1465,181"/>
<area shape="rect" id="node44" href="../../d9/d95/channelstate_8h.html" title="Channel states. " alt="" coords="2895,155,3065,181"/>
<area shape="rect" id="node45" href="../../de/dc8/ccss_8h.html" title="Call Completion Supplementary Services API. " alt="" coords="2754,155,2870,181"/>
<area shape="rect" id="node46" href="../../db/d3c/framehook_8h.html" title="FrameHook Architecture. " alt="" coords="2236,155,2393,181"/>
<area shape="rect" id="node47" href="../../dd/d79/stasis_8h.html" title="Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. " alt="" coords="1489,155,1615,181"/>
<area shape="rect" id="node48" href="../../d4/d61/endpoints_8h.html" title="Endpoint abstractions. " alt="" coords="1807,155,1958,181"/>
<area shape="rect" id="node35" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="1655,304,1785,331"/>
</map>
</div>
</div>
<p><a href="../../d9/db8/acl_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d3f/structdscp__codepoint.html">dscp_codepoint</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a39040b5c973927d7aa035f1c36d63357"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a39040b5c973927d7aa035f1c36d63357">acl_new</a> (struct <a class="el" href="../../d9/dc8/structast__acl.html">ast_acl</a> **pointer, const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr class="separator:a39040b5c973927d7aa035f1c36d63357"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a094d64f22dae05f058a3e08052256fc1"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a094d64f22dae05f058a3e08052256fc1">append_ha_core</a> (const char *sense, const char *stuff, struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *path, int *<a class="el" href="../../da/d7c/utils_2frame_8h.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, int port_flags)</td></tr>
<tr class="separator:a094d64f22dae05f058a3e08052256fc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf71cd7b64f531d2ec068b7680869238"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#aaf71cd7b64f531d2ec068b7680869238">ast_acl_list_is_empty</a> (struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *acl_list)</td></tr>
<tr class="memdesc:aaf71cd7b64f531d2ec068b7680869238"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines if an ACL is empty or if it contains entries.  <a href="#aaf71cd7b64f531d2ec068b7680869238">More...</a><br /></td></tr>
<tr class="separator:aaf71cd7b64f531d2ec068b7680869238"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac75cc3288b76490a9262f4756ac0e334"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#ac75cc3288b76490a9262f4756ac0e334">ast_acl_output</a> (int fd, struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *acl_list, const char *<a class="el" href="../../d6/dc9/res__http__post_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>)</td></tr>
<tr class="memdesc:ac75cc3288b76490a9262f4756ac0e334"><td class="mdescLeft">&#160;</td><td class="mdescRight">output an ACL to the provided fd  <a href="#ac75cc3288b76490a9262f4756ac0e334">More...</a><br /></td></tr>
<tr class="separator:ac75cc3288b76490a9262f4756ac0e334"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b6715d0c234599571cf5e1adddfec33"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a6b6715d0c234599571cf5e1adddfec33">ast_append_acl</a> (const char *sense, const char *stuff, struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> **path, int *<a class="el" href="../../da/d7c/utils_2frame_8h.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, int *named_acl_flag)</td></tr>
<tr class="memdesc:a6b6715d0c234599571cf5e1adddfec33"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a rule to an ACL struct.  <a href="#a6b6715d0c234599571cf5e1adddfec33">More...</a><br /></td></tr>
<tr class="separator:a6b6715d0c234599571cf5e1adddfec33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae839a9c2465be4e9a560dda668a65b9b"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#ae839a9c2465be4e9a560dda668a65b9b">ast_append_ha</a> (const char *sense, const char *stuff, struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *path, int *<a class="el" href="../../da/d7c/utils_2frame_8h.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>)</td></tr>
<tr class="memdesc:ae839a9c2465be4e9a560dda668a65b9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a new rule to a list of HAs.  <a href="#ae839a9c2465be4e9a560dda668a65b9b">More...</a><br /></td></tr>
<tr class="separator:ae839a9c2465be4e9a560dda668a65b9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51035b96ac8c6d49c8b74f99bcafeb3a"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a51035b96ac8c6d49c8b74f99bcafeb3a">ast_append_ha_with_port</a> (const char *sense, const char *stuff, struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *path, int *<a class="el" href="../../da/d7c/utils_2frame_8h.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>)</td></tr>
<tr class="memdesc:a51035b96ac8c6d49c8b74f99bcafeb3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a new rule with optional port to a list of HAs.  <a href="#a51035b96ac8c6d49c8b74f99bcafeb3a">More...</a><br /></td></tr>
<tr class="separator:a51035b96ac8c6d49c8b74f99bcafeb3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f0c6ca57c26cab3141b15c4b231188b"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445">ast_acl_sense</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a3f0c6ca57c26cab3141b15c4b231188b">ast_apply_acl</a> (struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *acl_list, const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *addr, const char *purpose)</td></tr>
<tr class="memdesc:a3f0c6ca57c26cab3141b15c4b231188b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply a set of rules to a given IP address.  <a href="#a3f0c6ca57c26cab3141b15c4b231188b">More...</a><br /></td></tr>
<tr class="separator:a3f0c6ca57c26cab3141b15c4b231188b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae800474d82b6402adb1fd82042a9e620"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445">ast_acl_sense</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#ae800474d82b6402adb1fd82042a9e620">ast_apply_acl_internal</a> (struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *acl_list, const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *addr, const char *log_prefix)</td></tr>
<tr class="separator:ae800474d82b6402adb1fd82042a9e620"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8752b9c65a8a31102f7155f99451ca53"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445">ast_acl_sense</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a8752b9c65a8a31102f7155f99451ca53">ast_apply_acl_nolog</a> (struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *acl_list, const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *addr)</td></tr>
<tr class="memdesc:a8752b9c65a8a31102f7155f99451ca53"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply a set of rules to a given IP address, don't log failure.  <a href="#a8752b9c65a8a31102f7155f99451ca53">More...</a><br /></td></tr>
<tr class="separator:a8752b9c65a8a31102f7155f99451ca53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5049380ffb26d76d2f236d886964aac"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445">ast_acl_sense</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#aa5049380ffb26d76d2f236d886964aac">ast_apply_ha</a> (const struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *ha, const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *addr)</td></tr>
<tr class="memdesc:aa5049380ffb26d76d2f236d886964aac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply a set of rules to a given IP address.  <a href="#aa5049380ffb26d76d2f236d886964aac">More...</a><br /></td></tr>
<tr class="separator:aa5049380ffb26d76d2f236d886964aac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61f6f79316a8f64be7bdac1a41183047"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a61f6f79316a8f64be7bdac1a41183047">ast_copy_ha</a> (const struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *from, struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *to)</td></tr>
<tr class="memdesc:a61f6f79316a8f64be7bdac1a41183047"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy the contents of one HA to another.  <a href="#a61f6f79316a8f64be7bdac1a41183047">More...</a><br /></td></tr>
<tr class="separator:a61f6f79316a8f64be7bdac1a41183047"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb7002144ebb738da0c7cd826dd89b7f"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#acb7002144ebb738da0c7cd826dd89b7f">ast_duplicate_acl_list</a> (struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *original)</td></tr>
<tr class="memdesc:acb7002144ebb738da0c7cd826dd89b7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Duplicates the contests of a list of lists of host access rules.  <a href="#acb7002144ebb738da0c7cd826dd89b7f">More...</a><br /></td></tr>
<tr class="separator:acb7002144ebb738da0c7cd826dd89b7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d97cef1d0fcd04f8597a70bb315e216"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a6d97cef1d0fcd04f8597a70bb315e216">ast_duplicate_ha</a> (struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *original)</td></tr>
<tr class="separator:a6d97cef1d0fcd04f8597a70bb315e216"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbe043434fef41fa18acb4062960b578"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#abbe043434fef41fa18acb4062960b578">ast_duplicate_ha_list</a> (struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *original)</td></tr>
<tr class="memdesc:abbe043434fef41fa18acb4062960b578"><td class="mdescLeft">&#160;</td><td class="mdescRight">Duplicate the contents of a list of host access rules.  <a href="#abbe043434fef41fa18acb4062960b578">More...</a><br /></td></tr>
<tr class="separator:abbe043434fef41fa18acb4062960b578"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74a637419bacba1233890081dd2f0495"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a74a637419bacba1233890081dd2f0495">ast_find_ourip</a> (struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *ourip, const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *<a class="el" href="../../d5/d87/globals_8h.html#a80ca8badd36b5edc83592e8f017817a4">bindaddr</a>, int family)</td></tr>
<tr class="memdesc:a74a637419bacba1233890081dd2f0495"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find our IP address.  <a href="#a74a637419bacba1233890081dd2f0495">More...</a><br /></td></tr>
<tr class="separator:a74a637419bacba1233890081dd2f0495"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e76cd4becf7d678916af2ebcebd9e74"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a1e76cd4becf7d678916af2ebcebd9e74">ast_free_acl_list</a> (struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *acl_list)</td></tr>
<tr class="memdesc:a1e76cd4becf7d678916af2ebcebd9e74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a list of ACLs.  <a href="#a1e76cd4becf7d678916af2ebcebd9e74">More...</a><br /></td></tr>
<tr class="separator:a1e76cd4becf7d678916af2ebcebd9e74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45dc427430b544afc0ef8e898b2c57bf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a> (struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *ha)</td></tr>
<tr class="memdesc:a45dc427430b544afc0ef8e898b2c57bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a list of HAs.  <a href="#a45dc427430b544afc0ef8e898b2c57bf">More...</a><br /></td></tr>
<tr class="separator:a45dc427430b544afc0ef8e898b2c57bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79fc6597452f2ed6fb136cb2149a6e2c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a79fc6597452f2ed6fb136cb2149a6e2c">ast_get_ip</a> (struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *addr, const char *<a class="el" href="../../d1/d22/logger_8c.html#af31254e3111773fe1dc68e8dc13df2fe">hostname</a>)</td></tr>
<tr class="memdesc:a79fc6597452f2ed6fb136cb2149a6e2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the IP address given a hostname.  <a href="#a79fc6597452f2ed6fb136cb2149a6e2c">More...</a><br /></td></tr>
<tr class="separator:a79fc6597452f2ed6fb136cb2149a6e2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af92139f78c6e53ff418d9289d3a4c4b2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#af92139f78c6e53ff418d9289d3a4c4b2">ast_get_ip_or_srv</a> (struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *addr, const char *<a class="el" href="../../d1/d22/logger_8c.html#af31254e3111773fe1dc68e8dc13df2fe">hostname</a>, const char *<a class="el" href="../../d3/d5a/ccss_8c.html#a495cc24c1947d49a2b6de488a45c9d72">service</a>)</td></tr>
<tr class="memdesc:af92139f78c6e53ff418d9289d3a4c4b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the IP address given a hostname and optional service.  <a href="#af92139f78c6e53ff418d9289d3a4c4b2">More...</a><br /></td></tr>
<tr class="separator:af92139f78c6e53ff418d9289d3a4c4b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0feaf7768724fec1291b6d716189489"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#ab0feaf7768724fec1291b6d716189489">ast_ha_join</a> (const struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *ha, struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="el" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>)</td></tr>
<tr class="memdesc:ab0feaf7768724fec1291b6d716189489"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert HAs to a comma separated string value.  <a href="#ab0feaf7768724fec1291b6d716189489">More...</a><br /></td></tr>
<tr class="separator:ab0feaf7768724fec1291b6d716189489"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0a935ce580773973e0e6a307d5fd7f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#af0a935ce580773973e0e6a307d5fd7f8">ast_ha_join_cidr</a> (const struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *ha, struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="el" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>)</td></tr>
<tr class="memdesc:af0a935ce580773973e0e6a307d5fd7f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert HAs to a comma separated string value using CIDR notation.  <a href="#af0a935ce580773973e0e6a307d5fd7f8">More...</a><br /></td></tr>
<tr class="separator:af0a935ce580773973e0e6a307d5fd7f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a334dacaa1821d4eb0b12828a38a623"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a5a334dacaa1821d4eb0b12828a38a623">ast_ha_output</a> (int fd, const struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *ha, const char *<a class="el" href="../../d6/dc9/res__http__post_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>)</td></tr>
<tr class="memdesc:a5a334dacaa1821d4eb0b12828a38a623"><td class="mdescLeft">&#160;</td><td class="mdescRight">output an HA to the provided fd  <a href="#a5a334dacaa1821d4eb0b12828a38a623">More...</a><br /></td></tr>
<tr class="separator:a5a334dacaa1821d4eb0b12828a38a623"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a652b53325b914138d49526f69f6dd546"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a652b53325b914138d49526f69f6dd546">ast_ouraddrfor</a> (const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *them, struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *us)</td></tr>
<tr class="memdesc:a652b53325b914138d49526f69f6dd546"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get our local IP address when contacting a remote host.  <a href="#a652b53325b914138d49526f69f6dd546">More...</a><br /></td></tr>
<tr class="separator:a652b53325b914138d49526f69f6dd546"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad364a9241e15fc0dbec0ffcb88f64671"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#ad364a9241e15fc0dbec0ffcb88f64671">ast_str2cos</a> (const char *<a class="el" href="../../d5/dde/test__func__file_8c.html#a8556878012feffc9e0beb86cd78f424d">value</a>, unsigned int *<a class="el" href="../../d1/d6d/chan__unistim_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>)</td></tr>
<tr class="memdesc:ad364a9241e15fc0dbec0ffcb88f64671"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a string to the appropriate COS value.  <a href="#ad364a9241e15fc0dbec0ffcb88f64671">More...</a><br /></td></tr>
<tr class="separator:ad364a9241e15fc0dbec0ffcb88f64671"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49d1eefe77636e2a63ad013afa0fc3b5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a49d1eefe77636e2a63ad013afa0fc3b5">ast_str2tos</a> (const char *<a class="el" href="../../d5/dde/test__func__file_8c.html#a8556878012feffc9e0beb86cd78f424d">value</a>, unsigned int *<a class="el" href="../../d1/dc0/pbx__dundi_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>)</td></tr>
<tr class="memdesc:a49d1eefe77636e2a63ad013afa0fc3b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a string to the appropriate TOS value.  <a href="#a49d1eefe77636e2a63ad013afa0fc3b5">More...</a><br /></td></tr>
<tr class="separator:a49d1eefe77636e2a63ad013afa0fc3b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18813aaabb1644f4083746b798a351a0"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a18813aaabb1644f4083746b798a351a0">ast_tos2str</a> (unsigned int <a class="el" href="../../d1/dc0/pbx__dundi_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>)</td></tr>
<tr class="memdesc:a18813aaabb1644f4083746b798a351a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a TOS value into its string representation.  <a href="#a18813aaabb1644f4083746b798a351a0">More...</a><br /></td></tr>
<tr class="separator:a18813aaabb1644f4083746b798a351a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a123afe636344384d23d4880c3a458b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a9a123afe636344384d23d4880c3a458b">debug_ha_sense_appended</a> (struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *ha)</td></tr>
<tr class="separator:a9a123afe636344384d23d4880c3a458b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a911ef115f34a20ae7475d0037265996f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a911ef115f34a20ae7475d0037265996f">get_local_address</a> (struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *ourip)</td></tr>
<tr class="separator:a911ef115f34a20ae7475d0037265996f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55e08be7e4878f9e4ea936ad6c6f43d9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a55e08be7e4878f9e4ea936ad6c6f43d9">parse_cidr_mask</a> (struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *addr, int is_v4, const char *mask_str)</td></tr>
<tr class="memdesc:a55e08be7e4878f9e4ea936ad6c6f43d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse a netmask in CIDR notation.  <a href="#a55e08be7e4878f9e4ea936ad6c6f43d9">More...</a><br /></td></tr>
<tr class="separator:a55e08be7e4878f9e4ea936ad6c6f43d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7921b536db25aa8dd3fe67dbeda2ee2a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a7921b536db25aa8dd3fe67dbeda2ee2a">resolve_first</a> (struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *addr, const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, int <a class="el" href="../../dc/dc2/f2c_8h.html#abf5d144da384425ae6cb542ce6eec8d3">flag</a>, int family)</td></tr>
<tr class="separator:a7921b536db25aa8dd3fe67dbeda2ee2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa99f86aca9edb530c0e6e1c3653f1557"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#aa99f86aca9edb530c0e6e1c3653f1557">score_address</a> (const struct sockaddr_in *sin, struct in_addr *best_addr, int *best_score)</td></tr>
<tr class="separator:aa99f86aca9edb530c0e6e1c3653f1557"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a019ca3744d6db4c4c8ecef752fc84a89"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="../../de/d3f/structdscp__codepoint.html">dscp_codepoint</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/db8/acl_8c.html#a019ca3744d6db4c4c8ecef752fc84a89">dscp_pool1</a> []</td></tr>
<tr class="separator:a019ca3744d6db4c4c8ecef752fc84a89"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Various sorts of access control. </p>
<dl class="section author"><dt>Author</dt><dd>Mark Spencer <a href="#" onclick="location.href='mai'+'lto:'+'mar'+'ks'+'ter'+'@d'+'igi'+'um'+'.co'+'m'; return false;">marks<span style="display: none;">.nosp@m.</span>ter@<span style="display: none;">.nosp@m.</span>digiu<span style="display: none;">.nosp@m.</span>m.co<span style="display: none;">.nosp@m.</span>m</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a39040b5c973927d7aa035f1c36d63357"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39040b5c973927d7aa035f1c36d63357">&#9670;&nbsp;</a></span>acl_new()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int acl_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d9/dc8/structast__acl.html">ast_acl</a> **&#160;</td>
          <td class="paramname"><em>pointer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00305">305</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00068">ast_acl::acl</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00059">ACL_NAME_LENGTH</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00401">ast_copy_string()</a>, and <a class="el" href="../../d5/d59/acl_8h_source.html#l00071">ast_acl::name</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l00430">ast_append_acl()</a>, and <a class="el" href="../../d9/db8/acl_8c_source.html#l00316">ast_duplicate_acl_list()</a>.</p>
<div class="fragment"><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                                                               {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dc8/structast__acl.html">ast_acl</a> *<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;   <span class="keywordflow">if</span> (!(acl = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*acl)))) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;   *pointer = <a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">name</a>, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <a class="code" href="../../d5/d59/acl_8h.html#ac58220e59857e6fe9378b0d39a2c9f12">ACL_NAME_LENGTH</a>);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div><div class="ttc" id="structast__acl_html_aa1fb007be85f6cba1ea263ec6f993c1b"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">ast_acl::name</a></div><div class="ttdeci">char name[ACL_NAME_LENGTH]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00071">acl.h:71</a></div></div>
<div class="ttc" id="structast__acl_html_a13e2a890da2a7cfbc9ea20724e7a61b7"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">ast_acl::acl</a></div><div class="ttdeci">struct ast_ha * acl</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00068">acl.h:68</a></div></div>
<div class="ttc" id="structast__acl_html"><div class="ttname"><a href="../../d9/dc8/structast__acl.html">ast_acl</a></div><div class="ttdoc">an ast_acl is a linked list node of ast_ha structs which may have names. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00067">acl.h:67</a></div></div>
<div class="ttc" id="acl_8h_html_ac58220e59857e6fe9378b0d39a2c9f12"><div class="ttname"><a href="../../d5/d59/acl_8h.html#ac58220e59857e6fe9378b0d39a2c9f12">ACL_NAME_LENGTH</a></div><div class="ttdeci">#define ACL_NAME_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00059">acl.h:59</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a094d64f22dae05f058a3e08052256fc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a094d64f22dae05f058a3e08052256fc1">&#9670;&nbsp;</a></span>append_ha_core()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a>* append_ha_core </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sense</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>stuff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>error</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port_flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00576">576</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00053">ast_ha::addr</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00222">ast_free_ha()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00038">AST_SENSE_ALLOW</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00037">AST_SENSE_DENY</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00357">ast_sockaddr_apply_netmask()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00037">ast_sockaddr_ipv4_mapped()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00497">ast_sockaddr_is_ipv4()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00230">ast_sockaddr_parse()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00521">ast_sockaddr_port</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00537">ast_sockaddr_set_port</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00260">ast_sockaddr_stringify()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00300">ast_strdupa</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00441">DEBUG_ATLEAST</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00566">debug_ha_sense_appended()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00263">LOG_NOTICE</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00054">ast_ha::netmask</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00056">ast_ha::next</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00382">parse_cidr_mask()</a>, <a class="el" href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01135">PARSE_PORT_FORBID</a>, <a class="el" href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01132">PARSE_PORT_MASK</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00055">ast_ha::sense</a>, <a class="el" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep()</a>, and <a class="el" href="../../de/d1e/bt__open_8c_source.html#l00389">tmp()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l00713">ast_append_ha()</a>, and <a class="el" href="../../d9/db8/acl_8c_source.html#l00718">ast_append_ha_with_port()</a>.</p>
<div class="fragment"><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;{</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d1d/structast__ha.html">ast_ha</a> *ha;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d1d/structast__ha.html">ast_ha</a> *prev = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d1d/structast__ha.html">ast_ha</a> *ret;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>, *list = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(stuff ?: <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/dc2/f2c_8h.html#a27c1bdb0cba23a9db2a51eed7b3b2ac1">address</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *mask = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   <span class="keywordtype">int</span> addr_is_v4;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;   <span class="keywordtype">int</span> allowing = strncasecmp(<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a>, <span class="stringliteral">&quot;p&quot;</span>, 1) ? <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445abb486b5b819cf3b3951ce0a2e584f065">AST_SENSE_DENY</a> : <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a>;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   ret = path;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;   <span class="keywordflow">while</span> (path) {</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      prev = path;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      path = path-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;   }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   <span class="keywordflow">while</span> ((tmp = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;list, <span class="stringliteral">&quot;,&quot;</span>))) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      uint16_t save_port;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="keywordflow">if</span> (!(ha = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*ha)))) {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>) {</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 1;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;         }</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;         <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      }</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      address = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;tmp, <span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keywordflow">if</span> (!address) {</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;         address = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;         mask = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      }</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="keywordflow">if</span> (*address == <span class="charliteral">&#39;!&#39;</span>) {</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;         ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a> = (allowing == <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445abb486b5b819cf3b3951ce0a2e584f065">AST_SENSE_DENY</a>) ? <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a> : <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445abb486b5b819cf3b3951ce0a2e584f065">AST_SENSE_DENY</a>;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;         address++;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;         ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a> = allowing;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../db/df1/netsock2_8h.html#aad98818272870e12d48fe4347aaa46d0">ast_sockaddr_parse</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>, address, port_flags)) {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid IP address: %s\n&quot;</span>, address);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;         <a class="code" href="../../d9/db8/acl_8c.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a>(ha);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>) {</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 1;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;         }</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;         <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="comment">/* Be pedantic and zero out the port if we don&#39;t want it */</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">if</span> ((port_flags &amp; <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa5f8a497855d42eba8c324516d21f8998">PARSE_PORT_MASK</a>) == <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3">PARSE_PORT_FORBID</a>) {</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>, 0);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="comment">/* If someone specifies an IPv4-mapped IPv6 address,</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">       * we just convert this to an IPv4 ACL</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a42e610962ef06c151aad8260af428e3d">ast_sockaddr_ipv4_mapped</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>, &amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>)) {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;IPv4-mapped ACL network address specified. &quot;</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <span class="stringliteral">&quot;Converting to an IPv4 ACL network address.\n&quot;</span>);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      addr_is_v4 = <a class="code" href="../../db/df1/netsock2_8h.html#adbbb5a3382be0925c292a4933ce5b63d">ast_sockaddr_is_ipv4</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>);</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="keywordflow">if</span> (!mask) {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;         <a class="code" href="../../d9/db8/acl_8c.html#a55e08be7e4878f9e4ea936ad6c6f43d9">parse_cidr_mask</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>, addr_is_v4, addr_is_v4 ? <span class="stringliteral">&quot;32&quot;</span> : <span class="stringliteral">&quot;128&quot;</span>);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strchr(mask, <span class="charliteral">&#39;:&#39;</span>) || strchr(mask, <span class="charliteral">&#39;.&#39;</span>)) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;         <span class="keywordtype">int</span> mask_is_v4;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;         <span class="comment">/* Mask is of x.x.x.x or x:x:x:x:x:x:x:x variety */</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../db/df1/netsock2_8h.html#aad98818272870e12d48fe4347aaa46d0">ast_sockaddr_parse</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>, mask, <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3">PARSE_PORT_FORBID</a>)) {</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid netmask: %s\n&quot;</span>, mask);</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            <a class="code" href="../../d9/db8/acl_8c.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a>(ha);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>) {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;               *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 1;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            }</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;         }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;         <span class="comment">/* If someone specifies an IPv4-mapped IPv6 netmask,</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">          * we just convert this to an IPv4 ACL</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a42e610962ef06c151aad8260af428e3d">ast_sockaddr_ipv4_mapped</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>, &amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>)) {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;IPv4-mapped ACL netmask specified. &quot;</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;               <span class="stringliteral">&quot;Converting to an IPv4 ACL netmask.\n&quot;</span>);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;         }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;         mask_is_v4 = <a class="code" href="../../db/df1/netsock2_8h.html#adbbb5a3382be0925c292a4933ce5b63d">ast_sockaddr_is_ipv4</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;         <span class="keywordflow">if</span> (addr_is_v4 ^ mask_is_v4) {</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Address and mask are not using same address scheme.\n&quot;</span>);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            <a class="code" href="../../d9/db8/acl_8c.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a>(ha);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;               *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 1;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            }</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;         }</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d9/db8/acl_8c.html#a55e08be7e4878f9e4ea936ad6c6f43d9">parse_cidr_mask</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>, addr_is_v4, mask)) {</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid CIDR netmask: %s\n&quot;</span>, mask);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;         <a class="code" href="../../d9/db8/acl_8c.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a>(ha);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>) {</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 1;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;         }</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;         <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      }</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="comment">/* ast_sockaddr_apply_netmask() does not preserve the port, so we need to save and</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">       * restore it */</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      save_port = <a class="code" href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a5d6080466e41d97c3b02c043b19039ab">ast_sockaddr_apply_netmask</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>, &amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>, &amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>)) {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;         <span class="comment">/* This shouldn&#39;t happen because ast_sockaddr_parse would</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">          * have failed much earlier on an unsupported address scheme</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;         <span class="keywordtype">char</span> *failmask = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>));</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;         <span class="keywordtype">char</span> *failaddr = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>));</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to apply netmask %s to address %s\n&quot;</span>, failmask, failaddr);</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;         <a class="code" href="../../d9/db8/acl_8c.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a>(ha);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>) {</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 1;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;         }</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;         <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <a class="code" href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>, save_port);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="keywordflow">if</span> (prev) {</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;         prev-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a> = ha;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;         ret = ha;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      prev = ha;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8c/logger_8h.html#a33f6031de4ab6d1406465a7a3ee18e86">DEBUG_ATLEAST</a>(3)) {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;         <a class="code" href="../../d9/db8/acl_8c.html#a9a123afe636344384d23d4880c3a458b">debug_ha_sense_appended</a>(ha);</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;   }</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;}</div><div class="ttc" id="structast__ha_html_a904bbec16face4bc9d13a8e8c7fbf764"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">ast_ha::next</a></div><div class="ttdeci">struct ast_ha * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00056">acl.h:56</a></div></div>
<div class="ttc" id="netsock2_8h_html_aad98818272870e12d48fe4347aaa46d0"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aad98818272870e12d48fe4347aaa46d0">ast_sockaddr_parse</a></div><div class="ttdeci">int ast_sockaddr_parse(struct ast_sockaddr *addr, const char *str, int flags)</div><div class="ttdoc">Parse an IPv4 or IPv6 address string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00230">netsock2.c:230</a></div></div>
<div class="ttc" id="structast__ha_html_a10838452c09fae7f0e3de86581d85379"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">ast_ha::addr</a></div><div class="ttdeci">struct ast_sockaddr addr</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00053">acl.h:53</a></div></div>
<div class="ttc" id="f2c_8h_html_a27c1bdb0cba23a9db2a51eed7b3b2ac1"><div class="ttname"><a href="../../dc/dc2/f2c_8h.html#a27c1bdb0cba23a9db2a51eed7b3b2ac1">address</a></div><div class="ttdeci">char * address</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dc2/f2c_8h_source.html#l00059">f2c.h:59</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="netsock2_8h_html_a42e610962ef06c151aad8260af428e3d"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a42e610962ef06c151aad8260af428e3d">ast_sockaddr_ipv4_mapped</a></div><div class="ttdeci">int ast_sockaddr_ipv4_mapped(const struct ast_sockaddr *addr, struct ast_sockaddr *ast_mapped)</div><div class="ttdoc">Convert an IPv4-mapped IPv6 address into an IPv4 address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00037">netsock2.c:37</a></div></div>
<div class="ttc" id="bt__open_8c_html_a1cdd2bb1a9a71d3e1120100229315d67"><div class="ttname"><a href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a></div><div class="ttdeci">static int tmp()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1e/bt__open_8c_source.html#l00389">bt_open.c:389</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_ad60d9d8c34b4f61493c1d85ae02d569fa5f8a497855d42eba8c324516d21f8998"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa5f8a497855d42eba8c324516d21f8998">PARSE_PORT_MASK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01132">include/asterisk/config.h:1132</a></div></div>
<div class="ttc" id="structast__ha_html_ac35e9125db2f5dd5dbc917f4385d03f6"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">ast_ha::sense</a></div><div class="ttdeci">enum ast_acl_sense sense</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00055">acl.h:55</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3">PARSE_PORT_FORBID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01135">include/asterisk/config.h:1135</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="acl_8c_html_a55e08be7e4878f9e4ea936ad6c6f43d9"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a55e08be7e4878f9e4ea936ad6c6f43d9">parse_cidr_mask</a></div><div class="ttdeci">static int parse_cidr_mask(struct ast_sockaddr *addr, int is_v4, const char *mask_str)</div><div class="ttdoc">Parse a netmask in CIDR notation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00382">acl.c:382</a></div></div>
<div class="ttc" id="acl_8c_html_a45dc427430b544afc0ef8e898b2c57bf"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a></div><div class="ttdeci">void ast_free_ha(struct ast_ha *ha)</div><div class="ttdoc">Free a list of HAs. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00222">acl.c:222</a></div></div>
<div class="ttc" id="netsock2_8h_html_a51e2841175bf3ad58a4e11ad9fb2453f"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a></div><div class="ttdeci">#define ast_sockaddr_port(addr)</div><div class="ttdoc">Get the port number of a socket address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00521">netsock2.h:521</a></div></div>
<div class="ttc" id="structast__ha_html"><div class="ttname"><a href="../../dc/d1d/structast__ha.html">ast_ha</a></div><div class="ttdoc">internal representation of ACL entries In principle user applications would have no need for this...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00051">acl.h:51</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__ha_html_a1a9ebad90d33f306c2b7f72174812c09"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">ast_ha::netmask</a></div><div class="ttdeci">struct ast_sockaddr netmask</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00054">acl.h:54</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="netsock2_8h_html_a5d6080466e41d97c3b02c043b19039ab"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a5d6080466e41d97c3b02c043b19039ab">ast_sockaddr_apply_netmask</a></div><div class="ttdeci">int ast_sockaddr_apply_netmask(const struct ast_sockaddr *addr, const struct ast_sockaddr *netmask, struct ast_sockaddr *result)</div><div class="ttdoc">Apply a netmask to an address and store the result in a separate structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00357">netsock2.c:357</a></div></div>
<div class="ttc" id="netsock2_8h_html_ac83e6bdec376b74d02da8d2f8e1af888"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a></div><div class="ttdeci">#define ast_sockaddr_set_port(addr, port)</div><div class="ttdoc">Sets the port number of a socket address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00537">netsock2.h:537</a></div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
<div class="ttc" id="logger_8h_html_ad89ee324d180cdcd7defcc709ff9ca42"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a></div><div class="ttdeci">#define LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00263">logger.h:263</a></div></div>
<div class="ttc" id="acl_8h_html_a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2"><div class="ttname"><a href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00038">acl.h:38</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="netsock2_8h_html_adbbb5a3382be0925c292a4933ce5b63d"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#adbbb5a3382be0925c292a4933ce5b63d">ast_sockaddr_is_ipv4</a></div><div class="ttdeci">int ast_sockaddr_is_ipv4(const struct ast_sockaddr *addr)</div><div class="ttdoc">Determine if the address is an IPv4 address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00497">netsock2.c:497</a></div></div>
<div class="ttc" id="acl_8h_html_a764d04fe9485be95771e652dc2c87445abb486b5b819cf3b3951ce0a2e584f065"><div class="ttname"><a href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445abb486b5b819cf3b3951ce0a2e584f065">AST_SENSE_DENY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00037">acl.h:37</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
<div class="ttc" id="acl_8c_html_a9a123afe636344384d23d4880c3a458b"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a9a123afe636344384d23d4880c3a458b">debug_ha_sense_appended</a></div><div class="ttdeci">static void debug_ha_sense_appended(struct ast_ha *ha)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00566">acl.c:566</a></div></div>
<div class="ttc" id="logger_8h_html_a33f6031de4ab6d1406465a7a3ee18e86"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a33f6031de4ab6d1406465a7a3ee18e86">DEBUG_ATLEAST</a></div><div class="ttdeci">#define DEBUG_ATLEAST(level)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00441">logger.h:441</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aaf71cd7b64f531d2ec068b7680869238"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf71cd7b64f531d2ec068b7680869238">&#9670;&nbsp;</a></span>ast_acl_list_is_empty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_acl_list_is_empty </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *&#160;</td>
          <td class="paramname"><em>acl_list</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Determines if an ACL is empty or if it contains entries. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">acl_list</td><td>The ACL list being checked </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>- the list is not empty </td></tr>
    <tr><td class="paramname">1</td><td>- the list is empty </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00541">541</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, and <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l21181">_sip_show_peer()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l20404">_sip_show_peers_one()</a>, <a class="el" href="../../dc/df6/pjsip__configuration_8c_source.html#l00104">acl_to_str()</a>, <a class="el" href="../../d5/d5e/res__pjsip__acl_8c_source.html#l00121">apply_acl()</a>, <a class="el" href="../../d5/d5e/res__pjsip__acl_8c_source.html#l00158">apply_contact_acl()</a>, <a class="el" href="../../d7/dad/pjsip__distributor_8c_source.html#l00807">apply_endpoint_acl()</a>, <a class="el" href="../../d7/dad/pjsip__distributor_8c_source.html#l00845">apply_endpoint_contact_acl()</a>, <a class="el" href="../../dc/df6/pjsip__configuration_8c_source.html#l00125">contact_acl_to_str()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l03815">handle_cli_iax2_show_peer()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l06757">handle_cli_iax2_show_users()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l02497">handle_showmanager()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l21509">sip_show_user()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l20107">sip_show_users()</a>.</p>
<div class="fragment"><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;{</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dc8/structast__acl.html">ast_acl</a> *head;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;   <span class="keywordflow">if</span> (!acl_list) {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;   }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(acl_list);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;   head = <a class="code" href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a>(acl_list);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(acl_list);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;   <span class="keywordflow">if</span> (head) {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;}</div><div class="ttc" id="linkedlists_8h_html_a9140a4e4d781264fa9469c52b1adae40"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a></div><div class="ttdeci">#define AST_LIST_LOCK(head)</div><div class="ttdoc">Locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00039">linkedlists.h:39</a></div></div>
<div class="ttc" id="linkedlists_8h_html_adf1959c5c03a3a706da97ad2f49617e5"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a></div><div class="ttdeci">#define AST_LIST_FIRST(head)</div><div class="ttdoc">Returns the first entry contained in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00420">linkedlists.h:420</a></div></div>
<div class="ttc" id="linkedlists_8h_html_ab48cb9e1e612dd486b747ba1c5d68d01"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a></div><div class="ttdeci">#define AST_LIST_UNLOCK(head)</div><div class="ttdoc">Attempts to unlock a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00139">linkedlists.h:139</a></div></div>
<div class="ttc" id="structast__acl_html"><div class="ttname"><a href="../../d9/dc8/structast__acl.html">ast_acl</a></div><div class="ttdoc">an ast_acl is a linked list node of ast_ha structs which may have names. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00067">acl.h:67</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac75cc3288b76490a9262f4756ac0e334"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac75cc3288b76490a9262f4756ac0e334">&#9670;&nbsp;</a></span>ast_acl_output()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_acl_output </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *&#160;</td>
          <td class="paramname"><em>acl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>prefix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>output an ACL to the provided fd </p>
<p>This function can be used centrally to output HAs as used in ACLs from other modules. It follows the format as originally used for named ACLs in named_acl.c.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>The file-descriptor to which to output the ACL. </td></tr>
    <tr><td class="paramname">acl</td><td>The ACL to output. </td></tr>
    <tr><td class="paramname">prefix</td><td>If you need a specific prefix output on each line, give it here, may be NULL.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.33.0, 16.10.0, 17.4.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l01099">1099</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00068">ast_acl::acl</a>, <a class="el" href="../../da/d4d/clicompat_8c_source.html#l00006">ast_cli()</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l01087">ast_ha_output()</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00069">ast_acl::is_realtime</a>, <a class="el" href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">ast_acl::list</a>, and <a class="el" href="../../d5/d59/acl_8h_source.html#l00071">ast_acl::name</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d10/manager_8c_source.html#l02497">handle_showmanager()</a>.</p>
<div class="fragment"><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;{</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dc8/structast__acl.html">ast_acl</a> *<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a>;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(acl_list);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(acl_list, acl, <a class="code" href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">list</a>) {</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%sACL: %s%s\n---------------------------------------------\n&quot;</span>,</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;            <a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a> ?: <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">name</a>) ? <span class="stringliteral">&quot;(unnamed)&quot;</span> : acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">name</a>,</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a9e366d6272bc1809424d49054ca30421">is_realtime</a> ? <span class="stringliteral">&quot; (realtime)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <a class="code" href="../../d9/db8/acl_8c.html#a5a334dacaa1821d4eb0b12828a38a623">ast_ha_output</a>(fd, acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a>, <a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>);</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;   }</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(acl_list);</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;}</div><div class="ttc" id="linkedlists_8h_html_a9140a4e4d781264fa9469c52b1adae40"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a></div><div class="ttdeci">#define AST_LIST_LOCK(head)</div><div class="ttdoc">Locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00039">linkedlists.h:39</a></div></div>
<div class="ttc" id="structast__acl_html_ad063b12f30f296c6231d954bd00ef5db"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">ast_acl::list</a></div><div class="ttdeci">struct ast_acl::@218 list</div></div>
<div class="ttc" id="linkedlists_8h_html_ab48cb9e1e612dd486b747ba1c5d68d01"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a></div><div class="ttdeci">#define AST_LIST_UNLOCK(head)</div><div class="ttdoc">Attempts to unlock a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00139">linkedlists.h:139</a></div></div>
<div class="ttc" id="structast__acl_html_aa1fb007be85f6cba1ea263ec6f993c1b"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">ast_acl::name</a></div><div class="ttdeci">char name[ACL_NAME_LENGTH]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00071">acl.h:71</a></div></div>
<div class="ttc" id="cli_8h_html_a791bf9f5637185bee5e8f0907c762130"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a></div><div class="ttdeci">void ast_cli(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00006">clicompat.c:6</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="structast__acl_html_a9e366d6272bc1809424d49054ca30421"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a9e366d6272bc1809424d49054ca30421">ast_acl::is_realtime</a></div><div class="ttdeci">int is_realtime</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00069">acl.h:69</a></div></div>
<div class="ttc" id="structast__acl_html_a13e2a890da2a7cfbc9ea20724e7a61b7"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">ast_acl::acl</a></div><div class="ttdeci">struct ast_ha * acl</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00068">acl.h:68</a></div></div>
<div class="ttc" id="structast__acl_html"><div class="ttname"><a href="../../d9/dc8/structast__acl.html">ast_acl</a></div><div class="ttdoc">an ast_acl is a linked list node of ast_ha structs which may have names. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00067">acl.h:67</a></div></div>
<div class="ttc" id="acl_8c_html_a5a334dacaa1821d4eb0b12828a38a623"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a5a334dacaa1821d4eb0b12828a38a623">ast_ha_output</a></div><div class="ttdeci">void ast_ha_output(int fd, const struct ast_ha *ha, const char *prefix)</div><div class="ttdoc">output an HA to the provided fd </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l01087">acl.c:1087</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a3008b2f4f236b72d8bcfb80e346324ef"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE(head, var, field)</div><div class="ttdoc">Loops over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00490">linkedlists.h:490</a></div></div>
<div class="ttc" id="http_8c_html_a6f25bc812d09fedb86bf394c01061c56"><div class="ttname"><a href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a></div><div class="ttdeci">static char prefix[MAX_PREFIX]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00141">http.c:141</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6b6715d0c234599571cf5e1adddfec33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b6715d0c234599571cf5e1adddfec33">&#9670;&nbsp;</a></span>ast_append_acl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_append_acl </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sense</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>stuff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> **&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>error</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>named_acl_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a rule to an ACL struct. </p>
<p>This adds a named ACL or an ACL rule to an <a class="el" href="../../d9/dc8/structast__acl.html" title="an ast_acl is a linked list node of ast_ha structs which may have names. ">ast_acl</a> container. It works in a similar way to ast_append_ha.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">sense</td><td>Can be any among "permit", "deny", or "acl" this controls whether the rule being added will simply modify the unnamed ACL at the head of the list or if a new named ACL will be added to that <a class="el" href="../../d9/dc8/structast__acl.html" title="an ast_acl is a linked list node of ast_ha structs which may have names. ">ast_acl</a>. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">stuff</td><td>If sense is 'permit'/'deny', this is the ip address and subnet mask separated with a '/' like in ast_append ha. If it sense is 'acl', then this will be the name of the ACL being appended to the container. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">path</td><td>Address of the ACL list being appended </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">error</td><td>The int that error points to will be set to 1 if an error occurs. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">named_acl_flag</td><td>This will raise a flag under certain conditions to indicate that a named ACL has been added by this operation. This may be used to indicate that an event subscription should be made against the named ACL subsystem. Note: This flag may be raised by this function, but it will never be lowered by it. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00430">430</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00068">ast_acl::acl</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00305">acl_new()</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00713">ast_append_ha()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00625">AST_LIST_HEAD_INIT</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00710">AST_LIST_INSERT_HEAD</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00730">AST_LIST_INSERT_TAIL</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../da/ddd/named__acl_8c_source.html#l00293">ast_named_acl_find()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00157">ast_skip_blanks()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00300">ast_strdupa</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00070">ast_acl::is_invalid</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00069">ast_acl::is_realtime</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00071">ast_acl::name</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep()</a>, and <a class="el" href="../../de/d1e/bt__open_8c_source.html#l00389">tmp()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d10/manager_8c_source.html#l09144">__init_manager()</a>, <a class="el" href="../../d5/d5e/res__pjsip__acl_8c_source.html#l00237">acl_handler()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l12794">build_peer()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l13119">build_user()</a>, <a class="el" href="../../dc/df6/pjsip__configuration_8c_source.html#l00087">endpoint_acl_handler()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l32514">reload_config()</a>, and <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l09346">rtp_reload()</a>.</p>
<div class="fragment"><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;{</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dc8/structast__acl.html">ast_acl</a> *<a class="code" href="../../dc/dff/structacl.html">acl</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dc8/structast__acl.html">ast_acl</a> *current;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *working_list;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>, *list;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   <span class="comment">/* If the ACL list is currently uninitialized, it must be initialized. */</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;   <span class="keywordflow">if</span> (*path == <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *list;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      list = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*list));</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="keywordflow">if</span> (!list) {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;         <span class="comment">/* Allocation Error */</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>) {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 1;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;         }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;         <span class="keywordflow">return</span>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca">AST_LIST_HEAD_INIT</a>(list);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      *path = list;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;   working_list = *path;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(working_list);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;   <span class="comment">/* First we need to determine if we will need to add a new ACL node or if we can use an existing one. */</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   <span class="keywordflow">if</span> (strncasecmp(sense, <span class="stringliteral">&quot;a&quot;</span>, 1)) {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="comment">/* The first element in the path should be the unnamed, base ACL. If that&#39;s the case, we use it. If not,</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">       * we have to make one and link it up appropriately. */</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      current = <a class="code" href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a>(working_list);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">if</span> (!current || !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(current-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">name</a>)) {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d9/db8/acl_8c.html#a39040b5c973927d7aa035f1c36d63357">acl_new</a>(&amp;acl, <span class="stringliteral">&quot;&quot;</span>)) {</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;               *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 1;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            }</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(working_list);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;         }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;         <span class="comment">// Need to INSERT the ACL at the head here.</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307">AST_LIST_INSERT_HEAD</a>(working_list, acl, list);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;         <span class="comment">/* If the first element was already the unnamed base ACL, we just use that one. */</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;         acl = current;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      }</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="comment">/* With the proper ACL set for modification, we can just pass this off to the ast_ha append function. */</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a> = <a class="code" href="../../d9/db8/acl_8c.html#ae839a9c2465be4e9a560dda668a65b9b">ast_append_ha</a>(sense, stuff, acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a>, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(working_list);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;   }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;   <span class="comment">/* We are in ACL append mode, so we know we&#39;ll be adding one or more named ACLs. */</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;   list = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(stuff);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <span class="keywordflow">while</span> ((tmp = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;list, <span class="stringliteral">&quot;,&quot;</span>))) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../dc/d1d/structast__ha.html">ast_ha</a> *named_ha;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="keywordtype">int</span> already_included = 0;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="comment">/* Remove leading whitespace from the string in case the user put spaces between items */</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      tmp = <a class="code" href="../../d6/d90/strings_8h.html#af5693da955fa3bc73bc49c47b601fc7a">ast_skip_blanks</a>(tmp);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="comment">/* The first step is to check for a duplicate */</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(working_list, current, list) {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;         <span class="keywordflow">if</span> (!strcasecmp(current-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">name</a>, tmp)) { <span class="comment">/* ACL= */</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="comment">/* Inclusion of the same ACL multiple times isn&#39;t a catastrophic error, but it will raise the error flag and skip the entry. */</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Named ACL &#39;%s&#39; occurs multiple times in ACL definition. &quot;</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                               <span class="stringliteral">&quot;Please update your ACL configuration.\n&quot;</span>, tmp);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>) {</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;               *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 1;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            }</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            already_included = 1;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;         }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      }</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keywordflow">if</span> (already_included) {</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      }</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/db8/acl_8c.html#a39040b5c973927d7aa035f1c36d63357">acl_new</a>(&amp;acl, tmp)) {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;         <span class="comment">/* This is a catastrophic allocation error and we&#39;ll return immediately if this happens. */</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>) {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 1;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;         }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(working_list);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;         <span class="keywordflow">return</span>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      }</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="comment">/* Attempt to grab the Named ACL we are looking for. */</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      named_ha = <a class="code" href="../../d5/d59/acl_8h.html#a8b54608c54333a2715de8b2ba411b762">ast_named_acl_find</a>(tmp, &amp;acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a9e366d6272bc1809424d49054ca30421">is_realtime</a>, &amp;acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a1ed68f61e62003a076d1e131e79c487e">is_invalid</a>);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="comment">/* Set the ACL&#39;s ast_ha to the duplicated named ACL retrieved above. */</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a> = named_ha;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="comment">/* Raise the named_acl_flag since we are adding a named ACL to the ACL container. */</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="keywordflow">if</span> (named_acl_flag) {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;         *named_acl_flag = 1;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="comment">/* Now insert the new ACL at the end of the list. */</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a>(working_list, acl, list);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   }</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(working_list);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;}</div><div class="ttc" id="linkedlists_8h_html_a9140a4e4d781264fa9469c52b1adae40"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a></div><div class="ttdeci">#define AST_LIST_LOCK(head)</div><div class="ttdoc">Locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00039">linkedlists.h:39</a></div></div>
<div class="ttc" id="linkedlists_8h_html_adf1959c5c03a3a706da97ad2f49617e5"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a></div><div class="ttdeci">#define AST_LIST_FIRST(head)</div><div class="ttdoc">Returns the first entry contained in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00420">linkedlists.h:420</a></div></div>
<div class="ttc" id="linkedlists_8h_html_ab48cb9e1e612dd486b747ba1c5d68d01"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a></div><div class="ttdeci">#define AST_LIST_UNLOCK(head)</div><div class="ttdoc">Attempts to unlock a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00139">linkedlists.h:139</a></div></div>
<div class="ttc" id="bt__open_8c_html_a1cdd2bb1a9a71d3e1120100229315d67"><div class="ttname"><a href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a></div><div class="ttdeci">static int tmp()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1e/bt__open_8c_source.html#l00389">bt_open.c:389</a></div></div>
<div class="ttc" id="structast__acl_html_aa1fb007be85f6cba1ea263ec6f993c1b"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">ast_acl::name</a></div><div class="ttdeci">char name[ACL_NAME_LENGTH]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00071">acl.h:71</a></div></div>
<div class="ttc" id="acl_8c_html_ae839a9c2465be4e9a560dda668a65b9b"><div class="ttname"><a href="../../d9/db8/acl_8c.html#ae839a9c2465be4e9a560dda668a65b9b">ast_append_ha</a></div><div class="ttdeci">struct ast_ha * ast_append_ha(const char *sense, const char *stuff, struct ast_ha *path, int *error)</div><div class="ttdoc">Add a new rule to a list of HAs. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00713">acl.c:713</a></div></div>
<div class="ttc" id="structast__acl__list_html"><div class="ttname"><a href="../../d3/da4/structast__acl__list.html">ast_acl_list</a></div><div class="ttdoc">Wrapper for an ast_acl linked list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00076">acl.h:76</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="structast__ha_html"><div class="ttname"><a href="../../dc/d1d/structast__ha.html">ast_ha</a></div><div class="ttdoc">internal representation of ACL entries In principle user applications would have no need for this...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00051">acl.h:51</a></div></div>
<div class="ttc" id="structast__acl_html_a9e366d6272bc1809424d49054ca30421"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a9e366d6272bc1809424d49054ca30421">ast_acl::is_realtime</a></div><div class="ttdeci">int is_realtime</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00069">acl.h:69</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__acl_html_a1ed68f61e62003a076d1e131e79c487e"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a1ed68f61e62003a076d1e131e79c487e">ast_acl::is_invalid</a></div><div class="ttdeci">int is_invalid</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00070">acl.h:70</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="structast__acl_html_a13e2a890da2a7cfbc9ea20724e7a61b7"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">ast_acl::acl</a></div><div class="ttdeci">struct ast_ha * acl</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00068">acl.h:68</a></div></div>
<div class="ttc" id="structast__acl_html"><div class="ttname"><a href="../../d9/dc8/structast__acl.html">ast_acl</a></div><div class="ttdoc">an ast_acl is a linked list node of ast_ha structs which may have names. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00067">acl.h:67</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a4d258b4525e63c435d7de579d3f46960"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a></div><div class="ttdeci">#define AST_LIST_INSERT_TAIL(head, elm, field)</div><div class="ttdoc">Appends a list entry to the tail of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00730">linkedlists.h:730</a></div></div>
<div class="ttc" id="strings_8h_html_af5693da955fa3bc73bc49c47b601fc7a"><div class="ttname"><a href="../../d6/d90/strings_8h.html#af5693da955fa3bc73bc49c47b601fc7a">ast_skip_blanks</a></div><div class="ttdeci">char * ast_skip_blanks(const char *str)</div><div class="ttdoc">Gets a pointer to the first non-whitespace character in a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00157">strings.h:157</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a3008b2f4f236b72d8bcfb80e346324ef"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE(head, var, field)</div><div class="ttdoc">Loops over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00490">linkedlists.h:490</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa2ded2af046bb513f77056c27c083307"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307">AST_LIST_INSERT_HEAD</a></div><div class="ttdeci">#define AST_LIST_INSERT_HEAD(head, elm, field)</div><div class="ttdoc">Inserts a list entry at the head of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00710">linkedlists.h:710</a></div></div>
<div class="ttc" id="structacl_html"><div class="ttname"><a href="../../dc/dff/structacl.html">acl</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dcf/test__acl_8c_source.html#l00111">test_acl.c:111</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a6f42d3bf45cc9af6f794d9d1cf8c45ca"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca">AST_LIST_HEAD_INIT</a></div><div class="ttdeci">#define AST_LIST_HEAD_INIT(head)</div><div class="ttdoc">Initializes a list head structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00625">linkedlists.h:625</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="acl_8h_html_a8b54608c54333a2715de8b2ba411b762"><div class="ttname"><a href="../../d5/d59/acl_8h.html#a8b54608c54333a2715de8b2ba411b762">ast_named_acl_find</a></div><div class="ttdeci">struct ast_ha * ast_named_acl_find(const char *name, int *is_realtime, int *is_undefined)</div><div class="ttdoc">Retrieve a named ACL. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/ddd/named__acl_8c_source.html#l00293">named_acl.c:293</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
<div class="ttc" id="acl_8c_html_a39040b5c973927d7aa035f1c36d63357"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a39040b5c973927d7aa035f1c36d63357">acl_new</a></div><div class="ttdeci">static int acl_new(struct ast_acl **pointer, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00305">acl.c:305</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae839a9c2465be4e9a560dda668a65b9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae839a9c2465be4e9a560dda668a65b9b">&#9670;&nbsp;</a></span>ast_append_ha()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a>* ast_append_ha </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sense</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>stuff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a new rule to a list of HAs. </p>
<p>This adds the new host access rule to the end of the list whose head is specified by the path parameter. Rules are evaluated in a way such that if multiple rules apply to a single IP address/subnet mask, then the rule latest in the list will be used.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">sense</td><td>Either "permit" or "deny" (Actually any 'p' word will result in permission, and any other word will result in denial) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">stuff</td><td>The IP address and subnet mask, separated with a '/'. The subnet mask can either be in dotted-decimal format or in CIDR notation (i.e. 0-32). </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">path</td><td>The head of the HA list to which we wish to append our new rule. If NULL is passed, then the new rule will become the head of the list </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">error</td><td>The integer error points to will be set non-zero if an error occurs </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The head of the HA list </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00713">713</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/db8/acl_8c_source.html#l00576">append_ha_core()</a>, and <a class="el" href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01135">PARSE_PORT_FORBID</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/dc8/config__options_8c_source.html#l01501">acl_handler_fn()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l02795">add_calltoken_ignore()</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00430">ast_append_acl()</a>, <a class="el" href="../../d2/dcf/test__acl_8c_source.html#l00040">AST_TEST_DEFINE()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l02740">build_callno_limits()</a>, <a class="el" href="../../d1/d6d/chan__unistim_8c_source.html#l06501">build_device()</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l04016">build_gateway()</a>, <a class="el" href="../../d2/dcf/test__acl_8c_source.html#l00123">build_ha()</a>, <a class="el" href="../../d0/d80/chan__skinny_8c_source.html#l07770">config_parse_variables()</a>, <a class="el" href="../../da/ddd/named__acl_8c_source.html#l00240">named_acl_find_realtime()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l32514">reload_config()</a>, and <a class="el" href="../../d3/d17/config__transport_8c_source.html#l01346">transport_localnet_handler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;{</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/db8/acl_8c.html#a094d64f22dae05f058a3e08052256fc1">append_ha_core</a>(<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a>, stuff, path, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3">PARSE_PORT_FORBID</a>);</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;}</div><div class="ttc" id="acl_8c_html_a094d64f22dae05f058a3e08052256fc1"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a094d64f22dae05f058a3e08052256fc1">append_ha_core</a></div><div class="ttdeci">static struct ast_ha * append_ha_core(const char *sense, const char *stuff, struct ast_ha *path, int *error, int port_flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00576">acl.c:576</a></div></div>
<div class="ttc" id="structast__ha_html_ac35e9125db2f5dd5dbc917f4385d03f6"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">ast_ha::sense</a></div><div class="ttdeci">enum ast_acl_sense sense</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00055">acl.h:55</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3">PARSE_PORT_FORBID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01135">include/asterisk/config.h:1135</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a51035b96ac8c6d49c8b74f99bcafeb3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51035b96ac8c6d49c8b74f99bcafeb3a">&#9670;&nbsp;</a></span>ast_append_ha_with_port()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a>* ast_append_ha_with_port </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sense</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>stuff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a new rule with optional port to a list of HAs. </p>
<dl class="section since"><dt>Since</dt><dd>13.31.0, 16.8.0, 17.2.0</dd></dl>
<p>This adds the new host access rule to the end of the list whose head is specified by the path parameter. Rules are evaluated in a way such that if multiple rules apply to a single IP address/subnet mask, then the rule latest in the list will be used.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">sense</td><td>Either "permit" or "deny" (Actually any 'p' word will result in permission, and any other word will result in denial) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">stuff</td><td>The IP address and subnet mask, separated with a '/'. The subnet mask can either be in dotted-decimal format or in CIDR notation (i.e. 0-32). A port can be provided by placing it after the IP address, separated with a ':'. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">path</td><td>The head of the HA list to which we wish to append our new rule. If NULL is passed, then the new rule will become the head of the list </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">error</td><td>The integer error points to will be set non-zero if an error occurs </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The head of the HA list </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00718">718</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/db8/acl_8c_source.html#l00576">append_ha_core()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../df/d91/res__pjsip__endpoint__identifier__ip_8c_source.html#l00387">ip_identify_match_handler()</a>, <a class="el" href="../../df/d91/res__pjsip__endpoint__identifier__ip_8c_source.html#l00322">ip_identify_match_host_lookup()</a>, and <a class="el" href="../../d0/d73/res__pjsip__logger_8c_source.html#l00351">pjsip_enable_logger_host()</a>.</p>
<div class="fragment"><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;{</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/db8/acl_8c.html#a094d64f22dae05f058a3e08052256fc1">append_ha_core</a>(<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a>, stuff, path, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, 0);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;}</div><div class="ttc" id="acl_8c_html_a094d64f22dae05f058a3e08052256fc1"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a094d64f22dae05f058a3e08052256fc1">append_ha_core</a></div><div class="ttdeci">static struct ast_ha * append_ha_core(const char *sense, const char *stuff, struct ast_ha *path, int *error, int port_flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00576">acl.c:576</a></div></div>
<div class="ttc" id="structast__ha_html_ac35e9125db2f5dd5dbc917f4385d03f6"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">ast_ha::sense</a></div><div class="ttdeci">enum ast_acl_sense sense</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00055">acl.h:55</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3f0c6ca57c26cab3141b15c4b231188b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f0c6ca57c26cab3141b15c4b231188b">&#9670;&nbsp;</a></span>ast_apply_acl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445">ast_acl_sense</a> ast_apply_acl </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *&#160;</td>
          <td class="paramname"><em>acl_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>purpose</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Apply a set of rules to a given IP address. </p>
<p>Similar to the above, only uses an acl container, which is a whole slew of <a class="el" href="../../dc/d1d/structast__ha.html" title="internal representation of ACL entries In principle user applications would have no need for this...">ast_ha</a> lists. It runs ast_apply_ha on each of the <a class="el" href="../../dc/d1d/structast__ha.html" title="internal representation of ACL entries In principle user applications would have no need for this...">ast_ha</a> structs contained in the acl container. It will deny if any of the <a class="el" href="../../dc/d1d/structast__ha.html" title="internal representation of ACL entries In principle user applications would have no need for this...">ast_ha</a> lists fail, and it will pass only if all of the rules pass.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">acl_list</td><td>The head of the list of ACLs to evaluate </td></tr>
    <tr><td class="paramname">addr</td><td>An <a class="el" href="../../d3/db3/structast__sockaddr.html" title="Socket address structure. ">ast_sockaddr</a> whose address is considered when matching rules </td></tr>
    <tr><td class="paramname">purpose</td><td>Context for which the ACL is being applied - Establishes purpose of a notice when rejected</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">AST_SENSE_ALLOW</td><td>The IP address passes our ACLs </td></tr>
    <tr><td class="paramname">AST_SENSE_DENY</td><td>The IP address fails our ACLs </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00800">800</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/db8/acl_8c_source.html#l00758">ast_apply_acl_internal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d5e/res__pjsip__acl_8c_source.html#l00121">apply_acl()</a>, <a class="el" href="../../d5/d5e/res__pjsip__acl_8c_source.html#l00158">apply_contact_acl()</a>, <a class="el" href="../../d7/dad/pjsip__distributor_8c_source.html#l00807">apply_endpoint_acl()</a>, <a class="el" href="../../d7/dad/pjsip__distributor_8c_source.html#l00845">apply_endpoint_contact_acl()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l08119">auth_http_callback()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l03505">authenticate()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l07787">check_access()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l19237">check_peer_ok()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l16961">parse_register_contact()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l08189">register_verify()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l33729">sip_allow_anyrtp_remote()</a>.</p>
<div class="fragment"><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                                                                                                                      {</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/db8/acl_8c.html#ae800474d82b6402adb1fd82042a9e620">ast_apply_acl_internal</a>(acl_list, addr, purpose ?: <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;}</div><div class="ttc" id="acl_8c_html_ae800474d82b6402adb1fd82042a9e620"><div class="ttname"><a href="../../d9/db8/acl_8c.html#ae800474d82b6402adb1fd82042a9e620">ast_apply_acl_internal</a></div><div class="ttdeci">static enum ast_acl_sense ast_apply_acl_internal(struct ast_acl_list *acl_list, const struct ast_sockaddr *addr, const char *log_prefix)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00758">acl.c:758</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae800474d82b6402adb1fd82042a9e620"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae800474d82b6402adb1fd82042a9e620">&#9670;&nbsp;</a></span>ast_apply_acl_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445">ast_acl_sense</a> ast_apply_acl_internal </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *&#160;</td>
          <td class="paramname"><em>acl_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>log_prefix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00758">758</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00068">ast_acl::acl</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00808">ast_apply_ha()</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00038">AST_SENSE_ALLOW</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00037">AST_SENSE_DENY</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00290">ast_sockaddr_stringify_addr()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00070">ast_acl::is_invalid</a>, <a class="el" href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">ast_acl::list</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00263">LOG_NOTICE</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, and <a class="el" href="../../d5/d59/acl_8h_source.html#l00071">ast_acl::name</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l00800">ast_apply_acl()</a>, and <a class="el" href="../../d9/db8/acl_8c_source.html#l00804">ast_apply_acl_nolog()</a>.</p>
<div class="fragment"><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;{</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dc8/structast__acl.html">ast_acl</a> *<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a>;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;   <span class="comment">/* If the list is NULL, there are no rules, so we&#39;ll allow automatically. */</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;   <span class="keywordflow">if</span> (!acl_list) {</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a>;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;   }</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(acl_list);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(acl_list, acl, <a class="code" href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">list</a>) {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="keywordflow">if</span> (acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a1ed68f61e62003a076d1e131e79c487e">is_invalid</a>) {</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;         <span class="comment">/* In this case, the baseline ACL shouldn&#39;t ever trigger this, but if that somehow happens, it&#39;ll still be shown. */</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;         <span class="keywordflow">if</span> (log_prefix) {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%sRejecting &#39;%s&#39; due to use of an invalid ACL &#39;%s&#39;.\n&quot;</span>,</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                  log_prefix, <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(addr),</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                  <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">name</a>) ? <span class="stringliteral">&quot;(BASELINE)&quot;</span> : acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">name</a>);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;         }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(acl_list);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445abb486b5b819cf3b3951ce0a2e584f065">AST_SENSE_DENY</a>;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      }</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordflow">if</span> (acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a>) {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d9/db8/acl_8c.html#aa5049380ffb26d76d2f236d886964aac">ast_apply_ha</a>(acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a>, addr) == <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445abb486b5b819cf3b3951ce0a2e584f065">AST_SENSE_DENY</a>) {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="keywordflow">if</span> (log_prefix) {</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;%sRejecting &#39;%s&#39; due to a failure to pass ACL &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                     log_prefix, <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(addr),</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                     <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">name</a>) ? <span class="stringliteral">&quot;(BASELINE)&quot;</span> : acl-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">name</a>);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(acl_list);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445abb486b5b819cf3b3951ce0a2e584f065">AST_SENSE_DENY</a>;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;         }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      }</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;   }</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(acl_list);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a>;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;}</div><div class="ttc" id="netsock2_8h_html_a6bf0e68e74c0a9ca9d25251b22e4d64a"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a></div><div class="ttdeci">static char * ast_sockaddr_stringify_addr(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() to return an address only. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00290">netsock2.h:290</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a9140a4e4d781264fa9469c52b1adae40"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a></div><div class="ttdeci">#define AST_LIST_LOCK(head)</div><div class="ttdoc">Locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00039">linkedlists.h:39</a></div></div>
<div class="ttc" id="structast__acl_html_ad063b12f30f296c6231d954bd00ef5db"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">ast_acl::list</a></div><div class="ttdeci">struct ast_acl::@218 list</div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="linkedlists_8h_html_ab48cb9e1e612dd486b747ba1c5d68d01"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a></div><div class="ttdeci">#define AST_LIST_UNLOCK(head)</div><div class="ttdoc">Attempts to unlock a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00139">linkedlists.h:139</a></div></div>
<div class="ttc" id="structast__acl_html_aa1fb007be85f6cba1ea263ec6f993c1b"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">ast_acl::name</a></div><div class="ttdeci">char name[ACL_NAME_LENGTH]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00071">acl.h:71</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__acl_html_a1ed68f61e62003a076d1e131e79c487e"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a1ed68f61e62003a076d1e131e79c487e">ast_acl::is_invalid</a></div><div class="ttdeci">int is_invalid</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00070">acl.h:70</a></div></div>
<div class="ttc" id="structast__acl_html_a13e2a890da2a7cfbc9ea20724e7a61b7"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">ast_acl::acl</a></div><div class="ttdeci">struct ast_ha * acl</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00068">acl.h:68</a></div></div>
<div class="ttc" id="structast__acl_html"><div class="ttname"><a href="../../d9/dc8/structast__acl.html">ast_acl</a></div><div class="ttdoc">an ast_acl is a linked list node of ast_ha structs which may have names. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00067">acl.h:67</a></div></div>
<div class="ttc" id="logger_8h_html_ad89ee324d180cdcd7defcc709ff9ca42"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a></div><div class="ttdeci">#define LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00263">logger.h:263</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a3008b2f4f236b72d8bcfb80e346324ef"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE(head, var, field)</div><div class="ttdoc">Loops over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00490">linkedlists.h:490</a></div></div>
<div class="ttc" id="acl_8h_html_a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2"><div class="ttname"><a href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00038">acl.h:38</a></div></div>
<div class="ttc" id="acl_8c_html_aa5049380ffb26d76d2f236d886964aac"><div class="ttname"><a href="../../d9/db8/acl_8c.html#aa5049380ffb26d76d2f236d886964aac">ast_apply_ha</a></div><div class="ttdeci">enum ast_acl_sense ast_apply_ha(const struct ast_ha *ha, const struct ast_sockaddr *addr)</div><div class="ttdoc">Apply a set of rules to a given IP address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00808">acl.c:808</a></div></div>
<div class="ttc" id="acl_8h_html_a764d04fe9485be95771e652dc2c87445abb486b5b819cf3b3951ce0a2e584f065"><div class="ttname"><a href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445abb486b5b819cf3b3951ce0a2e584f065">AST_SENSE_DENY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00037">acl.h:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8752b9c65a8a31102f7155f99451ca53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8752b9c65a8a31102f7155f99451ca53">&#9670;&nbsp;</a></span>ast_apply_acl_nolog()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445">ast_acl_sense</a> ast_apply_acl_nolog </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *&#160;</td>
          <td class="paramname"><em>acl_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Apply a set of rules to a given IP address, don't log failure. </p>
<p>Exactly like ast_apply_acl, except that it will never log anything.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">acl_list</td><td>The head of the list of ACLs to evaluate </td></tr>
    <tr><td class="paramname">addr</td><td>An <a class="el" href="../../d3/db3/structast__sockaddr.html" title="Socket address structure. ">ast_sockaddr</a> whose address is considered when matching rules</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">AST_SENSE_ALLOW</td><td>The IP address passes our ACLs </td></tr>
    <tr><td class="paramname">AST_SENSE_DENY</td><td>The IP address fails our ACLs </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00804">804</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/db8/acl_8c_source.html#l00758">ast_apply_acl_internal()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l03487">rtp_address_is_ice_blacklisted()</a>, and <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l03510">stun_address_is_blacklisted()</a>.</p>
<div class="fragment"><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                                                                                                       {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/db8/acl_8c.html#ae800474d82b6402adb1fd82042a9e620">ast_apply_acl_internal</a>(acl_list, addr, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="acl_8c_html_ae800474d82b6402adb1fd82042a9e620"><div class="ttname"><a href="../../d9/db8/acl_8c.html#ae800474d82b6402adb1fd82042a9e620">ast_apply_acl_internal</a></div><div class="ttdeci">static enum ast_acl_sense ast_apply_acl_internal(struct ast_acl_list *acl_list, const struct ast_sockaddr *addr, const char *log_prefix)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00758">acl.c:758</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa5049380ffb26d76d2f236d886964aac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5049380ffb26d76d2f236d886964aac">&#9670;&nbsp;</a></span>ast_apply_ha()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445">ast_acl_sense</a> ast_apply_ha </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>ha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Apply a set of rules to a given IP address. </p>
<p>The list of host access rules is traversed, beginning with the input rule. If the IP address given matches a rule, the "sense" of that rule is used as the return value. Note that if an IP address matches multiple rules that the last one matched will be the one whose sense will be returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ha</td><td>The head of the list of host access rules to follow </td></tr>
    <tr><td class="paramname">addr</td><td>An <a class="el" href="../../d3/db3/structast__sockaddr.html" title="Socket address structure. ">ast_sockaddr</a> whose address is considered when matching rules </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">AST_SENSE_ALLOW</td><td>The IP address passes our ACL </td></tr>
    <tr><td class="paramname">AST_SENSE_DENY</td><td>The IP address fails our ACL </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00808">808</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00053">ast_ha::addr</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00401">ast_copy_string()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00038">AST_SENSE_ALLOW</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00357">ast_sockaddr_apply_netmask()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00413">ast_sockaddr_cmp_addr()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00037">ast_sockaddr_ipv4_mapped()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00497">ast_sockaddr_is_ipv4()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00507">ast_sockaddr_is_ipv4_mapped()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00524">ast_sockaddr_is_ipv6()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00521">ast_sockaddr_port</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00537">ast_sockaddr_set_port</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00260">ast_sockaddr_stringify()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00054">ast_ha::netmask</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00056">ast_ha::next</a>, and <a class="el" href="../../d5/d59/acl_8h_source.html#l00055">ast_ha::sense</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l00758">ast_apply_acl_internal()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l03866">ast_sip_ouraddrfor()</a>, <a class="el" href="../../d2/dcf/test__acl_8c_source.html#l00139">AST_TEST_DEFINE()</a>, <a class="el" href="../../df/d91/res__pjsip__endpoint__identifier__ip_8c_source.html#l00245">ip_identify_match_check()</a>, <a class="el" href="../../df/d91/res__pjsip__endpoint__identifier__ip_8c_source.html#l00322">ip_identify_match_host_lookup()</a>, <a class="el" href="../../d0/d73/res__pjsip__logger_8c_source.html#l00152">pjsip_log_test_addr()</a>, and <a class="el" href="../../d0/d80/chan__skinny_8c_source.html#l02258">skinny_register()</a>.</p>
<div class="fragment"><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;{</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;   <span class="comment">/* Start optimistic */</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445">ast_acl_sense</a> res = <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a>;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../dc/d1d/structast__ha.html">ast_ha</a> *current_ha;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;   <span class="keywordflow">for</span> (current_ha = ha; current_ha; current_ha = current_ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>) {</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> mapped_addr;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *addr_to_use;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      uint16_t save_port;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="preprocessor">#if 0 </span><span class="comment">/* debugging code */</span><span class="preprocessor"></span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      <span class="keywordtype">char</span> iabuf[INET_ADDRSTRLEN];</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="keywordtype">char</span> iabuf2[INET_ADDRSTRLEN];</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="comment">/* DEBUG */</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(iabuf, <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(addr), <span class="keyword">sizeof</span>(iabuf));</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(iabuf2, <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;current_ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>), <span class="keyword">sizeof</span>(iabuf2));</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;##### Testing %s with %s\n&quot;</span>, iabuf, iabuf2);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#adbbb5a3382be0925c292a4933ce5b63d">ast_sockaddr_is_ipv4</a>(&amp;current_ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>)) {</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a579748bd6ceddd06b1cc6eb3578e8acc">ast_sockaddr_is_ipv6</a>(addr)) {</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#af2625d0652cf8a306d99072aedd7c6ad">ast_sockaddr_is_ipv4_mapped</a>(addr)) {</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;               <span class="comment">/* IPv4 ACLs apply to IPv4-mapped addresses */</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;               <span class="keywordflow">if</span> (!<a class="code" href="../../db/df1/netsock2_8h.html#a42e610962ef06c151aad8260af428e3d">ast_sockaddr_ipv4_mapped</a>(addr, &amp;mapped_addr)) {</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s provided to ast_sockaddr_ipv4_mapped could not be converted. That shouldn&#39;t be possible.\n&quot;</span>,</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                     <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(addr));</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                  <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;               }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;               addr_to_use = &amp;mapped_addr;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;               <span class="comment">/* An IPv4 ACL does not apply to an IPv6 address */</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            }</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <span class="comment">/* Address is IPv4 and ACL is IPv4. No biggie */</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            addr_to_use = addr;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;         }</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a579748bd6ceddd06b1cc6eb3578e8acc">ast_sockaddr_is_ipv6</a>(addr) &amp;&amp; !<a class="code" href="../../db/df1/netsock2_8h.html#af2625d0652cf8a306d99072aedd7c6ad">ast_sockaddr_is_ipv4_mapped</a>(addr)) {</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            addr_to_use = addr;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            <span class="comment">/* Address is IPv4 or IPv4 mapped but ACL is IPv6. Skip */</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;         }</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="comment">/* ast_sockaddr_apply_netmask() does not preserve the port, so we need to save and</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">       * restore it */</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      save_port = <a class="code" href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a>(addr_to_use);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <span class="comment">/* For each rule, if this address and the netmask = the net address</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">         apply the current rule */</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a5d6080466e41d97c3b02c043b19039ab">ast_sockaddr_apply_netmask</a>(addr_to_use, &amp;current_ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>, &amp;<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>)) {</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;         <span class="comment">/* Unlikely to happen since we know the address to be IPv4 or IPv6 */</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      }</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <a class="code" href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a>(&amp;<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, save_port);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../db/df1/netsock2_8h.html#a5fb3221004de6004d4c1f04c816eaac8">ast_sockaddr_cmp_addr</a>(&amp;<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, &amp;current_ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>)</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;         &amp;&amp; (!<a class="code" href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a>(&amp;current_ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>)</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;           || <a class="code" href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a>(&amp;current_ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>) == <a class="code" href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a>(&amp;<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>))) {</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;         res = current_ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a>;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      }</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;   }</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;}</div><div class="ttc" id="structast__ha_html_a904bbec16face4bc9d13a8e8c7fbf764"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">ast_ha::next</a></div><div class="ttdeci">struct ast_ha * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00056">acl.h:56</a></div></div>
<div class="ttc" id="structast__ha_html_a10838452c09fae7f0e3de86581d85379"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">ast_ha::addr</a></div><div class="ttdeci">struct ast_sockaddr addr</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00053">acl.h:53</a></div></div>
<div class="ttc" id="netsock2_8h_html_a42e610962ef06c151aad8260af428e3d"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a42e610962ef06c151aad8260af428e3d">ast_sockaddr_ipv4_mapped</a></div><div class="ttdeci">int ast_sockaddr_ipv4_mapped(const struct ast_sockaddr *addr, struct ast_sockaddr *ast_mapped)</div><div class="ttdoc">Convert an IPv4-mapped IPv6 address into an IPv4 address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00037">netsock2.c:37</a></div></div>
<div class="ttc" id="structast__ha_html_ac35e9125db2f5dd5dbc917f4385d03f6"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">ast_ha::sense</a></div><div class="ttdeci">enum ast_acl_sense sense</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00055">acl.h:55</a></div></div>
<div class="ttc" id="structast__sockaddr_html"><div class="ttname"><a href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a></div><div class="ttdoc">Socket address structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00097">netsock2.h:97</a></div></div>
<div class="ttc" id="netsock2_8h_html_a5fb3221004de6004d4c1f04c816eaac8"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a5fb3221004de6004d4c1f04c816eaac8">ast_sockaddr_cmp_addr</a></div><div class="ttdeci">int ast_sockaddr_cmp_addr(const struct ast_sockaddr *a, const struct ast_sockaddr *b)</div><div class="ttdoc">Compares the addresses of two ast_sockaddr structures. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00413">netsock2.c:413</a></div></div>
<div class="ttc" id="netsock2_8h_html_a51e2841175bf3ad58a4e11ad9fb2453f"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a></div><div class="ttdeci">#define ast_sockaddr_port(addr)</div><div class="ttdoc">Get the port number of a socket address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00521">netsock2.h:521</a></div></div>
<div class="ttc" id="structast__ha_html"><div class="ttname"><a href="../../dc/d1d/structast__ha.html">ast_ha</a></div><div class="ttdoc">internal representation of ACL entries In principle user applications would have no need for this...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00051">acl.h:51</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__ha_html_a1a9ebad90d33f306c2b7f72174812c09"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">ast_ha::netmask</a></div><div class="ttdeci">struct ast_sockaddr netmask</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00054">acl.h:54</a></div></div>
<div class="ttc" id="acl_8h_html_a764d04fe9485be95771e652dc2c87445"><div class="ttname"><a href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445">ast_acl_sense</a></div><div class="ttdeci">ast_acl_sense</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00036">acl.h:36</a></div></div>
<div class="ttc" id="netsock2_8h_html_a5d6080466e41d97c3b02c043b19039ab"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a5d6080466e41d97c3b02c043b19039ab">ast_sockaddr_apply_netmask</a></div><div class="ttdeci">int ast_sockaddr_apply_netmask(const struct ast_sockaddr *addr, const struct ast_sockaddr *netmask, struct ast_sockaddr *result)</div><div class="ttdoc">Apply a netmask to an address and store the result in a separate structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00357">netsock2.c:357</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="netsock2_8h_html_ac83e6bdec376b74d02da8d2f8e1af888"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a></div><div class="ttdeci">#define ast_sockaddr_set_port(addr, port)</div><div class="ttdoc">Sets the port number of a socket address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00537">netsock2.h:537</a></div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
<div class="ttc" id="acl_8h_html_a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2"><div class="ttname"><a href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00038">acl.h:38</a></div></div>
<div class="ttc" id="netsock2_8h_html_af2625d0652cf8a306d99072aedd7c6ad"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#af2625d0652cf8a306d99072aedd7c6ad">ast_sockaddr_is_ipv4_mapped</a></div><div class="ttdeci">int ast_sockaddr_is_ipv4_mapped(const struct ast_sockaddr *addr)</div><div class="ttdoc">Determine if this is an IPv4-mapped IPv6 address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00507">netsock2.c:507</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
<div class="ttc" id="netsock2_8h_html_adbbb5a3382be0925c292a4933ce5b63d"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#adbbb5a3382be0925c292a4933ce5b63d">ast_sockaddr_is_ipv4</a></div><div class="ttdeci">int ast_sockaddr_is_ipv4(const struct ast_sockaddr *addr)</div><div class="ttdoc">Determine if the address is an IPv4 address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00497">netsock2.c:497</a></div></div>
<div class="ttc" id="netsock2_8h_html_a579748bd6ceddd06b1cc6eb3578e8acc"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a579748bd6ceddd06b1cc6eb3578e8acc">ast_sockaddr_is_ipv6</a></div><div class="ttdeci">int ast_sockaddr_is_ipv6(const struct ast_sockaddr *addr)</div><div class="ttdoc">Determine if this is an IPv6 address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00524">netsock2.c:524</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a61f6f79316a8f64be7bdac1a41183047"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61f6f79316a8f64be7bdac1a41183047">&#9670;&nbsp;</a></span>ast_copy_ha()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_copy_ha </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>to</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copy the contents of one HA to another. </p>
<p>This copies the internals of the 'from' HA to the 'to' HA. It is important that the 'to' HA has been allocated prior to calling this function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">from</td><td>Source HA to copy </td></tr>
    <tr><td class="paramname">to</td><td>Destination HA to copy to </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00255">255</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00053">ast_ha::addr</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00171">ast_sockaddr_copy()</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00054">ast_ha::netmask</a>, and <a class="el" href="../../d5/d59/acl_8h_source.html#l00055">ast_ha::sense</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l02795">add_calltoken_ignore()</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00263">ast_duplicate_ha()</a>, and <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l02740">build_callno_limits()</a>.</p>
<div class="fragment"><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;{</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a>(&amp;to-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>, &amp;from-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a>(&amp;to-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>, &amp;from-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   to-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a> = from-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div><div class="ttc" id="structast__ha_html_a10838452c09fae7f0e3de86581d85379"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">ast_ha::addr</a></div><div class="ttdeci">struct ast_sockaddr addr</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00053">acl.h:53</a></div></div>
<div class="ttc" id="netsock2_8h_html_a56a46003c93bfd65111ea8ffc97af8f9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a></div><div class="ttdeci">static void ast_sockaddr_copy(struct ast_sockaddr *dst, const struct ast_sockaddr *src)</div><div class="ttdoc">Copies the data from one ast_sockaddr to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00171">netsock2.h:171</a></div></div>
<div class="ttc" id="structast__ha_html_ac35e9125db2f5dd5dbc917f4385d03f6"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">ast_ha::sense</a></div><div class="ttdeci">enum ast_acl_sense sense</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00055">acl.h:55</a></div></div>
<div class="ttc" id="structast__ha_html_a1a9ebad90d33f306c2b7f72174812c09"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">ast_ha::netmask</a></div><div class="ttdeci">struct ast_sockaddr netmask</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00054">acl.h:54</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acb7002144ebb738da0c7cd826dd89b7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb7002144ebb738da0c7cd826dd89b7f">&#9670;&nbsp;</a></span>ast_duplicate_acl_list()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a>* ast_duplicate_acl_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *&#160;</td>
          <td class="paramname"><em>original</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Duplicates the contests of a list of lists of host access rules. </p>
<p>A deep copy of an <a class="el" href="../../d9/dc8/structast__acl.html" title="an ast_acl is a linked list node of ast_ha structs which may have names. ">ast_acl</a> list is made (which in turn means a deep copy of each of the <a class="el" href="../../dc/d1d/structast__ha.html" title="internal representation of ACL entries In principle user applications would have no need for this...">ast_ha</a> structs contained within). The returned value is allocated on the heap and must be freed independently of the input paramater when finished.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">original</td><td>The <a class="el" href="../../d3/da4/structast__acl__list.html" title="Wrapper for an ast_acl linked list. ">ast_acl_list</a> to copy </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>new duplicated <a class="el" href="../../d3/da4/structast__acl__list.html" title="Wrapper for an ast_acl linked list. ">ast_acl_list</a> </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00316">316</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00068">ast_acl::acl</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00305">acl_new()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00277">ast_duplicate_ha_list()</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00233">ast_free_acl_list()</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00625">AST_LIST_HEAD_INIT</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00730">AST_LIST_INSERT_TAIL</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00070">ast_acl::is_invalid</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00069">ast_acl::is_realtime</a>, <a class="el" href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">ast_acl::list</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00071">ast_acl::name</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l06136">create_addr_from_peer()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l33729">sip_allow_anyrtp_remote()</a>.</p>
<div class="fragment"><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;{</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *clone;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dc8/structast__acl.html">ast_acl</a> *current_cursor;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dc8/structast__acl.html">ast_acl</a> *current_clone;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   <span class="comment">/* Early return if we receive a duplication request for a NULL original. */</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   <span class="keywordflow">if</span> (!original) {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;   }</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="keywordflow">if</span> (!(clone = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*clone)))) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate ast_acl_list struct while cloning an ACL\n&quot;</span>);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca">AST_LIST_HEAD_INIT</a>(clone);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(original);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(original, current_cursor, <a class="code" href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">list</a>) {</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keywordflow">if</span> ((<a class="code" href="../../d9/db8/acl_8c.html#a39040b5c973927d7aa035f1c36d63357">acl_new</a>(&amp;current_clone, current_cursor-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">name</a>))) {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate ast_acl struct while cloning an ACL.\n&quot;</span>);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;         <a class="code" href="../../d9/db8/acl_8c.html#a1e76cd4becf7d678916af2ebcebd9e74">ast_free_acl_list</a>(clone);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;         clone = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="comment">/* Copy data from original ACL to clone ACL */</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      current_clone-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a> = <a class="code" href="../../d9/db8/acl_8c.html#abbe043434fef41fa18acb4062960b578">ast_duplicate_ha_list</a>(current_cursor-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a>);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      current_clone-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a1ed68f61e62003a076d1e131e79c487e">is_invalid</a> = current_cursor-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a1ed68f61e62003a076d1e131e79c487e">is_invalid</a>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      current_clone-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a9e366d6272bc1809424d49054ca30421">is_realtime</a> = current_cursor-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a9e366d6272bc1809424d49054ca30421">is_realtime</a>;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a>(clone, current_clone, <a class="code" href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">list</a>);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordflow">if</span> (current_cursor-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a> &amp;&amp; !current_clone-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a>) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;         <span class="comment">/* Deal with failure after adding to clone so we don&#39;t have to free</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">          * current_clone separately. */</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to duplicate HA list while cloning ACL.\n&quot;</span>);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;         <a class="code" href="../../d9/db8/acl_8c.html#a1e76cd4becf7d678916af2ebcebd9e74">ast_free_acl_list</a>(clone);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;         clone = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;   }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(original);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;   <span class="keywordflow">return</span> clone;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;}</div><div class="ttc" id="linkedlists_8h_html_a9140a4e4d781264fa9469c52b1adae40"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a></div><div class="ttdeci">#define AST_LIST_LOCK(head)</div><div class="ttdoc">Locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00039">linkedlists.h:39</a></div></div>
<div class="ttc" id="structast__acl_html_ad063b12f30f296c6231d954bd00ef5db"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">ast_acl::list</a></div><div class="ttdeci">struct ast_acl::@218 list</div></div>
<div class="ttc" id="linkedlists_8h_html_ab48cb9e1e612dd486b747ba1c5d68d01"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a></div><div class="ttdeci">#define AST_LIST_UNLOCK(head)</div><div class="ttdoc">Attempts to unlock a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00139">linkedlists.h:139</a></div></div>
<div class="ttc" id="structast__acl_html_aa1fb007be85f6cba1ea263ec6f993c1b"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#aa1fb007be85f6cba1ea263ec6f993c1b">ast_acl::name</a></div><div class="ttdeci">char name[ACL_NAME_LENGTH]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00071">acl.h:71</a></div></div>
<div class="ttc" id="acl_8c_html_a1e76cd4becf7d678916af2ebcebd9e74"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a1e76cd4becf7d678916af2ebcebd9e74">ast_free_acl_list</a></div><div class="ttdeci">struct ast_acl_list * ast_free_acl_list(struct ast_acl_list *acl_list)</div><div class="ttdoc">Free a list of ACLs. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00233">acl.c:233</a></div></div>
<div class="ttc" id="structast__acl__list_html"><div class="ttname"><a href="../../d3/da4/structast__acl__list.html">ast_acl_list</a></div><div class="ttdoc">Wrapper for an ast_acl linked list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00076">acl.h:76</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__acl_html_a9e366d6272bc1809424d49054ca30421"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a9e366d6272bc1809424d49054ca30421">ast_acl::is_realtime</a></div><div class="ttdeci">int is_realtime</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00069">acl.h:69</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__acl_html_a1ed68f61e62003a076d1e131e79c487e"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a1ed68f61e62003a076d1e131e79c487e">ast_acl::is_invalid</a></div><div class="ttdeci">int is_invalid</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00070">acl.h:70</a></div></div>
<div class="ttc" id="structast__acl_html_a13e2a890da2a7cfbc9ea20724e7a61b7"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">ast_acl::acl</a></div><div class="ttdeci">struct ast_ha * acl</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00068">acl.h:68</a></div></div>
<div class="ttc" id="structast__acl_html"><div class="ttname"><a href="../../d9/dc8/structast__acl.html">ast_acl</a></div><div class="ttdoc">an ast_acl is a linked list node of ast_ha structs which may have names. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00067">acl.h:67</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a4d258b4525e63c435d7de579d3f46960"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a></div><div class="ttdeci">#define AST_LIST_INSERT_TAIL(head, elm, field)</div><div class="ttdoc">Appends a list entry to the tail of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00730">linkedlists.h:730</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a3008b2f4f236b72d8bcfb80e346324ef"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE(head, var, field)</div><div class="ttdoc">Loops over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00490">linkedlists.h:490</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a6f42d3bf45cc9af6f794d9d1cf8c45ca"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca">AST_LIST_HEAD_INIT</a></div><div class="ttdeci">#define AST_LIST_HEAD_INIT(head)</div><div class="ttdoc">Initializes a list head structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00625">linkedlists.h:625</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="acl_8c_html_abbe043434fef41fa18acb4062960b578"><div class="ttname"><a href="../../d9/db8/acl_8c.html#abbe043434fef41fa18acb4062960b578">ast_duplicate_ha_list</a></div><div class="ttdeci">struct ast_ha * ast_duplicate_ha_list(struct ast_ha *original)</div><div class="ttdoc">Duplicate the contents of a list of host access rules. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00277">acl.c:277</a></div></div>
<div class="ttc" id="acl_8c_html_a39040b5c973927d7aa035f1c36d63357"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a39040b5c973927d7aa035f1c36d63357">acl_new</a></div><div class="ttdeci">static int acl_new(struct ast_acl **pointer, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00305">acl.c:305</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6d97cef1d0fcd04f8597a70bb315e216"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d97cef1d0fcd04f8597a70bb315e216">&#9670;&nbsp;</a></span>ast_duplicate_ha()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a>* ast_duplicate_ha </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>original</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00263">263</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, and <a class="el" href="../../d9/db8/acl_8c_source.html#l00255">ast_copy_ha()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l00277">ast_duplicate_ha_list()</a>.</p>
<div class="fragment"><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;{</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d1d/structast__ha.html">ast_ha</a> *new_ha;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   <span class="keywordflow">if</span> ((new_ha = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*new_ha)))) {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="comment">/* Copy from original to new object */</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <a class="code" href="../../d9/db8/acl_8c.html#a61f6f79316a8f64be7bdac1a41183047">ast_copy_ha</a>(original, new_ha);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;   <span class="keywordflow">return</span> new_ha;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div><div class="ttc" id="structast__ha_html"><div class="ttname"><a href="../../dc/d1d/structast__ha.html">ast_ha</a></div><div class="ttdoc">internal representation of ACL entries In principle user applications would have no need for this...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00051">acl.h:51</a></div></div>
<div class="ttc" id="acl_8c_html_a61f6f79316a8f64be7bdac1a41183047"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a61f6f79316a8f64be7bdac1a41183047">ast_copy_ha</a></div><div class="ttdeci">void ast_copy_ha(const struct ast_ha *from, struct ast_ha *to)</div><div class="ttdoc">Copy the contents of one HA to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00255">acl.c:255</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abbe043434fef41fa18acb4062960b578"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abbe043434fef41fa18acb4062960b578">&#9670;&nbsp;</a></span>ast_duplicate_ha_list()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a>* ast_duplicate_ha_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>original</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Duplicate the contents of a list of host access rules. </p>
<p>A deep copy of all ast_has in the list is made. The returned value is allocated on the heap and must be freed independently of the input parameter when finished.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">original</td><td>The <a class="el" href="../../dc/d1d/structast__ha.html" title="internal representation of ACL entries In principle user applications would have no need for this...">ast_ha</a> to copy </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>head of the list of duplicated ast_has </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00277">277</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/db8/acl_8c_source.html#l00263">ast_duplicate_ha()</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00222">ast_free_ha()</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00056">ast_ha::next</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l00316">ast_duplicate_acl_list()</a>, and <a class="el" href="../../da/ddd/named__acl_8c_source.html#l00293">ast_named_acl_find()</a>.</p>
<div class="fragment"><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;{</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d1d/structast__ha.html">ast_ha</a> *start = original;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d1d/structast__ha.html">ast_ha</a> *ret = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d1d/structast__ha.html">ast_ha</a> *current, *prev = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   <span class="keywordflow">while</span> (start) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      current = <a class="code" href="../../d9/db8/acl_8c.html#a6d97cef1d0fcd04f8597a70bb315e216">ast_duplicate_ha</a>(start);  <span class="comment">/* Create copy of this object */</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">if</span> (!current) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;         <a class="code" href="../../d9/db8/acl_8c.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a>(ret);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">if</span> (prev) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;         prev-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a> = current;           <span class="comment">/* Link previous to this object */</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">if</span> (!ret) {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;         ret = current;                  <span class="comment">/* Save starting point */</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      start = start-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>;                <span class="comment">/* Go to next object */</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      prev = current;                     <span class="comment">/* Save pointer to this object */</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   <span class="keywordflow">return</span> ret;                             <span class="comment">/* Return start of list */</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;}</div><div class="ttc" id="structast__ha_html_a904bbec16face4bc9d13a8e8c7fbf764"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">ast_ha::next</a></div><div class="ttdeci">struct ast_ha * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00056">acl.h:56</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="acl_8c_html_a45dc427430b544afc0ef8e898b2c57bf"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a></div><div class="ttdeci">void ast_free_ha(struct ast_ha *ha)</div><div class="ttdoc">Free a list of HAs. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00222">acl.c:222</a></div></div>
<div class="ttc" id="structast__ha_html"><div class="ttname"><a href="../../dc/d1d/structast__ha.html">ast_ha</a></div><div class="ttdoc">internal representation of ACL entries In principle user applications would have no need for this...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00051">acl.h:51</a></div></div>
<div class="ttc" id="acl_8c_html_a6d97cef1d0fcd04f8597a70bb315e216"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a6d97cef1d0fcd04f8597a70bb315e216">ast_duplicate_ha</a></div><div class="ttdeci">static struct ast_ha * ast_duplicate_ha(struct ast_ha *original)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00263">acl.c:263</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a74a637419bacba1233890081dd2f0495"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74a637419bacba1233890081dd2f0495">&#9670;&nbsp;</a></span>ast_find_ourip()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_find_ourip </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>ourip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>bindaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find our IP address. </p>
<p>This function goes through many iterations in an attempt to find our IP address. If any step along the way should fail, we move to the next item in the list. Here are the steps taken:</p><ul>
<li>If bindaddr has a non-zero IP address, that is copied into ourip</li>
<li>We use a combination of gethostname and ast_gethostbyname to find our IP address.</li>
<li>We use ast_ouraddrfor with 198.41.0.4 as the destination IP address</li>
<li>We try some platform-specific socket operations to find the IP address</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">ourip</td><td>Our IP address is written here when it is found </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">bindaddr</td><td>A hint used for finding our IP. See the steps above for more details </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">family</td><td>Only addresses of the given family will be returned. Use 0 or AST_SOCKADDR_UNSPEC to get addresses of all families. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l01052">1052</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l01005">ast_ouraddrfor()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00171">ast_sockaddr_copy()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00534">ast_sockaddr_is_any()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00521">ast_sockaddr_port</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00537">ast_sockaddr_set_port</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00118">get_local_address()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00069">MAXHOSTNAMELEN</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l00238">ourhost</a>, <a class="el" href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01135">PARSE_PORT_FORBID</a>, and <a class="el" href="../../d9/db8/acl_8c_source.html#l00876">resolve_first()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l08303">ast_rtp_prop_set()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l32514">reload_config()</a>.</p>
<div class="fragment"><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;{</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a8d857a26518d3787a893c9ab433ddb4d">ourhost</a>[<a class="code" href="../../d9/d94/network_8h.html#afd80ecbe3170ca4fc85b65cda8659f82">MAXHOSTNAMELEN</a>] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> root;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;   <span class="keywordtype">int</span> res, port = <a class="code" href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a>(ourip);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;   <span class="comment">/* just use the bind address if it is nonzero */</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../db/df1/netsock2_8h.html#a7704d67f19f3ca91198d8cc6e6445c3f">ast_sockaddr_is_any</a>(bindaddr)) {</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <a class="code" href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a>(ourip, bindaddr);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Attached to given IP address\n&quot;</span>);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;   }</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   <span class="comment">/* try to use our hostname */</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;   <span class="keywordflow">if</span> (gethostname(ourhost, <span class="keyword">sizeof</span>(ourhost) - 1)) {</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get hostname\n&quot;</span>);</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/db8/acl_8c.html#a7921b536db25aa8dd3fe67dbeda2ee2a">resolve_first</a>(ourip, ourhost, <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3">PARSE_PORT_FORBID</a>, family) == 0) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;         <span class="comment">/* reset port since resolve_first wipes this out */</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a>(ourip, port);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      }</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;   }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Trying to check A.ROOT-SERVERS.NET and get our IP address for that connection\n&quot;</span>);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;   <span class="comment">/* A.ROOT-SERVERS.NET. */</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d9/db8/acl_8c.html#a7921b536db25aa8dd3fe67dbeda2ee2a">resolve_first</a>(&amp;root, <span class="stringliteral">&quot;A.ROOT-SERVERS.NET&quot;</span>, <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3">PARSE_PORT_FORBID</a>, 0) &amp;&amp;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;       !<a class="code" href="../../d9/db8/acl_8c.html#a652b53325b914138d49526f69f6dd546">ast_ouraddrfor</a>(&amp;root, ourip)) {</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      <span class="comment">/* reset port since resolve_first wipes this out */</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      <a class="code" href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a>(ourip, port);</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;   }</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;   res = <a class="code" href="../../d9/db8/acl_8c.html#a911ef115f34a20ae7475d0037265996f">get_local_address</a>(ourip);</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a>(ourip, port);</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;}</div><div class="ttc" id="netsock2_8h_html_a56a46003c93bfd65111ea8ffc97af8f9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a></div><div class="ttdeci">static void ast_sockaddr_copy(struct ast_sockaddr *dst, const struct ast_sockaddr *src)</div><div class="ttdoc">Copies the data from one ast_sockaddr to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00171">netsock2.h:171</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a8d857a26518d3787a893c9ab433ddb4d"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a8d857a26518d3787a893c9ab433ddb4d">ourhost</a></div><div class="ttdeci">static char ourhost[MAXHOSTNAMELEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00238">chan_mgcp.c:238</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3">PARSE_PORT_FORBID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01135">include/asterisk/config.h:1135</a></div></div>
<div class="ttc" id="network_8h_html_afd80ecbe3170ca4fc85b65cda8659f82"><div class="ttname"><a href="../../d9/d94/network_8h.html#afd80ecbe3170ca4fc85b65cda8659f82">MAXHOSTNAMELEN</a></div><div class="ttdeci">#define MAXHOSTNAMELEN</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00069">network.h:69</a></div></div>
<div class="ttc" id="structast__sockaddr_html"><div class="ttname"><a href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a></div><div class="ttdoc">Socket address structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00097">netsock2.h:97</a></div></div>
<div class="ttc" id="acl_8c_html_a7921b536db25aa8dd3fe67dbeda2ee2a"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a7921b536db25aa8dd3fe67dbeda2ee2a">resolve_first</a></div><div class="ttdeci">static int resolve_first(struct ast_sockaddr *addr, const char *name, int flag, int family)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00876">acl.c:876</a></div></div>
<div class="ttc" id="netsock2_8h_html_a51e2841175bf3ad58a4e11ad9fb2453f"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a></div><div class="ttdeci">#define ast_sockaddr_port(addr)</div><div class="ttdoc">Get the port number of a socket address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00521">netsock2.h:521</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="netsock2_8h_html_a7704d67f19f3ca91198d8cc6e6445c3f"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a7704d67f19f3ca91198d8cc6e6445c3f">ast_sockaddr_is_any</a></div><div class="ttdeci">int ast_sockaddr_is_any(const struct ast_sockaddr *addr)</div><div class="ttdoc">Determine if the address type is unspecified, or &quot;any&quot; address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00534">netsock2.c:534</a></div></div>
<div class="ttc" id="netsock2_8h_html_ac83e6bdec376b74d02da8d2f8e1af888"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a></div><div class="ttdeci">#define ast_sockaddr_set_port(addr, port)</div><div class="ttdoc">Sets the port number of a socket address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00537">netsock2.h:537</a></div></div>
<div class="ttc" id="acl_8c_html_a652b53325b914138d49526f69f6dd546"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a652b53325b914138d49526f69f6dd546">ast_ouraddrfor</a></div><div class="ttdeci">int ast_ouraddrfor(const struct ast_sockaddr *them, struct ast_sockaddr *us)</div><div class="ttdoc">Get our local IP address when contacting a remote host. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l01005">acl.c:1005</a></div></div>
<div class="ttc" id="acl_8c_html_a911ef115f34a20ae7475d0037265996f"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a911ef115f34a20ae7475d0037265996f">get_local_address</a></div><div class="ttdeci">static int get_local_address(struct ast_sockaddr *ourip)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00118">acl.c:118</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1e76cd4becf7d678916af2ebcebd9e74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e76cd4becf7d678916af2ebcebd9e74">&#9670;&nbsp;</a></span>ast_free_acl_list()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a>* ast_free_acl_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/da4/structast__acl__list.html">ast_acl_list</a> *&#160;</td>
          <td class="paramname"><em>acl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free a list of ACLs. </p>
<p>Given the head of a list of <a class="el" href="../../d9/dc8/structast__acl.html" title="an ast_acl is a linked list node of ast_ha structs which may have names. ">ast_acl</a> structs, it and all appended acl structs will be freed. This includes the <a class="el" href="../../dc/d1d/structast__ha.html" title="internal representation of ACL entries In principle user applications would have no need for this...">ast_ha</a> structs within the individual nodes. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">acl</td><td>The list of ACLs to free </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00233">233</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00068">ast_acl::acl</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00222">ast_free_ha()</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00652">AST_LIST_HEAD_DESTROY</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00832">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">ast_acl::list</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d10/manager_8c_source.html#l09144">__init_manager()</a>, <a class="el" href="../../d5/d5e/res__pjsip__acl_8c_source.html#l00272">acl_destroy()</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00316">ast_duplicate_acl_list()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l12794">build_peer()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l13119">build_user()</a>, <a class="el" href="../../dc/df6/pjsip__configuration_8c_source.html#l02267">endpoint_destructor()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l08937">manager_free_user()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l12766">peer_destructor()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l32514">reload_config()</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l09346">rtp_reload()</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l03471">rtp_unload_acl()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l33729">sip_allow_anyrtp_remote()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l05309">sip_destroy_peer()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l06673">sip_pvt_dtor()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l35708">unload_module()</a>, and <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l13105">user_destructor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;{</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/dc8/structast__acl.html">ast_acl</a> *current;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   <span class="keywordflow">if</span> (!acl_list) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;   }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(acl_list);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   <span class="keywordflow">while</span> ((current = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(acl_list, <a class="code" href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">list</a>))) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <a class="code" href="../../d9/db8/acl_8c.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a>(current-&gt;<a class="code" href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">acl</a>);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(current);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(acl_list);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a47bafe663a14b91827082787d7654d7c">AST_LIST_HEAD_DESTROY</a>(acl_list);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(acl_list);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div><div class="ttc" id="linkedlists_8h_html_a9140a4e4d781264fa9469c52b1adae40"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a></div><div class="ttdeci">#define AST_LIST_LOCK(head)</div><div class="ttdoc">Locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00039">linkedlists.h:39</a></div></div>
<div class="ttc" id="structast__acl_html_ad063b12f30f296c6231d954bd00ef5db"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#ad063b12f30f296c6231d954bd00ef5db">ast_acl::list</a></div><div class="ttdeci">struct ast_acl::@218 list</div></div>
<div class="ttc" id="linkedlists_8h_html_ab48cb9e1e612dd486b747ba1c5d68d01"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a></div><div class="ttdeci">#define AST_LIST_UNLOCK(head)</div><div class="ttdoc">Attempts to unlock a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00139">linkedlists.h:139</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="acl_8c_html_a45dc427430b544afc0ef8e898b2c57bf"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a></div><div class="ttdeci">void ast_free_ha(struct ast_ha *ha)</div><div class="ttdoc">Free a list of HAs. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00222">acl.c:222</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a47bafe663a14b91827082787d7654d7c"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a47bafe663a14b91827082787d7654d7c">AST_LIST_HEAD_DESTROY</a></div><div class="ttdeci">#define AST_LIST_HEAD_DESTROY(head)</div><div class="ttdoc">Destroys a list head structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00652">linkedlists.h:652</a></div></div>
<div class="ttc" id="structast__acl_html_a13e2a890da2a7cfbc9ea20724e7a61b7"><div class="ttname"><a href="../../d9/dc8/structast__acl.html#a13e2a890da2a7cfbc9ea20724e7a61b7">ast_acl::acl</a></div><div class="ttdeci">struct ast_ha * acl</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00068">acl.h:68</a></div></div>
<div class="ttc" id="structast__acl_html"><div class="ttname"><a href="../../d9/dc8/structast__acl.html">ast_acl</a></div><div class="ttdoc">an ast_acl is a linked list node of ast_ha structs which may have names. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00067">acl.h:67</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aadfe2a69fbba4f27c201266a2ca5f989"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a></div><div class="ttdeci">#define AST_LIST_REMOVE_HEAD(head, field)</div><div class="ttdoc">Removes and returns the head entry from a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00832">linkedlists.h:832</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a45dc427430b544afc0ef8e898b2c57bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45dc427430b544afc0ef8e898b2c57bf">&#9670;&nbsp;</a></span>ast_free_ha()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_free_ha </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>ha</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free a list of HAs. </p>
<p>Given the head of a list of HAs, it and all appended HAs are freed</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ha</td><td>The head of the list of HAs to free </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00222">222</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, and <a class="el" href="../../d5/d59/acl_8h_source.html#l00056">ast_ha::next</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l02795">add_calltoken_ignore()</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00576">append_ha_core()</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00277">ast_duplicate_ha_list()</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00233">ast_free_acl_list()</a>, <a class="el" href="../../d2/dcf/test__acl_8c_source.html#l00040">AST_TEST_DEFINE()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l02740">build_callno_limits()</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l04598">destroy_gateway()</a>, <a class="el" href="../../da/ddd/named__acl_8c_source.html#l00148">destroy_named_acl()</a>, <a class="el" href="../../d3/d17/config__transport_8c_source.html#l00415">destroy_sip_transport_state()</a>, <a class="el" href="../../df/d91/res__pjsip__endpoint__identifier__ip_8c_source.html#l00152">ip_identify_destroy()</a>, <a class="el" href="../../da/ddd/named__acl_8c_source.html#l00240">named_acl_find_realtime()</a>, <a class="el" href="../../d0/d73/res__pjsip__logger_8c_source.html#l00396">pjsip_disable_logger()</a>, <a class="el" href="../../d0/d73/res__pjsip__logger_8c_source.html#l00351">pjsip_enable_logger_host()</a>, <a class="el" href="../../d0/d73/res__pjsip__logger_8c_source.html#l00124">pjsip_logger_session_destroy()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l32514">reload_config()</a>, <a class="el" href="../../d8/d4f/test__config_8c_source.html#l01373">test_item_destructor()</a>, <a class="el" href="../../d3/d17/config__transport_8c_source.html#l01346">transport_localnet_handler()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l35708">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d1d/structast__ha.html">ast_ha</a> *hal;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;   <span class="keywordflow">while</span> (ha) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      hal = ha;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      ha = ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(hal);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;}</div><div class="ttc" id="structast__ha_html_a904bbec16face4bc9d13a8e8c7fbf764"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">ast_ha::next</a></div><div class="ttdeci">struct ast_ha * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00056">acl.h:56</a></div></div>
<div class="ttc" id="structast__ha_html"><div class="ttname"><a href="../../dc/d1d/structast__ha.html">ast_ha</a></div><div class="ttdoc">internal representation of ACL entries In principle user applications would have no need for this...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00051">acl.h:51</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79fc6597452f2ed6fb136cb2149a6e2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79fc6597452f2ed6fb136cb2149a6e2c">&#9670;&nbsp;</a></span>ast_get_ip()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_get_ip </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>hostname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the IP address given a hostname. </p>
<p>Similar in nature to ast_gethostbyname, except that instead of getting an entire hostent structure, you instead are given only the IP address inserted into a <a class="el" href="../../d3/db3/structast__sockaddr.html" title="Socket address structure. ">ast_sockaddr</a> structure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">addr</td><td>The IP address found. The address family is used as an input parameter to filter the returned addresses. If it is AST_AF_UNSPEC, both IPv4 and IPv6 addresses can be returned. </td></tr>
    <tr><td class="paramname">hostname</td><td>The hostname to look up</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l01000">1000</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/db8/acl_8c_source.html#l00897">ast_get_ip_or_srv()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l04016">build_gateway()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l12794">build_peer()</a>, <a class="el" href="../../d0/d80/chan__skinny_8c_source.html#l07770">config_parse_variables()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l12696">peer_set_srcaddr()</a>, <a class="el" href="../../db/dd3/res__stun__monitor_8c_source.html#l00273">setup_stunaddr()</a>, and <a class="el" href="../../db/dd3/res__stun__monitor_8c_source.html#l00085">stun_monitor_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;{</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/db8/acl_8c.html#af92139f78c6e53ff418d9289d3a4c4b2">ast_get_ip_or_srv</a>(addr, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a1b83df0dadc999c990245143b83292a0">hostname</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;}</div><div class="ttc" id="acl_8c_html_af92139f78c6e53ff418d9289d3a4c4b2"><div class="ttname"><a href="../../d9/db8/acl_8c.html#af92139f78c6e53ff418d9289d3a4c4b2">ast_get_ip_or_srv</a></div><div class="ttdeci">int ast_get_ip_or_srv(struct ast_sockaddr *addr, const char *hostname, const char *service)</div><div class="ttdoc">Get the IP address given a hostname and optional service. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00897">acl.c:897</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a1b83df0dadc999c990245143b83292a0"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a1b83df0dadc999c990245143b83292a0">hostname</a></div><div class="ttdeci">static struct ast_str * hostname</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00077">cdr_mysql.c:77</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af92139f78c6e53ff418d9289d3a4c4b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af92139f78c6e53ff418d9289d3a4c4b2">&#9670;&nbsp;</a></span>ast_get_ip_or_srv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_get_ip_or_srv </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>hostname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>service</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the IP address given a hostname and optional service. </p>
<p>If the service parameter is non-NULL, then an SRV lookup will be made by prepending the service to the hostname parameter, separated by a '.' For example, if hostname is "example.com" and service is "_sip._udp" then an SRV lookup will be done for "_sip._udp.example.com". If service is NULL, then this function acts exactly like a call to ast_get_ip.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">addr</td><td>The IP address found. The address family is used as an input parameter to filter the returned addresses. If it is 0, both IPv4 and IPv6 addresses can be returned.</td></tr>
    <tr><td class="paramname">hostname</td><td>The hostname to look up </td></tr>
    <tr><td class="paramname">service</td><td>A specific service provided by the host. A NULL service results in an A-record lookup instead of an SRV lookup </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00897">897</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/d76/srv_8c_source.html#l00260">ast_get_srv()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00537">ast_sockaddr_set_port</a>, <a class="el" href="../../d0/d8a/muted_8c_source.html#l00077">host</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01135">PARSE_PORT_FORBID</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00876">resolve_first()</a>, and <a class="el" href="../../db/df1/netsock2_8h_source.html#l00098">ast_sockaddr::ss</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l01000">ast_get_ip()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l04608">create_addr()</a>, <a class="el" href="../../d0/d5d/dnsmgr_8c_source.html#l00204">dnsmgr_refresh()</a>, <a class="el" href="../../d0/d5d/dnsmgr_8c_source.html#l00151">internal_dnsmgr_lookup()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l03467">proxy_update()</a>.</p>
<div class="fragment"><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;{</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;   <span class="keywordtype">char</span> srv[256];</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a>[256];</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   <span class="keywordtype">int</span> srv_ret = 0;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;   <span class="keywordtype">int</span> tportno;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dfe/chan__sip_8c.html#a495cc24c1947d49a2b6de488a45c9d72">service</a>) {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      snprintf(srv, <span class="keyword">sizeof</span>(srv), <span class="stringliteral">&quot;%s.%s&quot;</span>, <a class="code" href="../../d5/dfe/chan__sip_8c.html#a495cc24c1947d49a2b6de488a45c9d72">service</a>, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a1b83df0dadc999c990245143b83292a0">hostname</a>);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordflow">if</span> ((srv_ret = <a class="code" href="../../d5/d60/srv_8h.html#abb197cf8faead91d33666976c469bec2">ast_get_srv</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, host, <span class="keyword">sizeof</span>(host), &amp;tportno, srv)) &gt; 0) {</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;         <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a1b83df0dadc999c990245143b83292a0">hostname</a> = <a class="code" href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a>;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      }</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;   }</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/db8/acl_8c.html#a7921b536db25aa8dd3fe67dbeda2ee2a">resolve_first</a>(addr, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a1b83df0dadc999c990245143b83292a0">hostname</a>, <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3">PARSE_PORT_FORBID</a>, addr-&gt;<a class="code" href="../../d3/db3/structast__sockaddr.html#aceb44bfc6a3800d7f419367afb25fe79">ss</a>.ss_family) != 0) {</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;   }</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;   <span class="keywordflow">if</span> (srv_ret &gt; 0) {</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <a class="code" href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a>(addr, tportno);</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;   }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;}</div><div class="ttc" id="structast__sockaddr_html_aceb44bfc6a3800d7f419367afb25fe79"><div class="ttname"><a href="../../d3/db3/structast__sockaddr.html#aceb44bfc6a3800d7f419367afb25fe79">ast_sockaddr::ss</a></div><div class="ttdeci">struct sockaddr_storage ss</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00098">netsock2.h:98</a></div></div>
<div class="ttc" id="chan__sip_8c_html_a495cc24c1947d49a2b6de488a45c9d72"><div class="ttname"><a href="../../d5/dfe/chan__sip_8c.html#a495cc24c1947d49a2b6de488a45c9d72">service</a></div><div class="ttdeci">enum ast_cc_service_type service</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dfe/chan__sip_8c_source.html#l00949">chan_sip.c:949</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3">PARSE_PORT_FORBID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01135">include/asterisk/config.h:1135</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="acl_8c_html_a7921b536db25aa8dd3fe67dbeda2ee2a"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a7921b536db25aa8dd3fe67dbeda2ee2a">resolve_first</a></div><div class="ttdeci">static int resolve_first(struct ast_sockaddr *addr, const char *name, int flag, int family)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00876">acl.c:876</a></div></div>
<div class="ttc" id="srv_8h_html_abb197cf8faead91d33666976c469bec2"><div class="ttname"><a href="../../d5/d60/srv_8h.html#abb197cf8faead91d33666976c469bec2">ast_get_srv</a></div><div class="ttdeci">int ast_get_srv(struct ast_channel *chan, char *host, int hostlen, int *port, const char *service)</div><div class="ttdoc">Lookup entry in SRV records Returns 1 if found, 0 if not found, -1 on hangup. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d76/srv_8c_source.html#l00260">srv.c:260</a></div></div>
<div class="ttc" id="muted_8c_html_a41c3a180b50c6b2ddcc1b6843a48f205"><div class="ttname"><a href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a></div><div class="ttdeci">static char host[256]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8a/muted_8c_source.html#l00077">muted.c:77</a></div></div>
<div class="ttc" id="netsock2_8h_html_ac83e6bdec376b74d02da8d2f8e1af888"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a></div><div class="ttdeci">#define ast_sockaddr_set_port(addr, port)</div><div class="ttdoc">Sets the port number of a socket address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00537">netsock2.h:537</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a1b83df0dadc999c990245143b83292a0"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a1b83df0dadc999c990245143b83292a0">hostname</a></div><div class="ttdeci">static struct ast_str * hostname</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00077">cdr_mysql.c:77</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab0feaf7768724fec1291b6d716189489"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0feaf7768724fec1291b6d716189489">&#9670;&nbsp;</a></span>ast_ha_join()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_ha_join </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>ha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert HAs to a comma separated string value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ha</td><td>the starting ha head </td></tr>
    <tr><td class="paramname">buf</td><td>string buffer to convert data to </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00723">723</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00053">ast_ha::addr</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00038">AST_SENSE_ALLOW</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00521">ast_sockaddr_port</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00260">ast_sockaddr_stringify()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00290">ast_sockaddr_stringify_addr()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l01091">ast_str_append()</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00054">ast_ha::netmask</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00056">ast_ha::next</a>, and <a class="el" href="../../d5/d59/acl_8h_source.html#l00055">ast_ha::sense</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d3/d17/config__transport_8c_source.html#l01403">localnet_to_str()</a>, and <a class="el" href="../../df/d91/res__pjsip__endpoint__identifier__ip_8c_source.html#l00570">match_to_str()</a>.</p>
<div class="fragment"><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;{</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;   <span class="keywordflow">for</span> (; ha; ha = ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>) {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>)) {</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;         addr = <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;         addr = <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;%s%s/&quot;</span>,</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;         ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a> == <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a> ? <span class="stringliteral">&quot;!&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;         addr);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="comment">/* Separated to avoid duplicating stringified addresses. */</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>));</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="keywordflow">if</span> (ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>) {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      }</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;   }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;}</div><div class="ttc" id="netsock2_8h_html_a6bf0e68e74c0a9ca9d25251b22e4d64a"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a></div><div class="ttdeci">static char * ast_sockaddr_stringify_addr(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() to return an address only. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00290">netsock2.h:290</a></div></div>
<div class="ttc" id="structast__ha_html_a904bbec16face4bc9d13a8e8c7fbf764"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">ast_ha::next</a></div><div class="ttdeci">struct ast_ha * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00056">acl.h:56</a></div></div>
<div class="ttc" id="structast__ha_html_a10838452c09fae7f0e3de86581d85379"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">ast_ha::addr</a></div><div class="ttdeci">struct ast_sockaddr addr</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00053">acl.h:53</a></div></div>
<div class="ttc" id="strings_8h_html_a1088afdd862a49b0fce34ebe02df8ca1"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a></div><div class="ttdeci">int ast_str_append(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Append to a thread local dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01091">strings.h:1091</a></div></div>
<div class="ttc" id="structast__ha_html_ac35e9125db2f5dd5dbc917f4385d03f6"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">ast_ha::sense</a></div><div class="ttdeci">enum ast_acl_sense sense</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00055">acl.h:55</a></div></div>
<div class="ttc" id="netsock2_8h_html_a51e2841175bf3ad58a4e11ad9fb2453f"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a></div><div class="ttdeci">#define ast_sockaddr_port(addr)</div><div class="ttdoc">Get the port number of a socket address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00521">netsock2.h:521</a></div></div>
<div class="ttc" id="structast__ha_html_a1a9ebad90d33f306c2b7f72174812c09"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">ast_ha::netmask</a></div><div class="ttdeci">struct ast_sockaddr netmask</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00054">acl.h:54</a></div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
<div class="ttc" id="acl_8h_html_a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2"><div class="ttname"><a href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00038">acl.h:38</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af0a935ce580773973e0e6a307d5fd7f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0a935ce580773973e0e6a307d5fd7f8">&#9670;&nbsp;</a></span>ast_ha_join_cidr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_ha_join_cidr </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>ha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert HAs to a comma separated string value using CIDR notation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ha</td><td>the starting ha head </td></tr>
    <tr><td class="paramname">buf</td><td>string buffer to convert data to </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00745">745</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00053">ast_ha::addr</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00038">AST_SENSE_ALLOW</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00130">ast_sockaddr_cidr_bits()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00290">ast_sockaddr_stringify_addr()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l01091">ast_str_append()</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00054">ast_ha::netmask</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00056">ast_ha::next</a>, and <a class="el" href="../../d5/d59/acl_8h_source.html#l00055">ast_ha::sense</a>.</p>
<div class="fragment"><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;{</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   <span class="keywordflow">for</span> (; ha; ha = ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>) {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a> = <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;%s%s/%d&quot;</span>,</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a> == <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a> ? <span class="stringliteral">&quot;!&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                addr, <a class="code" href="../../db/df1/netsock2_8h.html#a32aa436e84f750f70e27f326e2515666">ast_sockaddr_cidr_bits</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>));</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="keywordflow">if</span> (ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>) {</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      }</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;   }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;}</div><div class="ttc" id="netsock2_8h_html_a6bf0e68e74c0a9ca9d25251b22e4d64a"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a></div><div class="ttdeci">static char * ast_sockaddr_stringify_addr(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() to return an address only. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00290">netsock2.h:290</a></div></div>
<div class="ttc" id="structast__ha_html_a904bbec16face4bc9d13a8e8c7fbf764"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">ast_ha::next</a></div><div class="ttdeci">struct ast_ha * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00056">acl.h:56</a></div></div>
<div class="ttc" id="structast__ha_html_a10838452c09fae7f0e3de86581d85379"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">ast_ha::addr</a></div><div class="ttdeci">struct ast_sockaddr addr</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00053">acl.h:53</a></div></div>
<div class="ttc" id="strings_8h_html_a1088afdd862a49b0fce34ebe02df8ca1"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a></div><div class="ttdeci">int ast_str_append(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Append to a thread local dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01091">strings.h:1091</a></div></div>
<div class="ttc" id="structast__ha_html_ac35e9125db2f5dd5dbc917f4385d03f6"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">ast_ha::sense</a></div><div class="ttdeci">enum ast_acl_sense sense</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00055">acl.h:55</a></div></div>
<div class="ttc" id="structast__ha_html_a1a9ebad90d33f306c2b7f72174812c09"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">ast_ha::netmask</a></div><div class="ttdeci">struct ast_sockaddr netmask</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00054">acl.h:54</a></div></div>
<div class="ttc" id="acl_8h_html_a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2"><div class="ttname"><a href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00038">acl.h:38</a></div></div>
<div class="ttc" id="netsock2_8h_html_a32aa436e84f750f70e27f326e2515666"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a32aa436e84f750f70e27f326e2515666">ast_sockaddr_cidr_bits</a></div><div class="ttdeci">int ast_sockaddr_cidr_bits(const struct ast_sockaddr *sa)</div><div class="ttdoc">Count the 1 bits in a netmask. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00130">netsock2.c:130</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5a334dacaa1821d4eb0b12828a38a623"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a334dacaa1821d4eb0b12828a38a623">&#9670;&nbsp;</a></span>ast_ha_output()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_ha_output </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>ha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>prefix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>output an HA to the provided fd </p>
<p>This function can be used centrally to output HAs as used in ACLs from other modules. It follows the format as originally used for named ACLs in named_acl.c.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>The file-descriptor to which to output the HA. </td></tr>
    <tr><td class="paramname">ha</td><td>The HA to output. </td></tr>
    <tr><td class="paramname">prefix</td><td>If you need a specific prefix output on each line, give it here, may be NULL.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.33.0, 16.10.0, 17.4.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l01087">1087</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00053">ast_ha::addr</a>, <a class="el" href="../../da/d4d/clicompat_8c_source.html#l00006">ast_cli()</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00038">AST_SENSE_ALLOW</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00046">AST_SOCKADDR_BUFLEN</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00290">ast_sockaddr_stringify_addr()</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00054">ast_ha::netmask</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00056">ast_ha::next</a>, and <a class="el" href="../../d5/d59/acl_8h_source.html#l00055">ast_ha::sense</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l01099">ast_acl_output()</a>, and <a class="el" href="../../da/ddd/named__acl_8c_source.html#l00412">cli_display_named_acl()</a>.</p>
<div class="fragment"><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;{</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>[<a class="code" href="../../db/df1/netsock2_8h.html#aded4d9ff3f772448b4716fd90ed47c8d">AST_SOCKADDR_BUFLEN</a>];</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;   <span class="keywordtype">char</span> *mask;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;   <span class="keywordtype">int</span> index = 0;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;   <span class="keywordflow">for</span> (; ha; ha = ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>, ++index) {</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      strcpy(addr, <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>));</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      mask = <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s%3d: %s - %s/%s\n&quot;</span>, <a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a> ?: <span class="stringliteral">&quot;&quot;</span>, index, ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a> == <a class="code" href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a> ? <span class="stringliteral">&quot;allow&quot;</span> : <span class="stringliteral">&quot; deny&quot;</span>, addr, mask);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;   }</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;}</div><div class="ttc" id="netsock2_8h_html_a6bf0e68e74c0a9ca9d25251b22e4d64a"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a></div><div class="ttdeci">static char * ast_sockaddr_stringify_addr(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() to return an address only. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00290">netsock2.h:290</a></div></div>
<div class="ttc" id="structast__ha_html_a904bbec16face4bc9d13a8e8c7fbf764"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">ast_ha::next</a></div><div class="ttdeci">struct ast_ha * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00056">acl.h:56</a></div></div>
<div class="ttc" id="netsock2_8h_html_aded4d9ff3f772448b4716fd90ed47c8d"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aded4d9ff3f772448b4716fd90ed47c8d">AST_SOCKADDR_BUFLEN</a></div><div class="ttdeci">#define AST_SOCKADDR_BUFLEN</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00046">netsock2.h:46</a></div></div>
<div class="ttc" id="structast__ha_html_a10838452c09fae7f0e3de86581d85379"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">ast_ha::addr</a></div><div class="ttdeci">struct ast_sockaddr addr</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00053">acl.h:53</a></div></div>
<div class="ttc" id="structast__ha_html_ac35e9125db2f5dd5dbc917f4385d03f6"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">ast_ha::sense</a></div><div class="ttdeci">enum ast_acl_sense sense</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00055">acl.h:55</a></div></div>
<div class="ttc" id="cli_8h_html_a791bf9f5637185bee5e8f0907c762130"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a></div><div class="ttdeci">void ast_cli(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00006">clicompat.c:6</a></div></div>
<div class="ttc" id="structast__ha_html_a1a9ebad90d33f306c2b7f72174812c09"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">ast_ha::netmask</a></div><div class="ttdeci">struct ast_sockaddr netmask</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00054">acl.h:54</a></div></div>
<div class="ttc" id="acl_8h_html_a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2"><div class="ttname"><a href="../../d5/d59/acl_8h.html#a764d04fe9485be95771e652dc2c87445aa0513e1a62f9d6275b8f3667b7dff6d2">AST_SENSE_ALLOW</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00038">acl.h:38</a></div></div>
<div class="ttc" id="http_8c_html_a6f25bc812d09fedb86bf394c01061c56"><div class="ttname"><a href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a></div><div class="ttdeci">static char prefix[MAX_PREFIX]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00141">http.c:141</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a652b53325b914138d49526f69f6dd546"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a652b53325b914138d49526f69f6dd546">&#9670;&nbsp;</a></span>ast_ouraddrfor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_ouraddrfor </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>them</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>us</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get our local IP address when contacting a remote host. </p>
<p>This function will attempt to connect(2) to them over UDP using a source port of 5060. If the connect(2) call is successful, then we inspect the sockaddr_in output parameter of connect(2) to determine the IP address used to connect to them. This IP address is then copied into us.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">them</td><td>The IP address to which we wish to attempt to connect </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">us</td><td>The source IP address used to connect to them </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
    <tr><td class="paramname">0</td><td>Success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l01005">1005</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00595">ast_connect()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00600">ast_getsockname()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00524">ast_sockaddr_is_ipv6()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00521">ast_sockaddr_port</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00537">ast_sockaddr_set_port</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00290">ast_sockaddr_stringify_addr()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00300">ast_strdupa</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, and <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l01052">ast_find_ourip()</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l08497">ast_rtp_remote_address_set()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l03866">ast_sip_ouraddrfor()</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l04016">build_gateway()</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l01777">find_subchannel_and_lock()</a>, <a class="el" href="../../d8/d06/sip_2dialplan__functions_8c_source.html#l00127">sip_acf_channel_read()</a>, and <a class="el" href="../../d0/d2b/chan__rtp_8c_source.html#l00269">unicast_rtp_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;{</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">    * We must create the errno string before creating the address</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">    * string because it could wipe out errno on the error return</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">    * paths.</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *sock_err;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;   <span class="keywordtype">int</span> port;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;   <span class="keywordtype">int</span> s;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;   <span class="comment">/* Preserve our original address port */</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;   port = <a class="code" href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a>(us);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;   s = socket(<a class="code" href="../../db/df1/netsock2_8h.html#a579748bd6ceddd06b1cc6eb3578e8acc">ast_sockaddr_is_ipv6</a>(them) ? AF_INET6 : AF_INET, SOCK_DGRAM, 0);</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;   <span class="keywordflow">if</span> (s &lt; 0) {</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      sock_err = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot create socket to %s: %s\n&quot;</span>,</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(them), sock_err);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;   }</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a16d4f77ca9af75e4afb60accca62e819">ast_connect</a>(s, them)) {</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      sock_err = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot connect to %s: %s\n&quot;</span>,</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(them), sock_err);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      close(s);</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;   }</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a13c172d0480d5cfa48bfef5d38cb5091">ast_getsockname</a>(s, us)) {</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      sock_err = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot get socket name for connection to %s: %s\n&quot;</span>,</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(them), sock_err);</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      close(s);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;   }</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;   close(s);</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a>(us, port);</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;For destination &#39;%s&#39;, our source address is &#39;%s&#39;.\n&quot;</span>,</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(them)),</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a>(us)));</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;}</div><div class="ttc" id="netsock2_8h_html_a6bf0e68e74c0a9ca9d25251b22e4d64a"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a6bf0e68e74c0a9ca9d25251b22e4d64a">ast_sockaddr_stringify_addr</a></div><div class="ttdeci">static char * ast_sockaddr_stringify_addr(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() to return an address only. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00290">netsock2.h:290</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="netsock2_8h_html_a51e2841175bf3ad58a4e11ad9fb2453f"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a51e2841175bf3ad58a4e11ad9fb2453f">ast_sockaddr_port</a></div><div class="ttdeci">#define ast_sockaddr_port(addr)</div><div class="ttdoc">Get the port number of a socket address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00521">netsock2.h:521</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="netsock2_8h_html_ac83e6bdec376b74d02da8d2f8e1af888"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#ac83e6bdec376b74d02da8d2f8e1af888">ast_sockaddr_set_port</a></div><div class="ttdeci">#define ast_sockaddr_set_port(addr, port)</div><div class="ttdoc">Sets the port number of a socket address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00537">netsock2.h:537</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="netsock2_8h_html_a13c172d0480d5cfa48bfef5d38cb5091"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a13c172d0480d5cfa48bfef5d38cb5091">ast_getsockname</a></div><div class="ttdeci">int ast_getsockname(int sockfd, struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around getsockname(2) that uses struct ast_sockaddr. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00600">netsock2.c:600</a></div></div>
<div class="ttc" id="netsock2_8h_html_a579748bd6ceddd06b1cc6eb3578e8acc"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a579748bd6ceddd06b1cc6eb3578e8acc">ast_sockaddr_is_ipv6</a></div><div class="ttdeci">int ast_sockaddr_is_ipv6(const struct ast_sockaddr *addr)</div><div class="ttdoc">Determine if this is an IPv6 address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00524">netsock2.c:524</a></div></div>
<div class="ttc" id="netsock2_8h_html_a16d4f77ca9af75e4afb60accca62e819"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a16d4f77ca9af75e4afb60accca62e819">ast_connect</a></div><div class="ttdeci">int ast_connect(int sockfd, const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around connect(2) that uses struct ast_sockaddr. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00595">netsock2.c:595</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad364a9241e15fc0dbec0ffcb88f64671"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad364a9241e15fc0dbec0ffcb88f64671">&#9670;&nbsp;</a></span>ast_str2cos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_str2cos </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>cos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a string to the appropriate COS value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">value</td><td>The COS string to convert </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cos</td><td>The integer representation of that COS value </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
    <tr><td class="paramname">0</td><td>Success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00953">953</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/d80/chan__skinny_8c_source.html#l07770">config_parse_variables()</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l04683">reload_config()</a>, and <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l13476">set_config()</a>.</p>
<div class="fragment"><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;{</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;   <span class="keywordtype">int</span> fval;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;   <span class="keywordflow">if</span> (sscanf(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;fval) == 1) {</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="keywordflow">if</span> (fval &lt; 8) {</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;          *<a class="code" href="../../d5/dff/chan__iax2_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a> = fval;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;          <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      }</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;   }</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;}</div><div class="ttc" id="chan__iax2_8c_html_ae91dad65f553f7afebe4af507803bc7f"><div class="ttname"><a href="../../d5/dff/chan__iax2_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a></div><div class="ttdeci">unsigned int cos</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dff/chan__iax2_8c_source.html#l00352">chan_iax2.c:352</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a49d1eefe77636e2a63ad013afa0fc3b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49d1eefe77636e2a63ad013afa0fc3b5">&#9670;&nbsp;</a></span>ast_str2tos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_str2tos </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>tos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a string to the appropriate TOS value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">value</td><td>The TOS string to convert </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tos</td><td>The integer representation of that TOS value </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
    <tr><td class="paramname">0</td><td>Success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00967">967</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/dfe/isdn__lib_8c_source.html#l00042">ARRAY_LEN</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00923">dscp_codepoint::name</a>, and <a class="el" href="../../d9/db8/acl_8c_source.html#l00924">dscp_codepoint::space</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/d80/chan__skinny_8c_source.html#l07770">config_parse_variables()</a>, <a class="el" href="../../d8/d4f/provision_8c_source.html#l00282">iax_template_parse()</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l04683">reload_config()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l13476">set_config()</a>, <a class="el" href="../../dc/df6/pjsip__configuration_8c_source.html#l00950">tos_handler()</a>, and <a class="el" href="../../d3/d17/config__transport_8c_source.html#l01419">transport_tos_handler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;{</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;   <span class="keywordtype">int</span> fval;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;   <span class="keywordflow">if</span> (sscanf(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="stringliteral">&quot;%30i&quot;</span>, &amp;fval) == 1) {</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      *<a class="code" href="../../d5/dff/chan__iax2_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a> = fval &amp; 0xFF;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;   }</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="../../d9/db8/acl_8c.html#a019ca3744d6db4c4c8ecef752fc84a89">dscp_pool1</a>); x++) {</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <a class="code" href="../../d9/db8/acl_8c.html#a019ca3744d6db4c4c8ecef752fc84a89">dscp_pool1</a>[x].<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)) {</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;         *<a class="code" href="../../d5/dff/chan__iax2_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a> = <a class="code" href="../../d9/db8/acl_8c.html#a019ca3744d6db4c4c8ecef752fc84a89">dscp_pool1</a>[x].<a class="code" href="../../de/d3f/structdscp__codepoint.html#af041b9f420eaa4774ba9fa9e5820e468">space</a> &lt;&lt; 2;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      }</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;   }</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;}</div><div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="acl_8c_html_a019ca3744d6db4c4c8ecef752fc84a89"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a019ca3744d6db4c4c8ecef752fc84a89">dscp_pool1</a></div><div class="ttdeci">static const struct dscp_codepoint dscp_pool1[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00929">acl.c:929</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="chan__iax2_8c_html_a25a9305efab3b493ca2519562fcec3d5"><div class="ttname"><a href="../../d5/dff/chan__iax2_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a></div><div class="ttdeci">unsigned int tos</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dff/chan__iax2_8c_source.html#l00351">chan_iax2.c:351</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="structdscp__codepoint_html_af041b9f420eaa4774ba9fa9e5820e468"><div class="ttname"><a href="../../de/d3f/structdscp__codepoint.html#af041b9f420eaa4774ba9fa9e5820e468">dscp_codepoint::space</a></div><div class="ttdeci">unsigned int space</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00924">acl.c:924</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a18813aaabb1644f4083746b798a351a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18813aaabb1644f4083746b798a351a0">&#9670;&nbsp;</a></span>ast_tos2str()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_tos2str </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>tos</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a TOS value into its string representation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tos</td><td>The TOS value to look up </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The string equivalent of the TOS value </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00987">987</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/dfe/isdn__lib_8c_source.html#l00042">ARRAY_LEN</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00923">dscp_codepoint::name</a>, and <a class="el" href="../../d9/db8/acl_8c_source.html#l00924">dscp_codepoint::space</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l21842">sip_show_settings()</a>.</p>
<div class="fragment"><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;{</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;   <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="../../d9/db8/acl_8c.html#a019ca3744d6db4c4c8ecef752fc84a89">dscp_pool1</a>); x++) {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/db8/acl_8c.html#a019ca3744d6db4c4c8ecef752fc84a89">dscp_pool1</a>[x].space == (<a class="code" href="../../d5/dff/chan__iax2_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a> &gt;&gt; 2)) {</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d9/db8/acl_8c.html#a019ca3744d6db4c4c8ecef752fc84a89">dscp_pool1</a>[x].<a class="code" href="../../de/d3f/structdscp__codepoint.html#a5ac083a645d964373f022d03df4849c8">name</a>;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;   }</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;   <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;}</div><div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="acl_8c_html_a019ca3744d6db4c4c8ecef752fc84a89"><div class="ttname"><a href="../../d9/db8/acl_8c.html#a019ca3744d6db4c4c8ecef752fc84a89">dscp_pool1</a></div><div class="ttdeci">static const struct dscp_codepoint dscp_pool1[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00929">acl.c:929</a></div></div>
<div class="ttc" id="structdscp__codepoint_html_a5ac083a645d964373f022d03df4849c8"><div class="ttname"><a href="../../de/d3f/structdscp__codepoint.html#a5ac083a645d964373f022d03df4849c8">dscp_codepoint::name</a></div><div class="ttdeci">char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00923">acl.c:923</a></div></div>
<div class="ttc" id="chan__iax2_8c_html_a25a9305efab3b493ca2519562fcec3d5"><div class="ttname"><a href="../../d5/dff/chan__iax2_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a></div><div class="ttdeci">unsigned int tos</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dff/chan__iax2_8c_source.html#l00351">chan_iax2.c:351</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9a123afe636344384d23d4880c3a458b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a123afe636344384d23d4880c3a458b">&#9670;&nbsp;</a></span>debug_ha_sense_appended()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void debug_ha_sense_appended </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/d1d/structast__ha.html">ast_ha</a> *&#160;</td>
          <td class="paramname"><em>ha</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00566">566</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d59/acl_8h_source.html#l00053">ast_ha::addr</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00260">ast_sockaddr_stringify()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00300">ast_strdupa</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00241">LOG_DEBUG</a>, <a class="el" href="../../d5/d59/acl_8h_source.html#l00054">ast_ha::netmask</a>, and <a class="el" href="../../d5/d59/acl_8h_source.html#l00055">ast_ha::sense</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l00576">append_ha_core()</a>.</p>
<div class="fragment"><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;{</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *parsed_mask = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">netmask</a>));</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;%s/%s sense %u appended to ACL\n&quot;</span>,</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">addr</a>),</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      parsed_mask,</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      ha-&gt;<a class="code" href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">sense</a>);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;}</div><div class="ttc" id="structast__ha_html_a10838452c09fae7f0e3de86581d85379"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a10838452c09fae7f0e3de86581d85379">ast_ha::addr</a></div><div class="ttdeci">struct ast_sockaddr addr</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00053">acl.h:53</a></div></div>
<div class="ttc" id="structast__ha_html_ac35e9125db2f5dd5dbc917f4385d03f6"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#ac35e9125db2f5dd5dbc917f4385d03f6">ast_ha::sense</a></div><div class="ttdeci">enum ast_acl_sense sense</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00055">acl.h:55</a></div></div>
<div class="ttc" id="logger_8h_html_a6ff63e8955665c4a58b1598f2b07c51a"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a></div><div class="ttdeci">#define LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00241">logger.h:241</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__ha_html_a1a9ebad90d33f306c2b7f72174812c09"><div class="ttname"><a href="../../dc/d1d/structast__ha.html#a1a9ebad90d33f306c2b7f72174812c09">ast_ha::netmask</a></div><div class="ttdeci">struct ast_sockaddr netmask</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d59/acl_8h_source.html#l00054">acl.h:54</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a911ef115f34a20ae7475d0037265996f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a911ef115f34a20ae7475d0037265996f">&#9670;&nbsp;</a></span>get_local_address()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_local_address </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>ourip</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00118">118</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00193">ast_malloc</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00140">ast_sockaddr_setnull()</a>, <a class="el" href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">buf</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/db8/acl_8c_source.html#l00059">score_address()</a>, and <a class="el" href="../../db/df1/netsock2_8h_source.html#l00098">ast_sockaddr::ss</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l01052">ast_find_ourip()</a>.</p>
<div class="fragment"><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;{</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;   <span class="keywordtype">int</span> s, res = -1;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#ifdef SOLARIS</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;   <span class="keyword">struct </span>lifreq *ifr = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;   <span class="keyword">struct </span>lifnum ifn;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;   <span class="keyword">struct </span>lifconf ifc;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;   <span class="keyword">struct </span>sockaddr_in *sa;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   <span class="keywordtype">int</span> bufsz, x;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* SOLARIS */</span><span class="preprocessor"></span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">#if defined(__OpenBSD__) || defined(__NetBSD__) || defined(__FreeBSD__) || defined(__linux__) || defined(__Darwin__) || defined(__GLIBC__)</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;   <span class="keyword">struct </span>ifaddrs *ifap, *ifaphead;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   <span class="keywordtype">int</span> rtnerr;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span>sockaddr_in *sin;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* BSD_OR_LINUX */</span><span class="preprocessor"></span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;   <span class="keyword">struct </span>in_addr best_addr;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;   <span class="keywordtype">int</span> best_score = -100;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   memset(&amp;best_addr, 0, <span class="keyword">sizeof</span>(best_addr));</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="preprocessor">#if defined(__OpenBSD__) || defined(__NetBSD__) || defined(__FreeBSD__) || defined(__linux__) || defined(__Darwin__) || defined(__GLIBC__)</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;   rtnerr = getifaddrs(&amp;ifaphead);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;   <span class="keywordflow">if</span> (rtnerr) {</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      perror(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;   }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* BSD_OR_LINUX */</span><span class="preprocessor"></span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;   s = socket(AF_INET, SOCK_STREAM, 0);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   <span class="keywordflow">if</span> (s &gt; 0) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">#if defined(__OpenBSD__) || defined(__NetBSD__) || defined(__FreeBSD__) || defined(__linux__) || defined(__Darwin__) || defined(__GLIBC__)</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="keywordflow">for</span> (ifap = ifaphead; ifap; ifap = ifap-&gt;ifa_next) {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;         <span class="keywordflow">if</span> (ifap-&gt;ifa_addr &amp;&amp; ifap-&gt;ifa_addr-&gt;sa_family == AF_INET) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            sin = (<span class="keyword">const</span> <span class="keyword">struct </span>sockaddr_in *) ifap-&gt;ifa_addr;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <a class="code" href="../../d9/db8/acl_8c.html#aa99f86aca9edb530c0e6e1c3653f1557">score_address</a>(sin, &amp;best_addr, &amp;best_score);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            res = 0;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="keywordflow">if</span> (best_score == 0) {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;         }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* BSD_OR_LINUX */</span><span class="preprocessor"></span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <span class="comment">/* There is no reason whatsoever that this shouldn&#39;t work on Linux or BSD also. */</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="preprocessor">#ifdef SOLARIS</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="comment">/* Get a count of interfaces on the machine */</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      ifn.lifn_family = AF_INET;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      ifn.lifn_flags = 0;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      ifn.lifn_count = 0;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordflow">if</span> (ioctl(s, SIOCGLIFNUM, &amp;ifn) &lt; 0) {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;         close(s);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      bufsz = ifn.lifn_count * <span class="keyword">sizeof</span>(<span class="keyword">struct </span>lifreq);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keywordflow">if</span> (!(buf = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(bufsz))) {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;         close(s);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      memset(buf, 0, bufsz);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="comment">/* Get a list of interfaces on the machine */</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      ifc.lifc_len = bufsz;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      ifc.lifc_buf = <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      ifc.lifc_family = AF_INET;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      ifc.lifc_flags = 0;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordflow">if</span> (ioctl(s, SIOCGLIFCONF, &amp;ifc) &lt; 0) {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;         close(s);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(buf);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="keywordflow">for</span> (ifr = ifc.lifc_req, x = 0; x &lt; ifn.lifn_count; ifr++, x++) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;         sa = (<span class="keyword">struct </span>sockaddr_in *)&amp;(ifr-&gt;lifr_addr);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;         <a class="code" href="../../d9/db8/acl_8c.html#aa99f86aca9edb530c0e6e1c3653f1557">score_address</a>(sa, &amp;best_addr, &amp;best_score);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;         res = 0;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;         <span class="keywordflow">if</span> (best_score == 0) {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;         }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(buf);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* SOLARIS */</span><span class="preprocessor"></span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      close(s);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;   }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="preprocessor">#if defined(__OpenBSD__) || defined(__NetBSD__) || defined(__FreeBSD__) || defined(__linux__) || defined(__Darwin__)</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;   freeifaddrs(ifaphead);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* BSD_OR_LINUX */</span><span class="preprocessor"></span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;   <span class="keywordflow">if</span> (res == 0 &amp;&amp; ourip) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <a class="code" href="../../db/df1/netsock2_8h.html#ad91b5dfe4c188d15f4b2e9e2ec5d8864">ast_sockaddr_setnull</a>(ourip);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      ourip-&gt;<a class="code" href="../../d3/db3/structast__sockaddr.html#aceb44bfc6a3800d7f419367afb25fe79">ss</a>.ss_family = AF_INET;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      ((<span class="keyword">struct </span>sockaddr_in *)&amp;ourip-&gt;<a class="code" href="../../d3/db3/structast__sockaddr.html#aceb44bfc6a3800d7f419367afb25fe79">ss</a>)-&gt;sin_addr = best_addr;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}</div><div class="ttc" id="structast__sockaddr_html_aceb44bfc6a3800d7f419367afb25fe79"><div class="ttname"><a href="../../d3/db3/structast__sockaddr.html#aceb44bfc6a3800d7f419367afb25fe79">ast_sockaddr::ss</a></div><div class="ttdeci">struct sockaddr_storage ss</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00098">netsock2.h:98</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="netsock2_8h_html_ad91b5dfe4c188d15f4b2e9e2ec5d8864"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#ad91b5dfe4c188d15f4b2e9e2ec5d8864">ast_sockaddr_setnull</a></div><div class="ttdeci">static void ast_sockaddr_setnull(struct ast_sockaddr *addr)</div><div class="ttdoc">Sets address addr to null. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00140">netsock2.h:140</a></div></div>
<div class="ttc" id="acl_8c_html_aa99f86aca9edb530c0e6e1c3653f1557"><div class="ttname"><a href="../../d9/db8/acl_8c.html#aa99f86aca9edb530c0e6e1c3653f1557">score_address</a></div><div class="ttdeci">static void score_address(const struct sockaddr_in *sin, struct in_addr *best_addr, int *best_score)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db8/acl_8c_source.html#l00059">acl.c:59</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a55e08be7e4878f9e4ea936ad6c6f43d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55e08be7e4878f9e4ea936ad6c6f43d9">&#9670;&nbsp;</a></span>parse_cidr_mask()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int parse_cidr_mask </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>is_v4</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mask_str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse a netmask in CIDR notation. </p>
<p>For a mask of an IPv4 address, this should be a number between 0 and 32. For a mask of an IPv6 address, this should be a number between 0 and 128. This function creates an IPv6 <a class="el" href="../../d3/db3/structast__sockaddr.html" title="Socket address structure. ">ast_sockaddr</a> from the given netmask. For masks of IPv4 addresses, this is accomplished by adding 96 to the original netmask.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">addr</td><td>The <a class="el" href="../../d3/db3/structast__sockaddr.html" title="Socket address structure. ">ast_sockaddr</a> produced from the CIDR netmask </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">is_v4</td><td>Tells if the address we are masking is IPv4. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">mask_str</td><td>The CIDR mask to convert </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
    <tr><td class="paramname">0</td><td>Success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00382">382</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../db/df1/netsock2_8h_source.html#l00782">ast_sockaddr_from_sin</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00099">ast_sockaddr::len</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00098">ast_sockaddr::ss</a>, and <a class="el" href="../../db/df1/netsock2_8h_source.html#l00077">V6_WORD</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l00576">append_ha_core()</a>.</p>
<div class="fragment"><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;{</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   <span class="keywordtype">int</span> mask;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   <span class="keywordflow">if</span> (sscanf(mask_str, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;mask) != 1) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;   }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   <span class="keywordflow">if</span> (is_v4) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keyword">struct </span>sockaddr_in sin;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keywordflow">if</span> (mask &lt; 0 || mask &gt; 32) {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      memset(&amp;sin, 0, <span class="keyword">sizeof</span>(sin));</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      sin.sin_family = AF_INET;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="comment">/* If mask is 0, then we already have the</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">       * appropriate all 0s address in sin from</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">       * the above memset.</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="keywordflow">if</span> (mask != 0) {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;         sin.sin_addr.s_addr = htonl(0xFFFFFFFF &lt;&lt; (32 - mask));</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <a class="code" href="../../db/df1/netsock2_8h.html#ad68264a6784dc22570eda3cb447307f8">ast_sockaddr_from_sin</a>(addr, &amp;sin);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keyword">struct </span>sockaddr_in6 sin6;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keywordflow">if</span> (mask &lt; 0 || mask &gt; 128) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      memset(&amp;sin6, 0, <span class="keyword">sizeof</span>(sin6));</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      sin6.sin6_family = AF_INET6;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; 4; ++i) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;         <span class="comment">/* Once mask reaches 0, we don&#39;t have</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">          * to explicitly set anything anymore</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">          * since sin6 was zeroed out already</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;         <span class="keywordflow">if</span> (mask &gt; 0) {</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <a class="code" href="../../db/df1/netsock2_8h.html#a852cefdb97546e12263c5b1a01b570ff">V6_WORD</a>(&amp;sin6, i) = htonl(0xFFFFFFFF &lt;&lt; (mask &lt; 32 ? (32 - mask) : 0));</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            mask -= mask &lt; 32 ? mask : 32;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;         }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      }</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      memcpy(&amp;addr-&gt;<a class="code" href="../../d3/db3/structast__sockaddr.html#aceb44bfc6a3800d7f419367afb25fe79">ss</a>, &amp;sin6, <span class="keyword">sizeof</span>(sin6));</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      addr-&gt;<a class="code" href="../../d3/db3/structast__sockaddr.html#ad04e8181049f819e1df2c7cac72a53ce">len</a> = <span class="keyword">sizeof</span>(sin6);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div><div class="ttc" id="structast__sockaddr_html_aceb44bfc6a3800d7f419367afb25fe79"><div class="ttname"><a href="../../d3/db3/structast__sockaddr.html#aceb44bfc6a3800d7f419367afb25fe79">ast_sockaddr::ss</a></div><div class="ttdeci">struct sockaddr_storage ss</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00098">netsock2.h:98</a></div></div>
<div class="ttc" id="structast__sockaddr_html_ad04e8181049f819e1df2c7cac72a53ce"><div class="ttname"><a href="../../d3/db3/structast__sockaddr.html#ad04e8181049f819e1df2c7cac72a53ce">ast_sockaddr::len</a></div><div class="ttdeci">socklen_t len</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00099">netsock2.h:99</a></div></div>
<div class="ttc" id="netsock2_8h_html_ad68264a6784dc22570eda3cb447307f8"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#ad68264a6784dc22570eda3cb447307f8">ast_sockaddr_from_sin</a></div><div class="ttdeci">#define ast_sockaddr_from_sin(addr, sin)</div><div class="ttdoc">Converts a struct sockaddr_in to a struct ast_sockaddr. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00782">netsock2.h:782</a></div></div>
<div class="ttc" id="netsock2_8h_html_a852cefdb97546e12263c5b1a01b570ff"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a852cefdb97546e12263c5b1a01b570ff">V6_WORD</a></div><div class="ttdeci">#define V6_WORD(sin6, index)</div><div class="ttdoc">Isolate a 32-bit section of an IPv6 address. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00077">netsock2.h:77</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7921b536db25aa8dd3fe67dbeda2ee2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7921b536db25aa8dd3fe67dbeda2ee2a">&#9670;&nbsp;</a></span>resolve_first()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int resolve_first </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00876">876</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00171">ast_sockaddr_copy()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00280">ast_sockaddr_resolve()</a>, and <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l01052">ast_find_ourip()</a>, and <a class="el" href="../../d9/db8/acl_8c_source.html#l00897">ast_get_ip_or_srv()</a>.</p>
<div class="fragment"><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;{</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *addrs;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;   <span class="keywordtype">int</span> addrs_cnt;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;   addrs_cnt = <a class="code" href="../../db/df1/netsock2_8h.html#a8ba6f5b5a9de09137dd18fe2d9592880">ast_sockaddr_resolve</a>(&amp;addrs, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <a class="code" href="../../dc/dc2/f2c_8h.html#abf5d144da384425ae6cb542ce6eec8d3">flag</a>, family);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;   <span class="keywordflow">if</span> (addrs_cnt &gt; 0) {</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      <span class="keywordflow">if</span> (addrs_cnt &gt; 1) {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Multiple addresses. Using the first only\n&quot;</span>);</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      }</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <a class="code" href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a>(addr, &amp;addrs[0]);</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(addrs);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to lookup &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;   }</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;}</div><div class="ttc" id="netsock2_8h_html_a56a46003c93bfd65111ea8ffc97af8f9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a></div><div class="ttdeci">static void ast_sockaddr_copy(struct ast_sockaddr *dst, const struct ast_sockaddr *src)</div><div class="ttdoc">Copies the data from one ast_sockaddr to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00171">netsock2.h:171</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="structast__sockaddr_html"><div class="ttname"><a href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a></div><div class="ttdoc">Socket address structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00097">netsock2.h:97</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="f2c_8h_html_abf5d144da384425ae6cb542ce6eec8d3"><div class="ttname"><a href="../../dc/dc2/f2c_8h.html#abf5d144da384425ae6cb542ce6eec8d3">flag</a></div><div class="ttdeci">long int flag</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dc2/f2c_8h_source.html#l00083">f2c.h:83</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="netsock2_8h_html_a8ba6f5b5a9de09137dd18fe2d9592880"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a8ba6f5b5a9de09137dd18fe2d9592880">ast_sockaddr_resolve</a></div><div class="ttdeci">int ast_sockaddr_resolve(struct ast_sockaddr **addrs, const char *str, int flags, int family)</div><div class="ttdoc">Parses a string with an IPv4 or IPv6 address and place results into an array. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00280">netsock2.c:280</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa99f86aca9edb530c0e6e1c3653f1557"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa99f86aca9edb530c0e6e1c3653f1557">&#9670;&nbsp;</a></span>score_address()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void score_address </td>
          <td>(</td>
          <td class="paramtype">const struct sockaddr_in *&#160;</td>
          <td class="paramname"><em>sin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr *&#160;</td>
          <td class="paramname"><em>best_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>best_score</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="section note"><dt>Note</dt><dd>Better score than a test network, but not quite as good as RFC 1918 address space. The reason is that some Linux distributions automatically configure a Zeroconf address before trying DHCP, so we want to prefer a DHCP lease to a Zeroconf address.</dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00059">59</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00782">ast_inet_ntoa()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/db8/acl_8c_source.html#l00118">get_local_address()</a>.</p>
<div class="fragment"><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;{</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/dc2/f2c_8h.html#a27c1bdb0cba23a9db2a51eed7b3b2ac1">address</a>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;   <span class="keywordtype">int</span> score;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;   address = <a class="code" href="../../d9/d94/network_8h.html#a5a735cb59e8a8ddd78078d396db7e106">ast_inet_ntoa</a>(sin-&gt;sin_addr);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;   <span class="comment">/* RFC 1700 alias for the local network */</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;   <span class="keywordflow">if</span> (address[0] == <span class="charliteral">&#39;0&#39;</span>) {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      score = -25;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   <span class="comment">/* RFC 1700 localnet */</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(address, <span class="stringliteral">&quot;127&quot;</span>, 3) == 0) {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      score = -20;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;   <span class="comment">/* RFC 1918 non-public address space */</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(address, <span class="stringliteral">&quot;10.&quot;</span>, 3) == 0) {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      score = -5;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   <span class="comment">/* RFC 1918 non-public address space */</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(address, <span class="stringliteral">&quot;172&quot;</span>, 3) == 0) {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <span class="comment">/* 172.16.0.0 - 172.19.255.255, but not 172.160.0.0 - 172.169.255.255 */</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      <span class="keywordflow">if</span> (address[4] == <span class="charliteral">&#39;1&#39;</span> &amp;&amp; address[5] &gt;= <span class="charliteral">&#39;6&#39;</span> &amp;&amp; address[6] == <span class="charliteral">&#39;.&#39;</span>) {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;         score = -5;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="comment">/* 172.20.0.0 - 172.29.255.255, but not 172.200.0.0 - 172.255.255.255 nor 172.2.0.0 - 172.2.255.255 */</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (address[4] == <span class="charliteral">&#39;2&#39;</span> &amp;&amp; address[6] == <span class="charliteral">&#39;.&#39;</span>) {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;         score = -5;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="comment">/* 172.30.0.0 - 172.31.255.255, but not 172.3.0.0 - 172.3.255.255 */</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (address[4] == <span class="charliteral">&#39;3&#39;</span> &amp;&amp; (address[5] == <span class="charliteral">&#39;0&#39;</span> || address[5] == <span class="charliteral">&#39;1&#39;</span>)) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;         score = -5;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="comment">/* All other 172 addresses are public */</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;         score = 0;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   <span class="comment">/* RFC 2544 Benchmark test range (198.18.0.0 - 198.19.255.255, but not 198.180.0.0 - 198.199.255.255) */</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(address, <span class="stringliteral">&quot;198.1&quot;</span>, 5) == 0 &amp;&amp; address[5] &gt;= <span class="charliteral">&#39;8&#39;</span> &amp;&amp; address[6] == <span class="charliteral">&#39;.&#39;</span>) {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      score = -10;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   <span class="comment">/* RFC 1918 non-public address space */</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(address, <span class="stringliteral">&quot;192.168&quot;</span>, 7) == 0) {</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      score = -5;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   <span class="comment">/* RFC 3330 Zeroconf network */</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(address, <span class="stringliteral">&quot;169.254&quot;</span>, 7) == 0) {<span class="comment"></span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">      /*!\note Better score than a test network, but not quite as good as RFC 1918</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">       * address space.  The reason is that some Linux distributions automatically</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">       * configure a Zeroconf address before trying DHCP, so we want to prefer a</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">       * DHCP lease to a Zeroconf address.</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      score = -10;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;   <span class="comment">/* RFC 3330 Test network */</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(address, <span class="stringliteral">&quot;192.0.2.&quot;</span>, 8) == 0) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      score = -15;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;   <span class="comment">/* Every other address should be publically routable */</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      score = 0;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;   <span class="keywordflow">if</span> (score &gt; *best_score) {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      *best_score = score;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      memcpy(best_addr, &amp;sin-&gt;sin_addr, <span class="keyword">sizeof</span>(*best_addr));</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;   }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div><div class="ttc" id="f2c_8h_html_a27c1bdb0cba23a9db2a51eed7b3b2ac1"><div class="ttname"><a href="../../dc/dc2/f2c_8h.html#a27c1bdb0cba23a9db2a51eed7b3b2ac1">address</a></div><div class="ttdeci">char * address</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dc2/f2c_8h_source.html#l00059">f2c.h:59</a></div></div>
<div class="ttc" id="network_8h_html_a5a735cb59e8a8ddd78078d396db7e106"><div class="ttname"><a href="../../d9/d94/network_8h.html#a5a735cb59e8a8ddd78078d396db7e106">ast_inet_ntoa</a></div><div class="ttdeci">const char * ast_inet_ntoa(struct in_addr ia)</div><div class="ttdoc">thread-safe replacement for inet_ntoa(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00782">main/utils.c:782</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a019ca3744d6db4c4c8ecef752fc84a89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a019ca3744d6db4c4c8ecef752fc84a89">&#9670;&nbsp;</a></span>dscp_pool1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../de/d3f/structdscp__codepoint.html">dscp_codepoint</a> dscp_pool1[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/db8/acl_8c_source.html#l00929">929</a> of file <a class="el" href="../../d9/db8/acl_8c_source.html">acl.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:24 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
