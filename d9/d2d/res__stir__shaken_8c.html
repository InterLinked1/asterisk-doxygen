<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_stir_shaken.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">res_stir_shaken.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &lt;openssl/evp.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d16/module_8h_source.html">asterisk/module.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d8/d25/sorcery_8h_source.html">asterisk/sorcery.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../de/df7/time_8h_source.html">asterisk/time.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d4/d05/json_8h_source.html">asterisk/json.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../de/d4a/astdb_8h_source.html">asterisk/astdb.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dd/df2/paths_8h_source.html">asterisk/paths.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../da/dd6/conversions_8h_source.html">asterisk/conversions.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/de0/pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/dc3/global__datastores_8h_source.html">asterisk/global_datastores.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html">asterisk/app.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/ddc/test_8h_source.html">asterisk/test.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html">asterisk/res_stir_shaken.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../de/df9/stir__shaken_8h_source.html">res_stir_shaken/stir_shaken.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d9/d14/general_8h_source.html">res_stir_shaken/general.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d3f/store_8h_source.html">res_stir_shaken/store.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/dc9/certificate_8h_source.html">res_stir_shaken/certificate.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/dd2/curl_8h_source.html">res_stir_shaken/curl.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for res_stir_shaken.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../db/d8d/res__stir__shaken_8c__incl.png" border="0" usemap="#res__stir__shaken_8c" alt=""/></div>
<map name="res__stir__shaken_8c" id="res__stir__shaken_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="333,319,417,345"/>
<area shape="rect" id="node15" href="../../d5/d16/module_8h.html" title="Asterisk module definitions. " alt="" coords="1782,244,1918,271"/>
<area shape="rect" id="node17" href="../../de/df7/time_8h.html" title="Time&#45;related functions and macros. " alt="" coords="839,393,901,420"/>
<area shape="rect" id="node21" href="../../d8/d25/sorcery_8h.html" title="Sorcery Data Access Layer API. " alt="" coords="651,87,785,114"/>
<area shape="rect" id="node24" href="../../d4/d05/json_8h.html" title="Asterisk JSON abstraction layer. " alt="" coords="650,319,765,345"/>
<area shape="rect" id="node26" href="../../de/d4a/astdb_8h.html" title="Persistant data storage (akin to *doze registry) " alt="" coords="980,87,1104,114"/>
<area shape="rect" id="node27" href="../../dd/df2/paths_8h.html" title="Asterisk file paths, configured in asterisk.conf. " alt="" coords="1128,87,1252,114"/>
<area shape="rect" id="node28" href="../../da/dd6/conversions_8h.html" title="Conversion utility functions. " alt="" coords="448,319,612,345"/>
<area shape="rect" id="node29" href="../../db/de0/pbx_8h.html" title="Core PBX routines and definitions. " alt="" coords="1504,87,1615,114"/>
<area shape="rect" id="node40" href="../../d2/dc3/global__datastores_8h.html" title="globally accessible channel datastores " alt="" coords="1277,87,1479,114"/>
<area shape="rect" id="node41" href="../../d3/d93/include_2asterisk_2app_8h.html" title="Application convenience functions, designed to give consistent look and feel to Asterisk apps..." alt="" coords="2063,169,2175,196"/>
<area shape="rect" id="node43" href="../../d2/ddc/test_8h.html" title="Test Framework API. " alt="" coords="884,169,997,196"/>
<area shape="rect" id="node45" href="../../d2/db7/res__stir__shaken_8h.html" title="asterisk/res_stir_shaken.h" alt="" coords="1912,87,2100,114"/>
<area shape="rect" id="node46" href="../../de/df9/stir__shaken_8h.html" title="res_stir_shaken/stir\l_shaken.h" alt="" coords="1741,80,1887,121"/>
<area shape="rect" id="node47" href="../../d9/d14/general_8h.html" title="res_stir_shaken/general.h" alt="" coords="2350,87,2537,114"/>
<area shape="rect" id="node48" href="../../d5/d3f/store_8h.html" title="res_stir_shaken/store.h" alt="" coords="2561,87,2731,114"/>
<area shape="rect" id="node49" href="../../d0/dc9/certificate_8h.html" title="res_stir_shaken/certificate.h" alt="" coords="2124,87,2325,114"/>
<area shape="rect" id="node50" href="../../d2/dd2/curl_8h.html" title="res_stir_shaken/curl.h" alt="" coords="2807,87,2968,114"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="686,468,841,495"/>
<area shape="rect" id="node5" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="359,393,496,420"/>
<area shape="rect" id="node13" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="200,393,335,420"/>
<area shape="rect" id="node4" href="../../dc/dba/buildopts_8h.html" title="asterisk/buildopts.h" alt="" coords="690,543,837,569"/>
<area shape="rect" id="node6" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="5,468,148,495"/>
<area shape="rect" id="node16" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="1378,319,1493,345"/>
<area shape="rect" id="node18" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="1615,393,1773,420"/>
<area shape="rect" id="node19" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="1073,393,1203,420"/>
<area shape="rect" id="node20" href="../../dc/d7d/threadstorage_8h.html" title="Definitions to aid in the use of thread local storage. " alt="" coords="1346,468,1525,495"/>
<area shape="rect" id="node22" href="../../db/dfe/config__options_8h.html" title="Configuration option&#45;handling. " alt="" coords="628,169,808,196"/>
<area shape="rect" id="node23" href="../../dd/d1d/uuid_8h.html" title="Universally unique identifier support. " alt="" coords="489,169,603,196"/>
<area shape="rect" id="node25" href="../../db/df1/netsock2_8h.html" title="Network socket handling. " alt="" coords="634,393,781,420"/>
<area shape="rect" id="node30" href="../../d5/d7b/channel_8h.html" title="General Asterisk PBX channel definitions. " alt="" coords="1123,169,1262,196"/>
<area shape="rect" id="node31" href="../../d9/de7/chanvars_8h.html" title="Channel Variables. " alt="" coords="1073,244,1219,271"/>
<area shape="rect" id="node34" href="../../d7/d00/sched_8h.html" title="Scheduler Routines (derived from cheops) " alt="" coords="1811,169,1937,196"/>
<area shape="rect" id="node35" href="../../da/da2/devicestate_8h.html" title="Device state management. " alt="" coords="1494,244,1657,271"/>
<area shape="rect" id="node36" href="../../d6/dd7/presencestate_8h.html" title="Presence state management. " alt="" coords="1287,169,1467,196"/>
<area shape="rect" id="node37" href="../../d6/da0/hashtab_8h.html" title="Generic (perhaps overly so) hashtable implementation Hash Table support in Asterisk. " alt="" coords="1491,169,1631,196"/>
<area shape="rect" id="node38" href="../../d1/d99/xmldoc_8h.html" title="Asterisk XML Documentation API. " alt="" coords="1023,319,1157,345"/>
<area shape="rect" id="node39" href="../../d0/d0a/format_8h.html" title="Media Format API. " alt="" coords="1655,169,1786,196"/>
<area shape="rect" id="node32" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="1181,319,1332,345"/>
<area shape="rect" id="node33" href="../../dd/d79/stasis_8h.html" title="Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. " alt="" coords="1294,244,1419,271"/>
<area shape="rect" id="node42" href="../../d2/d4d/file_8h.html" title="Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include mod_format.h. " alt="" coords="2043,244,2150,271"/>
<area shape="rect" id="node44" href="../../dc/db0/cli_8h.html" title="Standard Command Line Interface. " alt="" coords="897,244,998,271"/>
</map>
</div>
</div>
<p><a href="../../d9/d2d/res__stir__shaken_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae4ce713ce592a4fa48d99cb779cad7c2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#ae4ce713ce592a4fa48d99cb779cad7c2">AST_DB_FAMILY</a>&#160;&#160;&#160;&quot;STIR_SHAKEN&quot;</td></tr>
<tr class="separator:ae4ce713ce592a4fa48d99cb779cad7c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa26d5e67e841fb4e32f3fbe378ce16fd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#aa26d5e67e841fb4e32f3fbe378ce16fd">EXPIRATION_BUFFER</a>&#160;&#160;&#160;15</td></tr>
<tr class="separator:aa26d5e67e841fb4e32f3fbe378ce16fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdd33f362ae3bbdacb5de76473aa8a2f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#abdd33f362ae3bbdacb5de76473aa8a2f">MAX_PATH_LEN</a>&#160;&#160;&#160;256</td></tr>
<tr class="separator:abdd33f362ae3bbdacb5de76473aa8a2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43632a0dc3430c3d4d4eef72e2399ab2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a43632a0dc3430c3d4d4eef72e2399ab2">STIR_SHAKEN_DIR_NAME</a>&#160;&#160;&#160;&quot;stir_shaken&quot;</td></tr>
<tr class="separator:a43632a0dc3430c3d4d4eef72e2399ab2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr class="separator:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeab1257bd17282b95875499393a147a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr class="separator:afeab1257bd17282b95875499393a147a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adad26c14e31ef6ef601de9710345b1bf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#adad26c14e31ef6ef601de9710345b1bf">add_public_key_to_astdb</a> (const char *public_cert_url, const char *filepath)</td></tr>
<tr class="memdesc:adad26c14e31ef6ef601de9710345b1bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add the public key details and file path to AstDB.  <a href="#adad26c14e31ef6ef601de9710345b1bf">More...</a><br /></td></tr>
<tr class="separator:adad26c14e31ef6ef601de9710345b1bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae">AST_MODULE_SELF_SYM</a> (void)</td></tr>
<tr class="separator:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4aa5534cc4b2efccf5cd9624de367c25"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, const char *identity, const char *attestation, enum <a class="el" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0">ast_stir_shaken_verification_result</a> <a class="el" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>)</td></tr>
<tr class="memdesc:a4aa5534cc4b2efccf5cd9624de367c25"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a STIR/SHAKEN verification result to a channel.  <a href="#a4aa5534cc4b2efccf5cd9624de367c25">More...</a><br /></td></tr>
<tr class="separator:a4aa5534cc4b2efccf5cd9624de367c25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48e5109a0465759e8c374218a844fcae"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a48e5109a0465759e8c374218a844fcae">ast_stir_shaken_get_signature_timeout</a> (void)</td></tr>
<tr class="memdesc:a48e5109a0465759e8c374218a844fcae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the value for 'signature_timeout' from 'general' config object.  <a href="#a48e5109a0465759e8c374218a844fcae">More...</a><br /></td></tr>
<tr class="separator:a48e5109a0465759e8c374218a844fcae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cc390b9c52dc61196df9bb674f13b23"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a> (struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *payload)</td></tr>
<tr class="memdesc:a2cc390b9c52dc61196df9bb674f13b23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a STIR/SHAKEN payload.  <a href="#a2cc390b9c52dc61196df9bb674f13b23">More...</a><br /></td></tr>
<tr class="separator:a2cc390b9c52dc61196df9bb674f13b23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15a5bb3613dfcd15925bc0f3c38ecd57"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a15a5bb3613dfcd15925bc0f3c38ecd57">ast_stir_shaken_payload_get_public_cert_url</a> (const struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *payload)</td></tr>
<tr class="memdesc:a15a5bb3613dfcd15925bc0f3c38ecd57"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the value for 'public_cert_url' from an <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a>.  <a href="#a15a5bb3613dfcd15925bc0f3c38ecd57">More...</a><br /></td></tr>
<tr class="separator:a15a5bb3613dfcd15925bc0f3c38ecd57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc005995e3ab4798df0d47d10d3c3f3d"><td class="memItemLeft" align="right" valign="top">unsigned char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#abc005995e3ab4798df0d47d10d3c3f3d">ast_stir_shaken_payload_get_signature</a> (const struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *payload)</td></tr>
<tr class="memdesc:abc005995e3ab4798df0d47d10d3c3f3d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the value for 'signature' from an <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a>.  <a href="#abc005995e3ab4798df0d47d10d3c3f3d">More...</a><br /></td></tr>
<tr class="separator:abc005995e3ab4798df0d47d10d3c3f3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a452722781ee869834324e0ccc8d42962"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a> (struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *json)</td></tr>
<tr class="memdesc:a452722781ee869834324e0ccc8d42962"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sign a JSON STIR/SHAKEN payload.  <a href="#a452722781ee869834324e0ccc8d42962">More...</a><br /></td></tr>
<tr class="separator:a452722781ee869834324e0ccc8d42962"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8f002c5950334305845b5b4944d38ce"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#aa8f002c5950334305845b5b4944d38ce">ast_stir_shaken_sorcery</a> (void)</td></tr>
<tr class="memdesc:aa8f002c5950334305845b5b4944d38ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the stir/shaken sorcery context.  <a href="#aa8f002c5950334305845b5b4944d38ce">More...</a><br /></td></tr>
<tr class="separator:aa8f002c5950334305845b5b4944d38ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab278c30830333da943d6dfd5332d978a"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#ab278c30830333da943d6dfd5332d978a">ast_stir_shaken_verify</a> (const char *<a class="el" href="../../d5/d65/structheader.html">header</a>, const char *payload, const char *signature, const char *algorithm, const char *public_cert_url)</td></tr>
<tr class="memdesc:ab278c30830333da943d6dfd5332d978a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify a JSON STIR/SHAKEN payload.  <a href="#ab278c30830333da943d6dfd5332d978a">More...</a><br /></td></tr>
<tr class="separator:ab278c30830333da943d6dfd5332d978a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae499d49d25b67dda1fbd36f5a00e3b1a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#ae499d49d25b67dda1fbd36f5a00e3b1a">AST_TEST_DEFINE</a> (test_stir_shaken_sign)</td></tr>
<tr class="separator:ae499d49d25b67dda1fbd36f5a00e3b1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6330fe3b389dafce510e69c2bf8666db"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a6330fe3b389dafce510e69c2bf8666db">AST_TEST_DEFINE</a> (test_stir_shaken_verify)</td></tr>
<tr class="separator:a6330fe3b389dafce510e69c2bf8666db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac76ac985f627439482cc59ccaefca292"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#ac76ac985f627439482cc59ccaefca292">curl_and_check_expiration</a> (const char *public_cert_url, const char *path, int *curl)</td></tr>
<tr class="memdesc:ac76ac985f627439482cc59ccaefca292"><td class="mdescLeft">&#160;</td><td class="mdescRight">Downloads the public cert from public_cert_url. If curl is non-zero, that signals CURL has already been run, and we should bail here. The entry is added to AstDB as well.  <a href="#ac76ac985f627439482cc59ccaefca292">More...</a><br /></td></tr>
<tr class="separator:ac76ac985f627439482cc59ccaefca292"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae58708bc56fd78e22ca1d20765b60b45"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#ae58708bc56fd78e22ca1d20765b60b45">get_path_to_public_key</a> (const char *public_cert_url)</td></tr>
<tr class="memdesc:ae58708bc56fd78e22ca1d20765b60b45"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the path to the downloaded file for the provided URL.  <a href="#ae58708bc56fd78e22ca1d20765b60b45">More...</a><br /></td></tr>
<tr class="separator:ae58708bc56fd78e22ca1d20765b60b45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr class="separator:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa83e9414e32ada50d14653f6f8405069"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#aa83e9414e32ada50d14653f6f8405069">public_key_is_expired</a> (const char *public_cert_url)</td></tr>
<tr class="memdesc:aa83e9414e32ada50d14653f6f8405069"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check to see if the public key is expired.  <a href="#aa83e9414e32ada50d14653f6f8405069">More...</a><br /></td></tr>
<tr class="separator:aa83e9414e32ada50d14653f6f8405069"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c6ac25ea7536c0bc9ed18cbcf917527"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a7c6ac25ea7536c0bc9ed18cbcf917527">reload_module</a> (void)</td></tr>
<tr class="separator:a7c6ac25ea7536c0bc9ed18cbcf917527"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c7438eef28b9e981865b28eaed8222b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a3c7438eef28b9e981865b28eaed8222b">remove_public_key_from_astdb</a> (const char *public_cert_url)</td></tr>
<tr class="memdesc:a3c7438eef28b9e981865b28eaed8222b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove the public key details and associated information from AstDB.  <a href="#a3c7438eef28b9e981865b28eaed8222b">More...</a><br /></td></tr>
<tr class="separator:a3c7438eef28b9e981865b28eaed8222b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8caa031d2c1bdbb8c62c657c30664464"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a8caa031d2c1bdbb8c62c657c30664464">run_curl</a> (const char *public_cert_url, const char *path)</td></tr>
<tr class="memdesc:a8caa031d2c1bdbb8c62c657c30664464"><td class="mdescLeft">&#160;</td><td class="mdescRight">CURL the file located at public_cert_url to the specified path.  <a href="#a8caa031d2c1bdbb8c62c657c30664464">More...</a><br /></td></tr>
<tr class="separator:a8caa031d2c1bdbb8c62c657c30664464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a615fbf21f65958dd15002012178fdc46"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a615fbf21f65958dd15002012178fdc46">set_public_key_expiration</a> (const char *public_cert_url, const struct <a class="el" href="../../d5/d34/structcurl__cb__data.html">curl_cb_data</a> *data)</td></tr>
<tr class="memdesc:a615fbf21f65958dd15002012178fdc46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the expiration for the public key based on the provided fields. If Cache-Control is present, use it. Otherwise, use Expires.  <a href="#a615fbf21f65958dd15002012178fdc46">More...</a><br /></td></tr>
<tr class="separator:a615fbf21f65958dd15002012178fdc46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45cf54d94d39f785ea5af17ce2b5a5b0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a45cf54d94d39f785ea5af17ce2b5a5b0">stir_shaken_add_attest</a> (struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *json, const char *attest)</td></tr>
<tr class="memdesc:a45cf54d94d39f785ea5af17ce2b5a5b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds the 'attest' field to the JWT.  <a href="#a45cf54d94d39f785ea5af17ce2b5a5b0">More...</a><br /></td></tr>
<tr class="separator:a45cf54d94d39f785ea5af17ce2b5a5b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a627d94eaec2f591f17ff707c635e3b19"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a627d94eaec2f591f17ff707c635e3b19">stir_shaken_add_iat</a> (struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *json)</td></tr>
<tr class="memdesc:a627d94eaec2f591f17ff707c635e3b19"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds the 'iat' field to the JWT.  <a href="#a627d94eaec2f591f17ff707c635e3b19">More...</a><br /></td></tr>
<tr class="separator:a627d94eaec2f591f17ff707c635e3b19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dcd80367d95b349f26e9e65aa6354e6"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a4dcd80367d95b349f26e9e65aa6354e6">stir_shaken_add_origid</a> (struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *json)</td></tr>
<tr class="memdesc:a4dcd80367d95b349f26e9e65aa6354e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds the 'origid' field to the JWT.  <a href="#a4dcd80367d95b349f26e9e65aa6354e6">More...</a><br /></td></tr>
<tr class="separator:a4dcd80367d95b349f26e9e65aa6354e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afadb7d3f5ae2dff49eb62190cbfdc532"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#afadb7d3f5ae2dff49eb62190cbfdc532">stir_shaken_add_x5u</a> (struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *json, const char *x5u)</td></tr>
<tr class="memdesc:afadb7d3f5ae2dff49eb62190cbfdc532"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds the 'x5u' (public key URL) field to the JWT.  <a href="#afadb7d3f5ae2dff49eb62190cbfdc532">More...</a><br /></td></tr>
<tr class="separator:afadb7d3f5ae2dff49eb62190cbfdc532"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18800da0faca5e17bede21443b9b7b45"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a18800da0faca5e17bede21443b9b7b45">stir_shaken_datastore_destroy_cb</a> (void *data)</td></tr>
<tr class="memdesc:a18800da0faca5e17bede21443b9b7b45"><td class="mdescLeft">&#160;</td><td class="mdescRight">The callback to destroy a <a class="el" href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a>.  <a href="#a18800da0faca5e17bede21443b9b7b45">More...</a><br /></td></tr>
<tr class="separator:a18800da0faca5e17bede21443b9b7b45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af70e99d804e4c81aad5165b2e77d6cc4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#af70e99d804e4c81aad5165b2e77d6cc4">stir_shaken_datastore_free</a> (struct <a class="el" href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a> *datastore)</td></tr>
<tr class="memdesc:af70e99d804e4c81aad5165b2e77d6cc4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees a <a class="el" href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a> structure.  <a href="#af70e99d804e4c81aad5165b2e77d6cc4">More...</a><br /></td></tr>
<tr class="separator:af70e99d804e4c81aad5165b2e77d6cc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1727642614616f01e0bba04ba0f549c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#ad1727642614616f01e0bba04ba0f549c">stir_shaken_read</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, const char *function, char *data, char *<a class="el" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, size_t <a class="el" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</td></tr>
<tr class="memdesc:ad1727642614616f01e0bba04ba0f549c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves STIR/SHAKEN verification information for the channel via dialplan. Examples:  <a href="#ad1727642614616f01e0bba04ba0f549c">More...</a><br /></td></tr>
<tr class="separator:ad1727642614616f01e0bba04ba0f549c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40731266d3ab5020f880fab33e3441d2"><td class="memItemLeft" align="right" valign="top">static unsigned char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a40731266d3ab5020f880fab33e3441d2">stir_shaken_sign</a> (char *json_str, EVP_PKEY *private_key)</td></tr>
<tr class="memdesc:a40731266d3ab5020f880fab33e3441d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Signs the payload and returns the signature.  <a href="#a40731266d3ab5020f880fab33e3441d2">More...</a><br /></td></tr>
<tr class="separator:a40731266d3ab5020f880fab33e3441d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75a59cd4e8a87ff1baa3c3a77f2019de"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a75a59cd4e8a87ff1baa3c3a77f2019de">stir_shaken_verification_result_to_string</a> (enum <a class="el" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0">ast_stir_shaken_verification_result</a> <a class="el" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>)</td></tr>
<tr class="memdesc:a75a59cd4e8a87ff1baa3c3a77f2019de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert an ast_stir_shaken_verification_result to string representation.  <a href="#a75a59cd4e8a87ff1baa3c3a77f2019de">More...</a><br /></td></tr>
<tr class="separator:a75a59cd4e8a87ff1baa3c3a77f2019de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7042df2b7a959c49909b729adc9549ee"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a7042df2b7a959c49909b729adc9549ee">stir_shaken_verify_json</a> (struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *json)</td></tr>
<tr class="memdesc:a7042df2b7a959c49909b729adc9549ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verifies the necessary contents are in the JSON and returns a <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> with the extracted values.  <a href="#a7042df2b7a959c49909b729adc9549ee">More...</a><br /></td></tr>
<tr class="separator:a7042df2b7a959c49909b729adc9549ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a641d040fed7728c820d3001058b24141"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a641d040fed7728c820d3001058b24141">stir_shaken_verify_signature</a> (const char *msg, const char *signature, EVP_PKEY *public_key)</td></tr>
<tr class="memdesc:a641d040fed7728c820d3001058b24141"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verifies the signature using a public key.  <a href="#a641d040fed7728c820d3001058b24141">More...</a><br /></td></tr>
<tr class="separator:a641d040fed7728c820d3001058b24141"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a327923c76fa01ad91745180a565f69c1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a327923c76fa01ad91745180a565f69c1">test_stir_shaken_add_fake_astdb_entry</a> (const char *public_cert_url, const char *file_path)</td></tr>
<tr class="separator:a327923c76fa01ad91745180a565f69c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7fdb8ec81c043a597636b69c12f96bf"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#af7fdb8ec81c043a597636b69c12f96bf">test_stir_shaken_write_temp_key</a> (char *file_path, int private)</td></tr>
<tr class="memdesc:af7fdb8ec81c043a597636b69c12f96bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a private or public key certificate.  <a href="#af7fdb8ec81c043a597636b69c12f96bf">More...</a><br /></td></tr>
<tr class="separator:af7fdb8ec81c043a597636b69c12f96bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09fa931f468002152a3cc2d5ce25eae"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr class="separator:ad09fa931f468002152a3cc2d5ce25eae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab22f32016155f7f403e7178767163d7d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;STIR/SHAKEN Module for Asterisk&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a6e79b87e069c15a5fb21826e5eed0971">AST_BUILDOPT_SUM</a>, .support_level = <a class="el" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>, .load = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>, .unload = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>, .<a class="el" href="../../dc/d6b/res__xmpp_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> = <a class="el" href="../../d6/d80/test__res__prometheus_8c.html#a7c6ac25ea7536c0bc9ed18cbcf917527">reload_module</a>, .load_pri = <a class="el" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a> - 1, .requires = &quot;res_curl&quot;, }</td></tr>
<tr class="separator:ab22f32016155f7f403e7178767163d7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad60e83b9aa660040fed4d5377966cc21"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#ad60e83b9aa660040fed4d5377966cc21">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr class="separator:ad60e83b9aa660040fed4d5377966cc21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e7896640205a0d33331358444f14e8d"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a3e7896640205a0d33331358444f14e8d">stir_shaken_datastore_info</a></td></tr>
<tr class="separator:a3e7896640205a0d33331358444f14e8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d78be1d8e55602a7de3c689b9e5a091"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a6d78be1d8e55602a7de3c689b9e5a091">stir_shaken_function</a></td></tr>
<tr class="separator:a6d78be1d8e55602a7de3c689b9e5a091"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8dcf20b310c2b64debff736f19e4887b"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d2d/res__stir__shaken_8c.html#a8dcf20b310c2b64debff736f19e4887b">stir_shaken_sorcery</a></td></tr>
<tr class="separator:a8dcf20b310c2b64debff736f19e4887b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae4ce713ce592a4fa48d99cb779cad7c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4ce713ce592a4fa48d99cb779cad7c2">&#9670;&nbsp;</a></span>AST_DB_FAMILY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_DB_FAMILY&#160;&#160;&#160;&quot;STIR_SHAKEN&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00147">147</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00456">add_public_key_to_astdb()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00471">remove_public_key_from_astdb()</a>.</p>

</div>
</div>
<a id="aa26d5e67e841fb4e32f3fbe378ce16fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa26d5e67e841fb4e32f3fbe378ce16fd">&#9670;&nbsp;</a></span>EXPIRATION_BUFFER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EXPIRATION_BUFFER&#160;&#160;&#160;15</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00158">158</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00352">set_public_key_expiration()</a>.</p>

</div>
</div>
<a id="abdd33f362ae3bbdacb5de76473aa8a2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abdd33f362ae3bbdacb5de76473aa8a2f">&#9670;&nbsp;</a></span>MAX_PATH_LEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_PATH_LEN&#160;&#160;&#160;256</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00153">153</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00434">get_path_to_public_key()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00471">remove_public_key_from_astdb()</a>.</p>

</div>
</div>
<a id="a43632a0dc3430c3d4d4eef72e2399ab2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43632a0dc3430c3d4d4eef72e2399ab2">&#9670;&nbsp;</a></span>STIR_SHAKEN_DIR_NAME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STIR_SHAKEN_DIR_NAME&#160;&#160;&#160;&quot;stir_shaken&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00150">150</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">ast_stir_shaken_verify()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a88b7c88fed6b80fd18f34f97757dfc04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88b7c88fed6b80fd18f34f97757dfc04">&#9670;&nbsp;</a></span>__reg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01677">1677</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

</div>
</div>
<a id="afeab1257bd17282b95875499393a147a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeab1257bd17282b95875499393a147a">&#9670;&nbsp;</a></span>__unreg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01677">1677</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

</div>
</div>
<a id="adad26c14e31ef6ef601de9710345b1bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adad26c14e31ef6ef601de9710345b1bf">&#9670;&nbsp;</a></span>add_public_key_to_astdb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void add_public_key_to_astdb </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>public_cert_url</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>filepath</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Add the public key details and file path to AstDB. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">public_cert_url</td><td>The public cert URL </td></tr>
    <tr><td class="paramname">filepath</td><td>The path to the file </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00456">456</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00147">AST_DB_FAMILY</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00327">ast_db_put()</a>, and <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00264">ast_sha1_hash()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">ast_stir_shaken_verify()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00594">curl_and_check_expiration()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01260">test_stir_shaken_add_fake_astdb_entry()</a>.</p>
<div class="fragment"><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;{</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;   <span class="keywordtype">char</span> hash[41];</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a>(hash, public_cert_url);</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;   <a class="code" href="../../de/d4a/astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a>(<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ae4ce713ce592a4fa48d99cb779cad7c2">AST_DB_FAMILY</a>, public_cert_url, hash);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   <a class="code" href="../../de/d4a/astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a>(hash, <span class="stringliteral">&quot;path&quot;</span>, filepath);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;}</div><div class="ttc" id="res__stir__shaken_8c_html_ae4ce713ce592a4fa48d99cb779cad7c2"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#ae4ce713ce592a4fa48d99cb779cad7c2">AST_DB_FAMILY</a></div><div class="ttdeci">#define AST_DB_FAMILY</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00147">res_stir_shaken.c:147</a></div></div>
<div class="ttc" id="utils_8h_html_af35c6f780502c691f0ae35e1d0f7a444"><div class="ttname"><a href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a></div><div class="ttdeci">void ast_sha1_hash(char *output, const char *input)</div><div class="ttdoc">Produces SHA1 hash based on input string. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00264">main/utils.c:264</a></div></div>
<div class="ttc" id="astdb_8h_html_a0f14f6bff4f412c88b50aba34d3a5e35"><div class="ttname"><a href="../../de/d4a/astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a></div><div class="ttdeci">int ast_db_put(const char *family, const char *key, const char *value)</div><div class="ttdoc">Store value addressed by family/key. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00327">main/db.c:327</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4fb0aca9bbcdb9709fa52a70aded6cae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fb0aca9bbcdb9709fa52a70aded6cae">&#9670;&nbsp;</a></span>AST_MODULE_SELF_SYM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a>* AST_MODULE_SELF_SYM </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01677">1677</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

</div>
</div>
<a id="a4aa5534cc4b2efccf5cd9624de367c25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4aa5534cc4b2efccf5cd9624de367c25">&#9670;&nbsp;</a></span>ast_stir_shaken_add_verification()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_stir_shaken_add_verification </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>identity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>attestation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0">ast_stir_shaken_verification_result</a>&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a STIR/SHAKEN verification result to a channel. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chan</td><td>The channel </td></tr>
    <tr><td class="paramname">identity</td><td>The identity </td></tr>
    <tr><td class="paramname">attestation</td><td>The attestation </td></tr>
    <tr><td class="paramname">result</td><td>The verification result</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>on failure </td></tr>
    <tr><td class="paramname">0</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00277">277</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l02390">ast_channel_datastore_add()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d9/db6/datastore_8h_source.html#l00089">ast_datastore_alloc</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00243">ast_strdup</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00239">stir_shaken_datastore::attestation</a>, <a class="el" href="../../d9/db6/datastore_8h_source.html#l00070">ast_datastore::data</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00237">stir_shaken_datastore::identity</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/d1b/cel__pgsql_8c_source.html#l00088">result</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00249">stir_shaken_datastore_free()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00241">stir_shaken_datastore::verify_result</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00122">stir_shaken_incoming_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;{</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a> *ss_datastore;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *datastore;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *chan_name;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   <span class="keywordflow">if</span> (!chan) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Channel is required to add STIR/SHAKEN verification\n&quot;</span>);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;   }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;   chan_name = <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   <span class="keywordflow">if</span> (!identity) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No identity to add STIR/SHAKEN verification to channel &quot;</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;         <span class="stringliteral">&quot;%s\n&quot;</span>, chan_name);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;   }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;   <span class="keywordflow">if</span> (!attestation) {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Attestation cannot be NULL to add STIR/SHAKEN verification to &quot;</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;         <span class="stringliteral">&quot;channel %s\n&quot;</span>, chan_name);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;   ss_datastore = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*ss_datastore));</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   <span class="keywordflow">if</span> (!ss_datastore) {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate space for STIR/SHAKEN datastore for &quot;</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;         <span class="stringliteral">&quot;channel %s\n&quot;</span>, chan_name);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;   ss_datastore-&gt;<a class="code" href="../../df/d32/structstir__shaken__datastore.html#a6aca08b7b55b60ed1900be34b81482ac">identity</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(identity);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;   <span class="keywordflow">if</span> (!ss_datastore-&gt;<a class="code" href="../../df/d32/structstir__shaken__datastore.html#a6aca08b7b55b60ed1900be34b81482ac">identity</a>) {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate space for STIR/SHAKEN datastore &quot;</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;         <span class="stringliteral">&quot;identity for channel %s\n&quot;</span>, chan_name);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#af70e99d804e4c81aad5165b2e77d6cc4">stir_shaken_datastore_free</a>(ss_datastore);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   ss_datastore-&gt;<a class="code" href="../../df/d32/structstir__shaken__datastore.html#a2cf11b44e1f704c9c5a80b8d36ec3540">attestation</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(attestation);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;   <span class="keywordflow">if</span> (!ss_datastore-&gt;<a class="code" href="../../df/d32/structstir__shaken__datastore.html#a2cf11b44e1f704c9c5a80b8d36ec3540">attestation</a>) {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate space for STIR/SHAKEN datastore &quot;</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;         <span class="stringliteral">&quot;attestation for channel %s\n&quot;</span>, chan_name);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#af70e99d804e4c81aad5165b2e77d6cc4">stir_shaken_datastore_free</a>(ss_datastore);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;   }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   ss_datastore-&gt;<a class="code" href="../../df/d32/structstir__shaken__datastore.html#a995f16f55b12710f602f521bc9e95171">verify_result</a> = <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   datastore = <a class="code" href="../../d9/db6/datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a>(&amp;<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a3e7896640205a0d33331358444f14e8d">stir_shaken_datastore_info</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <span class="keywordflow">if</span> (!datastore) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate space for datastore for channel &quot;</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;         <span class="stringliteral">&quot;%s\n&quot;</span>, chan_name);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#af70e99d804e4c81aad5165b2e77d6cc4">stir_shaken_datastore_free</a>(ss_datastore);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;   }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   datastore-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a> = ss_datastore;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a1ed3e98d33d5587948a0e2ef67a81f52">ast_channel_datastore_add</a>(chan, datastore);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div><div class="ttc" id="structstir__shaken__datastore_html"><div class="ttname"><a href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00235">res_stir_shaken.c:235</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_af70e99d804e4c81aad5165b2e77d6cc4"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#af70e99d804e4c81aad5165b2e77d6cc4">stir_shaken_datastore_free</a></div><div class="ttdeci">static void stir_shaken_datastore_free(struct stir_shaken_datastore *datastore)</div><div class="ttdoc">Frees a stir_shaken_datastore structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00249">res_stir_shaken.c:249</a></div></div>
<div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a3e7896640205a0d33331358444f14e8d"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a3e7896640205a0d33331358444f14e8d">stir_shaken_datastore_info</a></div><div class="ttdeci">static const struct ast_datastore_info stir_shaken_datastore_info</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00272">res_stir_shaken.c:272</a></div></div>
<div class="ttc" id="structstir__shaken__datastore_html_a2cf11b44e1f704c9c5a80b8d36ec3540"><div class="ttname"><a href="../../df/d32/structstir__shaken__datastore.html#a2cf11b44e1f704c9c5a80b8d36ec3540">stir_shaken_datastore::attestation</a></div><div class="ttdeci">char * attestation</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00239">res_stir_shaken.c:239</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="structast__datastore_html"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html">ast_datastore</a></div><div class="ttdoc">Structure for a data store object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00068">datastore.h:68</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structstir__shaken__datastore_html_a995f16f55b12710f602f521bc9e95171"><div class="ttname"><a href="../../df/d32/structstir__shaken__datastore.html#a995f16f55b12710f602f521bc9e95171">stir_shaken_datastore::verify_result</a></div><div class="ttdeci">enum ast_stir_shaken_verification_result verify_result</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00241">res_stir_shaken.c:241</a></div></div>
<div class="ttc" id="structast__datastore_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">ast_datastore::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00070">datastore.h:70</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
<div class="ttc" id="datastore_8h_html_a666afb07fd77d50782cc10f83e029159"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a></div><div class="ttdeci">#define ast_datastore_alloc(info, uid)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00089">datastore.h:89</a></div></div>
<div class="ttc" id="channel_8h_html_a1ed3e98d33d5587948a0e2ef67a81f52"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1ed3e98d33d5587948a0e2ef67a81f52">ast_channel_datastore_add</a></div><div class="ttdeci">int ast_channel_datastore_add(struct ast_channel *chan, struct ast_datastore *datastore)</div><div class="ttdoc">Add a datastore to a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02390">channel.c:2390</a></div></div>
<div class="ttc" id="structstir__shaken__datastore_html_a6aca08b7b55b60ed1900be34b81482ac"><div class="ttname"><a href="../../df/d32/structstir__shaken__datastore.html#a6aca08b7b55b60ed1900be34b81482ac">stir_shaken_datastore::identity</a></div><div class="ttdeci">char * identity</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00237">res_stir_shaken.c:237</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a48e5109a0465759e8c374218a844fcae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48e5109a0465759e8c374218a844fcae">&#9670;&nbsp;</a></span>ast_stir_shaken_get_signature_timeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_stir_shaken_get_signature_timeout </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the value for 'signature_timeout' from 'general' config object. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>signature timeout </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00203">203</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dca/general_8c_source.html#l00092">ast_stir_shaken_signature_timeout()</a>, and <a class="el" href="../../d1/dca/general_8c_source.html#l00054">stir_shaken_general_get()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00091">compare_timestamp()</a>.</p>
<div class="fragment"><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;{</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/dca/general_8c.html#a79572b0162a9aafb57e6866ecf08e61d">ast_stir_shaken_signature_timeout</a>(<a class="code" href="../../d1/dca/general_8c.html#a07344cc1bd913adcf604f91cac92ba5e">stir_shaken_general_get</a>());</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="ttc" id="general_8c_html_a07344cc1bd913adcf604f91cac92ba5e"><div class="ttname"><a href="../../d1/dca/general_8c.html#a07344cc1bd913adcf604f91cac92ba5e">stir_shaken_general_get</a></div><div class="ttdeci">struct stir_shaken_general * stir_shaken_general_get()</div><div class="ttdoc">Retrieve the stir/shaken &amp;#39;general&amp;#39; configuration object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dca/general_8c_source.html#l00054">general.c:54</a></div></div>
<div class="ttc" id="general_8c_html_a79572b0162a9aafb57e6866ecf08e61d"><div class="ttname"><a href="../../d1/dca/general_8c.html#a79572b0162a9aafb57e6866ecf08e61d">ast_stir_shaken_signature_timeout</a></div><div class="ttdeci">unsigned int ast_stir_shaken_signature_timeout(const struct stir_shaken_general *cfg)</div><div class="ttdoc">Retrieve the &amp;#39;signature_timeout&amp;#39; general configuration option value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dca/general_8c_source.html#l00092">general.c:92</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2cc390b9c52dc61196df9bb674f13b23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2cc390b9c52dc61196df9bb674f13b23">&#9670;&nbsp;</a></span>ast_stir_shaken_payload_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_stir_shaken_payload_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *&#160;</td>
          <td class="paramname"><em>payload</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free a STIR/SHAKEN payload. </p>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">178</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00168">ast_stir_shaken_payload::algorithm</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00073">ast_json_unref()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00162">ast_stir_shaken_payload::header</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">ast_stir_shaken_payload::payload</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00170">ast_stir_shaken_payload::public_cert_url</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00166">ast_stir_shaken_payload::signature</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00211">add_identity_header()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">ast_stir_shaken_sign()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">ast_stir_shaken_verify()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01333">AST_TEST_DEFINE()</a>, <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00122">stir_shaken_incoming_request()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00788">stir_shaken_verify_json()</a>.</p>
<div class="fragment"><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;{</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   <span class="keywordflow">if</span> (!payload) {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>(payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">header</a>);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>(payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a76c514e8785ea8be81ca07a2a8438eea">algorithm</a>);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">signature</a>);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(payload);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div><div class="ttc" id="structast__stir__shaken__payload_html_aa274fdb7598d57c9bc077c5ce68904fc"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">ast_stir_shaken_payload::header</a></div><div class="ttdeci">struct ast_json * header</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00162">res_stir_shaken.c:162</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a775505f2a74638cda44fdd79c4e07993"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">ast_stir_shaken_payload::signature</a></div><div class="ttdeci">unsigned char * signature</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00166">res_stir_shaken.c:166</a></div></div>
<div class="ttc" id="json_8h_html_a33bcd9181e613a659eefe411ec42c87c"><div class="ttname"><a href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a></div><div class="ttdeci">void ast_json_unref(struct ast_json *value)</div><div class="ttdoc">Decrease refcount on value. If refcount reaches zero, value is freed. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00073">json.c:73</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a76c514e8785ea8be81ca07a2a8438eea"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a76c514e8785ea8be81ca07a2a8438eea">ast_stir_shaken_payload::algorithm</a></div><div class="ttdeci">char * algorithm</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00168">res_stir_shaken.c:168</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_ab72336b850e4ca07a38a41819d6ed170"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">ast_stir_shaken_payload::public_cert_url</a></div><div class="ttdeci">char * public_cert_url</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00170">res_stir_shaken.c:170</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a848d5ae12b5a75efa9c4cf6bf1935639"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">ast_stir_shaken_payload::payload</a></div><div class="ttdeci">struct ast_json * payload</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">res_stir_shaken.c:164</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a15a5bb3613dfcd15925bc0f3c38ecd57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15a5bb3613dfcd15925bc0f3c38ecd57">&#9670;&nbsp;</a></span>ast_stir_shaken_payload_get_public_cert_url()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_stir_shaken_payload_get_public_cert_url </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *&#160;</td>
          <td class="paramname"><em>payload</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the value for 'public_cert_url' from an <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">payload</td><td>The payload</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>public key URL </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00198">198</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00170">ast_stir_shaken_payload::public_cert_url</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00211">add_identity_header()</a>.</p>
<div class="fragment"><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;{</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   <span class="keywordflow">return</span> payload ? payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_ab72336b850e4ca07a38a41819d6ed170"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">ast_stir_shaken_payload::public_cert_url</a></div><div class="ttdeci">char * public_cert_url</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00170">res_stir_shaken.c:170</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abc005995e3ab4798df0d47d10d3c3f3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc005995e3ab4798df0d47d10d3c3f3d">&#9670;&nbsp;</a></span>ast_stir_shaken_payload_get_signature()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char* ast_stir_shaken_payload_get_signature </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *&#160;</td>
          <td class="paramname"><em>payload</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the value for 'signature' from an <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">payload</td><td>The payload</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>signature </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00193">193</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00166">ast_stir_shaken_payload::signature</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00211">add_identity_header()</a>.</p>
<div class="fragment"><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;{</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   <span class="keywordflow">return</span> payload ? payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">signature</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;}</div><div class="ttc" id="structast__stir__shaken__payload_html_a775505f2a74638cda44fdd79c4e07993"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">ast_stir_shaken_payload::signature</a></div><div class="ttdeci">unsigned char * signature</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00166">res_stir_shaken.c:166</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a452722781ee869834324e0ccc8d42962"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a452722781ee869834324e0ccc8d42962">&#9670;&nbsp;</a></span>ast_stir_shaken_sign()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a>* ast_stir_shaken_sign </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *&#160;</td>
          <td class="paramname"><em>json</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sign a JSON STIR/SHAKEN payload. </p>
<dl class="section note"><dt>Note</dt><dd>This function will automatically add the "attest", "iat", and "origid" fields.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>The JWT to sign</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a></td><td>on success </td></tr>
    <tr><td class="paramname">NULL</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">1046</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d4/d05/json_8h_source.html#l00763">ast_json_dump_string</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00273">ast_json_string_get()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">ast_stir_shaken_payload_free()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00243">ast_strdup</a>, <a class="el" href="../../d2/d2c/pbx__realtime_8c_source.html#l00124">cleanup()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00162">ast_stir_shaken_payload::header</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">ast_stir_shaken_payload::payload</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00170">ast_stir_shaken_payload::public_cert_url</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00166">ast_stir_shaken_payload::signature</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00990">stir_shaken_add_attest()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01033">stir_shaken_add_iat()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01010">stir_shaken_add_origid()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00969">stir_shaken_add_x5u()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00101">stir_shaken_certificate_get_attestation()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00084">stir_shaken_certificate_get_by_caller_id_number()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00106">stir_shaken_certificate_get_private_key()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00096">stir_shaken_certificate_get_public_cert_url()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00892">stir_shaken_sign()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00788">stir_shaken_verify_json()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00211">add_identity_header()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01333">AST_TEST_DEFINE()</a>.</p>
<div class="fragment"><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;{</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *ss_payload;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">signature</a>;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *caller_id_num;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">header</a>;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *tmp_json;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;   <span class="keywordtype">char</span> *msg = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;   <span class="keywordtype">size_t</span> msg_len;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/df6/structstir__shaken__certificate.html">stir_shaken_certificate</a> *cert = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;   ss_payload = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a7042df2b7a959c49909b729adc9549ee">stir_shaken_verify_json</a>(json);</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;   <span class="keywordflow">if</span> (!ss_payload) {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;   }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   <span class="comment">/* From the payload section of the JSON, get the orig section, and then get</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">    * the value of tn. This will be the caller ID number */</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;   caller_id_num = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;         <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;payload&quot;</span>), <span class="stringliteral">&quot;orig&quot;</span>), <span class="stringliteral">&quot;tn&quot;</span>));</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;   <span class="keywordflow">if</span> (!caller_id_num) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to get caller ID number from JWT\n&quot;</span>);</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;   }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;   cert = <a class="code" href="../../d7/d5c/certificate_8c.html#aa9bafe5c8b2d20b9c5e6c6efa80ed708">stir_shaken_certificate_get_by_caller_id_number</a>(caller_id_num);</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   <span class="keywordflow">if</span> (!cert) {</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to retrieve certificate for caller ID &quot;</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;         <span class="stringliteral">&quot;&#39;%s&#39;\n&quot;</span>, caller_id_num);</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;   }</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;   public_cert_url = <a class="code" href="../../d7/d5c/certificate_8c.html#ae437a20aa1556158c535fb0b7f449075">stir_shaken_certificate_get_public_cert_url</a>(cert);</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#afadb7d3f5ae2dff49eb62190cbfdc532">stir_shaken_add_x5u</a>(json, public_cert_url)) {</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to add &#39;x5u&#39; (public cert URL) to payload\n&quot;</span>);</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;   }</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;   ss_payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(public_cert_url);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a45cf54d94d39f785ea5af17ce2b5a5b0">stir_shaken_add_attest</a>(json, <a class="code" href="../../d7/d5c/certificate_8c.html#ae042e2240ade59250ee5546826319fb0">stir_shaken_certificate_get_attestation</a>(cert))) {</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to add &#39;attest&#39; to payload\n&quot;</span>);</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;   }</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a4dcd80367d95b349f26e9e65aa6354e6">stir_shaken_add_origid</a>(json)) {</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to add &#39;origid&#39; to payload\n&quot;</span>);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;   }</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a627d94eaec2f591f17ff707c635e3b19">stir_shaken_add_iat</a>(json)) {</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to add &#39;iat&#39; to payload\n&quot;</span>);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;   }</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;   <span class="comment">/* Get the header and the payload. Combine them to get the message to sign */</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;   tmp_json = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;header&quot;</span>);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;   header = <a class="code" href="../../d4/d05/json_8h.html#a51a96b2baa67b671ac68a9fcaebbaeea">ast_json_dump_string</a>(tmp_json);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;   tmp_json = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;payload&quot;</span>);</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;   payload = <a class="code" href="../../d4/d05/json_8h.html#a51a96b2baa67b671ac68a9fcaebbaeea">ast_json_dump_string</a>(tmp_json);</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;   msg_len = strlen(header) + strlen(payload) + 2;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;   msg = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, msg_len);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;   <span class="keywordflow">if</span> (!msg) {</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate space for message to sign\n&quot;</span>);</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;   }</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;   snprintf(msg, msg_len, <span class="stringliteral">&quot;%s.%s&quot;</span>, header, payload);</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;   signature = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a40731266d3ab5020f880fab33e3441d2">stir_shaken_sign</a>(msg, <a class="code" href="../../d7/d5c/certificate_8c.html#a28cc4806921d29dfa628d5693f7fff03">stir_shaken_certificate_get_private_key</a>(cert));</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;   <span class="keywordflow">if</span> (!signature) {</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;   }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;   ss_payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">signature</a> = signature;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(cert);</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(msg);</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;   <span class="keywordflow">return</span> ss_payload;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(cert);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a>(ss_payload);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(msg);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;}</div><div class="ttc" id="structast__stir__shaken__payload_html_aa274fdb7598d57c9bc077c5ce68904fc"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">ast_stir_shaken_payload::header</a></div><div class="ttdeci">struct ast_json * header</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00162">res_stir_shaken.c:162</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a775505f2a74638cda44fdd79c4e07993"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">ast_stir_shaken_payload::signature</a></div><div class="ttdeci">unsigned char * signature</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00166">res_stir_shaken.c:166</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a627d94eaec2f591f17ff707c635e3b19"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a627d94eaec2f591f17ff707c635e3b19">stir_shaken_add_iat</a></div><div class="ttdeci">static int stir_shaken_add_iat(struct ast_json *json)</div><div class="ttdoc">Adds the &amp;#39;iat&amp;#39; field to the JWT. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01033">res_stir_shaken.c:1033</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a40731266d3ab5020f880fab33e3441d2"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a40731266d3ab5020f880fab33e3441d2">stir_shaken_sign</a></div><div class="ttdeci">static unsigned char * stir_shaken_sign(char *json_str, EVP_PKEY *private_key)</div><div class="ttdoc">Signs the payload and returns the signature. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00892">res_stir_shaken.c:892</a></div></div>
<div class="ttc" id="json_8h_html_a51a96b2baa67b671ac68a9fcaebbaeea"><div class="ttname"><a href="../../d4/d05/json_8h.html#a51a96b2baa67b671ac68a9fcaebbaeea">ast_json_dump_string</a></div><div class="ttdeci">#define ast_json_dump_string(root)</div><div class="ttdoc">Encode a JSON value to a compact string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d05/json_8h_source.html#l00763">json.h:763</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a2cc390b9c52dc61196df9bb674f13b23"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a></div><div class="ttdeci">void ast_stir_shaken_payload_free(struct ast_stir_shaken_payload *payload)</div><div class="ttdoc">Free a STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">res_stir_shaken.c:178</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="certificate_8c_html_ae042e2240ade59250ee5546826319fb0"><div class="ttname"><a href="../../d7/d5c/certificate_8c.html#ae042e2240ade59250ee5546826319fb0">stir_shaken_certificate_get_attestation</a></div><div class="ttdeci">const char * stir_shaken_certificate_get_attestation(struct stir_shaken_certificate *cert)</div><div class="ttdoc">Get the attestation level associated with a certificate. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5c/certificate_8c_source.html#l00101">certificate.c:101</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a7042df2b7a959c49909b729adc9549ee"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a7042df2b7a959c49909b729adc9549ee">stir_shaken_verify_json</a></div><div class="ttdeci">static struct ast_stir_shaken_payload * stir_shaken_verify_json(struct ast_json *json)</div><div class="ttdoc">Verifies the necessary contents are in the JSON and returns a ast_stir_shaken_payload with the extrac...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00788">res_stir_shaken.c:788</a></div></div>
<div class="ttc" id="structstir__shaken__certificate_html"><div class="ttname"><a href="../../db/df6/structstir__shaken__certificate.html">stir_shaken_certificate</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5c/certificate_8c_source.html#l00032">certificate.c:32</a></div></div>
<div class="ttc" id="json_8h_html_a6772fcee88746a9d4f6ec6f240b76dd0"><div class="ttname"><a href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a></div><div class="ttdeci">const char * ast_json_string_get(const struct ast_json *string)</div><div class="ttdoc">Get the value of a JSON string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00273">json.c:273</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="certificate_8c_html_aa9bafe5c8b2d20b9c5e6c6efa80ed708"><div class="ttname"><a href="../../d7/d5c/certificate_8c.html#aa9bafe5c8b2d20b9c5e6c6efa80ed708">stir_shaken_certificate_get_by_caller_id_number</a></div><div class="ttdeci">struct stir_shaken_certificate * stir_shaken_certificate_get_by_caller_id_number(const char *caller_id_number)</div><div class="ttdoc">Get a STIR/SHAKEN certificate by caller ID number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5c/certificate_8c_source.html#l00084">certificate.c:84</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_afadb7d3f5ae2dff49eb62190cbfdc532"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#afadb7d3f5ae2dff49eb62190cbfdc532">stir_shaken_add_x5u</a></div><div class="ttdeci">static int stir_shaken_add_x5u(struct ast_json *json, const char *x5u)</div><div class="ttdoc">Adds the &amp;#39;x5u&amp;#39; (public key URL) field to the JWT. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00969">res_stir_shaken.c:969</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_ab72336b850e4ca07a38a41819d6ed170"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">ast_stir_shaken_payload::public_cert_url</a></div><div class="ttdeci">char * public_cert_url</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00170">res_stir_shaken.c:170</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00160">res_stir_shaken.c:160</a></div></div>
<div class="ttc" id="pbx__realtime_8c_html_a10b51e1931bd03dd172cbfb9d3d67efb"><div class="ttname"><a href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a></div><div class="ttdeci">static void * cleanup(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d2c/pbx__realtime_8c_source.html#l00124">pbx_realtime.c:124</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a848d5ae12b5a75efa9c4cf6bf1935639"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">ast_stir_shaken_payload::payload</a></div><div class="ttdeci">struct ast_json * payload</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">res_stir_shaken.c:164</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="certificate_8c_html_a28cc4806921d29dfa628d5693f7fff03"><div class="ttname"><a href="../../d7/d5c/certificate_8c.html#a28cc4806921d29dfa628d5693f7fff03">stir_shaken_certificate_get_private_key</a></div><div class="ttdeci">EVP_PKEY * stir_shaken_certificate_get_private_key(struct stir_shaken_certificate *cert)</div><div class="ttdoc">Get the private key associated with a certificate. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5c/certificate_8c_source.html#l00106">certificate.c:106</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a45cf54d94d39f785ea5af17ce2b5a5b0"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a45cf54d94d39f785ea5af17ce2b5a5b0">stir_shaken_add_attest</a></div><div class="ttdeci">static int stir_shaken_add_attest(struct ast_json *json, const char *attest)</div><div class="ttdoc">Adds the &amp;#39;attest&amp;#39; field to the JWT. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00990">res_stir_shaken.c:990</a></div></div>
<div class="ttc" id="certificate_8c_html_ae437a20aa1556158c535fb0b7f449075"><div class="ttname"><a href="../../d7/d5c/certificate_8c.html#ae437a20aa1556158c535fb0b7f449075">stir_shaken_certificate_get_public_cert_url</a></div><div class="ttdeci">const char * stir_shaken_certificate_get_public_cert_url(struct stir_shaken_certificate *cert)</div><div class="ttdoc">Get the public key URL associated with a certificate. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5c/certificate_8c_source.html#l00096">certificate.c:96</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a4dcd80367d95b349f26e9e65aa6354e6"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a4dcd80367d95b349f26e9e65aa6354e6">stir_shaken_add_origid</a></div><div class="ttdeci">static int stir_shaken_add_origid(struct ast_json *json)</div><div class="ttdoc">Adds the &amp;#39;origid&amp;#39; field to the JWT. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01010">res_stir_shaken.c:1010</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa8f002c5950334305845b5b4944d38ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8f002c5950334305845b5b4944d38ce">&#9670;&nbsp;</a></span>ast_stir_shaken_sorcery()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a>* ast_stir_shaken_sorcery </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the stir/shaken sorcery context. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>stir/shaken sorcery context </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00173">173</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00144">stir_shaken_sorcery</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01636">load_module()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00048">stir_shaken_certificate_get()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00053">stir_shaken_certificate_get_all()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00084">stir_shaken_certificate_get_by_caller_id_number()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00355">stir_shaken_certificate_load()</a>, <a class="el" href="../../d5/d58/stir__shaken_8c_source.html#l00035">stir_shaken_cli_show()</a>, <a class="el" href="../../d1/dca/general_8c_source.html#l00054">stir_shaken_general_get()</a>, <a class="el" href="../../d1/dca/general_8c_source.html#l00248">stir_shaken_general_load()</a>, <a class="el" href="../../d1/dca/general_8c_source.html#l00232">stir_shaken_general_unload()</a>, <a class="el" href="../../d9/d7e/store_8c_source.html#l00044">stir_shaken_store_get()</a>, <a class="el" href="../../d9/d7e/store_8c_source.html#l00049">stir_shaken_store_get_all()</a>, <a class="el" href="../../d9/d7e/store_8c_source.html#l00180">stir_shaken_store_load()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00280">test_stir_shaken_cleanup_cert()</a>, and <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00306">test_stir_shaken_create_cert()</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;{</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a8dcf20b310c2b64debff736f19e4887b">stir_shaken_sorcery</a>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;}</div><div class="ttc" id="res__stir__shaken_8c_html_a8dcf20b310c2b64debff736f19e4887b"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a8dcf20b310c2b64debff736f19e4887b">stir_shaken_sorcery</a></div><div class="ttdeci">static struct ast_sorcery * stir_shaken_sorcery</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00144">res_stir_shaken.c:144</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab278c30830333da943d6dfd5332d978a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab278c30830333da943d6dfd5332d978a">&#9670;&nbsp;</a></span>ast_stir_shaken_verify()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a>* ast_stir_shaken_verify </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>signature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>algorithm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>public_cert_url</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verify a JSON STIR/SHAKEN payload. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">header</td><td>The payload header </td></tr>
    <tr><td class="paramname">payload</td><td>The payload section </td></tr>
    <tr><td class="paramname">signature</td><td>The payload signature </td></tr>
    <tr><td class="paramname">algorithm</td><td>The signature algorithm </td></tr>
    <tr><td class="paramname">public_cert_url</td><td>The public key URL</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a></td><td>on success </td></tr>
    <tr><td class="paramname">NULL</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">620</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00456">add_public_key_to_astdb()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00168">ast_stir_shaken_payload::algorithm</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00269">ast_asprintf</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../de/dc5/options_8c_source.html#l00158">ast_config_AST_DATA_DIR</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00546">ast_json_load_string()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">ast_stir_shaken_payload_free()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00243">ast_strdup</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00594">curl_and_check_expiration()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00434">get_path_to_public_key()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00162">ast_stir_shaken_payload::header</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">ast_stir_shaken_payload::payload</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00170">ast_stir_shaken_payload::public_cert_url</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00405">public_key_is_expired()</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00471">remove_public_key_from_astdb()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00557">run_curl()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00166">ast_stir_shaken_payload::signature</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00150">STIR_SHAKEN_DIR_NAME</a>, <a class="el" href="../../d5/d58/stir__shaken_8c_source.html#l00089">stir_shaken_read_key()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00498">stir_shaken_verify_signature()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01491">AST_TEST_DEFINE()</a>, and <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00122">stir_shaken_incoming_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;{</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *ret_payload;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;   EVP_PKEY *public_key;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;   <span class="keywordtype">int</span> curl = 0;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, file_path, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, dir_path, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, combined_str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;   <span class="keywordtype">size_t</span> combined_size;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/d65/structheader.html">header</a>)) {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&#39;header&#39; is required for STIR/SHAKEN verification\n&quot;</span>);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;   }</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>)) {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&#39;payload&#39; is required for STIR/SHAKEN verification\n&quot;</span>);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;   }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">signature</a>)) {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&#39;signature&#39; is required for STIR/SHAKEN verification\n&quot;</span>);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;   }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a76c514e8785ea8be81ca07a2a8438eea">algorithm</a>)) {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&#39;algorithm&#39; is required for STIR/SHAKEN verification\n&quot;</span>);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>)) {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&#39;public_cert_url&#39; is required for STIR/SHAKEN verification\n&quot;</span>);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;   }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;   <span class="comment">/* Check to see if we have already downloaded this public cert. The reason we</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">    * store the file path is because:</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">    * 1. If, for some reason, the default directory changes, we still know where</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">    * to look for the files we already have.</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">    * 2. In the future, if we want to add a way to store the certs in multiple</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">    * {configurable) directories, we already have the storage mechanism in place.</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">    * The only thing that would be left to do is pull from the configuration.</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;   file_path = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ae58708bc56fd78e22ca1d20765b60b45">get_path_to_public_key</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a>(&amp;dir_path, <span class="stringliteral">&quot;%s/keys/%s&quot;</span>, <a class="code" href="../../dd/df2/paths_8h.html#a63af4213b5b83f717398d8d62008a50d">ast_config_AST_DATA_DIR</a>, <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a43632a0dc3430c3d4d4eef72e2399ab2">STIR_SHAKEN_DIR_NAME</a>) &lt; 0) {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;   }</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;   <span class="comment">/* If we don&#39;t have an entry in AstDB, CURL from the provided URL */</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(file_path)) {</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <span class="comment">/* Remove this entry from the database, since we will be</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">       * downloading a new file anyways.</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a3c7438eef28b9e981865b28eaed8222b">remove_public_key_from_astdb</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="comment">/* Go ahead and free file_path, in case anything was allocated above */</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(file_path);</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="comment">/* Download to the default path */</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      file_path = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a8caa031d2c1bdbb8c62c657c30664464">run_curl</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>, dir_path);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keywordflow">if</span> (!file_path) {</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="comment">/* Signal that we have already downloaded a new file, no reason to do it again */</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      curl = 1;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="comment">/* We should have a successful download at this point, so</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">       * add an entry to the database.</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#adad26c14e31ef6ef601de9710345b1bf">add_public_key_to_astdb</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>, file_path);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;   }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;   <span class="comment">/* Check to see if the cert we downloaded (or already had) is expired */</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#aa83e9414e32ada50d14653f6f8405069">public_key_is_expired</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>)) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Public cert &#39;%s&#39; is expired\n&quot;</span>, <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>);</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a3c7438eef28b9e981865b28eaed8222b">remove_public_key_from_astdb</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="comment">/* If this fails, then there&#39;s nothing we can do */</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(file_path);</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      file_path = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ac76ac985f627439482cc59ccaefca292">curl_and_check_expiration</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>, dir_path, &amp;curl);</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="keywordflow">if</span> (!file_path) {</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      }</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;   }</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;   <span class="comment">/* First attempt to read the key. If it fails, try downloading the file,</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">    * unless we already did. Check for expiration again */</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;   public_key = <a class="code" href="../../d5/d58/stir__shaken_8c.html#a1793b4d90aa04d4646b65595428e544e">stir_shaken_read_key</a>(file_path, 0);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;   <span class="keywordflow">if</span> (!public_key) {</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Failed first read of public key file &#39;%s&#39;\n&quot;</span>, file_path);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a3c7438eef28b9e981865b28eaed8222b">remove_public_key_from_astdb</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(file_path);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      file_path = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ac76ac985f627439482cc59ccaefca292">curl_and_check_expiration</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>, dir_path, &amp;curl);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="keywordflow">if</span> (!file_path) {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      }</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      public_key = <a class="code" href="../../d5/d58/stir__shaken_8c.html#a1793b4d90aa04d4646b65595428e544e">stir_shaken_read_key</a>(file_path, 0);</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">if</span> (!public_key) {</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to read public key from &#39;%s&#39;\n&quot;</span>, file_path);</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;         <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a3c7438eef28b9e981865b28eaed8222b">remove_public_key_from_astdb</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      }</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;   }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;   <span class="comment">/* Combine the header and payload to get the original signed message: header.payload */</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;   combined_size = strlen(<a class="code" href="../../d5/d65/structheader.html">header</a>) + strlen(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) + 2;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;   combined_str = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, combined_size);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;   <span class="keywordflow">if</span> (!combined_str) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate space for message to verify\n&quot;</span>);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      EVP_PKEY_free(public_key);</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;   }</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;   snprintf(combined_str, combined_size, <span class="stringliteral">&quot;%s.%s&quot;</span>, <a class="code" href="../../d5/d65/structheader.html">header</a>, <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a641d040fed7728c820d3001058b24141">stir_shaken_verify_signature</a>(combined_str, <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">signature</a>, public_key)) {</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to verify signature\n&quot;</span>);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      EVP_PKEY_free(public_key);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   }</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;   <span class="comment">/* We don&#39;t need the public key anymore */</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;   EVP_PKEY_free(public_key);</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;   ret_payload = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*ret_payload));</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;   <span class="keywordflow">if</span> (!ret_payload) {</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate STIR/SHAKEN payload\n&quot;</span>);</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;   }</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   ret_payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">header</a> = <a class="code" href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a>(<a class="code" href="../../d5/d65/structheader.html">header</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;   <span class="keywordflow">if</span> (!ret_payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">header</a>) {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create JSON from header\n&quot;</span>);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a>(ret_payload);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;   }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;   ret_payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;   <span class="keywordflow">if</span> (!ret_payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create JSON from payload\n&quot;</span>);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a>(ret_payload);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;   }</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;   ret_payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">signature</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">signature</a>);</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;   ret_payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a76c514e8785ea8be81ca07a2a8438eea">algorithm</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a76c514e8785ea8be81ca07a2a8438eea">algorithm</a>);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;   ret_payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a>);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;   <span class="keywordflow">return</span> ret_payload;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;}</div><div class="ttc" id="structast__stir__shaken__payload_html_aa274fdb7598d57c9bc077c5ce68904fc"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">ast_stir_shaken_payload::header</a></div><div class="ttdeci">struct ast_json * header</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00162">res_stir_shaken.c:162</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a775505f2a74638cda44fdd79c4e07993"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a775505f2a74638cda44fdd79c4e07993">ast_stir_shaken_payload::signature</a></div><div class="ttdeci">unsigned char * signature</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00166">res_stir_shaken.c:166</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a8caa031d2c1bdbb8c62c657c30664464"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a8caa031d2c1bdbb8c62c657c30664464">run_curl</a></div><div class="ttdeci">static char * run_curl(const char *public_cert_url, const char *path)</div><div class="ttdoc">CURL the file located at public_cert_url to the specified path. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00557">res_stir_shaken.c:557</a></div></div>
<div class="ttc" id="stir__shaken_8c_html_a1793b4d90aa04d4646b65595428e544e"><div class="ttname"><a href="../../d5/d58/stir__shaken_8c.html#a1793b4d90aa04d4646b65595428e544e">stir_shaken_read_key</a></div><div class="ttdeci">EVP_PKEY * stir_shaken_read_key(const char *path, int priv)</div><div class="ttdoc">Reads the public (or private) key from the specified path. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d58/stir__shaken_8c_source.html#l00089">stir_shaken.c:89</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a3c7438eef28b9e981865b28eaed8222b"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a3c7438eef28b9e981865b28eaed8222b">remove_public_key_from_astdb</a></div><div class="ttdeci">static void remove_public_key_from_astdb(const char *public_cert_url)</div><div class="ttdoc">Remove the public key details and associated information from AstDB. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00471">res_stir_shaken.c:471</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a2cc390b9c52dc61196df9bb674f13b23"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a></div><div class="ttdeci">void ast_stir_shaken_payload_free(struct ast_stir_shaken_payload *payload)</div><div class="ttdoc">Free a STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">res_stir_shaken.c:178</a></div></div>
<div class="ttc" id="json_8h_html_adca5179982d1f48df7127c123f15ce74"><div class="ttname"><a href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a></div><div class="ttdeci">struct ast_json * ast_json_load_string(const char *input, struct ast_json_error *error)</div><div class="ttdoc">Parse null terminated string into a JSON object or array. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00546">json.c:546</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_adad26c14e31ef6ef601de9710345b1bf"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#adad26c14e31ef6ef601de9710345b1bf">add_public_key_to_astdb</a></div><div class="ttdeci">static void add_public_key_to_astdb(const char *public_cert_url, const char *filepath)</div><div class="ttdoc">Add the public key details and file path to AstDB. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00456">res_stir_shaken.c:456</a></div></div>
<div class="ttc" id="astmm_8h_html_ada667b6f84a08e6848cb37c5ffb94a5f"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a></div><div class="ttdeci">#define ast_asprintf(ret, fmt,...)</div><div class="ttdoc">A wrapper for asprintf() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00269">astmm.h:269</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_ac76ac985f627439482cc59ccaefca292"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#ac76ac985f627439482cc59ccaefca292">curl_and_check_expiration</a></div><div class="ttdeci">static char * curl_and_check_expiration(const char *public_cert_url, const char *path, int *curl)</div><div class="ttdoc">Downloads the public cert from public_cert_url. If curl is non-zero, that signals CURL has already be...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00594">res_stir_shaken.c:594</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="paths_8h_html_a63af4213b5b83f717398d8d62008a50d"><div class="ttname"><a href="../../dd/df2/paths_8h.html#a63af4213b5b83f717398d8d62008a50d">ast_config_AST_DATA_DIR</a></div><div class="ttdeci">const char * ast_config_AST_DATA_DIR</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00158">options.c:158</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a76c514e8785ea8be81ca07a2a8438eea"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a76c514e8785ea8be81ca07a2a8438eea">ast_stir_shaken_payload::algorithm</a></div><div class="ttdeci">char * algorithm</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00168">res_stir_shaken.c:168</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_ab72336b850e4ca07a38a41819d6ed170"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">ast_stir_shaken_payload::public_cert_url</a></div><div class="ttdeci">char * public_cert_url</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00170">res_stir_shaken.c:170</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00160">res_stir_shaken.c:160</a></div></div>
<div class="ttc" id="structheader_html"><div class="ttname"><a href="../../d5/d65/structheader.html">header</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d73/pjsip__global__headers_8c_source.html#l00047">pjsip_global_headers.c:47</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a848d5ae12b5a75efa9c4cf6bf1935639"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">ast_stir_shaken_payload::payload</a></div><div class="ttdeci">struct ast_json * payload</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">res_stir_shaken.c:164</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a641d040fed7728c820d3001058b24141"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a641d040fed7728c820d3001058b24141">stir_shaken_verify_signature</a></div><div class="ttdeci">static int stir_shaken_verify_signature(const char *msg, const char *signature, EVP_PKEY *public_key)</div><div class="ttdoc">Verifies the signature using a public key. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00498">res_stir_shaken.c:498</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_ae58708bc56fd78e22ca1d20765b60b45"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#ae58708bc56fd78e22ca1d20765b60b45">get_path_to_public_key</a></div><div class="ttdeci">static char * get_path_to_public_key(const char *public_cert_url)</div><div class="ttdoc">Returns the path to the downloaded file for the provided URL. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00434">res_stir_shaken.c:434</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a43632a0dc3430c3d4d4eef72e2399ab2"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a43632a0dc3430c3d4d4eef72e2399ab2">STIR_SHAKEN_DIR_NAME</a></div><div class="ttdeci">#define STIR_SHAKEN_DIR_NAME</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00150">res_stir_shaken.c:150</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_aa83e9414e32ada50d14653f6f8405069"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#aa83e9414e32ada50d14653f6f8405069">public_key_is_expired</a></div><div class="ttdeci">static int public_key_is_expired(const char *public_cert_url)</div><div class="ttdoc">Check to see if the public key is expired. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00405">res_stir_shaken.c:405</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae499d49d25b67dda1fbd36f5a00e3b1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae499d49d25b67dda1fbd36f5a00e3b1a">&#9670;&nbsp;</a></span>AST_TEST_DEFINE() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_TEST_DEFINE </td>
          <td>(</td>
          <td class="paramtype">test_stir_shaken_sign&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01333">1333</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../df/d98/json_8c_source.html#l00052">ast_json_free()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00591">ast_json_pack()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">ast_stir_shaken_payload_free()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">ast_stir_shaken_sign()</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00203">AST_TEST_FAIL</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00201">AST_TEST_NOT_RUN</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00202">AST_TEST_PASS</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00129">ast_test_status_update</a>, <a class="el" href="../../d9/d6f/sip__to__pjsip_8py_source.html#l01313">sip_to_pjsip::info()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">ast_stir_shaken_payload::payload</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00021">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00022">STIR_SHAKEN_PPT</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00023">STIR_SHAKEN_TYPE</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00208">TEST_EXECUTE</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00207">TEST_INIT</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00280">test_stir_shaken_cleanup_cert()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00306">test_stir_shaken_create_cert()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01282">test_stir_shaken_write_temp_key()</a>.</p>
<div class="fragment"><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;{</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;   <span class="keywordtype">char</span> *caller_id_number = <span class="stringliteral">&quot;1234567&quot;</span>;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;   <span class="keywordtype">char</span> file_path[] = <span class="stringliteral">&quot;/tmp/stir_shaken_private.XXXXXX&quot;</span>;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, rm_on_exit, file_path, unlink);</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>);</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *, <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a>);</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;stir_shaken_sign&quot;</span>;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_stir_shaken/&quot;</span>;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;STIR/SHAKEN sign unit test&quot;</span>;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description =</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;         <span class="stringliteral">&quot;Tests signing a JWT with a private key.&quot;</span>;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;   }</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;   <span class="comment">/* We only need a private key to sign */</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#af7fdb8ec81c043a597636b69c12f96bf">test_stir_shaken_write_temp_key</a>(file_path, 1);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;   <a class="code" href="../../d7/d5c/certificate_8c.html#a53e2bd141ee7921dc54a795c3d93061b">test_stir_shaken_create_cert</a>(caller_id_number, file_path);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;   <span class="comment">/* Test missing header section */</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: {s: s}}}&quot;</span>, <span class="stringliteral">&quot;payload&quot;</span>, <span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;tn&quot;</span>, caller_id_number);</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Signed an invalid JWT (missing &#39;header&#39;)\n&quot;</span>);</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;   }</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;   <span class="comment">/* Test missing payload section */</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(json);</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s, s: s}}&quot;</span>, <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;alg&quot;</span>,</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <span class="stringliteral">&quot;ppt&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>, <span class="stringliteral">&quot;typ&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a>,</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;      <span class="stringliteral">&quot;x5u&quot;</span>, <span class="stringliteral">&quot;http://testing123&quot;</span>);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Signed an invalid JWT (missing &#39;payload&#39;)\n&quot;</span>);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;   }</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;   <span class="comment">/* Test missing alg section */</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(json);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s}, s: {s: {s: s}}}&quot;</span>, <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;ppt&quot;</span>,</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>, <span class="stringliteral">&quot;typ&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a>, <span class="stringliteral">&quot;x5u&quot;</span>, <span class="stringliteral">&quot;http://testing123&quot;</span>, <span class="stringliteral">&quot;payload&quot;</span>,</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      <span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;tn&quot;</span>, caller_id_number);</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Signed an invalid JWT (missing &#39;alg&#39;)\n&quot;</span>);</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;   }</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;   <span class="comment">/* Test invalid alg value */</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(json);</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s, s: s}, s: {s: {s: s}}}&quot;</span>, <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;alg&quot;</span>,</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      <span class="stringliteral">&quot;invalid algorithm&quot;</span>, <span class="stringliteral">&quot;ppt&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>, <span class="stringliteral">&quot;typ&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a>,</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      <span class="stringliteral">&quot;x5u&quot;</span>, <span class="stringliteral">&quot;http://testing123&quot;</span>, <span class="stringliteral">&quot;payload&quot;</span>, <span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;tn&quot;</span>, caller_id_number);</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Signed an invalid JWT (wrong &#39;alg&#39;)\n&quot;</span>);</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;   }</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;   <span class="comment">/* Test missing ppt section */</span></div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(json);</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s}, s: {s: {s: s}}}&quot;</span>, <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;alg&quot;</span>,</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <span class="stringliteral">&quot;typ&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a>, <span class="stringliteral">&quot;x5u&quot;</span>, <span class="stringliteral">&quot;http://testing123&quot;</span>,</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      <span class="stringliteral">&quot;payload&quot;</span>, <span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;tn&quot;</span>, caller_id_number);</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Signed an invalid JWT (missing &#39;ppt&#39;)\n&quot;</span>);</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;   }</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;   <span class="comment">/* Test invalid ppt value */</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(json);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s, s: s}, s: {s: {s: s}}}&quot;</span>, <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;alg&quot;</span>,</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <span class="stringliteral">&quot;ppt&quot;</span>, <span class="stringliteral">&quot;invalid ppt&quot;</span>, <span class="stringliteral">&quot;typ&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a>,</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      <span class="stringliteral">&quot;x5u&quot;</span>, <span class="stringliteral">&quot;http://testing123&quot;</span>, <span class="stringliteral">&quot;payload&quot;</span>, <span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;tn&quot;</span>, caller_id_number);</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Signed an invalid JWT (wrong &#39;ppt&#39;)\n&quot;</span>);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;   }</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;   <span class="comment">/* Test missing typ section */</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(json);</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s}, s: {s: {s: s}}}&quot;</span>, <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;alg&quot;</span>,</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <span class="stringliteral">&quot;ppt&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>, <span class="stringliteral">&quot;x5u&quot;</span>, <span class="stringliteral">&quot;http://testing123&quot;</span>,</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      <span class="stringliteral">&quot;payload&quot;</span>, <span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;tn&quot;</span>, caller_id_number);</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Signed an invalid JWT (missing &#39;typ&#39;)\n&quot;</span>);</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;   }</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;   <span class="comment">/* Test invalid typ value */</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(json);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s, s: s}, s: {s: {s: s}}}&quot;</span>, <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;alg&quot;</span>,</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <span class="stringliteral">&quot;ppt&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>, <span class="stringliteral">&quot;typ&quot;</span>, <span class="stringliteral">&quot;invalid typ&quot;</span>,</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      <span class="stringliteral">&quot;x5u&quot;</span>, <span class="stringliteral">&quot;http://testing123&quot;</span>, <span class="stringliteral">&quot;payload&quot;</span>, <span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;tn&quot;</span>, caller_id_number);</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Signed an invalid JWT (wrong &#39;typ&#39;)\n&quot;</span>);</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;   }</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;   <span class="comment">/* Test missing orig section */</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(json);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s, s: s}, s: {s: s}}&quot;</span>, <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;alg&quot;</span>,</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <span class="stringliteral">&quot;ppt&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>, <span class="stringliteral">&quot;typ&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a>,</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      <span class="stringliteral">&quot;x5u&quot;</span>, <span class="stringliteral">&quot;http://testing123&quot;</span>, <span class="stringliteral">&quot;payload&quot;</span>, <span class="stringliteral">&quot;filler&quot;</span>, <span class="stringliteral">&quot;filler&quot;</span>);</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Signed an invalid JWT (missing &#39;orig&#39;)\n&quot;</span>);</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;   }</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;   <span class="comment">/* Test missing tn section */</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(json);</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s, s: s}, s: {s: s}}&quot;</span>, <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;alg&quot;</span>,</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <span class="stringliteral">&quot;ppt&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>, <span class="stringliteral">&quot;typ&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a>,</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      <span class="stringliteral">&quot;x5u&quot;</span>, <span class="stringliteral">&quot;http://testing123&quot;</span>, <span class="stringliteral">&quot;payload&quot;</span>, <span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;filler&quot;</span>);</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Signed an invalid JWT (missing &#39;tn&#39;)\n&quot;</span>);</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;   }</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;   <span class="comment">/* Test valid JWT */</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(json);</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s, s: s}, s: {s: {s: s}}}&quot;</span>, <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;alg&quot;</span>,</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <span class="stringliteral">&quot;ppt&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>, <span class="stringliteral">&quot;typ&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a>,</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      <span class="stringliteral">&quot;x5u&quot;</span>, <span class="stringliteral">&quot;http://testing123&quot;</span>, <span class="stringliteral">&quot;payload&quot;</span>, <span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;tn&quot;</span>, caller_id_number);</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to sign a valid JWT\n&quot;</span>);</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;   }</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;   <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;}</div><div class="ttc" id="json_8h_html_a99715667e822b2ad409b34ca041e535d"><div class="ttname"><a href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a></div><div class="ttdeci">struct ast_json * ast_json_pack(char const *format,...)</div><div class="ttdoc">Helper for creating complex JSON values. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00591">json.c:591</a></div></div>
<div class="ttc" id="test_8h_html_a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00208">test.h:208</a></div></div>
<div class="ttc" id="json_8h_html_a38eea5afa847432f7c10af8e69fb013e"><div class="ttname"><a href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a></div><div class="ttdeci">void ast_json_free(void *p)</div><div class="ttdoc">Asterisk&amp;#39;s custom JSON allocator. Exposed for use by unit tests. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00052">json.c:52</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a2cc390b9c52dc61196df9bb674f13b23"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a></div><div class="ttdeci">void ast_stir_shaken_payload_free(struct ast_stir_shaken_payload *payload)</div><div class="ttdoc">Free a STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">res_stir_shaken.c:178</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="test_8h_html_a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00207">test.h:207</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00201">test.h:201</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="test_8h_html_a5e8fddded61f6989172c981256e7c9bd"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a></div><div class="ttdeci">#define ast_test_status_update(a, b, c...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00129">test.h:129</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a452722781ee869834324e0ccc8d42962"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a></div><div class="ttdeci">struct ast_stir_shaken_payload * ast_stir_shaken_sign(struct ast_json *json)</div><div class="ttdoc">Sign a JSON STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">res_stir_shaken.c:1046</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a7fa9ce960630ba4818351dce356650ba"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a></div><div class="ttdeci">#define STIR_SHAKEN_ENCRYPTION_ALGORITHM</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00021">res_stir_shaken.h:21</a></div></div>
<div class="ttc" id="certificate_8c_html_a53e2bd141ee7921dc54a795c3d93061b"><div class="ttname"><a href="../../d7/d5c/certificate_8c.html#a53e2bd141ee7921dc54a795c3d93061b">test_stir_shaken_create_cert</a></div><div class="ttdeci">int test_stir_shaken_create_cert(const char *caller_id_number, const char *file_path)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5c/certificate_8c_source.html#l00306">certificate.c:306</a></div></div>
<div class="ttc" id="certificate_8c_html_a6fab1594baa8578558d39ff300caa1b7"><div class="ttname"><a href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a></div><div class="ttdeci">int test_stir_shaken_cleanup_cert(const char *caller_id_number)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5c/certificate_8c_source.html#l00280">certificate.c:280</a></div></div>
<div class="ttc" id="namespacesip__to__pjsip_html_ab82f408a83ecba10ea39afd8abfd371e"><div class="ttname"><a href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">sip_to_pjsip.info</a></div><div class="ttdeci">def info(msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d6f/sip__to__pjsip_8py_source.html#l01313">sip_to_pjsip.py:1313</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00202">test.h:202</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00160">res_stir_shaken.c:160</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a8ac6f48a993e1cfdb7780fa13b8bff06"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a></div><div class="ttdeci">#define STIR_SHAKEN_PPT</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00022">res_stir_shaken.h:22</a></div></div>
<div class="ttc" id="structtest_html"><div class="ttname"><a href="../../d8/d89/structtest.html">test</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d7d/test__logger_8c_source.html#l00043">test_logger.c:43</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a848d5ae12b5a75efa9c4cf6bf1935639"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">ast_stir_shaken_payload::payload</a></div><div class="ttdeci">struct ast_json * payload</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">res_stir_shaken.c:164</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_af7fdb8ec81c043a597636b69c12f96bf"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#af7fdb8ec81c043a597636b69c12f96bf">test_stir_shaken_write_temp_key</a></div><div class="ttdeci">static int test_stir_shaken_write_temp_key(char *file_path, int private)</div><div class="ttdoc">Create a private or public key certificate. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01282">res_stir_shaken.c:1282</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="res__stir__shaken_8h_html_ab8935c3fd655edd2dbc47887d4dd9bec"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a></div><div class="ttdeci">#define STIR_SHAKEN_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00023">res_stir_shaken.h:23</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00203">test.h:203</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6330fe3b389dafce510e69c2bf8666db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6330fe3b389dafce510e69c2bf8666db">&#9670;&nbsp;</a></span>AST_TEST_DEFINE() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_TEST_DEFINE </td>
          <td>(</td>
          <td class="paramtype">test_stir_shaken_verify&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01491">1491</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/d05/json_8h_source.html#l00763">ast_json_dump_string</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00052">ast_json_free()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00591">ast_json_pack()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">ast_stir_shaken_payload_free()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">ast_stir_shaken_sign()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">ast_stir_shaken_verify()</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00203">AST_TEST_FAIL</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00201">AST_TEST_NOT_RUN</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00202">AST_TEST_PASS</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00129">ast_test_status_update</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00162">ast_stir_shaken_payload::header</a>, <a class="el" href="../../d9/d6f/sip__to__pjsip_8py_source.html#l01313">sip_to_pjsip::info()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">ast_stir_shaken_payload::payload</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00170">ast_stir_shaken_payload::public_cert_url</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00471">remove_public_key_from_astdb()</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00021">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00022">STIR_SHAKEN_PPT</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00023">STIR_SHAKEN_TYPE</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00208">TEST_EXECUTE</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00207">TEST_INIT</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01260">test_stir_shaken_add_fake_astdb_entry()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00280">test_stir_shaken_cleanup_cert()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00306">test_stir_shaken_create_cert()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01282">test_stir_shaken_write_temp_key()</a>.</p>
<div class="fragment"><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;{</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;   <span class="keywordtype">char</span> *caller_id_number = <span class="stringliteral">&quot;1234567&quot;</span>;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">public_cert_url</a> = <span class="stringliteral">&quot;http://testing123&quot;</span>;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">header</a>;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *tmp_json;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;   <span class="keywordtype">char</span> public_path[] = <span class="stringliteral">&quot;/tmp/stir_shaken_public.XXXXXX&quot;</span>;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;   <span class="keywordtype">char</span> private_path[] = <span class="stringliteral">&quot;/tmp/stir_shaken_public.XXXXXX&quot;</span>;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, rm_on_exit_public, public_path, unlink);</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, rm_on_exit_private, private_path, unlink);</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>);</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *, signed_payload, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a>);</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *, returned_payload, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a>);</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;stir_shaken_verify&quot;</span>;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_stir_shaken/&quot;</span>;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;STIR/SHAKEN verify unit test&quot;</span>;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description =</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;         <span class="stringliteral">&quot;Tests verifying a signature with a public key&quot;</span>;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;   }</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;   <span class="comment">/* We need the private key to sign, but we also need the corresponding</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">    * public key to verify */</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#af7fdb8ec81c043a597636b69c12f96bf">test_stir_shaken_write_temp_key</a>(public_path, 0);</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#af7fdb8ec81c043a597636b69c12f96bf">test_stir_shaken_write_temp_key</a>(private_path, 1);</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;   <a class="code" href="../../d7/d5c/certificate_8c.html#a53e2bd141ee7921dc54a795c3d93061b">test_stir_shaken_create_cert</a>(caller_id_number, private_path);</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;   <span class="comment">/* Get the signature */</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s, s: s}, s: {s: {s: s}}}&quot;</span>, <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;alg&quot;</span>,</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <span class="stringliteral">&quot;ppt&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>, <span class="stringliteral">&quot;typ&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a>,</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      <span class="stringliteral">&quot;x5u&quot;</span>, public_cert_url, <span class="stringliteral">&quot;payload&quot;</span>, <span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;tn&quot;</span>, caller_id_number);</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;   signed_payload = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;   <span class="keywordflow">if</span> (!signed_payload) {</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to sign a valid JWT\n&quot;</span>);</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;   }</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;   <span class="comment">/* Get the header and payload for ast_stir_shaken_verify */</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;   tmp_json = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;header&quot;</span>);</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;   header = <a class="code" href="../../d4/d05/json_8h.html#a51a96b2baa67b671ac68a9fcaebbaeea">ast_json_dump_string</a>(tmp_json);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;   tmp_json = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;payload&quot;</span>);</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;   payload = <a class="code" href="../../d4/d05/json_8h.html#a51a96b2baa67b671ac68a9fcaebbaeea">ast_json_dump_string</a>(tmp_json);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;   <span class="comment">/* Test empty header parameter */</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;   returned_payload = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ab278c30830333da943d6dfd5332d978a">ast_stir_shaken_verify</a>(<span class="stringliteral">&quot;&quot;</span>, payload, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)signed_payload-&gt;signature,</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, public_cert_url);</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;   <span class="keywordflow">if</span> (returned_payload) {</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Verified a signature with missing &#39;header&#39;\n&quot;</span>);</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;   }</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;   <span class="comment">/* Test empty payload parameter */</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;   returned_payload = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ab278c30830333da943d6dfd5332d978a">ast_stir_shaken_verify</a>(header, <span class="stringliteral">&quot;&quot;</span>, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)signed_payload-&gt;signature,</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, public_cert_url);</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;   <span class="keywordflow">if</span> (returned_payload) {</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Verified a signature with missing &#39;payload&#39;\n&quot;</span>);</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;   }</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;   <span class="comment">/* Test empty signature parameter */</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;   returned_payload = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ab278c30830333da943d6dfd5332d978a">ast_stir_shaken_verify</a>(header, payload, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, public_cert_url);</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;   <span class="keywordflow">if</span> (returned_payload) {</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Verified a signature with missing &#39;signature&#39;\n&quot;</span>);</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;   }</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;   <span class="comment">/* Test empty algorithm parameter */</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;   returned_payload = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ab278c30830333da943d6dfd5332d978a">ast_stir_shaken_verify</a>(header, payload, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)signed_payload-&gt;signature,</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <span class="stringliteral">&quot;&quot;</span>, public_cert_url);</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;   <span class="keywordflow">if</span> (returned_payload) {</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Verified a signature with missing &#39;algorithm&#39;\n&quot;</span>);</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;   }</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;   <span class="comment">/* Test empty public key URL */</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;   returned_payload = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ab278c30830333da943d6dfd5332d978a">ast_stir_shaken_verify</a>(header, payload, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)signed_payload-&gt;signature,</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;   <span class="keywordflow">if</span> (returned_payload) {</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Verified a signature with missing &#39;public key URL&#39;\n&quot;</span>);</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;   }</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;   <span class="comment">/* Trick the function into thinking we&#39;ve already downloaded the key */</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a327923c76fa01ad91745180a565f69c1">test_stir_shaken_add_fake_astdb_entry</a>(public_cert_url, public_path);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;   <span class="comment">/* Verify a valid signature */</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;   returned_payload = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ab278c30830333da943d6dfd5332d978a">ast_stir_shaken_verify</a>(header, payload, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)signed_payload-&gt;signature,</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, public_cert_url);</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;   <span class="keywordflow">if</span> (!returned_payload) {</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to verify a valid signature\n&quot;</span>);</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a3c7438eef28b9e981865b28eaed8222b">remove_public_key_from_astdb</a>(public_cert_url);</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;   }</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a3c7438eef28b9e981865b28eaed8222b">remove_public_key_from_astdb</a>(public_cert_url);</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;   <a class="code" href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a>(caller_id_number);</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;}</div><div class="ttc" id="structast__stir__shaken__payload_html_aa274fdb7598d57c9bc077c5ce68904fc"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">ast_stir_shaken_payload::header</a></div><div class="ttdeci">struct ast_json * header</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00162">res_stir_shaken.c:162</a></div></div>
<div class="ttc" id="json_8h_html_a99715667e822b2ad409b34ca041e535d"><div class="ttname"><a href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a></div><div class="ttdeci">struct ast_json * ast_json_pack(char const *format,...)</div><div class="ttdoc">Helper for creating complex JSON values. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00591">json.c:591</a></div></div>
<div class="ttc" id="test_8h_html_a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00208">test.h:208</a></div></div>
<div class="ttc" id="json_8h_html_a38eea5afa847432f7c10af8e69fb013e"><div class="ttname"><a href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a></div><div class="ttdeci">void ast_json_free(void *p)</div><div class="ttdoc">Asterisk&amp;#39;s custom JSON allocator. Exposed for use by unit tests. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00052">json.c:52</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a3c7438eef28b9e981865b28eaed8222b"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a3c7438eef28b9e981865b28eaed8222b">remove_public_key_from_astdb</a></div><div class="ttdeci">static void remove_public_key_from_astdb(const char *public_cert_url)</div><div class="ttdoc">Remove the public key details and associated information from AstDB. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00471">res_stir_shaken.c:471</a></div></div>
<div class="ttc" id="json_8h_html_a51a96b2baa67b671ac68a9fcaebbaeea"><div class="ttname"><a href="../../d4/d05/json_8h.html#a51a96b2baa67b671ac68a9fcaebbaeea">ast_json_dump_string</a></div><div class="ttdeci">#define ast_json_dump_string(root)</div><div class="ttdoc">Encode a JSON value to a compact string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d05/json_8h_source.html#l00763">json.h:763</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a2cc390b9c52dc61196df9bb674f13b23"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a></div><div class="ttdeci">void ast_stir_shaken_payload_free(struct ast_stir_shaken_payload *payload)</div><div class="ttdoc">Free a STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">res_stir_shaken.c:178</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="test_8h_html_a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00207">test.h:207</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00201">test.h:201</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="test_8h_html_a5e8fddded61f6989172c981256e7c9bd"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a></div><div class="ttdeci">#define ast_test_status_update(a, b, c...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00129">test.h:129</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a452722781ee869834324e0ccc8d42962"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a></div><div class="ttdeci">struct ast_stir_shaken_payload * ast_stir_shaken_sign(struct ast_json *json)</div><div class="ttdoc">Sign a JSON STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">res_stir_shaken.c:1046</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a7fa9ce960630ba4818351dce356650ba"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a></div><div class="ttdeci">#define STIR_SHAKEN_ENCRYPTION_ALGORITHM</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00021">res_stir_shaken.h:21</a></div></div>
<div class="ttc" id="certificate_8c_html_a53e2bd141ee7921dc54a795c3d93061b"><div class="ttname"><a href="../../d7/d5c/certificate_8c.html#a53e2bd141ee7921dc54a795c3d93061b">test_stir_shaken_create_cert</a></div><div class="ttdeci">int test_stir_shaken_create_cert(const char *caller_id_number, const char *file_path)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5c/certificate_8c_source.html#l00306">certificate.c:306</a></div></div>
<div class="ttc" id="certificate_8c_html_a6fab1594baa8578558d39ff300caa1b7"><div class="ttname"><a href="../../d7/d5c/certificate_8c.html#a6fab1594baa8578558d39ff300caa1b7">test_stir_shaken_cleanup_cert</a></div><div class="ttdeci">int test_stir_shaken_cleanup_cert(const char *caller_id_number)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5c/certificate_8c_source.html#l00280">certificate.c:280</a></div></div>
<div class="ttc" id="namespacesip__to__pjsip_html_ab82f408a83ecba10ea39afd8abfd371e"><div class="ttname"><a href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">sip_to_pjsip.info</a></div><div class="ttdeci">def info(msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d6f/sip__to__pjsip_8py_source.html#l01313">sip_to_pjsip.py:1313</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00202">test.h:202</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_ab72336b850e4ca07a38a41819d6ed170"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#ab72336b850e4ca07a38a41819d6ed170">ast_stir_shaken_payload::public_cert_url</a></div><div class="ttdeci">char * public_cert_url</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00170">res_stir_shaken.c:170</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00160">res_stir_shaken.c:160</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a8ac6f48a993e1cfdb7780fa13b8bff06"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a></div><div class="ttdeci">#define STIR_SHAKEN_PPT</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00022">res_stir_shaken.h:22</a></div></div>
<div class="ttc" id="structtest_html"><div class="ttname"><a href="../../d8/d89/structtest.html">test</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d7d/test__logger_8c_source.html#l00043">test_logger.c:43</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a848d5ae12b5a75efa9c4cf6bf1935639"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">ast_stir_shaken_payload::payload</a></div><div class="ttdeci">struct ast_json * payload</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">res_stir_shaken.c:164</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_af7fdb8ec81c043a597636b69c12f96bf"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#af7fdb8ec81c043a597636b69c12f96bf">test_stir_shaken_write_temp_key</a></div><div class="ttdeci">static int test_stir_shaken_write_temp_key(char *file_path, int private)</div><div class="ttdoc">Create a private or public key certificate. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01282">res_stir_shaken.c:1282</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="res__stir__shaken_8h_html_ab8935c3fd655edd2dbc47887d4dd9bec"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a></div><div class="ttdeci">#define STIR_SHAKEN_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00023">res_stir_shaken.h:23</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a327923c76fa01ad91745180a565f69c1"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a327923c76fa01ad91745180a565f69c1">test_stir_shaken_add_fake_astdb_entry</a></div><div class="ttdeci">static void test_stir_shaken_add_fake_astdb_entry(const char *public_cert_url, const char *file_path)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01260">res_stir_shaken.c:1260</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00203">test.h:203</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_ab278c30830333da943d6dfd5332d978a"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#ab278c30830333da943d6dfd5332d978a">ast_stir_shaken_verify</a></div><div class="ttdeci">struct ast_stir_shaken_payload * ast_stir_shaken_verify(const char *header, const char *payload, const char *signature, const char *algorithm, const char *public_cert_url)</div><div class="ttdoc">Verify a JSON STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">res_stir_shaken.c:620</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac76ac985f627439482cc59ccaefca292"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac76ac985f627439482cc59ccaefca292">&#9670;&nbsp;</a></span>curl_and_check_expiration()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char* curl_and_check_expiration </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>public_cert_url</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>curl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Downloads the public cert from public_cert_url. If curl is non-zero, that signals CURL has already been run, and we should bail here. The entry is added to AstDB as well. </p>
<dl class="section note"><dt>Note</dt><dd>filename will need to be freed by the caller</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">public_cert_url</td><td>The public cert URL </td></tr>
    <tr><td class="paramname">path</td><td>The path to download the file to </td></tr>
    <tr><td class="paramname">curl</td><td>Flag signaling if we have run CURL or not</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td>on failure </td></tr>
    <tr><td class="paramname">full</td><td>path filename on success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00594">594</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00456">add_public_key_to_astdb()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00405">public_key_is_expired()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00557">run_curl()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">ast_stir_shaken_verify()</a>.</p>
<div class="fragment"><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;{</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;   <span class="keywordtype">char</span> *filename;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;   <span class="keywordflow">if</span> (curl) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Already downloaded public key &#39;%s&#39;\n&quot;</span>, path);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;   }</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;   filename = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a8caa031d2c1bdbb8c62c657c30664464">run_curl</a>(public_cert_url, path);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;   <span class="keywordflow">if</span> (!filename) {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;   }</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#aa83e9414e32ada50d14653f6f8405069">public_key_is_expired</a>(public_cert_url)) {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Newly downloaded public key &#39;%s&#39; is expired\n&quot;</span>, path);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(filename);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   }</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   *curl = 1;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#adad26c14e31ef6ef601de9710345b1bf">add_public_key_to_astdb</a>(public_cert_url, filename);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   <span class="keywordflow">return</span> filename;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;}</div><div class="ttc" id="res__stir__shaken_8c_html_a8caa031d2c1bdbb8c62c657c30664464"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a8caa031d2c1bdbb8c62c657c30664464">run_curl</a></div><div class="ttdeci">static char * run_curl(const char *public_cert_url, const char *path)</div><div class="ttdoc">CURL the file located at public_cert_url to the specified path. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00557">res_stir_shaken.c:557</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_adad26c14e31ef6ef601de9710345b1bf"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#adad26c14e31ef6ef601de9710345b1bf">add_public_key_to_astdb</a></div><div class="ttdeci">static void add_public_key_to_astdb(const char *public_cert_url, const char *filepath)</div><div class="ttdoc">Add the public key details and file path to AstDB. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00456">res_stir_shaken.c:456</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_aa83e9414e32ada50d14653f6f8405069"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#aa83e9414e32ada50d14653f6f8405069">public_key_is_expired</a></div><div class="ttdeci">static int public_key_is_expired(const char *public_cert_url)</div><div class="ttdoc">Check to see if the public key is expired. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00405">res_stir_shaken.c:405</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae58708bc56fd78e22ca1d20765b60b45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae58708bc56fd78e22ca1d20765b60b45">&#9670;&nbsp;</a></span>get_path_to_public_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char* get_path_to_public_key </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>public_cert_url</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the path to the downloaded file for the provided URL. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">public_cert_url</td><td>The public cert URL</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">Empty</td><td>string if not present in AstDB </td></tr>
    <tr><td class="paramname">The</td><td>file path if present in AstDB </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00434">434</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/d21/main_2db_8c_source.html#l00412">ast_db_get()</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00264">ast_sha1_hash()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00243">ast_strdup</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00153">MAX_PATH_LEN</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">ast_stir_shaken_verify()</a>.</p>
<div class="fragment"><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;{</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   <span class="keywordtype">char</span> hash[41];</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;   <span class="keywordtype">char</span> file_path[<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#abdd33f362ae3bbdacb5de76473aa8a2f">MAX_PATH_LEN</a>];</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a>(hash, public_cert_url);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   <a class="code" href="../../de/d4a/astdb_8h.html#a6ab91701fa0db9fad7759fe42a581c17">ast_db_get</a>(hash, <span class="stringliteral">&quot;path&quot;</span>, file_path, <span class="keyword">sizeof</span>(file_path));</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(file_path)) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      file_path[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;   }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(file_path);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;}</div><div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="utils_8h_html_af35c6f780502c691f0ae35e1d0f7a444"><div class="ttname"><a href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a></div><div class="ttdeci">void ast_sha1_hash(char *output, const char *input)</div><div class="ttdoc">Produces SHA1 hash based on input string. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00264">main/utils.c:264</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_abdd33f362ae3bbdacb5de76473aa8a2f"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#abdd33f362ae3bbdacb5de76473aa8a2f">MAX_PATH_LEN</a></div><div class="ttdeci">#define MAX_PATH_LEN</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00153">res_stir_shaken.c:153</a></div></div>
<div class="ttc" id="astdb_8h_html_a6ab91701fa0db9fad7759fe42a581c17"><div class="ttname"><a href="../../de/d4a/astdb_8h.html#a6ab91701fa0db9fad7759fe42a581c17">ast_db_get</a></div><div class="ttdeci">int ast_db_get(const char *family, const char *key, char *value, int valuelen)</div><div class="ttdoc">Get key value specified by family/key. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00412">main/db.c:412</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac3382bf6da54c56b37069bd76bbdf4f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3382bf6da54c56b37069bd76bbdf4f9">&#9670;&nbsp;</a></span>load_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01636">1636</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../db/de0/pbx_8h_source.html#l01508">ast_custom_function_register</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00316">AST_MODFLAG_GLOBAL_SYMBOLS</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00317">AST_MODFLAG_LOAD_ORDER</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00326">AST_MODPRI_CHANNEL_DEPEND</a>, <a class="el" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO()</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00078">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00121">AST_MODULE_SUPPORT_CORE</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l01377">ast_sorcery_load()</a>, <a class="el" href="../../d8/d25/sorcery_8h_source.html#l00408">ast_sorcery_open</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00173">ast_stir_shaken_sorcery()</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00127">AST_TEST_REGISTER</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00046">ASTERISK_GPL_KEY</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00741">reload()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01608">reload_module()</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00355">stir_shaken_certificate_load()</a>, <a class="el" href="../../d1/dca/general_8c_source.html#l00248">stir_shaken_general_load()</a>, <a class="el" href="../../d9/d7e/store_8c_source.html#l00180">stir_shaken_store_load()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01617">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;{</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;   <span class="keywordflow">if</span> (!(<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a8dcf20b310c2b64debff736f19e4887b">stir_shaken_sorcery</a> = <a class="code" href="../../d8/d25/sorcery_8h.html#ad60f3b81bed748245f8045cb48fadee2">ast_sorcery_open</a>())) {</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;stir/shaken - failed to open sorcery\n&quot;</span>);</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;   }</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/dca/general_8c.html#a375b3fd138aed892a4de021ff1c92482">stir_shaken_general_load</a>()) {</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>();</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;   }</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d7e/store_8c.html#a654747183d0ad85398c008bdb3295917">stir_shaken_store_load</a>()) {</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>();</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;   }</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5c/certificate_8c.html#aee0ed972bcbd3eb2e5fea92c73a2d9d2">stir_shaken_certificate_load</a>()) {</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>();</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;   }</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a3454f8b35930698abffa65243dfcad02">ast_sorcery_load</a>(<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#aa8f002c5950334305845b5b4944d38ce">ast_stir_shaken_sorcery</a>());</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a>(&amp;<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a6d78be1d8e55602a7de3c689b9e5a091">stir_shaken_function</a>);</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(test_stir_shaken_sign);</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(test_stir_shaken_verify);</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;}</div><div class="ttc" id="res__stir__shaken_8c_html_a8dcf20b310c2b64debff736f19e4887b"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a8dcf20b310c2b64debff736f19e4887b">stir_shaken_sorcery</a></div><div class="ttdeci">static struct ast_sorcery * stir_shaken_sorcery</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00144">res_stir_shaken.c:144</a></div></div>
<div class="ttc" id="test_8h_html_a34f64a69c09d98ceb693b077efd7ef97"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a></div><div class="ttdeci">#define AST_TEST_REGISTER(cb)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00127">test.h:127</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_aa8f002c5950334305845b5b4944d38ce"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#aa8f002c5950334305845b5b4944d38ce">ast_stir_shaken_sorcery</a></div><div class="ttdeci">struct ast_sorcery * ast_stir_shaken_sorcery(void)</div><div class="ttdoc">Retrieve the stir/shaken sorcery context. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00173">res_stir_shaken.c:173</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a6d78be1d8e55602a7de3c689b9e5a091"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a6d78be1d8e55602a7de3c689b9e5a091">stir_shaken_function</a></div><div class="ttdeci">static struct ast_custom_function stir_shaken_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01253">res_stir_shaken.c:1253</a></div></div>
<div class="ttc" id="certificate_8c_html_aee0ed972bcbd3eb2e5fea92c73a2d9d2"><div class="ttname"><a href="../../d7/d5c/certificate_8c.html#aee0ed972bcbd3eb2e5fea92c73a2d9d2">stir_shaken_certificate_load</a></div><div class="ttdeci">int stir_shaken_certificate_load(void)</div><div class="ttdoc">Load time initialization for the stir/shaken &amp;#39;certificate&amp;#39; configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5c/certificate_8c_source.html#l00355">certificate.c:355</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_ad09fa931f468002152a3cc2d5ce25eae"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a></div><div class="ttdeci">static int unload_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01617">res_stir_shaken.c:1617</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="sorcery_8h_html_a3454f8b35930698abffa65243dfcad02"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a3454f8b35930698abffa65243dfcad02">ast_sorcery_load</a></div><div class="ttdeci">void ast_sorcery_load(const struct ast_sorcery *sorcery)</div><div class="ttdoc">Inform any wizards to load persistent objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01377">sorcery.c:1377</a></div></div>
<div class="ttc" id="sorcery_8h_html_ad60f3b81bed748245f8045cb48fadee2"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#ad60f3b81bed748245f8045cb48fadee2">ast_sorcery_open</a></div><div class="ttdeci">#define ast_sorcery_open()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00408">sorcery.h:408</a></div></div>
<div class="ttc" id="general_8c_html_a375b3fd138aed892a4de021ff1c92482"><div class="ttname"><a href="../../d1/dca/general_8c.html#a375b3fd138aed892a4de021ff1c92482">stir_shaken_general_load</a></div><div class="ttdeci">int stir_shaken_general_load(void)</div><div class="ttdoc">Load time initialization for the stir/shaken &amp;#39;general&amp;#39; configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dca/general_8c_source.html#l00248">general.c:248</a></div></div>
<div class="ttc" id="store_8c_html_a654747183d0ad85398c008bdb3295917"><div class="ttname"><a href="../../d9/d7e/store_8c.html#a654747183d0ad85398c008bdb3295917">stir_shaken_store_load</a></div><div class="ttdeci">int stir_shaken_store_load(void)</div><div class="ttdoc">Load time initialization for the stir/shaken &amp;#39;store&amp;#39; configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d7e/store_8c_source.html#l00180">store.c:180</a></div></div>
<div class="ttc" id="pbx_8h_html_a8af0e93442a9e468425f63cc52b0ac7b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a></div><div class="ttdeci">#define ast_custom_function_register(acf)</div><div class="ttdoc">Register a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l01508">pbx.h:1508</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa83e9414e32ada50d14653f6f8405069"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa83e9414e32ada50d14653f6f8405069">&#9670;&nbsp;</a></span>public_key_is_expired()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int public_key_is_expired </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>public_cert_url</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check to see if the public key is expired. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">public_cert_url</td><td>The public cert URL</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>if expired </td></tr>
    <tr><td class="paramname">0</td><td>if not expired </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00405">405</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/d21/main_2db_8c_source.html#l00412">ast_db_get()</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00264">ast_sha1_hash()</a>, <a class="el" href="../../d6/d1e/conversions_8c_source.html#l00080">ast_str_to_ulong()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00128">ast_tvcmp()</a>, and <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">ast_stir_shaken_verify()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00594">curl_and_check_expiration()</a>.</p>
<div class="fragment"><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;{</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;   <span class="keyword">struct </span>timeval current_time = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;   <span class="keyword">struct </span>timeval expires = { .tv_sec = 0, .tv_usec = 0 };</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   <span class="keywordtype">char</span> expiration[32];</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   <span class="keywordtype">char</span> hash[41];</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a>(hash, public_cert_url);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;   <a class="code" href="../../de/d4a/astdb_8h.html#a6ab91701fa0db9fad7759fe42a581c17">ast_db_get</a>(hash, <span class="stringliteral">&quot;expiration&quot;</span>, expiration, <span class="keyword">sizeof</span>(expiration));</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(expiration)) {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   }</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../da/dd6/conversions_8h.html#ac2ae5e5bcd56c0058d2428002b1ce509">ast_str_to_ulong</a>(expiration, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;expires.tv_sec)) {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;   }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a>(current_time, expires) == -1 ? 0 : 1;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;}</div><div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="utils_8h_html_af35c6f780502c691f0ae35e1d0f7a444"><div class="ttname"><a href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a></div><div class="ttdeci">void ast_sha1_hash(char *output, const char *input)</div><div class="ttdoc">Produces SHA1 hash based on input string. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00264">main/utils.c:264</a></div></div>
<div class="ttc" id="time_8h_html_a6daa33e2052acd094bb63e78aba29733"><div class="ttname"><a href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a></div><div class="ttdeci">int ast_tvcmp(struct timeval _a, struct timeval _b)</div><div class="ttdoc">Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller, equal or greater to the second. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00128">time.h:128</a></div></div>
<div class="ttc" id="astdb_8h_html_a6ab91701fa0db9fad7759fe42a581c17"><div class="ttname"><a href="../../de/d4a/astdb_8h.html#a6ab91701fa0db9fad7759fe42a581c17">ast_db_get</a></div><div class="ttdeci">int ast_db_get(const char *family, const char *key, char *value, int valuelen)</div><div class="ttdoc">Get key value specified by family/key. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00412">main/db.c:412</a></div></div>
<div class="ttc" id="conversions_8h_html_ac2ae5e5bcd56c0058d2428002b1ce509"><div class="ttname"><a href="../../da/dd6/conversions_8h.html#ac2ae5e5bcd56c0058d2428002b1ce509">ast_str_to_ulong</a></div><div class="ttdeci">int ast_str_to_ulong(const char *str, unsigned long *res)</div><div class="ttdoc">Convert the given string to an unsigned long. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1e/conversions_8c_source.html#l00080">conversions.c:80</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7c6ac25ea7536c0bc9ed18cbcf917527"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c6ac25ea7536c0bc9ed18cbcf917527">&#9670;&nbsp;</a></span>reload_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int reload_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01608">1608</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d7/d69/sorcery_8c_source.html#l01408">ast_sorcery_reload()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01636">load_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;{</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a8dcf20b310c2b64debff736f19e4887b">stir_shaken_sorcery</a>) {</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a69912e63564491df0fdca6694409a721">ast_sorcery_reload</a>(<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a8dcf20b310c2b64debff736f19e4887b">stir_shaken_sorcery</a>);</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;   }</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;}</div><div class="ttc" id="res__stir__shaken_8c_html_a8dcf20b310c2b64debff736f19e4887b"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a8dcf20b310c2b64debff736f19e4887b">stir_shaken_sorcery</a></div><div class="ttdeci">static struct ast_sorcery * stir_shaken_sorcery</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00144">res_stir_shaken.c:144</a></div></div>
<div class="ttc" id="sorcery_8h_html_a69912e63564491df0fdca6694409a721"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a69912e63564491df0fdca6694409a721">ast_sorcery_reload</a></div><div class="ttdeci">void ast_sorcery_reload(const struct ast_sorcery *sorcery)</div><div class="ttdoc">Inform any wizards to reload persistent objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01408">sorcery.c:1408</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3c7438eef28b9e981865b28eaed8222b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c7438eef28b9e981865b28eaed8222b">&#9670;&nbsp;</a></span>remove_public_key_from_astdb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void remove_public_key_from_astdb </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>public_cert_url</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remove the public key details and associated information from AstDB. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">public_cert_url</td><td>The public cert URL </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00471">471</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/d21/main_2db_8c_source.html#l00429">ast_db_del()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00457">ast_db_deltree()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00147">AST_DB_FAMILY</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00412">ast_db_get()</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00264">ast_sha1_hash()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00153">MAX_PATH_LEN</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">ast_stir_shaken_verify()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01491">AST_TEST_DEFINE()</a>.</p>
<div class="fragment"><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;{</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;   <span class="keywordtype">char</span> hash[41];</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;   <span class="keywordtype">char</span> filepath[<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#abdd33f362ae3bbdacb5de76473aa8a2f">MAX_PATH_LEN</a>];</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a>(hash, public_cert_url);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;   <span class="comment">/* Remove this public key from storage */</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   <a class="code" href="../../de/d4a/astdb_8h.html#a6ab91701fa0db9fad7759fe42a581c17">ast_db_get</a>(hash, <span class="stringliteral">&quot;path&quot;</span>, filepath, <span class="keyword">sizeof</span>(filepath));</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   <span class="comment">/* Remove the actual file from the system */</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;   <span class="keyword">remove</span>(filepath);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;   <a class="code" href="../../de/d4a/astdb_8h.html#a71e8d5ab1757b184683a99125d1c8160">ast_db_del</a>(<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ae4ce713ce592a4fa48d99cb779cad7c2">AST_DB_FAMILY</a>, public_cert_url);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   <a class="code" href="../../de/d4a/astdb_8h.html#af251d986cfe884ffd5ca864531253f62">ast_db_deltree</a>(hash, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_ae4ce713ce592a4fa48d99cb779cad7c2"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#ae4ce713ce592a4fa48d99cb779cad7c2">AST_DB_FAMILY</a></div><div class="ttdeci">#define AST_DB_FAMILY</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00147">res_stir_shaken.c:147</a></div></div>
<div class="ttc" id="utils_8h_html_af35c6f780502c691f0ae35e1d0f7a444"><div class="ttname"><a href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a></div><div class="ttdeci">void ast_sha1_hash(char *output, const char *input)</div><div class="ttdoc">Produces SHA1 hash based on input string. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00264">main/utils.c:264</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_abdd33f362ae3bbdacb5de76473aa8a2f"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#abdd33f362ae3bbdacb5de76473aa8a2f">MAX_PATH_LEN</a></div><div class="ttdeci">#define MAX_PATH_LEN</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00153">res_stir_shaken.c:153</a></div></div>
<div class="ttc" id="astdb_8h_html_a6ab91701fa0db9fad7759fe42a581c17"><div class="ttname"><a href="../../de/d4a/astdb_8h.html#a6ab91701fa0db9fad7759fe42a581c17">ast_db_get</a></div><div class="ttdeci">int ast_db_get(const char *family, const char *key, char *value, int valuelen)</div><div class="ttdoc">Get key value specified by family/key. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00412">main/db.c:412</a></div></div>
<div class="ttc" id="astdb_8h_html_a71e8d5ab1757b184683a99125d1c8160"><div class="ttname"><a href="../../de/d4a/astdb_8h.html#a71e8d5ab1757b184683a99125d1c8160">ast_db_del</a></div><div class="ttdeci">int ast_db_del(const char *family, const char *key)</div><div class="ttdoc">Delete entry in astdb. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00429">main/db.c:429</a></div></div>
<div class="ttc" id="astdb_8h_html_af251d986cfe884ffd5ca864531253f62"><div class="ttname"><a href="../../de/d4a/astdb_8h.html#af251d986cfe884ffd5ca864531253f62">ast_db_deltree</a></div><div class="ttdeci">int ast_db_deltree(const char *family, const char *keytree)</div><div class="ttdoc">Delete one or more entries in astdb. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00457">main/db.c:457</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8caa031d2c1bdbb8c62c657c30664464"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8caa031d2c1bdbb8c62c657c30664464">&#9670;&nbsp;</a></span>run_curl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char* run_curl </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>public_cert_url</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CURL the file located at public_cert_url to the specified path. </p>
<dl class="section note"><dt>Note</dt><dd>filename will need to be freed by the caller</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">public_cert_url</td><td>The public cert URL </td></tr>
    <tr><td class="paramname">path</td><td>The path to download the file to</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td>on failure </td></tr>
    <tr><td class="paramname">full</td><td>path filename on success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00557">557</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d6/d4c/curl_8c_source.html#l00042">curl_cb_data_create()</a>, <a class="el" href="../../d6/d4c/curl_8c_source.html#l00051">curl_cb_data_free()</a>, <a class="el" href="../../d6/d4c/curl_8c_source.html#l00185">curl_public_key()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00352">set_public_key_expiration()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">ast_stir_shaken_verify()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00594">curl_and_check_expiration()</a>.</p>
<div class="fragment"><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;{</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d34/structcurl__cb__data.html">curl_cb_data</a> *data;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;   <span class="keywordtype">char</span> *filename;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;   data = <a class="code" href="../../d6/d4c/curl_8c.html#a5fcf33eef5708717904fb03c0bb49fd6">curl_cb_data_create</a>();</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   <span class="keywordflow">if</span> (!data) {</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create CURL callback data\n&quot;</span>);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   }</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   filename = <a class="code" href="../../d6/d4c/curl_8c.html#ad4e97e7d4cd8ba42b2557cbc6b6d289e">curl_public_key</a>(public_cert_url, path, data);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   <span class="keywordflow">if</span> (!filename) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not retrieve public key for &#39;%s&#39;\n&quot;</span>, public_cert_url);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <a class="code" href="../../d6/d4c/curl_8c.html#a3e5632ce5ce5a78b2583b4c26b142462">curl_cb_data_free</a>(data);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;   }</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a615fbf21f65958dd15002012178fdc46">set_public_key_expiration</a>(public_cert_url, data);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;   <a class="code" href="../../d6/d4c/curl_8c.html#a3e5632ce5ce5a78b2583b4c26b142462">curl_cb_data_free</a>(data);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   <span class="keywordflow">return</span> filename;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;}</div><div class="ttc" id="curl_8c_html_a3e5632ce5ce5a78b2583b4c26b142462"><div class="ttname"><a href="../../d6/d4c/curl_8c.html#a3e5632ce5ce5a78b2583b4c26b142462">curl_cb_data_free</a></div><div class="ttdeci">void curl_cb_data_free(struct curl_cb_data *data)</div><div class="ttdoc">Free a curl_cb_data struct. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d4c/curl_8c_source.html#l00051">curl.c:51</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="curl_8c_html_ad4e97e7d4cd8ba42b2557cbc6b6d289e"><div class="ttname"><a href="../../d6/d4c/curl_8c.html#ad4e97e7d4cd8ba42b2557cbc6b6d289e">curl_public_key</a></div><div class="ttdeci">char * curl_public_key(const char *public_cert_url, const char *path, struct curl_cb_data *data)</div><div class="ttdoc">CURL the public key from the provided URL to the specified path. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d4c/curl_8c_source.html#l00185">curl.c:185</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a615fbf21f65958dd15002012178fdc46"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a615fbf21f65958dd15002012178fdc46">set_public_key_expiration</a></div><div class="ttdeci">static void set_public_key_expiration(const char *public_cert_url, const struct curl_cb_data *data)</div><div class="ttdoc">Sets the expiration for the public key based on the provided fields. If Cache-Control is present...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00352">res_stir_shaken.c:352</a></div></div>
<div class="ttc" id="curl_8c_html_a5fcf33eef5708717904fb03c0bb49fd6"><div class="ttname"><a href="../../d6/d4c/curl_8c.html#a5fcf33eef5708717904fb03c0bb49fd6">curl_cb_data_create</a></div><div class="ttdeci">struct curl_cb_data * curl_cb_data_create(void)</div><div class="ttdoc">Allocate memory for a curl_cb_data struct. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d4c/curl_8c_source.html#l00042">curl.c:42</a></div></div>
<div class="ttc" id="structcurl__cb__data_html"><div class="ttname"><a href="../../d5/d34/structcurl__cb__data.html">curl_cb_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d4c/curl_8c_source.html#l00037">curl.c:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a615fbf21f65958dd15002012178fdc46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a615fbf21f65958dd15002012178fdc46">&#9670;&nbsp;</a></span>set_public_key_expiration()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void set_public_key_expiration </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>public_cert_url</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../d5/d34/structcurl__cb__data.html">curl_cb_data</a> *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets the expiration for the public key based on the provided fields. If Cache-Control is present, use it. Otherwise, use Expires. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">public_cert_url</td><td>The URL to the public certificate </td></tr>
    <tr><td class="paramname">data</td><td>The CURL callback data containing expiration data </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00352">352</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/d21/main_2db_8c_source.html#l00327">ast_db_put()</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00264">ast_sha1_hash()</a>, <a class="el" href="../../d6/d1e/conversions_8c_source.html#l00056">ast_str_to_uint()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>, <a class="el" href="../../d6/d4c/curl_8c_source.html#l00063">curl_cb_data_get_cache_control()</a>, <a class="el" href="../../d6/d4c/curl_8c_source.html#l00072">curl_cb_data_get_expires()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00158">EXPIRATION_BUFFER</a>, and <a class="el" href="../../d4/d2f/syslog_8c_source.html#l00037">value</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00557">run_curl()</a>.</p>
<div class="fragment"><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;{</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   <span class="keywordtype">char</span> time_buf[32];</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <span class="keyword">struct </span>timeval actual_expires = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <span class="keywordtype">char</span> hash[41];</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a>(hash, public_cert_url);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;   value = <a class="code" href="../../d6/d4c/curl_8c.html#a192be2e3edfd5868ff792fefd2ca68ee">curl_cb_data_get_cache_control</a>(data);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(value)) {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordtype">char</span> *str_max_age;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      str_max_age = strstr(value, <span class="stringliteral">&quot;s-maxage&quot;</span>);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">if</span> (!str_max_age) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;         str_max_age = strstr(value, <span class="stringliteral">&quot;max-age&quot;</span>);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="keywordflow">if</span> (str_max_age) {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_age;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;         <span class="keywordtype">char</span> *equal = strchr(str_max_age, <span class="charliteral">&#39;=&#39;</span>);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;         <span class="keywordflow">if</span> (equal &amp;&amp; !<a class="code" href="../../da/dd6/conversions_8h.html#a9982602f3c9f6975b4689b0ac441efa9">ast_str_to_uint</a>(equal + 1, &amp;max_age)) {</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            actual_expires.tv_sec += max_age;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;         }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      }</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      value = <a class="code" href="../../d6/d4c/curl_8c.html#ad43b61159a9bdbf6687231585fd7c6c8">curl_cb_data_get_expires</a>(data);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(value)) {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;         <span class="keyword">struct </span>tm expires_time;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;         strptime(value, <span class="stringliteral">&quot;%a, %d %b %Y %T %z&quot;</span>, &amp;expires_time);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;         expires_time.tm_isdst = -1;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;         actual_expires.tv_sec = mktime(&amp;expires_time);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      }</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(value)) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      actual_expires.tv_sec += <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#aa26d5e67e841fb4e32f3fbe378ce16fd">EXPIRATION_BUFFER</a>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;   snprintf(time_buf, <span class="keyword">sizeof</span>(time_buf), <span class="stringliteral">&quot;%30lu&quot;</span>, actual_expires.tv_sec);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   <a class="code" href="../../de/d4a/astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a>(hash, <span class="stringliteral">&quot;expiration&quot;</span>, time_buf);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;}</div><div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_aa26d5e67e841fb4e32f3fbe378ce16fd"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#aa26d5e67e841fb4e32f3fbe378ce16fd">EXPIRATION_BUFFER</a></div><div class="ttdeci">#define EXPIRATION_BUFFER</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00158">res_stir_shaken.c:158</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="curl_8c_html_ad43b61159a9bdbf6687231585fd7c6c8"><div class="ttname"><a href="../../d6/d4c/curl_8c.html#ad43b61159a9bdbf6687231585fd7c6c8">curl_cb_data_get_expires</a></div><div class="ttdeci">char * curl_cb_data_get_expires(const struct curl_cb_data *data)</div><div class="ttdoc">Get the expires field from a curl_cb_data struct. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d4c/curl_8c_source.html#l00072">curl.c:72</a></div></div>
<div class="ttc" id="curl_8c_html_a192be2e3edfd5868ff792fefd2ca68ee"><div class="ttname"><a href="../../d6/d4c/curl_8c.html#a192be2e3edfd5868ff792fefd2ca68ee">curl_cb_data_get_cache_control</a></div><div class="ttdeci">char * curl_cb_data_get_cache_control(const struct curl_cb_data *data)</div><div class="ttdoc">Get the cache_control field from a curl_cb_data struct. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d4c/curl_8c_source.html#l00063">curl.c:63</a></div></div>
<div class="ttc" id="utils_8h_html_af35c6f780502c691f0ae35e1d0f7a444"><div class="ttname"><a href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a></div><div class="ttdeci">void ast_sha1_hash(char *output, const char *input)</div><div class="ttdoc">Produces SHA1 hash based on input string. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00264">main/utils.c:264</a></div></div>
<div class="ttc" id="conversions_8h_html_a9982602f3c9f6975b4689b0ac441efa9"><div class="ttname"><a href="../../da/dd6/conversions_8h.html#a9982602f3c9f6975b4689b0ac441efa9">ast_str_to_uint</a></div><div class="ttdeci">int ast_str_to_uint(const char *str, unsigned int *res)</div><div class="ttdoc">Convert the given string to an unsigned integer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1e/conversions_8c_source.html#l00056">conversions.c:56</a></div></div>
<div class="ttc" id="astdb_8h_html_a0f14f6bff4f412c88b50aba34d3a5e35"><div class="ttname"><a href="../../de/d4a/astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a></div><div class="ttdeci">int ast_db_put(const char *family, const char *key, const char *value)</div><div class="ttdoc">Store value addressed by family/key. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00327">main/db.c:327</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a45cf54d94d39f785ea5af17ce2b5a5b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45cf54d94d39f785ea5af17ce2b5a5b0">&#9670;&nbsp;</a></span>stir_shaken_add_attest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int stir_shaken_add_attest </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *&#160;</td>
          <td class="paramname"><em>json</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>attest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds the 'attest' field to the JWT. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>The JWT </td></tr>
    <tr><td class="paramname">attest</td><td>The value to set attest to</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">-1</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00990">990</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00404">ast_json_object_set()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00268">ast_json_string_create()</a>, and <a class="el" href="../../d4/d2f/syslog_8c_source.html#l00037">value</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">ast_stir_shaken_sign()</a>.</p>
<div class="fragment"><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;{</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   value = <a class="code" href="../../d4/d05/json_8h.html#adc52f8d76b7fdd0c8d12987981fd5bf5">ast_json_string_create</a>(attest);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;   <span class="keywordflow">if</span> (!value) {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;   }</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d4/d05/json_8h.html#abc8b563c172cfaffa2b555195990f729">ast_json_object_set</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;payload&quot;</span>), <span class="stringliteral">&quot;attest&quot;</span>, value);</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;}</div><div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="json_8h_html_abc8b563c172cfaffa2b555195990f729"><div class="ttname"><a href="../../d4/d05/json_8h.html#abc8b563c172cfaffa2b555195990f729">ast_json_object_set</a></div><div class="ttdeci">int ast_json_object_set(struct ast_json *object, const char *key, struct ast_json *value)</div><div class="ttdoc">Set a field in a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00404">json.c:404</a></div></div>
<div class="ttc" id="json_8h_html_adc52f8d76b7fdd0c8d12987981fd5bf5"><div class="ttname"><a href="../../d4/d05/json_8h.html#adc52f8d76b7fdd0c8d12987981fd5bf5">ast_json_string_create</a></div><div class="ttdeci">struct ast_json * ast_json_string_create(const char *value)</div><div class="ttdoc">Construct a JSON string from value. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00268">json.c:268</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a627d94eaec2f591f17ff707c635e3b19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a627d94eaec2f591f17ff707c635e3b19">&#9670;&nbsp;</a></span>stir_shaken_add_iat()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int stir_shaken_add_iat </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *&#160;</td>
          <td class="paramname"><em>json</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds the 'iat' field to the JWT. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>The JWT</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">-1</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01033">1033</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../df/d98/json_8c_source.html#l00317">ast_json_integer_create()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00404">ast_json_object_set()</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>, and <a class="el" href="../../d4/d2f/syslog_8c_source.html#l00037">value</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">ast_stir_shaken_sign()</a>.</p>
<div class="fragment"><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;{</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;   <span class="keyword">struct </span>timeval tv;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;   <span class="keywordtype">int</span> timestamp;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;   tv = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;   timestamp = tv.tv_sec + tv.tv_usec / 1000;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;   value = <a class="code" href="../../d4/d05/json_8h.html#ac13f0f415f198c5a341017195933356f">ast_json_integer_create</a>(timestamp);</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d4/d05/json_8h.html#abc8b563c172cfaffa2b555195990f729">ast_json_object_set</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;payload&quot;</span>), <span class="stringliteral">&quot;iat&quot;</span>, value);</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;}</div><div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="json_8h_html_abc8b563c172cfaffa2b555195990f729"><div class="ttname"><a href="../../d4/d05/json_8h.html#abc8b563c172cfaffa2b555195990f729">ast_json_object_set</a></div><div class="ttdeci">int ast_json_object_set(struct ast_json *object, const char *key, struct ast_json *value)</div><div class="ttdoc">Set a field in a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00404">json.c:404</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="json_8h_html_ac13f0f415f198c5a341017195933356f"><div class="ttname"><a href="../../d4/d05/json_8h.html#ac13f0f415f198c5a341017195933356f">ast_json_integer_create</a></div><div class="ttdeci">struct ast_json * ast_json_integer_create(intmax_t value)</div><div class="ttdoc">Create a JSON integer. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00317">json.c:317</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4dcd80367d95b349f26e9e65aa6354e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4dcd80367d95b349f26e9e65aa6354e6">&#9670;&nbsp;</a></span>stir_shaken_add_origid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int stir_shaken_add_origid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *&#160;</td>
          <td class="paramname"><em>json</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds the 'origid' field to the JWT. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>The JWT</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">-1</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01010">1010</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00404">ast_json_object_set()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00268">ast_json_string_create()</a>, <a class="el" href="../../df/da9/uuid_8c_source.html#l00143">ast_uuid_generate_str()</a>, <a class="el" href="../../dd/d1d/uuid_8h_source.html#l00027">AST_UUID_STR_LEN</a>, and <a class="el" href="../../d4/d2f/syslog_8c_source.html#l00037">value</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">ast_stir_shaken_sign()</a>.</p>
<div class="fragment"><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;{</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;   <span class="keywordtype">char</span> uuid_str[<a class="code" href="../../dd/d1d/uuid_8h.html#a127408e53d34dca0c589a099fabf1e13">AST_UUID_STR_LEN</a>];</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;   <a class="code" href="../../dd/d1d/uuid_8h.html#abe6d0b550cd9a54964e7891960d1e5bc">ast_uuid_generate_str</a>(uuid_str, <span class="keyword">sizeof</span>(uuid_str));</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;   <span class="keywordflow">if</span> (strlen(uuid_str) != (<a class="code" href="../../dd/d1d/uuid_8h.html#a127408e53d34dca0c589a099fabf1e13">AST_UUID_STR_LEN</a> - 1)) {</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;   }</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;   value = <a class="code" href="../../d4/d05/json_8h.html#adc52f8d76b7fdd0c8d12987981fd5bf5">ast_json_string_create</a>(uuid_str);</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d4/d05/json_8h.html#abc8b563c172cfaffa2b555195990f729">ast_json_object_set</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;payload&quot;</span>), <span class="stringliteral">&quot;origid&quot;</span>, value);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;}</div><div class="ttc" id="uuid_8h_html_a127408e53d34dca0c589a099fabf1e13"><div class="ttname"><a href="../../dd/d1d/uuid_8h.html#a127408e53d34dca0c589a099fabf1e13">AST_UUID_STR_LEN</a></div><div class="ttdeci">#define AST_UUID_STR_LEN</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d1d/uuid_8h_source.html#l00027">uuid.h:27</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="json_8h_html_abc8b563c172cfaffa2b555195990f729"><div class="ttname"><a href="../../d4/d05/json_8h.html#abc8b563c172cfaffa2b555195990f729">ast_json_object_set</a></div><div class="ttdeci">int ast_json_object_set(struct ast_json *object, const char *key, struct ast_json *value)</div><div class="ttdoc">Set a field in a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00404">json.c:404</a></div></div>
<div class="ttc" id="json_8h_html_adc52f8d76b7fdd0c8d12987981fd5bf5"><div class="ttname"><a href="../../d4/d05/json_8h.html#adc52f8d76b7fdd0c8d12987981fd5bf5">ast_json_string_create</a></div><div class="ttdeci">struct ast_json * ast_json_string_create(const char *value)</div><div class="ttdoc">Construct a JSON string from value. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00268">json.c:268</a></div></div>
<div class="ttc" id="uuid_8h_html_abe6d0b550cd9a54964e7891960d1e5bc"><div class="ttname"><a href="../../dd/d1d/uuid_8h.html#abe6d0b550cd9a54964e7891960d1e5bc">ast_uuid_generate_str</a></div><div class="ttdeci">char * ast_uuid_generate_str(char *buf, size_t size)</div><div class="ttdoc">Generate a UUID string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/da9/uuid_8c_source.html#l00143">uuid.c:143</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afadb7d3f5ae2dff49eb62190cbfdc532"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afadb7d3f5ae2dff49eb62190cbfdc532">&#9670;&nbsp;</a></span>stir_shaken_add_x5u()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int stir_shaken_add_x5u </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *&#160;</td>
          <td class="paramname"><em>json</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>x5u</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds the 'x5u' (public key URL) field to the JWT. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>The JWT </td></tr>
    <tr><td class="paramname">x5u</td><td>The public key URL</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">-1</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00969">969</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00404">ast_json_object_set()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00268">ast_json_string_create()</a>, and <a class="el" href="../../d4/d2f/syslog_8c_source.html#l00037">value</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">ast_stir_shaken_sign()</a>.</p>
<div class="fragment"><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;{</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;   value = <a class="code" href="../../d4/d05/json_8h.html#adc52f8d76b7fdd0c8d12987981fd5bf5">ast_json_string_create</a>(x5u);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   <span class="keywordflow">if</span> (!value) {</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;   }</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d4/d05/json_8h.html#abc8b563c172cfaffa2b555195990f729">ast_json_object_set</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;header&quot;</span>), <span class="stringliteral">&quot;x5u&quot;</span>, value);</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;}</div><div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="json_8h_html_abc8b563c172cfaffa2b555195990f729"><div class="ttname"><a href="../../d4/d05/json_8h.html#abc8b563c172cfaffa2b555195990f729">ast_json_object_set</a></div><div class="ttdeci">int ast_json_object_set(struct ast_json *object, const char *key, struct ast_json *value)</div><div class="ttdoc">Set a field in a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00404">json.c:404</a></div></div>
<div class="ttc" id="json_8h_html_adc52f8d76b7fdd0c8d12987981fd5bf5"><div class="ttname"><a href="../../d4/d05/json_8h.html#adc52f8d76b7fdd0c8d12987981fd5bf5">ast_json_string_create</a></div><div class="ttdeci">struct ast_json * ast_json_string_create(const char *value)</div><div class="ttdoc">Construct a JSON string from value. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00268">json.c:268</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a18800da0faca5e17bede21443b9b7b45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18800da0faca5e17bede21443b9b7b45">&#9670;&nbsp;</a></span>stir_shaken_datastore_destroy_cb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void stir_shaken_datastore_destroy_cb </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The callback to destroy a <a class="el" href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>The <a class="el" href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a> </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00265">265</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00249">stir_shaken_datastore_free()</a>.</p>
<div class="fragment"><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;{</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a> *datastore = data;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#af70e99d804e4c81aad5165b2e77d6cc4">stir_shaken_datastore_free</a>(datastore);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;}</div><div class="ttc" id="structstir__shaken__datastore_html"><div class="ttname"><a href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00235">res_stir_shaken.c:235</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_af70e99d804e4c81aad5165b2e77d6cc4"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#af70e99d804e4c81aad5165b2e77d6cc4">stir_shaken_datastore_free</a></div><div class="ttdeci">static void stir_shaken_datastore_free(struct stir_shaken_datastore *datastore)</div><div class="ttdoc">Frees a stir_shaken_datastore structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00249">res_stir_shaken.c:249</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af70e99d804e4c81aad5165b2e77d6cc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af70e99d804e4c81aad5165b2e77d6cc4">&#9670;&nbsp;</a></span>stir_shaken_datastore_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void stir_shaken_datastore_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a> *&#160;</td>
          <td class="paramname"><em>datastore</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Frees a <a class="el" href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a> structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">datastore</td><td>The datastore to free </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00249">249</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00239">stir_shaken_datastore::attestation</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00237">stir_shaken_datastore::identity</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00277">ast_stir_shaken_add_verification()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00265">stir_shaken_datastore_destroy_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;{</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   <span class="keywordflow">if</span> (!datastore) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   }</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(datastore-&gt;<a class="code" href="../../df/d32/structstir__shaken__datastore.html#a6aca08b7b55b60ed1900be34b81482ac">identity</a>);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(datastore-&gt;<a class="code" href="../../df/d32/structstir__shaken__datastore.html#a2cf11b44e1f704c9c5a80b8d36ec3540">attestation</a>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(datastore);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;}</div><div class="ttc" id="structstir__shaken__datastore_html_a2cf11b44e1f704c9c5a80b8d36ec3540"><div class="ttname"><a href="../../df/d32/structstir__shaken__datastore.html#a2cf11b44e1f704c9c5a80b8d36ec3540">stir_shaken_datastore::attestation</a></div><div class="ttdeci">char * attestation</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00239">res_stir_shaken.c:239</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structstir__shaken__datastore_html_a6aca08b7b55b60ed1900be34b81482ac"><div class="ttname"><a href="../../df/d32/structstir__shaken__datastore.html#a6aca08b7b55b60ed1900be34b81482ac">stir_shaken_datastore::identity</a></div><div class="ttdeci">char * identity</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00237">res_stir_shaken.c:237</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad1727642614616f01e0bba04ba0f549c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1727642614616f01e0bba04ba0f549c">&#9670;&nbsp;</a></span>stir_shaken_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int stir_shaken_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves STIR/SHAKEN verification information for the channel via dialplan. Examples: </p>
<p>STIR_SHAKEN(count) STIR_SHAKEN(0, identity) STIR_SHAKEN(1, attestation) STIR_SHAKEN(27, verify_result)</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>on failure </td></tr>
    <tr><td class="paramname">0</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01145">1145</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/dde/test__func__file_8c_source.html#l00046">args</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01232">AST_APP_ARG</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00868">ast_channel_datastores()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00401">ast_copy_string()</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01249">AST_DECLARE_APP_ARGS</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01285">AST_STANDARD_APP_ARGS</a>, <a class="el" href="../../d6/d1e/conversions_8c_source.html#l00056">ast_str_to_uint()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00300">ast_strdupa</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00219">ast_strip()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00239">stir_shaken_datastore::attestation</a>, <a class="el" href="../../d9/db6/datastore_8h_source.html#l00070">ast_datastore::data</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01092">first</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00237">stir_shaken_datastore::identity</a>, <a class="el" href="../../d9/db6/datastore_8h_source.html#l00071">ast_datastore::info</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l01872">parse()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00216">stir_shaken_verification_result_to_string()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00241">stir_shaken_datastore::verify_result</a>.</p>
<div class="fragment"><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;{</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a> *ss_datastore;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *datastore;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a>;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../df/d44/app__meetme_8c.html#a18b6f1cf748d864dd085819a7d4e6680">first</a>;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;   <span class="keywordtype">char</span> *second;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> target_index, current_index = 0;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(first_param);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(second_param);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;   );</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>)) {</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s requires at least one argument\n&quot;</span>, <span class="keyword">function</span>);</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;   }</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;   <span class="keywordflow">if</span> (!chan) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No channel for %s function\n&quot;</span>, <span class="keyword">function</span>);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;   }</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;   parse = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>);</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, parse);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;   first = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.first_param);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(first)) {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;An argument must be passed to %s\n&quot;</span>, <span class="keyword">function</span>);</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;   }</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;   second = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.second_param);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;   <span class="comment">/* Check if we are only looking for the number of STIR/SHAKEN verification results */</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(first, <span class="stringliteral">&quot;count&quot;</span>)) {</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <span class="keywordtype">size_t</span> count = 0;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(second)) {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s only takes 1 paramater for &#39;count&#39;\n&quot;</span>, <span class="keyword">function</span>);</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      }</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(<a class="code" href="../../d5/d7b/channel_8h.html#aae56765bab2eed7bd11d8dca29b2975c">ast_channel_datastores</a>(chan), datastore, <a class="code" href="../../d3/d96/structentry.html">entry</a>) {</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;         <span class="keywordflow">if</span> (datastore-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a03ea21247b5d39b165343431b44131f1">info</a> != &amp;<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a3e7896640205a0d33331358444f14e8d">stir_shaken_datastore_info</a>) {</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;         }</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;         count++;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      }</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      snprintf(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%zu&quot;</span>, count);</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;   }</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;   <span class="comment">/* If we aren&#39;t doing a count, then there should be two parameters. The field</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment">    * we are searching for will be the second parameter. The index is the first.</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(second)) {</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Retrieving a value using %s requires two paramaters (index, value) &quot;</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;         <span class="stringliteral">&quot;- only index was given\n&quot;</span>, <span class="keyword">function</span>);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;   }</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../da/dd6/conversions_8h.html#a9982602f3c9f6975b4689b0ac441efa9">ast_str_to_uint</a>(first, &amp;target_index)) {</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to convert index %s to integer for function %s\n&quot;</span>,</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;         first, <span class="keyword">function</span>);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;   }</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;   <span class="comment">/* We don&#39;t store by uid for the datastore, so just search for the specified index */</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(<a class="code" href="../../d5/d7b/channel_8h.html#aae56765bab2eed7bd11d8dca29b2975c">ast_channel_datastores</a>(chan), datastore, <a class="code" href="../../d3/d96/structentry.html">entry</a>) {</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      <span class="keywordflow">if</span> (datastore-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a03ea21247b5d39b165343431b44131f1">info</a> != &amp;<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a3e7896640205a0d33331358444f14e8d">stir_shaken_datastore_info</a>) {</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      }</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="keywordflow">if</span> (current_index == target_index) {</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      }</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      current_index++;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;   }</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   <span class="keywordflow">if</span> (current_index != target_index || !datastore) {</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No STIR/SHAKEN results for index &#39;%s&#39;\n&quot;</span>, first);</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;   }</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;   ss_datastore = datastore-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(second, <span class="stringliteral">&quot;identity&quot;</span>)) {</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, ss_datastore-&gt;<a class="code" href="../../df/d32/structstir__shaken__datastore.html#a6aca08b7b55b60ed1900be34b81482ac">identity</a>, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(second, <span class="stringliteral">&quot;attestation&quot;</span>)) {</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, ss_datastore-&gt;<a class="code" href="../../df/d32/structstir__shaken__datastore.html#a2cf11b44e1f704c9c5a80b8d36ec3540">attestation</a>, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(second, <span class="stringliteral">&quot;verify_result&quot;</span>)) {</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a75a59cd4e8a87ff1baa3c3a77f2019de">stir_shaken_verification_result_to_string</a>(ss_datastore-&gt;<a class="code" href="../../df/d32/structstir__shaken__datastore.html#a995f16f55b12710f602f521bc9e95171">verify_result</a>), <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No such value &#39;%s&#39; for %s\n&quot;</span>, second, <span class="keyword">function</span>);</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;   }</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;}</div><div class="ttc" id="structstir__shaken__datastore_html"><div class="ttname"><a href="../../df/d32/structstir__shaken__datastore.html">stir_shaken_datastore</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00235">res_stir_shaken.c:235</a></div></div>
<div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a75a59cd4e8a87ff1baa3c3a77f2019de"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a75a59cd4e8a87ff1baa3c3a77f2019de">stir_shaken_verification_result_to_string</a></div><div class="ttdeci">static const char * stir_shaken_verification_result_to_string(enum ast_stir_shaken_verification_result result)</div><div class="ttdoc">Convert an ast_stir_shaken_verification_result to string representation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00216">res_stir_shaken.c:216</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a3e7896640205a0d33331358444f14e8d"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a3e7896640205a0d33331358444f14e8d">stir_shaken_datastore_info</a></div><div class="ttdeci">static const struct ast_datastore_info stir_shaken_datastore_info</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00272">res_stir_shaken.c:272</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_ac08f7eb1eb9476b30987c73e1052ada8"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a></div><div class="ttdeci">#define AST_STANDARD_APP_ARGS(args, parse)</div><div class="ttdoc">Performs the &amp;#39;standard&amp;#39; argument separation process for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01285">include/asterisk/app.h:1285</a></div></div>
<div class="ttc" id="structstir__shaken__datastore_html_a2cf11b44e1f704c9c5a80b8d36ec3540"><div class="ttname"><a href="../../df/d32/structstir__shaken__datastore.html#a2cf11b44e1f704c9c5a80b8d36ec3540">stir_shaken_datastore::attestation</a></div><div class="ttdeci">char * attestation</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00239">res_stir_shaken.c:239</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="structast__datastore_html"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html">ast_datastore</a></div><div class="ttdoc">Structure for a data store object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00068">datastore.h:68</a></div></div>
<div class="ttc" id="test__func__file_8c_html_a7df83d295429a2562396f1ec127a46c0"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a></div><div class="ttdeci">const char * args</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00046">test_func_file.c:46</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="strings_8h_html_ac92713b8d07a45720b2664be70810e55"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a></div><div class="ttdeci">char * ast_strip(char *s)</div><div class="ttdoc">Strip leading/trailing whitespace from a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00219">strings.h:219</a></div></div>
<div class="ttc" id="channel_8h_html_aae56765bab2eed7bd11d8dca29b2975c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aae56765bab2eed7bd11d8dca29b2975c">ast_channel_datastores</a></div><div class="ttdeci">struct ast_datastore_list * ast_channel_datastores(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00868">channel_internal_api.c:868</a></div></div>
<div class="ttc" id="structast__datastore_html_a03ea21247b5d39b165343431b44131f1"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html#a03ea21247b5d39b165343431b44131f1">ast_datastore::info</a></div><div class="ttdeci">const struct ast_datastore_info * info</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00071">datastore.h:71</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="app__meetme_8c_html_a18b6f1cf748d864dd085819a7d4e6680"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#a18b6f1cf748d864dd085819a7d4e6680">first</a></div><div class="ttdeci">struct sla_ringing_trunk * first</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01092">app_meetme.c:1092</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a3008b2f4f236b72d8bcfb80e346324ef"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE(head, var, field)</div><div class="ttdoc">Loops over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00490">linkedlists.h:490</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a2e006acff60d9b3d65d7d60f975d6747"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a></div><div class="ttdeci">static void parse(struct mgcp_request *req)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l01872">chan_mgcp.c:1872</a></div></div>
<div class="ttc" id="structstir__shaken__datastore_html_a995f16f55b12710f602f521bc9e95171"><div class="ttname"><a href="../../df/d32/structstir__shaken__datastore.html#a995f16f55b12710f602f521bc9e95171">stir_shaken_datastore::verify_result</a></div><div class="ttdeci">enum ast_stir_shaken_verification_result verify_result</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00241">res_stir_shaken.c:241</a></div></div>
<div class="ttc" id="conversions_8h_html_a9982602f3c9f6975b4689b0ac441efa9"><div class="ttname"><a href="../../da/dd6/conversions_8h.html#a9982602f3c9f6975b4689b0ac441efa9">ast_str_to_uint</a></div><div class="ttdeci">int ast_str_to_uint(const char *str, unsigned int *res)</div><div class="ttdoc">Convert the given string to an unsigned integer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1e/conversions_8c_source.html#l00056">conversions.c:56</a></div></div>
<div class="ttc" id="structast__datastore_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">ast_datastore::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00070">datastore.h:70</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="structentry_html"><div class="ttname"><a href="../../d3/d96/structentry.html">entry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d85/search_8h_source.html#l00040">search.h:40</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a80cd3f6f786b59b742bcecfc0b3be7c2"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a></div><div class="ttdeci">#define AST_DECLARE_APP_ARGS(name, arglist)</div><div class="ttdoc">Declare a structure to hold an application&amp;#39;s arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01249">include/asterisk/app.h:1249</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a037e9a5b28477b17e7c9acbe7ecb21d5"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a></div><div class="ttdeci">#define AST_APP_ARG(name)</div><div class="ttdoc">Define an application argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01232">include/asterisk/app.h:1232</a></div></div>
<div class="ttc" id="structstir__shaken__datastore_html_a6aca08b7b55b60ed1900be34b81482ac"><div class="ttname"><a href="../../df/d32/structstir__shaken__datastore.html#a6aca08b7b55b60ed1900be34b81482ac">stir_shaken_datastore::identity</a></div><div class="ttdeci">char * identity</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00237">res_stir_shaken.c:237</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a40731266d3ab5020f880fab33e3441d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40731266d3ab5020f880fab33e3441d2">&#9670;&nbsp;</a></span>stir_shaken_sign()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned char* stir_shaken_sign </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>json_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">EVP_PKEY *&#160;</td>
          <td class="paramname"><em>private_key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Signs the payload and returns the signature. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json_str</td><td>The string representation of the JSON </td></tr>
    <tr><td class="paramname">private_key</td><td>The private key used to sign the payload</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">signature</td><td>on success </td></tr>
    <tr><td class="paramname">NULL</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00892">892</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00516">ast_base64url_encode()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d2/d2c/pbx__realtime_8c_source.html#l00124">cleanup()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00166">ast_stir_shaken_payload::signature</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">ast_stir_shaken_sign()</a>.</p>
<div class="fragment"><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;{</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   EVP_MD_CTX *mdctx = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;   <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *encoded_signature = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *signature = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;   <span class="keywordtype">size_t</span> encoded_length = 0;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;   <span class="keywordtype">size_t</span> signature_length = 0;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   mdctx = EVP_MD_CTX_create();</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;   <span class="keywordflow">if</span> (!mdctx) {</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create Message Digest Context\n&quot;</span>);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;   }</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;   ret = EVP_DigestSignInit(mdctx, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, EVP_sha256(), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, private_key);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;   <span class="keywordflow">if</span> (ret != 1) {</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to initialize Message Digest Context\n&quot;</span>);</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;   ret = EVP_DigestSignUpdate(mdctx, json_str, strlen(json_str));</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;   <span class="keywordflow">if</span> (ret != 1) {</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to update Message Digest Context\n&quot;</span>);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;   }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   ret = EVP_DigestSignFinal(mdctx, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;signature_length);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   <span class="keywordflow">if</span> (ret != 1) {</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed initial phase of Message Digest Context signing\n&quot;</span>);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;   }</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;   signature = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) * signature_length);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;   <span class="keywordflow">if</span> (!signature) {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate space for signature\n&quot;</span>);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;   }</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;   ret = EVP_DigestSignFinal(mdctx, signature, &amp;signature_length);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;   <span class="keywordflow">if</span> (ret != 1) {</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed final phase of Message Digest Context signing\n&quot;</span>);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;   }</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;   <span class="comment">/* There are 6 bits to 1 base64 URL digit, so in order to get the size of the base64 encoded</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">    * signature, we need to multiply by the number of bits in a byte and divide by 6. Since</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment">    * there&#39;s rounding when doing base64 conversions, add 3 bytes, just in case, and account</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment">    * for padding. Add another byte for the NULL-terminator.</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;   encoded_length = ((signature_length * 4 / 3 + 3) &amp; ~3) + 1;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;   encoded_signature = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, encoded_length);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;   <span class="keywordflow">if</span> (!encoded_signature) {</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate space for encoded signature\n&quot;</span>);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   }</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a956327335a1d388ea458cb5401e6408f">ast_base64url_encode</a>((<span class="keywordtype">char</span> *)encoded_signature, signature, signature_length, encoded_length);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;   <span class="keywordflow">if</span> (mdctx) {</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      EVP_MD_CTX_destroy(mdctx);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;   }</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(signature);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;   <span class="keywordflow">return</span> encoded_signature;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="utils_8h_html_a956327335a1d388ea458cb5401e6408f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a956327335a1d388ea458cb5401e6408f">ast_base64url_encode</a></div><div class="ttdeci">int ast_base64url_encode(char *dst, const unsigned char *src, int srclen, int max)</div><div class="ttdoc">Encode data in base64 URL. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00516">main/utils.c:516</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="pbx__realtime_8c_html_a10b51e1931bd03dd172cbfb9d3d67efb"><div class="ttname"><a href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a></div><div class="ttdeci">static void * cleanup(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d2c/pbx__realtime_8c_source.html#l00124">pbx_realtime.c:124</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a75a59cd4e8a87ff1baa3c3a77f2019de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75a59cd4e8a87ff1baa3c3a77f2019de">&#9670;&nbsp;</a></span>stir_shaken_verification_result_to_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char* stir_shaken_verification_result_to_string </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0">ast_stir_shaken_verification_result</a>&#160;</td>
          <td class="paramname"><em>result</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Convert an ast_stir_shaken_verification_result to string representation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">result</td><td>The result to convert</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">empty</td><td>string if not a valid enum value </td></tr>
    <tr><td class="paramname">string</td><td>representation of result otherwise </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00216">216</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00028">AST_STIR_SHAKEN_VERIFY_MISMATCH</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00026">AST_STIR_SHAKEN_VERIFY_NOT_PRESENT</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00029">AST_STIR_SHAKEN_VERIFY_PASSED</a>, and <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00027">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01145">stir_shaken_read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;{</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   <span class="keywordflow">switch</span> (<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>) {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a57139df4ed6e2de5edee1a9a333dde20">AST_STIR_SHAKEN_VERIFY_NOT_PRESENT</a>:</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;         <span class="keywordflow">return</span> <span class="stringliteral">&quot;Verification not present&quot;</span>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a>:</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;         <span class="keywordflow">return</span> <span class="stringliteral">&quot;Signature failed&quot;</span>;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a036497dd5292f9bfa00805027be73c7e">AST_STIR_SHAKEN_VERIFY_MISMATCH</a>:</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;         <span class="keywordflow">return</span> <span class="stringliteral">&quot;Verification mismatch&quot;</span>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0ae9480fab55d60d33b1944fcc4f174798">AST_STIR_SHAKEN_VERIFY_PASSED</a>:</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;         <span class="keywordflow">return</span> <span class="stringliteral">&quot;Verification passed&quot;</span>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div><div class="ttc" id="res__stir__shaken_8h_html_a230ddbb49b17c100af2d1d5fc397f9d0ae9480fab55d60d33b1944fcc4f174798"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0ae9480fab55d60d33b1944fcc4f174798">AST_STIR_SHAKEN_VERIFY_PASSED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00029">res_stir_shaken.h:29</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a230ddbb49b17c100af2d1d5fc397f9d0a57139df4ed6e2de5edee1a9a333dde20"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a57139df4ed6e2de5edee1a9a333dde20">AST_STIR_SHAKEN_VERIFY_NOT_PRESENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00026">res_stir_shaken.h:26</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00027">res_stir_shaken.h:27</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a230ddbb49b17c100af2d1d5fc397f9d0a036497dd5292f9bfa00805027be73c7e"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a036497dd5292f9bfa00805027be73c7e">AST_STIR_SHAKEN_VERIFY_MISMATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00028">res_stir_shaken.h:28</a></div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7042df2b7a959c49909b729adc9549ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7042df2b7a959c49909b729adc9549ee">&#9670;&nbsp;</a></span>stir_shaken_verify_json()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a>* stir_shaken_verify_json </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *&#160;</td>
          <td class="paramname"><em>json</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Verifies the necessary contents are in the JSON and returns a <a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> with the extracted values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>The JSON to verify</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> on success </dd>
<dd>
NULL on failure </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00788">788</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00168">ast_stir_shaken_payload::algorithm</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00620">ast_json_deep_copy()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00273">ast_json_string_get()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">ast_stir_shaken_payload_free()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00243">ast_strdup</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d2/d2c/pbx__realtime_8c_source.html#l00124">cleanup()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00162">ast_stir_shaken_payload::header</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">ast_stir_shaken_payload::payload</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00021">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00022">STIR_SHAKEN_PPT</a>, and <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00023">STIR_SHAKEN_TYPE</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">ast_stir_shaken_sign()</a>.</p>
<div class="fragment"><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;{</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *obj;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d85/structval.html">val</a>;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;   payload = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*payload));</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;   <span class="keywordflow">if</span> (!payload) {</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate STIR/SHAKEN payload\n&quot;</span>);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;   }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;   <span class="comment">/* Look through the header first */</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;   obj = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;header&quot;</span>);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;   <span class="keywordflow">if</span> (!obj) {</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR/SHAKEN JWT did not have the required field &#39;header&#39;\n&quot;</span>);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;   }</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">header</a> = <a class="code" href="../../d4/d05/json_8h.html#aa9aeb4c777be80e17b480fe0ca79bbd7">ast_json_deep_copy</a>(obj);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;   <span class="keywordflow">if</span> (!payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">header</a>) {</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR_SHAKEN payload failed to copy &#39;header&#39;\n&quot;</span>);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;   }</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;   <span class="comment">/* Check the ppt value for &quot;shaken&quot; */</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;   val = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(obj, <span class="stringliteral">&quot;ppt&quot;</span>));</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(val)) {</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR/SHAKEN JWT did not have the required field &#39;ppt&#39;\n&quot;</span>);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;   }</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;   <span class="keywordflow">if</span> (strcmp(val, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>)) {</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR/SHAKEN JWT field &#39;ppt&#39; did not have &quot;</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;         <span class="stringliteral">&quot;required value &#39;%s&#39; (was &#39;%s&#39;)\n&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>, val);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;   }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;   <span class="comment">/* Check the typ value for &quot;passport&quot; */</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;   val = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(obj, <span class="stringliteral">&quot;typ&quot;</span>));</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(val)) {</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR/SHAKEN JWT did not have the required field &#39;typ&#39;\n&quot;</span>);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;   }</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;   <span class="keywordflow">if</span> (strcmp(val, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a>)) {</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR/SHAKEN JWT field &#39;typ&#39; did not have &quot;</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;         <span class="stringliteral">&quot;required value &#39;%s&#39; (was &#39;%s&#39;)\n&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a>, val);</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;   }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;   <span class="comment">/* Check the alg value for &quot;ES256&quot; */</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;   val = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(obj, <span class="stringliteral">&quot;alg&quot;</span>));</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(val)) {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR/SHAKEN JWT did not have required field &#39;alg&#39;\n&quot;</span>);</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;   }</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;   <span class="keywordflow">if</span> (strcmp(val, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>)) {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR/SHAKEN JWT field &#39;alg&#39; did not have &quot;</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;         <span class="stringliteral">&quot;required value &#39;%s&#39; (was &#39;%s&#39;)\n&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, val);</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;   }</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;   payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a76c514e8785ea8be81ca07a2a8438eea">algorithm</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(val);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;   <span class="keywordflow">if</span> (!payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a76c514e8785ea8be81ca07a2a8438eea">algorithm</a>) {</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR/SHAKEN payload failed to copy &#39;algorithm&#39;\n&quot;</span>);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;   }</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;   <span class="comment">/* Now let&#39;s check the payload section */</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;   obj = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;payload&quot;</span>);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;   <span class="keywordflow">if</span> (!obj) {</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR/SHAKEN payload JWT did not have required field &#39;payload&#39;\n&quot;</span>);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;   }</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;   <span class="comment">/* Check the orig tn value for not NULL */</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;   val = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(obj, <span class="stringliteral">&quot;orig&quot;</span>), <span class="stringliteral">&quot;tn&quot;</span>));</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(val)) {</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR/SHAKEN JWT did not have required field &#39;orig-&gt;tn&#39;\n&quot;</span>);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;   }</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;   <span class="comment">/* Payload seems sane. Copy it and return on success */</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;   payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d4/d05/json_8h.html#aa9aeb4c777be80e17b480fe0ca79bbd7">ast_json_deep_copy</a>(obj);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;   <span class="keywordflow">if</span> (!payload-&gt;<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>) {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;STIR/SHAKEN payload failed to copy &#39;payload&#39;\n&quot;</span>);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;   }</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;   <span class="keywordflow">return</span> payload;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a>(payload);</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;}</div><div class="ttc" id="structast__stir__shaken__payload_html_aa274fdb7598d57c9bc077c5ce68904fc"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#aa274fdb7598d57c9bc077c5ce68904fc">ast_stir_shaken_payload::header</a></div><div class="ttdeci">struct ast_json * header</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00162">res_stir_shaken.c:162</a></div></div>
<div class="ttc" id="structval_html"><div class="ttname"><a href="../../d5/d85/structval.html">val</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dd1/ast__expr2_8c_source.html#l00325">ast_expr2.c:325</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a2cc390b9c52dc61196df9bb674f13b23"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a></div><div class="ttdeci">void ast_stir_shaken_payload_free(struct ast_stir_shaken_payload *payload)</div><div class="ttdoc">Free a STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">res_stir_shaken.c:178</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="json_8h_html_a6772fcee88746a9d4f6ec6f240b76dd0"><div class="ttname"><a href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a></div><div class="ttdeci">const char * ast_json_string_get(const struct ast_json *string)</div><div class="ttdoc">Get the value of a JSON string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00273">json.c:273</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a7fa9ce960630ba4818351dce356650ba"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a></div><div class="ttdeci">#define STIR_SHAKEN_ENCRYPTION_ALGORITHM</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00021">res_stir_shaken.h:21</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a76c514e8785ea8be81ca07a2a8438eea"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a76c514e8785ea8be81ca07a2a8438eea">ast_stir_shaken_payload::algorithm</a></div><div class="ttdeci">char * algorithm</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00168">res_stir_shaken.c:168</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00160">res_stir_shaken.c:160</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a8ac6f48a993e1cfdb7780fa13b8bff06"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a></div><div class="ttdeci">#define STIR_SHAKEN_PPT</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00022">res_stir_shaken.h:22</a></div></div>
<div class="ttc" id="pbx__realtime_8c_html_a10b51e1931bd03dd172cbfb9d3d67efb"><div class="ttname"><a href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a></div><div class="ttdeci">static void * cleanup(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d2c/pbx__realtime_8c_source.html#l00124">pbx_realtime.c:124</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a848d5ae12b5a75efa9c4cf6bf1935639"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">ast_stir_shaken_payload::payload</a></div><div class="ttdeci">struct ast_json * payload</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">res_stir_shaken.c:164</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="res__stir__shaken_8h_html_ab8935c3fd655edd2dbc47887d4dd9bec"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#ab8935c3fd655edd2dbc47887d4dd9bec">STIR_SHAKEN_TYPE</a></div><div class="ttdeci">#define STIR_SHAKEN_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00023">res_stir_shaken.h:23</a></div></div>
<div class="ttc" id="json_8h_html_aa9aeb4c777be80e17b480fe0ca79bbd7"><div class="ttname"><a href="../../d4/d05/json_8h.html#aa9aeb4c777be80e17b480fe0ca79bbd7">ast_json_deep_copy</a></div><div class="ttdeci">struct ast_json * ast_json_deep_copy(const struct ast_json *value)</div><div class="ttdoc">Copy a JSON value, and its children. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00620">json.c:620</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a641d040fed7728c820d3001058b24141"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a641d040fed7728c820d3001058b24141">&#9670;&nbsp;</a></span>stir_shaken_verify_signature()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int stir_shaken_verify_signature </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>signature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">EVP_PKEY *&#160;</td>
          <td class="paramname"><em>public_key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Verifies the signature using a public key. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The payload </td></tr>
    <tr><td class="paramname">signature</td><td>The signature to verify </td></tr>
    <tr><td class="paramname">public_key</td><td>The public key used for verification</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>on failure </td></tr>
    <tr><td class="paramname">0</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00498">498</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00427">ast_base64url_decode()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">ast_stir_shaken_verify()</a>.</p>
<div class="fragment"><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;{</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;   EVP_MD_CTX *mdctx = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;   <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *decoded_signature;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   <span class="keywordtype">size_t</span> signature_length, decoded_signature_length;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;   mdctx = EVP_MD_CTX_create();</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;   <span class="keywordflow">if</span> (!mdctx) {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create Message Digest Context\n&quot;</span>);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;   }</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;   ret = EVP_DigestVerifyInit(mdctx, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, EVP_sha256(), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, public_key);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;   <span class="keywordflow">if</span> (ret != 1) {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to initialize Message Digest Context\n&quot;</span>);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      EVP_MD_CTX_destroy(mdctx);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;   }</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;   ret = EVP_DigestVerifyUpdate(mdctx, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)msg, strlen(msg));</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   <span class="keywordflow">if</span> (ret != 1) {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to update Message Digest Context\n&quot;</span>);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      EVP_MD_CTX_destroy(mdctx);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;   }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;   <span class="comment">/* We need to decode the signature from base64 URL to bytes. Make sure we have</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">    * at least enough characters for this check */</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;   signature_length = strlen(signature);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   decoded_signature_length = (signature_length * 3 / 4);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;   decoded_signature = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, decoded_signature_length);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a8b078a418a08b4d4600bb7fc33d6376b">ast_base64url_decode</a>(decoded_signature, signature, decoded_signature_length);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;   ret = EVP_DigestVerifyFinal(mdctx, decoded_signature, decoded_signature_length);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   <span class="keywordflow">if</span> (ret != 1) {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed final phase of signature verification\n&quot;</span>);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      EVP_MD_CTX_destroy(mdctx);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(decoded_signature);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;   EVP_MD_CTX_destroy(mdctx);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(decoded_signature);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="utils_8h_html_a8b078a418a08b4d4600bb7fc33d6376b"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a8b078a418a08b4d4600bb7fc33d6376b">ast_base64url_decode</a></div><div class="ttdeci">int ast_base64url_decode(unsigned char *dst, const char *src, int max)</div><div class="ttdoc">Decode data from base64 URL. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00427">main/utils.c:427</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a327923c76fa01ad91745180a565f69c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a327923c76fa01ad91745180a565f69c1">&#9670;&nbsp;</a></span>test_stir_shaken_add_fake_astdb_entry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void test_stir_shaken_add_fake_astdb_entry </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>public_cert_url</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file_path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01260">1260</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00456">add_public_key_to_astdb()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00327">ast_db_put()</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00264">ast_sha1_hash()</a>, and <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01491">AST_TEST_DEFINE()</a>.</p>
<div class="fragment"><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;{</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;   <span class="keyword">struct </span>timeval expires = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;   <span class="keywordtype">char</span> time_buf[32];</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;   <span class="keywordtype">char</span> hash[41];</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a>(hash, public_cert_url);</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#adad26c14e31ef6ef601de9710345b1bf">add_public_key_to_astdb</a>(public_cert_url, file_path);</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;   snprintf(time_buf, <span class="keyword">sizeof</span>(time_buf), <span class="stringliteral">&quot;%30lu&quot;</span>, expires.tv_sec + 300);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;   <a class="code" href="../../de/d4a/astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a>(hash, <span class="stringliteral">&quot;expiration&quot;</span>, time_buf);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;}</div><div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_adad26c14e31ef6ef601de9710345b1bf"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#adad26c14e31ef6ef601de9710345b1bf">add_public_key_to_astdb</a></div><div class="ttdeci">static void add_public_key_to_astdb(const char *public_cert_url, const char *filepath)</div><div class="ttdoc">Add the public key details and file path to AstDB. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00456">res_stir_shaken.c:456</a></div></div>
<div class="ttc" id="utils_8h_html_af35c6f780502c691f0ae35e1d0f7a444"><div class="ttname"><a href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a></div><div class="ttdeci">void ast_sha1_hash(char *output, const char *input)</div><div class="ttdoc">Produces SHA1 hash based on input string. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00264">main/utils.c:264</a></div></div>
<div class="ttc" id="astdb_8h_html_a0f14f6bff4f412c88b50aba34d3a5e35"><div class="ttname"><a href="../../de/d4a/astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a></div><div class="ttdeci">int ast_db_put(const char *family, const char *key, const char *value)</div><div class="ttdoc">Store value addressed by family/key. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00327">main/db.c:327</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af7fdb8ec81c043a597636b69c12f96bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7fdb8ec81c043a597636b69c12f96bf">&#9670;&nbsp;</a></span>test_stir_shaken_write_temp_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int test_stir_shaken_write_temp_key </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>file_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>private</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create a private or public key certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_path</td><td>The path of the file to create </td></tr>
    <tr><td class="paramname">private</td><td>Set to 0 if public, 1 if private</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>on failure </td></tr>
    <tr><td class="paramname">0</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01282">1282</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d7/d28/make__ari__stubs_8py_source.html#l00025">make_ari_stubs::file</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, and <a class="el" href="../../d7/d49/chan__ooh323_8c_source.html#l00109">type</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01333">AST_TEST_DEFINE()</a>.</p>
<div class="fragment"><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;{</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;   FILE *<a class="code" href="../../d2/dc8/namespacemake__ari__stubs.html#a40a5d58ffa6e88aa578d6683ac413105">file</a>;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;   <span class="keywordtype">int</span> fd;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;   <span class="keywordtype">char</span> *data;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a> = <span class="keyword">private</span> ? <span class="stringliteral">&quot;private&quot;</span> : <span class="stringliteral">&quot;public&quot;</span>;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;   <span class="keywordtype">char</span> *private_data =</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <span class="stringliteral">&quot;-----BEGIN EC PRIVATE KEY-----\n&quot;</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      <span class="stringliteral">&quot;MHcCAQEEIC+xv2GKNTDd81vJM8rwGAGNqgklKKxz9Qejn+pcRPC1oAoGCCqGSM49\n&quot;</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      <span class="stringliteral">&quot;AwEHoUQDQgAEq12QXu8lH295ZMZ4udKy5VV8wVgE4qSOnkdofn3hEDsh6QTKTZg9\n&quot;</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      <span class="stringliteral">&quot;W6PncYAVnmOFRL4cTGRbmAIShN4naZk2Yg==\n&quot;</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      <span class="stringliteral">&quot;-----END EC PRIVATE KEY-----&quot;</span>;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;   <span class="keywordtype">char</span> *public_data =</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      <span class="stringliteral">&quot;-----BEGIN CERTIFICATE-----\n&quot;</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      <span class="stringliteral">&quot;MIIBzDCCAXGgAwIBAgIUXDt6EC0OixT1iRSSPV3jB/zQAlQwCgYIKoZIzj0EAwIw\n&quot;</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      <span class="stringliteral">&quot;RTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGElu\n&quot;</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      <span class="stringliteral">&quot;dGVybmV0IFdpZGdpdHMgUHR5IEx0ZDAeFw0yMTA0MTMwNjM3MjRaFw0yMzA3MTcw\n&quot;</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      <span class="stringliteral">&quot;NjM3MjRaMGoxCzAJBgNVBAYTAlVTMQswCQYDVQQIDAJWQTESMBAGA1UEBwwJU29t\n&quot;</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      <span class="stringliteral">&quot;ZXdoZXJlMRowGAYDVQQKDBFBY21lVGVsZWNvbSwgSW5jLjENMAsGA1UECwwEVk9J\n&quot;</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      <span class="stringliteral">&quot;UDEPMA0GA1UEAwwGU0hBS0VOMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEq12Q\n&quot;</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      <span class="stringliteral">&quot;Xu8lH295ZMZ4udKy5VV8wVgE4qSOnkdofn3hEDsh6QTKTZg9W6PncYAVnmOFRL4c\n&quot;</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      <span class="stringliteral">&quot;TGRbmAIShN4naZk2YqMaMBgwFgYIKwYBBQUHARoECjAIoAYWBDEwMDEwCgYIKoZI\n&quot;</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;      <span class="stringliteral">&quot;zj0EAwIDSQAwRgIhAMa9Ky38DgVaIgVm9Mgws/qN3zxjMQXfxEExAbDwyq/WAiEA\n&quot;</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      <span class="stringliteral">&quot;zbC29mvtSulwbvQJ4fBdFU84cFC3Ctu1QrCeFOiZHc4=\n&quot;</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      <span class="stringliteral">&quot;-----END CERTIFICATE-----&quot;</span>;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;   fd = mkstemp(file_path);</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;   <span class="keywordflow">if</span> (fd &lt; 0) {</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create temp %s file: %s\n&quot;</span>, type, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;   }</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;   file = fdopen(fd, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;   <span class="keywordflow">if</span> (!file) {</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create temp %s key file: %s\n&quot;</span>, type, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;      close(fd);</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;   }</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;   data = <span class="keyword">private</span> ? private_data : public_data;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;   <span class="keywordflow">if</span> (fputs(data, file) == EOF) {</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to write temp %s key file\n&quot;</span>, type);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;      fclose(file);</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;   }</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;   fclose(file);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;}</div><div class="ttc" id="chan__ooh323_8c_html_a4d63fdfe5451ec2248c16a2739190c56"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a></div><div class="ttdeci">static const char type[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00109">chan_ooh323.c:109</a></div></div>
<div class="ttc" id="namespacemake__ari__stubs_html_a40a5d58ffa6e88aa578d6683ac413105"><div class="ttname"><a href="../../d2/dc8/namespacemake__ari__stubs.html#a40a5d58ffa6e88aa578d6683ac413105">make_ari_stubs.file</a></div><div class="ttdeci">file</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/make__ari__stubs_8py_source.html#l00025">make_ari_stubs.py:25</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad09fa931f468002152a3cc2d5ce25eae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09fa931f468002152a3cc2d5ce25eae">&#9670;&nbsp;</a></span>unload_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01617">1617</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../db/d70/pbx__functions_8c_source.html#l00273">ast_custom_function_unregister()</a>, <a class="el" href="../../d8/d25/sorcery_8h_source.html#l01502">ast_sorcery_unref</a>, <a class="el" href="../../d2/ddc/test_8h_source.html#l00128">AST_TEST_UNREGISTER</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d7/d5c/certificate_8c_source.html#l00347">stir_shaken_certificate_unload()</a>, <a class="el" href="../../d1/dca/general_8c_source.html#l00232">stir_shaken_general_unload()</a>, and <a class="el" href="../../d9/d7e/store_8c_source.html#l00172">stir_shaken_store_unload()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01636">load_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;{</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;   <a class="code" href="../../d7/d5c/certificate_8c.html#a2130c8ad2b3cd26e4c85ed9f12de6a81">stir_shaken_certificate_unload</a>();</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;   <a class="code" href="../../d9/d7e/store_8c.html#a9be7096f395e9c58d1fa9fce5e2aa5b0">stir_shaken_store_unload</a>();</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;   <a class="code" href="../../d1/dca/general_8c.html#a9c540c5c88fc96a4070f99453f9aa622">stir_shaken_general_unload</a>();</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a8dcf20b310c2b64debff736f19e4887b">stir_shaken_sorcery</a>);</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;   <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a8dcf20b310c2b64debff736f19e4887b">stir_shaken_sorcery</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;<a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a6d78be1d8e55602a7de3c689b9e5a091">stir_shaken_function</a>);</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(test_stir_shaken_sign);</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(test_stir_shaken_verify);</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;}</div><div class="ttc" id="general_8c_html_a9c540c5c88fc96a4070f99453f9aa622"><div class="ttname"><a href="../../d1/dca/general_8c.html#a9c540c5c88fc96a4070f99453f9aa622">stir_shaken_general_unload</a></div><div class="ttdeci">int stir_shaken_general_unload(void)</div><div class="ttdoc">Unload time cleanup for the stir/shaken &amp;#39;general&amp;#39; configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dca/general_8c_source.html#l00232">general.c:232</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a8dcf20b310c2b64debff736f19e4887b"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a8dcf20b310c2b64debff736f19e4887b">stir_shaken_sorcery</a></div><div class="ttdeci">static struct ast_sorcery * stir_shaken_sorcery</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00144">res_stir_shaken.c:144</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__stir__shaken_8c_html_a6d78be1d8e55602a7de3c689b9e5a091"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a6d78be1d8e55602a7de3c689b9e5a091">stir_shaken_function</a></div><div class="ttdeci">static struct ast_custom_function stir_shaken_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01253">res_stir_shaken.c:1253</a></div></div>
<div class="ttc" id="pbx_8h_html_a965977ea9a3144bc203e0ce7a64680a1"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a></div><div class="ttdeci">int ast_custom_function_unregister(struct ast_custom_function *acf)</div><div class="ttdoc">Unregister a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d70/pbx__functions_8c_source.html#l00273">pbx_functions.c:273</a></div></div>
<div class="ttc" id="sorcery_8h_html_a09cba9c37c702ca2bdcf94052068ed67"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a></div><div class="ttdeci">#define ast_sorcery_unref(sorcery)</div><div class="ttdoc">Decrease the reference count of a sorcery structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l01502">sorcery.h:1502</a></div></div>
<div class="ttc" id="certificate_8c_html_a2130c8ad2b3cd26e4c85ed9f12de6a81"><div class="ttname"><a href="../../d7/d5c/certificate_8c.html#a2130c8ad2b3cd26e4c85ed9f12de6a81">stir_shaken_certificate_unload</a></div><div class="ttdeci">int stir_shaken_certificate_unload(void)</div><div class="ttdoc">Unload time cleanup for the stir/shaken &amp;#39;certificate&amp;#39; configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5c/certificate_8c_source.html#l00347">certificate.c:347</a></div></div>
<div class="ttc" id="test_8h_html_a79bc64a935b14b1b181156e5ada58ead"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a></div><div class="ttdeci">#define AST_TEST_UNREGISTER(cb)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00128">test.h:128</a></div></div>
<div class="ttc" id="store_8c_html_a9be7096f395e9c58d1fa9fce5e2aa5b0"><div class="ttname"><a href="../../d9/d7e/store_8c.html#a9be7096f395e9c58d1fa9fce5e2aa5b0">stir_shaken_store_unload</a></div><div class="ttdeci">int stir_shaken_store_unload(void)</div><div class="ttdoc">Unload time cleanup for the stir/shaken &amp;#39;store&amp;#39; configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d7e/store_8c_source.html#l00172">store.c:172</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab22f32016155f7f403e7178767163d7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab22f32016155f7f403e7178767163d7d">&#9670;&nbsp;</a></span>__mod_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> __mod_info = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;STIR/SHAKEN Module for Asterisk&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a6e79b87e069c15a5fb21826e5eed0971">AST_BUILDOPT_SUM</a>, .support_level = <a class="el" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>, .load = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>, .unload = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>, .<a class="el" href="../../dc/d6b/res__xmpp_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> = <a class="el" href="../../d6/d80/test__res__prometheus_8c.html#a7c6ac25ea7536c0bc9ed18cbcf917527">reload_module</a>, .load_pri = <a class="el" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a> - 1, .requires = &quot;res_curl&quot;, }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01677">1677</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

</div>
</div>
<a id="ad60e83b9aa660040fed4d5377966cc21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad60e83b9aa660040fed4d5377966cc21">&#9670;&nbsp;</a></span>ast_module_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>* <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01677">1677</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

</div>
</div>
<a id="a3e7896640205a0d33331358444f14e8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e7896640205a0d33331358444f14e8d">&#9670;&nbsp;</a></span>stir_shaken_datastore_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a> stir_shaken_datastore_info</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .type = <span class="stringliteral">&quot;STIR/SHAKEN VERIFICATION&quot;</span>,</div><div class="line">   .destroy = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#a18800da0faca5e17bede21443b9b7b45">stir_shaken_datastore_destroy_cb</a>,</div><div class="line">}</div><div class="ttc" id="res__stir__shaken_8c_html_a18800da0faca5e17bede21443b9b7b45"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#a18800da0faca5e17bede21443b9b7b45">stir_shaken_datastore_destroy_cb</a></div><div class="ttdeci">static void stir_shaken_datastore_destroy_cb(void *data)</div><div class="ttdoc">The callback to destroy a stir_shaken_datastore. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00265">res_stir_shaken.c:265</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00272">272</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

</div>
</div>
<a id="a6d78be1d8e55602a7de3c689b9e5a091"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d78be1d8e55602a7de3c689b9e5a091">&#9670;&nbsp;</a></span>stir_shaken_function</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> stir_shaken_function</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .name = <span class="stringliteral">&quot;STIR_SHAKEN&quot;</span>,</div><div class="line">   .read = <a class="code" href="../../d9/d2d/res__stir__shaken_8c.html#ad1727642614616f01e0bba04ba0f549c">stir_shaken_read</a>,</div><div class="line">}</div><div class="ttc" id="res__stir__shaken_8c_html_ad1727642614616f01e0bba04ba0f549c"><div class="ttname"><a href="../../d9/d2d/res__stir__shaken_8c.html#ad1727642614616f01e0bba04ba0f549c">stir_shaken_read</a></div><div class="ttdeci">static int stir_shaken_read(struct ast_channel *chan, const char *function, char *data, char *buf, size_t len)</div><div class="ttdoc">Retrieves STIR/SHAKEN verification information for the channel via dialplan. Examples: ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01145">res_stir_shaken.c:1145</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01253">1253</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

</div>
</div>
<a id="a8dcf20b310c2b64debff736f19e4887b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8dcf20b310c2b64debff736f19e4887b">&#9670;&nbsp;</a></span>stir_shaken_sorcery</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a>* stir_shaken_sorcery</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00144">144</a> of file <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html">res_stir_shaken.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00173">ast_stir_shaken_sorcery()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:40 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
