<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: pbx.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">pbx.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../db/d94/pbx_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 1999 - 2008, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Mark Spencer &lt;markster@digium.com&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*! \file</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * \brief Core PBX routines.</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * \author Mark Spencer &lt;markster@digium.com&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">   &lt;support_level&gt;core&lt;/support_level&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d78/__private_8h.html">asterisk/_private.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/df2/paths_8h.html">asterisk/paths.h</a>&quot;</span>   <span class="comment">/* use ast_config_AST_SYSTEM_NAME */</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../de/df7/time_8h.html">time.h</a>&gt;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &lt;sys/time.h&gt;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#if defined(HAVE_SYSINFO)</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &lt;sys/sysinfo.h&gt;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#if defined(SOLARIS)</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;sys/loadavg.h&gt;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d42/lock_8h.html">asterisk/lock.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db0/cli_8h.html">asterisk/cli.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/de0/pbx_8h.html">asterisk/pbx.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d7b/channel_8h.html">asterisk/channel.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4d/file_8h.html">asterisk/file.h</a>&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d47/callerid_8h.html">asterisk/callerid.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d07/cdr_8h.html">asterisk/cdr.h</a>&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html">asterisk/config.h</a>&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/term_8h.html">asterisk/term.h</a>&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/df7/time_8h.html">asterisk/time.h</a>&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/manager_8h.html">asterisk/manager.h</a>&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d93/ast__expr_8h.html">asterisk/ast_expr.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d90/linkedlists_8h.html">asterisk/linkedlists.h</a>&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a94e18d208abcc315ebc628f19fc5e30c">   57</a></span>&#160;<span class="preprocessor">#define  SAY_STUBS   </span><span class="comment">/* generate declarations and stubs for say methods */</span><span class="preprocessor"></span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/dce/say_8h.html">asterisk/say.h</a>&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d60/utils_8h.html">asterisk/utils.h</a>&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/da3/causes_8h.html">asterisk/causes.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d07/musiconhold_8h.html">asterisk/musiconhold.h</a>&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html">asterisk/app.h</a>&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/da2/devicestate_8h.html">asterisk/devicestate.h</a>&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/dd7/presencestate_8h.html">asterisk/presencestate.h</a>&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/da0/hashtab_8h.html">asterisk/hashtab.h</a>&quot;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/module_8h.html">asterisk/module.h</a>&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d0f/indications_8h.html">asterisk/indications.h</a>&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d1e/taskprocessor_8h.html">asterisk/taskprocessor.h</a>&quot;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d99/xmldoc_8h.html">asterisk/xmldoc.h</a>&quot;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/da5/astobj2_8h.html">asterisk/astobj2.h</a>&quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d4a/stasis__channels_8h.html">asterisk/stasis_channels.h</a>&quot;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/dcf/dial_8h.html">asterisk/dial.h</a>&quot;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d68/vector_8h.html">asterisk/vector.h</a>&quot;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/da0/pbx__private_8h.html">pbx_private.h</a>&quot;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"> * \note I M P O R T A N T :</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"> *    The speed of extension handling will likely be among the most important</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"> * aspects of this PBX.  The switching scheme as it exists right now isn&#39;t</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> * terribly bad (it&#39;s O(N+M), where N is the # of extensions and M is the avg #</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"> * of priorities, but a constant search time here would be great ;-)</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> * A new algorithm to do searching based on a &#39;compiled&#39; pattern tree is introduced</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> * here, and shows a fairly flat (constant) search time, even for over</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"> * 10000 patterns.</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> * Also, using a hash table for context/priority name lookup can help prevent</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> * the find_extension routines from absorbing exponential cpu cycles as the number</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"> * of contexts/priorities grow. I&#39;ve previously tested find_extension with red-black trees,</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"> * which have O(log2(n)) speed. Right now, I&#39;m using hash tables, which do</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"> * searches (ideally) in O(1) time. While these techniques do not yield much</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"> * speed in small dialplans, they are worth the trouble in large dialplans.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">/*** DOCUMENTATION</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">   &lt;function name=&quot;EXCEPTION&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">         Retrieve the details of the current dialplan exception.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">         &lt;parameter name=&quot;field&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">            &lt;para&gt;The following fields are available for retrieval:&lt;/para&gt;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">            &lt;enumlist&gt;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">               &lt;enum name=&quot;reason&quot;&gt;</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">                  &lt;para&gt;INVALID, ERROR, RESPONSETIMEOUT, ABSOLUTETIMEOUT, or custom</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">                  value set by the RaiseException() application&lt;/para&gt;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">               &lt;enum name=&quot;context&quot;&gt;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">                  &lt;para&gt;The context executing when the exception occurred.&lt;/para&gt;</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">               &lt;enum name=&quot;exten&quot;&gt;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">                  &lt;para&gt;The extension executing when the exception occurred.&lt;/para&gt;</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">               &lt;enum name=&quot;priority&quot;&gt;</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">                  &lt;para&gt;The numeric priority executing when the exception occurred.&lt;/para&gt;</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">            &lt;/enumlist&gt;</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">         &lt;para&gt;Retrieve the details (specified &lt;replaceable&gt;field&lt;/replaceable&gt;) of the current dialplan exception.&lt;/para&gt;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">      &lt;see-also&gt;</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">         &lt;ref type=&quot;application&quot;&gt;RaiseException&lt;/ref&gt;</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">      &lt;/see-also&gt;</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">   &lt;/function&gt;</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">   &lt;function name=&quot;TESTTIME&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">         Sets a time to be used with the channel to test logical conditions.</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">         &lt;parameter name=&quot;date&quot; required=&quot;true&quot; argsep=&quot; &quot;&gt;</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">            &lt;para&gt;Date in ISO 8601 format&lt;/para&gt;</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">         &lt;parameter name=&quot;time&quot; required=&quot;true&quot; argsep=&quot; &quot;&gt;</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">            &lt;para&gt;Time in HH:MM:SS format (24-hour time)&lt;/para&gt;</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">         &lt;parameter name=&quot;zone&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">            &lt;para&gt;Timezone name&lt;/para&gt;</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">         &lt;para&gt;To test dialplan timing conditions at times other than the current time, use</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">         this function to set an alternate date and time.  For example, you may wish to evaluate</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">         whether a location will correctly identify to callers that the area is closed on Christmas</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">         Day, when Christmas would otherwise fall on a day when the office is normally open.&lt;/para&gt;</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">      &lt;see-also&gt;</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">         &lt;ref type=&quot;application&quot;&gt;GotoIfTime&lt;/ref&gt;</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">      &lt;/see-also&gt;</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">   &lt;/function&gt;</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">   &lt;manager name=&quot;ShowDialPlan&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">         Show dialplan contexts and extensions</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">         &lt;parameter name=&quot;Extension&quot;&gt;</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">            &lt;para&gt;Show a specific extension.&lt;/para&gt;</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">         &lt;parameter name=&quot;Context&quot;&gt;</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">            &lt;para&gt;Show a specific context.&lt;/para&gt;</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">         &lt;para&gt;Show dialplan contexts and extensions. Be aware that showing the full dialplan</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">         may take a lot of capacity.&lt;/para&gt;</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">   &lt;manager name=&quot;ExtensionStateList&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">         List the current known extension states.</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">         &lt;para&gt;This will list out all known extension states in a</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">         sequence of &lt;replaceable&gt;ExtensionStatus&lt;/replaceable&gt; events.</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">         When finished, a &lt;replaceable&gt;ExtensionStateListComplete&lt;/replaceable&gt; event</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">         will be emitted.&lt;/para&gt;</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">      &lt;see-also&gt;</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">         &lt;ref type=&quot;manager&quot;&gt;ExtensionState&lt;/ref&gt;</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">         &lt;ref type=&quot;function&quot;&gt;HINT&lt;/ref&gt;</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">         &lt;ref type=&quot;function&quot;&gt;EXTENSION_STATE&lt;/ref&gt;</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">      &lt;/see-also&gt;</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">      &lt;responses&gt;</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">         &lt;list-elements&gt;</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">            &lt;xi:include xpointer=&quot;xpointer(/docs/managerEvent[@name=&#39;ExtensionStatus&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">         &lt;/list-elements&gt;</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">         &lt;managerEvent name=&quot;ExtensionStateListComplete&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">            &lt;managerEventInstance class=&quot;EVENT_FLAG_COMMAND&quot;&gt;</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">               &lt;synopsis&gt;</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">                  Indicates the end of the list the current known extension states.</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">               &lt;/synopsis&gt;</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">               &lt;syntax&gt;</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">                  &lt;parameter name=&quot;EventList&quot;&gt;</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">                     &lt;para&gt;Conveys the status of the event list.&lt;/para&gt;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">                  &lt;/parameter&gt;</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">                  &lt;parameter name=&quot;ListItems&quot;&gt;</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">                     &lt;para&gt;Conveys the number of statuses reported.&lt;/para&gt;</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">                  &lt;/parameter&gt;</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">               &lt;/syntax&gt;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">            &lt;/managerEventInstance&gt;</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">         &lt;/managerEvent&gt;</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">      &lt;/responses&gt;</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="preprocessor">#ifdef LOW_MEMORY</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="preprocessor">#define EXT_DATA_SIZE 256</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ab07357218392804a25091a0a5d03d260">  216</a></span>&#160;<span class="preprocessor">#define EXT_DATA_SIZE 8192</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#afc730834643b17952148c5bb2f994165">  219</a></span>&#160;<span class="preprocessor">#define SWITCH_DATA_LENGTH 256</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a4f144864da23f83e16ce1d29946b5164">  221</a></span>&#160;<span class="preprocessor">#define  VAR_NORMAL     1</span></div><div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a0afa9d9f36f92f8e1dc608c717f2064b">  222</a></span>&#160;<span class="preprocessor">#define  VAR_SOFTTRAN   2</span></div><div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ab53568989f7bec56ada5db0d3c25f87b">  223</a></span>&#160;<span class="preprocessor">#define  VAR_HARDTRAN   3</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a>;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="keyword">struct </span><a class="code" href="../../d0/da3/structast__app.html">ast_app</a>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a34c5d02998c18d892113d659590cd28e">  228</a></span>&#160;<a class="code" href="../../dc/d7d/threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6">AST_THREADSTORAGE</a>(<a class="code" href="../../db/d94/pbx_8c.html#a34c5d02998c18d892113d659590cd28e">switch_data</a>);</div><div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ac5308f5883751f800daddb3dfbdd7480">  229</a></span>&#160;<a class="code" href="../../dc/d7d/threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6">AST_THREADSTORAGE</a>(<a class="code" href="../../db/d94/pbx_8c.html#ac5308f5883751f800daddb3dfbdd7480">extensionstate_buf</a>);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">   \brief ast_exten: An extension</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">   The dialplan is saved as a linked list with each context</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">   having it&#39;s own linked list of extensions - one item per</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">   priority.</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00237"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html">  237</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> {</div><div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">  238</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>;         <span class="comment">/*!&lt; Clean Extension id */</span></div><div class="line"><a name="l00239"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">  239</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>;       <span class="comment">/*!&lt; Extension name (may include &#39;-&#39; eye candy) */</span></div><div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">  240</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a>;        <span class="comment">/*!&lt; Match caller id ? */</span></div><div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">  241</a></span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>;      <span class="comment">/*!&lt; Caller id to match for this extension */</span></div><div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a0574199c7fbb661fd7684472741955bb">  242</a></span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0574199c7fbb661fd7684472741955bb">cidmatch_display</a>; <span class="comment">/*!&lt; Caller id to match (display version) */</span></div><div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">  243</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;        <span class="comment">/*!&lt; Priority */</span></div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">  244</a></span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>;      <span class="comment">/*!&lt; Label */</span></div><div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">  245</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">parent</a>;   <span class="comment">/*!&lt; The context this extension belongs to  */</span></div><div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">  246</a></span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>;     <span class="comment">/*!&lt; Application to execute */</span></div><div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a3f6c079e49232c7de21109f9e7f0771c">  247</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/da3/structast__app.html">ast_app</a> *<a class="code" href="../../d7/d00/structast__exten.html#a3f6c079e49232c7de21109f9e7f0771c">cached_app</a>;     <span class="comment">/*!&lt; Cached location of application */</span></div><div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">  248</a></span>&#160;   <span class="keywordtype">void</span> *<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>;       <span class="comment">/*!&lt; Data to use (arguments) */</span></div><div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">  249</a></span>&#160;   void (*<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>)(<span class="keywordtype">void</span> *);     <span class="comment">/*!&lt; Data destructor */</span></div><div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">  250</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>;    <span class="comment">/*!&lt; Next higher priority with our extension */</span></div><div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">  251</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>;    <span class="comment">/*!&lt; Priorities list in hashtab form -- only on the head of the peer list */</span></div><div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">  252</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>; <span class="comment">/*!&lt; labeled priorities in the peers -- only on the head of the peer list */</span></div><div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">  253</a></span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>;     <span class="comment">/*!&lt; Registrar */</span></div><div class="line"><a name="l00254"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a3e3ed71b5dcbadee8292f3d1837eaa38">  254</a></span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a3e3ed71b5dcbadee8292f3d1837eaa38">registrar_file</a>;     <span class="comment">/*!&lt; File name used to register extension */</span></div><div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a90ec1116822211c96e24055d95972cca">  255</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#a90ec1116822211c96e24055d95972cca">registrar_line</a>;             <span class="comment">/*!&lt; Line number the extension was registered in text */</span></div><div class="line"><a name="l00256"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">  256</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;    <span class="comment">/*!&lt; Extension with a greater ID */</span></div><div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="../../d7/d00/structast__exten.html#a3976e924940f324effe69a4e4993e9c9">  257</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d7/d00/structast__exten.html#a3976e924940f324effe69a4e4993e9c9">stuff</a>[0];</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;};</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">/*! \brief match_char: forms a syntax tree for quick matching of extension patterns */</span></div><div class="line"><a name="l00261"></a><span class="lineno"><a class="line" href="../../da/d14/structmatch__char.html">  261</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;{</div><div class="line"><a name="l00263"></a><span class="lineno"><a class="line" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">  263</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a>; <span class="comment">/* the pattern started with &#39;_&#39; */</span></div><div class="line"><a name="l00264"></a><span class="lineno"><a class="line" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">  264</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a>;    <span class="comment">/* if this is set, then... don&#39;t return it */</span></div><div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">  265</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a>; <span class="comment">/* simply the strlen of x, or 10 for X, 9 for Z, and 8 for N; and &#39;.&#39; and &#39;!&#39; will add 11 ? */</span></div><div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">  266</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>;</div><div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">  267</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>;</div><div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">  268</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>; <span class="comment">/* attached to last char of a pattern for exten */</span></div><div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">  269</a></span>&#160;   <span class="keywordtype">char</span> x[1];       <span class="comment">/* the pattern itself-- matches a single char */</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;};</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno"><a class="line" href="../../db/d2d/structscoreboard.html">  272</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../db/d2d/structscoreboard.html">scoreboard</a>  <span class="comment">/* make sure all fields are 0 before calling new_find_extension */</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;{</div><div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="../../db/d2d/structscoreboard.html#a4de425bb2743e2e19c2e954dfe1f0bf8">  274</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../db/d2d/structscoreboard.html#a4de425bb2743e2e19c2e954dfe1f0bf8">total_specificity</a>;</div><div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="../../db/d2d/structscoreboard.html#a411afdaaca990dd80881e20637dc44af">  275</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../db/d2d/structscoreboard.html#a411afdaaca990dd80881e20637dc44af">total_length</a>;</div><div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="../../db/d2d/structscoreboard.html#a58353d0395200b159f144de279d0a9b2">  276</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../db/d2d/structscoreboard.html#a58353d0395200b159f144de279d0a9b2">last_char</a>;   <span class="comment">/* set to ! or . if they are the end of the pattern */</span></div><div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="../../db/d2d/structscoreboard.html#a0cfb5b2675ee3fe3abfe9b5a7aee6329">  277</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../db/d2d/structscoreboard.html#a0cfb5b2675ee3fe3abfe9b5a7aee6329">canmatch</a>;     <span class="comment">/* if the string to match was just too short */</span></div><div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="../../db/d2d/structscoreboard.html#ae6f7c8319cca7a79bdab95ecfa8b57eb">  278</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../db/d2d/structscoreboard.html#ae6f7c8319cca7a79bdab95ecfa8b57eb">node</a>;</div><div class="line"><a name="l00279"></a><span class="lineno"><a class="line" href="../../db/d2d/structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">  279</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../db/d2d/structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>;</div><div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">  280</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;};</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">/*! \brief ast_context: An extension context - must remain in sync with fake_context */</span></div><div class="line"><a name="l00284"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html">  284</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> {</div><div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#ace4e0066a5b24f84b90536e9906619f6">  285</a></span>&#160;   <a class="code" href="../../dc/d9e/structast__rwlock__info.html">ast_rwlock_t</a> <a class="code" href="../../d6/d7c/structast__context.html#ace4e0066a5b24f84b90536e9906619f6">lock</a>;         <span class="comment">/*!&lt; A lock to prevent multiple threads from clobbering the context */</span></div><div class="line"><a name="l00286"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">  286</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a>;       <span class="comment">/*!&lt; The root of the list of extensions */</span></div><div class="line"><a name="l00287"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">  287</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>;            <span class="comment">/*!&lt; For exact matches on the extensions in the pattern tree, and for traversals of the pattern_tree  */</span></div><div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">  288</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>;        <span class="comment">/*!&lt; A tree to speed up extension pattern matching */</span></div><div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">  289</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a>;     <span class="comment">/*!&lt; Link them together */</span></div><div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">  290</a></span>&#160;   <span class="keyword">struct </span>ast_includes includes;    <span class="comment">/*!&lt; Include other contexts */</span></div><div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">  291</a></span>&#160;   <span class="keyword">struct </span>ast_ignorepats ignorepats;   <span class="comment">/*!&lt; Patterns for which to continue playing dialtone */</span></div><div class="line"><a name="l00292"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">  292</a></span>&#160;   <span class="keyword">struct </span>ast_sws alts;       <span class="comment">/*!&lt; Alternative switches */</span></div><div class="line"><a name="l00293"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">  293</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>;        <span class="comment">/*!&lt; Registrar -- make sure you malloc this, as the registrar may have to survive module unloads */</span></div><div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#a6022c8a609170c7365fb96e83cb2df48">  294</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/d7c/structast__context.html#a6022c8a609170c7365fb96e83cb2df48">refcount</a>;                   <span class="comment">/*!&lt; each module that would have created this context should inc/dec this as appropriate */</span></div><div class="line"><a name="l00295"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15">  295</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/d7c/structast__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15">autohints</a>;                  <span class="comment">/*!&lt; Whether autohints support is enabled or not */</span></div><div class="line"><a name="l00296"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#a34eb63008d294b713376e64bb2a7b2ef">  296</a></span>&#160;   <a class="code" href="../../d8/dc5/structast__mutex__info.html">ast_mutex_t</a> <a class="code" href="../../d6/d7c/structast__context.html#a34eb63008d294b713376e64bb2a7b2ef">macrolock</a>;        <span class="comment">/*!&lt; A lock to implement &quot;exclusive&quot; macros - held whilst a call is executing in the macro */</span></div><div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">  297</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>[0];           <span class="comment">/*!&lt; Name of the context */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;};</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">/*! \brief ast_state_cb: An extension state notify register item */</span></div><div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="../../d6/d37/structast__state__cb.html">  301</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> {<span class="comment"></span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">   /*! Watcher ID returned when registered. */</span></div><div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="../../d6/d37/structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">  303</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/d37/structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;<span class="comment"></span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">   /*! Arbitrary data passed for callbacks. */</span></div><div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">  305</a></span>&#160;   <span class="keywordtype">void</span> *<a class="code" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>;<span class="comment"></span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">   /*! Flag if this callback is an extended callback containing detailed device status */</span></div><div class="line"><a name="l00307"></a><span class="lineno"><a class="line" href="../../d6/d37/structast__state__cb.html#a46aefd6d3d8d80a5a7fa3c2c25d2638d">  307</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/d37/structast__state__cb.html#a46aefd6d3d8d80a5a7fa3c2c25d2638d">extended</a>;<span class="comment"></span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">   /*! Callback when state changes. */</span></div><div class="line"><a name="l00309"></a><span class="lineno"><a class="line" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">  309</a></span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a2c6cd56c75fb925c726e1f400024f856">ast_state_cb_type</a> <a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a>;<span class="comment"></span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">   /*! Callback when destroyed so any resources given by the registerer can be freed. */</span></div><div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="../../d6/d37/structast__state__cb.html#afdefecc023555cdad67e84d30ff1d997">  311</a></span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#ad3a372c5b23617d0ba1856aa88035f54">ast_state_cb_destroy_type</a> <a class="code" href="../../d6/d37/structast__state__cb.html#afdefecc023555cdad67e84d30ff1d997">destroy_cb</a>;<span class="comment"></span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">   /*! \note Only used by ast_merge_contexts_and_delete */</span></div><div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="../../d6/d37/structast__state__cb.html#a7431f9b08215ae9377dc2c2f0fc79752">  313</a></span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7">AST_LIST_ENTRY</a>(<a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a>) <a class="code" href="../../d3/d96/structentry.html">entry</a>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;};</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"> * \brief Structure for dial plan hints</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"> * \note Hints are pointers from an extension in the dialplan to</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment"> * one or more devices (tech/name)</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"> * See \ref AstExtState</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="../../d8/dac/structast__hint.html">  324</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> {<span class="comment"></span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">   /*!</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">    * \brief Hint extension</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">    * \note</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">    * Will never be NULL while the hint is in the hints container.</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00331"></a><span class="lineno"><a class="line" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">  331</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>;</div><div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">  332</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>; <span class="comment">/*!&lt; Device state callback container for this extension */</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">   /*! Dev state variables */</span></div><div class="line"><a name="l00335"></a><span class="lineno"><a class="line" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">  335</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a>;       <span class="comment">/*!&lt; Last known device state */</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">   /*! Presence state variables */</span></div><div class="line"><a name="l00338"></a><span class="lineno"><a class="line" href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">  338</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a>;     <span class="comment">/*!&lt; Last known presence state */</span></div><div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">  339</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a>; <span class="comment">/*!&lt; Last known presence subtype string */</span></div><div class="line"><a name="l00340"></a><span class="lineno"><a class="line" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">  340</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a>; <span class="comment">/*!&lt; Last known presence message string */</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno"><a class="line" href="../../d8/dac/structast__hint.html#add515701b5f4974e3d3512e034479a86">  342</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/dcf/func__periodic__hook_8c.html#ab32539883094fa1c8103ce4b6ec197c2">context_name</a>[<a class="code" href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];<span class="comment">/*!&lt; Context of destroyed hint extension. */</span></div><div class="line"><a name="l00343"></a><span class="lineno"><a class="line" href="../../d8/dac/structast__hint.html#a300ad50df286a2875c6665b8b421836f">  343</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/dcf/func__periodic__hook_8c.html#a364919046cab7e688f81979a59e46226">exten_name</a>[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];<span class="comment">/*!&lt; Extension of destroyed hint extension. */</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#aecf5cf511c06438b264c501224d13d89">AST_VECTOR</a>(, <span class="keywordtype">char</span> *) <a class="code" href="../../d3/d51/chan__mobile_8c.html#a186b21cef3dc1e94d6a8816e1ed75c00">devices</a>; <span class="comment">/*!&lt; Devices associated with the hint */</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;};</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<a class="code" href="../../db/d94/pbx_8c.html#a430e8ca21568b70b07b17e15c6b373ac">STASIS_MESSAGE_TYPE_DEFN_LOCAL</a>(hint_change_message_type);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<a class="code" href="../../db/d94/pbx_8c.html#a430e8ca21568b70b07b17e15c6b373ac">STASIS_MESSAGE_TYPE_DEFN_LOCAL</a>(hint_remove_message_type);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a734a4ab555884edbf7e2f287a1e6967f">  351</a></span>&#160;<span class="preprocessor">#define HINTDEVICE_DATA_LENGTH 16</span></div><div class="line"><a name="l00352"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a8c05495ada1d36b9a42cb8b184b3b352">  352</a></span>&#160;<a class="code" href="../../dc/d7d/threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6">AST_THREADSTORAGE</a>(<a class="code" href="../../db/d94/pbx_8c.html#a8c05495ada1d36b9a42cb8b184b3b352">hintdevice_data</a>);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">/* --- Hash tables of various objects --------*/</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="preprocessor">#ifdef LOW_MEMORY</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="preprocessor">#define HASH_EXTENHINT_SIZE 17</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00358"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa8a73717c101aec8cce8641cf55aed80">  358</a></span>&#160;<span class="preprocessor">#define HASH_EXTENHINT_SIZE 563</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">/*! \brief Container for hint devices */</span></div><div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a8845e672e1f5ce60902beeb96991459b">  363</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../db/d94/pbx_8c.html#a8845e672e1f5ce60902beeb96991459b">hintdevices</a>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment"> * \brief Structure for dial plan hint devices</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"> * \note hintdevice is one device pointing to a hint.</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00369"></a><span class="lineno"><a class="line" href="../../df/d6f/structast__hintdevice.html">  369</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> {<span class="comment"></span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">   /*!</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">    * \brief Hint this hintdevice belongs to.</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">    * \note Holds a reference to the hint object.</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00374"></a><span class="lineno"><a class="line" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">  374</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a>;<span class="comment"></span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">   /*! Name of the hint device. */</span></div><div class="line"><a name="l00376"></a><span class="lineno"><a class="line" href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">  376</a></span>&#160;   <span class="keywordtype">char</span> hintdevice[1];</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;};</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">/*! \brief Container for autohint contexts */</span></div><div class="line"><a name="l00380"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a49a1c2b750c783e458a6a3dab67e4159">  380</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../db/d94/pbx_8c.html#a49a1c2b750c783e458a6a3dab67e4159">autohints</a>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"> * \brief Structure for dial plan autohints</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="../../da/d7f/structast__autohint.html">  385</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../da/d7f/structast__autohint.html">ast_autohint</a> {<span class="comment"></span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">   /*! \brief Name of the registrar */</span></div><div class="line"><a name="l00387"></a><span class="lineno"><a class="line" href="../../da/d7f/structast__autohint.html#ab990a3529ebde2681a00468cad7c0b48">  387</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../da/d7f/structast__autohint.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>;<span class="comment"></span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">   /*! \brief Name of the context */</span></div><div class="line"><a name="l00389"></a><span class="lineno"><a class="line" href="../../da/d7f/structast__autohint.html#a08658434a6786d5f55bf4f6d6a222625">  389</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>[1];</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;};</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment"> * \note Using the device for hash</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a605e318c7918e9a219bde85ed660c8c2">  395</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a605e318c7918e9a219bde85ed660c8c2">hintdevice_hash_cb</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;{</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> *<a class="code" href="../../dd/d43/http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *key;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      key = obj;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      ext = obj;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      key = ext-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">hintdevice</a>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;   }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#ab08f8db2a7258e538a0da7417f58db58">ast_str_case_hash</a>(key);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;}</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment"> * \note Devices on hints are not unique so no CMP_STOP is returned</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment"> * Dont use ao2_find against hintdevices container cause there always</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"> * could be more than one result.</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00421"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aabf9a3a7442aeee52b849c70c6d0af33">  421</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aabf9a3a7442aeee52b849c70c6d0af33">hintdevice_cmp_multiple</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;{</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> *left = obj;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> *right = arg;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *right_key = arg;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;   <span class="keywordtype">int</span> cmp;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      right_key = right-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">hintdevice</a>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="comment">/* Fall through */</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      cmp = strcasecmp(left-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">hintdevice</a>, right_key);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20">OBJ_SEARCH_PARTIAL_KEY</a>:</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">      * We could also use a partial key struct containing a length</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">      * so strlen() does not get called for every comparison instead.</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      cmp = strncmp(left-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">hintdevice</a>, right_key, strlen(right_key));</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      cmp = 0;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;   }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   <span class="keywordflow">return</span> cmp ? 0 : <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;}</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"> * \note Using the context name for hash</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00453"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a7124563d8bad85417d812aab4404ceaf">  453</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a7124563d8bad85417d812aab4404ceaf">autohint_hash_cb</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;{</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../da/d7f/structast__autohint.html">ast_autohint</a> *autohint;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *key;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      key = obj;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      autohint = obj;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      key = autohint-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#a08658434a6786d5f55bf4f6d6a222625">context</a>;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#ab08f8db2a7258e538a0da7417f58db58">ast_str_case_hash</a>(key);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae0ab68739556d89d38b0c050d6e2b469">  474</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae0ab68739556d89d38b0c050d6e2b469">autohint_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;{</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d7f/structast__autohint.html">ast_autohint</a> *left = obj;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d7f/structast__autohint.html">ast_autohint</a> *right = arg;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *right_key = arg;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   <span class="keywordtype">int</span> cmp;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      right_key = right-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#a08658434a6786d5f55bf4f6d6a222625">context</a>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="comment">/* Fall through */</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      cmp = strcasecmp(left-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#a08658434a6786d5f55bf4f6d6a222625">context</a>, right_key);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20">OBJ_SEARCH_PARTIAL_KEY</a>:</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">      * We could also use a partial key struct containing a length</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">      * so strlen() does not get called for every comparison instead.</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      cmp = strncmp(left-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#a08658434a6786d5f55bf4f6d6a222625">context</a>, right_key, strlen(right_key));</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      cmp = 0;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;   }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;   <span class="keywordflow">return</span> cmp ? 0 : <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;}</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">/*! \internal \brief \c ao2_callback function to remove hintdevices */</span></div><div class="line"><a name="l00504"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a99c66d51539b6071efe452d9e86b299d">  504</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a99c66d51539b6071efe452d9e86b299d">hintdevice_remove_cb</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">void</span> *<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;{</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> *candidate = obj;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;   <span class="keywordtype">char</span> *device = arg;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint = <a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(candidate-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">hintdevice</a>, device)</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      &amp;&amp; candidate-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a> == hint) {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;   }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;}</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a582812711d3d9e2cf321bdae3230ec90">  517</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a582812711d3d9e2cf321bdae3230ec90">remove_hintdevice</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;{</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;hint-&gt;devices) &gt; 0) {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="keywordtype">char</span> *device = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;hint-&gt;devices, 0);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ab55d227245c39181ce1a4e4f013cc898">ao2_t_callback_data</a>(hintdevices, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>,</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a99c66d51539b6071efe452d9e86b299d">hintdevice_remove_cb</a>, device, hint, <span class="stringliteral">&quot;Remove device from container&quot;</span>);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <a class="code" href="../../d6/d68/vector_8h.html#a88927df275257d9c9431252e016503ec">AST_VECTOR_REMOVE_UNORDERED</a>(&amp;hint-&gt;devices, 0);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(device);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a646884fcc8a57de917abafc7a200daee">parse_hint_device</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *hint_args);<span class="comment"></span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment"> * \brief Destroy the given hintdevice object.</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment"> * \param obj Hint device to destroy.</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00540"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a11b6e058f5f55637b0e7a4ecb9833b54">  540</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a11b6e058f5f55637b0e7a4ecb9833b54">hintdevice_destroy</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;{</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> *doomed = obj;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;   <span class="keywordflow">if</span> (doomed-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a>) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(doomed-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a>, -1);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      doomed-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;   }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;}</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">/*! \brief add hintdevice structure and link it into the container.</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae261065f1ffd04c08087b11886382530">  552</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae261065f1ffd04c08087b11886382530">add_hintdevice</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *devicelist)</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;{</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a>;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;   <span class="keywordtype">char</span> *cur;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> *device;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;   <span class="keywordtype">int</span> devicelength;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;   <span class="keywordflow">if</span> (!hint || !devicelist) {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="comment">/* Trying to add garbage? Don&#39;t bother. */</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;   <span class="keywordflow">if</span> (!(str = <a class="code" href="../../d6/d90/strings_8h.html#afe8f5f844f2fd5f5bd5d0be5ef671481">ast_str_thread_get</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a8c05495ada1d36b9a42cb8b184b3b352">hintdevice_data</a>, 16))) {</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   }</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;str, 0, <span class="stringliteral">&quot;%s&quot;</span>, devicelist);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   parse = <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   <span class="comment">/* Spit on &#39;&amp;&#39; and &#39;,&#39; to handle presence hints as well */</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;   <span class="keywordflow">while</span> ((cur = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;parse, <span class="stringliteral">&quot;&amp;,&quot;</span>))) {</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keywordtype">char</span> *device_name;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      devicelength = strlen(cur);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="keywordflow">if</span> (!devicelength) {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      }</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      device_name = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(cur);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">if</span> (!device_name) {</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      device = <a class="code" href="../../d5/da5/astobj2_8h.html#ad57326008c326db88dc36779741622b8">ao2_t_alloc</a>(<span class="keyword">sizeof</span>(*device) + devicelength, <a class="code" href="../../db/d94/pbx_8c.html#a11b6e058f5f55637b0e7a4ecb9833b54">hintdevice_destroy</a>,</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;         <span class="stringliteral">&quot;allocating a hintdevice structure&quot;</span>);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <span class="keywordflow">if</span> (!device) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(device_name);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      strcpy(device-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">hintdevice</a>, cur);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, +1);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      device-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a> = <a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a>;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(&amp;hint-&gt;devices, device_name)) {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(device_name);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(device, -1);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      }</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6db9934459f5cdc95cb3af77d55d426e">ao2_t_link</a>(hintdevices, device, <span class="stringliteral">&quot;Linking device into hintdevice container.&quot;</span>);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(device, -1, <span class="stringliteral">&quot;hintdevice is linked so we can unref&quot;</span>);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;   }</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;}</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno"><a class="line" href="../../d3/dd9/structcfextension__states.html">  606</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structcfextension__states.html">cfextension_states</a> {</div><div class="line"><a name="l00607"></a><span class="lineno"><a class="line" href="../../d3/dd9/structcfextension__states.html#a96e40dac6a068ce67b46205303d3e20a">  607</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d3/dd9/structcfextension__states.html#a96e40dac6a068ce67b46205303d3e20a">extension_state</a>;</div><div class="line"><a name="l00608"></a><span class="lineno"><a class="line" href="../../d3/dd9/structcfextension__states.html#aecfd3170c3d94608e5e5c038085fdf3f">  608</a></span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="../../d3/dd9/structcfextension__states.html#aecfd3170c3d94608e5e5c038085fdf3f">text</a>;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;} <a class="code" href="../../db/d94/pbx_8c.html#ae9e216d31339f7268f94d2db61e0516b">extension_states</a>[] = {</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;   { <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6">AST_EXTENSION_NOT_INUSE</a>,                     <span class="stringliteral">&quot;Idle&quot;</span> },</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;   { <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a">AST_EXTENSION_INUSE</a>,                         <span class="stringliteral">&quot;InUse&quot;</span> },</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   { <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fad62d357f0ccde2a718c374a0a4af2b98">AST_EXTENSION_BUSY</a>,                          <span class="stringliteral">&quot;Busy&quot;</span> },</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   { <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa5820eb407f3a3dbc5046c97ad43ee1f3">AST_EXTENSION_UNAVAILABLE</a>,                   <span class="stringliteral">&quot;Unavailable&quot;</span> },</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   { <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc">AST_EXTENSION_RINGING</a>,                       <span class="stringliteral">&quot;Ringing&quot;</span> },</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;   { <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a">AST_EXTENSION_INUSE</a> | <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc">AST_EXTENSION_RINGING</a>, <span class="stringliteral">&quot;InUse&amp;Ringing&quot;</span> },</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   { <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa83180bb058ded006c01229431fc887f9">AST_EXTENSION_ONHOLD</a>,                        <span class="stringliteral">&quot;Hold&quot;</span> },</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   { <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a">AST_EXTENSION_INUSE</a> | <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa83180bb058ded006c01229431fc887f9">AST_EXTENSION_ONHOLD</a>,  <span class="stringliteral">&quot;InUse&amp;Hold&quot;</span> }</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;};</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno"><a class="line" href="../../d1/db2/structpbx__exception.html">  620</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d1/db2/structpbx__exception.html">pbx_exception</a> {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a061580e89c55282a7140fa3fdfd52b6d">AST_DECLARE_STRING_FIELDS</a>(</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(<a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>); <span class="comment">/*!&lt; Context associated with this exception */</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>);   <span class="comment">/*!&lt; Exten associated with this exception */</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(reason);     <span class="comment">/*!&lt; The exception reason */</span></div><div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="../../d1/db2/structpbx__exception.html#af9968f5aac9a0d889c0506368ea1e649">  625</a></span>&#160;   );</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno"><a class="line" href="../../d1/db2/structpbx__exception.html#acec9ce2df15222151ad66fcb1d74eb9f">  627</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d1/db2/structpbx__exception.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;           <span class="comment">/*!&lt; Priority associated with this exception */</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;};</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *cidpattern, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> log_match_char_tree(<span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../d5/da1/structnode.html">node</a>, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>); <span class="comment">/* for use anywhere */</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a2c64874adba109557bade6a7cbfd1eea">new_find_extension</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, <span class="keyword">struct</span> <a class="code" href="../../db/d2d/structscoreboard.html">scoreboard</a> *score,</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *tree, <span class="keywordtype">int</span> length, <span class="keywordtype">int</span> spec, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid,</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>, <span class="keyword">enum</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a> action);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../db/d94/pbx_8c.html#a61b4c35e18be0d479b55e45f373725ee">already_in_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *current, <span class="keywordtype">char</span> *pat, <span class="keywordtype">int</span> <a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a>);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../db/d94/pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con,</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e1, <span class="keywordtype">int</span> findonly);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a705ac1563ea8e4c1e3f369e6ad952fda">create_match_char_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../db/d94/pbx_8c.html#aefee0e2a38de76a008277db39cd9e3a8">get_canmatch_exten</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../d5/da1/structnode.html">node</a>);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a3900cc7c8183ab6a7316f5dbc2b955ed">destroy_pattern_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *pattern_tree);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a01a31156d536b161d4c400af885a6b23">hashtab_compare_extens</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ha_a, <span class="keyword">const</span> <span class="keywordtype">void</span> *ah_b);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a312597f1da31dcefbf18f31335f7295c">hashtab_compare_exten_numbers</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ah_a, <span class="keyword">const</span> <span class="keywordtype">void</span> *ah_b);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aad72a88ef3aa3258d69475cd14f274d0">hashtab_compare_exten_labels</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ah_a, <span class="keyword">const</span> <span class="keywordtype">void</span> *ah_b);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a46084c800c9b3dbe1f2b57e2d2b62304">hashtab_hash_extens</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj);</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a4ee70a9380daf9be2bf681becb1a69c3">hashtab_hash_priority</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae4a0bd08dbd3bc22fc65de969d3bfa45">hashtab_hash_labels</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#af51adb9b78f628397d7b0c1781b6d79e">__ast_internal_context_destroy</a>( <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a62350bf22ada5eec5dcb16986c1909b9">ast_add_extension_nolock</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#a7f763283c27da5574f6f8d1b2a2b9288">replace</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d5a/structextension.html">extension</a>,</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid,</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *application, <span class="keywordtype">void</span> *<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>, <span class="keywordtype">void</span> (*<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>)(<span class="keywordtype">void</span> *), <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a26a33f5a203f8d30edc12bea10cd3f72">ast_add_extension2_lockopt</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con,</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;   <span class="keywordtype">int</span> replace, <span class="keyword">const</span> <span class="keywordtype">char</span> *extension, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid,</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *application, <span class="keywordtype">void</span> *data, <span class="keywordtype">void</span> (*<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>)(<span class="keywordtype">void</span> *),</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a3e3ed71b5dcbadee8292f3d1837eaa38">registrar_file</a>, <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#a90ec1116822211c96e24055d95972cca">registrar_line</a>,</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;   <span class="keywordtype">int</span> lock_context);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../db/d94/pbx_8c.html#ae295e363d292aafe65f327e628d90dcd">find_context</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#af26f77a23357ab9f51e6080911400d96">get_device_state_causing_channels</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a517e4a9ba0d6233eba58ad0f1307f55c">ext_strncpy</a>(<span class="keywordtype">char</span> *dst, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">size_t</span> dst_size, <span class="keywordtype">int</span> nofluff);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment"> * \brief Character array comparison function for qsort.</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment"> * \param a Left side object.</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment"> * \param b Right side object.</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment"> * \retval &lt;0 if a &lt; b</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment"> * \retval =0 if a = b</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment"> * \retval &gt;0 if a &gt; b</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00674"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a64ec6367a27dcdeb7ce0b7b614a2cc44">  674</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a64ec6367a27dcdeb7ce0b7b614a2cc44">compare_char</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a025ede890af287961d3a98d0e634a62b">b</a>)</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;{</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ac = <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d34/gsm__explode_8c.html#a4e819f902d7ae632dd5ae75b29372f1b">bc</a> = <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a025ede890af287961d3a98d0e634a62b">b</a>;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;   <span class="keywordflow">return</span> *ac - *<a class="code" href="../../d8/d34/gsm__explode_8c.html#a4e819f902d7ae632dd5ae75b29372f1b">bc</a>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;}</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">/* labels, contexts are case sensitive  priority numbers are ints */</span></div><div class="line"><a name="l00683"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a20a2f5668173430437db02cdd0acc9f3">  683</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a20a2f5668173430437db02cdd0acc9f3">ast_hashtab_compare_contexts</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ah_a, <span class="keyword">const</span> <span class="keywordtype">void</span> *ah_b)</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;{</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *ac = ah_a;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d8/d34/gsm__explode_8c.html#a4e819f902d7ae632dd5ae75b29372f1b">bc</a> = ah_b;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;   <span class="keywordflow">if</span> (!ac || !bc) <span class="comment">/* safety valve, but it might prevent a crash you&#39;d rather have happen */</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   <span class="comment">/* assume context names are registered in a string table! */</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   <span class="keywordflow">return</span> strcmp(ac-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, bc-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;}</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a01a31156d536b161d4c400af885a6b23">  693</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a01a31156d536b161d4c400af885a6b23">hashtab_compare_extens</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ah_a, <span class="keyword">const</span> <span class="keywordtype">void</span> *ah_b)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;{</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *ac = ah_a;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d8/d34/gsm__explode_8c.html#a4e819f902d7ae632dd5ae75b29372f1b">bc</a> = ah_b;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;   <span class="keywordtype">int</span> x = strcmp(ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, bc-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>);</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;   <span class="keywordflow">if</span> (x) { <span class="comment">/* if exten names are diff, then return */</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="keywordflow">return</span> x;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;   }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;   <span class="comment">/* but if they are the same, do the cidmatch values match? */</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;   <span class="comment">/* not sure which side may be using ast_ext_matchcid_types, so check both */</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;   <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a37db4d8017d05366c5b19084c5c5c84c">AST_EXT_MATCHCID_ANY</a> || bc-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a37db4d8017d05366c5b19084c5c5c84c">AST_EXT_MATCHCID_ANY</a>) {</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;   }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;   <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a245df0f7c904df378369f60ea91938e7">AST_EXT_MATCHCID_OFF</a> &amp;&amp; bc-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a245df0f7c904df378369f60ea91938e7">AST_EXT_MATCHCID_OFF</a>) {</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;   }</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;   <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> != bc-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a>) {</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;   }</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;   <span class="comment">/* all other cases already disposed of, match now required on callerid string (cidmatch) */</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;   <span class="comment">/* although ast_add_extension2_lockopt() enforces non-zero ptr, caller may not have */</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>) &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(bc-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>)) {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;   }</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;   <span class="keywordflow">return</span> strcmp(ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>, bc-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;}</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a312597f1da31dcefbf18f31335f7295c">  721</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a312597f1da31dcefbf18f31335f7295c">hashtab_compare_exten_numbers</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ah_a, <span class="keyword">const</span> <span class="keywordtype">void</span> *ah_b)</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;{</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *ac = ah_a;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d8/d34/gsm__explode_8c.html#a4e819f902d7ae632dd5ae75b29372f1b">bc</a> = ah_b;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;   <span class="keywordflow">return</span> ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> != bc-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;}</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div><div class="line"><a name="l00728"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aad72a88ef3aa3258d69475cd14f274d0">  728</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aad72a88ef3aa3258d69475cd14f274d0">hashtab_compare_exten_labels</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ah_a, <span class="keyword">const</span> <span class="keywordtype">void</span> *ah_b)</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;{</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *ac = ah_a;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d8/d34/gsm__explode_8c.html#a4e819f902d7ae632dd5ae75b29372f1b">bc</a> = ah_b;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;   <span class="keywordflow">return</span> strcmp(<a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>, <span class="stringliteral">&quot;&quot;</span>), <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(bc-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;}</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a56461864a4e21b14e753b78f9ac7afb7">  735</a></span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a56461864a4e21b14e753b78f9ac7afb7">ast_hashtab_hash_contexts</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;{</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *ac = obj;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/da0/hashtab_8h.html#af8904cce564fd39de28b566bb8c261eb">ast_hashtab_hash_string</a>(ac-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;}</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a46084c800c9b3dbe1f2b57e2d2b62304">  741</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a46084c800c9b3dbe1f2b57e2d2b62304">hashtab_hash_extens</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;{</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *ac = obj;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = <a class="code" href="../../d6/da0/hashtab_8h.html#af8904cce564fd39de28b566bb8c261eb">ast_hashtab_hash_string</a>(ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y = 0;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;   <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a0aa5ba413029c07073f6e915036e037f">AST_EXT_MATCHCID_ON</a>)</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      y = <a class="code" href="../../d6/da0/hashtab_8h.html#af8904cce564fd39de28b566bb8c261eb">ast_hashtab_hash_string</a>(ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   <span class="keywordflow">return</span> x+y;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;}</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a4ee70a9380daf9be2bf681becb1a69c3">  751</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a4ee70a9380daf9be2bf681becb1a69c3">hashtab_hash_priority</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;{</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *ac = obj;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/da0/hashtab_8h.html#a42e7322ae7381ee379bfe15798ca75e2">ast_hashtab_hash_int</a>(ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>);</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;}</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae4a0bd08dbd3bc22fc65de969d3bfa45">  757</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae4a0bd08dbd3bc22fc65de969d3bfa45">hashtab_hash_labels</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;{</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *ac = obj;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/da0/hashtab_8h.html#af8904cce564fd39de28b566bb8c261eb">ast_hashtab_hash_string</a>(<a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(ac-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;}</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a5f7ea48b3f8614ef9314e5aece1f1bc3">  763</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a5f7ea48b3f8614ef9314e5aece1f1bc3">autofallthrough</a> = 1;</div><div class="line"><a name="l00764"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3a7600857afccfa4f7a5c55dcaec8407">  764</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a3a7600857afccfa4f7a5c55dcaec8407">extenpatternmatchnew</a> = 0;</div><div class="line"><a name="l00765"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a8f600ca9999b2d9c3d64cbcdb503895c">  765</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a8f600ca9999b2d9c3d64cbcdb503895c">overrideswitch</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">/*! \brief Subscription for device state change events */</span></div><div class="line"><a name="l00768"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ace475b3c63f137d8ff9af0e10d4f5e97">  768</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../db/d94/pbx_8c.html#ace475b3c63f137d8ff9af0e10d4f5e97">device_state_sub</a>;<span class="comment"></span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">/*! \brief Subscription for presence state change events */</span></div><div class="line"><a name="l00770"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a1d07989f011294a86b5557e280be666e">  770</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../db/d94/pbx_8c.html#a1d07989f011294a86b5557e280be666e">presence_state_sub</a>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a55c3f21eda54c35107729cd65e482aec">  772</a></span>&#160;<a class="code" href="../../dd/d42/lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a>(<a class="code" href="../../db/d94/pbx_8c.html#a55c3f21eda54c35107729cd65e482aec">maxcalllock</a>);</div><div class="line"><a name="l00773"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a098053e0fabe1ebd3f0b70fd7c9f8a71">  773</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a098053e0fabe1ebd3f0b70fd7c9f8a71">countcalls</a>;</div><div class="line"><a name="l00774"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a078330b9a32065ec6a0c0731c06719cd">  774</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a078330b9a32065ec6a0c0731c06719cd">totalcalls</a>;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aae85d5aab50f2d1b8392d6df276f2561">  776</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../db/d94/pbx_8c.html#aae85d5aab50f2d1b8392d6df276f2561">contexts</a>;</div><div class="line"><a name="l00777"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">  777</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *<a class="code" href="../../db/d94/pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment"> * \brief Lock for the ast_context list</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment"> * \note</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment"> * This lock MUST be recursive, or a deadlock on reload may result.  See</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment"> * https://issues.asterisk.org/view.php?id=17643</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00785"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a7470458bc954de8f3d698bd99b25aed5">  785</a></span>&#160;<a class="code" href="../../dd/d42/lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a>(<a class="code" href="../../db/d94/pbx_8c.html#a7470458bc954de8f3d698bd99b25aed5">conlock</a>);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment"> * \brief Lock to hold off restructuring of hints by ast_merge_contexts_and_delete.</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00790"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">  790</a></span>&#160;<a class="code" href="../../dd/d42/lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a>(<a class="code" href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">context_merge_lock</a>);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a70382561daaa758a201b7a711d566e24">  792</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a70382561daaa758a201b7a711d566e24">stateid</a> = 1;<span class="comment"></span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment"> * \note When holding this container&#39;s lock, do _not_ do</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment"> * anything that will cause conlock to be taken, unless you</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment"> * _already_ hold it.  The ast_merge_contexts_and_delete function</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment"> * will take the locks in conlock/hints order, so any other</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"> * paths that require both locks must also take them in that</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"> * order.</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00801"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#adab2235bcef511bda65ac8efec17273f">  801</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../db/d94/pbx_8c.html#adab2235bcef511bda65ac8efec17273f">hints</a>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a01df16b518b69d56f374081effd01432">  803</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../db/d94/pbx_8c.html#a01df16b518b69d56f374081effd01432">statecbs</a>;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="preprocessor">#ifdef CONTEXT_DEBUG</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">/* these routines are provided for doing run-time checks</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment">   on the extension structures, in case you are having</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">   problems, this routine might help you localize where</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment">   the problem is occurring. It&#39;s kinda like a debug memory</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment">   allocator&#39;s arena checker... It&#39;ll eat up your cpu cycles!</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment">   but you&#39;ll see, if you call it in the right places,</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment">   right where your problems began...</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment">/* you can break on the check_contexts_trouble()</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment">routine in your debugger to stop at the moment</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">there&#39;s a problem */</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="keywordtype">void</span> check_contexts_trouble(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="keywordtype">void</span> check_contexts_trouble(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;{</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;   <span class="keywordtype">int</span> x = 1;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;   x = 2;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;}</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="keywordtype">int</span> check_contexts(<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="keywordtype">int</span> check_contexts(<span class="keywordtype">char</span> *<a class="code" href="../../d2/dc8/namespacemake__ari__stubs.html#a40a5d58ffa6e88aa578d6683ac413105">file</a>, <span class="keywordtype">int</span> line )</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;{</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d2e/structast__hashtab__iter.html">ast_hashtab_iter</a> *<a class="code" href="../../dd/d95/res__pktccops_8c.html#acc5ce172913ccabaada04d5c408dd85b">t1</a>;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *c1, *c2;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;   <span class="keywordtype">int</span> found = 0;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e1, *e2, *e3;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> ex;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;   <span class="comment">/* try to find inconsistencies */</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;   <span class="comment">/* is every context in the context table in the context list and vice-versa ? */</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;   <span class="keywordflow">if</span> (!contexts_table) {</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: No contexts_table!\n&quot;</span>, file, line);</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      usleep(500000);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;   }</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;   t1 = <a class="code" href="../../d6/da0/hashtab_8h.html#a2a9c96a0ce6fd77d2858e65d7d63f7b3">ast_hashtab_start_traversal</a>(contexts_table);</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;   <span class="keywordflow">while</span>( (c1 = <a class="code" href="../../d6/da0/hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197">ast_hashtab_next</a>(t1))) {</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      <span class="keywordflow">for</span>(c2=contexts;c2;c2=c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a>) {</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;         <span class="keywordflow">if</span> (!strcmp(c1-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>)) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            found = 1;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;         }</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <span class="keywordflow">if</span> (!found) {</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: Could not find the %s context in the linked list\n&quot;</span>, file, line, c1-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;         check_contexts_trouble();</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      }</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;   }</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;   <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(t1);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;   <span class="keywordflow">for</span>(c2=contexts;c2;c2=c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a>) {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      c1 = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      <span class="keywordflow">if</span> (!c1) {</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: Could not find the %s context in the hashtab\n&quot;</span>, file, line, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;         check_contexts_trouble();</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;   }</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;   <span class="comment">/* loop thru all contexts, and verify the exten structure compares to the</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment">      hashtab structure */</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;   <span class="keywordflow">for</span>(c2=contexts;c2;c2=c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a>) {</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      c1 = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <span class="keywordflow">if</span> (c1) {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;         <span class="comment">/* is every entry in the root list also in the root_table? */</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;         <span class="keywordflow">for</span>(e1 = c1-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a>; e1; e1=e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>)</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;         {</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            <span class="keywordtype">char</span> dummy_name[1024];</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            ex.exten = dummy_name;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            ex.matchcid = e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a>;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            ex.cidmatch = e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(dummy_name, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keyword">sizeof</span>(dummy_name));</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            e2 = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(c1-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, &amp;ex);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            <span class="keywordflow">if</span> (!e2) {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;               <span class="keywordflow">if</span> (e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a0aa5ba413029c07073f6e915036e037f">AST_EXT_MATCHCID_ON</a>) {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Called from: %s:%d: The %s context records &quot;</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                     <span class="stringliteral">&quot;the exten %s (CID match: %s) but it is not in its root_table\n&quot;</span>,</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                     file, line, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, dummy_name, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0574199c7fbb661fd7684472741955bb">cidmatch_display</a>);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Called from: %s:%d: The %s context records &quot;</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                     <span class="stringliteral">&quot;the exten %s but it is not in its root_table\n&quot;</span>,</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                     file, line, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, dummy_name);</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;               }</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;               check_contexts_trouble();</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            }</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;         }</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;         <span class="comment">/* is every entry in the root_table also in the root list? */</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;         <span class="keywordflow">if</span> (!c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>) {</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            <span class="keywordflow">if</span> (c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a>) {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: No c2-&gt;root_table for context %s!\n&quot;</span>, file, line, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;               usleep(500000);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            }</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            t1 = <a class="code" href="../../d6/da0/hashtab_8h.html#a2a9c96a0ce6fd77d2858e65d7d63f7b3">ast_hashtab_start_traversal</a>(c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            <span class="keywordflow">while</span>( (e2 = <a class="code" href="../../d6/da0/hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197">ast_hashtab_next</a>(t1)) ) {</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;               <span class="keywordflow">for</span>(e1=c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a>;e1;e1=e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>) {</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                  <span class="keywordflow">if</span> (!strcmp(e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)) {</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                     found = 1;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                  }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;               }</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;               <span class="keywordflow">if</span> (!found) {</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: The %s context records the exten %s but it is not in its root_table\n&quot;</span>, file, line, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>);</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                  check_contexts_trouble();</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;               }</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            }</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(t1);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;         }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      }</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <span class="comment">/* is every priority reflected in the peer_table at the head of the list? */</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="comment">/* is every entry in the root list also in the root_table? */</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="comment">/* are the per-extension peer_tables in the right place? */</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keywordflow">for</span>(e1 = c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a>; e1; e1 = e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>) {</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;         <span class="keywordflow">for</span>(e2=e1;e2;e2=e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>) {</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            ex.priority = e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <span class="keywordflow">if</span> (e2 != e1 &amp;&amp; e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>) {</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: The %s context, %s exten, %d priority has a peer_table entry, and shouldn&#39;t!\n&quot;</span>, file, line, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> );</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;               check_contexts_trouble();</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            }</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <span class="keywordflow">if</span> (e2 != e1 &amp;&amp; e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>) {</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: The %s context, %s exten, %d priority has a peer_label_table entry, and shouldn&#39;t!\n&quot;</span>, file, line, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> );</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;               check_contexts_trouble();</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            }</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            <span class="keywordflow">if</span> (e2 == e1 &amp;&amp; !e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>){</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: The %s context, %s exten, %d priority doesn&#39;t have a peer_table!\n&quot;</span>, file, line, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> );</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;               check_contexts_trouble();</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            }</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            <span class="keywordflow">if</span> (e2 == e1 &amp;&amp; !e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>) {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: The %s context, %s exten, %d priority doesn&#39;t have a peer_label_table!\n&quot;</span>, file, line, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> );</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;               check_contexts_trouble();</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            }</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            e3 = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, &amp;ex);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            <span class="keywordflow">if</span> (!e3) {</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: The %s context, %s exten, %d priority is not reflected in the peer_table\n&quot;</span>, file, line, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> );</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;               check_contexts_trouble();</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            }</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;         }</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;         <span class="keywordflow">if</span> (!e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>){</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: No e1-&gt;peer_table!\n&quot;</span>, file, line);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            usleep(500000);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;         }</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;         <span class="comment">/* is every entry in the peer_table also in the peer list? */</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;         t1 = <a class="code" href="../../d6/da0/hashtab_8h.html#a2a9c96a0ce6fd77d2858e65d7d63f7b3">ast_hashtab_start_traversal</a>(e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;         <span class="keywordflow">while</span>( (e2 = <a class="code" href="../../d6/da0/hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197">ast_hashtab_next</a>(t1)) ) {</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;            <span class="keywordflow">for</span>(e3=e1;e3;e3=e3-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>) {</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;               <span class="keywordflow">if</span> (e3-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> == e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>) {</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                  found = 1;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;               }</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            }</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            <span class="keywordflow">if</span> (!found) {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Called from: %s:%d: The %s context, %s exten, %d priority is not reflected in the peer list\n&quot;</span>, file, line, c2-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, e2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> );</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;               check_contexts_trouble();</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;            }</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;         }</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(t1);</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      }</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;   }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;}</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a1a7e2b65d9fc687fe40a8dbcefa7bc4e">  985</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a1a7e2b65d9fc687fe40a8dbcefa7bc4e">pbx_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d83/structast__pbx.html">ast_pbx</a> *p)</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;{</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p);</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;}</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment">/* form a tree that fully describes all the patterns in a context&#39;s extensions</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment"> * in this tree, a &quot;node&quot; represents an individual character or character set</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment"> * meant to match the corresponding character in a dial string. The tree</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment"> * consists of a series of match_char structs linked in a chain</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment"> * via the alt_char pointers. More than one pattern can share the same parts of the</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment"> * tree as other extensions with the same pattern to that point.</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment"> * My first attempt to duplicate the finding of the &#39;best&#39; pattern was flawed in that</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment"> * I misunderstood the general algorithm. I thought that the &#39;best&#39; pattern</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment"> * was the one with lowest total score. This was not true. Thus, if you have</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment"> * patterns &quot;1XXXXX&quot; and &quot;X11111&quot;, you would be tempted to say that &quot;X11111&quot; is</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment"> * the &quot;best&quot; match because it has fewer X&#39;s, and is therefore more specific,</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment"> * but this is not how the old algorithm works. It sorts matching patterns</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment"> * in a similar collating sequence as sorting alphabetic strings, from left to</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment"> * right. Thus, &quot;1XXXXX&quot; comes before &quot;X11111&quot;, and would be the &quot;better&quot; match,</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment"> * because &quot;1&quot; is more specific than &quot;X&quot;.</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment"> * So, to accomodate this philosophy, I sort the tree branches along the alt_char</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment"> * line so they are lowest to highest in specificity numbers. This way, as soon</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment"> * as we encounter our first complete match, we automatically have the &quot;best&quot;</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment"> * match and can stop the traversal immediately. Same for CANMATCH/MATCHMORE.</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment"> * If anyone would like to resurrect the &quot;wrong&quot; pattern trie searching algorithm,</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment"> * they are welcome to revert pbx to before 1 Apr 2008.</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment"> * As an example, consider these 4 extensions:</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment"> * (a) NXXNXXXXXX</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment"> * (b) 307754XXXX</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment"> * (c) fax</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment"> * (d) NXXXXXXXXX</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment"> * In the above, between (a) and (d), (a) is a more specific pattern than (d), and would win over</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment"> * most numbers. For all numbers beginning with 307754, (b) should always win.</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment"> * These pattern should form a (sorted) tree that looks like this:</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment"> *   { &quot;3&quot; }  --next--&gt;  { &quot;0&quot; }  --next--&gt; { &quot;7&quot; } --next--&gt; { &quot;7&quot; } --next--&gt; { &quot;5&quot; } ... blah ... --&gt; { &quot;X&quot; exten_match: (b) }</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment"> *      |</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment"> *      |alt</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment"> *      |</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment"> *   { &quot;f&quot; }  --next--&gt;  { &quot;a&quot; }  --next--&gt; { &quot;x&quot;  exten_match: (c) }</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment"> *   { &quot;N&quot; }  --next--&gt;  { &quot;X&quot; }  --next--&gt; { &quot;X&quot; } --next--&gt; { &quot;N&quot; } --next--&gt; { &quot;X&quot; } ... blah ... --&gt; { &quot;X&quot; exten_match: (a) }</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment"> *      |                                                        |</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment"> *      |                                                        |alt</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment"> *      |alt                                                     |</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment"> *      |                                                     { &quot;X&quot; } --next--&gt; { &quot;X&quot; } ... blah ... --&gt; { &quot;X&quot; exten_match: (d) }</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment"> *      |</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment"> *     NULL</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment"> *   In the above, I could easily turn &quot;N&quot; into &quot;23456789&quot;, but I think that a quick &quot;if( *z &gt;= &#39;2&#39; &amp;&amp; *z &lt;= &#39;9&#39; )&quot; might take</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment"> *   fewer CPU cycles than a call to strchr(&quot;23456789&quot;,*z), where *z is the char to match...</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment"> *   traversal is pretty simple: one routine merely traverses the alt list, and for each matching char in the pattern,  it calls itself</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment"> *   on the corresponding next pointer, incrementing also the pointer of the string to be matched, and passing the total specificity and length.</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment"> *   We pass a pointer to a scoreboard down through, also.</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment"> *   The scoreboard isn&#39;t as necessary to the revised algorithm, but I kept it as a handy way to return the matched extension.</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment"> *   The first complete match ends the traversal, which should make this version of the pattern matcher faster</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment"> *   the previous. The same goes for &quot;CANMATCH&quot; or &quot;MATCHMORE&quot;; the first such match ends the traversal. In both</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment"> *   these cases, the reason we can stop immediately, is because the first pattern match found will be the &quot;best&quot;</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment"> *   according to the sort criteria.</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment"> *   Hope the limit on stack depth won&#39;t be a problem... this routine should</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment"> *   be pretty lean as far a stack usage goes. Any non-match terminates the recursion down a branch.</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment"> *   In the above example, with the number &quot;3077549999&quot; as the pattern, the traversor could match extensions a, b and d.  All are</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment"> *   of length 10; they have total specificities of  24580, 10246, and 25090, respectively, not that this matters</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment"> *   at all. (b) wins purely because the first character &quot;3&quot; is much more specific (lower specificity) than &quot;N&quot;. I have</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment"> *   left the specificity totals in the code as an artifact; at some point, I will strip it out.</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment"> *   Just how much time this algorithm might save over a plain linear traversal over all possible patterns is unknown,</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment"> *   because it&#39;s a function of how many extensions are stored in a context. With thousands of extensions, the speedup</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment"> *   can be very noticeable. The new matching algorithm can run several hundreds of times faster, if not a thousand or</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment"> *   more times faster in extreme cases.</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment"> *   MatchCID patterns are also supported, and stored in the tree just as the extension pattern is. Thus, you</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment"> *   can have patterns in your CID field as well.</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment"> * */</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a04876a5c80405b2f4ee492bbc4777bd4"> 1064</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a04876a5c80405b2f4ee492bbc4777bd4">update_scoreboard</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d2d/structscoreboard.html">scoreboard</a> *board, <span class="keywordtype">int</span> length, <span class="keywordtype">int</span> spec, <span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">char</span> <a class="code" href="../../df/d44/app__meetme_8c.html#ae9dd6bdb4c5c0529195a03583d0d4a8d">last</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid, <span class="keywordtype">int</span> deleted, <span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../d5/da1/structnode.html">node</a>)</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;{</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;   <span class="comment">/* if this extension is marked as deleted, then skip this -- if it never shows</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">      on the scoreboard, it will never be found, nor will halt the traversal. */</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;   <span class="keywordflow">if</span> (deleted)</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;   board-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#a4de425bb2743e2e19c2e954dfe1f0bf8">total_specificity</a> = spec;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;   board-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#a411afdaaca990dd80881e20637dc44af">total_length</a> = length;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;   board-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = <a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;   board-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#a58353d0395200b159f144de279d0a9b2">last_char</a> = <a class="code" href="../../df/d44/app__meetme_8c.html#ae9dd6bdb4c5c0529195a03583d0d4a8d">last</a>;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   board-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#ae6f7c8319cca7a79bdab95ecfa8b57eb">node</a> = node;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Scoreboarding (LONGER) %s, len=%d, score=%d\n&quot;</span>, exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, length, spec);</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;}</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> log_match_char_tree(<span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../d5/da1/structnode.html">node</a>, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>)</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;{</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;   <span class="keywordtype">char</span> extenstr[40];</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *my_prefix = <a class="code" href="../../d6/d90/strings_8h.html#a7fc844c12b769ccded05e7514036e241">ast_str_alloca</a>(1024);</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;   extenstr[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;   <span class="keywordflow">if</span> (node &amp;&amp; node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>)</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      snprintf(extenstr, <span class="keyword">sizeof</span>(extenstr), <span class="stringliteral">&quot;(%p)&quot;</span>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;   <span class="keywordflow">if</span> (strlen(node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>) &gt; 1) {</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;%s[%s]:%c:%c:%d:%s%s%s\n&quot;</span>, prefix, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a> ? <span class="charliteral">&#39;Y&#39;</span>:<span class="charliteral">&#39;N&#39;</span>,</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;         node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a>? <span class="charliteral">&#39;D&#39;</span>:<span class="charliteral">&#39;-&#39;</span>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>? <span class="stringliteral">&quot;EXTEN:&quot;</span>:<span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;         node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> ? node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a> : <span class="stringliteral">&quot;&quot;</span>, extenstr);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;%s%s:%c:%c:%d:%s%s%s\n&quot;</span>, prefix, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a> ? <span class="charliteral">&#39;Y&#39;</span>:<span class="charliteral">&#39;N&#39;</span>,</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;         node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a>? <span class="charliteral">&#39;D&#39;</span>:<span class="charliteral">&#39;-&#39;</span>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>? <span class="stringliteral">&quot;EXTEN:&quot;</span>:<span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;         node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> ? node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a> : <span class="stringliteral">&quot;&quot;</span>, extenstr);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;   }</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;my_prefix, 0, <span class="stringliteral">&quot;%s+       &quot;</span>, prefix);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;   <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>)</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      log_match_char_tree(node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(my_prefix));</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;   <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>)</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      log_match_char_tree(node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>, prefix);</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;}</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a36264871dfb05b0e331f7a6f19049ab6"> 1111</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a36264871dfb05b0e331f7a6f19049ab6">cli_match_char_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *node, <span class="keywordtype">char</span> *prefix, <span class="keywordtype">int</span> fd)</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;{</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;   <span class="keywordtype">char</span> extenstr[40];</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *my_prefix = <a class="code" href="../../d6/d90/strings_8h.html#a7fc844c12b769ccded05e7514036e241">ast_str_alloca</a>(1024);</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;   extenstr[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;   <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) {</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      snprintf(extenstr, <span class="keyword">sizeof</span>(extenstr), <span class="stringliteral">&quot;(%p)&quot;</span>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;   }</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;   <span class="keywordflow">if</span> (strlen(node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>) &gt; 1) {</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s[%s]:%c:%c:%d:%s%s%s\n&quot;</span>, prefix, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a> ? <span class="charliteral">&#39;Y&#39;</span> : <span class="charliteral">&#39;N&#39;</span>,</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;         node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a> ? <span class="charliteral">&#39;D&#39;</span> : <span class="charliteral">&#39;-&#39;</span>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>? <span class="stringliteral">&quot;EXTEN:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;         node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> ? node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a> : <span class="stringliteral">&quot;&quot;</span>, extenstr);</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s%s:%c:%c:%d:%s%s%s\n&quot;</span>, prefix, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a> ? <span class="charliteral">&#39;Y&#39;</span> : <span class="charliteral">&#39;N&#39;</span>,</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;         node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a> ? <span class="charliteral">&#39;D&#39;</span> : <span class="charliteral">&#39;-&#39;</span>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>? <span class="stringliteral">&quot;EXTEN:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;         node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> ? node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a> : <span class="stringliteral">&quot;&quot;</span>, extenstr);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;   }</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;my_prefix, 0, <span class="stringliteral">&quot;%s+       &quot;</span>, prefix);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;   <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>)</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a36264871dfb05b0e331f7a6f19049ab6">cli_match_char_tree</a>(node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(my_prefix), fd);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;   <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>)</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a36264871dfb05b0e331f7a6f19049ab6">cli_match_char_tree</a>(node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>, prefix, fd);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;}</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aefee0e2a38de76a008277db39cd9e3a8"> 1141</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../db/d94/pbx_8c.html#aefee0e2a38de76a008277db39cd9e3a8">get_canmatch_exten</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *node)</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;{</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;   <span class="comment">/* find the exten at the end of the rope */</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *node2 = node;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;   <span class="keywordflow">for</span> (node2 = node; node2; node2 = node2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>) {</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="keywordflow">if</span> (node2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) {</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;CanMatch_exten returns exten %s(%p)\n&quot;</span>, node2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, node2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;         <span class="keywordflow">return</span> node2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      }</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;   }</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;CanMatch_exten returns NULL, match_char=%s\n&quot;</span>, node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;}</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae41a2e0750d89ec626fd85b4f24d1e5d"> 1160</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../db/d94/pbx_8c.html#ae41a2e0750d89ec626fd85b4f24d1e5d">trie_find_next_match</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *node)</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;{</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *m3;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *m4;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e3;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;   <span class="keywordflow">if</span> (node &amp;&amp; node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[0] == <span class="charliteral">&#39;.&#39;</span> &amp;&amp; !node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[1]) { <span class="comment">/* dot and ! will ALWAYS be next match in a matchmore */</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      <span class="keywordflow">return</span> node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;   }</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;   <span class="keywordflow">if</span> (node &amp;&amp; node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[0] == <span class="charliteral">&#39;!&#39;</span> &amp;&amp; !node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[1]) {</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      <span class="keywordflow">return</span> node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;   }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   <span class="keywordflow">if</span> (!node || !node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>) {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;   }</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;   m3 = node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;   <span class="keywordflow">if</span> (m3-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <span class="keywordflow">return</span> m3-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;   }</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;   <span class="keywordflow">for</span> (m4 = m3-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>; m4; m4 = m4-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>) {</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <span class="keywordflow">if</span> (m4-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) {</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;         <span class="keywordflow">return</span> m4-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      }</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;   }</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;   <span class="keywordflow">for</span> (m4 = m3; m4; m4 = m4-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>) {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      e3 = <a class="code" href="../../db/d94/pbx_8c.html#ae41a2e0750d89ec626fd85b4f24d1e5d">trie_find_next_match</a>(m3);</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <span class="keywordflow">if</span> (e3) {</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;         <span class="keywordflow">return</span> e3;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      }</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;}</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="preprocessor">#ifdef DEBUG_THIS</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *action2str(<span class="keyword">enum</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a> action)</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;{</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;   <span class="keywordflow">switch</span> (action) {</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a>:</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;MATCH&quot;</span>;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a>:</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;CANMATCH&quot;</span>;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>:</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;MATCHMORE&quot;</span>;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a>:</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;FINDLABEL&quot;</span>;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee">E_SPAWN</a>:</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;SPAWN&quot;</span>;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;?ACTION?&quot;</span>;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;   }</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;}</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a6f316646510338807bceef2a2c245983"> 1219</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a6f316646510338807bceef2a2c245983">candidate_exten_advance</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;{</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;   str++;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;   <span class="keywordflow">while</span> (*str == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      str++;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;   }</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;}</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ac9e926e41fa1716aac334496c1402a70"> 1228</a></span>&#160;<span class="preprocessor">#define MORE(s) (*candidate_exten_advance(s))</span></div><div class="line"><a name="l01229"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a5ff0c56a14296d1c812baa48486b013c"> 1229</a></span>&#160;<span class="preprocessor">#define ADVANCE(s) candidate_exten_advance(s)</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div><div class="line"><a name="l01231"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a2c64874adba109557bade6a7cbfd1eea"> 1231</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a2c64874adba109557bade6a7cbfd1eea">new_find_extension</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, <span class="keyword">struct</span> <a class="code" href="../../db/d2d/structscoreboard.html">scoreboard</a> *score, <span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *tree, <span class="keywordtype">int</span> length, <span class="keywordtype">int</span> spec, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid, <span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keyword">enum</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a> action)</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;{</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *p; <span class="comment">/* note minimal stack storage requirements */</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> pattern = { .<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a> = label };</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="preprocessor">#ifdef DEBUG_THIS</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;   <span class="keywordflow">if</span> (tree)</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;new_find_extension called with %s on (sub)tree %s action=%s\n&quot;</span>, str, tree-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>, action2str(action));</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;new_find_extension called with %s on (sub)tree NULL action=%s\n&quot;</span>, str, action2str(action));</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;   <span class="keywordflow">for</span> (p = tree; p; p = p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>) {</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a>) {</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[0] == <span class="charliteral">&#39;N&#39;</span>) {</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;            <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[1] == 0 &amp;&amp; *str &gt;= <span class="charliteral">&#39;2&#39;</span> &amp;&amp; *str &lt;= <span class="charliteral">&#39;9&#39;</span> ) {</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="preprocessor">#define  NEW_MATCHER_CHK_MATCH          \</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="preprocessor">               if (p-&gt;exten &amp;&amp; !MORE(str)) { </span><span class="comment">/* if a shorter pattern matches along the way, might as well report it */</span><span class="preprocessor">             \</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="preprocessor">                  if (action == E_MATCH || action == E_SPAWN || action == E_FINDLABEL) { </span><span class="comment">/* if in CANMATCH/MATCHMORE, don&#39;t let matches get in the way */</span><span class="preprocessor">   \</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="preprocessor">                     update_scoreboard(score, length + 1, spec + p-&gt;specificity, p-&gt;exten, 0, callerid, p-&gt;deleted, p);                 \</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="preprocessor">                     if (!p-&gt;deleted) {                                                                                           \</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="preprocessor">                        if (action == E_FINDLABEL) {                                                                             \</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="preprocessor">                           if (ast_hashtab_lookup(score-&gt;exten-&gt;peer_label_table, &amp;pattern)) {                                  \</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="preprocessor">                              ast_debug(4, &quot;Found label in preferred extension\n&quot;);                                            \</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="preprocessor">                              return;                                                                                          \</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="preprocessor">                           }                                                                                                    \</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="preprocessor">                        } else {                                                                                                 \</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="preprocessor">                           ast_debug(4, &quot;returning an exact match-- first found-- %s\n&quot;, p-&gt;exten-&gt;name);                       \</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="preprocessor">                           return; </span><span class="comment">/* the first match, by definition, will be the best, because of the sorted tree */</span><span class="preprocessor">           \</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="preprocessor">                        }                                                                                                        \</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="preprocessor">                     }                                                                                                            \</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="preprocessor">                  }                                                                                                                \</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="preprocessor">               }</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="preprocessor">#define  NEW_MATCHER_RECURSE             \</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="preprocessor">               if (p-&gt;next_char &amp;&amp; (MORE(str) || (p-&gt;next_char-&gt;x[0] == &#39;/&#39; &amp;&amp; p-&gt;next_char-&gt;x[1] == 0)                 \</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="preprocessor">                                             || p-&gt;next_char-&gt;x[0] == &#39;!&#39;)) {                                          \</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="preprocessor">                  if (MORE(str) || p-&gt;next_char-&gt;x[0] == &#39;!&#39;) {                                                         \</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="preprocessor">                     new_find_extension(ADVANCE(str), score, p-&gt;next_char, length + 1, spec + p-&gt;specificity, callerid, label, action); \</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="preprocessor">                     if (score-&gt;exten)  {                                                                             \</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="preprocessor">                          ast_debug(4 ,&quot;returning an exact match-- %s\n&quot;, score-&gt;exten-&gt;name);                         \</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="preprocessor">                        return; </span><span class="comment">/* the first match is all we need */</span><span class="preprocessor">                                                 \</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="preprocessor">                     }                                                                                    \</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="preprocessor">                  } else {                                                                                             \</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="preprocessor">                     new_find_extension(&quot;/&quot;, score, p-&gt;next_char, length + 1, spec + p-&gt;specificity, callerid, label, action);    \</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="preprocessor">                     if (score-&gt;exten || ((action == E_CANMATCH || action == E_MATCHMORE) &amp;&amp; score-&gt;canmatch)) {      \</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="preprocessor">                          ast_debug(4,&quot;returning a (can/more) match--- %s\n&quot;, score-&gt;exten ? score-&gt;exten-&gt;name :      \</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="preprocessor">                                     &quot;NULL&quot;);                                                                        \</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="preprocessor">                        return; </span><span class="comment">/* the first match is all we need */</span><span class="preprocessor">                                                 \</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="preprocessor">                     }                                                                                    \</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="preprocessor">                  }                                                                                                    \</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="preprocessor">               } else if ((p-&gt;next_char || action == E_CANMATCH) &amp;&amp; !MORE(str)) {                                                                  \</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="preprocessor">                  score-&gt;canmatch = 1;                                                                                 \</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="preprocessor">                  score-&gt;canmatch_exten = get_canmatch_exten(p);                                                       \</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="preprocessor">                  if (action == E_CANMATCH || action == E_MATCHMORE) {                                                 \</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="preprocessor">                       ast_debug(4, &quot;returning a canmatch/matchmore--- str=%s\n&quot;, str);                                  \</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="preprocessor">                     return;                                                                                          \</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="preprocessor">                  }                                                                                        \</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="preprocessor">               }</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#ae9a20ca55100e97d325d306500dd49bd">NEW_MATCHER_CHK_MATCH</a>;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a7825b1b6bf1206afac71bc155cff804b">NEW_MATCHER_RECURSE</a>;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;            }</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[0] == <span class="charliteral">&#39;Z&#39;</span>) {</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;            <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[1] == 0 &amp;&amp; *str &gt;= <span class="charliteral">&#39;1&#39;</span> &amp;&amp; *str &lt;= <span class="charliteral">&#39;9&#39;</span> ) {</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#ae9a20ca55100e97d325d306500dd49bd">NEW_MATCHER_CHK_MATCH</a>;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a7825b1b6bf1206afac71bc155cff804b">NEW_MATCHER_RECURSE</a>;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            }</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[0] == <span class="charliteral">&#39;X&#39;</span>) {</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;            <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[1] == 0 &amp;&amp; *str &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *str &lt;= <span class="charliteral">&#39;9&#39;</span> ) {</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#ae9a20ca55100e97d325d306500dd49bd">NEW_MATCHER_CHK_MATCH</a>;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a7825b1b6bf1206afac71bc155cff804b">NEW_MATCHER_RECURSE</a>;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            }</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[0] == <span class="charliteral">&#39;.&#39;</span> &amp;&amp; p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[1] == 0) {</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            <span class="comment">/* how many chars will the . match against? */</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            <span class="keywordtype">int</span> i = 0;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *str2 = <a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            <span class="keywordflow">while</span> (*str2 &amp;&amp; *str2 != <span class="charliteral">&#39;/&#39;</span>) {</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;               str2++;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;               i++;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            }</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> &amp;&amp; *str2 != <span class="charliteral">&#39;/&#39;</span>) {</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a04876a5c80405b2f4ee492bbc4777bd4">update_scoreboard</a>(score, length + i, spec + (i * p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a>), p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>, <span class="charliteral">&#39;.&#39;</span>, callerid, p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a>, p);</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;               <span class="keywordflow">if</span> (score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) {</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;return because scoreboard has a match with &#39;/&#39;--- %s\n&quot;</span>,</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;                     score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;                  <span class="keywordflow">return</span>; <span class="comment">/* the first match is all we need */</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;               }</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;            }</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;            <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a> &amp;&amp; p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[0] == <span class="charliteral">&#39;/&#39;</span> &amp;&amp; p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[1] == 0) {</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a2c64874adba109557bade6a7cbfd1eea">new_find_extension</a>(<span class="stringliteral">&quot;/&quot;</span>, score, p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>, length + i, spec+(p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a>*i), callerid, label, action);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;               <span class="keywordflow">if</span> (score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> || ((action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a> || action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) &amp;&amp; score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#a0cfb5b2675ee3fe3abfe9b5a7aee6329">canmatch</a>)) {</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;return because scoreboard has exact match OR &quot;</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                     <span class="stringliteral">&quot;CANMATCH/MATCHMORE &amp; canmatch set--- %s\n&quot;</span>,</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                     score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> ? score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a> : <span class="stringliteral">&quot;NULL&quot;</span>);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                  <span class="keywordflow">return</span>; <span class="comment">/* the first match is all we need */</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;               }</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;            }</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[0] == <span class="charliteral">&#39;!&#39;</span> &amp;&amp; p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[1] == 0) {</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;            <span class="comment">/* how many chars will the . match against? */</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;            <span class="keywordtype">int</span> i = 1;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *str2 = <a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;            <span class="keywordflow">while</span> (*str2 &amp;&amp; *str2 != <span class="charliteral">&#39;/&#39;</span>) {</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;               str2++;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;               i++;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;            }</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> &amp;&amp; *str2 != <span class="charliteral">&#39;/&#39;</span>) {</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a04876a5c80405b2f4ee492bbc4777bd4">update_scoreboard</a>(score, length + 1, spec + (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a> * i), p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>, <span class="charliteral">&#39;!&#39;</span>, callerid, p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a>, p);</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;               <span class="keywordflow">if</span> (score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) {</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;return because scoreboard has a &#39;!&#39; match--- %s\n&quot;</span>,</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                     score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                  <span class="keywordflow">return</span>; <span class="comment">/* the first match is all we need */</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;               }</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;            }</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;            <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a> &amp;&amp; p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[0] == <span class="charliteral">&#39;/&#39;</span> &amp;&amp; p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[1] == 0) {</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a2c64874adba109557bade6a7cbfd1eea">new_find_extension</a>(<span class="stringliteral">&quot;/&quot;</span>, score, p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>, length + i, spec + (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a> * i), callerid, label, action);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;               <span class="keywordflow">if</span> (score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> || ((action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a> || action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) &amp;&amp; score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#a0cfb5b2675ee3fe3abfe9b5a7aee6329">canmatch</a>)) {</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;return because scoreboard has exact match OR &quot;</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                     <span class="stringliteral">&quot;CANMATCH/MATCHMORE &amp; canmatch set with &#39;/&#39; and &#39;!&#39;--- %s\n&quot;</span>,</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                     score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> ? score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a> : <span class="stringliteral">&quot;NULL&quot;</span>);</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                  <span class="keywordflow">return</span>; <span class="comment">/* the first match is all we need */</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;               }</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;            }</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[0] == <span class="charliteral">&#39;/&#39;</span> &amp;&amp; p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>[1] == 0) {</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;            <span class="comment">/* the pattern in the tree includes the cid match! */</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;            <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a> &amp;&amp; callerid &amp;&amp; *callerid) {</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a2c64874adba109557bade6a7cbfd1eea">new_find_extension</a>(callerid, score, p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>, length + 1, spec, callerid, label, action);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;               <span class="keywordflow">if</span> (score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> || ((action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a> || action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) &amp;&amp; score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#a0cfb5b2675ee3fe3abfe9b5a7aee6329">canmatch</a>)) {</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;return because scoreboard has exact match OR &quot;</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                     <span class="stringliteral">&quot;CANMATCH/MATCHMORE &amp; canmatch set with &#39;/&#39;--- %s\n&quot;</span>,</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                     score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> ? score-&gt;<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a> : <span class="stringliteral">&quot;NULL&quot;</span>);</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                  <span class="keywordflow">return</span>; <span class="comment">/* the first match is all we need */</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;               }</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            }</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strchr(p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>, *str)) {</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;Nothing strange about this match\n&quot;</span>);</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#ae9a20ca55100e97d325d306500dd49bd">NEW_MATCHER_CHK_MATCH</a>;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a7825b1b6bf1206afac71bc155cff804b">NEW_MATCHER_RECURSE</a>;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;         }</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strchr(p-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>, *str)) {</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;Nothing strange about this match\n&quot;</span>);</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae9a20ca55100e97d325d306500dd49bd">NEW_MATCHER_CHK_MATCH</a>;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a7825b1b6bf1206afac71bc155cff804b">NEW_MATCHER_RECURSE</a>;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;      }</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;   }</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;return at end of func\n&quot;</span>);</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;}</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="preprocessor">#undef MORE</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="preprocessor">#undef ADVANCE</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment">/* the algorithm for forming the extension pattern tree is also a bit simple; you</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment"> * traverse all the extensions in a context, and for each char of the extension,</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment"> * you see if it exists in the tree; if it doesn&#39;t, you add it at the appropriate</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment"> * spot. What more can I say? At the end of each exten, you cap it off by adding the</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment"> * address of the extension involved. Duplicate patterns will be complained about.</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment"> * Ideally, this would be done for each context after it is created and fully</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment"> * filled. It could be done as a finishing step after extensions.conf or .ael is</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment"> * loaded, or it could be done when the first search is encountered. It should only</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment"> * have to be done once, until the next unload or reload.</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment"> * I guess forming this pattern tree would be analogous to compiling a regex. Except</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment"> * that a regex only handles 1 pattern, really. This trie holds any number</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment"> * of patterns. Well, really, it **could** be considered a single pattern,</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment"> * where the &quot;|&quot; (or) operator is allowed, I guess, in a way, sort of...</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a61b4c35e18be0d479b55e45f373725ee"> 1397</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../db/d94/pbx_8c.html#a61b4c35e18be0d479b55e45f373725ee">already_in_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *current, <span class="keywordtype">char</span> *pat, <span class="keywordtype">int</span> <a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a>)</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;{</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *t;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;   <span class="keywordflow">if</span> (!current) {</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;   }</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;   <span class="keywordflow">for</span> (t = current; t; t = t-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>) {</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      <span class="keywordflow">if</span> (is_pattern == t-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a> &amp;&amp; !strcmp(pat, t-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>)) {<span class="comment">/* uh, we may want to sort exploded [] contents to make matching easy */</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;         <span class="keywordflow">return</span> t;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      }</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;   }</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;}</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">/* The first arg is the location of the tree ptr, or the</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="comment">   address of the next_char ptr in the node, so we can mess</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">   with it, if we need to insert at the beginning of the list */</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div><div class="line"><a name="l01418"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#af16fde113e4d9557207bb21772312196"> 1418</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#af16fde113e4d9557207bb21772312196">insert_in_next_chars_alt_char_list</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> **parent_ptr, <span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *node)</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;{</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *curr, *lcurr;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;   <span class="comment">/* insert node into the tree at &quot;current&quot;, so the alt_char list from current is</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">      sorted in increasing value as you go to the leaves */</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;   <span class="keywordflow">if</span> (!(*parent_ptr)) {</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      *parent_ptr = node;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;   }</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;   <span class="keywordflow">if</span> ((*parent_ptr)-&gt;specificity &gt; node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a>) {</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      <span class="comment">/* insert at head */</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a> = (*parent_ptr);</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      *parent_ptr = node;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;   }</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;   lcurr = *parent_ptr;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;   <span class="keywordflow">for</span> (curr = (*parent_ptr)-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>; curr; curr = curr-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>) {</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      <span class="keywordflow">if</span> (curr-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a> &gt; node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a>) {</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;         node-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a> = curr;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;         lcurr-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a> = node;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      lcurr = curr;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;   }</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;   <span class="keywordflow">if</span> (!curr) {</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      lcurr-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a> = node;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;   }</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;}</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div><div class="line"><a name="l01452"></a><span class="lineno"><a class="line" href="../../da/ddf/structpattern__node.html"> 1452</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../da/ddf/structpattern__node.html">pattern_node</a> {<span class="comment"></span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="comment">   /*! Pattern node specificity */</span></div><div class="line"><a name="l01454"></a><span class="lineno"><a class="line" href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c"> 1454</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c">specif</a>;<span class="comment"></span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment">   /*! Pattern node match characters. */</span></div><div class="line"><a name="l01456"></a><span class="lineno"><a class="line" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f"> 1456</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>[256];</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;};</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div><div class="line"><a name="l01459"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae135baf3c18339a7584b0310cbf738d9"> 1459</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../db/d94/pbx_8c.html#ae135baf3c18339a7584b0310cbf738d9">add_pattern_node</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *current, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../da/ddf/structpattern__node.html">pattern_node</a> *pattern, <span class="keywordtype">int</span> <a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a>, <span class="keywordtype">int</span> already, <span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> **nextcharptr)</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;{</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *m;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;   <span class="keywordflow">if</span> (!(m = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*m) + strlen(pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>)))) {</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;   }</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;   <span class="comment">/* strcpy is safe here since we know its size and have allocated</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="comment">    * just enough space for when we allocated m</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;   strcpy(m-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a>, pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>);</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;   <span class="comment">/* the specificity scores are the same as used in the old</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment">      pattern matcher. */</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;   m-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a> = <a class="code" href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">is_pattern</a>;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;   <span class="keywordflow">if</span> (pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c">specif</a> == 1 &amp;&amp; is_pattern &amp;&amp; pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] == <span class="charliteral">&#39;N&#39;</span>) {</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      m-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a> = 0x0832;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c">specif</a> == 1 &amp;&amp; is_pattern &amp;&amp; pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] == <span class="charliteral">&#39;Z&#39;</span>) {</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      m-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a> = 0x0931;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c">specif</a> == 1 &amp;&amp; is_pattern &amp;&amp; pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] == <span class="charliteral">&#39;X&#39;</span>) {</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      m-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a> = 0x0a30;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c">specif</a> == 1 &amp;&amp; is_pattern &amp;&amp; pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] == <span class="charliteral">&#39;.&#39;</span>) {</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      m-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a> = 0x18000;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c">specif</a> == 1 &amp;&amp; is_pattern &amp;&amp; pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] == <span class="charliteral">&#39;!&#39;</span>) {</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      m-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a> = 0x28000;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      m-&gt;<a class="code" href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">specificity</a> = pattern-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c">specif</a>;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;   }</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;   <span class="keywordflow">if</span> (!con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>) {</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#af16fde113e4d9557207bb21772312196">insert_in_next_chars_alt_char_list</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>, m);</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      <span class="keywordflow">if</span> (already) { <span class="comment">/* switch to the new regime (traversing vs appending)*/</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#af16fde113e4d9557207bb21772312196">insert_in_next_chars_alt_char_list</a>(nextcharptr, m);</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#af16fde113e4d9557207bb21772312196">insert_in_next_chars_alt_char_list</a>(&amp;current-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>, m);</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      }</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;   }</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;   <span class="keywordflow">return</span> m;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;}</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment"> * \brief Extract the next exten pattern node.</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment"> * \param node Pattern node to fill.</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment"> * \param src Next source character to read.</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment"> * \param pattern TRUE if the exten is a pattern.</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment"> * \param extenbuf Original exten buffer to use in diagnostic messages.</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="comment"> * \retval Ptr to next extenbuf pos to read.</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01513"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#abae96b9af884498895aab7ec22f04e36"> 1513</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#abae96b9af884498895aab7ec22f04e36">get_pattern_node</a>(<span class="keyword">struct</span> <a class="code" href="../../da/ddf/structpattern__node.html">pattern_node</a> *node, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">int</span> pattern, <span class="keyword">const</span> <span class="keywordtype">char</span> *extenbuf)</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;{</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="preprocessor">#define INC_DST_OVERFLOW_CHECK                     \</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="preprocessor">   do {                                   \</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="preprocessor">      if (dst - node-&gt;buf &lt; sizeof(node-&gt;buf) - 1) {  \</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="preprocessor">         ++dst;                              \</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="preprocessor">      } else {                            \</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="preprocessor">         overflow = 1;                       \</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="preprocessor">      }                                   \</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="preprocessor">   } while (0)</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;   node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c">specif</a> = 0;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;   node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;   <span class="keywordflow">while</span> (*src) {</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;[&#39;</span> &amp;&amp; pattern) {</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;         <span class="keywordtype">char</span> *dst = node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *src_next;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;         <span class="keywordtype">int</span> length;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;         <span class="keywordtype">int</span> overflow = 0;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;         <span class="comment">/* get past the &#39;[&#39; */</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;         ++src;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;         <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;            <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;\\&#39;</span>) {</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;               <span class="comment">/* Escaped character. */</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;               ++src;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;               <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;[&#39;</span> || *src == <span class="charliteral">&#39;\\&#39;</span> || *src == <span class="charliteral">&#39;-&#39;</span> || *src == <span class="charliteral">&#39;]&#39;</span>) {</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                  *dst = *src++;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#af9c69ec563d1a9943f2f89706f02b7c6">INC_DST_OVERFLOW_CHECK</a>;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;               }</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;               <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../df/d44/app__meetme_8c.html#a18b6f1cf748d864dd085819a7d4e6680">first</a>;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;               <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../df/d44/app__meetme_8c.html#ae9dd6bdb4c5c0529195a03583d0d4a8d">last</a>;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;               src_next = src;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;               first = *(src_next - 1);</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;               last = *++src_next;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;               <span class="keywordflow">if</span> (last == <span class="charliteral">&#39;\\&#39;</span>) {</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                  <span class="comment">/* Escaped character. */</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;                  last = *++src_next;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;               }</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;               <span class="comment">/* Possible char range. */</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;               <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] &amp;&amp; last) {</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                  <span class="comment">/* Expand the char range. */</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                  <span class="keywordflow">while</span> (++first &lt;= last) {</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                     *dst = <a class="code" href="../../df/d44/app__meetme_8c.html#a18b6f1cf748d864dd085819a7d4e6680">first</a>;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                     <a class="code" href="../../db/d94/pbx_8c.html#af9c69ec563d1a9943f2f89706f02b7c6">INC_DST_OVERFLOW_CHECK</a>;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                  }</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                  src = src_next + 1;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                  <span class="comment">/*</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="comment">                   * There was no left or right char for the range.</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="comment">                   * It is just a &#39;-&#39;.</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="comment">                   */</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                  *dst = *src++;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#af9c69ec563d1a9943f2f89706f02b7c6">INC_DST_OVERFLOW_CHECK</a>;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;               }</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;\0&#39;</span>) {</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                  <span class="stringliteral">&quot;A matching &#39;]&#39; was not found for &#39;[&#39; in exten pattern &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                  extenbuf);</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;]&#39;</span>) {</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;               ++src;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;               *dst = *src++;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#af9c69ec563d1a9943f2f89706f02b7c6">INC_DST_OVERFLOW_CHECK</a>;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;            }</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;         }</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;         <span class="comment">/* null terminate the exploded range */</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;         *dst = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;         <span class="keywordflow">if</span> (overflow) {</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;               <span class="stringliteral">&quot;Expanded character set too large to deal with in exten pattern &#39;%s&#39;. Ignoring character set.\n&quot;</span>,</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;               extenbuf);</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;            node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;         }</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;         <span class="comment">/* Sort the characters in character set. */</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;         length = strlen(node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>);</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;         <span class="keywordflow">if</span> (!length) {</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Empty character set in exten pattern &#39;%s&#39;. Ignoring.\n&quot;</span>,</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;               extenbuf);</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;            node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;         }</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;         qsort(node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>, length, 1, <a class="code" href="../../db/d94/pbx_8c.html#a64ec6367a27dcdeb7ce0b7b614a2cc44">compare_char</a>);</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;         <span class="comment">/* Remove duplicate characters from character set. */</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;         dst = node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;         src_next = node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;         <span class="keywordflow">while</span> (*src_next++) {</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;            <span class="keywordflow">if</span> (*dst != *src_next) {</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;               *++dst = *src_next;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            }</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;         }</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;         length = strlen(node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>);</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;         length &lt;&lt;= 8;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;         node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c">specif</a> = length | (<span class="keywordtype">unsigned</span> char) node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0];</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;         <span class="comment">/* Skip dashes in all extensions. */</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;         ++src;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;         <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;\\&#39;</span>) {</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">             * XXX The escape character here does not remove any special</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">             * meaning to characters except the &#39;[&#39;, &#39;\\&#39;, and &#39;-&#39;</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">             * characters since they are special only in this function.</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] = *++src;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;            <span class="keywordflow">if</span> (!node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0]) {</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;            }</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;            node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] = *src;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;            <span class="keywordflow">if</span> (pattern) {</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;               <span class="comment">/* make sure n,x,z patterns are canonicalized to N,X,Z */</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;               <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] == <span class="charliteral">&#39;n&#39;</span>) {</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                  node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] = <span class="charliteral">&#39;N&#39;</span>;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] == <span class="charliteral">&#39;x&#39;</span>) {</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;                  node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] = <span class="charliteral">&#39;X&#39;</span>;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] == <span class="charliteral">&#39;z&#39;</span>) {</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                  node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0] = <span class="charliteral">&#39;Z&#39;</span>;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;               }</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;            }</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;         }</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;         node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;         node-&gt;<a class="code" href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c">specif</a> = 1;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;         ++src;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      }</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;   }</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;   <span class="keywordflow">return</span> src;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="preprocessor">#undef INC_DST_OVERFLOW_CHECK</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;}</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;</div><div class="line"><a name="l01657"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392"> 1657</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../db/d94/pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e1, <span class="keywordtype">int</span> findonly)</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;{</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *m1 = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *m2 = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> **m0;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *pos;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;   <span class="keywordtype">int</span> already;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;   <span class="keywordtype">int</span> pattern = 0;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;   <span class="keywordtype">int</span> idx_cur;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;   <span class="keywordtype">int</span> idx_next;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;   <span class="keywordtype">char</span> extenbuf[512];</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/ddf/structpattern__node.html">pattern_node</a> pat_node[2];</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;   <span class="keywordflow">if</span> (e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a>) {</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(extenbuf) &lt; strlen(e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>) + strlen(e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>) + 2) {</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;            <span class="stringliteral">&quot;The pattern %s/%s is too big to deal with: it will be ignored! Disaster!\n&quot;</span>,</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;            e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>);</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      }</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      sprintf(extenbuf, <span class="stringliteral">&quot;%s/%s&quot;</span>, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>);<span class="comment">/* Safe.  We just checked. */</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(extenbuf, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keyword">sizeof</span>(extenbuf));</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;   }</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Adding exten %s to tree\n&quot;</span>, extenbuf);</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;   m1 = con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>; <span class="comment">/* each pattern starts over at the root of the pattern tree */</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;   m0 = &amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;   already = 1;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;   pos = extenbuf;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;   <span class="keywordflow">if</span> (*pos == <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      pattern = 1;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;      ++pos;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;   }</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;   idx_cur = 0;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;   pos = <a class="code" href="../../db/d94/pbx_8c.html#abae96b9af884498895aab7ec22f04e36">get_pattern_node</a>(&amp;pat_node[idx_cur], pos, pattern, extenbuf);</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;   <span class="keywordflow">for</span> (; pat_node[idx_cur].<a class="code" href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[0]; idx_cur = idx_next) {</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      idx_next = (idx_cur + 1) % <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(pat_node);</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      pos = <a class="code" href="../../db/d94/pbx_8c.html#abae96b9af884498895aab7ec22f04e36">get_pattern_node</a>(&amp;pat_node[idx_next], pos, pattern, extenbuf);</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      <span class="comment">/* See about adding node to tree. */</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;      m2 = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      <span class="keywordflow">if</span> (already &amp;&amp; (m2 = <a class="code" href="../../db/d94/pbx_8c.html#a61b4c35e18be0d479b55e45f373725ee">already_in_tree</a>(m1, pat_node[idx_cur].<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, pattern))</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;         &amp;&amp; m2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>) {</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;         <span class="keywordflow">if</span> (!pat_node[idx_next].buf[0]) {</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment">             * This is the end of the pattern, but not the end of the tree.</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">             * Mark this node with the exten... a shorter pattern might win</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment">             * if the longer one doesn&#39;t match.</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;            <span class="keywordflow">if</span> (findonly) {</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;               <span class="keywordflow">return</span> m2;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;            }</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;            <span class="keywordflow">if</span> (m2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) {</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Found duplicate exten. Had %s found %s\n&quot;</span>,</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                  m2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a> ? <span class="stringliteral">&quot;(deleted/invalid)&quot;</span> : m2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;            }</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;            m2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = e1;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;            m2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a> = 0;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;         }</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;         m1 = m2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>; <span class="comment">/* m1 points to the node to compare against */</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;         m0 = &amp;m2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>; <span class="comment">/* m0 points to the ptr that points to m1 */</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">/* not already OR not m2 OR nor m2-&gt;next_char */</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;         <span class="keywordflow">if</span> (m2) {</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;            <span class="keywordflow">if</span> (findonly) {</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;               <span class="keywordflow">return</span> m2;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;            }</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;            m1 = m2; <span class="comment">/* while m0 stays the same */</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            <span class="keywordflow">if</span> (findonly) {</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;               <span class="keywordflow">return</span> m1;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;            }</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            m1 = <a class="code" href="../../db/d94/pbx_8c.html#ae135baf3c18339a7584b0310cbf738d9">add_pattern_node</a>(con, m1, &amp;pat_node[idx_cur], pattern, already, m0);</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            <span class="keywordflow">if</span> (!m1) { <span class="comment">/* m1 is the node just added */</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;               <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;            }</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;            m0 = &amp;m1-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;         }</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;         <span class="keywordflow">if</span> (!pat_node[idx_next].buf[0]) {</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            <span class="keywordflow">if</span> (m2 &amp;&amp; m2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) {</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Found duplicate exten. Had %s found %s\n&quot;</span>,</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                  m2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a> ? <span class="stringliteral">&quot;(deleted/invalid)&quot;</span> : m2-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            }</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;            m1-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a> = 0;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;            m1-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = e1;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;         }</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;         <span class="comment">/* The &#39;already&#39; variable is a mini-optimization designed to make it so that we</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">          * don&#39;t have to call already_in_tree when we know it will return false.</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;         already = 0;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      }</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;   }</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;   <span class="keywordflow">return</span> m1;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;}</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div><div class="line"><a name="l01756"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a705ac1563ea8e4c1e3f369e6ad952fda"> 1756</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a705ac1563ea8e4c1e3f369e6ad952fda">create_match_char_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con)</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;{</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d2e/structast__hashtab__iter.html">ast_hashtab_iter</a> *<a class="code" href="../../dd/d95/res__pktccops_8c.html#acc5ce172913ccabaada04d5c408dd85b">t1</a>;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e1;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;   <span class="keywordtype">int</span> biggest_bucket, resizes, numobjs, numbucks;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Creating Extension Trie for context %s(%p)\n&quot;</span>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, con);</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;   <a class="code" href="../../d6/da0/hashtab_8h.html#ae52333d2a29053dce852f8a2d35ca421">ast_hashtab_get_stats</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, &amp;biggest_bucket, &amp;resizes, &amp;numobjs, &amp;numbucks);</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;This tree has %d objects in %d bucket lists, longest list=%d objects, and has resized %d times\n&quot;</span>,</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;         numobjs, numbucks, biggest_bucket, resizes);</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;   t1 = <a class="code" href="../../d6/da0/hashtab_8h.html#a2a9c96a0ce6fd77d2858e65d7d63f7b3">ast_hashtab_start_traversal</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>);</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;   <span class="keywordflow">while</span> ((e1 = <a class="code" href="../../d6/da0/hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197">ast_hashtab_next</a>(t1))) {</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;      <span class="keywordflow">if</span> (e1-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>) {</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a>(con, e1, 0);</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Attempt to create extension with no extension name.\n&quot;</span>);</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;      }</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;   }</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;   <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(t1);</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;}</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;</div><div class="line"><a name="l01779"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3900cc7c8183ab6a7316f5dbc2b955ed"> 1779</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a3900cc7c8183ab6a7316f5dbc2b955ed">destroy_pattern_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *pattern_tree) <span class="comment">/* pattern tree is a simple binary tree, sort of, so the proper way to destroy it is... recursively! */</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;{</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;   <span class="comment">/* destroy all the alternates */</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;   <span class="keywordflow">if</span> (pattern_tree-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>) {</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a3900cc7c8183ab6a7316f5dbc2b955ed">destroy_pattern_tree</a>(pattern_tree-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a>);</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;      pattern_tree-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">alt_char</a> = 0;</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;   }</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;   <span class="comment">/* destroy all the nexts */</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;   <span class="keywordflow">if</span> (pattern_tree-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>) {</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a3900cc7c8183ab6a7316f5dbc2b955ed">destroy_pattern_tree</a>(pattern_tree-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a>);</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;      pattern_tree-&gt;<a class="code" href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">next_char</a> = 0;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;   }</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;   pattern_tree-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = 0; <span class="comment">/* never hurts to make sure there&#39;s no pointers laying around */</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pattern_tree);</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;}</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="comment"> * \brief Get the length of the exten string.</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="comment"> * \param str Exten to get length.</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="comment"> * \retval strlen of exten.</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01803"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a4d3fb293cd1b306f2dd3cffe2f914454"> 1803</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a4d3fb293cd1b306f2dd3cffe2f914454">ext_cmp_exten_strlen</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;{</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;   len = 0;</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      <span class="comment">/* Ignore &#39;-&#39; chars as eye candy fluff. */</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      <span class="keywordflow">while</span> (*str == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;         ++<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;      }</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;      <span class="keywordflow">if</span> (!*str) {</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      }</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;      ++<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;      ++<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;   }</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;}</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="comment"> * \brief Partial comparison of non-pattern extens.</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment"> * \param left Exten to compare.</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="comment"> * \param right Exten to compare.  Also matches if this string ends first.</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment"> * \retval &lt;0 if left &lt; right</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment"> * \retval =0 if left == right</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment"> * \retval &gt;0 if left &gt; right</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01833"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#af76fe5a18f586ee67571d9a95859cb87"> 1833</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#af76fe5a18f586ee67571d9a95859cb87">ext_cmp_exten_partial</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *left, <span class="keyword">const</span> <span class="keywordtype">char</span> *right)</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;{</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;   <span class="keywordtype">int</span> cmp;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;      <span class="comment">/* Ignore &#39;-&#39; chars as eye candy fluff. */</span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;      <span class="keywordflow">while</span> (*left == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;         ++left;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      }</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      <span class="keywordflow">while</span> (*right == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;         ++right;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      }</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      <span class="keywordflow">if</span> (!*right) {</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="comment">          * Right ended first for partial match or both ended at the same</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="comment">          * time for a match.</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;         cmp = 0;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      }</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;      cmp = *left - *right;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      <span class="keywordflow">if</span> (cmp) {</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;      }</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      ++left;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      ++right;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;   }</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;   <span class="keywordflow">return</span> cmp;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;}</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment"> * \brief Comparison of non-pattern extens.</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="comment"> * \param left Exten to compare.</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment"> * \param right Exten to compare.</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="comment"> * \retval &lt;0 if left &lt; right</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment"> * \retval =0 if left == right</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment"> * \retval &gt;0 if left &gt; right</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01876"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a5938783ad407af844871a22c0b282661"> 1876</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a5938783ad407af844871a22c0b282661">ext_cmp_exten</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *left, <span class="keyword">const</span> <span class="keywordtype">char</span> *right)</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;{</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;   <span class="keywordtype">int</span> cmp;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      <span class="comment">/* Ignore &#39;-&#39; chars as eye candy fluff. */</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      <span class="keywordflow">while</span> (*left == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;         ++left;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      }</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;      <span class="keywordflow">while</span> (*right == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;         ++right;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;      }</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      cmp = *left - *right;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;      <span class="keywordflow">if</span> (cmp) {</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;      }</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;      <span class="keywordflow">if</span> (!*left) {</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">          * Get here only if both strings ended at the same time.  cmp</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment">          * would be non-zero if only one string ended.</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      }</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;      ++left;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;      ++right;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;   }</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;   <span class="keywordflow">return</span> cmp;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;}</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="comment"> * Special characters used in patterns:</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="comment"> * &#39;_&#39;   underscore is the leading character of a pattern.</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment"> *    In other position it is treated as a regular char.</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment"> * &#39;-&#39; The &#39;-&#39; is a separator and ignored.  Why?  So patterns like NXX-XXX-XXXX work.</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment"> * .  one or more of any character. Only allowed at the end of</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment"> *    a pattern.</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment"> * !  zero or more of anything. Also impacts the result of CANMATCH</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment"> *    and MATCHMORE. Only allowed at the end of a pattern.</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment"> *    In the core routine, ! causes a match with a return code of 2.</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment"> *    In turn, depending on the search mode: (XXX check if it is implemented)</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="comment"> *    - E_MATCH retuns 1 (does match)</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="comment"> *    - E_MATCHMORE returns 0 (no match)</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="comment"> *    - E_CANMATCH returns 1 (does match)</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="comment"> * /  should not appear as it is considered the separator of the CID info.</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="comment"> *    XXX at the moment we may stop on this char.</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="comment"> * X Z N match ranges 0-9, 1-9, 2-9 respectively.</span></div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="comment"> * [  denotes the start of a set of character. Everything inside</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;<span class="comment"> *    is considered literally. We can have ranges a-d and individual</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="comment"> *    characters. A &#39;[&#39; and &#39;-&#39; can be considered literally if they</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="comment"> *    are just before &#39;]&#39;.</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;<span class="comment"> *    XXX currently there is no way to specify &#39;]&#39; in a range, nor \ is</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="comment"> *    considered specially.</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;<span class="comment"> * When we compare a pattern with a specific extension, all characters in the extension</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="comment"> * itself are considered literally.</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;<span class="comment"> * XXX do we want to consider space as a separator as well ?</span></div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="comment"> * XXX do we want to consider the separators in non-patterns as well ?</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="comment"> * \brief helper functions to sort extension patterns in the desired way,</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="comment"> * so that more specific patterns appear first.</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="comment"> * The function compares individual characters (or sets of), returning</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="comment"> * an int where bits 0-7 are the ASCII code of the first char in the set,</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="comment"> * bits 8-15 are the number of characters in the set, and bits 16-20 are</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment"> * for special cases.</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;<span class="comment"> * This way more specific patterns (smaller character sets) appear first.</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;<span class="comment"> * Wildcards have a special value, so that we can directly compare them to</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="comment"> * sets by subtracting the two values. In particular:</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment"> *  0x001xx     one character, character set starting with xx</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment"> *  0x0yyxx     yy characters, character set starting with xx</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="comment"> *  0x18000     &#39;.&#39; (one or more of anything)</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="comment"> *  0x28000     &#39;!&#39; (zero or more of anything)</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="comment"> *  0x30000     NUL (end of string)</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="comment"> *  0x40000     error in set.</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment"> * The pointer to the string is advanced according to needs.</span></div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;<span class="comment"> * NOTES:</span></div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;<span class="comment"> *  1. the empty set is ignored.</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment"> *  2. given that a full set has always 0 as the first element,</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="comment"> *     we could encode the special cases as 0xffXX where XX</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="comment"> *     is 1, 2, 3, 4 as used above.</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01963"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a979d84294814362e6425db722c917e79"> 1963</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a979d84294814362e6425db722c917e79">ext_cmp_pattern_pos</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> **p, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bitwise)</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;{</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="preprocessor">#define BITS_PER  8  </span><span class="comment">/* Number of bits per unit (byte). */</span><span class="preprocessor"></span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cmin;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;   <span class="keywordtype">int</span> count;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;   <span class="keywordflow">do</span> {</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;      <span class="comment">/* Get character and advance. (Ignore &#39;-&#39; chars as eye candy fluff.) */</span></div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      <span class="keywordflow">do</span> {</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;         c = *(*p)++;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;      } <span class="keywordflow">while</span> (c == <span class="charliteral">&#39;-&#39;</span>);</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;      <span class="comment">/* always return unless we have a set of chars */</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      <span class="keywordflow">switch</span> (c) {</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;         <span class="comment">/* ordinary character */</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;         bitwise[c / <a class="code" href="../../db/d94/pbx_8c.html#a475014156b36f5ceaf11af6a164b7cb3">BITS_PER</a>] = 1 &lt;&lt; ((<a class="code" href="../../db/d94/pbx_8c.html#a475014156b36f5ceaf11af6a164b7cb3">BITS_PER</a> - 1) - (c % <a class="code" href="../../db/d94/pbx_8c.html#a475014156b36f5ceaf11af6a164b7cb3">BITS_PER</a>));</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;         <span class="keywordflow">return</span> 0x0100 | <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;         <span class="comment">/* 2..9 */</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;         bitwise[6] = 0x3f;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;         bitwise[7] = 0xc0;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;         <span class="keywordflow">return</span> 0x0800 | <span class="charliteral">&#39;2&#39;</span>;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>:</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;         <span class="comment">/* 0..9 */</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;         bitwise[6] = 0xff;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;         bitwise[7] = 0xc0;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;         <span class="keywordflow">return</span> 0x0A00 | <span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;z&#39;</span>:</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;Z&#39;</span>:</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;         <span class="comment">/* 1..9 */</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;         bitwise[6] = 0x7f;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;         bitwise[7] = 0xc0;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;         <span class="keywordflow">return</span> 0x0900 | <span class="charliteral">&#39;1&#39;</span>;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;.&#39;</span>:</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;         <span class="comment">/* wildcard */</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;         <span class="keywordflow">return</span> 0x18000;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;!&#39;</span>:</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;         <span class="comment">/* earlymatch */</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;         <span class="keywordflow">return</span> 0x28000;   <span class="comment">/* less specific than &#39;.&#39; */</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;\0&#39;</span>:</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;         <span class="comment">/* empty string */</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;         *p = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;         <span class="keywordflow">return</span> 0x30000;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;[&#39;</span>:</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;         <span class="comment">/* char set */</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      }</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;      <span class="comment">/* locate end of set */</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;      end = strchr(*p, <span class="charliteral">&#39;]&#39;</span>);</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;      <span class="keywordflow">if</span> (!end) {</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Wrong usage of [] in the extension\n&quot;</span>);</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;         <span class="keywordflow">return</span> 0x40000;   <span class="comment">/* XXX make this entry go last... */</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;      }</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;      count = 0;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;      cmin = 0xFF;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      <span class="keywordflow">for</span> (; *p &lt; <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>; ++*p) {</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c1; <span class="comment">/* first char in range */</span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c2; <span class="comment">/* last char in range */</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;         c1 = (*p)[0];</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;         <span class="keywordflow">if</span> (*p + 2 &lt; end &amp;&amp; (*p)[1] == <span class="charliteral">&#39;-&#39;</span>) { <span class="comment">/* this is a range */</span></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;            c2 = (*p)[2];</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;            *p += 2;    <span class="comment">/* skip a total of 3 chars */</span></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;         } <span class="keywordflow">else</span> {        <span class="comment">/* individual character */</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;            c2 = c1;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;         }</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;         <span class="keywordflow">if</span> (c1 &lt; cmin) {</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;            cmin = c1;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;         }</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;         <span class="keywordflow">for</span> (; c1 &lt;= c2; ++c1) {</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> mask = 1 &lt;&lt; ((<a class="code" href="../../db/d94/pbx_8c.html#a475014156b36f5ceaf11af6a164b7cb3">BITS_PER</a> - 1) - (c1 % <a class="code" href="../../db/d94/pbx_8c.html#a475014156b36f5ceaf11af6a164b7cb3">BITS_PER</a>));</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment">             * Note: If two character sets score the same, the one with the</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment">             * lowest ASCII values will compare as coming first.  Must fill</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="comment">             * in most significant bits for lower ASCII values to accomplish</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="comment">             * the desired sort order.</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;            <span class="keywordflow">if</span> (!(bitwise[c1 / BITS_PER] &amp; mask)) {</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;               <span class="comment">/* Add the character to the set. */</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;               bitwise[c1 / <a class="code" href="../../db/d94/pbx_8c.html#a475014156b36f5ceaf11af6a164b7cb3">BITS_PER</a>] |= mask;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;               count += 0x100;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;            }</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;         }</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;      }</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      ++*p;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;   } <span class="keywordflow">while</span> (!count);<span class="comment">/* While the char set was empty. */</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;   <span class="keywordflow">return</span> count | cmin;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;}</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;<span class="comment"> * \brief Comparison of exten patterns.</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="comment"> * \param left Pattern to compare.</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="comment"> * \param right Pattern to compare.</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="comment"> * \retval &lt;0 if left &lt; right</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="comment"> * \retval =0 if left == right</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="comment"> * \retval &gt;0 if left &gt; right</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02078"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#adb0fea48eab9c7727401696cbd005169"> 2078</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#adb0fea48eab9c7727401696cbd005169">ext_cmp_pattern</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *left, <span class="keyword">const</span> <span class="keywordtype">char</span> *right)</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;{</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;   <span class="keywordtype">int</span> cmp;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;   <span class="keywordtype">int</span> left_pos;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;   <span class="keywordtype">int</span> right_pos;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> left_bitwise[32] = { 0, };</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> right_bitwise[32] = { 0, };</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      left_pos = <a class="code" href="../../db/d94/pbx_8c.html#a979d84294814362e6425db722c917e79">ext_cmp_pattern_pos</a>(&amp;left, left_bitwise);</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;      right_pos = <a class="code" href="../../db/d94/pbx_8c.html#a979d84294814362e6425db722c917e79">ext_cmp_pattern_pos</a>(&amp;right, right_bitwise);</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;      cmp = left_pos - right_pos;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;      <span class="keywordflow">if</span> (!cmp) {</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="comment">          * Are the character sets different, even though they score the same?</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="comment">          *</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="comment">          * Note: Must swap left and right to get the sense of the</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="comment">          * comparison correct.  Otherwise, we would need to multiply by</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="comment">          * -1 instead.</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;         cmp = memcmp(right_bitwise, left_bitwise, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(left_bitwise));</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      }</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      <span class="keywordflow">if</span> (cmp) {</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;      }</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;      <span class="keywordflow">if</span> (!left) {</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="comment">          * Get here only if both patterns ended at the same time.  cmp</span></div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;<span class="comment">          * would be non-zero if only one pattern ended.</span></div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      }</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;   }</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;   <span class="keywordflow">return</span> cmp;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;}</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<span class="comment"> * \brief Comparison of dialplan extens for sorting purposes.</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="comment"> * \param left Exten/pattern to compare.</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="comment"> * \param right Exten/pattern to compare.</span></div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="comment"> * \retval &lt;0 if left &lt; right</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="comment"> * \retval =0 if left == right</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="comment"> * \retval &gt;0 if left &gt; right</span></div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02126"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a31755abf9f213cb9559b909f71b85124"> 2126</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a31755abf9f213cb9559b909f71b85124">ext_cmp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *left, <span class="keyword">const</span> <span class="keywordtype">char</span> *right)</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;{</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;   <span class="comment">/* Make sure non-pattern extens come first. */</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;   <span class="keywordflow">if</span> (left[0] != <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;      <span class="keywordflow">if</span> (right[0] == <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;      }</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;      <span class="comment">/* Compare two non-pattern extens. */</span></div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a5938783ad407af844871a22c0b282661">ext_cmp_exten</a>(left, right);</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;   }</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;   <span class="keywordflow">if</span> (right[0] != <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;   }</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="comment">    * OK, we need full pattern sorting routine.</span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="comment">    * Skip past the underscores</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#adb0fea48eab9c7727401696cbd005169">ext_cmp_pattern</a>(left + 1, right + 1);</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;}</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div><div class="line"><a name="l02148"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a43cf2fd635776b81a4e9049e1bc5cecd"> 2148</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a43cf2fd635776b81a4e9049e1bc5cecd">ext_fluff_count</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;{</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;   <span class="keywordtype">int</span> fluff = 0;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;   <span class="keywordflow">if</span> (*exten != <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;      <span class="comment">/* not a pattern, simple check. */</span></div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      <span class="keywordflow">while</span> (*exten) {</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;         <span class="keywordflow">if</span> (*exten == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;            fluff++;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;         }</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;         exten++;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      }</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;      <span class="keywordflow">return</span> fluff;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;   }</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;   <span class="comment">/* do pattern check */</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;   <span class="keywordflow">while</span> (*exten) {</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      <span class="keywordflow">if</span> (*exten == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;         fluff++;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*exten == <span class="charliteral">&#39;[&#39;</span>) {</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;         <span class="comment">/* skip set, dashes here matter. */</span></div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;         exten = strchr(exten, <span class="charliteral">&#39;]&#39;</span>);</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;         <span class="keywordflow">if</span> (!exten) {</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;            <span class="comment">/* we&#39;ll end up warning about this later, don&#39;t spam logs */</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;            <span class="keywordflow">return</span> fluff;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;         }</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      }</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      exten++;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;   }</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;   <span class="keywordflow">return</span> fluff;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;}</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div><div class="line"><a name="l02183"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa9130cb982e3e236c465136e0637cfaa"> 2183</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aa9130cb982e3e236c465136e0637cfaa">ast_extension_cmp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a025ede890af287961d3a98d0e634a62b">b</a>)</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;{</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;   <span class="keywordtype">int</span> cmp;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;   cmp = <a class="code" href="../../db/d94/pbx_8c.html#a31755abf9f213cb9559b909f71b85124">ext_cmp</a>(a, b);</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;   <span class="keywordflow">if</span> (cmp &lt; 0) {</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;   }</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;   <span class="keywordflow">if</span> (cmp &gt; 0) {</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;   }</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;}</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;<span class="comment"> * \brief used ast_extension_{match|close}</span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="comment"> * mode is as follows:</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="comment"> * E_MATCH     success only on exact match</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;<span class="comment"> * E_MATCHMORE success only on partial match (i.e. leftover digits in pattern)</span></div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;<span class="comment"> * E_CANMATCH  either of the above.</span></div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="comment"> * \retval 0 on no-match</span></div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;<span class="comment"> * \retval 1 on match</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;<span class="comment"> * \retval 2 on early match.</span></div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;</div><div class="line"><a name="l02209"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aad00874b99ffc028615d6bfe93ae5496"> 2209</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aad00874b99ffc028615d6bfe93ae5496">_extension_match_core</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pattern, <span class="keyword">const</span> <span class="keywordtype">char</span> *data, <span class="keyword">enum</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a> mode)</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;{</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;   mode &amp;= <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea108ea5cb21cb0de3a1be976972c0a59c">E_MATCH_MASK</a>;   <span class="comment">/* only consider the relevant bits */</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;match core: pat: &#39;%s&#39;, dat: &#39;%s&#39;, mode=%d\n&quot;</span>, pattern, data, (<span class="keywordtype">int</span>)mode);</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;   <span class="keywordflow">if</span> (pattern[0] != <span class="charliteral">&#39;_&#39;</span>) { <span class="comment">/* not a pattern, try exact or partial match */</span></div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;      <span class="keywordtype">int</span> lp = <a class="code" href="../../db/d94/pbx_8c.html#a4d3fb293cd1b306f2dd3cffe2f914454">ext_cmp_exten_strlen</a>(pattern);</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;      <span class="keywordtype">int</span> ld = <a class="code" href="../../db/d94/pbx_8c.html#a4d3fb293cd1b306f2dd3cffe2f914454">ext_cmp_exten_strlen</a>(data);</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;      <span class="keywordflow">if</span> (lp &lt; ld) {    <span class="comment">/* pattern too short, cannot match */</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;return (0) - pattern too short, cannot match\n&quot;</span>);</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      }</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      <span class="comment">/* depending on the mode, accept full or partial match or both */</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <span class="keywordflow">if</span> (mode == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a>) {</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;return (!ext_cmp_exten(%s,%s) when mode== E_MATCH)\n&quot;</span>, pattern, data);</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;         <span class="keywordflow">return</span> !<a class="code" href="../../db/d94/pbx_8c.html#a5938783ad407af844871a22c0b282661">ext_cmp_exten</a>(pattern, data); <span class="comment">/* 1 on match, 0 on fail */</span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      }</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;      <span class="keywordflow">if</span> (ld == 0 || !<a class="code" href="../../db/d94/pbx_8c.html#af76fe5a18f586ee67571d9a95859cb87">ext_cmp_exten_partial</a>(pattern, data)) { <span class="comment">/* partial or full match */</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;return (mode(%d) == E_MATCHMORE ? lp(%d) &gt; ld(%d) : 1)\n&quot;</span>, mode, lp, ld);</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;         <span class="keywordflow">return</span> (mode == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) ? lp &gt; ld : 1; <span class="comment">/* XXX should consider &#39;!&#39; and &#39;/&#39; ? */</span></div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;return (0) when ld(%d) &gt; 0 &amp;&amp; pattern(%s) != data(%s)\n&quot;</span>, ld, pattern, data);</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;      }</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;   }</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;   <span class="keywordflow">if</span> (mode == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a> &amp;&amp; data[0] == <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="comment">       * XXX It is bad design that we don&#39;t know if we should be</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="comment">       * comparing data and pattern as patterns or comparing data if</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="comment">       * it conforms to pattern when the function is called.  First,</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;<span class="comment">       * assume they are both patterns.  If they don&#39;t match then try</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;<span class="comment">       * to see if data conforms to the given pattern.</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;<span class="comment">       * note: if this test is left out, then _x. will not match _x. !!!</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Comparing as patterns first. pattern:%s data:%s\n&quot;</span>, pattern, data);</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../db/d94/pbx_8c.html#adb0fea48eab9c7727401696cbd005169">ext_cmp_pattern</a>(pattern + 1, data + 1)) {</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;return (1) - pattern matches pattern\n&quot;</span>);</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;      }</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;   }</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;   ++pattern; <span class="comment">/* skip leading _ */</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="comment">    * XXX below we stop at &#39;/&#39; which is a separator for the CID info. However we should</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="comment">    * not store &#39;/&#39; in the pattern at all. When we insure it, we can remove the checks.</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;      <span class="comment">/* Ignore &#39;-&#39; chars as eye candy fluff. */</span></div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;      <span class="keywordflow">while</span> (*data == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;         ++<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>;</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;      }</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;      <span class="keywordflow">while</span> (*pattern == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;         ++pattern;</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      }</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;      <span class="keywordflow">if</span> (!*data || !*pattern || *pattern == <span class="charliteral">&#39;/&#39;</span>) {</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;      }</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;      <span class="keywordflow">switch</span> (*pattern) {</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;[&#39;</span>:   <span class="comment">/* a range */</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;         ++pattern;</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;         end = strchr(pattern, <span class="charliteral">&#39;]&#39;</span>); <span class="comment">/* XXX should deal with escapes ? */</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;         <span class="keywordflow">if</span> (!end) {</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Wrong usage of [] in the extension\n&quot;</span>);</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;            <span class="keywordflow">return</span> 0;   <span class="comment">/* unconditional failure */</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;         }</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;         <span class="keywordflow">if</span> (pattern == end) {</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;            <span class="comment">/* Ignore empty character sets. */</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;            ++pattern;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;         }</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;         <span class="keywordflow">for</span> (; pattern &lt; <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>; ++pattern) {</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;            <span class="keywordflow">if</span> (pattern+2 &lt; end &amp;&amp; pattern[1] == <span class="charliteral">&#39;-&#39;</span>) { <span class="comment">/* this is a range */</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;               <span class="keywordflow">if</span> (*data &gt;= pattern[0] &amp;&amp; *data &lt;= pattern[2])</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                  <span class="keywordflow">break</span>;   <span class="comment">/* match found */</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;               <span class="keywordflow">else</span> {</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                  pattern += 2; <span class="comment">/* skip a total of 3 chars */</span></div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                  <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;               }</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*data == pattern[0])</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;               <span class="keywordflow">break</span>;   <span class="comment">/* match found */</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;         }</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;         <span class="keywordflow">if</span> (pattern &gt;= end) {</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;return (0) when pattern&gt;=end\n&quot;</span>);</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;         }</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;         pattern = <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>; <span class="comment">/* skip and continue */</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;         <span class="keywordflow">if</span> (*data &lt; &#39;2&#39; || *data &gt; <span class="charliteral">&#39;9&#39;</span>) {</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;return (0) N is not matched\n&quot;</span>);</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;         }</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>:</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;         <span class="keywordflow">if</span> (*data &lt; &#39;0&#39; || *data &gt; <span class="charliteral">&#39;9&#39;</span>) {</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;return (0) X is not matched\n&quot;</span>);</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;         }</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;z&#39;</span>:</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;Z&#39;</span>:</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;         <span class="keywordflow">if</span> (*data &lt; &#39;1&#39; || *data &gt; <span class="charliteral">&#39;9&#39;</span>) {</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;return (0) Z is not matched\n&quot;</span>);</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;         }</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;.&#39;</span>:   <span class="comment">/* Must match, even with more digits */</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;return (1) when &#39;.&#39; is matched\n&quot;</span>);</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;!&#39;</span>:   <span class="comment">/* Early match */</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;return (2) when &#39;!&#39; is matched\n&quot;</span>);</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;         <span class="keywordflow">return</span> 2;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;         <span class="keywordflow">if</span> (*data != *pattern) {</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;return (0) when *data(%c) != *pattern(%c)\n&quot;</span>, *data, *pattern);</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;         }</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;      }</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;      ++<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>;</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;      ++pattern;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;   }</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;   <span class="keywordflow">if</span> (*data)        <span class="comment">/* data longer than pattern, no match */</span> {</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;return (0) when data longer than pattern\n&quot;</span>);</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;   }</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="comment">    * match so far, but ran off the end of data.</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="comment">    * Depending on what is next, determine match or not.</span></div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;   <span class="keywordflow">if</span> (*pattern == <span class="charliteral">&#39;\0&#39;</span> || *pattern == <span class="charliteral">&#39;/&#39;</span>) {   <span class="comment">/* exact match */</span></div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;at end, return (%d) in &#39;exact match&#39;\n&quot;</span>, (mode==<a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) ? 0 : 1);</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;      <span class="keywordflow">return</span> (mode == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) ? 0 : 1;  <span class="comment">/* this is a failure for E_MATCHMORE */</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*pattern == <span class="charliteral">&#39;!&#39;</span>)   {     <span class="comment">/* early match */</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;at end, return (2) when &#39;!&#39; is matched\n&quot;</span>);</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;      <span class="keywordflow">return</span> 2;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;   } <span class="keywordflow">else</span> {                <span class="comment">/* partial match */</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;at end, return (%d) which deps on E_MATCH\n&quot;</span>, (mode == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a>) ? 0 : 1);</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;      <span class="keywordflow">return</span> (mode == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a>) ? 0 : 1;   <span class="comment">/* this is a failure for E_MATCH */</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;   }</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;}</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="comment"> * Wrapper around _extension_match_core() to do performance measurement</span></div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;<span class="comment"> * using the profiling code.</span></div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02400"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aef34845bd9203c43797706dc4edc05d7"> 2400</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aef34845bd9203c43797706dc4edc05d7">extension_match_core</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pattern, <span class="keyword">const</span> <span class="keywordtype">char</span> *data, <span class="keyword">enum</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a> mode)</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;{</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;   <span class="keyword">static</span> <span class="keywordtype">int</span> prof_id = -2;   <span class="comment">/* marker for &#39;unallocated&#39; id */</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;   <span class="keywordflow">if</span> (prof_id == -2) {</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;      prof_id = <a class="code" href="../../db/db2/asterisk_8h.html#a075573924d385edb22dd8dedbd433256">ast_add_profile</a>(<span class="stringliteral">&quot;ext_match&quot;</span>, 0);</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;   }</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;   <a class="code" href="../../db/db2/asterisk_8h.html#a84666fa713cf20e8bc7e2d8524a10ce0">ast_mark</a>(prof_id, 1);</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;   i = <a class="code" href="../../db/d94/pbx_8c.html#aad00874b99ffc028615d6bfe93ae5496">_extension_match_core</a>(<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(pattern) ? <span class="stringliteral">&quot;&quot;</span> : pattern, <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data) ? <span class="stringliteral">&quot;&quot;</span> : data, mode);</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;   <a class="code" href="../../db/db2/asterisk_8h.html#a84666fa713cf20e8bc7e2d8524a10ce0">ast_mark</a>(prof_id, 0);</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;   <span class="keywordflow">return</span> i;</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;}</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;</div><div class="line"><a name="l02413"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a594f1f57f847b59c1d8aeef4b0e3a337"> 2413</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a594f1f57f847b59c1d8aeef4b0e3a337">ast_extension_match</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pattern, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;{</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#aef34845bd9203c43797706dc4edc05d7">extension_match_core</a>(pattern, data, <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a>);</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;}</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;</div><div class="line"><a name="l02418"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a83192a0099558f6a539fdb4e065ff99d"> 2418</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a83192a0099558f6a539fdb4e065ff99d">ast_extension_close</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *pattern, <span class="keyword">const</span> <span class="keywordtype">char</span> *data, <span class="keywordtype">int</span> needmore)</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;{</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;   <span class="keywordflow">if</span> (needmore != <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a> &amp;&amp; needmore != <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a>)</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;invalid argument %d\n&quot;</span>, needmore);</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#aef34845bd9203c43797706dc4edc05d7">extension_match_core</a>(pattern, data, needmore);</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;}</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;<span class="comment">/* This structure must remain in sync with ast_context for proper hashtab matching */</span></div><div class="line"><a name="l02426"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html"> 2426</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/da7/structfake__context.html">fake_context</a> <span class="comment">/* this struct is purely for matching in the hashtab */</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;{</div><div class="line"><a name="l02428"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#ace4e0066a5b24f84b90536e9906619f6"> 2428</a></span>&#160;   <a class="code" href="../../dc/d9e/structast__rwlock__info.html">ast_rwlock_t</a> <a class="code" href="../../d6/da7/structfake__context.html#ace4e0066a5b24f84b90536e9906619f6">lock</a>;</div><div class="line"><a name="l02429"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#a6611ebb8017b475186f83b2a62bc25d2"> 2429</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d6/da7/structfake__context.html#a6611ebb8017b475186f83b2a62bc25d2">root</a>;</div><div class="line"><a name="l02430"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3"> 2430</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *<a class="code" href="../../d6/da7/structfake__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>;</div><div class="line"><a name="l02431"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#a2fa7eba1ccec8820c766879753569da0"> 2431</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../d6/da7/structfake__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>;</div><div class="line"><a name="l02432"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#a0d9eeadf3cb7b27fdcf4f70247dceec6"> 2432</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d6/da7/structfake__context.html#a0d9eeadf3cb7b27fdcf4f70247dceec6">next</a>;</div><div class="line"><a name="l02433"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#a7a3f9cd5891da6cfbcad02109d68d85a"> 2433</a></span>&#160;   <span class="keyword">struct </span>ast_includes includes;</div><div class="line"><a name="l02434"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#a6fd496c589a16c16255323a13bc4f351"> 2434</a></span>&#160;   <span class="keyword">struct </span>ast_ignorepats ignorepats;</div><div class="line"><a name="l02435"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#a14868fadcf440d6507b4818f9c9f88e6"> 2435</a></span>&#160;   <span class="keyword">struct </span>ast_sws alts;</div><div class="line"><a name="l02436"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#aa05090666ce7a4905fe1b56b4fdd3be3"> 2436</a></span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da7/structfake__context.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a>;</div><div class="line"><a name="l02437"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#a6022c8a609170c7365fb96e83cb2df48"> 2437</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/da7/structfake__context.html#a6022c8a609170c7365fb96e83cb2df48">refcount</a>;</div><div class="line"><a name="l02438"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15"> 2438</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/da7/structfake__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15">autohints</a>;</div><div class="line"><a name="l02439"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#a34eb63008d294b713376e64bb2a7b2ef"> 2439</a></span>&#160;   <a class="code" href="../../d8/dc5/structast__mutex__info.html">ast_mutex_t</a> <a class="code" href="../../d6/da7/structfake__context.html#a34eb63008d294b713376e64bb2a7b2ef">macrolock</a>;</div><div class="line"><a name="l02440"></a><span class="lineno"><a class="line" href="../../d6/da7/structfake__context.html#a8e03167ce04350be901b028cc4cf1ce1"> 2440</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>[256];</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;};</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;</div><div class="line"><a name="l02443"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a2af2d2771e5347b18454a05dbc98e35f"> 2443</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../db/d94/pbx_8c.html#a2af2d2771e5347b18454a05dbc98e35f">ast_context_find</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>)</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;{</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/da7/structfake__context.html">fake_context</a> item;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;   <span class="keywordflow">if</span> (!name) {</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;   }</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>();</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;   <span class="keywordflow">if</span> (contexts_table) {</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(item.<a class="code" href="../../d6/da7/structfake__context.html#a8e03167ce04350be901b028cc4cf1ce1">name</a>, name, <span class="keyword">sizeof</span>(item.<a class="code" href="../../d6/da7/structfake__context.html#a8e03167ce04350be901b028cc4cf1ce1">name</a>));</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      tmp = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(contexts_table, &amp;item);</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;      tmp = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;      <span class="keywordflow">while</span> ((tmp = <a class="code" href="../../db/d94/pbx_8c.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a>(tmp))) {</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;         <span class="keywordflow">if</span> (!strcasecmp(name, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>)) {</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;         }</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;      }</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;   }</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;}</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa2d7a93c24186594d8c09e904fa17132"> 2467</a></span>&#160;<span class="preprocessor">#define STATUS_NO_CONTEXT  1</span></div><div class="line"><a name="l02468"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a53e8d9faad7e0156772e9559df5f8c2e"> 2468</a></span>&#160;<span class="preprocessor">#define STATUS_NO_EXTENSION   2</span></div><div class="line"><a name="l02469"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ab6422b4f1e9de4cb16307bd081b8706b"> 2469</a></span>&#160;<span class="preprocessor">#define STATUS_NO_PRIORITY 3</span></div><div class="line"><a name="l02470"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a5062f2413e9425755149f855577b602f"> 2470</a></span>&#160;<span class="preprocessor">#define STATUS_NO_LABEL    4</span></div><div class="line"><a name="l02471"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae56fdb340b23940f7a64ed2e37c1774a"> 2471</a></span>&#160;<span class="preprocessor">#define STATUS_SUCCESS     5</span></div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;</div><div class="line"><a name="l02473"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa387123ad981d4889f47275234042a2e"> 2473</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *cidpattern, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid)</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;{</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;   <span class="comment">/* If the Caller*ID pattern is empty, then we&#39;re matching NO Caller*ID, so</span></div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;<span class="comment">      failing to get a number should count as a match, otherwise not */</span></div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(callerid)) {</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cidpattern) ? 1 : 0;</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;   }</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a594f1f57f847b59c1d8aeef4b0e3a337">ast_extension_match</a>(cidpattern, callerid);</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;}</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;</div><div class="line"><a name="l02485"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a63e03245dc48558e55da8890b3dbb87e"> 2485</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../db/d94/pbx_8c.html#a63e03245dc48558e55da8890b3dbb87e">pbx_find_extension</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan,</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *bypass, <span class="keyword">struct</span> <a class="code" href="../../db/d81/structpbx__find__info.html">pbx_find_info</a> *q,</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority,</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid, <span class="keyword">enum</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a> action)</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;{</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;   <span class="keywordtype">int</span> x, res;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *eroot = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> pattern = {<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, };</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d2d/structscoreboard.html">scoreboard</a> score = {0, };</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *tmpdata = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;   pattern.<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a> = <a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;   pattern.<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = <a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Looking for cont/ext/prio/label/action = %s/%s/%d/%s/%d\n&quot;</span>, context, exten, priority, label, (<span class="keywordtype">int</span>) action);</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;   <span class="comment">/* Initialize status if appropriate */</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;   <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">stacklen</a> == 0) {</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;      q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="../../db/d94/pbx_8c.html#aa2d7a93c24186594d8c09e904fa17132">STATUS_NO_CONTEXT</a>;</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;      q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;      q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#ae4950db1dbfff8459a712737063b61aa">data</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;      q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">stacklen</a> &gt;= <a class="code" href="../../dd/ddb/extconf_8h.html#a05848c0de74d85dc2fb259f332d33f25">AST_PBX_MAX_STACK</a>) {</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Maximum PBX stack exceeded\n&quot;</span>);</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;   }</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;   <span class="comment">/* Check first to see if we&#39;ve already been checked */</span></div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;   <span class="keywordflow">for</span> (x = 0; x &lt; q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">stacklen</a>; x++) {</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a5316dcae577cc913943c7a2b6e00c6da">incstack</a>[x], context))</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;   }</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;   <span class="keywordflow">if</span> (bypass) { <span class="comment">/* bypass means we only look there */</span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;      tmp = bypass;</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;   } <span class="keywordflow">else</span> {      <span class="comment">/* look in contexts */</span></div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;      tmp = <a class="code" href="../../db/d94/pbx_8c.html#ae295e363d292aafe65f327e628d90dcd">find_context</a>(context);</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      <span class="keywordflow">if</span> (!tmp) {</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;      }</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;   }</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;   <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> &lt; <a class="code" href="../../db/d94/pbx_8c.html#a53e8d9faad7e0156772e9559df5f8c2e">STATUS_NO_EXTENSION</a>)</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;      q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="../../db/d94/pbx_8c.html#a53e8d9faad7e0156772e9559df5f8c2e">STATUS_NO_EXTENSION</a>;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;   <span class="comment">/* Do a search for matching extension */</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;   eroot = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;   score.<a class="code" href="../../db/d2d/structscoreboard.html#a4de425bb2743e2e19c2e954dfe1f0bf8">total_specificity</a> = 0;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;   score.<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = 0;</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;   score.<a class="code" href="../../db/d2d/structscoreboard.html#a411afdaaca990dd80881e20637dc44af">total_length</a> = 0;</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;   <span class="keywordflow">if</span> (!tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a> &amp;&amp; tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>) {</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a705ac1563ea8e4c1e3f369e6ad952fda">create_match_char_tree</a>(tmp);</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Tree Created in context %s:\n&quot;</span>, context);</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;      log_match_char_tree(tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>,<span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;   }</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG</span></div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;The Trie we are searching in:\n&quot;</span>);</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;   log_match_char_tree(tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>, <span class="stringliteral">&quot;::  &quot;</span>);</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;   <span class="keywordflow">do</span> {</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(overrideswitch)) {</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;         <span class="keywordtype">char</span> *osw = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(overrideswitch), *<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d9/df6/structast__switch.html">ast_switch</a> *asw;</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#aa170ac775ac95bf40afa9a46f4a4af8f">ast_switch_f</a> *aswf = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;         <span class="keywordtype">char</span> *datap;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;         <span class="keywordtype">int</span> eval = 0;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;         <a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;osw, <span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;         asw = <a class="code" href="../../d9/da0/pbx__private_8h.html#a8fb2c698b49514ee75942405c84ad8bd">pbx_findswitch</a>(<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;         <span class="keywordflow">if</span> (!asw) {</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No such switch &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;         }</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;         <span class="keywordflow">if</span> (osw &amp;&amp; strchr(osw, <span class="charliteral">&#39;$&#39;</span>)) {</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;            eval = 1;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;         }</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;         <span class="keywordflow">if</span> (eval &amp;&amp; !(tmpdata = <a class="code" href="../../d6/d90/strings_8h.html#afe8f5f844f2fd5f5bd5d0be5ef671481">ast_str_thread_get</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a34c5d02998c18d892113d659590cd28e">switch_data</a>, 512))) {</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&#39;t evaluate overrideswitch?!\n&quot;</span>);</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eval) {</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;            <span class="comment">/* Substitute variables now */</span></div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;            <a class="code" href="../../db/de0/pbx_8h.html#af5a13a9ab5aac5bb61e4f98ae7e8d296">pbx_substitute_variables_helper</a>(chan, osw, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(tmpdata), <a class="code" href="../../d6/d90/strings_8h.html#ae99d6f51ac4be6b72f8b63892cd949e1">ast_str_size</a>(tmpdata));</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;            datap = <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(tmpdata);</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;            datap = osw;</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;         }</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;         <span class="comment">/* equivalent of extension_match_core() at the switch level */</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;         <span class="keywordflow">if</span> (action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a>)</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;            aswf = asw-&gt;<a class="code" href="../../d9/df6/structast__switch.html#a24b6a2ef2583f8e94d5c5b4e28f1c86b">canmatch</a>;</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>)</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;            aswf = asw-&gt;<a class="code" href="../../d9/df6/structast__switch.html#aaf4e317c22482247f901b05822cdb0e1">matchmore</a>;</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;         <span class="keywordflow">else</span> <span class="comment">/* action == E_MATCH */</span></div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;            aswf = asw-&gt;<a class="code" href="../../d9/df6/structast__switch.html#a63615e359652b810a1fabf668b2cb043">exists</a>;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;         <span class="keywordflow">if</span> (!aswf) {</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;            res = 0;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;            <span class="keywordflow">if</span> (chan) {</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a7a8f6a50f3db42cb40cad7cfbd1d54f9">ast_autoservice_start</a>(chan);</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;            }</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;            res = aswf(chan, context, exten, priority, callerid, datap);</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;            <span class="keywordflow">if</span> (chan) {</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b">ast_autoservice_stop</a>(chan);</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;            }</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;         }</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;         <span class="keywordflow">if</span> (res) {  <span class="comment">/* Got a match */</span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;            q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a> = asw;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;            q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#ae4950db1dbfff8459a712737063b61aa">data</a> = datap;</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;            q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> = <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;            <span class="comment">/* XXX keep status = STATUS_NO_CONTEXT ? */</span></div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;         }</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;      }</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;   } <span class="keywordflow">while</span> (0);</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;   <span class="keywordflow">if</span> (extenpatternmatchnew) {</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a2c64874adba109557bade6a7cbfd1eea">new_find_extension</a>(exten, &amp;score, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>, 0, 0, callerid, label, action);</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;      eroot = score.<a class="code" href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>;</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;      <span class="keywordflow">if</span> (score.<a class="code" href="../../db/d2d/structscoreboard.html#a58353d0395200b159f144de279d0a9b2">last_char</a> == <span class="charliteral">&#39;!&#39;</span> &amp;&amp; action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) {</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;         <span class="comment">/* We match an extension ending in &#39;!&#39;.</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="comment">          * The decision in this case is final and is NULL (no match).</span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning MATCHMORE NULL with exclamation point.\n&quot;</span>);</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;      }</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;      <span class="keywordflow">if</span> (!eroot &amp;&amp; (action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a> || action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) &amp;&amp; score.<a class="code" href="../../db/d2d/structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>) {</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;         q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="../../db/d94/pbx_8c.html#ae56fdb340b23940f7a64ed2e37c1774a">STATUS_SUCCESS</a>;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning CANMATCH exten %s\n&quot;</span>, score.<a class="code" href="../../db/d2d/structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>);</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;         <span class="keywordflow">return</span> score.<a class="code" href="../../db/d2d/structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>;</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;      }</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;      <span class="keywordflow">if</span> ((action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a> || action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a>)  &amp;&amp; eroot) {</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;         <span class="keywordflow">if</span> (score.<a class="code" href="../../db/d2d/structscoreboard.html#ae6f7c8319cca7a79bdab95ecfa8b57eb">node</a>) {</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *z = <a class="code" href="../../db/d94/pbx_8c.html#ae41a2e0750d89ec626fd85b4f24d1e5d">trie_find_next_match</a>(score.<a class="code" href="../../db/d2d/structscoreboard.html#ae6f7c8319cca7a79bdab95ecfa8b57eb">node</a>);</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;            <span class="keywordflow">if</span> (z) {</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning CANMATCH/MATCHMORE next_match exten %s\n&quot;</span>, z-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>);</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;               <span class="keywordflow">if</span> (score.<a class="code" href="../../db/d2d/structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>) {</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning CANMATCH/MATCHMORE canmatchmatch exten %s(%p)\n&quot;</span>, score.<a class="code" href="../../db/d2d/structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, score.<a class="code" href="../../db/d2d/structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>);</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                  <span class="keywordflow">return</span> score.<a class="code" href="../../db/d2d/structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning CANMATCH/MATCHMORE next_match exten NULL\n&quot;</span>);</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;               }</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;            }</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;            <span class="keywordflow">return</span> z;</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;         }</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Returning CANMATCH/MATCHMORE NULL (no next_match)\n&quot;</span>);</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* according to the code, complete matches are null matches in MATCHMORE mode */</span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;      }</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;      <span class="keywordflow">if</span> (eroot) {</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;         <span class="comment">/* found entry, now look for the right priority */</span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;         <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> &lt; <a class="code" href="../../db/d94/pbx_8c.html#ab6422b4f1e9de4cb16307bd081b8706b">STATUS_NO_PRIORITY</a>)</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;            q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="../../db/d94/pbx_8c.html#ab6422b4f1e9de4cb16307bd081b8706b">STATUS_NO_PRIORITY</a>;</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;         e = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;         <span class="keywordflow">if</span> (action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a> &amp;&amp; label ) {</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;            <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> &lt; <a class="code" href="../../db/d94/pbx_8c.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>)</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;               q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="../../db/d94/pbx_8c.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>;</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;            e = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(eroot-&gt;peer_label_table, &amp;pattern);</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;            e = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(eroot-&gt;peer_table, &amp;pattern);</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;         }</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;         <span class="keywordflow">if</span> (e) { <span class="comment">/* found a valid match */</span></div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;            q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="../../db/d94/pbx_8c.html#ae56fdb340b23940f7a64ed2e37c1774a">STATUS_SUCCESS</a>;</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;            q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> = <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning complete match of exten %s\n&quot;</span>, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>);</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;            <span class="keywordflow">return</span> e;</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;         }</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;      }</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;   } <span class="keywordflow">else</span> {   <span class="comment">/* the old/current default exten pattern match algorithm */</span></div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;      <span class="comment">/* scan the list trying to match extension and CID */</span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;      eroot = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;      <span class="keywordflow">while</span> ( (eroot = <a class="code" href="../../db/d94/pbx_8c.html#a505ce4b1d8e816a6163f064bc27bc2d6">ast_walk_context_extensions</a>(tmp, eroot)) ) {</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;         <span class="keywordtype">int</span> <a class="code" href="../../d5/dff/chan__iax2_8c.html#a7dd0190efe1c61151a9dbab078bdb263">match</a> = <a class="code" href="../../db/d94/pbx_8c.html#aef34845bd9203c43797706dc4edc05d7">extension_match_core</a>(eroot-&gt;exten, exten, action);</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;         <span class="comment">/* 0 on fail, 1 on match, 2 on earlymatch */</span></div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;         <span class="keywordflow">if</span> (!match || (eroot-&gt;matchcid &amp;&amp; !<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a>(eroot-&gt;cidmatch, callerid)))</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;            <span class="keywordflow">continue</span>;   <span class="comment">/* keep trying */</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;         <span class="keywordflow">if</span> (match == 2 &amp;&amp; action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) {</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;            <span class="comment">/* We match an extension ending in &#39;!&#39;.</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;<span class="comment">             * The decision in this case is final and is NULL (no match).</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;         }</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;         <span class="comment">/* found entry, now look for the right priority */</span></div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;         <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> &lt; <a class="code" href="../../db/d94/pbx_8c.html#ab6422b4f1e9de4cb16307bd081b8706b">STATUS_NO_PRIORITY</a>)</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;            q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="../../db/d94/pbx_8c.html#ab6422b4f1e9de4cb16307bd081b8706b">STATUS_NO_PRIORITY</a>;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;         e = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;         <span class="keywordflow">if</span> (action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a> &amp;&amp; label ) {</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;            <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> &lt; <a class="code" href="../../db/d94/pbx_8c.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>)</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;               q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="../../db/d94/pbx_8c.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>;</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;            e = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(eroot-&gt;peer_label_table, &amp;pattern);</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;            e = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(eroot-&gt;peer_table, &amp;pattern);</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;         }</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;         <span class="keywordflow">if</span> (e) { <span class="comment">/* found a valid match */</span></div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;            q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="../../db/d94/pbx_8c.html#ae56fdb340b23940f7a64ed2e37c1774a">STATUS_SUCCESS</a>;</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;            q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> = <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;            <span class="keywordflow">return</span> e;</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;         }</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;      }</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;   }</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;   <span class="comment">/* Check alternative switches */</span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a>(tmp); idx++) {</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *sw = <a class="code" href="../../db/d94/pbx_8c.html#a0161005b7a19bc949f2c8ebbf36a46eb">ast_context_switches_get</a>(tmp, idx);</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/df6/structast__switch.html">ast_switch</a> *asw = <a class="code" href="../../d9/da0/pbx__private_8h.html#a8fb2c698b49514ee75942405c84ad8bd">pbx_findswitch</a>(<a class="code" href="../../db/de0/pbx_8h.html#aa0ebd34e8d1605aa4b6e3fadea6adfb5">ast_get_switch_name</a>(sw));</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#aa170ac775ac95bf40afa9a46f4a4af8f">ast_switch_f</a> *aswf = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *datap;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;      <span class="keywordflow">if</span> (!asw) {</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No such switch &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../db/de0/pbx_8h.html#aa0ebd34e8d1605aa4b6e3fadea6adfb5">ast_get_switch_name</a>(sw));</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;      }</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;      <span class="comment">/* Substitute variables now */</span></div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/de0/pbx_8h.html#ae87c469f677f728e1f1337abb3f22ada">ast_get_switch_eval</a>(sw)) {</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;         <span class="keywordflow">if</span> (!(tmpdata = <a class="code" href="../../d6/d90/strings_8h.html#afe8f5f844f2fd5f5bd5d0be5ef671481">ast_str_thread_get</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a34c5d02998c18d892113d659590cd28e">switch_data</a>, 512))) {</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&#39;t evaluate switch?!\n&quot;</span>);</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;         }</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#af5a13a9ab5aac5bb61e4f98ae7e8d296">pbx_substitute_variables_helper</a>(chan, <a class="code" href="../../db/de0/pbx_8h.html#ad4f9fd5bd7afc28347c808ea295233e8">ast_get_switch_data</a>(sw),</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(tmpdata), <a class="code" href="../../d6/d90/strings_8h.html#ae99d6f51ac4be6b72f8b63892cd949e1">ast_str_size</a>(tmpdata));</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;         datap = <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(tmpdata);</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;         datap = <a class="code" href="../../db/de0/pbx_8h.html#ad4f9fd5bd7afc28347c808ea295233e8">ast_get_switch_data</a>(sw);</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;      }</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;      <span class="comment">/* equivalent of extension_match_core() at the switch level */</span></div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;      <span class="keywordflow">if</span> (action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a>)</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;         aswf = asw-&gt;<a class="code" href="../../d9/df6/structast__switch.html#a24b6a2ef2583f8e94d5c5b4e28f1c86b">canmatch</a>;</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>)</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;         aswf = asw-&gt;<a class="code" href="../../d9/df6/structast__switch.html#aaf4e317c22482247f901b05822cdb0e1">matchmore</a>;</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;      <span class="keywordflow">else</span> <span class="comment">/* action == E_MATCH */</span></div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;         aswf = asw-&gt;<a class="code" href="../../d9/df6/structast__switch.html#a63615e359652b810a1fabf668b2cb043">exists</a>;</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;      <span class="keywordflow">if</span> (!aswf)</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;         res = 0;</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;         <span class="keywordflow">if</span> (chan)</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a7a8f6a50f3db42cb40cad7cfbd1d54f9">ast_autoservice_start</a>(chan);</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;         res = aswf(chan, context, exten, priority, callerid, datap);</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;         <span class="keywordflow">if</span> (chan)</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b">ast_autoservice_stop</a>(chan);</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;      }</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;      <span class="keywordflow">if</span> (res) {  <span class="comment">/* Got a match */</span></div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;         q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a> = asw;</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;         q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#ae4950db1dbfff8459a712737063b61aa">data</a> = datap;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;         q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> = <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;         <span class="comment">/* XXX keep status = STATUS_NO_CONTEXT ? */</span></div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;      }</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;   }</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;   q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a5316dcae577cc913943c7a2b6e00c6da">incstack</a>[q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">stacklen</a>++] = tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>;   <span class="comment">/* Setup the stack */</span></div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;   <span class="comment">/* Now try any includes we have in this context */</span></div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(tmp); idx++) {</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *i = <a class="code" href="../../db/d94/pbx_8c.html#afb93dec0c216cb07939fd15949baff2f">ast_context_includes_get</a>(tmp, idx);</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0e/pbx__include_8c.html#a1b847252ee7d639d3f230b11af9610d2">include_valid</a>(i)) {</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;         <span class="keywordflow">if</span> ((e = <a class="code" href="../../db/d94/pbx_8c.html#a63e03245dc48558e55da8890b3dbb87e">pbx_find_extension</a>(chan, bypass, q, <a class="code" href="../../d6/d0e/pbx__include_8c.html#aeb56ec3e261d18915d12016c1cab83f3">include_rname</a>(i), exten, priority, label, callerid, action))) {</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG_HERE</span></div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning recursive match of %s\n&quot;</span>, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>);</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;            <span class="keywordflow">return</span> e;</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;         }</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;         <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../db/d81/structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a>)</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;      }</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;   }</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;}</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;</div><div class="line"><a name="l02783"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a5f96a9ab4c6286c63c25ba5dee36c4ec"> 2783</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a5f96a9ab4c6286c63c25ba5dee36c4ec">exception_store_free</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;{</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/db2/structpbx__exception.html">pbx_exception</a> *exception = <a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de">ast_string_field_free_memory</a>(exception);</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(exception);</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;}</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;</div><div class="line"><a name="l02790"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3eef12b7f28d62e9fc68f80f1ae15569"> 2790</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a> <a class="code" href="../../db/d94/pbx_8c.html#a3eef12b7f28d62e9fc68f80f1ae15569">exception_store_info</a> = {</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;   .<a class="code" href="../../d9/dfb/structast__datastore__info.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a> = <span class="stringliteral">&quot;EXCEPTION&quot;</span>,</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;   .destroy = <a class="code" href="../../db/d94/pbx_8c.html#a5f96a9ab4c6286c63c25ba5dee36c4ec">exception_store_free</a>,</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;};</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;<span class="comment"> * \brief Set the PBX to execute the exception extension.</span></div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="comment"> * \param chan Channel to raise the exception on.</span></div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;<span class="comment"> * \param reason Reason exception is raised.</span></div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="comment"> * \param priority Dialplan priority to set.</span></div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02806"></a><span class="lineno"><a class="line" href="../../d9/da0/pbx__private_8h.html#a7621524948e1703e981c745c74c14d01"> 2806</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a7621524948e1703e981c745c74c14d01">raise_exception</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *reason, <span class="keywordtype">int</span> priority)</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;{</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *ds = <a class="code" href="../../d5/d7b/channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c">ast_channel_datastore_find</a>(chan, &amp;exception_store_info, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/db2/structpbx__exception.html">pbx_exception</a> *exception = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;   <span class="keywordflow">if</span> (!ds) {</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;      ds = <a class="code" href="../../d9/db6/datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a>(&amp;exception_store_info, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;      <span class="keywordflow">if</span> (!ds)</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;      <span class="keywordflow">if</span> (!(exception = <a class="code" href="../../d1/d0f/stringfields_8h.html#a3b64083b978bdb9d28222357acf5aff7">ast_calloc_with_stringfields</a>(1, <span class="keyword">struct</span> <a class="code" href="../../d1/db2/structpbx__exception.html">pbx_exception</a>, 128))) {</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;         <a class="code" href="../../d9/db6/datastore_8h.html#aee27286888b30c6448a9bce928040a14">ast_datastore_free</a>(ds);</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;      }</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;      ds-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a> = exception;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a1ed3e98d33d5587948a0e2ef67a81f52">ast_channel_datastore_add</a>(chan, ds);</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;   } <span class="keywordflow">else</span></div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;      exception = ds-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(exception, reason, reason);</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(exception, context, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan));</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(exception, <a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(chan));</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;   exception-&gt;<a class="code" href="../../d1/db2/structpbx__exception.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(chan);</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#afbc14f8c1eb89e675d42e8d7fe33d276">set_ext_pri</a>(chan, <span class="stringliteral">&quot;e&quot;</span>, priority);</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;}</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;</div><div class="line"><a name="l02832"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a28214486cef68144f99f63097be8a1d5"> 2832</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a28214486cef68144f99f63097be8a1d5">acf_exception_read</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">char</span> *data, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">size_t</span> buflen)</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;{</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *ds = <a class="code" href="../../d5/d7b/channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c">ast_channel_datastore_find</a>(chan, &amp;exception_store_info, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/db2/structpbx__exception.html">pbx_exception</a> *exception = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;   <span class="keywordflow">if</span> (!ds || !ds-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>)</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;   exception = ds-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;REASON&quot;</span>))</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, exception-&gt;<a class="code" href="../../d1/db2/structpbx__exception.html#af9968f5aac9a0d889c0506368ea1e649">reason</a>, buflen);</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;CONTEXT&quot;</span>))</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, exception-&gt;<a class="code" href="../../d1/db2/structpbx__exception.html#a7faec841658b88ad0cfbc684853acad3">context</a>, buflen);</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncasecmp(data, <span class="stringliteral">&quot;EXTEN&quot;</span>, 5))</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, exception-&gt;<a class="code" href="../../d1/db2/structpbx__exception.html#aaee31f4cc48985167efcd38ab252dac8">exten</a>, buflen);</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;PRIORITY&quot;</span>))</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;      snprintf(buf, buflen, <span class="stringliteral">&quot;%d&quot;</span>, exception-&gt;<a class="code" href="../../d1/db2/structpbx__exception.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>);</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;}</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;</div><div class="line"><a name="l02852"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae51d2f255e1f2ea7fb24e6033a9cba94"> 2852</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> <a class="code" href="../../db/d94/pbx_8c.html#ae51d2f255e1f2ea7fb24e6033a9cba94">exception_function</a> = {</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;   .<a class="code" href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">name</a> = <span class="stringliteral">&quot;EXCEPTION&quot;</span>,</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;   .read = <a class="code" href="../../db/d94/pbx_8c.html#a28214486cef68144f99f63097be8a1d5">acf_exception_read</a>,</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;};</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;<span class="comment"> * \brief The return value depends on the action:</span></div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;<span class="comment"> * E_MATCH, E_CANMATCH, E_MATCHMORE require a real match,</span></div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;<span class="comment"> * and return 0 on failure, -1 on match;</span></div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;<span class="comment"> * E_FINDLABEL maps the label to a priority, and returns</span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;<span class="comment"> * the priority on success, ... XXX</span></div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;<span class="comment"> * E_SPAWN, spawn an application,</span></div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;<span class="comment"> * \retval  -1 on failure.</span></div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;<span class="comment"> * \note The channel is auto-serviced in this function, because doing an extension</span></div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;<span class="comment"> * match may block for a long time.  For example, if the lookup has to use a network</span></div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;<span class="comment"> * dialplan switch, such as DUNDi or IAX2, it may take a while.  However, the channel</span></div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;<span class="comment"> * auto-service code will queue up any important signalling frames to be processed</span></div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;<span class="comment"> * after this is done.</span></div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02875"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae381d99bea85b43f022470b64171018d"> 2875</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae381d99bea85b43f022470b64171018d">pbx_extension_helper</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con,</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority,</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid, <span class="keyword">enum</span> <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a> action, <span class="keywordtype">int</span> *found, <span class="keywordtype">int</span> combined_find_spawn)</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;{</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e;</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/da3/structast__app.html">ast_app</a> *<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>;</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;   <span class="keywordtype">char</span> *substitute = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d81/structpbx__find__info.html">pbx_find_info</a> q = { .<a class="code" href="../../db/d81/structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">stacklen</a> = 0 }; <span class="comment">/* the rest is reset in pbx_find_extension */</span></div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;   <span class="keywordtype">char</span> passdata[<a class="code" href="../../db/d94/pbx_8c.html#ab07357218392804a25091a0a5d03d260">EXT_DATA_SIZE</a>];</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;   <span class="keywordtype">int</span> matching_action = (action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a> || action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a> || action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>);</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>();</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;   <span class="keywordflow">if</span> (!context) {</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;      context = con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>;</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;   }</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;   <span class="keywordflow">if</span> (found)</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;      *found = 0;</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;   e = <a class="code" href="../../db/d94/pbx_8c.html#a63e03245dc48558e55da8890b3dbb87e">pbx_find_extension</a>(c, con, &amp;q, context, exten, priority, label, callerid, action);</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;   <span class="keywordflow">if</span> (e) {</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;      <span class="keywordflow">if</span> (found)</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;         *found = 1;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      <span class="keywordflow">if</span> (matching_action) {</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;         <span class="keywordflow">return</span> -1;  <span class="comment">/* success, we found it */</span></div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a>) { <span class="comment">/* map the label to a priority */</span></div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;         <span class="keywordtype">int</span> res = e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;         <span class="comment">/* the priority we were looking for */</span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;         <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">/* spawn */</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;         <span class="keywordflow">if</span> (!e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a3f6c079e49232c7de21109f9e7f0771c">cached_app</a>)</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;            e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a3f6c079e49232c7de21109f9e7f0771c">cached_app</a> = <a class="code" href="../../db/de0/pbx_8h.html#ad4a6912dcd2ad44a186d0a284afafc51">pbx_findapp</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>);</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;         app = e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a3f6c079e49232c7de21109f9e7f0771c">cached_app</a>;</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>)) {</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;            *passdata = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;            <span class="keywordflow">if</span> ((!(tmp = strchr(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>, <span class="charliteral">&#39;$&#39;</span>))) || (!strstr(tmp, <span class="stringliteral">&quot;${&quot;</span>) &amp;&amp; !strstr(tmp, <span class="stringliteral">&quot;$[&quot;</span>))) {</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;               <span class="comment">/* no variables to substitute, copy on through */</span></div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;               <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(passdata, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>, <span class="keyword">sizeof</span>(passdata));</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;               <span class="comment">/* save e-&gt;data on stack for later processing after lock released */</span></div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;               substitute = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>);</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;            }</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;         }</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;         <span class="keywordflow">if</span> (!app) {</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No application &#39;%s&#39; for extension (%s, %s, %d)\n&quot;</span>, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, context, exten, priority);</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;         }</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c) != context)</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a>(c, context);</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c) != exten)</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a>(c, exten);</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a>(c, priority);</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;         <span class="keywordflow">if</span> (substitute) {</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;            <a class="code" href="../../db/de0/pbx_8h.html#af5a13a9ab5aac5bb61e4f98ae7e8d296">pbx_substitute_variables_helper</a>(c, substitute, passdata, <span class="keyword">sizeof</span>(passdata)-1);</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;         }</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Launching &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../dd/d16/pbx__app_8c.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a>(app));</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8c/logger_8h.html#a7d52159deec8b3179d27fcb4d39c30d2">VERBOSITY_ATLEAST</a>(3)) {</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Executing [%s@%s:%d] &quot;</span> <a class="code" href="../../db/d45/term_8h.html#ae640996bf494da50000e83e165c5453e">COLORIZE_FMT</a> <span class="stringliteral">&quot;(\&quot;&quot;</span> <a class="code" href="../../db/d45/term_8h.html#ae640996bf494da50000e83e165c5453e">COLORIZE_FMT</a> <span class="stringliteral">&quot;\&quot;, \&quot;&quot;</span> <a class="code" href="../../db/d45/term_8h.html#ae640996bf494da50000e83e165c5453e">COLORIZE_FMT</a> <span class="stringliteral">&quot;\&quot;) %s\n&quot;</span>,</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;               exten, context, priority,</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;               <a class="code" href="../../db/d45/term_8h.html#ae443185677b2d0586ded82d4fcde6992">COLORIZE</a>(<a class="code" href="../../db/d45/term_8h.html#a23aeefae76b2cacc1a6162de88c3fff0">COLOR_BRCYAN</a>, 0, <a class="code" href="../../dd/d16/pbx__app_8c.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a>(app)),</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;               <a class="code" href="../../db/d45/term_8h.html#ae443185677b2d0586ded82d4fcde6992">COLORIZE</a>(<a class="code" href="../../db/d45/term_8h.html#aee88b2ffd7fd2128fe38896cffb1a71a">COLOR_BRMAGENTA</a>, 0, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c)),</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;               <a class="code" href="../../db/d45/term_8h.html#ae443185677b2d0586ded82d4fcde6992">COLORIZE</a>(<a class="code" href="../../db/d45/term_8h.html#aee88b2ffd7fd2128fe38896cffb1a71a">COLOR_BRMAGENTA</a>, 0, passdata),</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;               <span class="stringliteral">&quot;in new stack&quot;</span>);</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;         }</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a6e3dbc57c03c23543354ef108c31fac8">pbx_exec</a>(c, app, passdata);  <span class="comment">/* 0 on success, -1 on failure */</span></div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;      }</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q.<a class="code" href="../../db/d81/structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a>) {  <span class="comment">/* not found here, but in another switch */</span></div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;      <span class="keywordflow">if</span> (found)</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;         *found = 1;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;      <span class="keywordflow">if</span> (matching_action) {</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;         <span class="keywordflow">if</span> (!q.<a class="code" href="../../db/d81/structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a>-&gt;<a class="code" href="../../d9/df6/structast__switch.html#a86796930e7a56540203d7a5ed97464c0">exec</a>) {</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No execution engine for switch %s\n&quot;</span>, q.<a class="code" href="../../db/d81/structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a>-&gt;<a class="code" href="../../d9/df6/structast__switch.html#afcd1706c9144e6d6eee6127661ae3be2">name</a>);</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;         }</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;         <span class="keywordflow">return</span> q.<a class="code" href="../../db/d81/structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a>-&gt;<a class="code" href="../../d9/df6/structast__switch.html#a86796930e7a56540203d7a5ed97464c0">exec</a>(c, q.<a class="code" href="../../db/d81/structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> ? q.<a class="code" href="../../db/d81/structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> : context, exten, priority, callerid, q.<a class="code" href="../../db/d81/structpbx__find__info.html#ae4950db1dbfff8459a712737063b61aa">data</a>);</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;      }</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;   } <span class="keywordflow">else</span> { <span class="comment">/* not found anywhere, see what happened */</span></div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;      <span class="comment">/* Using S_OR here because Solaris doesn&#39;t like NULL being passed to ast_log */</span></div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;      <span class="keywordflow">switch</span> (q.<a class="code" href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a>) {</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../db/d94/pbx_8c.html#aa2d7a93c24186594d8c09e904fa17132">STATUS_NO_CONTEXT</a>:</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;         <span class="keywordflow">if</span> (!matching_action &amp;&amp; !combined_find_spawn)</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Cannot find extension context &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(context, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../db/d94/pbx_8c.html#a53e8d9faad7e0156772e9559df5f8c2e">STATUS_NO_EXTENSION</a>:</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;         <span class="keywordflow">if</span> (!matching_action &amp;&amp; !combined_find_spawn)</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Cannot find extension &#39;%s&#39; in context &#39;%s&#39;\n&quot;</span>, exten, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(context, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../db/d94/pbx_8c.html#ab6422b4f1e9de4cb16307bd081b8706b">STATUS_NO_PRIORITY</a>:</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;         <span class="keywordflow">if</span> (!matching_action &amp;&amp; !combined_find_spawn)</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;No such priority %d in extension &#39;%s&#39; in context &#39;%s&#39;\n&quot;</span>, priority, exten, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(context, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../db/d94/pbx_8c.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>:</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;         <span class="keywordflow">if</span> (context &amp;&amp; !combined_find_spawn)</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;No such label &#39;%s&#39; in extension &#39;%s&#39; in context &#39;%s&#39;\n&quot;</span>, label, exten, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(context, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Shouldn&#39;t happen!\n&quot;</span>);</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;      }</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;      <span class="keywordflow">return</span> (matching_action) ? 0 : -1;</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;   }</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;}</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;<span class="comment">/*! \brief Find hint for given extension in context */</span></div><div class="line"><a name="l02991"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ad121506517c1a92626d906f787f17358"> 2991</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../db/d94/pbx_8c.html#ad121506517c1a92626d906f787f17358">ast_hint_extension_nolock</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;{</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d81/structpbx__find__info.html">pbx_find_info</a> q = { .<a class="code" href="../../db/d81/structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">stacklen</a> = 0 }; <span class="comment">/* the rest is set in pbx_find_context */</span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a63e03245dc48558e55da8890b3dbb87e">pbx_find_extension</a>(c, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;q, context, exten, <a class="code" href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a>);</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;}</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;</div><div class="line"><a name="l02997"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40"> 2997</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../db/d94/pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;{</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>();</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;   e = <a class="code" href="../../db/d94/pbx_8c.html#ad121506517c1a92626d906f787f17358">ast_hint_extension_nolock</a>(c, context, exten);</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;   <span class="keywordflow">return</span> e;</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;}</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;</div><div class="line"><a name="l03006"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3aa0b9f1691104cb6214ba66c5dc3a30"> 3006</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625f">ast_extension_states</a> <a class="code" href="../../db/d94/pbx_8c.html#a3aa0b9f1691104cb6214ba66c5dc3a30">ast_devstate_to_extenstate</a>(<span class="keyword">enum</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> devstate)</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;{</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;   <span class="keywordflow">switch</span> (devstate) {</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>:</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa83180bb058ded006c01229431fc887f9">AST_EXTENSION_ONHOLD</a>;</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>:</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fad62d357f0ccde2a718c374a0a4af2b98">AST_EXTENSION_BUSY</a>;</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>:</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6">AST_EXTENSION_NOT_INUSE</a>;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>:</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>:</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa5820eb407f3a3dbc5046c97ad43ee1f3">AST_EXTENSION_UNAVAILABLE</a>;</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a>:</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;      <span class="keywordflow">return</span> (<a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a">AST_EXTENSION_INUSE</a> | <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc">AST_EXTENSION_RINGING</a>);</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>:</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc">AST_EXTENSION_RINGING</a>;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>:</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a">AST_EXTENSION_INUSE</a>;</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>:</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6">AST_EXTENSION_NOT_INUSE</a>;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7">AST_DEVICE_TOTAL</a>: <span class="comment">/* not a device state, included for completeness */</span></div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;   }</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6">AST_EXTENSION_NOT_INUSE</a>;</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;}</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;<span class="comment"> * \brief Parse out the presence portion of the hint string</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03037"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a060960d62596a2f804b6b9aec11085e2"> 3037</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a060960d62596a2f804b6b9aec11085e2">parse_hint_presence</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *hint_args)</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;{</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/df4/app__voicemail_8c.html#abe15777a07ac747625b018ac01f92531">copy</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(hint_args));</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;   <span class="keywordflow">if</span> ((tmp = strrchr(copy, <span class="charliteral">&#39;,&#39;</span>))) {</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;      *tmp = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;      tmp++;</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;   }</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;hint_args, 0, <span class="stringliteral">&quot;%s&quot;</span>, tmp);</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(hint_args);</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;}</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;<span class="comment"> * \brief Parse out the device portion of the hint string</span></div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03056"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a646884fcc8a57de917abafc7a200daee"> 3056</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a646884fcc8a57de917abafc7a200daee">parse_hint_device</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *hint_args)</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;{</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/df4/app__voicemail_8c.html#abe15777a07ac747625b018ac01f92531">copy</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(hint_args));</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;   <span class="keywordflow">if</span> ((tmp = strrchr(copy, <span class="charliteral">&#39;,&#39;</span>))) {</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;      *tmp = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;   }</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;hint_args, 0, <span class="stringliteral">&quot;%s&quot;</span>, copy);</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(hint_args);</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;}</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;</div><div class="line"><a name="l03069"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ac26ad1f7944602b7367a9546e3c15950"> 3069</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#ac26ad1f7944602b7367a9546e3c15950">device_state_info_dt</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;{</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d4d/structast__device__state__info.html">ast_device_state_info</a> *<a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a> = obj;</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(info-&gt;<a class="code" href="../../dc/d4d/structast__device__state__info.html#a6c8f5142b3e33b36fdb2c3bfeecc91e6">causing_channel</a>);</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;}</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;</div><div class="line"><a name="l03076"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#af2ec29d1c72020b767d041c6d34b60b6"> 3076</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../db/d94/pbx_8c.html#af2ec29d1c72020b767d041c6d34b60b6">alloc_device_state_info</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;{</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#add41bd9979cb8642f81dd38aa2dfcd6d">ao2_container_alloc_list</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;}</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;</div><div class="line"><a name="l03081"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a35c102fc9fe7a0bc1da75ac50d0982db"> 3081</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a35c102fc9fe7a0bc1da75ac50d0982db">ast_extension_state3</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *hint_app, <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *device_state_info)</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;{</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;   <span class="keywordtype">char</span> *cur;</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;   <span class="keywordtype">char</span> *rest;</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7f/structast__devstate__aggregate.html">ast_devstate_aggregate</a> agg;</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;   <span class="comment">/* One or more devices separated with a &amp; character */</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;   rest = <a class="code" href="../../db/d94/pbx_8c.html#a646884fcc8a57de917abafc7a200daee">parse_hint_device</a>(hint_app);</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;   <a class="code" href="../../da/da2/devicestate_8h.html#a65ebe8f28497b09769ab9edeb4eb9b86">ast_devstate_aggregate_init</a>(&amp;agg);</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;   <span class="keywordflow">while</span> ((cur = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;rest, <span class="stringliteral">&quot;&amp;&quot;</span>))) {</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;      <span class="keyword">enum</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="code" href="../../d4/d88/structstate.html">state</a> = <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>(cur);</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;      <a class="code" href="../../da/da2/devicestate_8h.html#a45534707838d05125f409430b371854a">ast_devstate_aggregate_add</a>(&amp;agg, state);</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;      <span class="keywordflow">if</span> (device_state_info) {</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../dc/d4d/structast__device__state__info.html">ast_device_state_info</a> *obj;</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;         obj = <a class="code" href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a>(<span class="keyword">sizeof</span>(*obj) + strlen(cur), <a class="code" href="../../db/d94/pbx_8c.html#ac26ad1f7944602b7367a9546e3c15950">device_state_info_dt</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>);</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;         <span class="comment">/* if failed we cannot add this device */</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;         <span class="keywordflow">if</span> (obj) {</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;            obj-&gt;<a class="code" href="../../dc/d4d/structast__device__state__info.html#afe5e5e5a4f8a73f3cbf66466c8c8c00f">device_state</a> = <a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;            strcpy(obj-&gt;<a class="code" href="../../dc/d4d/structast__device__state__info.html#afb08eea322bbbb748cd19d547f7952fa">device_name</a>, cur);</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(device_state_info, obj);</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(obj, -1);</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;         }</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;      }</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;   }</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a3aa0b9f1691104cb6214ba66c5dc3a30">ast_devstate_to_extenstate</a>(<a class="code" href="../../da/da2/devicestate_8h.html#a852d7e936d4385c3bb903812de5d6403">ast_devstate_aggregate_result</a>(&amp;agg));</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;}</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;<span class="comment">/*! \brief Check state of extension by using hints */</span></div><div class="line"><a name="l03113"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a92af176ba464b63d4d13079e68933430"> 3113</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a92af176ba464b63d4d13079e68933430">ast_extension_state2</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e, <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *device_state_info)</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;{</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *hint_app = <a class="code" href="../../d6/d90/strings_8h.html#afe8f5f844f2fd5f5bd5d0be5ef671481">ast_str_thread_get</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#ac5308f5883751f800daddb3dfbdd7480">extensionstate_buf</a>, 32);</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;   <span class="keywordflow">if</span> (!e || !hint_app) {</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;   }</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;hint_app, 0, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(e));</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a35c102fc9fe7a0bc1da75ac50d0982db">ast_extension_state3</a>(hint_app, device_state_info);</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;}</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;<span class="comment">/*! \brief Return extension_state as string */</span></div><div class="line"><a name="l03126"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3261603753916b98888a5a5fc1d505c3"> 3126</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a3261603753916b98888a5a5fc1d505c3">ast_extension_state2str</a>(<span class="keywordtype">int</span> extension_state)</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;{</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;   <span class="keywordflow">for</span> (i = 0; (i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="../../db/d94/pbx_8c.html#ae9e216d31339f7268f94d2db61e0516b">extension_states</a>)); i++) {</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#ae9e216d31339f7268f94d2db61e0516b">extension_states</a>[i].extension_state == extension_state)</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#ae9e216d31339f7268f94d2db61e0516b">extension_states</a>[i].<a class="code" href="../../d3/dd9/structcfextension__states.html#aecfd3170c3d94608e5e5c038085fdf3f">text</a>;</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;   }</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;   <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;}</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;<span class="comment"> * \brief Check extension state for an extension by using hint</span></div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03141"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a0a6f83665eedc32f9f6d63033685f868"> 3141</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a0a6f83665eedc32f9f6d63033685f868">internal_extension_state_extended</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *device_state_info)</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;{</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e;</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;   <span class="keywordflow">if</span> (!(e = <a class="code" href="../../db/d94/pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(c, context, exten))) {  <span class="comment">/* Do we have a hint for this extension ? */</span></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;      <span class="keywordflow">return</span> -1;                   <span class="comment">/* No hint, return -1 */</span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;   }</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>[0] == <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;      <span class="comment">/* Create this hint on-the-fly, we explicitly lock hints here to ensure the</span></div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;<span class="comment">       * same locking order as if this were done through configuration file - that is</span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;<span class="comment">       * hints is locked first and then (if needed) contexts is locked</span></div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hints);</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a07176e8d314eb68b3b50279fafa11390">ast_add_extension</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">parent</a>-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, 0, exten, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>,</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;         e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> ? e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>), <a class="code" href="../../d8/d8a/astmm_8h.html#ad42ab843b767e8b57162c10a158b75c3">ast_free_ptr</a>,</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;         e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;      <span class="keywordflow">if</span> (!(e = <a class="code" href="../../db/d94/pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(c, context, exten))) {</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;         <span class="comment">/* Improbable, but not impossible */</span></div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;      }</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;   }</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a92af176ba464b63d4d13079e68933430">ast_extension_state2</a>(e, device_state_info);  <span class="comment">/* Check all devices in the hint */</span></div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;}</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;<span class="comment">/*! \brief Check extension state for an extension by using hint */</span></div><div class="line"><a name="l03170"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aed6cfe76441ef995ab80609020a9990c"> 3170</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aed6cfe76441ef995ab80609020a9990c">ast_extension_state</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;{</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a0a6f83665eedc32f9f6d63033685f868">internal_extension_state_extended</a>(c, context, exten, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;}</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;<span class="comment">/*! \brief Check extended extension state for an extension by using hint */</span></div><div class="line"><a name="l03176"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#af8449d33004759f52932db7e138c0246"> 3176</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#af8449d33004759f52932db7e138c0246">ast_extension_state_extended</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> **device_state_info)</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;{</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">container</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;   <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;   <span class="keywordflow">if</span> (device_state_info) {</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;      container = <a class="code" href="../../db/d94/pbx_8c.html#af2ec29d1c72020b767d041c6d34b60b6">alloc_device_state_info</a>();</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;   }</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;   ret = <a class="code" href="../../db/d94/pbx_8c.html#a0a6f83665eedc32f9f6d63033685f868">internal_extension_state_extended</a>(c, context, exten, container);</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;   <span class="keywordflow">if</span> (ret &lt; 0 &amp;&amp; container) {</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(container, -1);</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;      container = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;   }</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;   <span class="keywordflow">if</span> (device_state_info) {</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#af26f77a23357ab9f51e6080911400d96">get_device_state_causing_channels</a>(container);</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;      *device_state_info = <a class="code" href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">container</a>;</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;   }</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;}</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;</div><div class="line"><a name="l03200"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#abf4ec36d94c7f4b99cb3cd4a0bb51111"> 3200</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#abf4ec36d94c7f4b99cb3cd4a0bb51111">extension_presence_state_helper</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e, <span class="keywordtype">char</span> **subtype, <span class="keywordtype">char</span> **<a class="code" href="../../d8/d9e/structmessage.html">message</a>)</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;{</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *hint_app = <a class="code" href="../../d6/d90/strings_8h.html#afe8f5f844f2fd5f5bd5d0be5ef671481">ast_str_thread_get</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#ac5308f5883751f800daddb3dfbdd7480">extensionstate_buf</a>, 32);</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;   <span class="keywordtype">char</span> *presence_provider;</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>;</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;   <span class="keywordflow">if</span> (!e || !hint_app) {</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;   }</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;   app = <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(e);</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(app)) {</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;   }</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;hint_app, 0, <span class="stringliteral">&quot;%s&quot;</span>, app);</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;   presence_provider = <a class="code" href="../../db/d94/pbx_8c.html#a060960d62596a2f804b6b9aec11085e2">parse_hint_presence</a>(hint_app);</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(presence_provider)) {</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;      <span class="comment">/* No presence string in the hint */</span></div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;   }</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/dd7/presencestate_8h.html#ac3452f41c7982c84ca27ecf7b4cc7ce1">ast_presence_state</a>(presence_provider, subtype, message);</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;}</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;</div><div class="line"><a name="l03226"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a0a1d79f17ab4af99009246a130eff8ef"> 3226</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a0a1d79f17ab4af99009246a130eff8ef">ast_hint_presence_state</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">char</span> **subtype, <span class="keywordtype">char</span> **<a class="code" href="../../d8/d9e/structmessage.html">message</a>)</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;{</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e;</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;   <span class="keywordflow">if</span> (!(e = <a class="code" href="../../db/d94/pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(c, context, exten))) {  <span class="comment">/* Do we have a hint for this extension ? */</span></div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;      <span class="keywordflow">return</span> -1;                   <span class="comment">/* No hint, return -1 */</span></div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;   }</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>[0] == <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;      <span class="comment">/* Create this hint on-the-fly */</span></div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hints);</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a07176e8d314eb68b3b50279fafa11390">ast_add_extension</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">parent</a>-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, 0, exten, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>,</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;         e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> ? e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>), <a class="code" href="../../d8/d8a/astmm_8h.html#ad42ab843b767e8b57162c10a158b75c3">ast_free_ptr</a>,</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;         e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;      <span class="keywordflow">if</span> (!(e = <a class="code" href="../../db/d94/pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(c, context, exten))) {</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;         <span class="comment">/* Improbable, but not impossible */</span></div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;      }</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;   }</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#abf4ec36d94c7f4b99cb3cd4a0bb51111">extension_presence_state_helper</a>(e, subtype, message);</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;}</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;</div><div class="line"><a name="l03250"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a5a034ba4312a7a7fcf3f3600548427d6"> 3250</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a5a034ba4312a7a7fcf3f3600548427d6">execute_state_callback</a>(<a class="code" href="../../db/de0/pbx_8h.html#a2c6cd56c75fb925c726e1f400024f856">ast_state_cb_type</a> cb,</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *context,</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;   <span class="keywordtype">void</span> *data,</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6">ast_state_cb_update_reason</a> reason,</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint,</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *device_state_info)</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;{</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d4c/structast__state__cb__info.html">ast_state_cb_info</a> info = { 0, };</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;   info.<a class="code" href="../../df/d4c/structast__state__cb__info.html#a3a7a902ef9b30b78b595eeee1485090f">reason</a> = <a class="code" href="../../df/d4c/structast__state__cb__info.html#a3a7a902ef9b30b78b595eeee1485090f">reason</a>;</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;   <span class="comment">/* Copy over current hint data */</span></div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;   <span class="keywordflow">if</span> (hint) {</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;      info.<a class="code" href="../../df/d4c/structast__state__cb__info.html#a6f3d8aa9a90b701e81dad4cc4a56be67">exten_state</a> = hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a>;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;      info.<a class="code" href="../../df/d4c/structast__state__cb__info.html#aa8966b13201b435c8506b79e7ae972b5">device_state_info</a> = <a class="code" href="../../df/d4c/structast__state__cb__info.html#aa8966b13201b435c8506b79e7ae972b5">device_state_info</a>;</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;      info.<a class="code" href="../../df/d4c/structast__state__cb__info.html#adbd2034543f941d4cf84f129faee9a0b">presence_state</a> = hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a>;</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;      <span class="keywordflow">if</span> (!(<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a>))) {</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;         info.<a class="code" href="../../df/d4c/structast__state__cb__info.html#a662bbfb7890c12ee79a4ef1ea5f42a0c">presence_subtype</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a>);</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;         info.<a class="code" href="../../df/d4c/structast__state__cb__info.html#a662bbfb7890c12ee79a4ef1ea5f42a0c">presence_subtype</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;      }</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;      <span class="keywordflow">if</span> (!(<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a>))) {</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;         info.<a class="code" href="../../df/d4c/structast__state__cb__info.html#afb0bd6506905ab8d17df1d8bb3294fc5">presence_message</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a>);</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;         info.<a class="code" href="../../df/d4c/structast__state__cb__info.html#afb0bd6506905ab8d17df1d8bb3294fc5">presence_message</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;      }</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;      info.<a class="code" href="../../df/d4c/structast__state__cb__info.html#a6f3d8aa9a90b701e81dad4cc4a56be67">exten_state</a> = <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa3e2a2f5572580f74e94b6d5e80261ea7">AST_EXTENSION_REMOVED</a>;</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;   }</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;   res = cb(context, exten, &amp;info, data);</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;}</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;<span class="comment"> * /internal</span></div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;<span class="comment"> * /brief Identify a channel for every device which is supposedly responsible for the device state.</span></div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;<span class="comment"> * Especially when the device is ringing, the oldest ringing channel is chosen.</span></div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;<span class="comment"> * For all other cases the first encountered channel in the specific state is chosen.</span></div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03296"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#af26f77a23357ab9f51e6080911400d96"> 3296</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#af26f77a23357ab9f51e6080911400d96">get_device_state_causing_channels</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>)</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;{</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> iter;</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d4d/structast__device__state__info.html">ast_device_state_info</a> *<a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>;</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan;</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;   <span class="keywordflow">if</span> (!c || !<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(c)) {</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;   }</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;   iter = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(c, 0);</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;   <span class="keywordflow">for</span> (; (info = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;iter)); <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(info, -1)) {</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;      <span class="keyword">enum</span> <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a> search_state = 0; <span class="comment">/* prevent false uninit warning */</span></div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="../../d5/dff/chan__iax2_8c.html#a7dd0190efe1c61151a9dbab078bdb263">match</a>[<a class="code" href="../../d5/d7b/channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>];</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/d97/structast__channel__iterator.html">ast_channel_iterator</a> *chan_iter;</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;      <span class="keyword">struct </span>timeval chantime = {0, }; <span class="comment">/* prevent false uninit warning */</span></div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;      <span class="keywordflow">switch</span> (info-&gt;<a class="code" href="../../dc/d4d/structast__device__state__info.html#afe5e5e5a4f8a73f3cbf66466c8c8c00f">device_state</a>) {</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>:</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a>:</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;         <span class="comment">/* find ringing channel */</span></div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;         search_state = <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>;</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>:</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;         <span class="comment">/* find busy channel */</span></div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;         search_state = <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591">AST_STATE_BUSY</a>;</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>:</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>:</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;         <span class="comment">/* find up channel */</span></div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;         search_state = <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>;</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>:</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>:</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>:</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>:</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7">AST_DEVICE_TOTAL</a> <span class="comment">/* not a state */</span>:</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;         <span class="comment">/* no channels are of interest */</span></div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;      }</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;      <span class="comment">/* iterate over all channels of the device */</span></div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;           snprintf(match, <span class="keyword">sizeof</span>(match), <span class="stringliteral">&quot;%s-&quot;</span>, info-&gt;<a class="code" href="../../dc/d4d/structast__device__state__info.html#afb08eea322bbbb748cd19d547f7952fa">device_name</a>);</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;      chan_iter = <a class="code" href="../../d5/d7b/channel_8h.html#a129d99e9bb9aafd0f073df357975cb66">ast_channel_iterator_by_name_new</a>(match, strlen(match));</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;      <span class="keywordflow">for</span> (; (chan = <a class="code" href="../../d5/d7b/channel_8h.html#ab0eadbfdcbdad2c0e8927900ec9b98d5">ast_channel_iterator_next</a>(chan_iter)); <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(chan)) {</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;         <span class="comment">/* this channel&#39;s state doesn&#39;t match */</span></div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;         <span class="keywordflow">if</span> (search_state != <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(chan)) {</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;         }</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;         <span class="comment">/* any non-ringing channel will fit */</span></div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;         <span class="keywordflow">if</span> (search_state != <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>) {</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;            info-&gt;<a class="code" href="../../dc/d4d/structast__device__state__info.html#a6c8f5142b3e33b36fdb2c3bfeecc91e6">causing_channel</a> = chan; <span class="comment">/* is kept ref&#39;d! */</span></div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;         }</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;         <span class="comment">/* but we need the oldest ringing channel of the device to match with undirected pickup */</span></div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;         <span class="keywordflow">if</span> (!info-&gt;<a class="code" href="../../dc/d4d/structast__device__state__info.html#a6c8f5142b3e33b36fdb2c3bfeecc91e6">causing_channel</a>) {</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;            chantime = <a class="code" href="../../d5/d7b/channel_8h.html#a8873859a4dbc3d0d053d696667e49012">ast_channel_creationtime</a>(chan);</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a>(chan); <span class="comment">/* must ref it! */</span></div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;            info-&gt;<a class="code" href="../../dc/d4d/structast__device__state__info.html#a6c8f5142b3e33b36fdb2c3bfeecc91e6">causing_channel</a> = chan;</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a8873859a4dbc3d0d053d696667e49012">ast_channel_creationtime</a>(chan), chantime) &lt; 0) {</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;            chantime = <a class="code" href="../../d5/d7b/channel_8h.html#a8873859a4dbc3d0d053d696667e49012">ast_channel_creationtime</a>(chan);</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(info-&gt;<a class="code" href="../../dc/d4d/structast__device__state__info.html#a6c8f5142b3e33b36fdb2c3bfeecc91e6">causing_channel</a>);</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a>(chan); <span class="comment">/* must ref it! */</span></div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;            info-&gt;<a class="code" href="../../dc/d4d/structast__device__state__info.html#a6c8f5142b3e33b36fdb2c3bfeecc91e6">causing_channel</a> = chan;</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;         }</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;      }</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a256993c64e12e420aa141c07363db3ef">ast_channel_iterator_destroy</a>(chan_iter);</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;   }</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;iter);</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;}</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;</div><div class="line"><a name="l03370"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a24d50f6db8148f22eb4783ff0999d7bc"> 3370</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a24d50f6db8148f22eb4783ff0999d7bc">device_state_notify_callbacks</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint, <span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **hint_app)</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;{</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> cb_iter;</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *state_cb;</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;   <span class="keywordtype">int</span> same_state;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *device_state_info;</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;   <span class="keywordtype">int</span> first_extended_cb_call = 1;</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/dcf/func__periodic__hook_8c.html#ab32539883094fa1c8103ce4b6ec197c2">context_name</a>[<a class="code" href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/dcf/func__periodic__hook_8c.html#a364919046cab7e688f81979a59e46226">exten_name</a>[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;   <span class="keywordflow">if</span> (!hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>) {</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;      <span class="comment">/* The extension has already been destroyed */</span></div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;   }</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;<span class="comment">    * Save off strings in case the hint extension gets destroyed</span></div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;<span class="comment">    * while we are notifying the watchers.</span></div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(context_name,</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<a class="code" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>)),</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;         <span class="keyword">sizeof</span>(context_name));</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(exten_name, <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>),</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;         <span class="keyword">sizeof</span>(exten_name));</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(hint_app, 0, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>));</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;<span class="comment">    * Get device state for this hint.</span></div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;<span class="comment">    * NOTE: We cannot hold any locks while determining the hint</span></div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;<span class="comment">    * device state or notifying the watchers without causing a</span></div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;<span class="comment">    * deadlock.  (conlock, hints, and hint)</span></div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;   <span class="comment">/* Make a container so state3 can fill it if we wish.</span></div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;<span class="comment">    * If that failed we simply do not provide the extended state info.</span></div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;   device_state_info = <a class="code" href="../../db/d94/pbx_8c.html#af2ec29d1c72020b767d041c6d34b60b6">alloc_device_state_info</a>();</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;   state = <a class="code" href="../../db/d94/pbx_8c.html#a35c102fc9fe7a0bc1da75ac50d0982db">ast_extension_state3</a>(*hint_app, device_state_info);</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;   same_state = state == hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a>;</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;   <span class="keywordflow">if</span> (same_state &amp;&amp; (~state &amp; <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc">AST_EXTENSION_RINGING</a>)) {</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(device_state_info);</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;   }</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;   <span class="comment">/* Device state changed since last check - notify the watchers. */</span></div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;   hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a> = <a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;   <span class="comment">/* record we saw the change */</span></div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;   <span class="comment">/* For general callbacks */</span></div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;   <span class="keywordflow">if</span> (!same_state) {</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;      cb_iter = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(statecbs, 0);</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;      <span class="keywordflow">for</span> (; (state_cb = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;cb_iter)); <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(state_cb, -1)) {</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a5a034ba4312a7a7fcf3f3600548427d6">execute_state_callback</a>(state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a>,</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;            context_name,</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;            exten_name,</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;            state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>,</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;            <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a2e89bd60b1752d920f58a70164607189">AST_HINT_UPDATE_DEVICE</a>,</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;            hint,</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;            <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;      }</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;cb_iter);</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;   }</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;   <span class="comment">/* For extension callbacks */</span></div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;   <span class="comment">/* extended callbacks are called when the state changed or when AST_STATE_RINGING is</span></div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;<span class="comment">    * included. Normal callbacks are only called when the state changed.</span></div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;   cb_iter = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>, 0);</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;   <span class="keywordflow">for</span> (; (state_cb = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;cb_iter)); <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(state_cb, -1)) {</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;      <span class="keywordflow">if</span> (state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a46aefd6d3d8d80a5a7fa3c2c25d2638d">extended</a> &amp;&amp; first_extended_cb_call) {</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;         <span class="comment">/* Fill detailed device_state_info now that we know it is used by extd. callback */</span></div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;         first_extended_cb_call = 0;</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#af26f77a23357ab9f51e6080911400d96">get_device_state_causing_channels</a>(device_state_info);</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;      }</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;      <span class="keywordflow">if</span> (state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a46aefd6d3d8d80a5a7fa3c2c25d2638d">extended</a> || !same_state) {</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a5a034ba4312a7a7fcf3f3600548427d6">execute_state_callback</a>(state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a>,</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;            context_name,</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;            exten_name,</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;            state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>,</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;            <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a2e89bd60b1752d920f58a70164607189">AST_HINT_UPDATE_DEVICE</a>,</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;            hint,</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;            state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a46aefd6d3d8d80a5a7fa3c2c25d2638d">extended</a> ? device_state_info : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;      }</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;   }</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;cb_iter);</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(device_state_info);</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;}</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;</div><div class="line"><a name="l03464"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aae5642e93e1996051e684bfbc3b3ab08"> 3464</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#aae5642e93e1996051e684bfbc3b3ab08">presence_state_notify_callbacks</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint, <span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **hint_app,</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;                   <span class="keyword">struct</span> <a class="code" href="../../d2/db9/structast__presence__state__message.html">ast_presence_state_message</a> *presence_state)</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;{</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> cb_iter;</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *state_cb;</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/dcf/func__periodic__hook_8c.html#ab32539883094fa1c8103ce4b6ec197c2">context_name</a>[<a class="code" href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/dcf/func__periodic__hook_8c.html#a364919046cab7e688f81979a59e46226">exten_name</a>[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;   <span class="keywordflow">if</span> (!hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>) {</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;      <span class="comment">/* The extension has already been destroyed */</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;   }</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;<span class="comment">    * Save off strings in case the hint extension gets destroyed</span></div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;<span class="comment">    * while we are notifying the watchers.</span></div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(context_name,</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<a class="code" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>)),</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;         <span class="keyword">sizeof</span>(context_name));</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(exten_name, <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>),</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;         <span class="keyword">sizeof</span>(exten_name));</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(hint_app, 0, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>));</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;   <span class="comment">/* Check to see if update is necessary */</span></div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;   <span class="keywordflow">if</span> ((hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a> == presence_state-&gt;<a class="code" href="../../d2/db9/structast__presence__state__message.html#a7d81246f8d6e05037a34bceb9b722e43">state</a>) &amp;&amp;</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;       ((hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a> &amp;&amp; presence_state-&gt;subtype &amp;&amp;</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;         !strcmp(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a>, presence_state-&gt;subtype)) ||</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;        (!hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a> &amp;&amp; !presence_state-&gt;subtype)) &amp;&amp;</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;       ((hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a> &amp;&amp; presence_state-&gt;message &amp;&amp;</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;         !strcmp(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a>, presence_state-&gt;message)) ||</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;        (!hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a> &amp;&amp; !presence_state-&gt;message))) {</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;      <span class="comment">/* this update is the same as the last, do nothing */</span></div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;   }</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;   <span class="comment">/* update new values */</span></div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a>);</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a>);</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;   hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a> = presence_state-&gt;<a class="code" href="../../d2/db9/structast__presence__state__message.html#a7d81246f8d6e05037a34bceb9b722e43">state</a>;</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;   hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a> = presence_state-&gt;subtype ? <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(presence_state-&gt;subtype) : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;   hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a> = presence_state-&gt;message ? <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(presence_state-&gt;message) : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;   <span class="comment">/* For general callbacks */</span></div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;   cb_iter = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(statecbs, 0);</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;   <span class="keywordflow">for</span> (; (state_cb = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;cb_iter)); <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(state_cb, -1)) {</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a5a034ba4312a7a7fcf3f3600548427d6">execute_state_callback</a>(state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a>,</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;         context_name,</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;         exten_name,</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;         state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>,</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a72b959e4767d5a4c644c6232122f5ad9">AST_HINT_UPDATE_PRESENCE</a>,</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;         hint,</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;         <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;   }</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;cb_iter);</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;   <span class="comment">/* For extension callbacks */</span></div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;   cb_iter = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>, 0);</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;   <span class="keywordflow">for</span> (; (state_cb = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;cb_iter)); <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(state_cb)) {</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a5a034ba4312a7a7fcf3f3600548427d6">execute_state_callback</a>(state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a>,</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;         context_name,</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;         exten_name,</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;         state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>,</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a72b959e4767d5a4c644c6232122f5ad9">AST_HINT_UPDATE_PRESENCE</a>,</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;         hint,</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;         <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;   }</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;cb_iter);</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;}</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;</div><div class="line"><a name="l03537"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a0fe14798bf4c5bc4415d0a3d6f170ccb"> 3537</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a0fe14798bf4c5bc4415d0a3d6f170ccb">handle_hint_change_message_type</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg, <span class="keyword">enum</span> <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6">ast_state_cb_update_reason</a> reason)</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;{</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint;</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *hint_app;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;   <span class="keywordflow">if</span> (hint_change_message_type() != <a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(msg)) {</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;   }</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;   <span class="keywordflow">if</span> (!(hint_app = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(1024))) {</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;   }</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;   hint = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(msg);</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;   <span class="keywordflow">switch</span> (reason) {</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a2e89bd60b1752d920f58a70164607189">AST_HINT_UPDATE_DEVICE</a>:</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a24d50f6db8148f22eb4783ff0999d7bc">device_state_notify_callbacks</a>(hint, &amp;hint_app);</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a72b959e4767d5a4c644c6232122f5ad9">AST_HINT_UPDATE_PRESENCE</a>:</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;      {</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;         <span class="keywordtype">char</span> *presence_subtype = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;         <span class="keywordtype">char</span> *presence_message = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;         <span class="keywordtype">int</span> <a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;         state = <a class="code" href="../../db/d94/pbx_8c.html#abf4ec36d94c7f4b99cb3cd4a0bb51111">extension_presence_state_helper</a>(</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;            hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>, &amp;presence_subtype, &amp;presence_message);</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;         {</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d2/db9/structast__presence__state__message.html">ast_presence_state_message</a> presence_state = {</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;               .<a class="code" href="../../d2/db9/structast__presence__state__message.html#a7d81246f8d6e05037a34bceb9b722e43">state</a> = state &gt; 0 ? <a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a> : <a class="code" href="../../d6/dd7/presencestate_8h.html#ac3452f41c7982c84ca27ecf7b4cc7ce1a5b541c7f37468daf2ee6cfe488949adb">AST_PRESENCE_INVALID</a>,</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;               .subtype = presence_subtype,</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;               .message = presence_message</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;            };</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#aae5642e93e1996051e684bfbc3b3ab08">presence_state_notify_callbacks</a>(hint, &amp;hint_app, &amp;presence_state);</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;         }</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(presence_subtype);</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(presence_message);</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;      }</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;   }</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(hint_app);</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;}</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;</div><div class="line"><a name="l03584"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ac1dd446fcf3d75d5da9228faf2dce1d3"> 3584</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#ac1dd446fcf3d75d5da9228faf2dce1d3">device_state_cb</a>(<span class="keywordtype">void</span> *unused, <span class="keyword">struct</span> <a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg)</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;{</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d92/structast__device__state__message.html">ast_device_state_message</a> *dev_state;</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *hint_app;</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> *device;</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> *cmpdevice;</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> *dev_iter;</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> auto_iter;</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d7f/structast__autohint.html">ast_autohint</a> *autohint;</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;   <span class="keywordtype">char</span> *virtual_device;</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>;</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;   <span class="keywordtype">char</span> *device_name;</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a0fe14798bf4c5bc4415d0a3d6f170ccb">handle_hint_change_message_type</a>(msg, <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a2e89bd60b1752d920f58a70164607189">AST_HINT_UPDATE_DEVICE</a>)) {</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;   }</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;   <span class="keywordflow">if</span> (hint_remove_message_type() == <a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(msg)) {</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;      <span class="comment">/* The extension has already been destroyed */</span></div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *state_cb;</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> cb_iter;</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(msg);</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;      hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a> = <a class="code" href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625faf53cb090b99fb8e952c8151990bd4192">AST_EXTENSION_DEACTIVATED</a>;</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;      cb_iter = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>, 0);</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;      <span class="keywordflow">for</span> (; (state_cb = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;cb_iter)); <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(state_cb, -1)) {</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a5a034ba4312a7a7fcf3f3600548427d6">execute_state_callback</a>(state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a>,</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;                 hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#add515701b5f4974e3d3512e034479a86">context_name</a>,</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;                 hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a300ad50df286a2875c6665b8b421836f">exten_name</a>,</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;                 state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>,</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;                 <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a2e89bd60b1752d920f58a70164607189">AST_HINT_UPDATE_DEVICE</a>,</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;                 hint,</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;                 <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;      }</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;cb_iter);</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;   }</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../da/da2/devicestate_8h.html#a9459272db1c8c968ed1aff1387f0f9fd">ast_device_state_message_type</a>() != <a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(msg)) {</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;   }</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;   dev_state = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(msg);</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;   <span class="keywordflow">if</span> (dev_state-&gt;<a class="code" href="../../db/d92/structast__device__state__message.html#a39d1b63955a48c72508fa9f884d05762">eid</a>) {</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;      <span class="comment">/* ignore non-aggregate states */</span></div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;   }</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(hintdevices) == 0 &amp;&amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(autohints) == 0) {</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;      <span class="comment">/* There are no hints monitoring devices. */</span></div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;   }</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;   hint_app = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(1024);</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;   <span class="keywordflow">if</span> (!hint_app) {</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;   }</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;   cmpdevice = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(<span class="keyword">sizeof</span>(*cmpdevice) + strlen(dev_state-&gt;<a class="code" href="../../db/d92/structast__device__state__message.html#a8059c3b19eb356cf729e5d25b139647e">device</a>));</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;   strcpy(cmpdevice-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">hintdevice</a>, dev_state-&gt;<a class="code" href="../../db/d92/structast__device__state__message.html#a8059c3b19eb356cf729e5d25b139647e">device</a>);</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">context_merge_lock</a>);<span class="comment">/* Hold off ast_merge_contexts_and_delete */</span></div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;   <span class="comment">/* Initially we find all hints for the device and notify them */</span></div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;   dev_iter = <a class="code" href="../../d5/da5/astobj2_8h.html#aeca960ec22a1d0384f6e285b25df8501">ao2_t_callback</a>(hintdevices,</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>,</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#aabf9a3a7442aeee52b849c70c6d0af33">hintdevice_cmp_multiple</a>,</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;      cmpdevice,</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;      <span class="stringliteral">&quot;find devices in container&quot;</span>);</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;   <span class="keywordflow">if</span> (dev_iter) {</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;      <span class="keywordflow">for</span> (; (device = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(dev_iter)); <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(device, -1, <span class="stringliteral">&quot;Next device&quot;</span>)) {</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;         <span class="keywordflow">if</span> (device-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a>) {</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a24d50f6db8148f22eb4783ff0999d7bc">device_state_notify_callbacks</a>(device-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a>, &amp;hint_app);</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;         }</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;      }</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(dev_iter);</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;   }</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;   <span class="comment">/* Second stage we look for any autohint contexts and if the device is not already in the hints</span></div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;<span class="comment">    * we create it.</span></div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;   type = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(dev_state-&gt;<a class="code" href="../../db/d92/structast__device__state__message.html#a8059c3b19eb356cf729e5d25b139647e">device</a>);</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(type)) {</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;   }</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;   <span class="comment">/* Determine if this is a virtual/custom device or a real device */</span></div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;   virtual_device = strchr(type, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;   device_name = strchr(type, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;   <span class="keywordflow">if</span> (virtual_device &amp;&amp; (!device_name || (virtual_device &lt; device_name))) {</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;      device_name = virtual_device;</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;   }</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;   <span class="comment">/* Invalid device state name - not a virtual/custom device and not a real device */</span></div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(device_name)) {</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;   }</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;   *device_name++ = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;   auto_iter = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(autohints, 0);</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;   <span class="keywordflow">for</span> (; (autohint = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;auto_iter)); <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(autohint, -1, <span class="stringliteral">&quot;Next autohint&quot;</span>)) {</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#ac778ac642def88a06e5d59e11a964c43">ast_get_hint</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, autohint-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#a08658434a6786d5f55bf4f6d6a222625">context</a>, device_name)) {</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;      }</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;      <span class="comment">/* The device has no hint in the context referenced by this autohint so create one */</span></div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a07176e8d314eb68b3b50279fafa11390">ast_add_extension</a>(autohint-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#a08658434a6786d5f55bf4f6d6a222625">context</a>, 0, device_name,</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, dev_state-&gt;<a class="code" href="../../db/d92/structast__device__state__message.html#a8059c3b19eb356cf729e5d25b139647e">device</a>,</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(dev_state-&gt;<a class="code" href="../../db/d92/structast__device__state__message.html#a8059c3b19eb356cf729e5d25b139647e">device</a>), <a class="code" href="../../d8/d8a/astmm_8h.html#ad42ab843b767e8b57162c10a158b75c3">ast_free_ptr</a>, autohint-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;      <span class="comment">/* Since this hint was just created there are no watchers, so we don&#39;t need to notify anyone */</span></div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;   }</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;auto_iter);</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>:</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">context_merge_lock</a>);</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(hint_app);</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;   <span class="keywordflow">return</span>;</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;}</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;<span class="comment"> * \brief Destroy the given state callback object.</span></div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;<span class="comment"> * \param doomed State callback to destroy.</span></div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03716"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a99648b71f8a58f9b5949f4587e38a890"> 3716</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a99648b71f8a58f9b5949f4587e38a890">destroy_state_cb</a>(<span class="keywordtype">void</span> *doomed)</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;{</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *state_cb = doomed;</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;   <span class="keywordflow">if</span> (state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#afdefecc023555cdad67e84d30ff1d997">destroy_cb</a>) {</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;      state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#afdefecc023555cdad67e84d30ff1d997">destroy_cb</a>(state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>, state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>);</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;   }</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;}</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;<span class="comment"> * \brief Add watcher for extension states with destructor</span></div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03729"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a9d8398fb440bfff609135d49dfe3f01d"> 3729</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a9d8398fb440bfff609135d49dfe3f01d">extension_state_add_destroy</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a2c6cd56c75fb925c726e1f400024f856">ast_state_cb_type</a> <a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a>, <a class="code" href="../../db/de0/pbx_8h.html#ad3a372c5b23617d0ba1856aa88035f54">ast_state_cb_destroy_type</a> <a class="code" href="../../d6/d37/structast__state__cb.html#afdefecc023555cdad67e84d30ff1d997">destroy_cb</a>, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> <a class="code" href="../../d6/d37/structast__state__cb.html#a46aefd6d3d8d80a5a7fa3c2c25d2638d">extended</a>)</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;{</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint;</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *state_cb;</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e;</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a>;</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;   <span class="comment">/* If there&#39;s no context and extension:  add callback to statecbs list */</span></div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;   <span class="keywordflow">if</span> (!context &amp;&amp; !exten) {</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;      <span class="comment">/* Prevent multiple adds from adding the same change_cb at the same time. */</span></div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(statecbs);</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;      <span class="comment">/* Remove any existing change_cb. */</span></div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(statecbs, change_cb, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>);</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;      <span class="comment">/* Now insert the change_cb */</span></div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;      <span class="keywordflow">if</span> (!(state_cb = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*state_cb), <a class="code" href="../../db/d94/pbx_8c.html#a99648b71f8a58f9b5949f4587e38a890">destroy_state_cb</a>))) {</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(statecbs);</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;      }</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;      state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = 0;</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;      state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a> = change_cb;</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;      state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#afdefecc023555cdad67e84d30ff1d997">destroy_cb</a> = destroy_cb;</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;      state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">data</a> = <a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>;</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;      state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a46aefd6d3d8d80a5a7fa3c2c25d2638d">extended</a> = extended;</div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(statecbs, state_cb);</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(state_cb, -1);</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(statecbs);</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;   }</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;   <span class="keywordflow">if</span> (!context || !exten)</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;   <span class="comment">/* This callback type is for only one hint, so get the hint */</span></div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;   e = <a class="code" href="../../db/d94/pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, exten);</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;   <span class="keywordflow">if</span> (!e) {</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;   }</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;   <span class="comment">/* If this is a pattern, dynamically create a new extension for this</span></div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;<span class="comment">    * particular match.  Note that this will only happen once for each</span></div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;<span class="comment">    * individual extension, because the pattern will no longer match first.</span></div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>[0] == <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hints);</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a07176e8d314eb68b3b50279fafa11390">ast_add_extension</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">parent</a>-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, 0, exten, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>,</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;         e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> ? e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>), <a class="code" href="../../d8/d8a/astmm_8h.html#ad42ab843b767e8b57162c10a158b75c3">ast_free_ptr</a>,</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;         e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;      e = <a class="code" href="../../db/d94/pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, exten);</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;      <span class="keywordflow">if</span> (!e || e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>[0] == <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;      }</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;   }</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;   <span class="comment">/* Find the hint in the hints container */</span></div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hints);<span class="comment">/* Locked to hold off ast_merge_contexts_and_delete */</span></div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;   hint = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(hints, e, 0);</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;   <span class="keywordflow">if</span> (!hint) {</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;   }</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;   <span class="comment">/* Now insert the callback in the callback list  */</span></div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;   <span class="keywordflow">if</span> (!(state_cb = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*state_cb), <a class="code" href="../../db/d94/pbx_8c.html#a99648b71f8a58f9b5949f4587e38a890">destroy_state_cb</a>))) {</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1);</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;   }</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;   <span class="keywordflow">do</span> {</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;      <span class="keywordtype">id</span> = stateid++;      <span class="comment">/* Unique ID for this callback */</span></div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;      <span class="comment">/* Do not allow id to ever be -1 or 0. */</span></div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;   } <span class="keywordflow">while</span> (<span class="keywordtype">id</span> == -1 || <span class="keywordtype">id</span> == 0);</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;   state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = <a class="code" href="../../da/dfb/app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a>;</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;   state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a> = change_cb; <span class="comment">/* Pointer to callback routine */</span></div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;   state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#afdefecc023555cdad67e84d30ff1d997">destroy_cb</a> = destroy_cb;</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;   state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">data</a> = <a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>;     <span class="comment">/* Data for the callback */</span></div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;   state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a46aefd6d3d8d80a5a7fa3c2c25d2638d">extended</a> = extended;</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>, state_cb);</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(state_cb, -1);</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1);</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a>;</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;}</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;</div><div class="line"><a name="l03819"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3fe692162e8e78eed9d4ccc2370a49eb"> 3819</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a3fe692162e8e78eed9d4ccc2370a49eb">ast_extension_state_add_destroy</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a2c6cd56c75fb925c726e1f400024f856">ast_state_cb_type</a> change_cb, <a class="code" href="../../db/de0/pbx_8h.html#ad3a372c5b23617d0ba1856aa88035f54">ast_state_cb_destroy_type</a> destroy_cb, <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;{</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a9d8398fb440bfff609135d49dfe3f01d">extension_state_add_destroy</a>(context, exten, change_cb, destroy_cb, data, 0);</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;}</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;</div><div class="line"><a name="l03825"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ab1d88f370509aae87302134e6f70628a"> 3825</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ab1d88f370509aae87302134e6f70628a">ast_extension_state_add</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a2c6cd56c75fb925c726e1f400024f856">ast_state_cb_type</a> change_cb, <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;{</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a9d8398fb440bfff609135d49dfe3f01d">extension_state_add_destroy</a>(context, exten, change_cb, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, data, 0);</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;}</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;</div><div class="line"><a name="l03831"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a0dd6eaef780ca4a7de91db52a2b8b085"> 3831</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a0dd6eaef780ca4a7de91db52a2b8b085">ast_extension_state_add_destroy_extended</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a2c6cd56c75fb925c726e1f400024f856">ast_state_cb_type</a> change_cb, <a class="code" href="../../db/de0/pbx_8h.html#ad3a372c5b23617d0ba1856aa88035f54">ast_state_cb_destroy_type</a> destroy_cb, <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;{</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a9d8398fb440bfff609135d49dfe3f01d">extension_state_add_destroy</a>(context, exten, change_cb, destroy_cb, data, 1);</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;}</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;</div><div class="line"><a name="l03837"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa636ab868f1724406019bbbc82676488"> 3837</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aa636ab868f1724406019bbbc82676488">ast_extension_state_add_extended</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a2c6cd56c75fb925c726e1f400024f856">ast_state_cb_type</a> change_cb, <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;{</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a9d8398fb440bfff609135d49dfe3f01d">extension_state_add_destroy</a>(context, exten, change_cb, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, data, 1);</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;}</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;<span class="comment">/*! \brief Find Hint by callback id */</span></div><div class="line"><a name="l03844"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#abf3da774c123a5bca0fca54659227d13"> 3844</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#abf3da774c123a5bca0fca54659227d13">find_hint_by_cb_id</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;{</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *state_cb;</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint = obj;</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;   <span class="keywordtype">int</span> *<span class="keywordtype">id</span> = arg;</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;   <span class="keywordflow">if</span> ((state_cb = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>, <span class="keywordtype">id</span>, 0))) {</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(state_cb, -1);</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>;</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;   }</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;}</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;</div><div class="line"><a name="l03858"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa992580d26443e3306f7f08cf5908e7c"> 3858</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aa992580d26443e3306f7f08cf5908e7c">ast_extension_state_del</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <a class="code" href="../../db/de0/pbx_8h.html#a2c6cd56c75fb925c726e1f400024f856">ast_state_cb_type</a> change_cb)</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;{</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *p_cur;</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;   <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>) {  <span class="comment">/* id == 0 is a callback without extension */</span></div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;      <span class="keywordflow">if</span> (!change_cb) {</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;         <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;      }</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;      p_cur = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(statecbs, change_cb, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a>);</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;      <span class="keywordflow">if</span> (p_cur) {</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;         ret = 0;</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(p_cur, -1);</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;      }</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;   } <span class="keywordflow">else</span> { <span class="comment">/* callback with extension, find the callback based on ID */</span></div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint;</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hints);<span class="comment">/* Locked to hold off ast_merge_contexts_and_delete */</span></div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;      hint = <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(hints, 0, <a class="code" href="../../db/d94/pbx_8c.html#abf3da774c123a5bca0fca54659227d13">find_hint_by_cb_id</a>, &amp;<span class="keywordtype">id</span>);</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;      <span class="keywordflow">if</span> (hint) {</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;         p_cur = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>, &amp;<span class="keywordtype">id</span>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a>);</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;         <span class="keywordflow">if</span> (p_cur) {</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;            ret = 0;</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(p_cur, -1);</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;         }</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1);</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;      }</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;   }</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;}</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;</div><div class="line"><a name="l03891"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae11307420f479da288a4da22d7af43d6"> 3891</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae11307420f479da288a4da22d7af43d6">hint_id_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;{</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *cb = obj;</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;   <span class="keywordtype">int</span> *<span class="keywordtype">id</span> = arg;</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;   <span class="keywordflow">return</span> (cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> == *<span class="keywordtype">id</span>) ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;}</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;<span class="comment"> * \brief Destroy the given hint object.</span></div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;<span class="comment"> * \param obj Hint to destroy.</span></div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03907"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a8727e73607c8f00db1bc9c0a7f9262da"> 3907</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a8727e73607c8f00db1bc9c0a7f9262da">destroy_hint</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;{</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint = obj;</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>);</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;hint-&gt;devices); i++) {</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;      <span class="keywordtype">char</span> *device = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;hint-&gt;devices, i);</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(device);</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;   }</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;hint-&gt;devices);</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a>);</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a>);</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;}</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;<span class="comment">/*! \brief Publish a hint removed event  */</span></div><div class="line"><a name="l03924"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3a3a455c7a170e1aad15fed252cb174f"> 3924</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a3a3a455c7a170e1aad15fed252cb174f">publish_hint_remove</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint)</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;{</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *<a class="code" href="../../d8/d9e/structmessage.html">message</a>;</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;   <span class="keywordflow">if</span> (!hint_remove_message_type()) {</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;   }</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;   <span class="keywordflow">if</span> (!(message = <a class="code" href="../../dd/d79/stasis_8h.html#a72a06fdaec039fdfb5f36892e725f9ec">stasis_message_create</a>(hint_remove_message_type(), hint))) {</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1);</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;   }</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a>(<a class="code" href="../../da/da2/devicestate_8h.html#a9fa7376e8e627cf5a512209005692013">ast_device_state_topic_all</a>(), message);</div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(message, -1);</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;}</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;<span class="comment">/*! \brief Remove hint from extension */</span></div><div class="line"><a name="l03945"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a8fcc10d31d51afba693ef9a4cb162c6a"> 3945</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a8fcc10d31d51afba693ef9a4cb162c6a">ast_remove_hint</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e)</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;{</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;   <span class="comment">/* Cleanup the Notifys if hint is removed */</span></div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint;</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;   <span class="keywordflow">if</span> (!e) {</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;   }</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;   hint = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(hints, e, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a>);</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;   <span class="keywordflow">if</span> (!hint) {</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;   }</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a582812711d3d9e2cf321bdae3230ec90">remove_hintdevice</a>(hint);</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;<span class="comment">    * The extension is being destroyed so we must save some</span></div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;<span class="comment">    * information to notify that the extension is deactivated.</span></div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#add515701b5f4974e3d3512e034479a86">context_name</a>,</div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<a class="code" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>)),</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;      <span class="keyword">sizeof</span>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#add515701b5f4974e3d3512e034479a86">context_name</a>));</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a300ad50df286a2875c6665b8b421836f">exten_name</a>, <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>),</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;      <span class="keyword">sizeof</span>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a300ad50df286a2875c6665b8b421836f">exten_name</a>));</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;   hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a3a3a455c7a170e1aad15fed252cb174f">publish_hint_remove</a>(hint);</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1);</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;}</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;<span class="comment">/*! \brief Add hint to hint list, check initial extension state */</span></div><div class="line"><a name="l03982"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae46143d88ad157ae0e848c7167891fa1"> 3982</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae46143d88ad157ae0e848c7167891fa1">ast_add_hint</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e)</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;{</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint_new;</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint_found;</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d8/d9e/structmessage.html">message</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;   <span class="keywordtype">char</span> *subtype = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;   <span class="keywordtype">int</span> presence_state;</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;   <span class="keywordflow">if</span> (!e) {</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;   }</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;<span class="comment">    * We must create the hint we wish to add before determining if</span></div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;<span class="comment">    * it is already in the hints container to avoid possible</span></div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;<span class="comment">    * deadlock when getting the current extension state.</span></div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;   hint_new = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*hint_new), <a class="code" href="../../db/d94/pbx_8c.html#a8727e73607c8f00db1bc9c0a7f9262da">destroy_hint</a>);</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;   <span class="keywordflow">if</span> (!hint_new) {</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;   }</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;hint_new-&gt;devices, 8);</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;   <span class="comment">/* Initialize new hint. */</span></div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;   hint_new-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#add41bd9979cb8642f81dd38aa2dfcd6d">ao2_container_alloc_list</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d94/pbx_8c.html#ae11307420f479da288a4da22d7af43d6">hint_id_cmp</a>);</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;   <span class="keywordflow">if</span> (!hint_new-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>) {</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint_new, -1);</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;   }</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;   hint_new-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a> = e;</div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;   <span class="keywordflow">if</span> (strstr(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, <span class="stringliteral">&quot;${&quot;</span>) &amp;&amp; e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>[0] == <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;      <span class="comment">/* The hint is dynamic and hasn&#39;t been evaluted yet */</span></div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;      hint_new-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a> = <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>;</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;      hint_new-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a> = <a class="code" href="../../d6/dd7/presencestate_8h.html#ac3452f41c7982c84ca27ecf7b4cc7ce1a5b541c7f37468daf2ee6cfe488949adb">AST_PRESENCE_INVALID</a>;</div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;      hint_new-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a> = <a class="code" href="../../db/d94/pbx_8c.html#a92af176ba464b63d4d13079e68933430">ast_extension_state2</a>(e, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;      <span class="keywordflow">if</span> ((presence_state = <a class="code" href="../../db/d94/pbx_8c.html#abf4ec36d94c7f4b99cb3cd4a0bb51111">extension_presence_state_helper</a>(e, &amp;subtype, &amp;message)) &gt; 0) {</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;         hint_new-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a> = presence_state;</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;         hint_new-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a> = subtype;</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;         hint_new-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a> = message;</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;      }</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;   }</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;   <span class="comment">/* Prevent multiple add hints from adding the same hint at the same time. */</span></div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hints);</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;   <span class="comment">/* Search if hint exists, do nothing */</span></div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;   hint_found = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(hints, e, 0);</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;   <span class="keywordflow">if</span> (hint_found) {</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint_found, -1);</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint_new, -1);</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;HINTS: Not re-adding existing hint %s: %s\n&quot;</span>,</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(e), <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(e));</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;   }</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;   <span class="comment">/* Add new hint to the hints container */</span></div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;HINTS: Adding hint %s: %s\n&quot;</span>,</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(e), <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(e));</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(hints, hint_new);</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#ae261065f1ffd04c08087b11886382530">add_hintdevice</a>(hint_new, <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(e))) {</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not add devices for hint: %s@%s.\n&quot;</span>,</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(e),</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<a class="code" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a>(e)));</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;   }</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;</div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;   <span class="comment">/* if not dynamic */</span></div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;   <span class="keywordflow">if</span> (!(strstr(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, <span class="stringliteral">&quot;${&quot;</span>) &amp;&amp; e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>[0] == <span class="charliteral">&#39;_&#39;</span>)) {</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *state_cb;</div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> cb_iter;</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;      <span class="comment">/* For general callbacks */</span></div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;      cb_iter = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(statecbs, 0);</div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;      <span class="keywordflow">for</span> (; (state_cb = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;cb_iter)); <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(state_cb, -1)) {</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a5a034ba4312a7a7fcf3f3600548427d6">execute_state_callback</a>(state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a>,</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<a class="code" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a>(e)),</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(e),</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;            state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>,</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;            <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a2e89bd60b1752d920f58a70164607189">AST_HINT_UPDATE_DEVICE</a>,</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;            hint_new,</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;            <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;      }</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;cb_iter);</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;   }</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint_new, -1);</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;}</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;<span class="comment">/*! \brief Publish a hint changed event  */</span></div><div class="line"><a name="l04074"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a4f0abef370be053d950e665535e94f76"> 4074</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a4f0abef370be053d950e665535e94f76">publish_hint_change</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint, <span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *ne)</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;{</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *<a class="code" href="../../d8/d9e/structmessage.html">message</a>;</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;   <span class="keywordflow">if</span> (!hint_change_message_type()) {</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;   }</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;   <span class="keywordflow">if</span> (!(message = <a class="code" href="../../dd/d79/stasis_8h.html#a72a06fdaec039fdfb5f36892e725f9ec">stasis_message_create</a>(hint_change_message_type(), hint))) {</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1);</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;   }</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a>(<a class="code" href="../../da/da2/devicestate_8h.html#a9fa7376e8e627cf5a512209005692013">ast_device_state_topic_all</a>(), message);</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a>(<a class="code" href="../../d6/dd7/presencestate_8h.html#a24297292fcef05a5a271e99e1a71f45a">ast_presence_state_topic_all</a>(), message);</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(message, -1);</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;}</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;<span class="comment">/*! \brief Change hint for an extension */</span></div><div class="line"><a name="l04096"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#adfb9d0de487a52af57ed7953508cee82"> 4096</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#adfb9d0de487a52af57ed7953508cee82">ast_change_hint</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *oe, <span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *ne)</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;{</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint;</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;   <span class="keywordflow">if</span> (!oe || !ne) {</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;   }</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hints);<span class="comment">/* Locked to hold off others while we move the hint around. */</span></div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;<span class="comment">    * Unlink the hint from the hints container as the extension</span></div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;<span class="comment">    * name (which is the hash value) could change.</span></div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;   hint = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(hints, oe, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a>);</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;   <span class="keywordflow">if</span> (!hint) {</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">context_merge_lock</a>);</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;   }</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a582812711d3d9e2cf321bdae3230ec90">remove_hintdevice</a>(hint);</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;   <span class="comment">/* Update the hint and put it back in the hints container. */</span></div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;   hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a> = ne;</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(hints, hint);</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#ae261065f1ffd04c08087b11886382530">add_hintdevice</a>(hint, <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(ne))) {</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not add devices for hint: %s@%s.\n&quot;</span>,</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(ne),</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<a class="code" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a>(ne)));</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;   }</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a4f0abef370be053d950e665535e94f76">publish_hint_change</a>(hint, ne);</div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1);</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;</div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;}</div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;<span class="comment">/*! \brief Get hint for channel */</span></div><div class="line"><a name="l04141"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ac778ac642def88a06e5d59e11a964c43"> 4141</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ac778ac642def88a06e5d59e11a964c43">ast_get_hint</a>(<span class="keywordtype">char</span> *hint, <span class="keywordtype">int</span> hintsize, <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> namesize, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;{</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e = <a class="code" href="../../db/d94/pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(c, context, exten);</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;   <span class="keywordflow">if</span> (e) {</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;      <span class="keywordflow">if</span> (hint)</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(hint, <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(e), hintsize);</div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;      <span class="keywordflow">if</span> (name) {</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a> = <a class="code" href="../../db/d94/pbx_8c.html#ac0a6c0c39796f36864868365d8989f02">ast_get_extension_app_data</a>(e);</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;         <span class="keywordflow">if</span> (tmp)</div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(name, tmp, namesize);</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;      }</div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;   }</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;}</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;<span class="comment">/*! \brief Get hint for channel */</span></div><div class="line"><a name="l04159"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aea38e9b2b0f0aa337444fcc030e12730"> 4159</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aea38e9b2b0f0aa337444fcc030e12730">ast_str_get_hint</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **hint, ssize_t hintsize, <span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, ssize_t namesize, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;{</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e = <a class="code" href="../../db/d94/pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(c, context, exten);</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;   <span class="keywordflow">if</span> (!e) {</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;   }</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;   <span class="keywordflow">if</span> (hint) {</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(hint, hintsize, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(e));</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;   }</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;   <span class="keywordflow">if</span> (name) {</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a> = <a class="code" href="../../db/d94/pbx_8c.html#ac0a6c0c39796f36864868365d8989f02">ast_get_extension_app_data</a>(e);</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;      <span class="keywordflow">if</span> (tmp) {</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(name, namesize, <span class="stringliteral">&quot;%s&quot;</span>, tmp);</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;      }</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;   }</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;}</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;</div><div class="line"><a name="l04179"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7"> 4179</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid)</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;{</div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#ae381d99bea85b43f022470b64171018d">pbx_extension_helper</a>(c, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, exten, priority, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, callerid, <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a>, 0, 0);</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;}</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;</div><div class="line"><a name="l04184"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a0be9518646cf9aca4878b313cc02e901"> 4184</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a0be9518646cf9aca4878b313cc02e901">ast_findlabel_extension</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid)</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;{</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#ae381d99bea85b43f022470b64171018d">pbx_extension_helper</a>(c, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, exten, 0, label, callerid, <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a>, 0, 0);</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;}</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;</div><div class="line"><a name="l04189"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa3c47773f118e7775a5c052dbb4bb3aa"> 4189</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aa3c47773f118e7775a5c052dbb4bb3aa">ast_findlabel_extension2</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid)</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;{</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#ae381d99bea85b43f022470b64171018d">pbx_extension_helper</a>(c, con, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, exten, 0, label, callerid, <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a>, 0, 0);</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;}</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;</div><div class="line"><a name="l04194"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a93f9868530c1e8a9d9d367d1ead8782e"> 4194</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a93f9868530c1e8a9d9d367d1ead8782e">ast_canmatch_extension</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid)</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;{</div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#ae381d99bea85b43f022470b64171018d">pbx_extension_helper</a>(c, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, exten, priority, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, callerid, <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a>, 0, 0);</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;}</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;</div><div class="line"><a name="l04199"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ac359af75b9494f50904583d2168a7577"> 4199</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ac359af75b9494f50904583d2168a7577">ast_matchmore_extension</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid)</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;{</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#ae381d99bea85b43f022470b64171018d">pbx_extension_helper</a>(c, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, exten, priority, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, callerid, <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>, 0, 0);</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;}</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;</div><div class="line"><a name="l04204"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a94ca71e502d95d1cb0a815072e059aee"> 4204</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a94ca71e502d95d1cb0a815072e059aee">ast_spawn_extension</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid, <span class="keywordtype">int</span> *found, <span class="keywordtype">int</span> combined_find_spawn)</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;{</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#ae381d99bea85b43f022470b64171018d">pbx_extension_helper</a>(c, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, exten, priority, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, callerid, <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee">E_SPAWN</a>, found, combined_find_spawn);</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;}</div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;</div><div class="line"><a name="l04209"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a90b8895bf6b299c1b844a57c2ea10348"> 4209</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a90b8895bf6b299c1b844a57c2ea10348">ast_pbx_h_exten_run</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *context)</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;{</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;   <span class="keywordtype">int</span> autoloopflag;</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;   <span class="keywordtype">int</span> found;</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;   <span class="keywordtype">int</span> spawn_error;</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;<span class="comment">    * Make sure that the channel is marked as hungup since we are</span></div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;<span class="comment">    * going to run the h exten on it.</span></div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ae90da1877e143b996d202d4c88a9c862">ast_softhangup_nolock</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a33d9271d8d892501de8c9536382d71ea">AST_SOFTHANGUP_HANGUP_EXEC</a>);</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;   <span class="comment">/* Set h exten location */</span></div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;   <span class="keywordflow">if</span> (context != <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan)) {</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a>(chan, context);</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;   }</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a>(chan, <span class="stringliteral">&quot;h&quot;</span>);</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a>(chan, 1);</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;   <span class="comment">/* Save autoloop flag */</span></div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;   autoloopflag = <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>);</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>);</div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;      spawn_error = <a class="code" href="../../db/d94/pbx_8c.html#a94ca71e502d95d1cb0a815072e059aee">ast_spawn_extension</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan),</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(chan),</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid,</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), &amp;found, 1);</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;      <span class="keywordflow">if</span> (spawn_error) {</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;         <span class="comment">/* The code after the loop needs the channel locked. */</span></div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;      }</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(chan) + 1);</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;   }</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;   <span class="keywordflow">if</span> (found &amp;&amp; spawn_error) {</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;      <span class="comment">/* Something bad happened, or a hangup has been requested. */</span></div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Spawn extension (%s,%s,%d) exited non-zero on &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(chan),</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Spawn extension (%s, %s, %d) exited non-zero on &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(chan),</div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;   }</div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;   <span class="comment">/* An &quot;h&quot; exten has been run, so indicate that one has been run. */</span></div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a3f96b2798b1f93fa27bc2dff7dfd9a26">AST_FLAG_BRIDGE_HANGUP_RUN</a>);</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;   <span class="comment">/* Restore autoloop flag */</span></div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(chan), autoloopflag, <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>);</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;}</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;<span class="comment">/*! helper function to set extension and priority */</span></div><div class="line"><a name="l04268"></a><span class="lineno"><a class="line" href="../../d9/da0/pbx__private_8h.html#afbc14f8c1eb89e675d42e8d7fe33d276"> 4268</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#afbc14f8c1eb89e675d42e8d7fe33d276">set_ext_pri</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> pri)</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;{</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(c);</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a>(c, exten);</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a>(c, pri);</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(c);</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;}</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;<span class="comment"> * \brief collect digits from the channel into the buffer.</span></div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;<span class="comment"> * \param c, buf, buflen, pos</span></div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;<span class="comment"> * \param waittime is in milliseconds</span></div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;<span class="comment"> * \retval 0 on timeout or done.</span></div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;<span class="comment"> * \retval -1 on error.</span></div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l04283"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aed1020578edff9baad853fc543464432"> 4283</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aed1020578edff9baad853fc543464432">collect_digits</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keywordtype">int</span> waittime, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">int</span> buflen, <span class="keywordtype">int</span> pos)</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;{</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dc/d5c/app__alarmreceiver_8c.html#ac2c887b7f7b359bfdda8a128980f5081">digit</a>;</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;   buf[pos] = <span class="charliteral">&#39;\0&#39;</span>;  <span class="comment">/* make sure it is properly terminated */</span></div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../db/d94/pbx_8c.html#ac359af75b9494f50904583d2168a7577">ast_matchmore_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), buf, 1,</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;      <span class="comment">/* As long as we&#39;re willing to wait, and as long as it&#39;s not defined,</span></div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;<span class="comment">         keep reading digits until we can&#39;t possibly get a right answer anymore.  */</span></div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;      digit = <a class="code" href="../../d5/d7b/channel_8h.html#a050bec9a4abc1a599b6573a6091b080c">ast_waitfordigit</a>(c, waittime);</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#adac99999f1e55833e7f903979d67b48b">ast_channel_softhangup_internal_flag</a>(c) &amp; <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a085c0c603de12dc2474a17a92e1cb5a4">AST_SOFTHANGUP_ASYNCGOTO</a>) {</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a21c057f81ff8b02eb1120410ae86e657">ast_channel_clear_softhangup</a>(c, AST_SOFTHANGUP_ASYNCGOTO);</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;         <span class="keywordflow">if</span> (!digit) <span class="comment">/* No entry */</span></div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;         <span class="keywordflow">if</span> (digit &lt; 0) <span class="comment">/* Error, maybe a  hangup */</span></div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;         <span class="keywordflow">if</span> (pos &lt; buflen - 1) { <span class="comment">/* XXX maybe error otherwise ? */</span></div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;            buf[pos++] = <a class="code" href="../../dc/d5c/app__alarmreceiver_8c.html#ac2c887b7f7b359bfdda8a128980f5081">digit</a>;</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;            buf[pos] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;         }</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;         waittime = <a class="code" href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a>(c)-&gt;<a class="code" href="../../d6/d83/structast__pbx.html#a80a133d151de25445e8dfd09953a0872">dtimeoutms</a>;</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;      }</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;   }</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;}</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;</div><div class="line"><a name="l04310"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ab203ba8e71a7c11736a40f7967ba1fdf"> 4310</a></span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a> <a class="code" href="../../db/d94/pbx_8c.html#ab203ba8e71a7c11736a40f7967ba1fdf">__ast_pbx_run</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>,</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../da/db8/structast__pbx__args.html">ast_pbx_args</a> *<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>)</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;{</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;   <span class="keywordtype">int</span> found = 0; <span class="comment">/* set if we find at least one match */</span></div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;   <span class="keywordtype">int</span> autoloopflag;</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 0;    <span class="comment">/* set an error conditions */</span></div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d83/structast__pbx.html">ast_pbx</a> *pbx;</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a> callid;</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;   <span class="comment">/* A little initial setup here */</span></div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a>(c)) {</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s already has PBX structure??\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c));</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;      <span class="comment">/* XXX and now what ? */</span></div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a>(c));</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;   }</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;   <span class="keywordflow">if</span> (!(pbx = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*pbx)))) {</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490">AST_PBX_FAILED</a>;</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;   }</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;   callid = <a class="code" href="../../d1/d8c/logger_8h.html#a5b3f39ea262ffa795ce4b597968ad00b">ast_read_threadstorage_callid</a>();</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;   <span class="comment">/* If the thread isn&#39;t already associated with a callid, we should create that association. */</span></div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;   <span class="keywordflow">if</span> (!callid) {</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;      <span class="comment">/* Associate new PBX thread with the channel call id if it is availble.</span></div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;<span class="comment">       * If not, create a new one instead.</span></div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;      callid = <a class="code" href="../../d5/d7b/channel_8h.html#a6c2c406bdebd477029e61774cc300abd">ast_channel_callid</a>(c);</div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;      <span class="keywordflow">if</span> (!callid) {</div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;         callid = <a class="code" href="../../d1/d8c/logger_8h.html#a6cd2a7c20c6cfe0e3f4fed72dd2cc6b2">ast_create_callid</a>();</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;         <span class="keywordflow">if</span> (callid) {</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(c);</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ae3d06c28b4dc8cb2830aa16c8913e6d9">ast_channel_callid_set</a>(c, callid);</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(c);</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;         }</div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;      }</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a6956becf4d7e3906c74b6e30b834ebd8">ast_callid_threadassoc_add</a>(callid);</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;      callid = 0;</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;   }</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;</div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af89b0f98c227230d7180a90627c0901c">ast_channel_pbx_set</a>(c, pbx);</div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;   <span class="comment">/* Set reasonable defaults */</span></div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a>(c)-&gt;<a class="code" href="../../d6/d83/structast__pbx.html#a765bfb11e07b0f90c235c9af9d7f46fa">rtimeoutms</a> = 10000;</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a>(c)-&gt;<a class="code" href="../../d6/d83/structast__pbx.html#a80a133d151de25445e8dfd09953a0872">dtimeoutms</a> = 5000;</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(c);</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;   autoloopflag = <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>);  <span class="comment">/* save value to restore at the end */</span></div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>);</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(c);</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c))) {</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;      <span class="comment">/* If not successful fall back to &#39;s&#39; - but only if there is no given exten  */</span></div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Starting %s at %s,%s,%d failed so falling back to exten &#39;s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(c));</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;      <span class="comment">/* XXX the original code used the existing priority in the call to</span></div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;<span class="comment">       * ast_exists_extension(), and reset it to 1 afterwards.</span></div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;<span class="comment">       * I believe the correct thing is to set it to 1 immediately.</span></div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#afbc14f8c1eb89e675d42e8d7fe33d276">set_ext_pri</a>(c, <span class="stringliteral">&quot;s&quot;</span>, 1);</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;   }</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;</div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;      <span class="keywordtype">char</span> dst_exten[256]; <span class="comment">/* buffer to accumulate digits */</span></div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;      <span class="keywordtype">int</span> pos = 0;      <span class="comment">/* XXX should check bounds */</span></div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../dc/d5c/app__alarmreceiver_8c.html#ac2c887b7f7b359bfdda8a128980f5081">digit</a> = 0;</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;      <span class="keywordtype">int</span> invalid = 0;</div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> = 0;</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;      <span class="comment">/* No digits pressed yet */</span></div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;      dst_exten[pos] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;      <span class="comment">/* loop on priorities in this context/exten */</span></div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;      <span class="keywordflow">while</span> (!(res = <a class="code" href="../../db/d94/pbx_8c.html#a94ca71e502d95d1cb0a815072e059aee">ast_spawn_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(c),</div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),</div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;         &amp;found, 1))) {</div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7b/channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd">ast_check_hangup</a>(c)) {</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(c) + 1);</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;         }</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;         <span class="comment">/* Check softhangup flags. */</span></div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#adac99999f1e55833e7f903979d67b48b">ast_channel_softhangup_internal_flag</a>(c) &amp; <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a085c0c603de12dc2474a17a92e1cb5a4">AST_SOFTHANGUP_ASYNCGOTO</a>) {</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a21c057f81ff8b02eb1120410ae86e657">ast_channel_clear_softhangup</a>(c, AST_SOFTHANGUP_ASYNCGOTO);</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;         }</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#adac99999f1e55833e7f903979d67b48b">ast_channel_softhangup_internal_flag</a>(c) &amp; <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a90cd950abc1c22b0701a476bdd6cc246">AST_SOFTHANGUP_TIMEOUT</a>) {</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;T&quot;</span>, 1,</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;               <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#afbc14f8c1eb89e675d42e8d7fe33d276">set_ext_pri</a>(c, <span class="stringliteral">&quot;T&quot;</span>, 1);</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;               <span class="comment">/* If the AbsoluteTimeout is not reset to 0, we&#39;ll get an infinite loop */</span></div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;               memset(<a class="code" href="../../d5/d7b/channel_8h.html#ae616309e9eba6a1b009a0466bada50cc">ast_channel_whentohangup</a>(c), 0, <span class="keyword">sizeof</span>(*<a class="code" href="../../d5/d7b/channel_8h.html#ae616309e9eba6a1b009a0466bada50cc">ast_channel_whentohangup</a>(c)));</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a21c057f81ff8b02eb1120410ae86e657">ast_channel_clear_softhangup</a>(c, AST_SOFTHANGUP_TIMEOUT);</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;e&quot;</span>, 1,</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;               <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a7621524948e1703e981c745c74c14d01">raise_exception</a>(c, <span class="stringliteral">&quot;ABSOLUTETIMEOUT&quot;</span>, 1);</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;               <span class="comment">/* If the AbsoluteTimeout is not reset to 0, we&#39;ll get an infinite loop */</span></div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;               memset(<a class="code" href="../../d5/d7b/channel_8h.html#ae616309e9eba6a1b009a0466bada50cc">ast_channel_whentohangup</a>(c), 0, <span class="keyword">sizeof</span>(*<a class="code" href="../../d5/d7b/channel_8h.html#ae616309e9eba6a1b009a0466bada50cc">ast_channel_whentohangup</a>(c)));</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a21c057f81ff8b02eb1120410ae86e657">ast_channel_clear_softhangup</a>(c, AST_SOFTHANGUP_TIMEOUT);</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;            }</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;            <span class="comment">/* Call timed out with no special extension to jump to. */</span></div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;            error = 1;</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;         }</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Extension %s, priority %d returned normally even though call was hung up\n&quot;</span>,</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(c));</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;         error = 1;</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;      } <span class="comment">/* end while  - from here on we can use &#39;break&#39; to go out */</span></div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;      <span class="keywordflow">if</span> (found &amp;&amp; res) {</div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;         <span class="comment">/* Something bad happened, or a hangup has been requested. */</span></div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;         <span class="keywordflow">if</span> (strchr(<span class="stringliteral">&quot;0123456789ABCDEF*#&quot;</span>, res)) {</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, got something to jump out with (&#39;%c&#39;)!\n&quot;</span>, res);</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;            pos = 0;</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;            dst_exten[pos++] = digit = res;</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;            dst_exten[pos] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == <a class="code" href="../../db/de0/pbx_8h.html#a653bef57d41c00d6b1f79c94fe19ec7b">AST_PBX_INCOMPLETE</a>) {</div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Spawn extension (%s,%s,%d) exited INCOMPLETE on &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c));</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Spawn extension (%s, %s, %d) exited INCOMPLETE on &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c));</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;            <span class="comment">/* Don&#39;t cycle on incomplete - this will happen if the only extension that matches is our &quot;incomplete&quot; extension */</span></div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../db/d94/pbx_8c.html#ac359af75b9494f50904583d2168a7577">ast_matchmore_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), 1,</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;               <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;               invalid = 1;</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;               <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(dst_exten, <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <span class="keyword">sizeof</span>(dst_exten));</div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;               digit = 1;</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;               pos = strlen(dst_exten);</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;            }</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Spawn extension (%s,%s,%d) exited non-zero on &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c));</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Spawn extension (%s, %s, %d) exited non-zero on &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c));</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;            <span class="keywordflow">if</span> ((res == <a class="code" href="../../db/de0/pbx_8h.html#aabc320b5f03ccc254bde047d2e2ec0e0">AST_PBX_ERROR</a>)</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;               &amp;&amp; <a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;e&quot;</span>, 1,</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;                  <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;               <span class="comment">/* if we are already on the &#39;e&#39; exten, don&#39;t jump to it again */</span></div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;               <span class="keywordflow">if</span> (!strcmp(<a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <span class="stringliteral">&quot;e&quot;</span>)) {</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Spawn extension (%s, %s, %d) exited ERROR while already on &#39;e&#39; exten on &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c));</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;                  error = 1;</div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#a7621524948e1703e981c745c74c14d01">raise_exception</a>(c, <span class="stringliteral">&quot;ERROR&quot;</span>, 1);</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;                  <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;               }</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;            }</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#adac99999f1e55833e7f903979d67b48b">ast_channel_softhangup_internal_flag</a>(c) &amp; <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a085c0c603de12dc2474a17a92e1cb5a4">AST_SOFTHANGUP_ASYNCGOTO</a>) {</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a21c057f81ff8b02eb1120410ae86e657">ast_channel_clear_softhangup</a>(c, AST_SOFTHANGUP_ASYNCGOTO);</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;            }</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#adac99999f1e55833e7f903979d67b48b">ast_channel_softhangup_internal_flag</a>(c) &amp; <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a90cd950abc1c22b0701a476bdd6cc246">AST_SOFTHANGUP_TIMEOUT</a>) {</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;T&quot;</span>, 1,</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;                  <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#afbc14f8c1eb89e675d42e8d7fe33d276">set_ext_pri</a>(c, <span class="stringliteral">&quot;T&quot;</span>, 1);</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;                  <span class="comment">/* If the AbsoluteTimeout is not reset to 0, we&#39;ll get an infinite loop */</span></div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;                  memset(<a class="code" href="../../d5/d7b/channel_8h.html#ae616309e9eba6a1b009a0466bada50cc">ast_channel_whentohangup</a>(c), 0, <span class="keyword">sizeof</span>(*<a class="code" href="../../d5/d7b/channel_8h.html#ae616309e9eba6a1b009a0466bada50cc">ast_channel_whentohangup</a>(c)));</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#a21c057f81ff8b02eb1120410ae86e657">ast_channel_clear_softhangup</a>(c, AST_SOFTHANGUP_TIMEOUT);</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;                  <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;e&quot;</span>, 1,</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;                  <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#a7621524948e1703e981c745c74c14d01">raise_exception</a>(c, <span class="stringliteral">&quot;ABSOLUTETIMEOUT&quot;</span>, 1);</div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;                  <span class="comment">/* If the AbsoluteTimeout is not reset to 0, we&#39;ll get an infinite loop */</span></div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;                  memset(<a class="code" href="../../d5/d7b/channel_8h.html#ae616309e9eba6a1b009a0466bada50cc">ast_channel_whentohangup</a>(c), 0, <span class="keyword">sizeof</span>(*<a class="code" href="../../d5/d7b/channel_8h.html#ae616309e9eba6a1b009a0466bada50cc">ast_channel_whentohangup</a>(c)));</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#a21c057f81ff8b02eb1120410ae86e657">ast_channel_clear_softhangup</a>(c, AST_SOFTHANGUP_TIMEOUT);</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;                  <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;               }</div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;               <span class="comment">/* Call timed out with no special extension to jump to. */</span></div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;            }</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;            error = 1;</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;         }</div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;      }</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;      <span class="keywordflow">if</span> (error)</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;<span class="comment">      /*!\note</span></div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;<span class="comment">       * We get here on a failure of some kind:  non-existing extension or</span></div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;<span class="comment">       * hangup.  We have options, here.  We can either catch the failure</span></div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;<span class="comment">       * and continue, or we can drop out entirely. */</span></div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;      <span class="keywordflow">if</span> (invalid</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;         || (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(dst_exten) &amp;&amp;</div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;            !<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), 1,</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)))) {<span class="comment"></span></div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;<span class="comment">         /*!\note</span></div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;<span class="comment">          * If there is no match at priority 1, it is not a valid extension anymore.</span></div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;<span class="comment">          * Try to continue at &quot;i&quot; (for invalid) or &quot;e&quot; (for exception) or exit if</span></div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;<span class="comment">          * neither exist.</span></div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;i&quot;</span>, 1,</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Channel &#39;%s&#39; sent to invalid extension: context,exten,priority=%s,%s,%d\n&quot;</span>,</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(c));</div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;            <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(c, <span class="stringliteral">&quot;INVALID_EXTEN&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c));</div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#afbc14f8c1eb89e675d42e8d7fe33d276">set_ext_pri</a>(c, <span class="stringliteral">&quot;i&quot;</span>, 1);</div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;e&quot;</span>, 1,</div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a7621524948e1703e981c745c74c14d01">raise_exception</a>(c, <span class="stringliteral">&quot;INVALID&quot;</span>, 1);</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &#39;%s&#39; sent to invalid extension but no invalid handler: context,exten,priority=%s,%s,%d\n&quot;</span>,</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(c));</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;            error = 1; <span class="comment">/* we know what to do with it */</span></div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;         }</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#adac99999f1e55833e7f903979d67b48b">ast_channel_softhangup_internal_flag</a>(c) &amp; <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a90cd950abc1c22b0701a476bdd6cc246">AST_SOFTHANGUP_TIMEOUT</a>) {</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;         <span class="comment">/* If we get this far with AST_SOFTHANGUP_TIMEOUT, then we know that the &quot;T&quot; extension is next. */</span></div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a21c057f81ff8b02eb1120410ae86e657">ast_channel_clear_softhangup</a>(c, AST_SOFTHANGUP_TIMEOUT);</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">/* keypress received, get more digits for a full extension */</span></div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;         <span class="keywordtype">int</span> waittime = 0;</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;         <span class="keywordflow">if</span> (digit)</div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;            waittime = <a class="code" href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a>(c)-&gt;<a class="code" href="../../d6/d83/structast__pbx.html#a80a133d151de25445e8dfd09953a0872">dtimeoutms</a>;</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!autofallthrough)</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;            waittime = <a class="code" href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a>(c)-&gt;<a class="code" href="../../d6/d83/structast__pbx.html#a765bfb11e07b0f90c235c9af9d7f46fa">rtimeoutms</a>;</div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;         <span class="keywordflow">if</span> (!waittime) {</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a> = <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(c, <span class="stringliteral">&quot;DIALSTATUS&quot;</span>);</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;            <span class="keywordflow">if</span> (!status)</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;               status = <span class="stringliteral">&quot;UNKNOWN&quot;</span>;</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Auto fallthrough, channel &#39;%s&#39; status is &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c), status);</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;            <span class="keywordflow">if</span> (!strcasecmp(status, <span class="stringliteral">&quot;CONGESTION&quot;</span>))</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;               res = <a class="code" href="../../d9/dc9/group__applications.html#gab06d7e57a1b08e84ac9be5343dde2074">indicate_congestion</a>(c, <span class="stringliteral">&quot;10&quot;</span>);</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(status, <span class="stringliteral">&quot;CHANUNAVAIL&quot;</span>))</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;               res = <a class="code" href="../../d9/dc9/group__applications.html#gab06d7e57a1b08e84ac9be5343dde2074">indicate_congestion</a>(c, <span class="stringliteral">&quot;10&quot;</span>);</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(status, <span class="stringliteral">&quot;BUSY&quot;</span>))</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;               res = <a class="code" href="../../d9/dc9/group__applications.html#ga1388863a3809fb197d2c1c2748c02e7f">indicate_busy</a>(c, <span class="stringliteral">&quot;10&quot;</span>);</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;            error = 1; <span class="comment">/* XXX disable message */</span></div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;            <span class="keywordflow">break</span>;   <span class="comment">/* exit from the &#39;for&#39; loop */</span></div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;         }</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#aed1020578edff9baad853fc543464432">collect_digits</a>(c, waittime, dst_exten, <span class="keyword">sizeof</span>(dst_exten), pos))</div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;         <span class="keywordflow">if</span> (res == <a class="code" href="../../db/de0/pbx_8h.html#a653bef57d41c00d6b1f79c94fe19ec7b">AST_PBX_INCOMPLETE</a> &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(&amp;dst_exten[pos]))</div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;            timeout = 1;</div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;         <span class="keywordflow">if</span> (!timeout</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;            &amp;&amp; <a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), dst_exten, 1,</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;               <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) { <span class="comment">/* Prepare the next cycle */</span></div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#afbc14f8c1eb89e675d42e8d7fe33d276">set_ext_pri</a>(c, dst_exten, 1);</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;            <span class="comment">/* No such extension */</span></div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;            <span class="keywordflow">if</span> (!timeout &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(dst_exten)) {</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;               <span class="comment">/* An invalid extension */</span></div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;i&quot;</span>, 1,</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;                  <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Invalid extension &#39;%s&#39; in context &#39;%s&#39; on %s\n&quot;</span>, dst_exten, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c));</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;                  <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(c, <span class="stringliteral">&quot;INVALID_EXTEN&quot;</span>, dst_exten);</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#afbc14f8c1eb89e675d42e8d7fe33d276">set_ext_pri</a>(c, <span class="stringliteral">&quot;i&quot;</span>, 1);</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;e&quot;</span>, 1,</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;                  <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#a7621524948e1703e981c745c74c14d01">raise_exception</a>(c, <span class="stringliteral">&quot;INVALID&quot;</span>, 1);</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;                     <span class="stringliteral">&quot;Invalid extension &#39;%s&#39;, but no rule &#39;i&#39; or &#39;e&#39; in context &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;                     dst_exten, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c));</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;                  found = 1; <span class="comment">/* XXX disable message */</span></div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;               }</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;               <span class="comment">/* A simple timeout */</span></div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;t&quot;</span>, 1,</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;                  <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Timeout on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c));</div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#afbc14f8c1eb89e675d42e8d7fe33d276">set_ext_pri</a>(c, <span class="stringliteral">&quot;t&quot;</span>, 1);</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;e&quot;</span>, 1,</div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;                  <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#a7621524948e1703e981c745c74c14d01">raise_exception</a>(c, <span class="stringliteral">&quot;RESPONSETIMEOUT&quot;</span>, 1);</div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;                     <span class="stringliteral">&quot;Timeout, but no rule &#39;t&#39; or &#39;e&#39; in context &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;                     <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c));</div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;                  found = 1; <span class="comment">/* XXX disable message */</span></div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;               }</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;            }</div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;         }</div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;      }</div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;   }</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;   <span class="keywordflow">if</span> (!found &amp;&amp; !error) {</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&#39;t know what to do with &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c));</div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;   }</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;</div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;   <span class="keywordflow">if</span> (!args || !args-&gt;<a class="code" href="../../da/db8/structast__pbx__args.html#a0449b0be05342e431e60937c47fc52f7">no_hangup_chan</a>) {</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b">ast_softhangup</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4aeeafae6abd77156800ec76b0ff7d3867">AST_SOFTHANGUP_APPUNLOAD</a>);</div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a3f96b2798b1f93fa27bc2dff7dfd9a26">AST_FLAG_BRIDGE_HANGUP_RUN</a>)</div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;         &amp;&amp; <a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c), <span class="stringliteral">&quot;h&quot;</span>, 1,</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid,</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(c)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a90b8895bf6b299c1b844a57c2ea10348">ast_pbx_h_exten_run</a>(c, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(c));</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;      }</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#adc4d340f4e9d60ef5fbfd93a0e6f9c33">ast_pbx_hangup_handler_run</a>(c);</div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;   }</div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(c);</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(c), autoloopflag, <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>);</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(c), <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a3f96b2798b1f93fa27bc2dff7dfd9a26">AST_FLAG_BRIDGE_HANGUP_RUN</a>); <span class="comment">/* from one round to the next, make sure this gets cleared */</span></div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(c);</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a1a7e2b65d9fc687fe40a8dbcefa7bc4e">pbx_destroy</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a>(c));</div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af89b0f98c227230d7180a90627c0901c">ast_channel_pbx_set</a>(c, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;</div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;   <span class="keywordflow">if</span> (!args || !args-&gt;<a class="code" href="../../da/db8/structast__pbx__args.html#a0449b0be05342e431e60937c47fc52f7">no_hangup_chan</a>) {</div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(c);</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;   }</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4">AST_PBX_SUCCESS</a>;</div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;}</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;<span class="comment"> * \brief Increase call count for channel</span></div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;<span class="comment"> * \retval 0 on success</span></div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;<span class="comment"> * \retval non-zero if a configured limit (maxcalls, maxload, minmemfree) was reached</span></div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l04621"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a829520d1350a9bfcd02e2106e5a22a24"> 4621</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a829520d1350a9bfcd02e2106e5a22a24">increase_call_count</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>)</div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;{</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;   <span class="keywordtype">int</span> failed = 0;</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;   <span class="keywordtype">double</span> curloadavg;</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;<span class="preprocessor">#if defined(HAVE_SYSINFO)</span></div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;   <span class="keyword">struct </span>sysinfo sys_info;</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a55c3f21eda54c35107729cd65e482aec">maxcalllock</a>);</div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dd6/group__main__options.html#ga6d3ecf74255f4bfc355ebd1540c316c1">ast_option_maxcalls</a>) {</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;      <span class="keywordflow">if</span> (countcalls &gt;= <a class="code" href="../../d6/dd6/group__main__options.html#ga6d3ecf74255f4bfc355ebd1540c316c1">ast_option_maxcalls</a>) {</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Maximum call limit of %d calls exceeded by &#39;%s&#39;!\n&quot;</span>, <a class="code" href="../../d6/dd6/group__main__options.html#ga6d3ecf74255f4bfc355ebd1540c316c1">ast_option_maxcalls</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c));</div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;         failed = -1;</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;      }</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;   }</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dd6/group__main__options.html#ga908239c63cc433cbefa4aa6f5efcb830">ast_option_maxload</a>) {</div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;      <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40e0da58ab6964e3264b90f79ad6d476">getloadavg</a>(&amp;curloadavg, 1);</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;      <span class="keywordflow">if</span> (curloadavg &gt;= <a class="code" href="../../d6/dd6/group__main__options.html#ga908239c63cc433cbefa4aa6f5efcb830">ast_option_maxload</a>) {</div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Maximum loadavg limit of %f load exceeded by &#39;%s&#39; (currently %f)!\n&quot;</span>, <a class="code" href="../../d6/dd6/group__main__options.html#ga908239c63cc433cbefa4aa6f5efcb830">ast_option_maxload</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(c), curloadavg);</div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;         failed = -1;</div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;      }</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;   }</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;<span class="preprocessor">#if defined(HAVE_SYSINFO)</span></div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dd6/group__main__options.html#gade53ca08a5e71308f410de870fa7338b">option_minmemfree</a>) {</div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;      <span class="comment">/* Make sure that the free system memory is above the configured low watermark */</span></div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;      <span class="keywordflow">if</span> (!sysinfo(&amp;sys_info)) {</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;         <span class="comment">/* Convert the amount of available RAM from mem_units to MB. The calculation</span></div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;<span class="comment">          * was done this way to avoid overflow problems */</span></div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;         uint64_t curfreemem = sys_info.freeram + sys_info.bufferram;</div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;         curfreemem *= sys_info.mem_unit;</div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;         curfreemem /= 1024 * 1024;</div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;         <span class="keywordflow">if</span> (curfreemem &lt; <a class="code" href="../../d6/dd6/group__main__options.html#gade53ca08a5e71308f410de870fa7338b">option_minmemfree</a>) {</div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Available system memory (~%&quot;</span> PRIu64 <span class="stringliteral">&quot;MB) is below the configured low watermark (%ldMB)\n&quot;</span>,</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;               curfreemem, <a class="code" href="../../d6/dd6/group__main__options.html#gade53ca08a5e71308f410de870fa7338b">option_minmemfree</a>);</div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;            failed = -1;</div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;         }</div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;      }</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;   }</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;</div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;   <span class="keywordflow">if</span> (!failed) {</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;      countcalls++;</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;      totalcalls++;</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;   }</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a55c3f21eda54c35107729cd65e482aec">maxcalllock</a>);</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;   <span class="keywordflow">return</span> failed;</div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;}</div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;</div><div class="line"><a name="l04670"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3bf2bd297c32c358066446ceb1f4551b"> 4670</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a3bf2bd297c32c358066446ceb1f4551b">decrease_call_count</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;{</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a55c3f21eda54c35107729cd65e482aec">maxcalllock</a>);</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;   <span class="keywordflow">if</span> (countcalls &gt; 0)</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;      countcalls--;</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a55c3f21eda54c35107729cd65e482aec">maxcalllock</a>);</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;}</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;</div><div class="line"><a name="l04678"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae25a2122becbf9b94f5d55bc86753fea"> 4678</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#ae25a2122becbf9b94f5d55bc86753fea">destroy_exten</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e)</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;{</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> == <a class="code" href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>)</div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a8fcc10d31d51afba693ef9a4cb162c6a">ast_remove_hint</a>(e);</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>)</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;      <a class="code" href="../../d6/da0/hashtab_8h.html#a6103589badf8d9440a0cece2802c4c3a">ast_hashtab_destroy</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>,0);</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>)</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;      <a class="code" href="../../d6/da0/hashtab_8h.html#a6103589badf8d9440a0cece2802c4c3a">ast_hashtab_destroy</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>, 0);</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>)</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;      e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>);</div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(e);</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;}</div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;</div><div class="line"><a name="l04692"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a61bf09bfdadba04e51d6576aa014e097"> 4692</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../db/d94/pbx_8c.html#a61bf09bfdadba04e51d6576aa014e097">pbx_thread</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;{</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;   <span class="comment">/* Oh joyeous kernel, we&#39;re a new thread, with nothing to do but</span></div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;<span class="comment">      answer this channel and get it going.</span></div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;   <span class="comment">/* NOTE:</span></div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;<span class="comment">      The launcher of this function _MUST_ increment &#39;countcalls&#39;</span></div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;<span class="comment">      before invoking the function; it will be decremented when the</span></div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;<span class="comment">      PBX has finished running on the channel</span></div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a> = <a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>;</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ab203ba8e71a7c11736a40f7967ba1fdf">__ast_pbx_run</a>(c, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a3bf2bd297c32c358066446ceb1f4551b">decrease_call_count</a>();</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;   pthread_exit(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;</div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;}</div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;</div><div class="line"><a name="l04712"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a9a937fbb3b5f4e68880a9c5714a29ce5"> 4712</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a> <a class="code" href="../../db/d94/pbx_8c.html#a9a937fbb3b5f4e68880a9c5714a29ce5">ast_pbx_start</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>)</div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;{</div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;   pthread_t t;</div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;   <span class="keywordflow">if</span> (!c) {</div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Asked to start thread on NULL channel?\n&quot;</span>);</div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490">AST_PBX_FAILED</a>;</div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;   }</div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;</div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;<a class="code" href="../../d6/dd6/group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a>, <a class="code" href="../../d6/dd6/group__main__options.html#gaf2588453b3a373a770741ad3ce353343ade4cf3231c69af57ad0527bd46244680">AST_OPT_FLAG_FULLY_BOOTED</a>)) {</div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;PBX requires Asterisk to be fully booted\n&quot;</span>);</div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490">AST_PBX_FAILED</a>;</div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;   }</div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;</div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a829520d1350a9bfcd02e2106e5a22a24">increase_call_count</a>(c))</div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5">AST_PBX_CALL_LIMIT</a>;</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;   <span class="comment">/* Start a new thread, and get something handling this channel. */</span></div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;t, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d94/pbx_8c.html#a61bf09bfdadba04e51d6576aa014e097">pbx_thread</a>, c)) {</div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to create new channel thread\n&quot;</span>);</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a3bf2bd297c32c358066446ceb1f4551b">decrease_call_count</a>();</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490">AST_PBX_FAILED</a>;</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;   }</div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;</div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4">AST_PBX_SUCCESS</a>;</div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;}</div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;</div><div class="line"><a name="l04739"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a2c502c100b8b4791d9efe395e08d620b"> 4739</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a> <a class="code" href="../../db/d94/pbx_8c.html#a2c502c100b8b4791d9efe395e08d620b">ast_pbx_run_args</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, <span class="keyword">struct</span> <a class="code" href="../../da/db8/structast__pbx__args.html">ast_pbx_args</a> *<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>)</div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;{</div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a> res = <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4">AST_PBX_SUCCESS</a>;</div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;<a class="code" href="../../d6/dd6/group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a>, <a class="code" href="../../d6/dd6/group__main__options.html#gaf2588453b3a373a770741ad3ce353343ade4cf3231c69af57ad0527bd46244680">AST_OPT_FLAG_FULLY_BOOTED</a>)) {</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;PBX requires Asterisk to be fully booted\n&quot;</span>);</div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490">AST_PBX_FAILED</a>;</div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;   }</div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;</div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a829520d1350a9bfcd02e2106e5a22a24">increase_call_count</a>(c)) {</div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5">AST_PBX_CALL_LIMIT</a>;</div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;   }</div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;</div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;   res = <a class="code" href="../../db/d94/pbx_8c.html#ab203ba8e71a7c11736a40f7967ba1fdf">__ast_pbx_run</a>(c, args);</div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;</div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a3bf2bd297c32c358066446ceb1f4551b">decrease_call_count</a>();</div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;</div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;}</div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;</div><div class="line"><a name="l04759"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a44b6406c9220f7f2b610ac712369f405"> 4759</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a> <a class="code" href="../../db/d94/pbx_8c.html#a44b6406c9220f7f2b610ac712369f405">ast_pbx_run</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>)</div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;{</div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a2c502c100b8b4791d9efe395e08d620b">ast_pbx_run_args</a>(c, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;}</div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;</div><div class="line"><a name="l04764"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a52a37e9e2d9a1482ef5b7d91001b61ac"> 4764</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a52a37e9e2d9a1482ef5b7d91001b61ac">ast_active_calls</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;{</div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a098053e0fabe1ebd3f0b70fd7c9f8a71">countcalls</a>;</div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;}</div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;</div><div class="line"><a name="l04769"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a6cd4c64e374623ea3393fbc5d580f68e"> 4769</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a6cd4c64e374623ea3393fbc5d580f68e">ast_processed_calls</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;{</div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a078330b9a32065ec6a0c0731c06719cd">totalcalls</a>;</div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;}</div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;</div><div class="line"><a name="l04774"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aeb0407c693573096981db1a00fab4eb8"> 4774</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aeb0407c693573096981db1a00fab4eb8">pbx_set_autofallthrough</a>(<span class="keywordtype">int</span> newval)</div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;{</div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;   <span class="keywordtype">int</span> oldval = <a class="code" href="../../db/d94/pbx_8c.html#a5f7ea48b3f8614ef9314e5aece1f1bc3">autofallthrough</a>;</div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;   autofallthrough = newval;</div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;   <span class="keywordflow">return</span> oldval;</div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;}</div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;</div><div class="line"><a name="l04781"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a86a7469073a22661d4db7086245c5b18"> 4781</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a86a7469073a22661d4db7086245c5b18">pbx_set_extenpatternmatchnew</a>(<span class="keywordtype">int</span> newval)</div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;{</div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;   <span class="keywordtype">int</span> oldval = <a class="code" href="../../db/d94/pbx_8c.html#a3a7600857afccfa4f7a5c55dcaec8407">extenpatternmatchnew</a>;</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;   extenpatternmatchnew = newval;</div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;   <span class="keywordflow">return</span> oldval;</div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;}</div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;</div><div class="line"><a name="l04788"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a7a46e2644221be6cb7ca7ba2723006cd"> 4788</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a7a46e2644221be6cb7ca7ba2723006cd">pbx_set_overrideswitch</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *newval)</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;{</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;   <span class="keywordflow">if</span> (overrideswitch) {</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(overrideswitch);</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;   }</div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(newval)) {</div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;      overrideswitch = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(newval);</div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;      overrideswitch = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;   }</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;}</div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;<span class="comment"> * \brief lookup for a context with a given name,</span></div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;<span class="comment"> * \retval found context or NULL if not found.</span></div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04804"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae295e363d292aafe65f327e628d90dcd"> 4804</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../db/d94/pbx_8c.html#ae295e363d292aafe65f327e628d90dcd">find_context</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context)</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;{</div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/da7/structfake__context.html">fake_context</a> item;</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(item.<a class="code" href="../../d6/da7/structfake__context.html#a8e03167ce04350be901b028cc4cf1ce1">name</a>, context, <span class="keyword">sizeof</span>(item.<a class="code" href="../../d6/da7/structfake__context.html#a8e03167ce04350be901b028cc4cf1ce1">name</a>));</div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;</div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(contexts_table, &amp;item);</div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;}</div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;<span class="comment"> * \brief lookup for a context with a given name,</span></div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;<span class="comment"> * \retval with conlock held if found.</span></div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;<span class="comment"> * \retval NULL if not found.</span></div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04818"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d"> 4818</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context)</div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;{</div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/da7/structfake__context.html">fake_context</a> item;</div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;</div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(item.<a class="code" href="../../d6/da7/structfake__context.html#a8e03167ce04350be901b028cc4cf1ce1">name</a>, context, <span class="keyword">sizeof</span>(item.<a class="code" href="../../d6/da7/structfake__context.html#a8e03167ce04350be901b028cc4cf1ce1">name</a>));</div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;</div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>();</div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;   c = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(contexts_table, &amp;item);</div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;   <span class="keywordflow">if</span> (!c) {</div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;   }</div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;</div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;}</div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;<span class="comment"> * \brief Remove included contexts.</span></div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;<span class="comment"> * This function locks contexts list by &amp;conlist, search for the right context</span></div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;<span class="comment"> * structure, leave context list locked and call ast_context_remove_include2</span></div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;<span class="comment"> * which removes include, unlock contexts list and return ...</span></div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04840"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#acec5cab19e772712434bf03875b57e9a"> 4840</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#acec5cab19e772712434bf03875b57e9a">ast_context_remove_include</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *include, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>)</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;{</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;   c = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(context);</div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;   <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;      <span class="comment">/* found, remove include from this context ... */</span></div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;      ret = <a class="code" href="../../db/d94/pbx_8c.html#a8c23053e0d4d87545a93ec837a19b908">ast_context_remove_include2</a>(c, include, registrar);</div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;   }</div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;}</div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;<span class="comment"> * \brief Locks context, remove included contexts, unlocks context.</span></div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;<span class="comment"> * When we call this function, &amp;conlock lock must be locked, because when</span></div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;<span class="comment"> * we giving *con argument, some process can remove/change this context</span></div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;<span class="comment"> * and after that there can be segfault.</span></div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;<span class="comment"> * \retval -1 on failure.</span></div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04863"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a8c23053e0d4d87545a93ec837a19b908"> 4863</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a8c23053e0d4d87545a93ec837a19b908">ast_context_remove_include2</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *include, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>)</div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;{</div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;</div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a>(con);</div><div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;</div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;   <span class="comment">/* find our include */</span></div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(con); idx++) {</div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *i = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">includes</a>, idx);</div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;</div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;      <span class="keywordflow">if</span> (!strcmp(<a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i), include) &amp;&amp;</div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;            (!registrar || !strcmp(<a class="code" href="../../db/de0/pbx_8h.html#a2bf7469cd4b7de5d4de43d58aeff46c5">ast_get_include_registrar</a>(i), registrar))) {</div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;</div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;         <span class="comment">/* remove from list */</span></div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Removing inclusion of context &#39;%s&#39; in context &#39;%s; registrar=%s&#39;\n&quot;</span>, include, <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(con), registrar);</div><div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;         <a class="code" href="../../d6/d68/vector_8h.html#a0414ce2ed1741b1e048ccafc0df420c3">AST_VECTOR_REMOVE_ORDERED</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">includes</a>, idx);</div><div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;</div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;         <span class="comment">/* free include and return */</span></div><div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;         <a class="code" href="../../d6/d0e/pbx__include_8c.html#a074a4f22541e1231de75d69e37fc4adf">include_free</a>(i);</div><div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;         ret = 0;</div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;      }</div><div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;   }</div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;</div><div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;</div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;}</div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;<span class="comment"> * \note This function locks contexts list by &amp;conlist, search for the rigt context</span></div><div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;<span class="comment"> * structure, leave context list locked and call ast_context_remove_switch2</span></div><div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;<span class="comment"> * which removes switch, unlock contexts list and return ...</span></div><div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04898"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a9800750a3fb79caa282c98556473f392"> 4898</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a9800750a3fb79caa282c98556473f392">ast_context_remove_switch</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *sw, <span class="keyword">const</span> <span class="keywordtype">char</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>)</div><div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;{</div><div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;   <span class="keywordtype">int</span> ret = -1; <span class="comment">/* default error return */</span></div><div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;</div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;   c = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(context);</div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;   <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;      <span class="comment">/* remove switch from this context ... */</span></div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;      ret = <a class="code" href="../../db/d94/pbx_8c.html#a23a51e49bea958a8d27c61f2a51931d9">ast_context_remove_switch2</a>(c, sw, data, registrar);</div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;   }</div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;}</div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;<span class="comment"> * \brief This function locks given context, removes switch, unlock context and</span></div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;<span class="comment"> * return.</span></div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;<span class="comment"> * \note When we call this function, &amp;conlock lock must be locked, because when</span></div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;<span class="comment"> * we giving *con argument, some process can remove/change this context</span></div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;<span class="comment"> * and after that there can be segfault.</span></div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04920"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a23a51e49bea958a8d27c61f2a51931d9"> 4920</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a23a51e49bea958a8d27c61f2a51931d9">ast_context_remove_switch2</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *sw, <span class="keyword">const</span> <span class="keywordtype">char</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>)</div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;{</div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;</div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a>(con);</div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;</div><div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;   <span class="comment">/* walk switches */</span></div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a>(con); idx++) {</div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *i = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">alts</a>, idx);</div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;</div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;      <span class="keywordflow">if</span> (!strcmp(<a class="code" href="../../db/de0/pbx_8h.html#aa0ebd34e8d1605aa4b6e3fadea6adfb5">ast_get_switch_name</a>(i), sw) &amp;&amp;</div><div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;         !strcmp(<a class="code" href="../../db/de0/pbx_8h.html#ad4f9fd5bd7afc28347c808ea295233e8">ast_get_switch_data</a>(i), data) &amp;&amp;</div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;         (!registrar || !strcmp(<a class="code" href="../../db/de0/pbx_8h.html#a3d45d3b9bc79bf6ffb1540f3e815f677">ast_get_switch_registrar</a>(i), registrar))) {</div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;</div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;         <span class="comment">/* found, remove from list */</span></div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Removing switch &#39;%s&#39; from context &#39;%s; registrar=%s&#39;\n&quot;</span>, sw, <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(con), registrar);</div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;         <a class="code" href="../../d6/d68/vector_8h.html#a0414ce2ed1741b1e048ccafc0df420c3">AST_VECTOR_REMOVE_ORDERED</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">alts</a>, idx);</div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;</div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;         <span class="comment">/* free switch and return */</span></div><div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;         <a class="code" href="../../d9/da0/pbx__private_8h.html#acd29668e92f96d142fe8d058db4ed773">sw_free</a>(i);</div><div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;         ret = 0;</div><div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;      }</div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;   }</div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;</div><div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;</div><div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;}</div><div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;<span class="comment">/*! \note This function will lock conlock. */</span></div><div class="line"><a name="l04952"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a721c6ba091102f155a586e09b2a526bf"> 4952</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a721c6ba091102f155a586e09b2a526bf">ast_context_remove_extension</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *extension, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>)</div><div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;{</div><div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#aea78542f089fbd63ff25147631b96e51">ast_context_remove_extension_callerid</a>(context, extension, priority, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a37db4d8017d05366c5b19084c5c5c84c">AST_EXT_MATCHCID_ANY</a>, registrar);</div><div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;}</div><div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;</div><div class="line"><a name="l04957"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aea78542f089fbd63ff25147631b96e51"> 4957</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aea78542f089fbd63ff25147631b96e51">ast_context_remove_extension_callerid</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *extension, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid, <span class="keywordtype">int</span> matchcallerid, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>)</div><div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;{</div><div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;   <span class="keywordtype">int</span> ret = -1; <span class="comment">/* default error return */</span></div><div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;</div><div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;   c = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(context);</div><div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;   <span class="keywordflow">if</span> (c) { <span class="comment">/* ... remove extension ... */</span></div><div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;      ret = <a class="code" href="../../db/d94/pbx_8c.html#a938a84cd1446c1da1e45b2269c36c9e3">ast_context_remove_extension_callerid2</a>(c, extension, priority, callerid,</div><div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;         matchcallerid, registrar, 0);</div><div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;   }</div><div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;</div><div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;}</div><div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;<span class="comment"> * \brief This functionc locks given context, search for the right extension and</span></div><div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;<span class="comment"> * fires out all peer in this extensions with given priority. If priority</span></div><div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;<span class="comment"> * is set to 0, all peers are removed. After that, unlock context and</span></div><div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;<span class="comment"> * return.</span></div><div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;<span class="comment"> * \note When do you want to call this function, make sure that &amp;conlock is locked,</span></div><div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;<span class="comment"> * because some process can handle with your *con context before you lock</span></div><div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;<span class="comment"> * it.</span></div><div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04982"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a25dad382feec89a9bbc6c5284bb30e25"> 4982</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a25dad382feec89a9bbc6c5284bb30e25">ast_context_remove_extension2</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *extension, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>, <span class="keywordtype">int</span> already_locked)</div><div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;{</div><div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a938a84cd1446c1da1e45b2269c36c9e3">ast_context_remove_extension_callerid2</a>(con, extension, priority, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a37db4d8017d05366c5b19084c5c5c84c">AST_EXT_MATCHCID_ANY</a>, registrar, already_locked);</div><div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;}</div><div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;</div><div class="line"><a name="l04987"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a938a84cd1446c1da1e45b2269c36c9e3"> 4987</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a938a84cd1446c1da1e45b2269c36c9e3">ast_context_remove_extension_callerid2</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *extension, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid, <span class="keywordtype">int</span> matchcallerid, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>, <span class="keywordtype">int</span> already_locked)</div><div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;{</div><div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, *prev_exten = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>;</div><div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> ex, *exten2, *exten3;</div><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;   <span class="keywordtype">char</span> dummy_name[1024];</div><div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;   <span class="keywordtype">char</span> dummy_cid[1024];</div><div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *previous_peer = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *next_peer = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;   <span class="keywordtype">int</span> found = 0;</div><div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;</div><div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;   <span class="keywordflow">if</span> (!already_locked)</div><div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a>(con);</div><div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;</div><div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG</span></div><div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Removing %s/%s/%d%s%s from trees, registrar=%s\n&quot;</span>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, extension, priority, matchcallerid ? <span class="stringliteral">&quot;/&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, matchcallerid ? callerid : <span class="stringliteral">&quot;&quot;</span>, registrar);</div><div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;<span class="preprocessor">#ifdef CONTEXT_DEBUG</span></div><div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;   check_contexts(__FILE__, __LINE__);</div><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;   <span class="comment">/* find this particular extension */</span></div><div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;   ex.<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a> = dummy_name;</div><div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a517e4a9ba0d6233eba58ad0f1307f55c">ext_strncpy</a>(dummy_name, extension, <span class="keyword">sizeof</span>(dummy_name), 1);</div><div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;   ex.<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> = matchcallerid;</div><div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;   <span class="keywordflow">if</span> (callerid) {</div><div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;      ex.<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a> = dummy_cid;</div><div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a517e4a9ba0d6233eba58ad0f1307f55c">ext_strncpy</a>(dummy_cid, callerid, <span class="keyword">sizeof</span>(dummy_cid), 1);</div><div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;      ex.<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;   }</div><div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;   exten = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, &amp;ex);</div><div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;   <span class="keywordflow">if</span> (exten) {</div><div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;      <span class="keywordflow">if</span> (priority == 0) {</div><div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;         exten2 = <a class="code" href="../../d6/da0/hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66">ast_hashtab_remove_this_object</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, exten);</div><div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;         <span class="keywordflow">if</span> (!exten2)</div><div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Trying to delete the exten %s from context %s, but could not remove from the root_table\n&quot;</span>, extension, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;         <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>) {</div><div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a> = <a class="code" href="../../db/d94/pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a>(con, exten, 1);</div><div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;</div><div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;            <span class="keywordflow">if</span> (x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) { <span class="comment">/* this test for safety purposes */</span></div><div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;               x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a> = 1; <span class="comment">/* with this marked as deleted, it will never show up in the scoreboard, and therefore never be found */</span></div><div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;               x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = 0; <span class="comment">/* get rid of what will become a bad pointer */</span></div><div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Trying to delete an exten from a context, but the pattern tree node returned isn&#39;t a full extension\n&quot;</span>);</div><div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;            }</div><div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;         }</div><div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;         ex.<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = <a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;</div><div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;         exten2 = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, &amp;ex);</div><div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;         <span class="keywordflow">if</span> (exten2) {</div><div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;            <span class="keywordflow">if</span> (exten2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>) { <span class="comment">/* if this exten has a label, remove that, too */</span></div><div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;               exten3 = <a class="code" href="../../d6/da0/hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66">ast_hashtab_remove_this_object</a>(exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>,exten2);</div><div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;               <span class="keywordflow">if</span> (!exten3) {</div><div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Did not remove this priority label (%d/%s) &quot;</span></div><div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;                     <span class="stringliteral">&quot;from the peer_label_table of context %s, extension %s!\n&quot;</span>,</div><div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;                     priority, exten2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, exten2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;               }</div><div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;            }</div><div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;</div><div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;            exten3 = <a class="code" href="../../d6/da0/hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66">ast_hashtab_remove_this_object</a>(exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, exten2);</div><div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;            <span class="keywordflow">if</span> (!exten3) {</div><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Did not remove this priority (%d) from the &quot;</span></div><div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;                  <span class="stringliteral">&quot;peer_table of context %s, extension %s!\n&quot;</span>,</div><div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;                  priority, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, exten2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;            }</div><div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;            <span class="keywordflow">if</span> (exten2 == exten &amp;&amp; exten2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>) {</div><div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;               exten2 = <a class="code" href="../../d6/da0/hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66">ast_hashtab_remove_this_object</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, exten);</div><div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;               <a class="code" href="../../d6/da0/hashtab_8h.html#abd1eaf0229b6a896b795026218c9bde0">ast_hashtab_insert_immediate</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, exten2-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>);</div><div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;            }</div><div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/da0/hashtab_8h.html#ac3452d3a8bca5b4f2611bb96b7a44f31">ast_hashtab_size</a>(exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>) == 0) {</div><div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;               <span class="comment">/* well, if the last priority of an exten is to be removed,</span></div><div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;<span class="comment">                  then, the extension is removed, too! */</span></div><div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;               exten3 = <a class="code" href="../../d6/da0/hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66">ast_hashtab_remove_this_object</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, exten);</div><div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;               <span class="keywordflow">if</span> (!exten3) {</div><div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Did not remove this exten (%s) from the &quot;</span></div><div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;                     <span class="stringliteral">&quot;context root_table (%s) (priority %d)\n&quot;</span>,</div><div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;                     exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, priority);</div><div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;               }</div><div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;               <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>) {</div><div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;                  <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a> = <a class="code" href="../../db/d94/pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a>(con, exten, 1);</div><div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;                  <span class="keywordflow">if</span> (x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) { <span class="comment">/* this test for safety purposes */</span></div><div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;                     x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a> = 1; <span class="comment">/* with this marked as deleted, it will never show up in the scoreboard, and therefore never be found */</span></div><div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;                     x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = 0; <span class="comment">/* get rid of what will become a bad pointer */</span></div><div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;                  }</div><div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;               }</div><div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;            }</div><div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Could not find priority %d of exten %s in context %s!\n&quot;</span>,</div><div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;                  priority, exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;         }</div><div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;      }</div><div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;      <span class="comment">/* hmmm? this exten is not in this pattern tree? */</span></div><div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Cannot find extension %s in root_table in context %s\n&quot;</span>,</div><div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;            extension, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;   }</div><div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;<span class="preprocessor">#ifdef NEED_DEBUG</span></div><div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;   <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>) {</div><div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;match char tree after exten removal:\n&quot;</span>);</div><div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;      log_match_char_tree(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>, <span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;   }</div><div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;</div><div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;   <span class="comment">/* scan the extension list to find first matching extension-registrar */</span></div><div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;   <span class="keywordflow">for</span> (exten = con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a>; exten; prev_exten = exten, exten = exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>) {</div><div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;      <span class="keywordflow">if</span> (!strcmp(exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, ex.<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>) &amp;&amp;</div><div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;         (!matchcallerid ||</div><div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;            (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(ex.<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>) &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>) &amp;&amp; !strcmp(exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>, ex.<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>)) ||</div><div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;            (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(ex.<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>) &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>)))) {</div><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;      }</div><div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;   }</div><div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;   <span class="keywordflow">if</span> (!exten) {</div><div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;      <span class="comment">/* we can&#39;t find right extension */</span></div><div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;      <span class="keywordflow">if</span> (!already_locked)</div><div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;   }</div><div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;</div><div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;   <span class="comment">/* scan the priority list to remove extension with exten-&gt;priority == priority */</span></div><div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;   <span class="keywordflow">for</span> (peer = exten, next_peer = exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> ? exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> : exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;</div><div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;       peer &amp;&amp; !strcmp(peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, ex.<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>) &amp;&amp;</div><div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;         (!callerid || (!matchcallerid &amp;&amp; !peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a>) || (matchcallerid &amp;&amp; peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> &amp;&amp; !strcmp(peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>, ex.<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>))) ;</div><div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;         peer = next_peer, next_peer = next_peer ? (next_peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> ? next_peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> : next_peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>) : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div><div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;</div><div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;      <span class="keywordflow">if</span> ((priority == 0 || peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> == priority) &amp;&amp;</div><div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;            (!registrar || !strcmp(peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>, registrar) )) {</div><div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;         found = 1;</div><div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;</div><div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;         <span class="comment">/* we are first priority extension? */</span></div><div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;         <span class="keywordflow">if</span> (!previous_peer) {</div><div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;<span class="comment">             * We are first in the priority chain, so must update the extension chain.</span></div><div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;<span class="comment">             * The next node is either the next priority or the next extension</span></div><div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *next_node = peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> ? peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> : peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;</div><div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;            <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>) {</div><div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;               <span class="comment">/* move the peer_table and peer_label_table down to the next peer, if</span></div><div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;<span class="comment">                  it is there */</span></div><div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;               peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a> = peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>;</div><div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;               peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a> = peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>;</div><div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;               peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;               peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;            }</div><div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;            <span class="keywordflow">if</span> (!prev_exten) {   <span class="comment">/* change the root... */</span></div><div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;               con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a> = next_node;</div><div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;               prev_exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = next_node; <span class="comment">/* unlink */</span></div><div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;            }</div><div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;            <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>)   { <span class="comment">/* update the new head of the pri list */</span></div><div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;               peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;</div><div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;            }</div><div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;         } <span class="keywordflow">else</span> { <span class="comment">/* easy, we are not first priority in extension */</span></div><div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;            previous_peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> = peer-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>;</div><div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;         }</div><div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;</div><div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;</div><div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;         <span class="comment">/* now, free whole priority extension */</span></div><div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae25a2122becbf9b94f5d55bc86753fea">destroy_exten</a>(peer);</div><div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;         previous_peer = <a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>;</div><div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;      }</div><div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;   }</div><div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;   <span class="keywordflow">if</span> (!already_locked)</div><div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;   <span class="keywordflow">return</span> found ? 0 : -1;</div><div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;}</div><div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;</div><div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;<span class="comment"> * \note This function locks contexts list by &amp;conlist, searches for the right context</span></div><div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;<span class="comment"> * structure, and locks the macrolock mutex in that context.</span></div><div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;<span class="comment"> * macrolock is used to limit a macro to be executed by one call at a time.</span></div><div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;<span class="comment"> * \param context The context</span></div><div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05162"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3bad7413f0be95e52f6a473ddb130fe1"> 5162</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a3bad7413f0be95e52f6a473ddb130fe1">ast_context_lockmacro</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context)</div><div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;{</div><div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;</div><div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;   c = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(context);</div><div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;   <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;</div><div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;      <span class="comment">/* if we found context, lock macrolock */</span></div><div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;      ret = <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;c-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a34eb63008d294b713376e64bb2a7b2ef">macrolock</a>);</div><div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;   }</div><div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;</div><div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;}</div><div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;<span class="comment"> * \note This function locks contexts list by &amp;conlist, searches for the right context</span></div><div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;<span class="comment"> * structure, and unlocks the macrolock mutex in that context.</span></div><div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;<span class="comment"> * macrolock is used to limit a macro to be executed by one call at a time.</span></div><div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;<span class="comment"> * \param context The context</span></div><div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05184"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a27922d2f06d4030fc13ed69587c4c189"> 5184</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a27922d2f06d4030fc13ed69587c4c189">ast_context_unlockmacro</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context)</div><div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;{</div><div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;</div><div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;   c = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(context);</div><div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;   <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;</div><div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;      <span class="comment">/* if we found context, unlock macrolock */</span></div><div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;      ret = <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;c-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a34eb63008d294b713376e64bb2a7b2ef">macrolock</a>);</div><div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;   }</div><div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;</div><div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;}</div><div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;</div><div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;<span class="comment"> * Help for CLI commands ...</span></div><div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;<span class="comment">/*! \brief  handle_show_hints: CLI support for listing registered dial plan hints */</span></div><div class="line"><a name="l05205"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a6a6ee2e0a596361065c15a8795b7ea3d"> 5205</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a6a6ee2e0a596361065c15a8795b7ea3d">handle_show_hints</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;{</div><div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint;</div><div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;   <span class="keywordtype">int</span> num = 0;</div><div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;   <span class="keywordtype">int</span> watchers;</div><div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i;</div><div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>+<a class="code" href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>+2];</div><div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;</div><div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show hints&quot;</span>;</div><div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;         <span class="stringliteral">&quot;Usage: core show hints\n&quot;</span></div><div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;         <span class="stringliteral">&quot;       List registered hints.\n&quot;</span></div><div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;         <span class="stringliteral">&quot;       Hint details are shown in five columns. In order from left to right, they are:\n&quot;</span></div><div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;         <span class="stringliteral">&quot;       1. Hint extension URI.\n&quot;</span></div><div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;         <span class="stringliteral">&quot;       2. List of mapped device or presence state identifiers.\n&quot;</span></div><div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;         <span class="stringliteral">&quot;       3. Current extension state. The aggregate of mapped device states.\n&quot;</span></div><div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;         <span class="stringliteral">&quot;       4. Current presence state for the mapped presence state provider.\n&quot;</span></div><div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;         <span class="stringliteral">&quot;       5. Watchers - number of subscriptions and other entities watching this hint.\n&quot;</span>;</div><div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;   }</div><div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;</div><div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(hints) == 0) {</div><div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;There are no registered dialplan hints\n&quot;</span>);</div><div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;   }</div><div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;   <span class="comment">/* ... we have hints ... */</span></div><div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n    -= Registered Asterisk Dial Plan Hints =-\n&quot;</span>);</div><div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;</div><div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;   i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(hints, 0);</div><div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;   <span class="keywordflow">for</span> (; (hint = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i)); <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1)) {</div><div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;      <span class="keywordflow">if</span> (!hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>) {</div><div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;         <span class="comment">/* The extension has already been destroyed */</span></div><div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;      }</div><div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;      watchers = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>);</div><div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;      snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%s@%s&quot;</span>,</div><div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>),</div><div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<a class="code" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>)));</div><div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;</div><div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-20.20s: %-20.20s  State:%-15.15s Presence:%-15.15s Watchers %2d\n&quot;</span>,</div><div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;         buf,</div><div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>),</div><div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a3261603753916b98888a5a5fc1d505c3">ast_extension_state2str</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a>),</div><div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;         <a class="code" href="../../d6/dd7/presencestate_8h.html#aec78c2b072d51416200d34bdd06827a7">ast_presence_state2str</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a>),</div><div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;         watchers);</div><div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;</div><div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;      num++;</div><div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;   }</div><div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div><div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;</div><div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;----------------\n&quot;</span>);</div><div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;- %d hints registered\n&quot;</span>, num);</div><div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;}</div><div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;<span class="comment">/*! \brief autocomplete for CLI command &#39;core show hint&#39; */</span></div><div class="line"><a name="l05268"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a80774ac6048ab3b7b8a722bb25fd15b3"> 5268</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a80774ac6048ab3b7b8a722bb25fd15b3">complete_core_show_hint</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *line, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/codecs_2gsm_2inc_2private_8h.html#a0b023cbb2bf7d034c2269d58d7455ac8">word</a>, <span class="keywordtype">int</span> pos, <span class="keywordtype">int</span> <a class="code" href="../../d4/d88/structstate.html">state</a>)</div><div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;{</div><div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint;</div><div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;   <span class="keywordtype">char</span> *ret = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;   <span class="keywordtype">int</span> which = 0;</div><div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;   <span class="keywordtype">int</span> wordlen;</div><div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i;</div><div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;</div><div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;   <span class="keywordflow">if</span> (pos != 3)</div><div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;</div><div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;   wordlen = strlen(word);</div><div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;</div><div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;   <span class="comment">/* walk through all hints */</span></div><div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;   i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(hints, 0);</div><div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;   <span class="keywordflow">for</span> (; (hint = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i)); <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1)) {</div><div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;      <span class="keywordflow">if</span> (!hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>) {</div><div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;         <span class="comment">/* The extension has already been destroyed */</span></div><div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;      }</div><div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;      <span class="keywordflow">if</span> (!strncasecmp(word, <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>), wordlen) &amp;&amp; ++which &gt; state) {</div><div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;         ret = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>));</div><div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1);</div><div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;      }</div><div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;   }</div><div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div><div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;</div><div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;}</div><div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;<span class="comment">/*! \brief  handle_show_hint: CLI support for listing registered dial plan hint */</span></div><div class="line"><a name="l05304"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a6ede44bb54442c1980e3d2e91da4b4bd"> 5304</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a6ede44bb54442c1980e3d2e91da4b4bd">handle_show_hint</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;{</div><div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint;</div><div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;   <span class="keywordtype">int</span> watchers;</div><div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;   <span class="keywordtype">int</span> num = 0, extenlen;</div><div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i;</div><div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>+<a class="code" href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>+2];</div><div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;</div><div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show hint&quot;</span>;</div><div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;         <span class="stringliteral">&quot;Usage: core show hint &lt;exten&gt;\n&quot;</span></div><div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;         <span class="stringliteral">&quot;       List registered hint.\n&quot;</span></div><div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;         <span class="stringliteral">&quot;       Hint details are shown in five columns. In order from left to right, they are:\n&quot;</span></div><div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;         <span class="stringliteral">&quot;       1. Hint extension URI.\n&quot;</span></div><div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;         <span class="stringliteral">&quot;       2. List of mapped device or presence state identifiers.\n&quot;</span></div><div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;         <span class="stringliteral">&quot;       3. Current extension state. The aggregate of mapped device states.\n&quot;</span></div><div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;         <span class="stringliteral">&quot;       4. Current presence state for the mapped presence state provider.\n&quot;</span></div><div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;         <span class="stringliteral">&quot;       5. Watchers - number of subscriptions and other entities watching this hint.\n&quot;</span>;</div><div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a80774ac6048ab3b7b8a722bb25fd15b3">complete_core_show_hint</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;   }</div><div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;</div><div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &lt; 4)</div><div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;</div><div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(hints) == 0) {</div><div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;There are no registered dialplan hints\n&quot;</span>);</div><div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;   }</div><div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;</div><div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;   extenlen = strlen(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3]);</div><div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;   i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(hints, 0);</div><div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;   <span class="keywordflow">for</span> (; (hint = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i)); <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1)) {</div><div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;      <span class="keywordflow">if</span> (!hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>) {</div><div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;         <span class="comment">/* The extension has already been destroyed */</span></div><div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;      }</div><div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;      <span class="keywordflow">if</span> (!strncasecmp(<a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>), a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], extenlen)) {</div><div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;         watchers = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>);</div><div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;         sprintf(buf, <span class="stringliteral">&quot;%s@%s&quot;</span>,</div><div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>),</div><div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<a class="code" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>)));</div><div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-20.20s: %-20.20s  State:%-15.15s Presence:%-15.15s Watchers %2d\n&quot;</span>,</div><div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;            buf,</div><div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>),</div><div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a3261603753916b98888a5a5fc1d505c3">ast_extension_state2str</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a>),</div><div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;            <a class="code" href="../../d6/dd7/presencestate_8h.html#aec78c2b072d51416200d34bdd06827a7">ast_presence_state2str</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a>),</div><div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;            watchers);</div><div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;         num++;</div><div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;      }</div><div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;   }</div><div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div><div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;   <span class="keywordflow">if</span> (!num)</div><div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;No hints matching extension %s\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3]);</div><div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%d hint%s matching extension %s\n&quot;</span>, num, (num!=1 ? <span class="stringliteral">&quot;s&quot;</span>:<span class="stringliteral">&quot;&quot;</span>), a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3]);</div><div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;}</div><div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;</div><div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;<span class="comment">/* This code can be used to test if the system survives running out of memory.</span></div><div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;<span class="comment"> * It might be an idea to put this in only if ENABLE_AUTODESTRUCT_TESTS is enabled.</span></div><div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;<span class="comment"> * If you want to test this, these Linux sysctl flags might be appropriate:</span></div><div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;<span class="comment"> *   vm.overcommit_memory = 2</span></div><div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;<span class="comment"> *   vm.swappiness = 0</span></div><div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;<span class="comment"> * &lt;@Corydon76-home&gt; I envision &#39;core eat disk space&#39; and &#39;core eat file descriptors&#39; now</span></div><div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;<span class="comment"> * &lt;@mjordan&gt; egads</span></div><div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;<span class="comment"> * &lt;@mjordan&gt; it&#39;s literally the &#39;big red&#39; auto-destruct button</span></div><div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;<span class="comment"> * &lt;@mjordan&gt; if you were wondering who even builds such a thing.... well, now you know</span></div><div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;<span class="comment"> * ...</span></div><div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;<span class="comment"> * &lt;@Corydon76-home&gt; What about if they lived only if you defined TEST_FRAMEWORK?  Shouldn&#39;t have those on production machines</span></div><div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;<span class="comment"> * &lt;@mjordan&gt; I think accompanied with an update to one of our README files that &quot;no, really, TEST_FRAMEWORK isn&#39;t for you&quot;, I&#39;d be fine</span></div><div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *handle_eat_memory(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;{</div><div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;   <span class="keywordtype">void</span> **blocks;</div><div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;   <span class="keywordtype">int</span> blocks_pos = 0;</div><div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">int</span> blocks_max = 50000;</div><div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;   <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> allocated = 0;</div><div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;   <span class="keywordtype">int</span> sizes[] = {</div><div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;      100 * 1024 * 1024,</div><div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;      100 * 1024,</div><div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;      2 * 1024,</div><div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;      400,</div><div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;      0</div><div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;   };</div><div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;</div><div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;      <span class="comment">/* To do: add method to free memory again? 5 minutes? */</span></div><div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core eat memory&quot;</span>;</div><div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;         <span class="stringliteral">&quot;Usage: core eat memory\n&quot;</span></div><div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;         <span class="stringliteral">&quot;       Eats all available memory so you can test if the system survives\n&quot;</span>;</div><div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;   }</div><div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;</div><div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;   blocks = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*) * blocks_max);</div><div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;   <span class="keywordflow">if</span> (!blocks) {</div><div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Already out of mem?\n&quot;</span>);</div><div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;   }</div><div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;</div><div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;   <span class="keywordflow">for</span> (i = 0; sizes[i]; ++i) {</div><div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;      <span class="keywordtype">int</span> alloc_size = sizes[i];</div><div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Allocating %d sized blocks (got %d blocks already)\n&quot;</span>, alloc_size, blocks_pos);</div><div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;      <span class="keywordflow">while</span> (1) {</div><div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;         <span class="keywordtype">void</span> *block;</div><div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;         <span class="keywordflow">if</span> (blocks_pos &gt;= blocks_max) {</div><div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Memory buffer too small? Run me again :)\n&quot;</span>);</div><div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;         }</div><div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;</div><div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;         block = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(alloc_size);</div><div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;         <span class="keywordflow">if</span> (!block) {</div><div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;         }</div><div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;</div><div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;         blocks[blocks_pos++] = block;</div><div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;         allocated += alloc_size;</div><div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;      }</div><div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;   }</div><div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;</div><div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;   <span class="comment">/* No freeing of the mem! */</span></div><div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Allocated %lld bytes total!\n&quot;</span>, allocated);</div><div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;}</div><div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;</div><div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;<span class="comment"> * &#39;show dialplan&#39; CLI command implementation functions ...</span></div><div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05447"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a10a361ce7021a2921db6c07fad34b0cf"> 5447</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a10a361ce7021a2921db6c07fad34b0cf">complete_show_dialplan_context</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *line, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/codecs_2gsm_2inc_2private_8h.html#a0b023cbb2bf7d034c2269d58d7455ac8">word</a>, <span class="keywordtype">int</span> pos,</div><div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d4/d88/structstate.html">state</a>)</div><div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;{</div><div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;   <span class="keywordtype">char</span> *ret = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;   <span class="keywordtype">int</span> which = 0;</div><div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;   <span class="keywordtype">int</span> wordlen;</div><div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;</div><div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;   <span class="comment">/* we are do completion of [exten@]context on second position only */</span></div><div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;   <span class="keywordflow">if</span> (pos != 2)</div><div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;</div><div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>();</div><div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;</div><div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;   wordlen = strlen(word);</div><div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;</div><div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;   <span class="comment">/* walk through all contexts and return the n-th match */</span></div><div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;   <span class="keywordflow">while</span> ( (c = <a class="code" href="../../db/d94/pbx_8c.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a>(c)) ) {</div><div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;      <span class="keywordflow">if</span> (!strncasecmp(word, <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), wordlen) &amp;&amp; ++which &gt; state) {</div><div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;         ret = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c));</div><div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;      }</div><div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;   }</div><div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;</div><div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;</div><div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;}</div><div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;<span class="comment">/*! \brief Counters for the show dialplan manager command */</span></div><div class="line"><a name="l05477"></a><span class="lineno"><a class="line" href="../../d2/dcd/structdialplan__counters.html"> 5477</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d2/dcd/structdialplan__counters.html">dialplan_counters</a> {</div><div class="line"><a name="l05478"></a><span class="lineno"><a class="line" href="../../d2/dcd/structdialplan__counters.html#a0446d0ce125ccdc21db9b3007292115c"> 5478</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/dcd/structdialplan__counters.html#a0446d0ce125ccdc21db9b3007292115c">total_items</a>;</div><div class="line"><a name="l05479"></a><span class="lineno"><a class="line" href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b"> 5479</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b">total_context</a>;</div><div class="line"><a name="l05480"></a><span class="lineno"><a class="line" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b"> 5480</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a>;</div><div class="line"><a name="l05481"></a><span class="lineno"><a class="line" href="../../d2/dcd/structdialplan__counters.html#ad20b944aba8713eac8e63cf3eba770b9"> 5481</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/dcd/structdialplan__counters.html#ad20b944aba8713eac8e63cf3eba770b9">total_prio</a>;</div><div class="line"><a name="l05482"></a><span class="lineno"><a class="line" href="../../d2/dcd/structdialplan__counters.html#a3f947ad80dce92dd50952d6633061166"> 5482</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/dcd/structdialplan__counters.html#a3f947ad80dce92dd50952d6633061166">context_existence</a>;</div><div class="line"><a name="l05483"></a><span class="lineno"><a class="line" href="../../d2/dcd/structdialplan__counters.html#ad4ee98222efd50240dfd8e745a46b38e"> 5483</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/dcd/structdialplan__counters.html#ad4ee98222efd50240dfd8e745a46b38e">extension_existence</a>;</div><div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;};</div><div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;<span class="comment">/*! \brief helper function to print an extension */</span></div><div class="line"><a name="l05487"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a95e73ba35332c4ae9accb2ca3329ea41"> 5487</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a95e73ba35332c4ae9accb2ca3329ea41">print_ext</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e, <span class="keywordtype">char</span> * <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">int</span> buflen)</div><div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;{</div><div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;   <span class="keywordtype">int</span> prio = <a class="code" href="../../db/d94/pbx_8c.html#a1662981db35d4125afaf6de98b2ba52f">ast_get_extension_priority</a>(e);</div><div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;   <span class="keywordflow">if</span> (prio == <a class="code" href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>) {</div><div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;      snprintf(buf, buflen, <span class="stringliteral">&quot;hint: %s&quot;</span>,</div><div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(e));</div><div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;      snprintf(buf, buflen, <span class="stringliteral">&quot;%d. %s(%s)&quot;</span>,</div><div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;         prio, <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(e),</div><div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;         (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../db/d94/pbx_8c.html#ac0a6c0c39796f36864868365d8989f02">ast_get_extension_app_data</a>(e)) ? (<span class="keywordtype">char</span> *)<a class="code" href="../../db/d94/pbx_8c.html#ac0a6c0c39796f36864868365d8989f02">ast_get_extension_app_data</a>(e) : <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;   }</div><div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;}</div><div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;<span class="comment">/*! \brief Writes CLI output of a single extension for show dialplan */</span></div><div class="line"><a name="l05501"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a68cf7d18aa58d1ea83736f1e3a19469e"> 5501</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a68cf7d18aa58d1ea83736f1e3a19469e">show_dialplan_helper_extension_output</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">char</span> *<a class="code" href="../../db/d09/func__realtime_8c.html#aef4a708d73ca36016d9360f84685350d">buf1</a>, <span class="keywordtype">char</span> *<a class="code" href="../../db/d09/func__realtime_8c.html#a13d23fea305bed9188c360e245c5c9f1">buf2</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;{</div><div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a1d9b67d1b29ee2e6c3c27e14b9269410">ast_get_extension_registrar_file</a>(exten)) {</div><div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;  %-17s %-45s [%s:%d]\n&quot;</span>,</div><div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;         buf1, buf2,</div><div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a1d9b67d1b29ee2e6c3c27e14b9269410">ast_get_extension_registrar_file</a>(exten),</div><div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a25c1ae521dc0aa6949e716b8ce49b4e7">ast_get_extension_registrar_line</a>(exten));</div><div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;   }</div><div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;</div><div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;  %-17s %-45s [%s]\n&quot;</span>,</div><div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;      buf1, buf2, <a class="code" href="../../db/d94/pbx_8c.html#a7f23f7c798d61e68c32b21d3e0cd15a2">ast_get_extension_registrar</a>(exten));</div><div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;}</div><div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;</div><div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;<span class="comment">/* XXX not verified */</span></div><div class="line"><a name="l05516"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#acae4048b911899feda92c983599d3028"> 5516</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#acae4048b911899feda92c983599d3028">show_dialplan_helper</a>(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/dcd/structdialplan__counters.html">dialplan_counters</a> *dpc, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *rinclude, <span class="keywordtype">int</span> includecount, <span class="keyword">const</span> <span class="keywordtype">char</span> *includes[])</div><div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;{</div><div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;   <span class="keywordtype">int</span> res = 0, old_total_exten = dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a>;</div><div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;</div><div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>();</div><div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;</div><div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;   <span class="comment">/* walk all contexts ... */</span></div><div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;   <span class="keywordflow">while</span> ( (c = <a class="code" href="../../db/d94/pbx_8c.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a>(c)) ) {</div><div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;      <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e;</div><div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;<span class="preprocessor">#ifndef LOW_MEMORY</span></div><div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>[1024], <a class="code" href="../../db/d09/func__realtime_8c.html#a13d23fea305bed9188c360e245c5c9f1">buf2</a>[1024];</div><div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;      <span class="keywordtype">char</span> buf[256], buf2[256];</div><div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;      <span class="keywordtype">int</span> context_info_printed = 0;</div><div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;</div><div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;      <span class="keywordflow">if</span> (context &amp;&amp; strcmp(<a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), context))</div><div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;         <span class="keywordflow">continue</span>;   <span class="comment">/* skip this one, name doesn&#39;t match */</span></div><div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;</div><div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;      dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3f947ad80dce92dd50952d6633061166">context_existence</a> = 1;</div><div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;</div><div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#af1a624244a07626a8f70843005206c95">ast_rdlock_context</a>(c);</div><div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;</div><div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;      <span class="comment">/* are we looking for exten too? if yes, we print context</span></div><div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;<span class="comment">       * only if we find our extension.</span></div><div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;<span class="comment">       * Otherwise print context even if empty ?</span></div><div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;<span class="comment">       * XXX i am not sure how the rinclude is handled.</span></div><div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;<span class="comment">       * I think it ought to go inside.</span></div><div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;      <span class="keywordflow">if</span> (!exten) {</div><div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;         dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b">total_context</a>++;</div><div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;[ Context &#39;%s&#39; created by &#39;%s&#39; ]\n&quot;</span>,</div><div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), <a class="code" href="../../db/d94/pbx_8c.html#a9df0a5d301454fe924172cf89c7165a4">ast_get_context_registrar</a>(c));</div><div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;         <span class="keywordflow">if</span> (c-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15">autohints</a>) {</div><div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;            <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Autohints support enabled\n&quot;</span>);</div><div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;         }</div><div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;         context_info_printed = 1;</div><div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;      }</div><div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;</div><div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;      <span class="comment">/* walk extensions ... */</span></div><div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;      e = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;      <span class="keywordflow">while</span> ( (e = <a class="code" href="../../db/d94/pbx_8c.html#a505ce4b1d8e816a6163f064bc27bc2d6">ast_walk_context_extensions</a>(c, e)) ) {</div><div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *p;</div><div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;</div><div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;         <span class="keywordflow">if</span> (exten &amp;&amp; !<a class="code" href="../../db/d94/pbx_8c.html#a594f1f57f847b59c1d8aeef4b0e3a337">ast_extension_match</a>(<a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(e), exten))</div><div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;            <span class="keywordflow">continue</span>;   <span class="comment">/* skip, extension match failed */</span></div><div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;</div><div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;         dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#ad4ee98222efd50240dfd8e745a46b38e">extension_existence</a> = 1;</div><div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;</div><div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;         <span class="comment">/* may we print context info? */</span></div><div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;         <span class="keywordflow">if</span> (!context_info_printed) {</div><div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;            dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b">total_context</a>++;</div><div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;            <span class="keywordflow">if</span> (rinclude) { <span class="comment">/* TODO Print more info about rinclude */</span></div><div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;               <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;[ Included context &#39;%s&#39; created by &#39;%s&#39; ]\n&quot;</span>,</div><div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), <a class="code" href="../../db/d94/pbx_8c.html#a9df0a5d301454fe924172cf89c7165a4">ast_get_context_registrar</a>(c));</div><div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;               <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;[ Context &#39;%s&#39; created by &#39;%s&#39; ]\n&quot;</span>,</div><div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), <a class="code" href="../../db/d94/pbx_8c.html#a9df0a5d301454fe924172cf89c7165a4">ast_get_context_registrar</a>(c));</div><div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;               <span class="keywordflow">if</span> (c-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15">autohints</a>) {</div><div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;                  <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;Autohints support enabled\n&quot;</span>);</div><div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;               }</div><div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;            }</div><div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;            context_info_printed = 1;</div><div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;         }</div><div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;         dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#ad20b944aba8713eac8e63cf3eba770b9">total_prio</a>++;</div><div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;</div><div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;         <span class="comment">/* write extension name and first peer */</span></div><div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;         <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a0aa5ba413029c07073f6e915036e037f">AST_EXT_MATCHCID_ON</a>)</div><div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;            snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;&#39;%s&#39; (CID match &#39;%s&#39;) =&gt; &quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(e), e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>);</div><div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;            snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;&#39;%s&#39; =&gt;&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(e));</div><div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;</div><div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a95e73ba35332c4ae9accb2ca3329ea41">print_ext</a>(e, buf2, <span class="keyword">sizeof</span>(buf2));</div><div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;</div><div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a68cf7d18aa58d1ea83736f1e3a19469e">show_dialplan_helper_extension_output</a>(fd, buf, buf2, e);</div><div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;</div><div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;         dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a>++;</div><div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;         <span class="comment">/* walk next extension peers */</span></div><div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;         p = e;   <span class="comment">/* skip the first one, we already got it */</span></div><div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;         <span class="keywordflow">while</span> ( (p = <a class="code" href="../../db/d94/pbx_8c.html#a6772ce6e8de86d4b6c382dbf68ea4755">ast_walk_extension_priorities</a>(e, p)) ) {</div><div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d03/asterisk_8c.html#a617d1486ee651b4c894d02e1fe68fe04">el</a> = <a class="code" href="../../db/d94/pbx_8c.html#a54aae627e24c46cfd1ce479ddfa0f3d2">ast_get_extension_label</a>(p);</div><div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;            dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#ad20b944aba8713eac8e63cf3eba770b9">total_prio</a>++;</div><div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;            <span class="keywordflow">if</span> (el)</div><div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;               snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;   [%s]&quot;</span>, el);</div><div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;               buf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a95e73ba35332c4ae9accb2ca3329ea41">print_ext</a>(p, buf2, <span class="keyword">sizeof</span>(buf2));</div><div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;</div><div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a68cf7d18aa58d1ea83736f1e3a19469e">show_dialplan_helper_extension_output</a>(fd, buf, buf2, p);</div><div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;         }</div><div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;      }</div><div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;</div><div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;      <span class="comment">/* walk included and write info ... */</span></div><div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;      <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(c); idx++) {</div><div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *i = <a class="code" href="../../db/d94/pbx_8c.html#afb93dec0c216cb07939fd15949baff2f">ast_context_includes_get</a>(c, idx);</div><div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;</div><div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;         snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;&#39;%s&#39;&quot;</span>, <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i));</div><div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;         <span class="keywordflow">if</span> (exten) {</div><div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;            <span class="comment">/* Check all includes for the requested extension */</span></div><div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;            <span class="keywordflow">if</span> (includecount &gt;= <a class="code" href="../../dd/ddb/extconf_8h.html#a05848c0de74d85dc2fb259f332d33f25">AST_PBX_MAX_STACK</a>) {</div><div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Maximum include depth exceeded!\n&quot;</span>);</div><div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;               <span class="keywordtype">int</span> dupe = 0;</div><div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;               <span class="keywordtype">int</span> x;</div><div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;               <span class="keywordflow">for</span> (x = 0; x &lt; includecount; x++) {</div><div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;                  <span class="keywordflow">if</span> (!strcasecmp(includes[x], <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i))) {</div><div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;                     dupe++;</div><div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;                  }</div><div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;               }</div><div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;               <span class="keywordflow">if</span> (!dupe) {</div><div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;                  includes[includecount] = <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i);</div><div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#acae4048b911899feda92c983599d3028">show_dialplan_helper</a>(fd, <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i), exten, dpc, i, includecount + 1, includes);</div><div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Avoiding circular include of %s within %s\n&quot;</span>, <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i), context);</div><div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;               }</div><div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;            }</div><div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;            <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;  Include =&gt;        %-45s [%s]\n&quot;</span>,</div><div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;               buf, <a class="code" href="../../db/de0/pbx_8h.html#a2bf7469cd4b7de5d4de43d58aeff46c5">ast_get_include_registrar</a>(i));</div><div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;         }</div><div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;      }</div><div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;</div><div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;      <span class="comment">/* walk ignore patterns and write info ... */</span></div><div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;      <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a>(c); idx++) {</div><div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *ip = <a class="code" href="../../db/d94/pbx_8c.html#a6fee17b9633bb84f0fce209d5d42fb0a">ast_context_ignorepats_get</a>(c, idx);</div><div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *ipname = <a class="code" href="../../db/de0/pbx_8h.html#ad40e50eea098e5c16ef7dd3ffbff1bba">ast_get_ignorepat_name</a>(ip);</div><div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;         <span class="keywordtype">char</span> ignorepat[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];</div><div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;</div><div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;         snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;&#39;%s&#39;&quot;</span>, ipname);</div><div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;         snprintf(ignorepat, <span class="keyword">sizeof</span>(ignorepat), <span class="stringliteral">&quot;_%s.&quot;</span>, ipname);</div><div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;         <span class="keywordflow">if</span> (!exten || <a class="code" href="../../db/d94/pbx_8c.html#a594f1f57f847b59c1d8aeef4b0e3a337">ast_extension_match</a>(ignorepat, exten)) {</div><div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;            <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;  Ignore pattern =&gt; %-45s [%s]\n&quot;</span>,</div><div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;               buf, <a class="code" href="../../db/de0/pbx_8h.html#a8a6feb7cd8e08f18c9d0f4887d7f3d47">ast_get_ignorepat_registrar</a>(ip));</div><div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;         }</div><div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;      }</div><div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;      <span class="keywordflow">if</span> (!rinclude) {</div><div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;         <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a>(c); idx++) {</div><div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;            <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *sw = <a class="code" href="../../db/d94/pbx_8c.html#a0161005b7a19bc949f2c8ebbf36a46eb">ast_context_switches_get</a>(c, idx);</div><div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;</div><div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;            snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;&#39;%s/%s&#39;&quot;</span>,</div><div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;               <a class="code" href="../../db/de0/pbx_8h.html#aa0ebd34e8d1605aa4b6e3fadea6adfb5">ast_get_switch_name</a>(sw),</div><div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;               <a class="code" href="../../db/de0/pbx_8h.html#ad4f9fd5bd7afc28347c808ea295233e8">ast_get_switch_data</a>(sw));</div><div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;            <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;  Alt. Switch =&gt;    %-45s [%s]\n&quot;</span>,</div><div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;               buf, <a class="code" href="../../db/de0/pbx_8h.html#a3d45d3b9bc79bf6ffb1540f3e815f677">ast_get_switch_registrar</a>(sw));</div><div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;         }</div><div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;      }</div><div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;</div><div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(c);</div><div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;</div><div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;      <span class="comment">/* if we print something in context, make an empty line */</span></div><div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;      <span class="keywordflow">if</span> (context_info_printed)</div><div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;   }</div><div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;</div><div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;   <span class="keywordflow">return</span> (dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a> == old_total_exten) ? -1 : res;</div><div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;}</div><div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;</div><div class="line"><a name="l05677"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a9ccbd387b4acc01572f585c55633c417"> 5677</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a9ccbd387b4acc01572f585c55633c417">show_debug_helper</a>(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/dcd/structdialplan__counters.html">dialplan_counters</a> *dpc, <span class="keyword">struct</span> <a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *rinclude, <span class="keywordtype">int</span> includecount, <span class="keyword">const</span> <span class="keywordtype">char</span> *includes[])</div><div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;{</div><div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;   <span class="keywordtype">int</span> res = 0, old_total_exten = dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a>;</div><div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;</div><div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;\n     In-mem exten Trie for Fast Extension Pattern Matching:\n\n&quot;</span>);</div><div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;</div><div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;\n           Explanation: Node Contents Format = &lt;char(s) to match&gt;:&lt;pattern?&gt;:&lt;specif&gt;:[matched extension]\n&quot;</span>);</div><div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,    <span class="stringliteral">&quot;                        Where &lt;char(s) to match&gt; is a set of chars, any one of which should match the current character\n&quot;</span>);</div><div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,    <span class="stringliteral">&quot;                              &lt;pattern?&gt;: Y if this a pattern match (eg. _XZN[5-7]), N otherwise\n&quot;</span>);</div><div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,    <span class="stringliteral">&quot;                              &lt;specif&gt;: an assigned &#39;exactness&#39; number for this matching char. The lower the number, the more exact the match\n&quot;</span>);</div><div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,    <span class="stringliteral">&quot;                              [matched exten]: If all chars matched to this point, which extension this matches. In form: EXTEN:&lt;exten string&gt;\n&quot;</span>);</div><div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,    <span class="stringliteral">&quot;                        In general, you match a trie node to a string character, from left to right. All possible matching chars\n&quot;</span>);</div><div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,    <span class="stringliteral">&quot;                        are in a string vertically, separated by an unbroken string of &#39;+&#39; characters.\n\n&quot;</span>);</div><div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>();</div><div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;</div><div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;   <span class="comment">/* walk all contexts ... */</span></div><div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;   <span class="keywordflow">while</span> ( (c = <a class="code" href="../../db/d94/pbx_8c.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a>(c)) ) {</div><div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;      <span class="keywordtype">int</span> context_info_printed = 0;</div><div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;</div><div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;      <span class="keywordflow">if</span> (context &amp;&amp; strcmp(<a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), context))</div><div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;         <span class="keywordflow">continue</span>;   <span class="comment">/* skip this one, name doesn&#39;t match */</span></div><div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;</div><div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;      dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3f947ad80dce92dd50952d6633061166">context_existence</a> = 1;</div><div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;</div><div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;      <span class="keywordflow">if</span> (!c-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>) {</div><div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;         <span class="comment">/* Ignore check_return warning from Coverity for ast_exists_extension below */</span></div><div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, c-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, <span class="stringliteral">&quot;s&quot;</span>, 1, <span class="stringliteral">&quot;&quot;</span>); <span class="comment">/* do this to force the trie to built, if it is not already */</span></div><div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;      }</div><div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;</div><div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#af1a624244a07626a8f70843005206c95">ast_rdlock_context</a>(c);</div><div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;</div><div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;      dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b">total_context</a>++;</div><div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;[ Context &#39;%s&#39; created by &#39;%s&#39; ]\n&quot;</span>,</div><div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), <a class="code" href="../../db/d94/pbx_8c.html#a9df0a5d301454fe924172cf89c7165a4">ast_get_context_registrar</a>(c));</div><div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;      context_info_printed = 1;</div><div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;</div><div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;      <span class="keywordflow">if</span> (c-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>)</div><div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;      {</div><div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a36264871dfb05b0e331f7a6f19049ab6">cli_match_char_tree</a>(c-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>, <span class="stringliteral">&quot; &quot;</span>, fd);</div><div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;\n     No Pattern Trie present. Perhaps the context is empty...or there is trouble...\n\n&quot;</span>);</div><div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;      }</div><div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;</div><div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(c);</div><div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;</div><div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;      <span class="comment">/* if we print something in context, make an empty line */</span></div><div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;      <span class="keywordflow">if</span> (context_info_printed)</div><div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;   }</div><div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;</div><div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;   <span class="keywordflow">return</span> (dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a> == old_total_exten) ? -1 : res;</div><div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;}</div><div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;</div><div class="line"><a name="l05732"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#acf5505fa44483212103cce849e530e1c"> 5732</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#acf5505fa44483212103cce849e530e1c">handle_show_dialplan</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *a)</div><div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;{</div><div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *context = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;   <span class="comment">/* Variables used for different counters */</span></div><div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/dcd/structdialplan__counters.html">dialplan_counters</a> counters;</div><div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *incstack[<a class="code" href="../../dd/ddb/extconf_8h.html#a05848c0de74d85dc2fb259f332d33f25">AST_PBX_MAX_STACK</a>];</div><div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;</div><div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dialplan show&quot;</span>;</div><div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;         <span class="stringliteral">&quot;Usage: dialplan show [[exten@]context]\n&quot;</span></div><div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;         <span class="stringliteral">&quot;       Show dialplan\n&quot;</span>;</div><div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a10a361ce7021a2921db6c07fad34b0cf">complete_show_dialplan_context</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;   }</div><div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;</div><div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160;   memset(&amp;counters, 0, <span class="keyword">sizeof</span>(counters));</div><div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;</div><div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 2 &amp;&amp; a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 3)</div><div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;</div><div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;   <span class="comment">/* we obtain [exten@]context? if yes, split them ... */</span></div><div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 3) {</div><div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;      <span class="keywordflow">if</span> (strchr(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2], <span class="charliteral">&#39;@&#39;</span>)) {   <span class="comment">/* split into exten &amp; context */</span></div><div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;         context = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2]);</div><div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160;         exten = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;context, <span class="stringliteral">&quot;@&quot;</span>);</div><div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;         <span class="comment">/* change empty strings to NULL */</span></div><div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(exten))</div><div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;            exten = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">/* no &#39;@&#39; char, only context given */</span></div><div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;         context = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2]);</div><div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;      }</div><div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(context))</div><div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;         context = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;   }</div><div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;   <span class="comment">/* else Show complete dial plan, context and exten are NULL */</span></div><div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#acae4048b911899feda92c983599d3028">show_dialplan_helper</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, context, exten, &amp;counters, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, incstack);</div><div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;</div><div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;   <span class="comment">/* check for input failure and throw some error messages */</span></div><div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160;   <span class="keywordflow">if</span> (context &amp;&amp; !counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3f947ad80dce92dd50952d6633061166">context_existence</a>) {</div><div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;There is no existence of &#39;%s&#39; context\n&quot;</span>, context);</div><div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;   }</div><div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;</div><div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;   <span class="keywordflow">if</span> (exten &amp;&amp; !counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#ad4ee98222efd50240dfd8e745a46b38e">extension_existence</a>) {</div><div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160;      <span class="keywordflow">if</span> (context)</div><div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;There is no existence of %s@%s extension\n&quot;</span>,</div><div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;            exten, context);</div><div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>,</div><div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;            <span class="stringliteral">&quot;There is no existence of &#39;%s&#39; extension in all contexts\n&quot;</span>,</div><div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;            exten);</div><div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;   }</div><div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;</div><div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>,<span class="stringliteral">&quot;-= %d %s (%d %s) in %d %s. =-\n&quot;</span>,</div><div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;            counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a>, counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a> == 1 ? <span class="stringliteral">&quot;extension&quot;</span> : <span class="stringliteral">&quot;extensions&quot;</span>,</div><div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;            counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#ad20b944aba8713eac8e63cf3eba770b9">total_prio</a>, counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#ad20b944aba8713eac8e63cf3eba770b9">total_prio</a> == 1 ? <span class="stringliteral">&quot;priority&quot;</span> : <span class="stringliteral">&quot;priorities&quot;</span>,</div><div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;            counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b">total_context</a>, counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b">total_context</a> == 1 ? <span class="stringliteral">&quot;context&quot;</span> : <span class="stringliteral">&quot;contexts&quot;</span>);</div><div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;</div><div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;   <span class="comment">/* everything ok */</span></div><div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;}</div><div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;<span class="comment">/*! \brief Send ack once */</span></div><div class="line"><a name="l05799"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a69b3642bb638524be829a44a1b1219db"> 5799</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a69b3642bb638524be829a44a1b1219db">handle_debug_dialplan</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *a)</div><div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;{</div><div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *context = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;   <span class="comment">/* Variables used for different counters */</span></div><div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/dcd/structdialplan__counters.html">dialplan_counters</a> counters;</div><div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *incstack[<a class="code" href="../../dd/ddb/extconf_8h.html#a05848c0de74d85dc2fb259f332d33f25">AST_PBX_MAX_STACK</a>];</div><div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;</div><div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dialplan debug&quot;</span>;</div><div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;         <span class="stringliteral">&quot;Usage: dialplan debug [context]\n&quot;</span></div><div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;         <span class="stringliteral">&quot;       Show dialplan context Trie(s). Usually only useful to folks debugging the deep internals of the fast pattern matcher\n&quot;</span>;</div><div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a10a361ce7021a2921db6c07fad34b0cf">complete_show_dialplan_context</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;   }</div><div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;</div><div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;   memset(&amp;counters, 0, <span class="keyword">sizeof</span>(counters));</div><div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;</div><div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 2 &amp;&amp; a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 3)</div><div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;</div><div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;   <span class="comment">/* we obtain [exten@]context? if yes, split them ... */</span></div><div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;   <span class="comment">/* note: we ignore the exten totally here .... */</span></div><div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 3) {</div><div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;      <span class="keywordflow">if</span> (strchr(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2], <span class="charliteral">&#39;@&#39;</span>)) {   <span class="comment">/* split into exten &amp; context */</span></div><div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;         context = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2]);</div><div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;         exten = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;context, <span class="stringliteral">&quot;@&quot;</span>);</div><div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;         <span class="comment">/* change empty strings to NULL */</span></div><div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(exten))</div><div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;            exten = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">/* no &#39;@&#39; char, only context given */</span></div><div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;         context = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2]);</div><div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;      }</div><div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(context))</div><div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;         context = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;   }</div><div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;   <span class="comment">/* else Show complete dial plan, context and exten are NULL */</span></div><div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a9ccbd387b4acc01572f585c55633c417">show_debug_helper</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, context, exten, &amp;counters, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, incstack);</div><div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;</div><div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160;   <span class="comment">/* check for input failure and throw some error messages */</span></div><div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;   <span class="keywordflow">if</span> (context &amp;&amp; !counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3f947ad80dce92dd50952d6633061166">context_existence</a>) {</div><div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;There is no existence of &#39;%s&#39; context\n&quot;</span>, context);</div><div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;   }</div><div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;</div><div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;</div><div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>,<span class="stringliteral">&quot;-= %d %s. =-\n&quot;</span>,</div><div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;         counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b">total_context</a>, counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b">total_context</a> == 1 ? <span class="stringliteral">&quot;context&quot;</span> : <span class="stringliteral">&quot;contexts&quot;</span>);</div><div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;</div><div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;   <span class="comment">/* everything ok */</span></div><div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;}</div><div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;<span class="comment">/*! \brief Send ack once */</span></div><div class="line"><a name="l05855"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a70046ced091cbd83caccdba9e719cbce"> 5855</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a70046ced091cbd83caccdba9e719cbce">manager_dpsendack</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;{</div><div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a>(s, m, <span class="stringliteral">&quot;DialPlan list will follow&quot;</span>, <span class="stringliteral">&quot;start&quot;</span>);</div><div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;}</div><div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;<span class="comment">/*! \brief Show dialplan extensions</span></div><div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;<span class="comment"> * XXX this function is similar but not exactly the same as the CLI&#39;s</span></div><div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;<span class="comment"> * show dialplan. Must check whether the difference is intentional or not.</span></div><div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l05864"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aeed0f59adddf334e592ea0dc360b6a8c"> 5864</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aeed0f59adddf334e592ea0dc360b6a8c">manager_show_dialplan_helper</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m,</div><div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;               <span class="keyword">const</span> <span class="keywordtype">char</span> *actionidtext, <span class="keyword">const</span> <span class="keywordtype">char</span> *context,</div><div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;               <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/dcd/structdialplan__counters.html">dialplan_counters</a> *dpc,</div><div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;               <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *rinclude,</div><div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;               <span class="keywordtype">int</span> includecount, <span class="keyword">const</span> <span class="keywordtype">char</span> *includes[])</div><div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;{</div><div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;   <span class="keywordtype">int</span> res = 0, old_total_exten = dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a>;</div><div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;</div><div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(exten))</div><div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;      exten = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(context))</div><div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;      context = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;</div><div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;manager_show_dialplan: Context: -%s- Extension: -%s-\n&quot;</span>, context, exten);</div><div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;</div><div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;   <span class="comment">/* try to lock contexts */</span></div><div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>()) {</div><div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Failed to lock contexts&quot;</span>);</div><div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to lock contexts list for manager: listdialplan\n&quot;</span>);</div><div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;   }</div><div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;</div><div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;   c = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;      <span class="comment">/* walk all contexts ... */</span></div><div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;   <span class="keywordflow">while</span> ( (c = <a class="code" href="../../db/d94/pbx_8c.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a>(c)) ) {</div><div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;      <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e;</div><div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;</div><div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;      <span class="keywordflow">if</span> (context &amp;&amp; strcmp(<a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), context) != 0)</div><div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;         <span class="keywordflow">continue</span>;   <span class="comment">/* not the name we want */</span></div><div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;</div><div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;      dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3f947ad80dce92dd50952d6633061166">context_existence</a> = 1;</div><div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;      dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b">total_context</a>++;</div><div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;</div><div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;manager_show_dialplan: Found Context: %s \n&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c));</div><div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;</div><div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#af1a624244a07626a8f70843005206c95">ast_rdlock_context</a>(c)) {  <span class="comment">/* failed to lock */</span></div><div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;manager_show_dialplan: Failed to lock context\n&quot;</span>);</div><div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;      }</div><div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;</div><div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;      <span class="comment">/* XXX note- an empty context is not printed */</span></div><div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;      e = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;      <span class="comment">/* walk extensions in context  */</span></div><div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;      <span class="keywordflow">while</span> ( (e = <a class="code" href="../../db/d94/pbx_8c.html#a505ce4b1d8e816a6163f064bc27bc2d6">ast_walk_context_extensions</a>(c, e)) ) {</div><div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *p;</div><div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;</div><div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;         <span class="comment">/* looking for extension? is this our extension? */</span></div><div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;         <span class="keywordflow">if</span> (exten &amp;&amp; !<a class="code" href="../../db/d94/pbx_8c.html#a594f1f57f847b59c1d8aeef4b0e3a337">ast_extension_match</a>(<a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(e), exten)) {</div><div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;            <span class="comment">/* not the one we are looking for, continue */</span></div><div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;manager_show_dialplan: Skipping extension %s\n&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(e));</div><div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;         }</div><div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;manager_show_dialplan: Found Extension: %s \n&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(e));</div><div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;</div><div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;         dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#ad4ee98222efd50240dfd8e745a46b38e">extension_existence</a> = 1;</div><div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;</div><div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;         dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a>++;</div><div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;</div><div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;         p = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;      <span class="comment">/* walk next extension peers */</span></div><div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;         <span class="keywordflow">while</span> ( (p = <a class="code" href="../../db/d94/pbx_8c.html#a6772ce6e8de86d4b6c382dbf68ea4755">ast_walk_extension_priorities</a>(e, p)) ) {</div><div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;            <span class="keywordtype">int</span> prio = <a class="code" href="../../db/d94/pbx_8c.html#a1662981db35d4125afaf6de98b2ba52f">ast_get_extension_priority</a>(p);</div><div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;</div><div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;            dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#ad20b944aba8713eac8e63cf3eba770b9">total_prio</a>++;</div><div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;            <span class="keywordflow">if</span> (!dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a0446d0ce125ccdc21db9b3007292115c">total_items</a>++)</div><div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a70046ced091cbd83caccdba9e719cbce">manager_dpsendack</a>(s, m);</div><div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Event: ListDialplan\r\n%s&quot;</span>, actionidtext);</div><div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Context: %s\r\nExtension: %s\r\n&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(e) );</div><div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;</div><div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;            <span class="comment">/* XXX maybe make this conditional, if p != e ? */</span></div><div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a54aae627e24c46cfd1ce479ddfa0f3d2">ast_get_extension_label</a>(p))</div><div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;               <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;ExtensionLabel: %s\r\n&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a54aae627e24c46cfd1ce479ddfa0f3d2">ast_get_extension_label</a>(p));</div><div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;</div><div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;            <span class="keywordflow">if</span> (prio == <a class="code" href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>) {</div><div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;               <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Priority: hint\r\nApplication: %s\r\n&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(p));</div><div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160;               <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Priority: %d\r\nApplication: %s\r\nAppData: %s\r\n&quot;</span>, prio, <a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(p), (<span class="keywordtype">char</span> *) <a class="code" href="../../db/d94/pbx_8c.html#ac0a6c0c39796f36864868365d8989f02">ast_get_extension_app_data</a>(p));</div><div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;            }</div><div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Registrar: %s\r\n\r\n&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a7f23f7c798d61e68c32b21d3e0cd15a2">ast_get_extension_registrar</a>(e));</div><div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;         }</div><div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;      }</div><div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;</div><div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160;      <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(c); idx++) {</div><div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160;         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *i = <a class="code" href="../../db/d94/pbx_8c.html#afb93dec0c216cb07939fd15949baff2f">ast_context_includes_get</a>(c, idx);</div><div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;</div><div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;         <span class="keywordflow">if</span> (exten) {</div><div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160;            <span class="comment">/* Check all includes for the requested extension */</span></div><div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;            <span class="keywordflow">if</span> (includecount &gt;= <a class="code" href="../../dd/ddb/extconf_8h.html#a05848c0de74d85dc2fb259f332d33f25">AST_PBX_MAX_STACK</a>) {</div><div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Maximum include depth exceeded!\n&quot;</span>);</div><div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;               <span class="keywordtype">int</span> dupe = 0;</div><div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;               <span class="keywordtype">int</span> x;</div><div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;               <span class="keywordflow">for</span> (x = 0; x &lt; includecount; x++) {</div><div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;                  <span class="keywordflow">if</span> (!strcasecmp(includes[x], <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i))) {</div><div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;                     dupe++;</div><div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;                  }</div><div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160;               }</div><div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;               <span class="keywordflow">if</span> (!dupe) {</div><div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;                  includes[includecount] = <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i);</div><div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#aeed0f59adddf334e592ea0dc360b6a8c">manager_show_dialplan_helper</a>(s, m, actionidtext, <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i), exten, dpc, i, includecount + 1, includes);</div><div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Avoiding circular include of %s within %s\n&quot;</span>, <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i), context);</div><div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;               }</div><div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;            }</div><div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;            <span class="keywordflow">if</span> (!dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a0446d0ce125ccdc21db9b3007292115c">total_items</a>++)</div><div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a70046ced091cbd83caccdba9e719cbce">manager_dpsendack</a>(s, m);</div><div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Event: ListDialplan\r\n%s&quot;</span>, actionidtext);</div><div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Context: %s\r\nIncludeContext: %s\r\nRegistrar: %s\r\n&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i), <a class="code" href="../../db/de0/pbx_8h.html#a2bf7469cd4b7de5d4de43d58aeff46c5">ast_get_include_registrar</a>(i));</div><div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;manager_show_dialplan: Found Included context: %s \n&quot;</span>, <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i));</div><div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;         }</div><div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;      }</div><div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;</div><div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;      <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a>(c); idx++) {</div><div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *ip = <a class="code" href="../../db/d94/pbx_8c.html#a6fee17b9633bb84f0fce209d5d42fb0a">ast_context_ignorepats_get</a>(c, idx);</div><div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *ipname = <a class="code" href="../../db/de0/pbx_8h.html#ad40e50eea098e5c16ef7dd3ffbff1bba">ast_get_ignorepat_name</a>(ip);</div><div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;         <span class="keywordtype">char</span> ignorepat[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];</div><div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;</div><div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;         snprintf(ignorepat, <span class="keyword">sizeof</span>(ignorepat), <span class="stringliteral">&quot;_%s.&quot;</span>, ipname);</div><div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160;         <span class="keywordflow">if</span> (!exten || <a class="code" href="../../db/d94/pbx_8c.html#a594f1f57f847b59c1d8aeef4b0e3a337">ast_extension_match</a>(ignorepat, exten)) {</div><div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;            <span class="keywordflow">if</span> (!dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a0446d0ce125ccdc21db9b3007292115c">total_items</a>++)</div><div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a70046ced091cbd83caccdba9e719cbce">manager_dpsendack</a>(s, m);</div><div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Event: ListDialplan\r\n%s&quot;</span>, actionidtext);</div><div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Context: %s\r\nIgnorePattern: %s\r\nRegistrar: %s\r\n&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), ipname, <a class="code" href="../../db/de0/pbx_8h.html#a8a6feb7cd8e08f18c9d0f4887d7f3d47">ast_get_ignorepat_registrar</a>(ip));</div><div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;         }</div><div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;      }</div><div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;      <span class="keywordflow">if</span> (!rinclude) {</div><div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;         <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a>(c); idx++) {</div><div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;            <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *sw = <a class="code" href="../../db/d94/pbx_8c.html#a0161005b7a19bc949f2c8ebbf36a46eb">ast_context_switches_get</a>(c, idx);</div><div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;</div><div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160;            <span class="keywordflow">if</span> (!dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a0446d0ce125ccdc21db9b3007292115c">total_items</a>++)</div><div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a70046ced091cbd83caccdba9e719cbce">manager_dpsendack</a>(s, m);</div><div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Event: ListDialplan\r\n%s&quot;</span>, actionidtext);</div><div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Context: %s\r\nSwitch: %s/%s\r\nRegistrar: %s\r\n&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), <a class="code" href="../../db/de0/pbx_8h.html#aa0ebd34e8d1605aa4b6e3fadea6adfb5">ast_get_switch_name</a>(sw), <a class="code" href="../../db/de0/pbx_8h.html#ad4f9fd5bd7afc28347c808ea295233e8">ast_get_switch_data</a>(sw), <a class="code" href="../../db/de0/pbx_8h.html#a3d45d3b9bc79bf6ffb1540f3e815f677">ast_get_switch_registrar</a>(sw));</div><div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;            <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;manager_show_dialplan: Found Switch : %s \n&quot;</span>, <a class="code" href="../../db/de0/pbx_8h.html#aa0ebd34e8d1605aa4b6e3fadea6adfb5">ast_get_switch_name</a>(sw));</div><div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;         }</div><div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;      }</div><div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;</div><div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(c);</div><div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;   }</div><div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160;</div><div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;   <span class="keywordflow">if</span> (dpc-&gt;<a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a> == old_total_exten) {</div><div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;manager_show_dialplan: Found nothing new\n&quot;</span>);</div><div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;      <span class="comment">/* Nothing new under the sun */</span></div><div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;      <span class="keywordflow">return</span> res;</div><div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;   }</div><div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;}</div><div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;<span class="comment"></span></div><div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;<span class="comment">/*! \brief  Manager listing of dial plan */</span></div><div class="line"><a name="l06019"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a08cb2466bf2b7844066c2e1f62a298db"> 6019</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a08cb2466bf2b7844066c2e1f62a298db">manager_show_dialplan</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;{</div><div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, *<a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>);</div><div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *incstack[<a class="code" href="../../dd/ddb/extconf_8h.html#a05848c0de74d85dc2fb259f332d33f25">AST_PBX_MAX_STACK</a>];</div><div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;   <span class="keywordtype">char</span> idtext[256];</div><div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160;</div><div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;   <span class="comment">/* Variables used for different counters */</span></div><div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/dcd/structdialplan__counters.html">dialplan_counters</a> counters;</div><div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;</div><div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<span class="keywordtype">id</span>))</div><div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;      snprintf(idtext, <span class="keyword">sizeof</span>(idtext), <span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;      idtext[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;</div><div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;   memset(&amp;counters, 0, <span class="keyword">sizeof</span>(counters));</div><div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;</div><div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;   exten = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Extension&quot;</span>);</div><div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;   context = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Context&quot;</span>);</div><div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;</div><div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#aeed0f59adddf334e592ea0dc360b6a8c">manager_show_dialplan_helper</a>(s, m, idtext, context, exten, &amp;counters, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, incstack);</div><div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;</div><div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(context) &amp;&amp; !counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3f947ad80dce92dd50952d6633061166">context_existence</a>) {</div><div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;      <span class="keywordtype">char</span> errorbuf[BUFSIZ];</div><div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160;</div><div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;      snprintf(errorbuf, <span class="keyword">sizeof</span>(errorbuf), <span class="stringliteral">&quot;Did not find context %s&quot;</span>, context);</div><div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, errorbuf);</div><div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;   }</div><div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(exten) &amp;&amp; !counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#ad4ee98222efd50240dfd8e745a46b38e">extension_existence</a>) {</div><div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;      <span class="keywordtype">char</span> errorbuf[BUFSIZ];</div><div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;</div><div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(context))</div><div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;         snprintf(errorbuf, <span class="keyword">sizeof</span>(errorbuf), <span class="stringliteral">&quot;Did not find extension %s@%s&quot;</span>, exten, context);</div><div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;         snprintf(errorbuf, <span class="keyword">sizeof</span>(errorbuf), <span class="stringliteral">&quot;Did not find extension %s in any context&quot;</span>, exten);</div><div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, errorbuf);</div><div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;   }</div><div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;</div><div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;   <span class="keywordflow">if</span> (!counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a0446d0ce125ccdc21db9b3007292115c">total_items</a>) {</div><div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a70046ced091cbd83caccdba9e719cbce">manager_dpsendack</a>(s, m);</div><div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;   }</div><div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;</div><div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a>(s, m, <span class="stringliteral">&quot;ShowDialPlanComplete&quot;</span>, counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a0446d0ce125ccdc21db9b3007292115c">total_items</a>);</div><div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s,</div><div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;      <span class="stringliteral">&quot;ListExtensions: %d\r\n&quot;</span></div><div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;      <span class="stringliteral">&quot;ListPriorities: %d\r\n&quot;</span></div><div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160;      <span class="stringliteral">&quot;ListContexts: %d\r\n&quot;</span>,</div><div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;      counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">total_exten</a>, counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#ad20b944aba8713eac8e63cf3eba770b9">total_prio</a>, counters.<a class="code" href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b">total_context</a>);</div><div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a>(s);</div><div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160;</div><div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;   <span class="comment">/* everything ok */</span></div><div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;}</div><div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;</div><div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160;<span class="preprocessor">#ifdef AST_DEVMODE</span></div><div class="line"><a name="l06076"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a7d88a9d0a54dd6e850c9ffc8d8b5314d"> 6076</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a7d88a9d0a54dd6e850c9ffc8d8b5314d">handle_show_device2extenstate</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *a)</div><div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160;{</div><div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7f/structast__devstate__aggregate.html">ast_devstate_aggregate</a> agg;</div><div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;   <span class="keywordtype">int</span> i, j, <a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, combined;</div><div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;</div><div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l06082"></a><span class="lineno"> 6082</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show device2extenstate&quot;</span>;</div><div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160;         <span class="stringliteral">&quot;Usage: core show device2extenstate\n&quot;</span></div><div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;         <span class="stringliteral">&quot;       Lists device state to extension state combinations.\n&quot;</span>;</div><div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;   }</div><div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7">AST_DEVICE_TOTAL</a>; i++) {</div><div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;      <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7">AST_DEVICE_TOTAL</a>; j++) {</div><div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;         <a class="code" href="../../da/da2/devicestate_8h.html#a65ebe8f28497b09769ab9edeb4eb9b86">ast_devstate_aggregate_init</a>(&amp;agg);</div><div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;         <a class="code" href="../../da/da2/devicestate_8h.html#a45534707838d05125f409430b371854a">ast_devstate_aggregate_add</a>(&amp;agg, i);</div><div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;         <a class="code" href="../../da/da2/devicestate_8h.html#a45534707838d05125f409430b371854a">ast_devstate_aggregate_add</a>(&amp;agg, j);</div><div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;         combined = <a class="code" href="../../da/da2/devicestate_8h.html#a852d7e936d4385c3bb903812de5d6403">ast_devstate_aggregate_result</a>(&amp;agg);</div><div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;         exten = <a class="code" href="../../db/d94/pbx_8c.html#a3aa0b9f1691104cb6214ba66c5dc3a30">ast_devstate_to_extenstate</a>(combined);</div><div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n Exten:%14s  CombinedDevice:%12s  Dev1:%12s  Dev2:%12s&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a3261603753916b98888a5a5fc1d505c3">ast_extension_state2str</a>(exten), <a class="code" href="../../da/da2/devicestate_8h.html#a6190de57ac370315e51f2c46724d5b10">ast_devstate_str</a>(combined), <a class="code" href="../../da/da2/devicestate_8h.html#a6190de57ac370315e51f2c46724d5b10">ast_devstate_str</a>(j), <a class="code" href="../../da/da2/devicestate_8h.html#a6190de57ac370315e51f2c46724d5b10">ast_devstate_str</a>(i));</div><div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;      }</div><div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;   }</div><div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;}</div><div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;</div><div class="line"><a name="l06105"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a590d00dd2b4c421d55b9fa2b1943cedd"> 6105</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a590d00dd2b4c421d55b9fa2b1943cedd">handle_set_extenpatternmatchnew</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *a)</div><div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;{</div><div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;   <span class="keywordtype">int</span> oldval = 0;</div><div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160;</div><div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dialplan set extenpatternmatchnew true&quot;</span>;</div><div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;         <span class="stringliteral">&quot;Usage: dialplan set extenpatternmatchnew true|false\n&quot;</span></div><div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;         <span class="stringliteral">&quot;       Use the NEW extension pattern matching algorithm, true or false.\n&quot;</span>;</div><div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l06117"></a><span class="lineno"> 6117</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;   }</div><div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;</div><div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 4)</div><div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;</div><div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160;   oldval =  <a class="code" href="../../db/d94/pbx_8c.html#a86a7469073a22661d4db7086245c5b18">pbx_set_extenpatternmatchnew</a>(1);</div><div class="line"><a name="l06124"></a><span class="lineno"> 6124</span>&#160;</div><div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160;   <span class="keywordflow">if</span> (oldval)</div><div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n    -- Still using the NEW pattern match algorithm for extension names in the dialplan.\n&quot;</span>);</div><div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n    -- Switched to using the NEW pattern match algorithm for extension names in the dialplan.\n&quot;</span>);</div><div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;</div><div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;}</div><div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;</div><div class="line"><a name="l06133"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#acd4647df41127a333e9fe3f6a90e14d5"> 6133</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#acd4647df41127a333e9fe3f6a90e14d5">handle_unset_extenpatternmatchnew</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *a)</div><div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;{</div><div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;   <span class="keywordtype">int</span> oldval = 0;</div><div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;</div><div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dialplan set extenpatternmatchnew false&quot;</span>;</div><div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;         <span class="stringliteral">&quot;Usage: dialplan set extenpatternmatchnew true|false\n&quot;</span></div><div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;         <span class="stringliteral">&quot;       Use the NEW extension pattern matching algorithm, true or false.\n&quot;</span>;</div><div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;   }</div><div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;</div><div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 4)</div><div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;</div><div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;   oldval =  <a class="code" href="../../db/d94/pbx_8c.html#a86a7469073a22661d4db7086245c5b18">pbx_set_extenpatternmatchnew</a>(0);</div><div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;</div><div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;   <span class="keywordflow">if</span> (!oldval)</div><div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n    -- Still using the OLD pattern match algorithm for extension names in the dialplan.\n&quot;</span>);</div><div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n    -- Switched to using the OLD pattern match algorithm for extension names in the dialplan.\n&quot;</span>);</div><div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;</div><div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;}</div><div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;</div><div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;<span class="comment"> * CLI entries for upper commands ...</span></div><div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l06164"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ac7dafac1c16b8b484834c54b532e5d66"> 6164</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> <a class="code" href="../../db/d94/pbx_8c.html#ac7dafac1c16b8b484834c54b532e5d66">pbx_cli</a>[] = {</div><div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(handle_eat_memory, <span class="stringliteral">&quot;Eats all available memory&quot;</span>),</div><div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../db/d94/pbx_8c.html#a6a6ee2e0a596361065c15a8795b7ea3d">handle_show_hints</a>, <span class="stringliteral">&quot;Show dialplan hints&quot;</span>),</div><div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../db/d94/pbx_8c.html#a6ede44bb54442c1980e3d2e91da4b4bd">handle_show_hint</a>, <span class="stringliteral">&quot;Show dialplan hint&quot;</span>),</div><div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;<span class="preprocessor">#ifdef AST_DEVMODE</span></div><div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../db/d94/pbx_8c.html#a7d88a9d0a54dd6e850c9ffc8d8b5314d">handle_show_device2extenstate</a>, <span class="stringliteral">&quot;Show expected exten state from multiple device states&quot;</span>),</div><div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../db/d94/pbx_8c.html#acf5505fa44483212103cce849e530e1c">handle_show_dialplan</a>, <span class="stringliteral">&quot;Show dialplan&quot;</span>),</div><div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../db/d94/pbx_8c.html#a69b3642bb638524be829a44a1b1219db">handle_debug_dialplan</a>, <span class="stringliteral">&quot;Show fast extension pattern matching data structures&quot;</span>),</div><div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../db/d94/pbx_8c.html#acd4647df41127a333e9fe3f6a90e14d5">handle_unset_extenpatternmatchnew</a>, <span class="stringliteral">&quot;Use the Old extension pattern matching algorithm.&quot;</span>),</div><div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../db/d94/pbx_8c.html#a590d00dd2b4c421d55b9fa2b1943cedd">handle_set_extenpatternmatchnew</a>, <span class="stringliteral">&quot;Use the New extension pattern matching algorithm.&quot;</span>),</div><div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;};</div><div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;</div><div class="line"><a name="l06179"></a><span class="lineno"><a class="line" href="../../d9/da0/pbx__private_8h.html#a0649e18fce3ab1253badc74409de23ea"> 6179</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a0649e18fce3ab1253badc74409de23ea">unreference_cached_app</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/da3/structast__app.html">ast_app</a> *<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>)</div><div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;{</div><div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *context = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *eroot = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *e = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;</div><div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>();</div><div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;   <span class="keywordflow">while</span> ((context = <a class="code" href="../../db/d94/pbx_8c.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a>(context))) {</div><div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;      <span class="keywordflow">while</span> ((eroot = <a class="code" href="../../db/d94/pbx_8c.html#a505ce4b1d8e816a6163f064bc27bc2d6">ast_walk_context_extensions</a>(context, eroot))) {</div><div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;         <span class="keywordflow">while</span> ((e = <a class="code" href="../../db/d94/pbx_8c.html#a6772ce6e8de86d4b6c382dbf68ea4755">ast_walk_extension_priorities</a>(eroot, e))) {</div><div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;            <span class="keywordflow">if</span> (e-&gt;cached_app == app)</div><div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;               e-&gt;cached_app = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160;         }</div><div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160;      }</div><div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;   }</div><div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;</div><div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;   <span class="keywordflow">return</span>;</div><div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;}</div><div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;</div><div class="line"><a name="l06198"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a8a07400b41b3302edf8aef9f53644698"> 6198</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../db/d94/pbx_8c.html#a8a07400b41b3302edf8aef9f53644698">ast_context_find_or_create</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> **extcontexts, <span class="keyword">struct</span> <a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *exttable, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>)</div><div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;{</div><div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>, **<a class="code" href="../../de/dcc/conf2ael_8c.html#a71549c9ba7fb62eeb7c04b697e716543">local_contexts</a>;</div><div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/da7/structfake__context.html">fake_context</a> search;</div><div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;   <span class="keywordtype">int</span> length = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a>) + strlen(name) + 1;</div><div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;</div><div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160;   <span class="keywordflow">if</span> (!contexts_table) {</div><div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;      <span class="comment">/* Protect creation of contexts_table from reentrancy. */</span></div><div class="line"><a name="l06206"></a><span class="lineno"> 6206</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a18c87dac5f7f4368c11b67d8026adc22">ast_wrlock_contexts</a>();</div><div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;      <span class="keywordflow">if</span> (!contexts_table) {</div><div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;         contexts_table = <a class="code" href="../../d6/da0/hashtab_8h.html#ae4ca301bcfd289b81751c34e0c712847">ast_hashtab_create</a>(17,</div><div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a20a2f5668173430437db02cdd0acc9f3">ast_hashtab_compare_contexts</a>,</div><div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#aef63906caa0b965e9c8d8561600038e9">ast_hashtab_resize_java</a>,</div><div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a743bfd52a8c9eb5d939ff5944758d846">ast_hashtab_newsize_java</a>,</div><div class="line"><a name="l06212"></a><span class="lineno"> 6212</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a56461864a4e21b14e753b78f9ac7afb7">ast_hashtab_hash_contexts</a>,</div><div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;            0);</div><div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160;      }</div><div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;   }</div><div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;</div><div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(search.<a class="code" href="../../d6/da7/structfake__context.html#a8e03167ce04350be901b028cc4cf1ce1">name</a>, name, <span class="keyword">sizeof</span>(search.<a class="code" href="../../d6/da7/structfake__context.html#a8e03167ce04350be901b028cc4cf1ce1">name</a>));</div><div class="line"><a name="l06219"></a><span class="lineno"> 6219</span>&#160;   <span class="keywordflow">if</span> (!extcontexts) {</div><div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>();</div><div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;      local_contexts = &amp;<a class="code" href="../../db/d94/pbx_8c.html#aae85d5aab50f2d1b8392d6df276f2561">contexts</a>;</div><div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;      tmp = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(contexts_table, &amp;search);</div><div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;      <span class="keywordflow">if</span> (tmp) {</div><div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160;         tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6022c8a609170c7365fb96e83cb2df48">refcount</a>++;</div><div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160;      }</div><div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;   } <span class="keywordflow">else</span> { <span class="comment">/* local contexts just in a linked list; search there for the new context; slow, linear search, but not frequent */</span></div><div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;      local_contexts = extcontexts;</div><div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160;      tmp = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(exttable, &amp;search);</div><div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;      <span class="keywordflow">if</span> (tmp) {</div><div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;         tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6022c8a609170c7365fb96e83cb2df48">refcount</a>++;</div><div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;      }</div><div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;   }</div><div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;</div><div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;   <span class="keywordflow">if</span> ((tmp = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, length))) {</div><div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a9b07039db138693d1ebe02c3e99ddcab">ast_rwlock_init</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ace4e0066a5b24f84b90536e9906619f6">lock</a>);</div><div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a34eb63008d294b713376e64bb2a7b2ef">macrolock</a>);</div><div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;      strcpy(tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, name);</div><div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;      tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;      tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;      tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(registrar);</div><div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;      <a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">includes</a>, 0);</div><div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160;      <a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">ignorepats</a>, 0);</div><div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;      <a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">alts</a>, 0);</div><div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;      tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6022c8a609170c7365fb96e83cb2df48">refcount</a> = 1;</div><div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Danger! We failed to allocate a context for %s!\n&quot;</span>, name);</div><div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;      <span class="keywordflow">if</span> (!extcontexts) {</div><div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;      }</div><div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;   }</div><div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160;</div><div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;   <span class="keywordflow">if</span> (!extcontexts) {</div><div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;      tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a> = *<a class="code" href="../../de/dcc/conf2ael_8c.html#a71549c9ba7fb62eeb7c04b697e716543">local_contexts</a>;</div><div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;      *local_contexts = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;      <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(contexts_table, tmp); <span class="comment">/*put this context into the tree */</span></div><div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;      tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a> = *<a class="code" href="../../de/dcc/conf2ael_8c.html#a71549c9ba7fb62eeb7c04b697e716543">local_contexts</a>;</div><div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;      <span class="keywordflow">if</span> (exttable)</div><div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#abd1eaf0229b6a896b795026218c9bde0">ast_hashtab_insert_immediate</a>(exttable, tmp); <span class="comment">/*put this context into the tree */</span></div><div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;</div><div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;      *local_contexts = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;   }</div><div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Registered extension context &#39;%s&#39;; registrar: %s\n&quot;</span>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, registrar);</div><div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;}</div><div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;</div><div class="line"><a name="l06272"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a2002365371f1915bdfda9ae2c039604b"> 6272</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a2002365371f1915bdfda9ae2c039604b">ast_context_set_autohints</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keywordtype">int</span> <a class="code" href="../../d0/d5d/dnsmgr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a>)</div><div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;{</div><div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;   con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15">autohints</a> = <a class="code" href="../../d0/d5d/dnsmgr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a>;</div><div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;}</div><div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;</div><div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a06e285124697319566d67b82c25aba19">__ast_context_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *list, <span class="keyword">struct</span> <a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *contexttab, <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;</div><div class="line"><a name="l06279"></a><span class="lineno"><a class="line" href="../../d0/ddc/structstore__hint.html"> 6279</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d0/ddc/structstore__hint.html">store_hint</a> {</div><div class="line"><a name="l06280"></a><span class="lineno"><a class="line" href="../../d0/ddc/structstore__hint.html#ac2a2e2c08a623cc45757db560e06c2b4"> 6280</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/ddc/structstore__hint.html#ac2a2e2c08a623cc45757db560e06c2b4">context</a>;</div><div class="line"><a name="l06281"></a><span class="lineno"><a class="line" href="../../d0/ddc/structstore__hint.html#a0f7fc37040d0e6f05e756cf921c14a31"> 6281</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/ddc/structstore__hint.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>;</div><div class="line"><a name="l06282"></a><span class="lineno"><a class="line" href="../../d0/ddc/structstore__hint.html#a72cb6fc63a95612b6884d7fddd990b6d"> 6282</a></span>&#160;   <a class="code" href="../../d1/d8f/reqresp__parser_8h.html#a7e4aa55331b8292eff94249de72b807d">AST_LIST_HEAD_NOLOCK</a>(, <a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a>) callbacks;</div><div class="line"><a name="l06283"></a><span class="lineno"><a class="line" href="../../d0/ddc/structstore__hint.html#a0078d2e3ae10f15d7634c01199f33d4f"> 6283</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/structstore__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a>;</div><div class="line"><a name="l06284"></a><span class="lineno"><a class="line" href="../../d0/ddc/structstore__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f"> 6284</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/ddc/structstore__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a>;</div><div class="line"><a name="l06285"></a><span class="lineno"><a class="line" href="../../d0/ddc/structstore__hint.html#abb78dc46b9abb01d17e33d9c04684d9e"> 6285</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/ddc/structstore__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a>;</div><div class="line"><a name="l06286"></a><span class="lineno"><a class="line" href="../../d0/ddc/structstore__hint.html#af952513176652fdf6919b7eafad109b7"> 6286</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/ddc/structstore__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a>;</div><div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;</div><div class="line"><a name="l06288"></a><span class="lineno"><a class="line" href="../../d0/ddc/structstore__hint.html#a98a65d0ca099fd79881b59738d69b298"> 6288</a></span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7">AST_LIST_ENTRY</a>(<a class="code" href="../../d0/ddc/structstore__hint.html">store_hint</a>) list;</div><div class="line"><a name="l06289"></a><span class="lineno"><a class="line" href="../../d0/ddc/structstore__hint.html#acfe9c0a67ec2b166d1770b5b04852183"> 6289</a></span>&#160;   <span class="keywordtype">char</span> data[0];</div><div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;};</div><div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;</div><div class="line"><a name="l06292"></a><span class="lineno"><a class="line" href="../../d3/d4d/structstore__hints.html#a810c92087c73653579f41906003a1f83"> 6292</a></span>&#160;<a class="code" href="../../d1/d8f/reqresp__parser_8h.html#a7e4aa55331b8292eff94249de72b807d">AST_LIST_HEAD_NOLOCK</a>(<a class="code" href="../../d3/d4d/structstore__hints.html">store_hints</a>, <a class="code" href="../../d0/ddc/structstore__hint.html">store_hint</a>);</div><div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;</div><div class="line"><a name="l06294"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a59daa69d081df63e2454d50279185f45"> 6294</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a59daa69d081df63e2454d50279185f45">context_merge_incls_swits_igps_other_registrars</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<span class="keyword">new</span>, <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *old, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;{</div><div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;</div><div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;merging incls/swits/igpats from old(%s) to new(%s) context, registrar = %s\n&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(old), <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<span class="keyword">new</span>), registrar);</div><div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;   <span class="comment">/* copy in the includes, switches, and ignorepats */</span></div><div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;   <span class="comment">/* walk through includes */</span></div><div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(old); idx++) {</div><div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *i = <a class="code" href="../../db/d94/pbx_8c.html#afb93dec0c216cb07939fd15949baff2f">ast_context_includes_get</a>(old, idx);</div><div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;</div><div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;      <span class="keywordflow">if</span> (!strcmp(<a class="code" href="../../db/de0/pbx_8h.html#a2bf7469cd4b7de5d4de43d58aeff46c5">ast_get_include_registrar</a>(i), registrar)) {</div><div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;         <span class="keywordflow">continue</span>; <span class="comment">/* not mine */</span></div><div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;      }</div><div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a90e52fc3dabf4f71fd8110bda8fd1393">ast_context_add_include2</a>(<span class="keyword">new</span>, <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i), <a class="code" href="../../db/de0/pbx_8h.html#a2bf7469cd4b7de5d4de43d58aeff46c5">ast_get_include_registrar</a>(i));</div><div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;   }</div><div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;</div><div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;   <span class="comment">/* walk through switches */</span></div><div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a>(old); idx++) {</div><div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *sw = <a class="code" href="../../db/d94/pbx_8c.html#a0161005b7a19bc949f2c8ebbf36a46eb">ast_context_switches_get</a>(old, idx);</div><div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;</div><div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;      <span class="keywordflow">if</span> (!strcmp(<a class="code" href="../../db/de0/pbx_8h.html#a3d45d3b9bc79bf6ffb1540f3e815f677">ast_get_switch_registrar</a>(sw), registrar)) {</div><div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;         <span class="keywordflow">continue</span>; <span class="comment">/* not mine */</span></div><div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;      }</div><div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae27dd9f761219046877675635073cfc3">ast_context_add_switch2</a>(<span class="keyword">new</span>, <a class="code" href="../../db/de0/pbx_8h.html#aa0ebd34e8d1605aa4b6e3fadea6adfb5">ast_get_switch_name</a>(sw), <a class="code" href="../../db/de0/pbx_8h.html#ad4f9fd5bd7afc28347c808ea295233e8">ast_get_switch_data</a>(sw), <a class="code" href="../../db/de0/pbx_8h.html#ae87c469f677f728e1f1337abb3f22ada">ast_get_switch_eval</a>(sw), <a class="code" href="../../db/de0/pbx_8h.html#a3d45d3b9bc79bf6ffb1540f3e815f677">ast_get_switch_registrar</a>(sw));</div><div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;   }</div><div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;</div><div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;   <span class="comment">/* walk thru ignorepats ... */</span></div><div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a>(old); idx++) {</div><div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *ip = <a class="code" href="../../db/d94/pbx_8c.html#a6fee17b9633bb84f0fce209d5d42fb0a">ast_context_ignorepats_get</a>(old, idx);</div><div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;</div><div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;      <span class="keywordflow">if</span> (strcmp(<a class="code" href="../../db/de0/pbx_8h.html#a8a6feb7cd8e08f18c9d0f4887d7f3d47">ast_get_ignorepat_registrar</a>(ip), registrar) == 0) {</div><div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;         <span class="keywordflow">continue</span>; <span class="comment">/* not mine */</span></div><div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;      }</div><div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a665b695dd4aabc37e95f1971e84f700d">ast_context_add_ignorepat2</a>(<span class="keyword">new</span>, <a class="code" href="../../db/de0/pbx_8h.html#ad40e50eea098e5c16ef7dd3ffbff1bba">ast_get_ignorepat_name</a>(ip), <a class="code" href="../../db/de0/pbx_8h.html#a8a6feb7cd8e08f18c9d0f4887d7f3d47">ast_get_ignorepat_registrar</a>(ip));</div><div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;   }</div><div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;}</div><div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;<span class="comment"></span></div><div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;<span class="comment">/*! Set up an autohint placeholder in the hints container */</span></div><div class="line"><a name="l06332"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a60eda23b6ef91e0dcd0a6a31972f169f"> 6332</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a60eda23b6ef91e0dcd0a6a31972f169f">context_table_create_autohints</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *<a class="code" href="../../d8/d56/cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>)</div><div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;{</div><div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con;</div><div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d2e/structast__hashtab__iter.html">ast_hashtab_iter</a> *iter;</div><div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;</div><div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;   <span class="comment">/* Remove all autohints as the below iteration will recreate them */</span></div><div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(autohints, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;</div><div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160;   iter = <a class="code" href="../../d6/da0/hashtab_8h.html#a2a9c96a0ce6fd77d2858e65d7d63f7b3">ast_hashtab_start_traversal</a>(table);</div><div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;   <span class="keywordflow">while</span> ((con = <a class="code" href="../../d6/da0/hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197">ast_hashtab_next</a>(iter))) {</div><div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;      <span class="keywordtype">size_t</span> name_len = strlen(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>) + 1;</div><div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;      <span class="keywordtype">size_t</span> registrar_len = strlen(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>) + 1;</div><div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../da/d7f/structast__autohint.html">ast_autohint</a> *autohint;</div><div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;</div><div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;      <span class="keywordflow">if</span> (!con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15">autohints</a>) {</div><div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;      }</div><div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;</div><div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;      autohint = <a class="code" href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a>(<span class="keyword">sizeof</span>(*autohint) + name_len + registrar_len, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>);</div><div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;      <span class="keywordflow">if</span> (!autohint) {</div><div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;      }</div><div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;</div><div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(autohint-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#a08658434a6786d5f55bf4f6d6a222625">context</a>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, name_len);</div><div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;      autohint-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a> = autohint-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#a08658434a6786d5f55bf4f6d6a222625">context</a> + name_len;</div><div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(autohint-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>, registrar_len);</div><div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;</div><div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(autohints, autohint);</div><div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(autohint, -1);</div><div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;</div><div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Enabled autohints support on context &#39;%s&#39;\n&quot;</span>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;   }</div><div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;   <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(iter);</div><div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;}</div><div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;</div><div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;<span class="comment">/* the purpose of this routine is to duplicate a context, with all its substructure,</span></div><div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;<span class="comment">   except for any extens that have a matching registrar */</span></div><div class="line"><a name="l06369"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a68752b8c650f91f9f3e36d6ce36bba2e"> 6369</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a68752b8c650f91f9f3e36d6ce36bba2e">context_merge</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> **extcontexts, <span class="keyword">struct</span> <a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *exttable, <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;{</div><div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<span class="keyword">new</span> = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(exttable, context); <span class="comment">/* is there a match in the new set? */</span></div><div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *exten_item, *prio_item, *new_exten_item, *new_prio_item;</div><div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d2e/structast__hashtab__iter.html">ast_hashtab_iter</a> *exten_iter;</div><div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d2e/structast__hashtab__iter.html">ast_hashtab_iter</a> *prio_iter;</div><div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;   <span class="keywordtype">int</span> insert_count = 0;</div><div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../df/d44/app__meetme_8c.html#a18b6f1cf748d864dd085819a7d4e6680">first</a> = 1;</div><div class="line"><a name="l06377"></a><span class="lineno"> 6377</span>&#160;</div><div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;   <span class="comment">/* We&#39;ll traverse all the extensions/prios, and see which are not registrar&#39;d with</span></div><div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;<span class="comment">      the current registrar, and copy them to the new context. If the new context does not</span></div><div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;<span class="comment">      exist, we&#39;ll create it &quot;on demand&quot;. If no items are in this context to copy, then we&#39;ll</span></div><div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160;<span class="comment">      only create the empty matching context if the old one meets the criteria */</span></div><div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;</div><div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;   <span class="keywordflow">if</span> (context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>) {</div><div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;      exten_iter = <a class="code" href="../../d6/da0/hashtab_8h.html#a2a9c96a0ce6fd77d2858e65d7d63f7b3">ast_hashtab_start_traversal</a>(context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>);</div><div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;      <span class="keywordflow">while</span> ((exten_item=<a class="code" href="../../d6/da0/hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197">ast_hashtab_next</a>(exten_iter))) {</div><div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;         <span class="keywordflow">if</span> (<span class="keyword">new</span>) {</div><div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;            new_exten_item = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(new-&gt;root_table, exten_item);</div><div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;            new_exten_item = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;         }</div><div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;         prio_iter = <a class="code" href="../../d6/da0/hashtab_8h.html#a2a9c96a0ce6fd77d2858e65d7d63f7b3">ast_hashtab_start_traversal</a>(exten_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>);</div><div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;         <span class="keywordflow">while</span> ((prio_item=<a class="code" href="../../d6/da0/hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197">ast_hashtab_next</a>(prio_iter))) {</div><div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;            <span class="keywordtype">int</span> res1;</div><div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;            <span class="keywordtype">char</span> *dupdstr;</div><div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;</div><div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;            <span class="keywordflow">if</span> (new_exten_item) {</div><div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;               new_prio_item = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(new_exten_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, prio_item);</div><div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;               new_prio_item = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;            }</div><div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;            <span class="keywordflow">if</span> (strcmp(prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>,registrar) == 0) {</div><div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;            }</div><div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;            <span class="comment">/* make sure the new context exists, so we have somewhere to stick this exten/prio */</span></div><div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;            <span class="keywordflow">if</span> (!<span class="keyword">new</span>) {</div><div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160;               <span class="keyword">new</span> = <a class="code" href="../../db/d94/pbx_8c.html#a8a07400b41b3302edf8aef9f53644698">ast_context_find_or_create</a>(extcontexts, exttable, context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>); <span class="comment">/* a new context created via priority from a different context in the old dialplan, gets its registrar from the prio&#39;s registrar */</span></div><div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;               <span class="keywordflow">if</span> (<span class="keyword">new</span>) {</div><div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160;                  <span class="keyword">new</span>-&gt;autohints = context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15">autohints</a>;</div><div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;               }</div><div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;            }</div><div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160;</div><div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;            <span class="comment">/* copy in the includes, switches, and ignorepats */</span></div><div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;            <span class="keywordflow">if</span> (first) { <span class="comment">/* but, only need to do this once */</span></div><div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;               <a class="code" href="../../db/d94/pbx_8c.html#a59daa69d081df63e2454d50279185f45">context_merge_incls_swits_igps_other_registrars</a>(<span class="keyword">new</span>, context, registrar);</div><div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;               first = 0;</div><div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;            }</div><div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160;</div><div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;            <span class="keywordflow">if</span> (!<span class="keyword">new</span>) {</div><div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Could not allocate a new context for %s in merge_and_delete! Danger!\n&quot;</span>, context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;               <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(prio_iter);</div><div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;               <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(exten_iter);</div><div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;               <span class="keywordflow">return</span>; <span class="comment">/* no sense continuing. */</span></div><div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160;            }</div><div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160;            <span class="comment">/* we will not replace existing entries in the new context with stuff from the old context.</span></div><div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;<span class="comment">               but, if this is because of some sort of registrar conflict, we ought to say something... */</span></div><div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;</div><div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;            dupdstr = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>);</div><div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;</div><div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;            res1 = <a class="code" href="../../db/d94/pbx_8c.html#a3be3741c204cd685110243af9daec104">ast_add_extension2</a>(<span class="keyword">new</span>, 0, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>,</div><div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;                                prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> ? prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, dupdstr, <a class="code" href="../../d8/d8a/astmm_8h.html#ad42ab843b767e8b57162c10a158b75c3">ast_free_ptr</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>,</div><div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160;                                prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a3e3ed71b5dcbadee8292f3d1837eaa38">registrar_file</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a90ec1116822211c96e24055d95972cca">registrar_line</a>);</div><div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;            <span class="keywordflow">if</span> (!res1 &amp;&amp; new_exten_item &amp;&amp; new_prio_item){</div><div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Dropping old dialplan item %s/%s/%d [%s(%s)] (registrar=%s) due to conflict with new dialplan\n&quot;</span>,</div><div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160;                     context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, (<span class="keywordtype">char</span>*)prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;               <span class="comment">/* we do NOT pass the priority data from the old to the new -- we pass a copy of it, so no changes to the current dialplan take place,</span></div><div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;<span class="comment">                and no double frees take place, either! */</span></div><div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160;               insert_count++;</div><div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;            }</div><div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160;         }</div><div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(prio_iter);</div><div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160;      }</div><div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;      <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(exten_iter);</div><div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">new</span>) {</div><div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160;      <span class="comment">/* If the context existed but had no extensions, we still want to merge</span></div><div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160;<span class="comment">       * the includes, switches and ignore patterns.</span></div><div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l06448"></a><span class="lineno"> 6448</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a59daa69d081df63e2454d50279185f45">context_merge_incls_swits_igps_other_registrars</a>(<span class="keyword">new</span>, context, registrar);</div><div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160;   }</div><div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;</div><div class="line"><a name="l06451"></a><span class="lineno"> 6451</span>&#160;   <span class="keywordflow">if</span> (!insert_count &amp;&amp; !<span class="keyword">new</span> &amp;&amp; (strcmp(context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>, registrar) != 0 ||</div><div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;        (strcmp(context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>, registrar) == 0 &amp;&amp; context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6022c8a609170c7365fb96e83cb2df48">refcount</a> &gt; 1))) {</div><div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;      <span class="comment">/* we could have given it the registrar of the other module who incremented the refcount,</span></div><div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;<span class="comment">         but that&#39;s not available, so we give it the registrar we know about */</span></div><div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160;      <span class="keyword">new</span> = <a class="code" href="../../db/d94/pbx_8c.html#a8a07400b41b3302edf8aef9f53644698">ast_context_find_or_create</a>(extcontexts, exttable, context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;</div><div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">new</span>) {</div><div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;         <span class="keyword">new</span>-&gt;autohints = context-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15">autohints</a>;</div><div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;      }</div><div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;</div><div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;      <span class="comment">/* copy in the includes, switches, and ignorepats */</span></div><div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a59daa69d081df63e2454d50279185f45">context_merge_incls_swits_igps_other_registrars</a>(<span class="keyword">new</span>, context, registrar);</div><div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160;   }</div><div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;}</div><div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;</div><div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;</div><div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160;<span class="comment">/* XXX this does not check that multiple contexts are merged */</span></div><div class="line"><a name="l06468"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a833a703b21d8f6bcb9f68e57185bca67"> 6468</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a833a703b21d8f6bcb9f68e57185bca67">ast_merge_contexts_and_delete</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> **extcontexts, <span class="keyword">struct</span> <a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *exttable, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160;{</div><div class="line"><a name="l06470"></a><span class="lineno"> 6470</span>&#160;   <span class="keywordtype">double</span> ft;</div><div class="line"><a name="l06471"></a><span class="lineno"> 6471</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l06472"></a><span class="lineno"> 6472</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *oldcontextslist;</div><div class="line"><a name="l06473"></a><span class="lineno"> 6473</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *oldtable;</div><div class="line"><a name="l06474"></a><span class="lineno"> 6474</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d4d/structstore__hints.html">store_hints</a> hints_stored = <a class="code" href="../../df/d90/linkedlists_8h.html#a5a79a9dc65f139cedb64503d171d5df4">AST_LIST_HEAD_NOLOCK_INIT_VALUE</a>;</div><div class="line"><a name="l06475"></a><span class="lineno"> 6475</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d4d/structstore__hints.html">store_hints</a> hints_removed = <a class="code" href="../../df/d90/linkedlists_8h.html#a5a79a9dc65f139cedb64503d171d5df4">AST_LIST_HEAD_NOLOCK_INIT_VALUE</a>;</div><div class="line"><a name="l06476"></a><span class="lineno"> 6476</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/ddc/structstore__hint.html">store_hint</a> *saved_hint;</div><div class="line"><a name="l06477"></a><span class="lineno"> 6477</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint;</div><div class="line"><a name="l06478"></a><span class="lineno"> 6478</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>;</div><div class="line"><a name="l06479"></a><span class="lineno"> 6479</span>&#160;   <span class="keywordtype">int</span> length;</div><div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *thiscb;</div><div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d2e/structast__hashtab__iter.html">ast_hashtab_iter</a> *iter;</div><div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i;</div><div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160;   <span class="keywordtype">int</span> ctx_count = 0;</div><div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;   <span class="keyword">struct </span>timeval begintime;</div><div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;   <span class="keyword">struct </span>timeval writelocktime;</div><div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;   <span class="keyword">struct </span>timeval endlocktime;</div><div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;   <span class="keyword">struct </span>timeval enddeltime;</div><div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;</div><div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160;<span class="comment">    * It is very important that this function hold the hints</span></div><div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;<span class="comment">    * container lock _and_ the conlock during its operation; not</span></div><div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160;<span class="comment">    * only do we need to ensure that the list of contexts and</span></div><div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;<span class="comment">    * extensions does not change, but also that no hint callbacks</span></div><div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;<span class="comment">    * (watchers) are added or removed during the merge/delete</span></div><div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;<span class="comment">    * process</span></div><div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;<span class="comment">    * In addition, the locks _must_ be taken in this order, because</span></div><div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;<span class="comment">    * there are already other code paths that use this order</span></div><div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;</div><div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;   begintime = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">context_merge_lock</a>);<span class="comment">/* Serialize ast_merge_contexts_and_delete */</span></div><div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a18c87dac5f7f4368c11b67d8026adc22">ast_wrlock_contexts</a>();</div><div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;</div><div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;   <span class="keywordflow">if</span> (!contexts_table) {</div><div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;      <span class="comment">/* Create any autohint contexts */</span></div><div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a60eda23b6ef91e0dcd0a6a31972f169f">context_table_create_autohints</a>(exttable);</div><div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160;</div><div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;      <span class="comment">/* Well, that&#39;s odd. There are no contexts. */</span></div><div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;      contexts_table = exttable;</div><div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160;      contexts = *extcontexts;</div><div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">context_merge_lock</a>);</div><div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;   }</div><div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;</div><div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;   iter = <a class="code" href="../../d6/da0/hashtab_8h.html#a2a9c96a0ce6fd77d2858e65d7d63f7b3">ast_hashtab_start_traversal</a>(contexts_table);</div><div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;   <span class="keywordflow">while</span> ((tmp = <a class="code" href="../../d6/da0/hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197">ast_hashtab_next</a>(iter))) {</div><div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;      ++ctx_count;</div><div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a68752b8c650f91f9f3e36d6ce36bba2e">context_merge</a>(extcontexts, exttable, tmp, registrar);</div><div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;   }</div><div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;   <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(iter);</div><div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;</div><div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hints);</div><div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;   writelocktime = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160;</div><div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;   <span class="comment">/* preserve all watchers for hints */</span></div><div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160;   i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(hints, <a class="code" href="../../d5/da5/astobj2_8h.html#a7b5de2aa80f528d3dc554caadb8dc6aba42e2c6aadc44e4259a058a6675b7e7e4">AO2_ITERATOR_DONTLOCK</a>);</div><div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160;   <span class="keywordflow">for</span> (; (hint = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i)); <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1)) {</div><div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>)) {</div><div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160;         <span class="keywordtype">size_t</span> exten_len;</div><div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160;</div><div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;         <span class="keywordflow">if</span> (!hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>) {</div><div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;            <span class="comment">/* The extension has already been destroyed. (Should never happen here) */</span></div><div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;         }</div><div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;</div><div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;         exten_len = strlen(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>) + 1;</div><div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160;         length = exten_len + strlen(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">parent</a>-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>) + 1</div><div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160;            + <span class="keyword">sizeof</span>(*saved_hint);</div><div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;         <span class="keywordflow">if</span> (!(saved_hint = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, length))) {</div><div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l06545"></a><span class="lineno"> 6545</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160;         }</div><div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;</div><div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;         <span class="comment">/* This removes all the callbacks from the hint into saved_hint. */</span></div><div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;         <span class="keywordflow">while</span> ((thiscb = <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;            <a class="code" href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a>(&amp;saved_hint-&gt;callbacks, thiscb, <a class="code" href="../../d3/d96/structentry.html">entry</a>);</div><div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160;<span class="comment">             * We intentionally do not unref thiscb to account for the</span></div><div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;<span class="comment">             * non-ao2 reference in saved_hint-&gt;callbacks</span></div><div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;         }</div><div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;</div><div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;         saved_hint-&gt;laststate = hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a>;</div><div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;         saved_hint-&gt;context = saved_hint-&gt;data;</div><div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;         strcpy(saved_hint-&gt;data, hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">parent</a>-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;         saved_hint-&gt;exten = saved_hint-&gt;data + strlen(saved_hint-&gt;context) + 1;</div><div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(saved_hint-&gt;exten, hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, exten_len);</div><div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;         <span class="keywordflow">if</span> (hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a>) {</div><div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160;            saved_hint-&gt;last_presence_subtype = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a>);</div><div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;         }</div><div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;         <span class="keywordflow">if</span> (hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a>) {</div><div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160;            saved_hint-&gt;last_presence_message = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a>);</div><div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;         }</div><div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160;         saved_hint-&gt;last_presence_state = hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a>;</div><div class="line"><a name="l06569"></a><span class="lineno"> 6569</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l06570"></a><span class="lineno"> 6570</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307">AST_LIST_INSERT_HEAD</a>(&amp;hints_stored, saved_hint, list);</div><div class="line"><a name="l06571"></a><span class="lineno"> 6571</span>&#160;      }</div><div class="line"><a name="l06572"></a><span class="lineno"> 6572</span>&#160;   }</div><div class="line"><a name="l06573"></a><span class="lineno"> 6573</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div><div class="line"><a name="l06574"></a><span class="lineno"> 6574</span>&#160;</div><div class="line"><a name="l06575"></a><span class="lineno"> 6575</span>&#160;   <span class="comment">/* save the old table and list */</span></div><div class="line"><a name="l06576"></a><span class="lineno"> 6576</span>&#160;   oldtable = <a class="code" href="../../db/d94/pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>;</div><div class="line"><a name="l06577"></a><span class="lineno"> 6577</span>&#160;   oldcontextslist = <a class="code" href="../../db/d94/pbx_8c.html#aae85d5aab50f2d1b8392d6df276f2561">contexts</a>;</div><div class="line"><a name="l06578"></a><span class="lineno"> 6578</span>&#160;</div><div class="line"><a name="l06579"></a><span class="lineno"> 6579</span>&#160;   <span class="comment">/* move in the new table and list */</span></div><div class="line"><a name="l06580"></a><span class="lineno"> 6580</span>&#160;   contexts_table = exttable;</div><div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160;   contexts = *extcontexts;</div><div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;</div><div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160;<span class="comment">    * Restore the watchers for hints that can be found; notify</span></div><div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160;<span class="comment">    * those that cannot be restored.</span></div><div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160;   <span class="keywordflow">while</span> ((saved_hint = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(&amp;hints_stored, list))) {</div><div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../db/d81/structpbx__find__info.html">pbx_find_info</a> q = { .<a class="code" href="../../db/d81/structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">stacklen</a> = 0 };</div><div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;</div><div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;      exten = <a class="code" href="../../db/d94/pbx_8c.html#a63e03245dc48558e55da8890b3dbb87e">pbx_find_extension</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;q, saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#ac2a2e2c08a623cc45757db560e06c2b4">context</a>, saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a>);</div><div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l06593"></a><span class="lineno"> 6593</span>&#160;<span class="comment">       * If this is a pattern, dynamically create a new extension for this</span></div><div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160;<span class="comment">       * particular match.  Note that this will only happen once for each</span></div><div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160;<span class="comment">       * individual extension, because the pattern will no longer match first.</span></div><div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160;      <span class="keywordflow">if</span> (exten &amp;&amp; exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>[0] == <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a62350bf22ada5eec5dcb16986c1909b9">ast_add_extension_nolock</a>(exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">parent</a>-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, 0, saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;            <a class="code" href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>), <a class="code" href="../../d8/d8a/astmm_8h.html#ad42ab843b767e8b57162c10a158b75c3">ast_free_ptr</a>,</div><div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160;            exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;         <span class="comment">/* rwlocks are not recursive locks */</span></div><div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160;         exten = <a class="code" href="../../db/d94/pbx_8c.html#ad121506517c1a92626d906f787f17358">ast_hint_extension_nolock</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#ac2a2e2c08a623cc45757db560e06c2b4">context</a>,</div><div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;            saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>);</div><div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160;      }</div><div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;</div><div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;      <span class="comment">/* Find the hint in the hints container */</span></div><div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;      hint = exten ? <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(hints, exten, 0) : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160;      <span class="keywordflow">if</span> (!hint) {</div><div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l06610"></a><span class="lineno"> 6610</span>&#160;<span class="comment">          * Notify watchers of this removed hint later when we aren&#39;t</span></div><div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160;<span class="comment">          * encumberd by so many locks.</span></div><div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l06613"></a><span class="lineno"> 6613</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307">AST_LIST_INSERT_HEAD</a>(&amp;hints_removed, saved_hint, list);</div><div class="line"><a name="l06614"></a><span class="lineno"> 6614</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l06615"></a><span class="lineno"> 6615</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l06616"></a><span class="lineno"> 6616</span>&#160;         <span class="keywordflow">while</span> ((thiscb = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(&amp;saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>, <a class="code" href="../../d3/d96/structentry.html">entry</a>))) {</div><div class="line"><a name="l06617"></a><span class="lineno"> 6617</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>, thiscb);</div><div class="line"><a name="l06618"></a><span class="lineno"> 6618</span>&#160;            <span class="comment">/* Ref that we added when putting into saved_hint-&gt;callbacks */</span></div><div class="line"><a name="l06619"></a><span class="lineno"> 6619</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(thiscb, -1);</div><div class="line"><a name="l06620"></a><span class="lineno"> 6620</span>&#160;         }</div><div class="line"><a name="l06621"></a><span class="lineno"> 6621</span>&#160;         hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a> = saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a>;</div><div class="line"><a name="l06622"></a><span class="lineno"> 6622</span>&#160;         hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a> = saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">last_presence_state</a>;</div><div class="line"><a name="l06623"></a><span class="lineno"> 6623</span>&#160;         hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a> = saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a>;</div><div class="line"><a name="l06624"></a><span class="lineno"> 6624</span>&#160;         hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a> = saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a>;</div><div class="line"><a name="l06625"></a><span class="lineno"> 6625</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l06626"></a><span class="lineno"> 6626</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1);</div><div class="line"><a name="l06627"></a><span class="lineno"> 6627</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l06628"></a><span class="lineno"> 6628</span>&#160;<span class="comment">          * The free of saved_hint-&gt;last_presence_subtype and</span></div><div class="line"><a name="l06629"></a><span class="lineno"> 6629</span>&#160;<span class="comment">          * saved_hint-&gt;last_presence_message is not necessary here.</span></div><div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(saved_hint);</div><div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;      }</div><div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;   }</div><div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160;</div><div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;   <span class="comment">/* Create all applicable autohint contexts */</span></div><div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a60eda23b6ef91e0dcd0a6a31972f169f">context_table_create_autohints</a>(contexts_table);</div><div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;</div><div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160;</div><div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160;<span class="comment">    * Notify watchers of all removed hints with the same lock</span></div><div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;<span class="comment">    * environment as device_state_cb().</span></div><div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;   <span class="keywordflow">while</span> ((saved_hint = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(&amp;hints_removed, list))) {</div><div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;      <span class="comment">/* this hint has been removed, notify the watchers */</span></div><div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160;      <span class="keywordflow">while</span> ((thiscb = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(&amp;saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#a9138102d461098886592f66e9fb82806">callbacks</a>, <a class="code" href="../../d3/d96/structentry.html">entry</a>))) {</div><div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a5a034ba4312a7a7fcf3f3600548427d6">execute_state_callback</a>(thiscb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a>,</div><div class="line"><a name="l06649"></a><span class="lineno"> 6649</span>&#160;            saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#ac2a2e2c08a623cc45757db560e06c2b4">context</a>,</div><div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;            saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160;            thiscb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>,</div><div class="line"><a name="l06652"></a><span class="lineno"> 6652</span>&#160;            <a class="code" href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a2e89bd60b1752d920f58a70164607189">AST_HINT_UPDATE_DEVICE</a>,</div><div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160;            <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div><div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;            <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;         <span class="comment">/* Ref that we added when putting into saved_hint-&gt;callbacks */</span></div><div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(thiscb, -1);</div><div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160;      }</div><div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">last_presence_subtype</a>);</div><div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(saved_hint-&gt;<a class="code" href="../../d0/ddc/structstore__hint.html#af952513176652fdf6919b7eafad109b7">last_presence_message</a>);</div><div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(saved_hint);</div><div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160;   }</div><div class="line"><a name="l06662"></a><span class="lineno"> 6662</span>&#160;</div><div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">context_merge_lock</a>);</div><div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160;   endlocktime = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;</div><div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160;<span class="comment">    * The old list and hashtab no longer are relevant, delete them</span></div><div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;<span class="comment">    * while the rest of asterisk is now freely using the new stuff</span></div><div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;<span class="comment">    * instead.</span></div><div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160;</div><div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160;   <a class="code" href="../../d6/da0/hashtab_8h.html#a6103589badf8d9440a0cece2802c4c3a">ast_hashtab_destroy</a>(oldtable, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;</div><div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;   <span class="keywordflow">for</span> (tmp = oldcontextslist; <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>; ) {</div><div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;  <span class="comment">/* next starting point */</span></div><div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160;</div><div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;      next = tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a>;</div><div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#af51adb9b78f628397d7b0c1781b6d79e">__ast_internal_context_destroy</a>(tmp);</div><div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160;      tmp = <a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;</div><div class="line"><a name="l06680"></a><span class="lineno"> 6680</span>&#160;   }</div><div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160;   enddeltime = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l06682"></a><span class="lineno"> 6682</span>&#160;</div><div class="line"><a name="l06683"></a><span class="lineno"> 6683</span>&#160;   ft = <a class="code" href="../../de/df7/time_8h.html#a14d1e085a2d8580052c28807e762bfad">ast_tvdiff_us</a>(writelocktime, begintime);</div><div class="line"><a name="l06684"></a><span class="lineno"> 6684</span>&#160;   ft /= 1000000.0;</div><div class="line"><a name="l06685"></a><span class="lineno"> 6685</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Time to scan old dialplan and merge leftovers back into the new: %8.6f sec\n&quot;</span>, ft);</div><div class="line"><a name="l06686"></a><span class="lineno"> 6686</span>&#160;</div><div class="line"><a name="l06687"></a><span class="lineno"> 6687</span>&#160;   ft = <a class="code" href="../../de/df7/time_8h.html#a14d1e085a2d8580052c28807e762bfad">ast_tvdiff_us</a>(endlocktime, writelocktime);</div><div class="line"><a name="l06688"></a><span class="lineno"> 6688</span>&#160;   ft /= 1000000.0;</div><div class="line"><a name="l06689"></a><span class="lineno"> 6689</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Time to restore hints and swap in new dialplan: %8.6f sec\n&quot;</span>, ft);</div><div class="line"><a name="l06690"></a><span class="lineno"> 6690</span>&#160;</div><div class="line"><a name="l06691"></a><span class="lineno"> 6691</span>&#160;   ft = <a class="code" href="../../de/df7/time_8h.html#a14d1e085a2d8580052c28807e762bfad">ast_tvdiff_us</a>(enddeltime, endlocktime);</div><div class="line"><a name="l06692"></a><span class="lineno"> 6692</span>&#160;   ft /= 1000000.0;</div><div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Time to delete the old dialplan: %8.6f sec\n&quot;</span>, ft);</div><div class="line"><a name="l06694"></a><span class="lineno"> 6694</span>&#160;</div><div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;   ft = <a class="code" href="../../de/df7/time_8h.html#a14d1e085a2d8580052c28807e762bfad">ast_tvdiff_us</a>(enddeltime, begintime);</div><div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160;   ft /= 1000000.0;</div><div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Total time merge_contexts_delete: %8.6f sec\n&quot;</span>, ft);</div><div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s successfully loaded %d contexts (enable debug for details).\n&quot;</span>, registrar, ctx_count);</div><div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;}</div><div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160;</div><div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160;<span class="comment"> * errno values</span></div><div class="line"><a name="l06703"></a><span class="lineno"> 6703</span>&#160;<span class="comment"> *  EBUSY  - can&#39;t lock</span></div><div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;<span class="comment"> *  ENOENT - no existence of context</span></div><div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l06706"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3903111827b675ec313e56a28ac80cf9"> 6706</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a3903111827b675ec313e56a28ac80cf9">ast_context_add_include</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *include, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;{</div><div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;</div><div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;   c = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(context);</div><div class="line"><a name="l06712"></a><span class="lineno"> 6712</span>&#160;   <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;      ret = <a class="code" href="../../db/d94/pbx_8c.html#a90e52fc3dabf4f71fd8110bda8fd1393">ast_context_add_include2</a>(c, include, registrar);</div><div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160;   }</div><div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;}</div><div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;</div><div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;<span class="comment"> * errno values</span></div><div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160;<span class="comment"> *  ENOMEM - out of memory</span></div><div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;<span class="comment"> *  EBUSY  - can&#39;t lock</span></div><div class="line"><a name="l06723"></a><span class="lineno"> 6723</span>&#160;<span class="comment"> *  EEXIST - already included</span></div><div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;<span class="comment"> *  EINVAL - there is no existence of context for inclusion</span></div><div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l06726"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a90e52fc3dabf4f71fd8110bda8fd1393"> 6726</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a90e52fc3dabf4f71fd8110bda8fd1393">ast_context_add_include2</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>,</div><div class="line"><a name="l06727"></a><span class="lineno"> 6727</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;{</div><div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *new_include;</div><div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;</div><div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;   <span class="comment">/* allocate new include structure ... */</span></div><div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;   new_include = <a class="code" href="../../d6/d0e/pbx__include_8c.html#abe16a0d4e5edfd9e7ec86b255abe19a0">include_alloc</a>(value, registrar);</div><div class="line"><a name="l06734"></a><span class="lineno"> 6734</span>&#160;   <span class="keywordflow">if</span> (!new_include) {</div><div class="line"><a name="l06735"></a><span class="lineno"> 6735</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06736"></a><span class="lineno"> 6736</span>&#160;   }</div><div class="line"><a name="l06737"></a><span class="lineno"> 6737</span>&#160;</div><div class="line"><a name="l06738"></a><span class="lineno"> 6738</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a>(con);</div><div class="line"><a name="l06739"></a><span class="lineno"> 6739</span>&#160;</div><div class="line"><a name="l06740"></a><span class="lineno"> 6740</span>&#160;   <span class="comment">/* ... go to last include and check if context is already included too... */</span></div><div class="line"><a name="l06741"></a><span class="lineno"> 6741</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(con); idx++) {</div><div class="line"><a name="l06742"></a><span class="lineno"> 6742</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *i = <a class="code" href="../../db/d94/pbx_8c.html#afb93dec0c216cb07939fd15949baff2f">ast_context_includes_get</a>(con, idx);</div><div class="line"><a name="l06743"></a><span class="lineno"> 6743</span>&#160;</div><div class="line"><a name="l06744"></a><span class="lineno"> 6744</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(i), <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(new_include))) {</div><div class="line"><a name="l06745"></a><span class="lineno"> 6745</span>&#160;         <a class="code" href="../../d6/d0e/pbx__include_8c.html#a074a4f22541e1231de75d69e37fc4adf">include_free</a>(new_include);</div><div class="line"><a name="l06746"></a><span class="lineno"> 6746</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l06747"></a><span class="lineno"> 6747</span>&#160;         <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EEXIST;</div><div class="line"><a name="l06748"></a><span class="lineno"> 6748</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06749"></a><span class="lineno"> 6749</span>&#160;      }</div><div class="line"><a name="l06750"></a><span class="lineno"> 6750</span>&#160;   }</div><div class="line"><a name="l06751"></a><span class="lineno"> 6751</span>&#160;</div><div class="line"><a name="l06752"></a><span class="lineno"> 6752</span>&#160;   <span class="comment">/* ... include new context into context list, unlock, return */</span></div><div class="line"><a name="l06753"></a><span class="lineno"> 6753</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">includes</a>, new_include)) {</div><div class="line"><a name="l06754"></a><span class="lineno"> 6754</span>&#160;      <a class="code" href="../../d6/d0e/pbx__include_8c.html#a074a4f22541e1231de75d69e37fc4adf">include_free</a>(new_include);</div><div class="line"><a name="l06755"></a><span class="lineno"> 6755</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l06756"></a><span class="lineno"> 6756</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06757"></a><span class="lineno"> 6757</span>&#160;   }</div><div class="line"><a name="l06758"></a><span class="lineno"> 6758</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Including context &#39;%s&#39; in context &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l06759"></a><span class="lineno"> 6759</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a>(new_include), <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(con));</div><div class="line"><a name="l06760"></a><span class="lineno"> 6760</span>&#160;</div><div class="line"><a name="l06761"></a><span class="lineno"> 6761</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l06762"></a><span class="lineno"> 6762</span>&#160;</div><div class="line"><a name="l06763"></a><span class="lineno"> 6763</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l06764"></a><span class="lineno"> 6764</span>&#160;}</div><div class="line"><a name="l06765"></a><span class="lineno"> 6765</span>&#160;</div><div class="line"><a name="l06766"></a><span class="lineno"> 6766</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l06767"></a><span class="lineno"> 6767</span>&#160;<span class="comment"> * errno values</span></div><div class="line"><a name="l06768"></a><span class="lineno"> 6768</span>&#160;<span class="comment"> *  EBUSY  - can&#39;t lock</span></div><div class="line"><a name="l06769"></a><span class="lineno"> 6769</span>&#160;<span class="comment"> *  ENOENT - no existence of context</span></div><div class="line"><a name="l06770"></a><span class="lineno"> 6770</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l06771"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a7677cd4c8e3a0c3d205f412e396a7d5c"> 6771</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a7677cd4c8e3a0c3d205f412e396a7d5c">ast_context_add_switch</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *sw, <span class="keyword">const</span> <span class="keywordtype">char</span> *data, <span class="keywordtype">int</span> eval, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06772"></a><span class="lineno"> 6772</span>&#160;{</div><div class="line"><a name="l06773"></a><span class="lineno"> 6773</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l06774"></a><span class="lineno"> 6774</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l06775"></a><span class="lineno"> 6775</span>&#160;</div><div class="line"><a name="l06776"></a><span class="lineno"> 6776</span>&#160;   c = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(context);</div><div class="line"><a name="l06777"></a><span class="lineno"> 6777</span>&#160;   <span class="keywordflow">if</span> (c) { <span class="comment">/* found, add switch to this context */</span></div><div class="line"><a name="l06778"></a><span class="lineno"> 6778</span>&#160;      ret = <a class="code" href="../../db/d94/pbx_8c.html#ae27dd9f761219046877675635073cfc3">ast_context_add_switch2</a>(c, sw, data, eval, registrar);</div><div class="line"><a name="l06779"></a><span class="lineno"> 6779</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06780"></a><span class="lineno"> 6780</span>&#160;   }</div><div class="line"><a name="l06781"></a><span class="lineno"> 6781</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l06782"></a><span class="lineno"> 6782</span>&#160;}</div><div class="line"><a name="l06783"></a><span class="lineno"> 6783</span>&#160;</div><div class="line"><a name="l06784"></a><span class="lineno"> 6784</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l06785"></a><span class="lineno"> 6785</span>&#160;<span class="comment"> * errno values</span></div><div class="line"><a name="l06786"></a><span class="lineno"> 6786</span>&#160;<span class="comment"> *  ENOMEM - out of memory</span></div><div class="line"><a name="l06787"></a><span class="lineno"> 6787</span>&#160;<span class="comment"> *  EBUSY  - can&#39;t lock</span></div><div class="line"><a name="l06788"></a><span class="lineno"> 6788</span>&#160;<span class="comment"> *  EEXIST - already included</span></div><div class="line"><a name="l06789"></a><span class="lineno"> 6789</span>&#160;<span class="comment"> *  EINVAL - there is no existence of context for inclusion</span></div><div class="line"><a name="l06790"></a><span class="lineno"> 6790</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l06791"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae27dd9f761219046877675635073cfc3"> 6791</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae27dd9f761219046877675635073cfc3">ast_context_add_switch2</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>,</div><div class="line"><a name="l06792"></a><span class="lineno"> 6792</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *data, <span class="keywordtype">int</span> eval, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06793"></a><span class="lineno"> 6793</span>&#160;{</div><div class="line"><a name="l06794"></a><span class="lineno"> 6794</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l06795"></a><span class="lineno"> 6795</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *new_sw;</div><div class="line"><a name="l06796"></a><span class="lineno"> 6796</span>&#160;</div><div class="line"><a name="l06797"></a><span class="lineno"> 6797</span>&#160;   <span class="comment">/* allocate new sw structure ... */</span></div><div class="line"><a name="l06798"></a><span class="lineno"> 6798</span>&#160;   <span class="keywordflow">if</span> (!(new_sw = <a class="code" href="../../d9/da0/pbx__private_8h.html#a877bb7ddb2d41bf4d7e7fc77bc78e65f">sw_alloc</a>(value, data, eval, registrar))) {</div><div class="line"><a name="l06799"></a><span class="lineno"> 6799</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06800"></a><span class="lineno"> 6800</span>&#160;   }</div><div class="line"><a name="l06801"></a><span class="lineno"> 6801</span>&#160;</div><div class="line"><a name="l06802"></a><span class="lineno"> 6802</span>&#160;   <span class="comment">/* ... try to lock this context ... */</span></div><div class="line"><a name="l06803"></a><span class="lineno"> 6803</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a>(con);</div><div class="line"><a name="l06804"></a><span class="lineno"> 6804</span>&#160;</div><div class="line"><a name="l06805"></a><span class="lineno"> 6805</span>&#160;   <span class="comment">/* ... go to last sw and check if context is already swd too... */</span></div><div class="line"><a name="l06806"></a><span class="lineno"> 6806</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a>(con); idx++) {</div><div class="line"><a name="l06807"></a><span class="lineno"> 6807</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *i = <a class="code" href="../../db/d94/pbx_8c.html#a0161005b7a19bc949f2c8ebbf36a46eb">ast_context_switches_get</a>(con, idx);</div><div class="line"><a name="l06808"></a><span class="lineno"> 6808</span>&#160;</div><div class="line"><a name="l06809"></a><span class="lineno"> 6809</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="../../db/de0/pbx_8h.html#aa0ebd34e8d1605aa4b6e3fadea6adfb5">ast_get_switch_name</a>(i), <a class="code" href="../../db/de0/pbx_8h.html#aa0ebd34e8d1605aa4b6e3fadea6adfb5">ast_get_switch_name</a>(new_sw)) &amp;&amp;</div><div class="line"><a name="l06810"></a><span class="lineno"> 6810</span>&#160;         !strcasecmp(<a class="code" href="../../db/de0/pbx_8h.html#ad4f9fd5bd7afc28347c808ea295233e8">ast_get_switch_data</a>(i), <a class="code" href="../../db/de0/pbx_8h.html#ad4f9fd5bd7afc28347c808ea295233e8">ast_get_switch_data</a>(new_sw))) {</div><div class="line"><a name="l06811"></a><span class="lineno"> 6811</span>&#160;         <a class="code" href="../../d9/da0/pbx__private_8h.html#acd29668e92f96d142fe8d058db4ed773">sw_free</a>(new_sw);</div><div class="line"><a name="l06812"></a><span class="lineno"> 6812</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l06813"></a><span class="lineno"> 6813</span>&#160;         <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EEXIST;</div><div class="line"><a name="l06814"></a><span class="lineno"> 6814</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06815"></a><span class="lineno"> 6815</span>&#160;      }</div><div class="line"><a name="l06816"></a><span class="lineno"> 6816</span>&#160;   }</div><div class="line"><a name="l06817"></a><span class="lineno"> 6817</span>&#160;</div><div class="line"><a name="l06818"></a><span class="lineno"> 6818</span>&#160;   <span class="comment">/* ... sw new context into context list, unlock, return */</span></div><div class="line"><a name="l06819"></a><span class="lineno"> 6819</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">alts</a>, new_sw)) {</div><div class="line"><a name="l06820"></a><span class="lineno"> 6820</span>&#160;      <a class="code" href="../../d9/da0/pbx__private_8h.html#acd29668e92f96d142fe8d058db4ed773">sw_free</a>(new_sw);</div><div class="line"><a name="l06821"></a><span class="lineno"> 6821</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l06822"></a><span class="lineno"> 6822</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06823"></a><span class="lineno"> 6823</span>&#160;   }</div><div class="line"><a name="l06824"></a><span class="lineno"> 6824</span>&#160;</div><div class="line"><a name="l06825"></a><span class="lineno"> 6825</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Including switch &#39;%s/%s&#39; in context &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l06826"></a><span class="lineno"> 6826</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#aa0ebd34e8d1605aa4b6e3fadea6adfb5">ast_get_switch_name</a>(new_sw), <a class="code" href="../../db/de0/pbx_8h.html#ad4f9fd5bd7afc28347c808ea295233e8">ast_get_switch_data</a>(new_sw), <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(con));</div><div class="line"><a name="l06827"></a><span class="lineno"> 6827</span>&#160;</div><div class="line"><a name="l06828"></a><span class="lineno"> 6828</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l06829"></a><span class="lineno"> 6829</span>&#160;</div><div class="line"><a name="l06830"></a><span class="lineno"> 6830</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l06831"></a><span class="lineno"> 6831</span>&#160;}</div><div class="line"><a name="l06832"></a><span class="lineno"> 6832</span>&#160;</div><div class="line"><a name="l06833"></a><span class="lineno"> 6833</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l06834"></a><span class="lineno"> 6834</span>&#160;<span class="comment"> * EBUSY  - can&#39;t lock</span></div><div class="line"><a name="l06835"></a><span class="lineno"> 6835</span>&#160;<span class="comment"> * ENOENT - there is not context existence</span></div><div class="line"><a name="l06836"></a><span class="lineno"> 6836</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l06837"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a08e43dc093c586991af4e2f86fa14f2e"> 6837</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a08e43dc093c586991af4e2f86fa14f2e">ast_context_remove_ignorepat</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *ignorepat, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06838"></a><span class="lineno"> 6838</span>&#160;{</div><div class="line"><a name="l06839"></a><span class="lineno"> 6839</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l06840"></a><span class="lineno"> 6840</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l06841"></a><span class="lineno"> 6841</span>&#160;</div><div class="line"><a name="l06842"></a><span class="lineno"> 6842</span>&#160;   c = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(context);</div><div class="line"><a name="l06843"></a><span class="lineno"> 6843</span>&#160;   <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l06844"></a><span class="lineno"> 6844</span>&#160;      ret = <a class="code" href="../../db/d94/pbx_8c.html#a3c599ffe1436debbdccd45a28685b567">ast_context_remove_ignorepat2</a>(c, ignorepat, registrar);</div><div class="line"><a name="l06845"></a><span class="lineno"> 6845</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06846"></a><span class="lineno"> 6846</span>&#160;   }</div><div class="line"><a name="l06847"></a><span class="lineno"> 6847</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l06848"></a><span class="lineno"> 6848</span>&#160;}</div><div class="line"><a name="l06849"></a><span class="lineno"> 6849</span>&#160;</div><div class="line"><a name="l06850"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3c599ffe1436debbdccd45a28685b567"> 6850</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a3c599ffe1436debbdccd45a28685b567">ast_context_remove_ignorepat2</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *ignorepat, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06851"></a><span class="lineno"> 6851</span>&#160;{</div><div class="line"><a name="l06852"></a><span class="lineno"> 6852</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l06853"></a><span class="lineno"> 6853</span>&#160;</div><div class="line"><a name="l06854"></a><span class="lineno"> 6854</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a>(con);</div><div class="line"><a name="l06855"></a><span class="lineno"> 6855</span>&#160;</div><div class="line"><a name="l06856"></a><span class="lineno"> 6856</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a>(con); idx++) {</div><div class="line"><a name="l06857"></a><span class="lineno"> 6857</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *ip = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">ignorepats</a>, idx);</div><div class="line"><a name="l06858"></a><span class="lineno"> 6858</span>&#160;</div><div class="line"><a name="l06859"></a><span class="lineno"> 6859</span>&#160;      <span class="keywordflow">if</span> (!strcmp(<a class="code" href="../../db/de0/pbx_8h.html#ad40e50eea098e5c16ef7dd3ffbff1bba">ast_get_ignorepat_name</a>(ip), ignorepat) &amp;&amp;</div><div class="line"><a name="l06860"></a><span class="lineno"> 6860</span>&#160;         (!registrar || (registrar == <a class="code" href="../../db/de0/pbx_8h.html#a8a6feb7cd8e08f18c9d0f4887d7f3d47">ast_get_ignorepat_registrar</a>(ip)))) {</div><div class="line"><a name="l06861"></a><span class="lineno"> 6861</span>&#160;         <a class="code" href="../../d6/d68/vector_8h.html#a0414ce2ed1741b1e048ccafc0df420c3">AST_VECTOR_REMOVE_ORDERED</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">ignorepats</a>, idx);</div><div class="line"><a name="l06862"></a><span class="lineno"> 6862</span>&#160;         <a class="code" href="../../d9/d63/pbx__ignorepat_8c.html#ab3503fb9ba3b0c046a2d1a2a482e8ae1">ignorepat_free</a>(ip);</div><div class="line"><a name="l06863"></a><span class="lineno"> 6863</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l06864"></a><span class="lineno"> 6864</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l06865"></a><span class="lineno"> 6865</span>&#160;      }</div><div class="line"><a name="l06866"></a><span class="lineno"> 6866</span>&#160;   }</div><div class="line"><a name="l06867"></a><span class="lineno"> 6867</span>&#160;</div><div class="line"><a name="l06868"></a><span class="lineno"> 6868</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l06869"></a><span class="lineno"> 6869</span>&#160;   <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EINVAL;</div><div class="line"><a name="l06870"></a><span class="lineno"> 6870</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06871"></a><span class="lineno"> 6871</span>&#160;}</div><div class="line"><a name="l06872"></a><span class="lineno"> 6872</span>&#160;</div><div class="line"><a name="l06873"></a><span class="lineno"> 6873</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l06874"></a><span class="lineno"> 6874</span>&#160;<span class="comment"> * EBUSY - can&#39;t lock</span></div><div class="line"><a name="l06875"></a><span class="lineno"> 6875</span>&#160;<span class="comment"> * ENOENT - there is no existence of context</span></div><div class="line"><a name="l06876"></a><span class="lineno"> 6876</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l06877"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a323f8eb5d2722c6fff9467eff52ae4b5"> 6877</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a323f8eb5d2722c6fff9467eff52ae4b5">ast_context_add_ignorepat</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06878"></a><span class="lineno"> 6878</span>&#160;{</div><div class="line"><a name="l06879"></a><span class="lineno"> 6879</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l06880"></a><span class="lineno"> 6880</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l06881"></a><span class="lineno"> 6881</span>&#160;</div><div class="line"><a name="l06882"></a><span class="lineno"> 6882</span>&#160;   c = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(context);</div><div class="line"><a name="l06883"></a><span class="lineno"> 6883</span>&#160;   <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l06884"></a><span class="lineno"> 6884</span>&#160;      ret = <a class="code" href="../../db/d94/pbx_8c.html#a665b695dd4aabc37e95f1971e84f700d">ast_context_add_ignorepat2</a>(c, value, registrar);</div><div class="line"><a name="l06885"></a><span class="lineno"> 6885</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06886"></a><span class="lineno"> 6886</span>&#160;   }</div><div class="line"><a name="l06887"></a><span class="lineno"> 6887</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l06888"></a><span class="lineno"> 6888</span>&#160;}</div><div class="line"><a name="l06889"></a><span class="lineno"> 6889</span>&#160;</div><div class="line"><a name="l06890"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a665b695dd4aabc37e95f1971e84f700d"> 6890</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a665b695dd4aabc37e95f1971e84f700d">ast_context_add_ignorepat2</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06891"></a><span class="lineno"> 6891</span>&#160;{</div><div class="line"><a name="l06892"></a><span class="lineno"> 6892</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *ignorepat = <a class="code" href="../../d9/d63/pbx__ignorepat_8c.html#a44fe4216a998a19409ee4c755698ff8c">ignorepat_alloc</a>(value, registrar);</div><div class="line"><a name="l06893"></a><span class="lineno"> 6893</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l06894"></a><span class="lineno"> 6894</span>&#160;</div><div class="line"><a name="l06895"></a><span class="lineno"> 6895</span>&#160;   <span class="keywordflow">if</span> (!ignorepat) {</div><div class="line"><a name="l06896"></a><span class="lineno"> 6896</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06897"></a><span class="lineno"> 6897</span>&#160;   }</div><div class="line"><a name="l06898"></a><span class="lineno"> 6898</span>&#160;</div><div class="line"><a name="l06899"></a><span class="lineno"> 6899</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a>(con);</div><div class="line"><a name="l06900"></a><span class="lineno"> 6900</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a>(con); idx++) {</div><div class="line"><a name="l06901"></a><span class="lineno"> 6901</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *i = <a class="code" href="../../db/d94/pbx_8c.html#a6fee17b9633bb84f0fce209d5d42fb0a">ast_context_ignorepats_get</a>(con, idx);</div><div class="line"><a name="l06902"></a><span class="lineno"> 6902</span>&#160;</div><div class="line"><a name="l06903"></a><span class="lineno"> 6903</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="../../db/de0/pbx_8h.html#ad40e50eea098e5c16ef7dd3ffbff1bba">ast_get_ignorepat_name</a>(i), value)) {</div><div class="line"><a name="l06904"></a><span class="lineno"> 6904</span>&#160;         <span class="comment">/* Already there */</span></div><div class="line"><a name="l06905"></a><span class="lineno"> 6905</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l06906"></a><span class="lineno"> 6906</span>&#160;         <a class="code" href="../../d9/d63/pbx__ignorepat_8c.html#ab3503fb9ba3b0c046a2d1a2a482e8ae1">ignorepat_free</a>(ignorepat);</div><div class="line"><a name="l06907"></a><span class="lineno"> 6907</span>&#160;         <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EEXIST;</div><div class="line"><a name="l06908"></a><span class="lineno"> 6908</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06909"></a><span class="lineno"> 6909</span>&#160;      }</div><div class="line"><a name="l06910"></a><span class="lineno"> 6910</span>&#160;   }</div><div class="line"><a name="l06911"></a><span class="lineno"> 6911</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">ignorepats</a>, ignorepat)) {</div><div class="line"><a name="l06912"></a><span class="lineno"> 6912</span>&#160;      <a class="code" href="../../d9/d63/pbx__ignorepat_8c.html#ab3503fb9ba3b0c046a2d1a2a482e8ae1">ignorepat_free</a>(ignorepat);</div><div class="line"><a name="l06913"></a><span class="lineno"> 6913</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l06914"></a><span class="lineno"> 6914</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06915"></a><span class="lineno"> 6915</span>&#160;   }</div><div class="line"><a name="l06916"></a><span class="lineno"> 6916</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l06917"></a><span class="lineno"> 6917</span>&#160;</div><div class="line"><a name="l06918"></a><span class="lineno"> 6918</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l06919"></a><span class="lineno"> 6919</span>&#160;}</div><div class="line"><a name="l06920"></a><span class="lineno"> 6920</span>&#160;</div><div class="line"><a name="l06921"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa73d176ed4f1ce51e5db6beafba45fe3"> 6921</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aa73d176ed4f1ce51e5db6beafba45fe3">ast_ignore_pattern</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d11/structast__ignorepat.html#a330f40c3d5af3c94035e90e4cf4599c0">pattern</a>)</div><div class="line"><a name="l06922"></a><span class="lineno"> 6922</span>&#160;{</div><div class="line"><a name="l06923"></a><span class="lineno"> 6923</span>&#160;   <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l06924"></a><span class="lineno"> 6924</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con;</div><div class="line"><a name="l06925"></a><span class="lineno"> 6925</span>&#160;</div><div class="line"><a name="l06926"></a><span class="lineno"> 6926</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>();</div><div class="line"><a name="l06927"></a><span class="lineno"> 6927</span>&#160;   con = <a class="code" href="../../db/d94/pbx_8c.html#a2af2d2771e5347b18454a05dbc98e35f">ast_context_find</a>(context);</div><div class="line"><a name="l06928"></a><span class="lineno"> 6928</span>&#160;   <span class="keywordflow">if</span> (con) {</div><div class="line"><a name="l06929"></a><span class="lineno"> 6929</span>&#160;      <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l06930"></a><span class="lineno"> 6930</span>&#160;</div><div class="line"><a name="l06931"></a><span class="lineno"> 6931</span>&#160;      <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a>(con); idx++) {</div><div class="line"><a name="l06932"></a><span class="lineno"> 6932</span>&#160;         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *pat = <a class="code" href="../../db/d94/pbx_8c.html#a6fee17b9633bb84f0fce209d5d42fb0a">ast_context_ignorepats_get</a>(con, idx);</div><div class="line"><a name="l06933"></a><span class="lineno"> 6933</span>&#160;</div><div class="line"><a name="l06934"></a><span class="lineno"> 6934</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a594f1f57f847b59c1d8aeef4b0e3a337">ast_extension_match</a>(<a class="code" href="../../db/de0/pbx_8h.html#ad40e50eea098e5c16ef7dd3ffbff1bba">ast_get_ignorepat_name</a>(pat), pattern)) {</div><div class="line"><a name="l06935"></a><span class="lineno"> 6935</span>&#160;            ret = 1;</div><div class="line"><a name="l06936"></a><span class="lineno"> 6936</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l06937"></a><span class="lineno"> 6937</span>&#160;         }</div><div class="line"><a name="l06938"></a><span class="lineno"> 6938</span>&#160;      }</div><div class="line"><a name="l06939"></a><span class="lineno"> 6939</span>&#160;   }</div><div class="line"><a name="l06940"></a><span class="lineno"> 6940</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06941"></a><span class="lineno"> 6941</span>&#160;</div><div class="line"><a name="l06942"></a><span class="lineno"> 6942</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l06943"></a><span class="lineno"> 6943</span>&#160;}</div><div class="line"><a name="l06944"></a><span class="lineno"> 6944</span>&#160;</div><div class="line"><a name="l06945"></a><span class="lineno"> 6945</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l06946"></a><span class="lineno"> 6946</span>&#160;<span class="comment"> * ast_add_extension_nolock -- use only in situations where the conlock is already held</span></div><div class="line"><a name="l06947"></a><span class="lineno"> 6947</span>&#160;<span class="comment"> * ENOENT  - no existence of context</span></div><div class="line"><a name="l06948"></a><span class="lineno"> 6948</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l06949"></a><span class="lineno"> 6949</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l06950"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a62350bf22ada5eec5dcb16986c1909b9"> 6950</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a62350bf22ada5eec5dcb16986c1909b9">ast_add_extension_nolock</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keywordtype">int</span> replace, <span class="keyword">const</span> <span class="keywordtype">char</span> *extension,</div><div class="line"><a name="l06951"></a><span class="lineno"> 6951</span>&#160;   <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid,</div><div class="line"><a name="l06952"></a><span class="lineno"> 6952</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *application, <span class="keywordtype">void</span> *data, <span class="keywordtype">void</span> (*<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>)(<span class="keywordtype">void</span> *), <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06953"></a><span class="lineno"> 6953</span>&#160;{</div><div class="line"><a name="l06954"></a><span class="lineno"> 6954</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l06955"></a><span class="lineno"> 6955</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l06956"></a><span class="lineno"> 6956</span>&#160;</div><div class="line"><a name="l06957"></a><span class="lineno"> 6957</span>&#160;   c = <a class="code" href="../../db/d94/pbx_8c.html#ae295e363d292aafe65f327e628d90dcd">find_context</a>(context);</div><div class="line"><a name="l06958"></a><span class="lineno"> 6958</span>&#160;   <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l06959"></a><span class="lineno"> 6959</span>&#160;      ret = <a class="code" href="../../db/d94/pbx_8c.html#a26a33f5a203f8d30edc12bea10cd3f72">ast_add_extension2_lockopt</a>(c, replace, extension, priority, label, callerid,</div><div class="line"><a name="l06960"></a><span class="lineno"> 6960</span>&#160;         application, data, <a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>, registrar, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 1);</div><div class="line"><a name="l06961"></a><span class="lineno"> 6961</span>&#160;   }</div><div class="line"><a name="l06962"></a><span class="lineno"> 6962</span>&#160;</div><div class="line"><a name="l06963"></a><span class="lineno"> 6963</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l06964"></a><span class="lineno"> 6964</span>&#160;}</div><div class="line"><a name="l06965"></a><span class="lineno"> 6965</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l06966"></a><span class="lineno"> 6966</span>&#160;<span class="comment"> * EBUSY   - can&#39;t lock</span></div><div class="line"><a name="l06967"></a><span class="lineno"> 6967</span>&#160;<span class="comment"> * ENOENT  - no existence of context</span></div><div class="line"><a name="l06968"></a><span class="lineno"> 6968</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l06969"></a><span class="lineno"> 6969</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l06970"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a07176e8d314eb68b3b50279fafa11390"> 6970</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a07176e8d314eb68b3b50279fafa11390">ast_add_extension</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keywordtype">int</span> replace, <span class="keyword">const</span> <span class="keywordtype">char</span> *extension,</div><div class="line"><a name="l06971"></a><span class="lineno"> 6971</span>&#160;   <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid,</div><div class="line"><a name="l06972"></a><span class="lineno"> 6972</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *application, <span class="keywordtype">void</span> *data, <span class="keywordtype">void</span> (*<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>)(<span class="keywordtype">void</span> *), <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l06973"></a><span class="lineno"> 6973</span>&#160;{</div><div class="line"><a name="l06974"></a><span class="lineno"> 6974</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l06975"></a><span class="lineno"> 6975</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l06976"></a><span class="lineno"> 6976</span>&#160;</div><div class="line"><a name="l06977"></a><span class="lineno"> 6977</span>&#160;   c = <a class="code" href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a>(context);</div><div class="line"><a name="l06978"></a><span class="lineno"> 6978</span>&#160;   <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l06979"></a><span class="lineno"> 6979</span>&#160;      ret = <a class="code" href="../../db/d94/pbx_8c.html#a3be3741c204cd685110243af9daec104">ast_add_extension2</a>(c, replace, extension, priority, label, callerid,</div><div class="line"><a name="l06980"></a><span class="lineno"> 6980</span>&#160;         application, data, <a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>, registrar, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l06981"></a><span class="lineno"> 6981</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l06982"></a><span class="lineno"> 6982</span>&#160;   }</div><div class="line"><a name="l06983"></a><span class="lineno"> 6983</span>&#160;</div><div class="line"><a name="l06984"></a><span class="lineno"> 6984</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l06985"></a><span class="lineno"> 6985</span>&#160;}</div><div class="line"><a name="l06986"></a><span class="lineno"> 6986</span>&#160;</div><div class="line"><a name="l06987"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a9f840db4b5ef461ac2c0c975a57c9e89"> 6987</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a9f840db4b5ef461ac2c0c975a57c9e89">ast_explicit_goto</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority)</div><div class="line"><a name="l06988"></a><span class="lineno"> 6988</span>&#160;{</div><div class="line"><a name="l06989"></a><span class="lineno"> 6989</span>&#160;   <span class="keywordflow">if</span> (!chan)</div><div class="line"><a name="l06990"></a><span class="lineno"> 6990</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l06991"></a><span class="lineno"> 6991</span>&#160;</div><div class="line"><a name="l06992"></a><span class="lineno"> 6992</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l06993"></a><span class="lineno"> 6993</span>&#160;</div><div class="line"><a name="l06994"></a><span class="lineno"> 6994</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(context))</div><div class="line"><a name="l06995"></a><span class="lineno"> 6995</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a>(chan, context);</div><div class="line"><a name="l06996"></a><span class="lineno"> 6996</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(exten))</div><div class="line"><a name="l06997"></a><span class="lineno"> 6997</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a>(chan, exten);</div><div class="line"><a name="l06998"></a><span class="lineno"> 6998</span>&#160;   <span class="keywordflow">if</span> (priority &gt; -1) {</div><div class="line"><a name="l06999"></a><span class="lineno"> 6999</span>&#160;      <span class="comment">/* see flag description in channel.h for explanation */</span></div><div class="line"><a name="l07000"></a><span class="lineno"> 7000</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>)) {</div><div class="line"><a name="l07001"></a><span class="lineno"> 7001</span>&#160;         --<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;</div><div class="line"><a name="l07002"></a><span class="lineno"> 7002</span>&#160;      }</div><div class="line"><a name="l07003"></a><span class="lineno"> 7003</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a>(chan, priority);</div><div class="line"><a name="l07004"></a><span class="lineno"> 7004</span>&#160;   }</div><div class="line"><a name="l07005"></a><span class="lineno"> 7005</span>&#160;</div><div class="line"><a name="l07006"></a><span class="lineno"> 7006</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l07007"></a><span class="lineno"> 7007</span>&#160;</div><div class="line"><a name="l07008"></a><span class="lineno"> 7008</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l07009"></a><span class="lineno"> 7009</span>&#160;}</div><div class="line"><a name="l07010"></a><span class="lineno"> 7010</span>&#160;</div><div class="line"><a name="l07011"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae0ba2eb966a9e3376de61d30513f7302"> 7011</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae0ba2eb966a9e3376de61d30513f7302">ast_async_goto</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority)</div><div class="line"><a name="l07012"></a><span class="lineno"> 7012</span>&#160;{</div><div class="line"><a name="l07013"></a><span class="lineno"> 7013</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *newchan;</div><div class="line"><a name="l07014"></a><span class="lineno"> 7014</span>&#160;</div><div class="line"><a name="l07015"></a><span class="lineno"> 7015</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l07016"></a><span class="lineno"> 7016</span>&#160;   <span class="comment">/* Channels in a bridge or running a PBX can be sent directly to the specified destination */</span></div><div class="line"><a name="l07017"></a><span class="lineno"> 7017</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#aa0a52e573af67cb0f29095177128d186">ast_channel_is_bridged</a>(chan) || <a class="code" href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a>(chan)) {</div><div class="line"><a name="l07018"></a><span class="lineno"> 7018</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>)) {</div><div class="line"><a name="l07019"></a><span class="lineno"> 7019</span>&#160;         priority += 1;</div><div class="line"><a name="l07020"></a><span class="lineno"> 7020</span>&#160;      }</div><div class="line"><a name="l07021"></a><span class="lineno"> 7021</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a9f840db4b5ef461ac2c0c975a57c9e89">ast_explicit_goto</a>(chan, context, exten, priority);</div><div class="line"><a name="l07022"></a><span class="lineno"> 7022</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ae90da1877e143b996d202d4c88a9c862">ast_softhangup_nolock</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a085c0c603de12dc2474a17a92e1cb5a4">AST_SOFTHANGUP_ASYNCGOTO</a>);</div><div class="line"><a name="l07023"></a><span class="lineno"> 7023</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l07024"></a><span class="lineno"> 7024</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l07025"></a><span class="lineno"> 7025</span>&#160;   }</div><div class="line"><a name="l07026"></a><span class="lineno"> 7026</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l07027"></a><span class="lineno"> 7027</span>&#160;</div><div class="line"><a name="l07028"></a><span class="lineno"> 7028</span>&#160;   <span class="comment">/* Otherwise, we need to gain control of the channel first */</span></div><div class="line"><a name="l07029"></a><span class="lineno"> 7029</span>&#160;   newchan = <a class="code" href="../../d5/d7b/channel_8h.html#a17e5eed14e9256176bb685dc7bac620a">ast_channel_yank</a>(chan);</div><div class="line"><a name="l07030"></a><span class="lineno"> 7030</span>&#160;   <span class="keywordflow">if</span> (!newchan) {</div><div class="line"><a name="l07031"></a><span class="lineno"> 7031</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to gain control of channel %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l07032"></a><span class="lineno"> 7032</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07033"></a><span class="lineno"> 7033</span>&#160;   }</div><div class="line"><a name="l07034"></a><span class="lineno"> 7034</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a9f840db4b5ef461ac2c0c975a57c9e89">ast_explicit_goto</a>(newchan, context, exten, priority);</div><div class="line"><a name="l07035"></a><span class="lineno"> 7035</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a9a937fbb3b5f4e68880a9c5714a29ce5">ast_pbx_start</a>(newchan)) {</div><div class="line"><a name="l07036"></a><span class="lineno"> 7036</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(newchan);</div><div class="line"><a name="l07037"></a><span class="lineno"> 7037</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start PBX on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(newchan));</div><div class="line"><a name="l07038"></a><span class="lineno"> 7038</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07039"></a><span class="lineno"> 7039</span>&#160;   }</div><div class="line"><a name="l07040"></a><span class="lineno"> 7040</span>&#160;</div><div class="line"><a name="l07041"></a><span class="lineno"> 7041</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l07042"></a><span class="lineno"> 7042</span>&#160;}</div><div class="line"><a name="l07043"></a><span class="lineno"> 7043</span>&#160;</div><div class="line"><a name="l07044"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aef0dcef11ca2f5e3a4093598724ff086"> 7044</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aef0dcef11ca2f5e3a4093598724ff086">ast_async_goto_by_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *channame, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority)</div><div class="line"><a name="l07045"></a><span class="lineno"> 7045</span>&#160;{</div><div class="line"><a name="l07046"></a><span class="lineno"> 7046</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan;</div><div class="line"><a name="l07047"></a><span class="lineno"> 7047</span>&#160;   <span class="keywordtype">int</span> res = -1;</div><div class="line"><a name="l07048"></a><span class="lineno"> 7048</span>&#160;</div><div class="line"><a name="l07049"></a><span class="lineno"> 7049</span>&#160;   <span class="keywordflow">if</span> ((chan = <a class="code" href="../../d5/d7b/channel_8h.html#ac7e42045272530c8678418993e75fd56">ast_channel_get_by_name</a>(channame))) {</div><div class="line"><a name="l07050"></a><span class="lineno"> 7050</span>&#160;      res = <a class="code" href="../../db/d94/pbx_8c.html#ae0ba2eb966a9e3376de61d30513f7302">ast_async_goto</a>(chan, context, exten, priority);</div><div class="line"><a name="l07051"></a><span class="lineno"> 7051</span>&#160;      chan = <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(chan);</div><div class="line"><a name="l07052"></a><span class="lineno"> 7052</span>&#160;   }</div><div class="line"><a name="l07053"></a><span class="lineno"> 7053</span>&#160;</div><div class="line"><a name="l07054"></a><span class="lineno"> 7054</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l07055"></a><span class="lineno"> 7055</span>&#160;}</div><div class="line"><a name="l07056"></a><span class="lineno"> 7056</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07057"></a><span class="lineno"> 7057</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l07058"></a><span class="lineno"> 7058</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l07059"></a><span class="lineno"> 7059</span>&#160;<span class="comment"> * \brief Copy a string skipping whitespace and optionally dashes.</span></div><div class="line"><a name="l07060"></a><span class="lineno"> 7060</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07061"></a><span class="lineno"> 7061</span>&#160;<span class="comment"> * \param dst Destination buffer to copy src string.</span></div><div class="line"><a name="l07062"></a><span class="lineno"> 7062</span>&#160;<span class="comment"> * \param src Null terminated string to copy.</span></div><div class="line"><a name="l07063"></a><span class="lineno"> 7063</span>&#160;<span class="comment"> * \param dst_size Number of bytes in the dst buffer.</span></div><div class="line"><a name="l07064"></a><span class="lineno"> 7064</span>&#160;<span class="comment"> * \param nofluf Nonzero if &#39;-&#39; chars are not copied.</span></div><div class="line"><a name="l07065"></a><span class="lineno"> 7065</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07066"></a><span class="lineno"> 7066</span>&#160;<span class="comment"> * \return Number of bytes written to dst including null terminator.</span></div><div class="line"><a name="l07067"></a><span class="lineno"> 7067</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l07068"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a517e4a9ba0d6233eba58ad0f1307f55c"> 7068</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a517e4a9ba0d6233eba58ad0f1307f55c">ext_strncpy</a>(<span class="keywordtype">char</span> *dst, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">size_t</span> dst_size, <span class="keywordtype">int</span> nofluff)</div><div class="line"><a name="l07069"></a><span class="lineno"> 7069</span>&#160;{</div><div class="line"><a name="l07070"></a><span class="lineno"> 7070</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count;</div><div class="line"><a name="l07071"></a><span class="lineno"> 7071</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> insquares;</div><div class="line"><a name="l07072"></a><span class="lineno"> 7072</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> is_pattern;</div><div class="line"><a name="l07073"></a><span class="lineno"> 7073</span>&#160;</div><div class="line"><a name="l07074"></a><span class="lineno"> 7074</span>&#160;   <span class="keywordflow">if</span> (!dst_size--) {</div><div class="line"><a name="l07075"></a><span class="lineno"> 7075</span>&#160;      <span class="comment">/* There really is no dst buffer */</span></div><div class="line"><a name="l07076"></a><span class="lineno"> 7076</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l07077"></a><span class="lineno"> 7077</span>&#160;   }</div><div class="line"><a name="l07078"></a><span class="lineno"> 7078</span>&#160;</div><div class="line"><a name="l07079"></a><span class="lineno"> 7079</span>&#160;   count = 0;</div><div class="line"><a name="l07080"></a><span class="lineno"> 7080</span>&#160;   insquares = 0;</div><div class="line"><a name="l07081"></a><span class="lineno"> 7081</span>&#160;   is_pattern = *src == <span class="charliteral">&#39;_&#39;</span>;</div><div class="line"><a name="l07082"></a><span class="lineno"> 7082</span>&#160;   <span class="keywordflow">while</span> (*src &amp;&amp; count &lt; dst_size) {</div><div class="line"><a name="l07083"></a><span class="lineno"> 7083</span>&#160;      <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;[&#39;</span>) {</div><div class="line"><a name="l07084"></a><span class="lineno"> 7084</span>&#160;         <span class="keywordflow">if</span> (is_pattern) {</div><div class="line"><a name="l07085"></a><span class="lineno"> 7085</span>&#160;            insquares = 1;</div><div class="line"><a name="l07086"></a><span class="lineno"> 7086</span>&#160;         }</div><div class="line"><a name="l07087"></a><span class="lineno"> 7087</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;]&#39;</span>) {</div><div class="line"><a name="l07088"></a><span class="lineno"> 7088</span>&#160;         insquares = 0;</div><div class="line"><a name="l07089"></a><span class="lineno"> 7089</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39; &#39;</span> &amp;&amp; !insquares) {</div><div class="line"><a name="l07090"></a><span class="lineno"> 7090</span>&#160;         ++src;</div><div class="line"><a name="l07091"></a><span class="lineno"> 7091</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l07092"></a><span class="lineno"> 7092</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;-&#39;</span> &amp;&amp; !insquares &amp;&amp; nofluff) {</div><div class="line"><a name="l07093"></a><span class="lineno"> 7093</span>&#160;         ++src;</div><div class="line"><a name="l07094"></a><span class="lineno"> 7094</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l07095"></a><span class="lineno"> 7095</span>&#160;      }</div><div class="line"><a name="l07096"></a><span class="lineno"> 7096</span>&#160;      *dst++ = *src++;</div><div class="line"><a name="l07097"></a><span class="lineno"> 7097</span>&#160;      ++count;</div><div class="line"><a name="l07098"></a><span class="lineno"> 7098</span>&#160;   }</div><div class="line"><a name="l07099"></a><span class="lineno"> 7099</span>&#160;   *dst = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l07100"></a><span class="lineno"> 7100</span>&#160;</div><div class="line"><a name="l07101"></a><span class="lineno"> 7101</span>&#160;   <span class="keywordflow">return</span> count + 1;</div><div class="line"><a name="l07102"></a><span class="lineno"> 7102</span>&#160;}</div><div class="line"><a name="l07103"></a><span class="lineno"> 7103</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07104"></a><span class="lineno"> 7104</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l07105"></a><span class="lineno"> 7105</span>&#160;<span class="comment"> * \brief add the extension in the priority chain.</span></div><div class="line"><a name="l07106"></a><span class="lineno"> 7106</span>&#160;<span class="comment"> * \retval 0 on success.</span></div><div class="line"><a name="l07107"></a><span class="lineno"> 7107</span>&#160;<span class="comment"> * \retval -1 on failure.</span></div><div class="line"><a name="l07108"></a><span class="lineno"> 7108</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l07109"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a320968fd3a6b905a3cff12198bfa24f1"> 7109</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a320968fd3a6b905a3cff12198bfa24f1">add_priority</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>,</div><div class="line"><a name="l07110"></a><span class="lineno"> 7110</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d5/d03/asterisk_8c.html#a617d1486ee651b4c894d02e1fe68fe04">el</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e, <span class="keywordtype">int</span> replace)</div><div class="line"><a name="l07111"></a><span class="lineno"> 7111</span>&#160;{</div><div class="line"><a name="l07112"></a><span class="lineno"> 7112</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *ep;</div><div class="line"><a name="l07113"></a><span class="lineno"> 7113</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *eh=e;</div><div class="line"><a name="l07114"></a><span class="lineno"> 7114</span>&#160;   <span class="keywordtype">int</span> repeated_label = 0; <span class="comment">/* Track if this label is a repeat, assume no. */</span></div><div class="line"><a name="l07115"></a><span class="lineno"> 7115</span>&#160;</div><div class="line"><a name="l07116"></a><span class="lineno"> 7116</span>&#160;   <span class="keywordflow">for</span> (ep = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; e ; ep = e, e = e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>) {</div><div class="line"><a name="l07117"></a><span class="lineno"> 7117</span>&#160;      <span class="keywordflow">if</span> (e-&gt;label &amp;&amp; tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a> &amp;&amp; e-&gt;priority != tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> &amp;&amp; !strcmp(e-&gt;label, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>)) {</div><div class="line"><a name="l07118"></a><span class="lineno"> 7118</span>&#160;         <span class="keywordflow">if</span> (strcmp(e-&gt;name, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>)) {</div><div class="line"><a name="l07119"></a><span class="lineno"> 7119</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l07120"></a><span class="lineno"> 7120</span>&#160;               <span class="stringliteral">&quot;Extension &#39;%s&#39; priority %d in &#39;%s&#39;, label &#39;%s&#39; already in use at aliased extension &#39;%s&#39; priority %d\n&quot;</span>,</div><div class="line"><a name="l07121"></a><span class="lineno"> 7121</span>&#160;               tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>, e-&gt;name, e-&gt;priority);</div><div class="line"><a name="l07122"></a><span class="lineno"> 7122</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07123"></a><span class="lineno"> 7123</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l07124"></a><span class="lineno"> 7124</span>&#160;               <span class="stringliteral">&quot;Extension &#39;%s&#39; priority %d in &#39;%s&#39;, label &#39;%s&#39; already in use at priority %d\n&quot;</span>,</div><div class="line"><a name="l07125"></a><span class="lineno"> 7125</span>&#160;               tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>, e-&gt;priority);</div><div class="line"><a name="l07126"></a><span class="lineno"> 7126</span>&#160;         }</div><div class="line"><a name="l07127"></a><span class="lineno"> 7127</span>&#160;         repeated_label = 1;</div><div class="line"><a name="l07128"></a><span class="lineno"> 7128</span>&#160;      }</div><div class="line"><a name="l07129"></a><span class="lineno"> 7129</span>&#160;      <span class="keywordflow">if</span> (e-&gt;priority &gt;= tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>) {</div><div class="line"><a name="l07130"></a><span class="lineno"> 7130</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l07131"></a><span class="lineno"> 7131</span>&#160;      }</div><div class="line"><a name="l07132"></a><span class="lineno"> 7132</span>&#160;   }</div><div class="line"><a name="l07133"></a><span class="lineno"> 7133</span>&#160;</div><div class="line"><a name="l07134"></a><span class="lineno"> 7134</span>&#160;   <span class="keywordflow">if</span> (repeated_label) {   <span class="comment">/* Discard the label since it&#39;s a repeat. */</span></div><div class="line"><a name="l07135"></a><span class="lineno"> 7135</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07136"></a><span class="lineno"> 7136</span>&#160;   }</div><div class="line"><a name="l07137"></a><span class="lineno"> 7137</span>&#160;</div><div class="line"><a name="l07138"></a><span class="lineno"> 7138</span>&#160;   <span class="keywordflow">if</span> (!e) {   <span class="comment">/* go at the end, and ep is surely set because the list is not empty */</span></div><div class="line"><a name="l07139"></a><span class="lineno"> 7139</span>&#160;      <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(eh-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, tmp);</div><div class="line"><a name="l07140"></a><span class="lineno"> 7140</span>&#160;</div><div class="line"><a name="l07141"></a><span class="lineno"> 7141</span>&#160;      <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>) {</div><div class="line"><a name="l07142"></a><span class="lineno"> 7142</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(eh-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>, tmp);</div><div class="line"><a name="l07143"></a><span class="lineno"> 7143</span>&#160;      }</div><div class="line"><a name="l07144"></a><span class="lineno"> 7144</span>&#160;      ep-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l07145"></a><span class="lineno"> 7145</span>&#160;      <span class="keywordflow">return</span> 0;   <span class="comment">/* success */</span></div><div class="line"><a name="l07146"></a><span class="lineno"> 7146</span>&#160;   }</div><div class="line"><a name="l07147"></a><span class="lineno"> 7147</span>&#160;   <span class="keywordflow">if</span> (e-&gt;priority == tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>) {</div><div class="line"><a name="l07148"></a><span class="lineno"> 7148</span>&#160;      <span class="comment">/* Can&#39;t have something exactly the same.  Is this a</span></div><div class="line"><a name="l07149"></a><span class="lineno"> 7149</span>&#160;<span class="comment">         replacement?  If so, replace, otherwise, bonk. */</span></div><div class="line"><a name="l07150"></a><span class="lineno"> 7150</span>&#160;      <span class="keywordflow">if</span> (!replace) {</div><div class="line"><a name="l07151"></a><span class="lineno"> 7151</span>&#160;         <span class="keywordflow">if</span> (strcmp(e-&gt;name, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>)) {</div><div class="line"><a name="l07152"></a><span class="lineno"> 7152</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l07153"></a><span class="lineno"> 7153</span>&#160;               <span class="stringliteral">&quot;Unable to register extension &#39;%s&#39; priority %d in &#39;%s&#39;, already in use by aliased extension &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l07154"></a><span class="lineno"> 7154</span>&#160;               tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, e-&gt;name);</div><div class="line"><a name="l07155"></a><span class="lineno"> 7155</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07156"></a><span class="lineno"> 7156</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l07157"></a><span class="lineno"> 7157</span>&#160;               <span class="stringliteral">&quot;Unable to register extension &#39;%s&#39; priority %d in &#39;%s&#39;, already in use\n&quot;</span>,</div><div class="line"><a name="l07158"></a><span class="lineno"> 7158</span>&#160;               tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l07159"></a><span class="lineno"> 7159</span>&#160;         }</div><div class="line"><a name="l07160"></a><span class="lineno"> 7160</span>&#160;</div><div class="line"><a name="l07161"></a><span class="lineno"> 7161</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07162"></a><span class="lineno"> 7162</span>&#160;      }</div><div class="line"><a name="l07163"></a><span class="lineno"> 7163</span>&#160;      <span class="comment">/* we are replacing e, so copy the link fields and then update</span></div><div class="line"><a name="l07164"></a><span class="lineno"> 7164</span>&#160;<span class="comment">       * whoever pointed to e to point to us</span></div><div class="line"><a name="l07165"></a><span class="lineno"> 7165</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l07166"></a><span class="lineno"> 7166</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>; <span class="comment">/* not meaningful if we are not first in the peer list */</span></div><div class="line"><a name="l07167"></a><span class="lineno"> 7167</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> = e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>; <span class="comment">/* always meaningful */</span></div><div class="line"><a name="l07168"></a><span class="lineno"> 7168</span>&#160;      <span class="keywordflow">if</span> (ep)  {     <span class="comment">/* We&#39;re in the peer list, just insert ourselves */</span></div><div class="line"><a name="l07169"></a><span class="lineno"> 7169</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a313b62d20344c2c85461dd4ed893017c">ast_hashtab_remove_object_via_lookup</a>(eh-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>,e);</div><div class="line"><a name="l07170"></a><span class="lineno"> 7170</span>&#160;</div><div class="line"><a name="l07171"></a><span class="lineno"> 7171</span>&#160;         <span class="keywordflow">if</span> (e-&gt;label) {</div><div class="line"><a name="l07172"></a><span class="lineno"> 7172</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a313b62d20344c2c85461dd4ed893017c">ast_hashtab_remove_object_via_lookup</a>(eh-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>,e);</div><div class="line"><a name="l07173"></a><span class="lineno"> 7173</span>&#160;         }</div><div class="line"><a name="l07174"></a><span class="lineno"> 7174</span>&#160;</div><div class="line"><a name="l07175"></a><span class="lineno"> 7175</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(eh-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>,tmp);</div><div class="line"><a name="l07176"></a><span class="lineno"> 7176</span>&#160;         <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>) {</div><div class="line"><a name="l07177"></a><span class="lineno"> 7177</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(eh-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>,tmp);</div><div class="line"><a name="l07178"></a><span class="lineno"> 7178</span>&#160;         }</div><div class="line"><a name="l07179"></a><span class="lineno"> 7179</span>&#160;</div><div class="line"><a name="l07180"></a><span class="lineno"> 7180</span>&#160;         ep-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l07181"></a><span class="lineno"> 7181</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el) {     <span class="comment">/* We&#39;re the first extension. Take over e&#39;s functions */</span></div><div class="line"><a name="l07182"></a><span class="lineno"> 7182</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a> = <a class="code" href="../../db/d94/pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a>(con, e, 1);</div><div class="line"><a name="l07183"></a><span class="lineno"> 7183</span>&#160;         tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a> = e-&gt;peer_table;</div><div class="line"><a name="l07184"></a><span class="lineno"> 7184</span>&#160;         tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a> = e-&gt;peer_label_table;</div><div class="line"><a name="l07185"></a><span class="lineno"> 7185</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a313b62d20344c2c85461dd4ed893017c">ast_hashtab_remove_object_via_lookup</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>,e);</div><div class="line"><a name="l07186"></a><span class="lineno"> 7186</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>,tmp);</div><div class="line"><a name="l07187"></a><span class="lineno"> 7187</span>&#160;         <span class="keywordflow">if</span> (e-&gt;label) {</div><div class="line"><a name="l07188"></a><span class="lineno"> 7188</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a313b62d20344c2c85461dd4ed893017c">ast_hashtab_remove_object_via_lookup</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>, e);</div><div class="line"><a name="l07189"></a><span class="lineno"> 7189</span>&#160;         }</div><div class="line"><a name="l07190"></a><span class="lineno"> 7190</span>&#160;         <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>) {</div><div class="line"><a name="l07191"></a><span class="lineno"> 7191</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>, tmp);</div><div class="line"><a name="l07192"></a><span class="lineno"> 7192</span>&#160;         }</div><div class="line"><a name="l07193"></a><span class="lineno"> 7193</span>&#160;</div><div class="line"><a name="l07194"></a><span class="lineno"> 7194</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a313b62d20344c2c85461dd4ed893017c">ast_hashtab_remove_object_via_lookup</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, e);</div><div class="line"><a name="l07195"></a><span class="lineno"> 7195</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, tmp);</div><div class="line"><a name="l07196"></a><span class="lineno"> 7196</span>&#160;         el-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l07197"></a><span class="lineno"> 7197</span>&#160;         <span class="comment">/* The pattern trie points to this exten; replace the pointer,</span></div><div class="line"><a name="l07198"></a><span class="lineno"> 7198</span>&#160;<span class="comment">            and all will be well */</span></div><div class="line"><a name="l07199"></a><span class="lineno"> 7199</span>&#160;         <span class="keywordflow">if</span> (x) { <span class="comment">/* if the trie isn&#39;t formed yet, don&#39;t sweat this */</span></div><div class="line"><a name="l07200"></a><span class="lineno"> 7200</span>&#160;            <span class="keywordflow">if</span> (x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) { <span class="comment">/* this test for safety purposes */</span></div><div class="line"><a name="l07201"></a><span class="lineno"> 7201</span>&#160;               x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>; <span class="comment">/* replace what would become a bad pointer */</span></div><div class="line"><a name="l07202"></a><span class="lineno"> 7202</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07203"></a><span class="lineno"> 7203</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Trying to delete an exten from a context, but the pattern tree node returned isn&#39;t an extension\n&quot;</span>);</div><div class="line"><a name="l07204"></a><span class="lineno"> 7204</span>&#160;            }</div><div class="line"><a name="l07205"></a><span class="lineno"> 7205</span>&#160;         }</div><div class="line"><a name="l07206"></a><span class="lineno"> 7206</span>&#160;      } <span class="keywordflow">else</span> {       <span class="comment">/* We&#39;re the very first extension.  */</span></div><div class="line"><a name="l07207"></a><span class="lineno"> 7207</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a> = <a class="code" href="../../db/d94/pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a>(con, e, 1);</div><div class="line"><a name="l07208"></a><span class="lineno"> 7208</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a313b62d20344c2c85461dd4ed893017c">ast_hashtab_remove_object_via_lookup</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, e);</div><div class="line"><a name="l07209"></a><span class="lineno"> 7209</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, tmp);</div><div class="line"><a name="l07210"></a><span class="lineno"> 7210</span>&#160;         tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a> = e-&gt;peer_table;</div><div class="line"><a name="l07211"></a><span class="lineno"> 7211</span>&#160;         tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a> = e-&gt;peer_label_table;</div><div class="line"><a name="l07212"></a><span class="lineno"> 7212</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a313b62d20344c2c85461dd4ed893017c">ast_hashtab_remove_object_via_lookup</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, e);</div><div class="line"><a name="l07213"></a><span class="lineno"> 7213</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, tmp);</div><div class="line"><a name="l07214"></a><span class="lineno"> 7214</span>&#160;         <span class="keywordflow">if</span> (e-&gt;label) {</div><div class="line"><a name="l07215"></a><span class="lineno"> 7215</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a313b62d20344c2c85461dd4ed893017c">ast_hashtab_remove_object_via_lookup</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>, e);</div><div class="line"><a name="l07216"></a><span class="lineno"> 7216</span>&#160;         }</div><div class="line"><a name="l07217"></a><span class="lineno"> 7217</span>&#160;         <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>) {</div><div class="line"><a name="l07218"></a><span class="lineno"> 7218</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>, tmp);</div><div class="line"><a name="l07219"></a><span class="lineno"> 7219</span>&#160;         }</div><div class="line"><a name="l07220"></a><span class="lineno"> 7220</span>&#160;</div><div class="line"><a name="l07221"></a><span class="lineno"> 7221</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a313b62d20344c2c85461dd4ed893017c">ast_hashtab_remove_object_via_lookup</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, e);</div><div class="line"><a name="l07222"></a><span class="lineno"> 7222</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, tmp);</div><div class="line"><a name="l07223"></a><span class="lineno"> 7223</span>&#160;         con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a> = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l07224"></a><span class="lineno"> 7224</span>&#160;         <span class="comment">/* The pattern trie points to this exten; replace the pointer,</span></div><div class="line"><a name="l07225"></a><span class="lineno"> 7225</span>&#160;<span class="comment">            and all will be well */</span></div><div class="line"><a name="l07226"></a><span class="lineno"> 7226</span>&#160;         <span class="keywordflow">if</span> (x) { <span class="comment">/* if the trie isn&#39;t formed yet; no problem */</span></div><div class="line"><a name="l07227"></a><span class="lineno"> 7227</span>&#160;            <span class="keywordflow">if</span> (x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) { <span class="comment">/* this test for safety purposes */</span></div><div class="line"><a name="l07228"></a><span class="lineno"> 7228</span>&#160;               x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>; <span class="comment">/* replace what would become a bad pointer */</span></div><div class="line"><a name="l07229"></a><span class="lineno"> 7229</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07230"></a><span class="lineno"> 7230</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Trying to delete an exten from a context, but the pattern tree node returned isn&#39;t an extension\n&quot;</span>);</div><div class="line"><a name="l07231"></a><span class="lineno"> 7231</span>&#160;            }</div><div class="line"><a name="l07232"></a><span class="lineno"> 7232</span>&#160;         }</div><div class="line"><a name="l07233"></a><span class="lineno"> 7233</span>&#160;      }</div><div class="line"><a name="l07234"></a><span class="lineno"> 7234</span>&#160;      <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> == <a class="code" href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>)</div><div class="line"><a name="l07235"></a><span class="lineno"> 7235</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#adfb9d0de487a52af57ed7953508cee82">ast_change_hint</a>(e,tmp);</div><div class="line"><a name="l07236"></a><span class="lineno"> 7236</span>&#160;      <span class="comment">/* Destroy the old one */</span></div><div class="line"><a name="l07237"></a><span class="lineno"> 7237</span>&#160;      <span class="keywordflow">if</span> (e-&gt;datad)</div><div class="line"><a name="l07238"></a><span class="lineno"> 7238</span>&#160;         e-&gt;datad(e-&gt;data);</div><div class="line"><a name="l07239"></a><span class="lineno"> 7239</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(e);</div><div class="line"><a name="l07240"></a><span class="lineno"> 7240</span>&#160;   } <span class="keywordflow">else</span> { <span class="comment">/* Slip ourselves in just before e */</span></div><div class="line"><a name="l07241"></a><span class="lineno"> 7241</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> = e;</div><div class="line"><a name="l07242"></a><span class="lineno"> 7242</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>; <span class="comment">/* extension chain, or NULL if e is not the first extension */</span></div><div class="line"><a name="l07243"></a><span class="lineno"> 7243</span>&#160;      <span class="keywordflow">if</span> (ep) {         <span class="comment">/* Easy enough, we&#39;re just in the peer list */</span></div><div class="line"><a name="l07244"></a><span class="lineno"> 7244</span>&#160;         <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>) {</div><div class="line"><a name="l07245"></a><span class="lineno"> 7245</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(eh-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>, tmp);</div><div class="line"><a name="l07246"></a><span class="lineno"> 7246</span>&#160;         }</div><div class="line"><a name="l07247"></a><span class="lineno"> 7247</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(eh-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, tmp);</div><div class="line"><a name="l07248"></a><span class="lineno"> 7248</span>&#160;         ep-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l07249"></a><span class="lineno"> 7249</span>&#160;      } <span class="keywordflow">else</span> {       <span class="comment">/* we are the first in some peer list, so link in the ext list */</span></div><div class="line"><a name="l07250"></a><span class="lineno"> 7250</span>&#160;         tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a> = e-&gt;peer_table;</div><div class="line"><a name="l07251"></a><span class="lineno"> 7251</span>&#160;         tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a> = e-&gt;peer_label_table;</div><div class="line"><a name="l07252"></a><span class="lineno"> 7252</span>&#160;         e-&gt;peer_table = 0;</div><div class="line"><a name="l07253"></a><span class="lineno"> 7253</span>&#160;         e-&gt;peer_label_table = 0;</div><div class="line"><a name="l07254"></a><span class="lineno"> 7254</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, tmp);</div><div class="line"><a name="l07255"></a><span class="lineno"> 7255</span>&#160;         <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a>) {</div><div class="line"><a name="l07256"></a><span class="lineno"> 7256</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>, tmp);</div><div class="line"><a name="l07257"></a><span class="lineno"> 7257</span>&#160;         }</div><div class="line"><a name="l07258"></a><span class="lineno"> 7258</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a313b62d20344c2c85461dd4ed893017c">ast_hashtab_remove_object_via_lookup</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, e);</div><div class="line"><a name="l07259"></a><span class="lineno"> 7259</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, tmp);</div><div class="line"><a name="l07260"></a><span class="lineno"> 7260</span>&#160;         <span class="keywordflow">if</span> (el)</div><div class="line"><a name="l07261"></a><span class="lineno"> 7261</span>&#160;            el-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;   <span class="comment">/* in the middle... */</span></div><div class="line"><a name="l07262"></a><span class="lineno"> 7262</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l07263"></a><span class="lineno"> 7263</span>&#160;            con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a> = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>; <span class="comment">/* ... or at the head */</span></div><div class="line"><a name="l07264"></a><span class="lineno"> 7264</span>&#160;         e-&gt;next = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;   <span class="comment">/* e is no more at the head, so e-&gt;next must be reset */</span></div><div class="line"><a name="l07265"></a><span class="lineno"> 7265</span>&#160;      }</div><div class="line"><a name="l07266"></a><span class="lineno"> 7266</span>&#160;      <span class="comment">/* And immediately return success. */</span></div><div class="line"><a name="l07267"></a><span class="lineno"> 7267</span>&#160;      <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> == <a class="code" href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>) {</div><div class="line"><a name="l07268"></a><span class="lineno"> 7268</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae46143d88ad157ae0e848c7167891fa1">ast_add_hint</a>(tmp);</div><div class="line"><a name="l07269"></a><span class="lineno"> 7269</span>&#160;      }</div><div class="line"><a name="l07270"></a><span class="lineno"> 7270</span>&#160;   }</div><div class="line"><a name="l07271"></a><span class="lineno"> 7271</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l07272"></a><span class="lineno"> 7272</span>&#160;}</div><div class="line"><a name="l07273"></a><span class="lineno"> 7273</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07274"></a><span class="lineno"> 7274</span>&#160;<span class="comment">/*! \brief</span></div><div class="line"><a name="l07275"></a><span class="lineno"> 7275</span>&#160;<span class="comment"> * Main interface to add extensions to the list for out context.</span></div><div class="line"><a name="l07276"></a><span class="lineno"> 7276</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07277"></a><span class="lineno"> 7277</span>&#160;<span class="comment"> * We sort extensions in order of matching preference, so that we can</span></div><div class="line"><a name="l07278"></a><span class="lineno"> 7278</span>&#160;<span class="comment"> * stop the search as soon as we find a suitable match.</span></div><div class="line"><a name="l07279"></a><span class="lineno"> 7279</span>&#160;<span class="comment"> * This ordering also takes care of wildcards such as &#39;.&#39; (meaning</span></div><div class="line"><a name="l07280"></a><span class="lineno"> 7280</span>&#160;<span class="comment"> * &quot;one or more of any character&quot;) and &#39;!&#39; (which is &#39;earlymatch&#39;,</span></div><div class="line"><a name="l07281"></a><span class="lineno"> 7281</span>&#160;<span class="comment"> * meaning &quot;zero or more of any character&quot; but also impacts the</span></div><div class="line"><a name="l07282"></a><span class="lineno"> 7282</span>&#160;<span class="comment"> * return value from CANMATCH and EARLYMATCH.</span></div><div class="line"><a name="l07283"></a><span class="lineno"> 7283</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07284"></a><span class="lineno"> 7284</span>&#160;<span class="comment"> * The extension match rules defined in the devmeeting 2006.05.05 are</span></div><div class="line"><a name="l07285"></a><span class="lineno"> 7285</span>&#160;<span class="comment"> * quite simple: WE SELECT THE LONGEST MATCH.</span></div><div class="line"><a name="l07286"></a><span class="lineno"> 7286</span>&#160;<span class="comment"> * In detail, &quot;longest&quot; means the number of matched characters in</span></div><div class="line"><a name="l07287"></a><span class="lineno"> 7287</span>&#160;<span class="comment"> * the extension. In case of ties (e.g. _XXX and 333) in the length</span></div><div class="line"><a name="l07288"></a><span class="lineno"> 7288</span>&#160;<span class="comment"> * of a pattern, we give priority to entries with the smallest cardinality</span></div><div class="line"><a name="l07289"></a><span class="lineno"> 7289</span>&#160;<span class="comment"> * (e.g, [5-9] comes before [2-8] before the former has only 5 elements,</span></div><div class="line"><a name="l07290"></a><span class="lineno"> 7290</span>&#160;<span class="comment"> * while the latter has 7, etc.</span></div><div class="line"><a name="l07291"></a><span class="lineno"> 7291</span>&#160;<span class="comment"> * In case of same cardinality, the first element in the range counts.</span></div><div class="line"><a name="l07292"></a><span class="lineno"> 7292</span>&#160;<span class="comment"> * If we still have a tie, any final &#39;!&#39; will make this as a possibly</span></div><div class="line"><a name="l07293"></a><span class="lineno"> 7293</span>&#160;<span class="comment"> * less specific pattern.</span></div><div class="line"><a name="l07294"></a><span class="lineno"> 7294</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07295"></a><span class="lineno"> 7295</span>&#160;<span class="comment"> * EBUSY - can&#39;t lock</span></div><div class="line"><a name="l07296"></a><span class="lineno"> 7296</span>&#160;<span class="comment"> * EEXIST - extension with the same priority exist and no replace is set</span></div><div class="line"><a name="l07297"></a><span class="lineno"> 7297</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07298"></a><span class="lineno"> 7298</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l07299"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a3be3741c204cd685110243af9daec104"> 7299</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a3be3741c204cd685110243af9daec104">ast_add_extension2</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con,</div><div class="line"><a name="l07300"></a><span class="lineno"> 7300</span>&#160;   <span class="keywordtype">int</span> replace, <span class="keyword">const</span> <span class="keywordtype">char</span> *extension, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid,</div><div class="line"><a name="l07301"></a><span class="lineno"> 7301</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *application, <span class="keywordtype">void</span> *data, <span class="keywordtype">void</span> (*<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>)(<span class="keywordtype">void</span> *),</div><div class="line"><a name="l07302"></a><span class="lineno"> 7302</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a3e3ed71b5dcbadee8292f3d1837eaa38">registrar_file</a>, <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#a90ec1116822211c96e24055d95972cca">registrar_line</a>)</div><div class="line"><a name="l07303"></a><span class="lineno"> 7303</span>&#160;{</div><div class="line"><a name="l07304"></a><span class="lineno"> 7304</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a26a33f5a203f8d30edc12bea10cd3f72">ast_add_extension2_lockopt</a>(con, replace, extension, priority, label, callerid,</div><div class="line"><a name="l07305"></a><span class="lineno"> 7305</span>&#160;      application, data, <a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>, registrar, registrar_file, registrar_line, 1);</div><div class="line"><a name="l07306"></a><span class="lineno"> 7306</span>&#160;}</div><div class="line"><a name="l07307"></a><span class="lineno"> 7307</span>&#160;</div><div class="line"><a name="l07308"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ade1b9a3e676992cb13790cb068234f44"> 7308</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ade1b9a3e676992cb13790cb068234f44">ast_add_extension2_nolock</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con,</div><div class="line"><a name="l07309"></a><span class="lineno"> 7309</span>&#160;   <span class="keywordtype">int</span> replace, <span class="keyword">const</span> <span class="keywordtype">char</span> *extension, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid,</div><div class="line"><a name="l07310"></a><span class="lineno"> 7310</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *application, <span class="keywordtype">void</span> *data, <span class="keywordtype">void</span> (*<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>)(<span class="keywordtype">void</span> *),</div><div class="line"><a name="l07311"></a><span class="lineno"> 7311</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a3e3ed71b5dcbadee8292f3d1837eaa38">registrar_file</a>, <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#a90ec1116822211c96e24055d95972cca">registrar_line</a>)</div><div class="line"><a name="l07312"></a><span class="lineno"> 7312</span>&#160;{</div><div class="line"><a name="l07313"></a><span class="lineno"> 7313</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a26a33f5a203f8d30edc12bea10cd3f72">ast_add_extension2_lockopt</a>(con, replace, extension, priority, label, callerid,</div><div class="line"><a name="l07314"></a><span class="lineno"> 7314</span>&#160;      application, data, <a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>, registrar, registrar_file, registrar_line, 0);</div><div class="line"><a name="l07315"></a><span class="lineno"> 7315</span>&#160;}</div><div class="line"><a name="l07316"></a><span class="lineno"> 7316</span>&#160;</div><div class="line"><a name="l07317"></a><span class="lineno"> 7317</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07318"></a><span class="lineno"> 7318</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l07319"></a><span class="lineno"> 7319</span>&#160;<span class="comment"> * \brief Same as ast_add_extension2() but controls the context locking.</span></div><div class="line"><a name="l07320"></a><span class="lineno"> 7320</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07321"></a><span class="lineno"> 7321</span>&#160;<span class="comment"> * \details</span></div><div class="line"><a name="l07322"></a><span class="lineno"> 7322</span>&#160;<span class="comment"> * Does all the work of ast_add_extension2, but adds an arg to</span></div><div class="line"><a name="l07323"></a><span class="lineno"> 7323</span>&#160;<span class="comment"> * determine if context locking should be done.</span></div><div class="line"><a name="l07324"></a><span class="lineno"> 7324</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l07325"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a26a33f5a203f8d30edc12bea10cd3f72"> 7325</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a26a33f5a203f8d30edc12bea10cd3f72">ast_add_extension2_lockopt</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con,</div><div class="line"><a name="l07326"></a><span class="lineno"> 7326</span>&#160;   <span class="keywordtype">int</span> replace, <span class="keyword">const</span> <span class="keywordtype">char</span> *extension, <span class="keywordtype">int</span> priority, <span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid,</div><div class="line"><a name="l07327"></a><span class="lineno"> 7327</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *application, <span class="keywordtype">void</span> *data, <span class="keywordtype">void</span> (*<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>)(<span class="keywordtype">void</span> *),</div><div class="line"><a name="l07328"></a><span class="lineno"> 7328</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a3e3ed71b5dcbadee8292f3d1837eaa38">registrar_file</a>, <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#a90ec1116822211c96e24055d95972cca">registrar_line</a>, <span class="keywordtype">int</span> lock_context)</div><div class="line"><a name="l07329"></a><span class="lineno"> 7329</span>&#160;{</div><div class="line"><a name="l07330"></a><span class="lineno"> 7330</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l07331"></a><span class="lineno"> 7331</span>&#160;<span class="comment">    * Sort extensions (or patterns) according to the rules indicated above.</span></div><div class="line"><a name="l07332"></a><span class="lineno"> 7332</span>&#160;<span class="comment">    * These are implemented by the function ext_cmp()).</span></div><div class="line"><a name="l07333"></a><span class="lineno"> 7333</span>&#160;<span class="comment">    * All priorities for the same ext/pattern/cid are kept in a list,</span></div><div class="line"><a name="l07334"></a><span class="lineno"> 7334</span>&#160;<span class="comment">    * using the &#39;peer&#39; field  as a link field..</span></div><div class="line"><a name="l07335"></a><span class="lineno"> 7335</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l07336"></a><span class="lineno"> 7336</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>, *tmp2, *e, *<a class="code" href="../../d5/d03/asterisk_8c.html#a617d1486ee651b4c894d02e1fe68fe04">el</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07337"></a><span class="lineno"> 7337</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l07338"></a><span class="lineno"> 7338</span>&#160;   <span class="keywordtype">int</span> length;</div><div class="line"><a name="l07339"></a><span class="lineno"> 7339</span>&#160;   <span class="keywordtype">char</span> *p;</div><div class="line"><a name="l07340"></a><span class="lineno"> 7340</span>&#160;   <span class="keywordtype">char</span> expand_buf[<a class="code" href="../../d9/da0/pbx__private_8h.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>];</div><div class="line"><a name="l07341"></a><span class="lineno"> 7341</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> dummy_exten = {0};</div><div class="line"><a name="l07342"></a><span class="lineno"> 7342</span>&#160;   <span class="keywordtype">char</span> dummy_name[1024];</div><div class="line"><a name="l07343"></a><span class="lineno"> 7343</span>&#160;   <span class="keywordtype">int</span> exten_fluff;</div><div class="line"><a name="l07344"></a><span class="lineno"> 7344</span>&#160;   <span class="keywordtype">int</span> callerid_fluff;</div><div class="line"><a name="l07345"></a><span class="lineno"> 7345</span>&#160;</div><div class="line"><a name="l07346"></a><span class="lineno"> 7346</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(extension)) {</div><div class="line"><a name="l07347"></a><span class="lineno"> 7347</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;You have to be kidding-- add exten &#39;&#39; to context %s? Figure out a name and call me back. Action ignored.\n&quot;</span>,</div><div class="line"><a name="l07348"></a><span class="lineno"> 7348</span>&#160;            con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l07349"></a><span class="lineno"> 7349</span>&#160;      <span class="comment">/* We always need to deallocate &#39;data&#39; on failure */</span></div><div class="line"><a name="l07350"></a><span class="lineno"> 7350</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>) {</div><div class="line"><a name="l07351"></a><span class="lineno"> 7351</span>&#160;         <a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>(data);</div><div class="line"><a name="l07352"></a><span class="lineno"> 7352</span>&#160;      }</div><div class="line"><a name="l07353"></a><span class="lineno"> 7353</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07354"></a><span class="lineno"> 7354</span>&#160;   }</div><div class="line"><a name="l07355"></a><span class="lineno"> 7355</span>&#160;</div><div class="line"><a name="l07356"></a><span class="lineno"> 7356</span>&#160;   <span class="comment">/* If we are adding a hint evalulate in variables and global variables */</span></div><div class="line"><a name="l07357"></a><span class="lineno"> 7357</span>&#160;   <span class="keywordflow">if</span> (priority == <a class="code" href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a> &amp;&amp; strstr(application, <span class="stringliteral">&quot;${&quot;</span>) &amp;&amp; extension[0] != <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l07358"></a><span class="lineno"> 7358</span>&#160;      <span class="keywordtype">int</span> inhibited;</div><div class="line"><a name="l07359"></a><span class="lineno"> 7359</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a> = <a class="code" href="../../d5/d7b/channel_8h.html#acc0ae2c008f4157736ef290e9ca62572">ast_dummy_channel_alloc</a>();</div><div class="line"><a name="l07360"></a><span class="lineno"> 7360</span>&#160;</div><div class="line"><a name="l07361"></a><span class="lineno"> 7361</span>&#160;      <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l07362"></a><span class="lineno"> 7362</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a>(c, extension);</div><div class="line"><a name="l07363"></a><span class="lineno"> 7363</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a>(c, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>);</div><div class="line"><a name="l07364"></a><span class="lineno"> 7364</span>&#160;      }</div><div class="line"><a name="l07365"></a><span class="lineno"> 7365</span>&#160;</div><div class="line"><a name="l07366"></a><span class="lineno"> 7366</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l07367"></a><span class="lineno"> 7367</span>&#160;<span class="comment">       * We can allow dangerous functions when adding a hint since</span></div><div class="line"><a name="l07368"></a><span class="lineno"> 7368</span>&#160;<span class="comment">       * altering dialplan is itself a privileged activity.  Otherwise,</span></div><div class="line"><a name="l07369"></a><span class="lineno"> 7369</span>&#160;<span class="comment">       * we could never execute dangerous functions.</span></div><div class="line"><a name="l07370"></a><span class="lineno"> 7370</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l07371"></a><span class="lineno"> 7371</span>&#160;      inhibited = <a class="code" href="../../db/de0/pbx_8h.html#a17db9d0ffeebca9413e2e7dcb2ddd811">ast_thread_inhibit_escalations_swap</a>(0);</div><div class="line"><a name="l07372"></a><span class="lineno"> 7372</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#af5a13a9ab5aac5bb61e4f98ae7e8d296">pbx_substitute_variables_helper</a>(c, application, expand_buf, <span class="keyword">sizeof</span>(expand_buf));</div><div class="line"><a name="l07373"></a><span class="lineno"> 7373</span>&#160;      <span class="keywordflow">if</span> (0 &lt; inhibited) {</div><div class="line"><a name="l07374"></a><span class="lineno"> 7374</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#aee0767aa019c9b071f4ed73ffcf499e5">ast_thread_inhibit_escalations</a>();</div><div class="line"><a name="l07375"></a><span class="lineno"> 7375</span>&#160;      }</div><div class="line"><a name="l07376"></a><span class="lineno"> 7376</span>&#160;</div><div class="line"><a name="l07377"></a><span class="lineno"> 7377</span>&#160;      application = expand_buf;</div><div class="line"><a name="l07378"></a><span class="lineno"> 7378</span>&#160;      <span class="keywordflow">if</span> (c) {</div><div class="line"><a name="l07379"></a><span class="lineno"> 7379</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(c);</div><div class="line"><a name="l07380"></a><span class="lineno"> 7380</span>&#160;      }</div><div class="line"><a name="l07381"></a><span class="lineno"> 7381</span>&#160;   }</div><div class="line"><a name="l07382"></a><span class="lineno"> 7382</span>&#160;</div><div class="line"><a name="l07383"></a><span class="lineno"> 7383</span>&#160;   exten_fluff = <a class="code" href="../../db/d94/pbx_8c.html#a43cf2fd635776b81a4e9049e1bc5cecd">ext_fluff_count</a>(extension);</div><div class="line"><a name="l07384"></a><span class="lineno"> 7384</span>&#160;   callerid_fluff = callerid ? <a class="code" href="../../db/d94/pbx_8c.html#a43cf2fd635776b81a4e9049e1bc5cecd">ext_fluff_count</a>(callerid) : 0;</div><div class="line"><a name="l07385"></a><span class="lineno"> 7385</span>&#160;</div><div class="line"><a name="l07386"></a><span class="lineno"> 7386</span>&#160;   length = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a>);</div><div class="line"><a name="l07387"></a><span class="lineno"> 7387</span>&#160;   length += strlen(extension) + 1;</div><div class="line"><a name="l07388"></a><span class="lineno"> 7388</span>&#160;   <span class="keywordflow">if</span> (exten_fluff) {</div><div class="line"><a name="l07389"></a><span class="lineno"> 7389</span>&#160;      length += strlen(extension) + 1 - exten_fluff;</div><div class="line"><a name="l07390"></a><span class="lineno"> 7390</span>&#160;   }</div><div class="line"><a name="l07391"></a><span class="lineno"> 7391</span>&#160;   length += strlen(application) + 1;</div><div class="line"><a name="l07392"></a><span class="lineno"> 7392</span>&#160;   <span class="keywordflow">if</span> (label) {</div><div class="line"><a name="l07393"></a><span class="lineno"> 7393</span>&#160;      length += strlen(label) + 1;</div><div class="line"><a name="l07394"></a><span class="lineno"> 7394</span>&#160;   }</div><div class="line"><a name="l07395"></a><span class="lineno"> 7395</span>&#160;   <span class="keywordflow">if</span> (callerid) {</div><div class="line"><a name="l07396"></a><span class="lineno"> 7396</span>&#160;      length += strlen(callerid) + 1;</div><div class="line"><a name="l07397"></a><span class="lineno"> 7397</span>&#160;      <span class="keywordflow">if</span> (callerid_fluff) {</div><div class="line"><a name="l07398"></a><span class="lineno"> 7398</span>&#160;         length += strlen(callerid) + 1 - callerid_fluff;</div><div class="line"><a name="l07399"></a><span class="lineno"> 7399</span>&#160;      }</div><div class="line"><a name="l07400"></a><span class="lineno"> 7400</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07401"></a><span class="lineno"> 7401</span>&#160;      length ++;  <span class="comment">/* just the &#39;\0&#39; */</span></div><div class="line"><a name="l07402"></a><span class="lineno"> 7402</span>&#160;   }</div><div class="line"><a name="l07403"></a><span class="lineno"> 7403</span>&#160;   <span class="keywordflow">if</span> (registrar_file) {</div><div class="line"><a name="l07404"></a><span class="lineno"> 7404</span>&#160;      length += strlen(registrar_file) + 1;</div><div class="line"><a name="l07405"></a><span class="lineno"> 7405</span>&#160;   }</div><div class="line"><a name="l07406"></a><span class="lineno"> 7406</span>&#160;</div><div class="line"><a name="l07407"></a><span class="lineno"> 7407</span>&#160;   <span class="comment">/* Be optimistic:  Build the extension structure first */</span></div><div class="line"><a name="l07408"></a><span class="lineno"> 7408</span>&#160;   tmp = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, length);</div><div class="line"><a name="l07409"></a><span class="lineno"> 7409</span>&#160;   <span class="keywordflow">if</span> (!tmp) {</div><div class="line"><a name="l07410"></a><span class="lineno"> 7410</span>&#160;      <span class="comment">/* We always need to deallocate &#39;data&#39; on failure */</span></div><div class="line"><a name="l07411"></a><span class="lineno"> 7411</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>) {</div><div class="line"><a name="l07412"></a><span class="lineno"> 7412</span>&#160;         <a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>(data);</div><div class="line"><a name="l07413"></a><span class="lineno"> 7413</span>&#160;      }</div><div class="line"><a name="l07414"></a><span class="lineno"> 7414</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07415"></a><span class="lineno"> 7415</span>&#160;   }</div><div class="line"><a name="l07416"></a><span class="lineno"> 7416</span>&#160;</div><div class="line"><a name="l07417"></a><span class="lineno"> 7417</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(label)) <span class="comment">/* let&#39;s turn empty labels to a null ptr */</span></div><div class="line"><a name="l07418"></a><span class="lineno"> 7418</span>&#160;      label = 0;</div><div class="line"><a name="l07419"></a><span class="lineno"> 7419</span>&#160;</div><div class="line"><a name="l07420"></a><span class="lineno"> 7420</span>&#160;   <span class="comment">/* use p as dst in assignments, as the fields are const char * */</span></div><div class="line"><a name="l07421"></a><span class="lineno"> 7421</span>&#160;   p = tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a3976e924940f324effe69a4e4993e9c9">stuff</a>;</div><div class="line"><a name="l07422"></a><span class="lineno"> 7422</span>&#160;   <span class="keywordflow">if</span> (label) {</div><div class="line"><a name="l07423"></a><span class="lineno"> 7423</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a> = p;</div><div class="line"><a name="l07424"></a><span class="lineno"> 7424</span>&#160;      strcpy(p, label);</div><div class="line"><a name="l07425"></a><span class="lineno"> 7425</span>&#160;      p += strlen(label) + 1;</div><div class="line"><a name="l07426"></a><span class="lineno"> 7426</span>&#160;   }</div><div class="line"><a name="l07427"></a><span class="lineno"> 7427</span>&#160;   tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a> = p;</div><div class="line"><a name="l07428"></a><span class="lineno"> 7428</span>&#160;   p += <a class="code" href="../../db/d94/pbx_8c.html#a517e4a9ba0d6233eba58ad0f1307f55c">ext_strncpy</a>(p, extension, strlen(extension) + 1, 0);</div><div class="line"><a name="l07429"></a><span class="lineno"> 7429</span>&#160;   <span class="keywordflow">if</span> (exten_fluff) {</div><div class="line"><a name="l07430"></a><span class="lineno"> 7430</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a> = p;</div><div class="line"><a name="l07431"></a><span class="lineno"> 7431</span>&#160;      p += <a class="code" href="../../db/d94/pbx_8c.html#a517e4a9ba0d6233eba58ad0f1307f55c">ext_strncpy</a>(p, extension, strlen(extension) + 1 - exten_fluff, 1);</div><div class="line"><a name="l07432"></a><span class="lineno"> 7432</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07433"></a><span class="lineno"> 7433</span>&#160;      <span class="comment">/* no fluff, we don&#39;t need a copy. */</span></div><div class="line"><a name="l07434"></a><span class="lineno"> 7434</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a> = tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>;</div><div class="line"><a name="l07435"></a><span class="lineno"> 7435</span>&#160;   }</div><div class="line"><a name="l07436"></a><span class="lineno"> 7436</span>&#160;   tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = <a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;</div><div class="line"><a name="l07437"></a><span class="lineno"> 7437</span>&#160;   tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0574199c7fbb661fd7684472741955bb">cidmatch_display</a> = tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a> = p;   <span class="comment">/* but use p for assignments below */</span></div><div class="line"><a name="l07438"></a><span class="lineno"> 7438</span>&#160;</div><div class="line"><a name="l07439"></a><span class="lineno"> 7439</span>&#160;   <span class="comment">/* Blank callerid and NULL callerid are two SEPARATE things.  Do NOT confuse the two!!! */</span></div><div class="line"><a name="l07440"></a><span class="lineno"> 7440</span>&#160;   <span class="keywordflow">if</span> (callerid) {</div><div class="line"><a name="l07441"></a><span class="lineno"> 7441</span>&#160;      p += <a class="code" href="../../db/d94/pbx_8c.html#a517e4a9ba0d6233eba58ad0f1307f55c">ext_strncpy</a>(p, callerid, strlen(callerid) + 1, 0);</div><div class="line"><a name="l07442"></a><span class="lineno"> 7442</span>&#160;      <span class="keywordflow">if</span> (callerid_fluff) {</div><div class="line"><a name="l07443"></a><span class="lineno"> 7443</span>&#160;         tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a> = p;</div><div class="line"><a name="l07444"></a><span class="lineno"> 7444</span>&#160;         p += <a class="code" href="../../db/d94/pbx_8c.html#a517e4a9ba0d6233eba58ad0f1307f55c">ext_strncpy</a>(p, callerid, strlen(callerid) + 1 - callerid_fluff, 1);</div><div class="line"><a name="l07445"></a><span class="lineno"> 7445</span>&#160;      }</div><div class="line"><a name="l07446"></a><span class="lineno"> 7446</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> = <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a0aa5ba413029c07073f6e915036e037f">AST_EXT_MATCHCID_ON</a>;</div><div class="line"><a name="l07447"></a><span class="lineno"> 7447</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07448"></a><span class="lineno"> 7448</span>&#160;      *p++ = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l07449"></a><span class="lineno"> 7449</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> = <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a245df0f7c904df378369f60ea91938e7">AST_EXT_MATCHCID_OFF</a>;</div><div class="line"><a name="l07450"></a><span class="lineno"> 7450</span>&#160;   }</div><div class="line"><a name="l07451"></a><span class="lineno"> 7451</span>&#160;</div><div class="line"><a name="l07452"></a><span class="lineno"> 7452</span>&#160;   <span class="keywordflow">if</span> (registrar_file) {</div><div class="line"><a name="l07453"></a><span class="lineno"> 7453</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a3e3ed71b5dcbadee8292f3d1837eaa38">registrar_file</a> = p;</div><div class="line"><a name="l07454"></a><span class="lineno"> 7454</span>&#160;      strcpy(p, registrar_file);</div><div class="line"><a name="l07455"></a><span class="lineno"> 7455</span>&#160;      p += strlen(registrar_file) + 1;</div><div class="line"><a name="l07456"></a><span class="lineno"> 7456</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07457"></a><span class="lineno"> 7457</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a3e3ed71b5dcbadee8292f3d1837eaa38">registrar_file</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07458"></a><span class="lineno"> 7458</span>&#160;   }</div><div class="line"><a name="l07459"></a><span class="lineno"> 7459</span>&#160;</div><div class="line"><a name="l07460"></a><span class="lineno"> 7460</span>&#160;   tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a> = p;</div><div class="line"><a name="l07461"></a><span class="lineno"> 7461</span>&#160;   strcpy(p, application);</div><div class="line"><a name="l07462"></a><span class="lineno"> 7462</span>&#160;   tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">parent</a> = con;</div><div class="line"><a name="l07463"></a><span class="lineno"> 7463</span>&#160;   tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a> = <a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>;</div><div class="line"><a name="l07464"></a><span class="lineno"> 7464</span>&#160;   tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a> = <a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>;</div><div class="line"><a name="l07465"></a><span class="lineno"> 7465</span>&#160;   tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a> = <a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>;</div><div class="line"><a name="l07466"></a><span class="lineno"> 7466</span>&#160;   tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a90ec1116822211c96e24055d95972cca">registrar_line</a> = <a class="code" href="../../d7/d00/structast__exten.html#a90ec1116822211c96e24055d95972cca">registrar_line</a>;</div><div class="line"><a name="l07467"></a><span class="lineno"> 7467</span>&#160;</div><div class="line"><a name="l07468"></a><span class="lineno"> 7468</span>&#160;   <span class="keywordflow">if</span> (lock_context) {</div><div class="line"><a name="l07469"></a><span class="lineno"> 7469</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a>(con);</div><div class="line"><a name="l07470"></a><span class="lineno"> 7470</span>&#160;   }</div><div class="line"><a name="l07471"></a><span class="lineno"> 7471</span>&#160;</div><div class="line"><a name="l07472"></a><span class="lineno"> 7472</span>&#160;   <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>) { <span class="comment">/* usually, on initial load, the pattern_tree isn&#39;t formed until the first find_exten; so if we are adding</span></div><div class="line"><a name="l07473"></a><span class="lineno"> 7473</span>&#160;<span class="comment">                        an extension, and the trie exists, then we need to incrementally add this pattern to it. */</span></div><div class="line"><a name="l07474"></a><span class="lineno"> 7474</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a517e4a9ba0d6233eba58ad0f1307f55c">ext_strncpy</a>(dummy_name, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keyword">sizeof</span>(dummy_name), 1);</div><div class="line"><a name="l07475"></a><span class="lineno"> 7475</span>&#160;      dummy_exten.<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a> = dummy_name;</div><div class="line"><a name="l07476"></a><span class="lineno"> 7476</span>&#160;      dummy_exten.<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> = <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a245df0f7c904df378369f60ea91938e7">AST_EXT_MATCHCID_OFF</a>;</div><div class="line"><a name="l07477"></a><span class="lineno"> 7477</span>&#160;      dummy_exten.<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a> = 0;</div><div class="line"><a name="l07478"></a><span class="lineno"> 7478</span>&#160;      tmp2 = <a class="code" href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, &amp;dummy_exten);</div><div class="line"><a name="l07479"></a><span class="lineno"> 7479</span>&#160;      <span class="keywordflow">if</span> (!tmp2) {</div><div class="line"><a name="l07480"></a><span class="lineno"> 7480</span>&#160;         <span class="comment">/* hmmm, not in the trie; */</span></div><div class="line"><a name="l07481"></a><span class="lineno"> 7481</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a>(con, tmp, 0);</div><div class="line"><a name="l07482"></a><span class="lineno"> 7482</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, tmp); <span class="comment">/* for the sake of completeness */</span></div><div class="line"><a name="l07483"></a><span class="lineno"> 7483</span>&#160;      }</div><div class="line"><a name="l07484"></a><span class="lineno"> 7484</span>&#160;   }</div><div class="line"><a name="l07485"></a><span class="lineno"> 7485</span>&#160;   res = 0; <span class="comment">/* some compilers will think it is uninitialized otherwise */</span></div><div class="line"><a name="l07486"></a><span class="lineno"> 7486</span>&#160;   <span class="keywordflow">for</span> (e = con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a>; e; el = e, e = e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>) {   <span class="comment">/* scan the extension list */</span></div><div class="line"><a name="l07487"></a><span class="lineno"> 7487</span>&#160;      res = <a class="code" href="../../db/d94/pbx_8c.html#a31755abf9f213cb9559b909f71b85124">ext_cmp</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>);</div><div class="line"><a name="l07488"></a><span class="lineno"> 7488</span>&#160;      <span class="keywordflow">if</span> (res == 0) { <span class="comment">/* extension match, now look at cidmatch */</span></div><div class="line"><a name="l07489"></a><span class="lineno"> 7489</span>&#160;         <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a245df0f7c904df378369f60ea91938e7">AST_EXT_MATCHCID_OFF</a> &amp;&amp; tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a245df0f7c904df378369f60ea91938e7">AST_EXT_MATCHCID_OFF</a>)</div><div class="line"><a name="l07490"></a><span class="lineno"> 7490</span>&#160;            res = 0;</div><div class="line"><a name="l07491"></a><span class="lineno"> 7491</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a0aa5ba413029c07073f6e915036e037f">AST_EXT_MATCHCID_ON</a> &amp;&amp; e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a245df0f7c904df378369f60ea91938e7">AST_EXT_MATCHCID_OFF</a>)</div><div class="line"><a name="l07492"></a><span class="lineno"> 7492</span>&#160;            res = 1;</div><div class="line"><a name="l07493"></a><span class="lineno"> 7493</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a0aa5ba413029c07073f6e915036e037f">AST_EXT_MATCHCID_ON</a> &amp;&amp; tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a245df0f7c904df378369f60ea91938e7">AST_EXT_MATCHCID_OFF</a>)</div><div class="line"><a name="l07494"></a><span class="lineno"> 7494</span>&#160;            res = -1;</div><div class="line"><a name="l07495"></a><span class="lineno"> 7495</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l07496"></a><span class="lineno"> 7496</span>&#160;            res = <a class="code" href="../../db/d94/pbx_8c.html#a31755abf9f213cb9559b909f71b85124">ext_cmp</a>(e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>);</div><div class="line"><a name="l07497"></a><span class="lineno"> 7497</span>&#160;      }</div><div class="line"><a name="l07498"></a><span class="lineno"> 7498</span>&#160;      <span class="keywordflow">if</span> (res &gt;= 0)</div><div class="line"><a name="l07499"></a><span class="lineno"> 7499</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l07500"></a><span class="lineno"> 7500</span>&#160;   }</div><div class="line"><a name="l07501"></a><span class="lineno"> 7501</span>&#160;   <span class="keywordflow">if</span> (e &amp;&amp; res == 0) { <span class="comment">/* exact match, insert in the priority chain */</span></div><div class="line"><a name="l07502"></a><span class="lineno"> 7502</span>&#160;      res = <a class="code" href="../../db/d94/pbx_8c.html#a320968fd3a6b905a3cff12198bfa24f1">add_priority</a>(con, tmp, el, e, replace);</div><div class="line"><a name="l07503"></a><span class="lineno"> 7503</span>&#160;      <span class="keywordflow">if</span> (res &lt; 0) {</div><div class="line"><a name="l07504"></a><span class="lineno"> 7504</span>&#160;         <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>) {</div><div class="line"><a name="l07505"></a><span class="lineno"> 7505</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../da/d14/structmatch__char.html">match_char</a> *<a class="code" href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">x</a> = <a class="code" href="../../db/d94/pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a>(con, tmp, 1);</div><div class="line"><a name="l07506"></a><span class="lineno"> 7506</span>&#160;</div><div class="line"><a name="l07507"></a><span class="lineno"> 7507</span>&#160;            <span class="keywordflow">if</span> (x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) {</div><div class="line"><a name="l07508"></a><span class="lineno"> 7508</span>&#160;               x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a> = 1;</div><div class="line"><a name="l07509"></a><span class="lineno"> 7509</span>&#160;               x-&gt;<a class="code" href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = 0;</div><div class="line"><a name="l07510"></a><span class="lineno"> 7510</span>&#160;            }</div><div class="line"><a name="l07511"></a><span class="lineno"> 7511</span>&#160;</div><div class="line"><a name="l07512"></a><span class="lineno"> 7512</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66">ast_hashtab_remove_this_object</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, tmp);</div><div class="line"><a name="l07513"></a><span class="lineno"> 7513</span>&#160;         }</div><div class="line"><a name="l07514"></a><span class="lineno"> 7514</span>&#160;</div><div class="line"><a name="l07515"></a><span class="lineno"> 7515</span>&#160;         <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>) {</div><div class="line"><a name="l07516"></a><span class="lineno"> 7516</span>&#160;            tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">datad</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a>);</div><div class="line"><a name="l07517"></a><span class="lineno"> 7517</span>&#160;            <span class="comment">/* if you free this, null it out */</span></div><div class="line"><a name="l07518"></a><span class="lineno"> 7518</span>&#160;            tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07519"></a><span class="lineno"> 7519</span>&#160;         }</div><div class="line"><a name="l07520"></a><span class="lineno"> 7520</span>&#160;</div><div class="line"><a name="l07521"></a><span class="lineno"> 7521</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmp);</div><div class="line"><a name="l07522"></a><span class="lineno"> 7522</span>&#160;      }</div><div class="line"><a name="l07523"></a><span class="lineno"> 7523</span>&#160;      <span class="keywordflow">if</span> (lock_context) {</div><div class="line"><a name="l07524"></a><span class="lineno"> 7524</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l07525"></a><span class="lineno"> 7525</span>&#160;      }</div><div class="line"><a name="l07526"></a><span class="lineno"> 7526</span>&#160;      <span class="keywordflow">if</span> (res &lt; 0) {</div><div class="line"><a name="l07527"></a><span class="lineno"> 7527</span>&#160;         <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EEXIST;</div><div class="line"><a name="l07528"></a><span class="lineno"> 7528</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07529"></a><span class="lineno"> 7529</span>&#160;      }</div><div class="line"><a name="l07530"></a><span class="lineno"> 7530</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07531"></a><span class="lineno"> 7531</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l07532"></a><span class="lineno"> 7532</span>&#160;<span class="comment">       * not an exact match, this is the first entry with this pattern,</span></div><div class="line"><a name="l07533"></a><span class="lineno"> 7533</span>&#160;<span class="comment">       * so insert in the main list right before &#39;e&#39; (if any)</span></div><div class="line"><a name="l07534"></a><span class="lineno"> 7534</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l07535"></a><span class="lineno"> 7535</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = e;</div><div class="line"><a name="l07536"></a><span class="lineno"> 7536</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a> = <a class="code" href="../../d6/da0/hashtab_8h.html#ae4ca301bcfd289b81751c34e0c712847">ast_hashtab_create</a>(13,</div><div class="line"><a name="l07537"></a><span class="lineno"> 7537</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#a312597f1da31dcefbf18f31335f7295c">hashtab_compare_exten_numbers</a>,</div><div class="line"><a name="l07538"></a><span class="lineno"> 7538</span>&#160;                  <a class="code" href="../../d6/da0/hashtab_8h.html#aef63906caa0b965e9c8d8561600038e9">ast_hashtab_resize_java</a>,</div><div class="line"><a name="l07539"></a><span class="lineno"> 7539</span>&#160;                  <a class="code" href="../../d6/da0/hashtab_8h.html#a743bfd52a8c9eb5d939ff5944758d846">ast_hashtab_newsize_java</a>,</div><div class="line"><a name="l07540"></a><span class="lineno"> 7540</span>&#160;                  <a class="code" href="../../db/d94/pbx_8c.html#a4ee70a9380daf9be2bf681becb1a69c3">hashtab_hash_priority</a>,</div><div class="line"><a name="l07541"></a><span class="lineno"> 7541</span>&#160;                  0);</div><div class="line"><a name="l07542"></a><span class="lineno"> 7542</span>&#160;      tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a> = <a class="code" href="../../d6/da0/hashtab_8h.html#ae4ca301bcfd289b81751c34e0c712847">ast_hashtab_create</a>(7,</div><div class="line"><a name="l07543"></a><span class="lineno"> 7543</span>&#160;                     <a class="code" href="../../db/d94/pbx_8c.html#aad72a88ef3aa3258d69475cd14f274d0">hashtab_compare_exten_labels</a>,</div><div class="line"><a name="l07544"></a><span class="lineno"> 7544</span>&#160;                     <a class="code" href="../../d6/da0/hashtab_8h.html#aef63906caa0b965e9c8d8561600038e9">ast_hashtab_resize_java</a>,</div><div class="line"><a name="l07545"></a><span class="lineno"> 7545</span>&#160;                     <a class="code" href="../../d6/da0/hashtab_8h.html#a743bfd52a8c9eb5d939ff5944758d846">ast_hashtab_newsize_java</a>,</div><div class="line"><a name="l07546"></a><span class="lineno"> 7546</span>&#160;                     <a class="code" href="../../db/d94/pbx_8c.html#ae4a0bd08dbd3bc22fc65de969d3bfa45">hashtab_hash_labels</a>,</div><div class="line"><a name="l07547"></a><span class="lineno"> 7547</span>&#160;                     0);</div><div class="line"><a name="l07548"></a><span class="lineno"> 7548</span>&#160;</div><div class="line"><a name="l07549"></a><span class="lineno"> 7549</span>&#160;      <span class="keywordflow">if</span> (el) {  <span class="comment">/* there is another exten already in this context */</span></div><div class="line"><a name="l07550"></a><span class="lineno"> 7550</span>&#160;         el-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l07551"></a><span class="lineno"> 7551</span>&#160;      } <span class="keywordflow">else</span> {  <span class="comment">/* this is the first exten in this context */</span></div><div class="line"><a name="l07552"></a><span class="lineno"> 7552</span>&#160;         <span class="keywordflow">if</span> (!con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>) {</div><div class="line"><a name="l07553"></a><span class="lineno"> 7553</span>&#160;            con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a> = <a class="code" href="../../d6/da0/hashtab_8h.html#ae4ca301bcfd289b81751c34e0c712847">ast_hashtab_create</a>(27,</div><div class="line"><a name="l07554"></a><span class="lineno"> 7554</span>&#160;                                       <a class="code" href="../../db/d94/pbx_8c.html#a01a31156d536b161d4c400af885a6b23">hashtab_compare_extens</a>,</div><div class="line"><a name="l07555"></a><span class="lineno"> 7555</span>&#160;                                       <a class="code" href="../../d6/da0/hashtab_8h.html#aef63906caa0b965e9c8d8561600038e9">ast_hashtab_resize_java</a>,</div><div class="line"><a name="l07556"></a><span class="lineno"> 7556</span>&#160;                                       <a class="code" href="../../d6/da0/hashtab_8h.html#a743bfd52a8c9eb5d939ff5944758d846">ast_hashtab_newsize_java</a>,</div><div class="line"><a name="l07557"></a><span class="lineno"> 7557</span>&#160;                                       <a class="code" href="../../db/d94/pbx_8c.html#a46084c800c9b3dbe1f2b57e2d2b62304">hashtab_hash_extens</a>,</div><div class="line"><a name="l07558"></a><span class="lineno"> 7558</span>&#160;                                       0);</div><div class="line"><a name="l07559"></a><span class="lineno"> 7559</span>&#160;         }</div><div class="line"><a name="l07560"></a><span class="lineno"> 7560</span>&#160;         con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a> = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l07561"></a><span class="lineno"> 7561</span>&#160;      }</div><div class="line"><a name="l07562"></a><span class="lineno"> 7562</span>&#160;      <span class="keywordflow">if</span> (label) {</div><div class="line"><a name="l07563"></a><span class="lineno"> 7563</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>, tmp);</div><div class="line"><a name="l07564"></a><span class="lineno"> 7564</span>&#160;      }</div><div class="line"><a name="l07565"></a><span class="lineno"> 7565</span>&#160;      <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, tmp);</div><div class="line"><a name="l07566"></a><span class="lineno"> 7566</span>&#160;      <a class="code" href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a>(con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, tmp);</div><div class="line"><a name="l07567"></a><span class="lineno"> 7567</span>&#160;</div><div class="line"><a name="l07568"></a><span class="lineno"> 7568</span>&#160;      <span class="keywordflow">if</span> (lock_context) {</div><div class="line"><a name="l07569"></a><span class="lineno"> 7569</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);</div><div class="line"><a name="l07570"></a><span class="lineno"> 7570</span>&#160;      }</div><div class="line"><a name="l07571"></a><span class="lineno"> 7571</span>&#160;      <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> == <a class="code" href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>) {</div><div class="line"><a name="l07572"></a><span class="lineno"> 7572</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae46143d88ad157ae0e848c7167891fa1">ast_add_hint</a>(tmp);</div><div class="line"><a name="l07573"></a><span class="lineno"> 7573</span>&#160;      }</div><div class="line"><a name="l07574"></a><span class="lineno"> 7574</span>&#160;   }</div><div class="line"><a name="l07575"></a><span class="lineno"> 7575</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8c/logger_8h.html#a33f6031de4ab6d1406465a7a3ee18e86">DEBUG_ATLEAST</a>(1)) {</div><div class="line"><a name="l07576"></a><span class="lineno"> 7576</span>&#160;      <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> == <a class="code" href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a0aa5ba413029c07073f6e915036e037f">AST_EXT_MATCHCID_ON</a>) {</div><div class="line"><a name="l07577"></a><span class="lineno"> 7577</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Added extension &#39;%s&#39; priority %d (CID match &#39;%s&#39;) to %s (%p)\n&quot;</span>,</div><div class="line"><a name="l07578"></a><span class="lineno"> 7578</span>&#160;            tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0574199c7fbb661fd7684472741955bb">cidmatch_display</a>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, con);</div><div class="line"><a name="l07579"></a><span class="lineno"> 7579</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07580"></a><span class="lineno"> 7580</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Added extension &#39;%s&#39; priority %d to %s (%p)\n&quot;</span>,</div><div class="line"><a name="l07581"></a><span class="lineno"> 7581</span>&#160;            tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, tmp-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, con);</div><div class="line"><a name="l07582"></a><span class="lineno"> 7582</span>&#160;      }</div><div class="line"><a name="l07583"></a><span class="lineno"> 7583</span>&#160;   }</div><div class="line"><a name="l07584"></a><span class="lineno"> 7584</span>&#160;</div><div class="line"><a name="l07585"></a><span class="lineno"> 7585</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l07586"></a><span class="lineno"> 7586</span>&#160;}</div><div class="line"><a name="l07587"></a><span class="lineno"> 7587</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07588"></a><span class="lineno"> 7588</span>&#160;<span class="comment">/*! \brief Structure which contains information about an outgoing dial */</span></div><div class="line"><a name="l07589"></a><span class="lineno"><a class="line" href="../../d4/dcb/structpbx__outgoing.html"> 7589</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d4/dcb/structpbx__outgoing.html">pbx_outgoing</a> {<span class="comment"></span></div><div class="line"><a name="l07590"></a><span class="lineno"> 7590</span>&#160;<span class="comment">   /*! \brief Dialing structure being used */</span></div><div class="line"><a name="l07591"></a><span class="lineno"><a class="line" href="../../d4/dcb/structpbx__outgoing.html#a56990e06ce7fc176509a38f9d1258476"> 7591</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/db7/structast__dial.html">ast_dial</a> *<a class="code" href="../../d4/dcb/structpbx__outgoing.html#a56990e06ce7fc176509a38f9d1258476">dial</a>;<span class="comment"></span></div><div class="line"><a name="l07592"></a><span class="lineno"> 7592</span>&#160;<span class="comment">   /*! \brief Condition for synchronous dialing */</span></div><div class="line"><a name="l07593"></a><span class="lineno"><a class="line" href="../../d4/dcb/structpbx__outgoing.html#a1c7181c39f99ee801943a0d0aa9872b9"> 7593</a></span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a> <a class="code" href="../../d4/dcb/structpbx__outgoing.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>;<span class="comment"></span></div><div class="line"><a name="l07594"></a><span class="lineno"> 7594</span>&#160;<span class="comment">   /*! \brief Application to execute */</span></div><div class="line"><a name="l07595"></a><span class="lineno"><a class="line" href="../../d4/dcb/structpbx__outgoing.html#a3fa409a52b6210dbe249b2f37430fd4a"> 7595</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>[<a class="code" href="../../db/de0/pbx_8h.html#a3414b82af9b33fe907c9377c5c73c453">AST_MAX_APP</a>];<span class="comment"></span></div><div class="line"><a name="l07596"></a><span class="lineno"> 7596</span>&#160;<span class="comment">   /*! \brief Application data to pass to application */</span></div><div class="line"><a name="l07597"></a><span class="lineno"><a class="line" href="../../d4/dcb/structpbx__outgoing.html#afd5237ee024d0e110e7a1fdf64234f74"> 7597</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d4/dcb/structpbx__outgoing.html#afd5237ee024d0e110e7a1fdf64234f74">appdata</a>;<span class="comment"></span></div><div class="line"><a name="l07598"></a><span class="lineno"> 7598</span>&#160;<span class="comment">   /*! \brief Dialplan context */</span></div><div class="line"><a name="l07599"></a><span class="lineno"><a class="line" href="../../d4/dcb/structpbx__outgoing.html#ac25ea00ee3f082df06e0cf468cbde240"> 7599</a></span>&#160;   <span class="keywordtype">char</span> context[<a class="code" href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];<span class="comment"></span></div><div class="line"><a name="l07600"></a><span class="lineno"> 7600</span>&#160;<span class="comment">   /*! \brief Dialplan extension */</span></div><div class="line"><a name="l07601"></a><span class="lineno"><a class="line" href="../../d4/dcb/structpbx__outgoing.html#a78d4847658b695383d849efd12399b38"> 7601</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];<span class="comment"></span></div><div class="line"><a name="l07602"></a><span class="lineno"> 7602</span>&#160;<span class="comment">   /*! \brief Dialplan priority */</span></div><div class="line"><a name="l07603"></a><span class="lineno"><a class="line" href="../../d4/dcb/structpbx__outgoing.html#acec9ce2df15222151ad66fcb1d74eb9f"> 7603</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d4/dcb/structpbx__outgoing.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;<span class="comment"></span></div><div class="line"><a name="l07604"></a><span class="lineno"> 7604</span>&#160;<span class="comment">   /*! \brief Result of the dial operation when dialed is set */</span></div><div class="line"><a name="l07605"></a><span class="lineno"><a class="line" href="../../d4/dcb/structpbx__outgoing.html#a037644d793e72c825b54cc2deaf5783c"> 7605</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d4/dcb/structpbx__outgoing.html#a037644d793e72c825b54cc2deaf5783c">dial_res</a>;<span class="comment"></span></div><div class="line"><a name="l07606"></a><span class="lineno"> 7606</span>&#160;<span class="comment">   /*! \brief Set when dialing is completed */</span></div><div class="line"><a name="l07607"></a><span class="lineno"><a class="line" href="../../d4/dcb/structpbx__outgoing.html#a5e2b2d88194350ced76b66b4f631e329"> 7607</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/dcb/structpbx__outgoing.html#a5e2b2d88194350ced76b66b4f631e329">dialed</a>:1;<span class="comment"></span></div><div class="line"><a name="l07608"></a><span class="lineno"> 7608</span>&#160;<span class="comment">   /*! \brief Set if we&#39;ve spawned a thread to do our work */</span></div><div class="line"><a name="l07609"></a><span class="lineno"><a class="line" href="../../d4/dcb/structpbx__outgoing.html#a464147f9772c4cfb5b57507296c19d81"> 7609</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/dcb/structpbx__outgoing.html#a464147f9772c4cfb5b57507296c19d81">in_separate_thread</a>:1;</div><div class="line"><a name="l07610"></a><span class="lineno"> 7610</span>&#160;};</div><div class="line"><a name="l07611"></a><span class="lineno"> 7611</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07612"></a><span class="lineno"> 7612</span>&#160;<span class="comment">/*! \brief Destructor for outgoing structure */</span></div><div class="line"><a name="l07613"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a89b5550b3d6ddcd9031eeb79338f5a48"> 7613</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a89b5550b3d6ddcd9031eeb79338f5a48">pbx_outgoing_destroy</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l07614"></a><span class="lineno"> 7614</span>&#160;{</div><div class="line"><a name="l07615"></a><span class="lineno"> 7615</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/dcb/structpbx__outgoing.html">pbx_outgoing</a> *<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a> = obj;</div><div class="line"><a name="l07616"></a><span class="lineno"> 7616</span>&#160;</div><div class="line"><a name="l07617"></a><span class="lineno"> 7617</span>&#160;   <span class="keywordflow">if</span> (outgoing-&gt;<a class="code" href="../../d4/dcb/structpbx__outgoing.html#a56990e06ce7fc176509a38f9d1258476">dial</a>) {</div><div class="line"><a name="l07618"></a><span class="lineno"> 7618</span>&#160;      <a class="code" href="../../df/dcf/dial_8h.html#ab75c6f2fe91945cf61e7e91939618db2">ast_dial_destroy</a>(outgoing-&gt;<a class="code" href="../../d4/dcb/structpbx__outgoing.html#a56990e06ce7fc176509a38f9d1258476">dial</a>);</div><div class="line"><a name="l07619"></a><span class="lineno"> 7619</span>&#160;   }</div><div class="line"><a name="l07620"></a><span class="lineno"> 7620</span>&#160;</div><div class="line"><a name="l07621"></a><span class="lineno"> 7621</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a>(&amp;outgoing-&gt;<a class="code" href="../../d4/dcb/structpbx__outgoing.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);</div><div class="line"><a name="l07622"></a><span class="lineno"> 7622</span>&#160;</div><div class="line"><a name="l07623"></a><span class="lineno"> 7623</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(outgoing-&gt;<a class="code" href="../../d4/dcb/structpbx__outgoing.html#afd5237ee024d0e110e7a1fdf64234f74">appdata</a>);</div><div class="line"><a name="l07624"></a><span class="lineno"> 7624</span>&#160;}</div><div class="line"><a name="l07625"></a><span class="lineno"> 7625</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07626"></a><span class="lineno"> 7626</span>&#160;<span class="comment">/*! \brief Internal function which dials an outgoing leg and sends it to a provided extension or application */</span></div><div class="line"><a name="l07627"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ac8e8f73ccf4ba3fdbc519bc9c0027e4f"> 7627</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../db/d94/pbx_8c.html#ac8e8f73ccf4ba3fdbc519bc9c0027e4f">pbx_outgoing_exec</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l07628"></a><span class="lineno"> 7628</span>&#160;{</div><div class="line"><a name="l07629"></a><span class="lineno"> 7629</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/dcb/structpbx__outgoing.html">pbx_outgoing</a> *, <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>, data, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l07630"></a><span class="lineno"> 7630</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847">ast_dial_result</a> res;</div><div class="line"><a name="l07631"></a><span class="lineno"> 7631</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan;</div><div class="line"><a name="l07632"></a><span class="lineno"> 7632</span>&#160;</div><div class="line"><a name="l07633"></a><span class="lineno"> 7633</span>&#160;   res = <a class="code" href="../../df/dcf/dial_8h.html#a65e30d29847af5495afe1baed823957e">ast_dial_run</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l07634"></a><span class="lineno"> 7634</span>&#160;</div><div class="line"><a name="l07635"></a><span class="lineno"> 7635</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;in_separate_thread) {</div><div class="line"><a name="l07636"></a><span class="lineno"> 7636</span>&#160;      <span class="comment">/* Notify anyone interested that dialing is complete */</span></div><div class="line"><a name="l07637"></a><span class="lineno"> 7637</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>);</div><div class="line"><a name="l07638"></a><span class="lineno"> 7638</span>&#160;      <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial_res = res;</div><div class="line"><a name="l07639"></a><span class="lineno"> 7639</span>&#160;      <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dialed = 1;</div><div class="line"><a name="l07640"></a><span class="lineno"> 7640</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a>(&amp;<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;cond);</div><div class="line"><a name="l07641"></a><span class="lineno"> 7641</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>);</div><div class="line"><a name="l07642"></a><span class="lineno"> 7642</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07643"></a><span class="lineno"> 7643</span>&#160;      <span class="comment">/* We still need the dial result, but we don&#39;t need to lock */</span></div><div class="line"><a name="l07644"></a><span class="lineno"> 7644</span>&#160;      <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial_res = res;</div><div class="line"><a name="l07645"></a><span class="lineno"> 7645</span>&#160;   }</div><div class="line"><a name="l07646"></a><span class="lineno"> 7646</span>&#160;</div><div class="line"><a name="l07647"></a><span class="lineno"> 7647</span>&#160;   <span class="comment">/* If the outgoing leg was not answered we can immediately return and go no further */</span></div><div class="line"><a name="l07648"></a><span class="lineno"> 7648</span>&#160;   <span class="keywordflow">if</span> (res != <a class="code" href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847a4a8c0d54e6071d1e9a36adae685406d3">AST_DIAL_RESULT_ANSWERED</a>) {</div><div class="line"><a name="l07649"></a><span class="lineno"> 7649</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07650"></a><span class="lineno"> 7650</span>&#160;   }</div><div class="line"><a name="l07651"></a><span class="lineno"> 7651</span>&#160;</div><div class="line"><a name="l07652"></a><span class="lineno"> 7652</span>&#160;   <span class="comment">/* We steal the channel so we get ownership of when it is hung up */</span></div><div class="line"><a name="l07653"></a><span class="lineno"> 7653</span>&#160;   chan = <a class="code" href="../../df/dcf/dial_8h.html#a390484ae7a65d0297177fc8223e6b083">ast_dial_answered_steal</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial);</div><div class="line"><a name="l07654"></a><span class="lineno"> 7654</span>&#160;</div><div class="line"><a name="l07655"></a><span class="lineno"> 7655</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#a66066052ae6571f5495a4e7f8df6c0bb">app</a>)) {</div><div class="line"><a name="l07656"></a><span class="lineno"> 7656</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d0/da3/structast__app.html">ast_app</a> *<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a> = <a class="code" href="../../db/de0/pbx_8h.html#ad4a6912dcd2ad44a186d0a284afafc51">pbx_findapp</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#a66066052ae6571f5495a4e7f8df6c0bb">app</a>);</div><div class="line"><a name="l07657"></a><span class="lineno"> 7657</span>&#160;</div><div class="line"><a name="l07658"></a><span class="lineno"> 7658</span>&#160;      <span class="keywordflow">if</span> (app) {</div><div class="line"><a name="l07659"></a><span class="lineno"> 7659</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Launching %s(%s) on %s\n&quot;</span>, <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#a66066052ae6571f5495a4e7f8df6c0bb">app</a>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;appdata, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l07660"></a><span class="lineno"> 7660</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l07661"></a><span class="lineno"> 7661</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#a6e3dbc57c03c23543354ef108c31fac8">pbx_exec</a>(chan, app, <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;appdata);</div><div class="line"><a name="l07662"></a><span class="lineno"> 7662</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07663"></a><span class="lineno"> 7663</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No such application &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#a66066052ae6571f5495a4e7f8df6c0bb">app</a>);</div><div class="line"><a name="l07664"></a><span class="lineno"> 7664</span>&#160;      }</div><div class="line"><a name="l07665"></a><span class="lineno"> 7665</span>&#160;</div><div class="line"><a name="l07666"></a><span class="lineno"> 7666</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(chan);</div><div class="line"><a name="l07667"></a><span class="lineno"> 7667</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07668"></a><span class="lineno"> 7668</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#a7faec841658b88ad0cfbc684853acad3">context</a>)) {</div><div class="line"><a name="l07669"></a><span class="lineno"> 7669</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a>(chan, <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#a7faec841658b88ad0cfbc684853acad3">context</a>);</div><div class="line"><a name="l07670"></a><span class="lineno"> 7670</span>&#160;      }</div><div class="line"><a name="l07671"></a><span class="lineno"> 7671</span>&#160;</div><div class="line"><a name="l07672"></a><span class="lineno"> 7672</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#aaee31f4cc48985167efcd38ab252dac8">exten</a>)) {</div><div class="line"><a name="l07673"></a><span class="lineno"> 7673</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a>(chan, <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#aaee31f4cc48985167efcd38ab252dac8">exten</a>);</div><div class="line"><a name="l07674"></a><span class="lineno"> 7674</span>&#160;      }</div><div class="line"><a name="l07675"></a><span class="lineno"> 7675</span>&#160;</div><div class="line"><a name="l07676"></a><span class="lineno"> 7676</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> &gt; 0) {</div><div class="line"><a name="l07677"></a><span class="lineno"> 7677</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a>(chan, <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>);</div><div class="line"><a name="l07678"></a><span class="lineno"> 7678</span>&#160;      }</div><div class="line"><a name="l07679"></a><span class="lineno"> 7679</span>&#160;</div><div class="line"><a name="l07680"></a><span class="lineno"> 7680</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a44b6406c9220f7f2b610ac712369f405">ast_pbx_run</a>(chan)) {</div><div class="line"><a name="l07681"></a><span class="lineno"> 7681</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to start PBX on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l07682"></a><span class="lineno"> 7682</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(chan);</div><div class="line"><a name="l07683"></a><span class="lineno"> 7683</span>&#160;      }</div><div class="line"><a name="l07684"></a><span class="lineno"> 7684</span>&#160;   }</div><div class="line"><a name="l07685"></a><span class="lineno"> 7685</span>&#160;</div><div class="line"><a name="l07686"></a><span class="lineno"> 7686</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07687"></a><span class="lineno"> 7687</span>&#160;}</div><div class="line"><a name="l07688"></a><span class="lineno"> 7688</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07689"></a><span class="lineno"> 7689</span>&#160;<span class="comment">/*! \brief Internal dialing state callback which causes early media to trigger an answer */</span></div><div class="line"><a name="l07690"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a00f40129528e1bb08c291ddf96075f9e"> 7690</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a00f40129528e1bb08c291ddf96075f9e">pbx_outgoing_state_callback</a>(<span class="keyword">struct</span> <a class="code" href="../../db/db7/structast__dial.html">ast_dial</a> *dial)</div><div class="line"><a name="l07691"></a><span class="lineno"> 7691</span>&#160;{</div><div class="line"><a name="l07692"></a><span class="lineno"> 7692</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d4/d84/structchannel.html">channel</a>;</div><div class="line"><a name="l07693"></a><span class="lineno"> 7693</span>&#160;</div><div class="line"><a name="l07694"></a><span class="lineno"> 7694</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/dcf/dial_8h.html#a051c20e595f3e3c2be10c84b4247dd37">ast_dial_state</a>(dial) != <a class="code" href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847a5cc795503d8ce3f6df21f18e7d30e24e">AST_DIAL_RESULT_PROGRESS</a>) {</div><div class="line"><a name="l07695"></a><span class="lineno"> 7695</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l07696"></a><span class="lineno"> 7696</span>&#160;   }</div><div class="line"><a name="l07697"></a><span class="lineno"> 7697</span>&#160;</div><div class="line"><a name="l07698"></a><span class="lineno"> 7698</span>&#160;   <span class="keywordflow">if</span> (!(channel = <a class="code" href="../../df/dcf/dial_8h.html#a45841b9bf18bd62ea3a58f5ecf8b5d4f">ast_dial_get_channel</a>(dial, 0))) {</div><div class="line"><a name="l07699"></a><span class="lineno"> 7699</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l07700"></a><span class="lineno"> 7700</span>&#160;   }</div><div class="line"><a name="l07701"></a><span class="lineno"> 7701</span>&#160;</div><div class="line"><a name="l07702"></a><span class="lineno"> 7702</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Treating progress as answer on &#39;%s&#39; due to early media option\n&quot;</span>,</div><div class="line"><a name="l07703"></a><span class="lineno"> 7703</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(channel));</div><div class="line"><a name="l07704"></a><span class="lineno"> 7704</span>&#160;</div><div class="line"><a name="l07705"></a><span class="lineno"> 7705</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a60f9d2b0ab8b7a839902313321163b28">ast_queue_control</a>(channel, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>);</div><div class="line"><a name="l07706"></a><span class="lineno"> 7706</span>&#160;}</div><div class="line"><a name="l07707"></a><span class="lineno"> 7707</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07708"></a><span class="lineno"> 7708</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l07709"></a><span class="lineno"> 7709</span>&#160;<span class="comment"> * \brief Attempt to convert disconnect cause to old originate reason.</span></div><div class="line"><a name="l07710"></a><span class="lineno"> 7710</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l07711"></a><span class="lineno"> 7711</span>&#160;<span class="comment"> * \todo XXX The old originate reasons need to be trashed and replaced</span></div><div class="line"><a name="l07712"></a><span class="lineno"> 7712</span>&#160;<span class="comment"> * with normal disconnect cause codes if the call was not answered.</span></div><div class="line"><a name="l07713"></a><span class="lineno"> 7713</span>&#160;<span class="comment"> * The internal consumers of the reason values would also need to be</span></div><div class="line"><a name="l07714"></a><span class="lineno"> 7714</span>&#160;<span class="comment"> * updated: app_originate, call files, and AMI OriginateResponse.</span></div><div class="line"><a name="l07715"></a><span class="lineno"> 7715</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l07716"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a0bf66af78336396b8c8336830130d93b"> 7716</a></span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390">ast_control_frame_type</a> <a class="code" href="../../db/d94/pbx_8c.html#a0bf66af78336396b8c8336830130d93b">pbx_dial_reason</a>(<span class="keyword">enum</span> <a class="code" href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847">ast_dial_result</a> dial_result, <span class="keywordtype">int</span> cause)</div><div class="line"><a name="l07717"></a><span class="lineno"> 7717</span>&#160;{</div><div class="line"><a name="l07718"></a><span class="lineno"> 7718</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390">ast_control_frame_type</a> pbx_reason;</div><div class="line"><a name="l07719"></a><span class="lineno"> 7719</span>&#160;</div><div class="line"><a name="l07720"></a><span class="lineno"> 7720</span>&#160;   <span class="keywordflow">if</span> (dial_result == <a class="code" href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847a4a8c0d54e6071d1e9a36adae685406d3">AST_DIAL_RESULT_ANSWERED</a>) {</div><div class="line"><a name="l07721"></a><span class="lineno"> 7721</span>&#160;      <span class="comment">/* Remote end answered. */</span></div><div class="line"><a name="l07722"></a><span class="lineno"> 7722</span>&#160;      pbx_reason = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>;</div><div class="line"><a name="l07723"></a><span class="lineno"> 7723</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dial_result == <a class="code" href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847a23fe48f529c8d06fa7dffc976a871a16">AST_DIAL_RESULT_HANGUP</a>) {</div><div class="line"><a name="l07724"></a><span class="lineno"> 7724</span>&#160;      <span class="comment">/* Caller hungup */</span></div><div class="line"><a name="l07725"></a><span class="lineno"> 7725</span>&#160;      pbx_reason = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>;</div><div class="line"><a name="l07726"></a><span class="lineno"> 7726</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07727"></a><span class="lineno"> 7727</span>&#160;      <span class="keywordflow">switch</span> (cause) {</div><div class="line"><a name="l07728"></a><span class="lineno"> 7728</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#aff0e956cb3ef657557fa468a17416c0b">AST_CAUSE_USER_BUSY</a>:</div><div class="line"><a name="l07729"></a><span class="lineno"> 7729</span>&#160;         pbx_reason = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>;</div><div class="line"><a name="l07730"></a><span class="lineno"> 7730</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l07731"></a><span class="lineno"> 7731</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#a9900b24b261c275bb54631f16d4d38cc">AST_CAUSE_CALL_REJECTED</a>:</div><div class="line"><a name="l07732"></a><span class="lineno"> 7732</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#a9e3ffd481d41079a4ed1700464c9a42a">AST_CAUSE_NETWORK_OUT_OF_ORDER</a>:</div><div class="line"><a name="l07733"></a><span class="lineno"> 7733</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#a51ccdf5c6aa26375323fd14cfef02618">AST_CAUSE_DESTINATION_OUT_OF_ORDER</a>:</div><div class="line"><a name="l07734"></a><span class="lineno"> 7734</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#a554ad1e279785609a381c194f770f554">AST_CAUSE_NORMAL_TEMPORARY_FAILURE</a>:</div><div class="line"><a name="l07735"></a><span class="lineno"> 7735</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#a02b3785262e0be6843e8e9d235d8d78d">AST_CAUSE_SWITCH_CONGESTION</a>:</div><div class="line"><a name="l07736"></a><span class="lineno"> 7736</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#a84f3380611feeec35bb25319b26f92fd">AST_CAUSE_NORMAL_CIRCUIT_CONGESTION</a>:</div><div class="line"><a name="l07737"></a><span class="lineno"> 7737</span>&#160;         pbx_reason = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>;</div><div class="line"><a name="l07738"></a><span class="lineno"> 7738</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l07739"></a><span class="lineno"> 7739</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#aa71419a0c598e31312477c5a644e7440">AST_CAUSE_ANSWERED_ELSEWHERE</a>:</div><div class="line"><a name="l07740"></a><span class="lineno"> 7740</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#af03fc9fe2f0ecc69330e014aff8d0f73">AST_CAUSE_NO_ANSWER</a>:</div><div class="line"><a name="l07741"></a><span class="lineno"> 7741</span>&#160;         <span class="comment">/* Remote end was ringing (but isn&#39;t anymore) */</span></div><div class="line"><a name="l07742"></a><span class="lineno"> 7742</span>&#160;         pbx_reason = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>;</div><div class="line"><a name="l07743"></a><span class="lineno"> 7743</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l07744"></a><span class="lineno"> 7744</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d4/da3/causes_8h.html#a131d8780af378d0c4ef5075949902785">AST_CAUSE_UNALLOCATED</a>:</div><div class="line"><a name="l07745"></a><span class="lineno"> 7745</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l07746"></a><span class="lineno"> 7746</span>&#160;         <span class="comment">/* Call Failure (not BUSY, and not NO_ANSWER, maybe Circuit busy or down?) */</span></div><div class="line"><a name="l07747"></a><span class="lineno"> 7747</span>&#160;         pbx_reason = 0;</div><div class="line"><a name="l07748"></a><span class="lineno"> 7748</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l07749"></a><span class="lineno"> 7749</span>&#160;      }</div><div class="line"><a name="l07750"></a><span class="lineno"> 7750</span>&#160;   }</div><div class="line"><a name="l07751"></a><span class="lineno"> 7751</span>&#160;</div><div class="line"><a name="l07752"></a><span class="lineno"> 7752</span>&#160;   <span class="keywordflow">return</span> pbx_reason;</div><div class="line"><a name="l07753"></a><span class="lineno"> 7753</span>&#160;}</div><div class="line"><a name="l07754"></a><span class="lineno"> 7754</span>&#160;</div><div class="line"><a name="l07755"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a9582d9da72e4e799183a50e4ddc90a94"> 7755</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a9582d9da72e4e799183a50e4ddc90a94">pbx_outgoing_attempt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">struct</span> <a class="code" href="../../d8/d69/structast__format__cap.html">ast_format_cap</a> *cap,</div><div class="line"><a name="l07756"></a><span class="lineno"> 7756</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *addr, <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority,</div><div class="line"><a name="l07757"></a><span class="lineno"> 7757</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *appdata, <span class="keywordtype">int</span> *reason, <span class="keywordtype">int</span> synchronous,</div><div class="line"><a name="l07758"></a><span class="lineno"> 7758</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *vars,</div><div class="line"><a name="l07759"></a><span class="lineno"> 7759</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *account, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> **locked_channel, <span class="keywordtype">int</span> early_media,</div><div class="line"><a name="l07760"></a><span class="lineno"> 7760</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../da/de5/structast__assigned__ids.html">ast_assigned_ids</a> *assignedids, <span class="keyword">const</span> <span class="keywordtype">char</span> *predial_callee)</div><div class="line"><a name="l07761"></a><span class="lineno"> 7761</span>&#160;{</div><div class="line"><a name="l07762"></a><span class="lineno"> 7762</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/dcb/structpbx__outgoing.html">pbx_outgoing</a> *, <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l07763"></a><span class="lineno"> 7763</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../df/d3c/structast__channel.html#abe3b191f9529aba5e60447f982310648">dialed</a>;</div><div class="line"><a name="l07764"></a><span class="lineno"> 7764</span>&#160;   pthread_t <a class="code" href="../../df/d44/app__meetme_8c.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>;</div><div class="line"><a name="l07765"></a><span class="lineno"> 7765</span>&#160;   <span class="keywordtype">char</span> tmp_cid_name[128];</div><div class="line"><a name="l07766"></a><span class="lineno"> 7766</span>&#160;   <span class="keywordtype">char</span> tmp_cid_num[128];</div><div class="line"><a name="l07767"></a><span class="lineno"> 7767</span>&#160;</div><div class="line"><a name="l07768"></a><span class="lineno"> 7768</span>&#160;   <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>), <a class="code" href="../../db/d94/pbx_8c.html#a89b5550b3d6ddcd9031eeb79338f5a48">pbx_outgoing_destroy</a>);</div><div class="line"><a name="l07769"></a><span class="lineno"> 7769</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>) {</div><div class="line"><a name="l07770"></a><span class="lineno"> 7770</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07771"></a><span class="lineno"> 7771</span>&#160;   }</div><div class="line"><a name="l07772"></a><span class="lineno"> 7772</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a>(&amp;<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;cond, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l07773"></a><span class="lineno"> 7773</span>&#160;</div><div class="line"><a name="l07774"></a><span class="lineno"> 7774</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(app)) {</div><div class="line"><a name="l07775"></a><span class="lineno"> 7775</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#a66066052ae6571f5495a4e7f8df6c0bb">app</a>, app, <span class="keyword">sizeof</span>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#a66066052ae6571f5495a4e7f8df6c0bb">app</a>));</div><div class="line"><a name="l07776"></a><span class="lineno"> 7776</span>&#160;      <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;appdata = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(appdata);</div><div class="line"><a name="l07777"></a><span class="lineno"> 7777</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07778"></a><span class="lineno"> 7778</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#a7faec841658b88ad0cfbc684853acad3">context</a>, context, <span class="keyword">sizeof</span>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#a7faec841658b88ad0cfbc684853acad3">context</a>));</div><div class="line"><a name="l07779"></a><span class="lineno"> 7779</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#aaee31f4cc48985167efcd38ab252dac8">exten</a>, exten, <span class="keyword">sizeof</span>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#aaee31f4cc48985167efcd38ab252dac8">exten</a>));</div><div class="line"><a name="l07780"></a><span class="lineno"> 7780</span>&#160;      <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;<a class="code" href="../../de/dcd/structoutgoing.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = <a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;</div><div class="line"><a name="l07781"></a><span class="lineno"> 7781</span>&#160;   }</div><div class="line"><a name="l07782"></a><span class="lineno"> 7782</span>&#160;</div><div class="line"><a name="l07783"></a><span class="lineno"> 7783</span>&#160;   <span class="keywordflow">if</span> (!(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial = <a class="code" href="../../df/dcf/dial_8h.html#aff55dbc56bc54126828f78a47d1f2282">ast_dial_create</a>())) {</div><div class="line"><a name="l07784"></a><span class="lineno"> 7784</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07785"></a><span class="lineno"> 7785</span>&#160;   }</div><div class="line"><a name="l07786"></a><span class="lineno"> 7786</span>&#160;</div><div class="line"><a name="l07787"></a><span class="lineno"> 7787</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/dcf/dial_8h.html#a2bd4d9ffd57e401b004cc131bd2ad497">ast_dial_append</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial, type, addr, assignedids)) {</div><div class="line"><a name="l07788"></a><span class="lineno"> 7788</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07789"></a><span class="lineno"> 7789</span>&#160;   }</div><div class="line"><a name="l07790"></a><span class="lineno"> 7790</span>&#160;</div><div class="line"><a name="l07791"></a><span class="lineno"> 7791</span>&#160;   <a class="code" href="../../df/dcf/dial_8h.html#a4d113a25d55a4ad9509fd954885f1dbc">ast_dial_set_global_timeout</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial, timeout);</div><div class="line"><a name="l07792"></a><span class="lineno"> 7792</span>&#160;</div><div class="line"><a name="l07793"></a><span class="lineno"> 7793</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(predial_callee)) {</div><div class="line"><a name="l07794"></a><span class="lineno"> 7794</span>&#160;      <span class="comment">/* note casting to void * here to suppress compiler warning message (passing const to non-const function) */</span></div><div class="line"><a name="l07795"></a><span class="lineno"> 7795</span>&#160;      <a class="code" href="../../df/dcf/dial_8h.html#ab8b2433b581e1a73f860e4cf262a2890">ast_dial_option_global_enable</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial, <a class="code" href="../../df/dcf/dial_8h.html#aaa04d25740b60e15179613e6465cff39aa437507093303f10b9b62ec2132cd00b">AST_DIAL_OPTION_PREDIAL</a>, (<span class="keywordtype">void</span> *)predial_callee);</div><div class="line"><a name="l07796"></a><span class="lineno"> 7796</span>&#160;   }</div><div class="line"><a name="l07797"></a><span class="lineno"> 7797</span>&#160;</div><div class="line"><a name="l07798"></a><span class="lineno"> 7798</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/dcf/dial_8h.html#a3cd0ba996525c0c0b9c88c743fe6c34d">ast_dial_prerun</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, cap)) {</div><div class="line"><a name="l07799"></a><span class="lineno"> 7799</span>&#160;      <span class="keywordflow">if</span> (synchronous &amp;&amp; reason) {</div><div class="line"><a name="l07800"></a><span class="lineno"> 7800</span>&#160;         *reason = <a class="code" href="../../db/d94/pbx_8c.html#a0bf66af78336396b8c8336830130d93b">pbx_dial_reason</a>(<a class="code" href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847a077aa090d089e32265755c7ec0f1dac2">AST_DIAL_RESULT_FAILED</a>,</div><div class="line"><a name="l07801"></a><span class="lineno"> 7801</span>&#160;            <a class="code" href="../../df/dcf/dial_8h.html#a9467ca6247764d86e2365ab9bbc68c35">ast_dial_reason</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial, 0));</div><div class="line"><a name="l07802"></a><span class="lineno"> 7802</span>&#160;      }</div><div class="line"><a name="l07803"></a><span class="lineno"> 7803</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07804"></a><span class="lineno"> 7804</span>&#160;   }</div><div class="line"><a name="l07805"></a><span class="lineno"> 7805</span>&#160;</div><div class="line"><a name="l07806"></a><span class="lineno"> 7806</span>&#160;   dialed = <a class="code" href="../../df/dcf/dial_8h.html#a45841b9bf18bd62ea3a58f5ecf8b5d4f">ast_dial_get_channel</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial, 0);</div><div class="line"><a name="l07807"></a><span class="lineno"> 7807</span>&#160;   <span class="keywordflow">if</span> (!dialed) {</div><div class="line"><a name="l07808"></a><span class="lineno"> 7808</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07809"></a><span class="lineno"> 7809</span>&#160;   }</div><div class="line"><a name="l07810"></a><span class="lineno"> 7810</span>&#160;</div><div class="line"><a name="l07811"></a><span class="lineno"> 7811</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(dialed);</div><div class="line"><a name="l07812"></a><span class="lineno"> 7812</span>&#160;   <span class="keywordflow">if</span> (vars) {</div><div class="line"><a name="l07813"></a><span class="lineno"> 7813</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a5b14bfe21364dd8f73d45f15cf313524">ast_set_variables</a>(dialed, vars);</div><div class="line"><a name="l07814"></a><span class="lineno"> 7814</span>&#160;   }</div><div class="line"><a name="l07815"></a><span class="lineno"> 7815</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(account)) {</div><div class="line"><a name="l07816"></a><span class="lineno"> 7816</span>&#160;      <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf195fcf1686408b5e52ad76996653cea">ast_channel_stage_snapshot</a>(dialed);</div><div class="line"><a name="l07817"></a><span class="lineno"> 7817</span>&#160;      ast_channel_accountcode_set(dialed, account);</div><div class="line"><a name="l07818"></a><span class="lineno"> 7818</span>&#160;      ast_channel_peeraccount_set(dialed, account);</div><div class="line"><a name="l07819"></a><span class="lineno"> 7819</span>&#160;      <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga920b9d3e484257c7e593452a8e36d8d4">ast_channel_stage_snapshot_done</a>(dialed);</div><div class="line"><a name="l07820"></a><span class="lineno"> 7820</span>&#160;   }</div><div class="line"><a name="l07821"></a><span class="lineno"> 7821</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a>(dialed), <a class="code" href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5ae9c1c04502304018b62d1e5383ccacb3">AST_FLAG_ORIGINATED</a>);</div><div class="line"><a name="l07822"></a><span class="lineno"> 7822</span>&#160;</div><div class="line"><a name="l07823"></a><span class="lineno"> 7823</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(predial_callee)) {</div><div class="line"><a name="l07824"></a><span class="lineno"> 7824</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07825"></a><span class="lineno"> 7825</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l07826"></a><span class="lineno"> 7826</span>&#160;<span class="comment">       * The predial sub routine may have set callerid so set this into the new channel</span></div><div class="line"><a name="l07827"></a><span class="lineno"> 7827</span>&#160;<span class="comment">       * Note... cid_num and cid_name parameters to this function will always be NULL if</span></div><div class="line"><a name="l07828"></a><span class="lineno"> 7828</span>&#160;<span class="comment">       * predial_callee is non-NULL so we are not overwriting anything here.</span></div><div class="line"><a name="l07829"></a><span class="lineno"> 7829</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l07830"></a><span class="lineno"> 7830</span>&#160;      tmp = <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(dialed)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(dialed)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l07831"></a><span class="lineno"> 7831</span>&#160;      <span class="keywordflow">if</span> (tmp) {</div><div class="line"><a name="l07832"></a><span class="lineno"> 7832</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(tmp_cid_num, tmp, <span class="keyword">sizeof</span>(tmp_cid_num));</div><div class="line"><a name="l07833"></a><span class="lineno"> 7833</span>&#160;         cid_num = tmp_cid_num;</div><div class="line"><a name="l07834"></a><span class="lineno"> 7834</span>&#160;      }</div><div class="line"><a name="l07835"></a><span class="lineno"> 7835</span>&#160;      tmp = <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(dialed)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(dialed)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l07836"></a><span class="lineno"> 7836</span>&#160;      <span class="keywordflow">if</span> (tmp) {</div><div class="line"><a name="l07837"></a><span class="lineno"> 7837</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(tmp_cid_name, tmp, <span class="keyword">sizeof</span>(tmp_cid_name));</div><div class="line"><a name="l07838"></a><span class="lineno"> 7838</span>&#160;         cid_name = tmp_cid_name;</div><div class="line"><a name="l07839"></a><span class="lineno"> 7839</span>&#160;      }</div><div class="line"><a name="l07840"></a><span class="lineno"> 7840</span>&#160;   }</div><div class="line"><a name="l07841"></a><span class="lineno"> 7841</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(dialed);</div><div class="line"><a name="l07842"></a><span class="lineno"> 7842</span>&#160;</div><div class="line"><a name="l07843"></a><span class="lineno"> 7843</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cid_num) || !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cid_name)) {</div><div class="line"><a name="l07844"></a><span class="lineno"> 7844</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../dc/d9e/structast__party__connected__line.html">ast_party_connected_line</a> connected;</div><div class="line"><a name="l07845"></a><span class="lineno"> 7845</span>&#160;</div><div class="line"><a name="l07846"></a><span class="lineno"> 7846</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l07847"></a><span class="lineno"> 7847</span>&#160;<span class="comment">       * It seems strange to set the CallerID on an outgoing call leg</span></div><div class="line"><a name="l07848"></a><span class="lineno"> 7848</span>&#160;<span class="comment">       * to whom we are calling, but this function&#39;s callers are doing</span></div><div class="line"><a name="l07849"></a><span class="lineno"> 7849</span>&#160;<span class="comment">       * various Originate methods.  This call leg goes to the local</span></div><div class="line"><a name="l07850"></a><span class="lineno"> 7850</span>&#160;<span class="comment">       * user.  Once the called party answers, the dialplan needs to</span></div><div class="line"><a name="l07851"></a><span class="lineno"> 7851</span>&#160;<span class="comment">       * be able to access the CallerID from the CALLERID function as</span></div><div class="line"><a name="l07852"></a><span class="lineno"> 7852</span>&#160;<span class="comment">       * if the called party had placed this call.</span></div><div class="line"><a name="l07853"></a><span class="lineno"> 7853</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l07854"></a><span class="lineno"> 7854</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a88d833a56ea7de33e230281c5c12b75d">ast_set_callerid</a>(dialed, cid_num, cid_name, cid_num);</div><div class="line"><a name="l07855"></a><span class="lineno"> 7855</span>&#160;</div><div class="line"><a name="l07856"></a><span class="lineno"> 7856</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ade95e66d7c53181894de1d3569aee2b8">ast_party_connected_line_set_init</a>(&amp;connected, <a class="code" href="../../d5/d7b/channel_8h.html#a10f23f1907b804485f62973f66cd9aef">ast_channel_connected</a>(dialed));</div><div class="line"><a name="l07857"></a><span class="lineno"> 7857</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cid_num)) {</div><div class="line"><a name="l07858"></a><span class="lineno"> 7858</span>&#160;         connected.<a class="code" href="../../dc/d9e/structast__party__connected__line.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">valid</a> = 1;</div><div class="line"><a name="l07859"></a><span class="lineno"> 7859</span>&#160;         connected.<a class="code" href="../../dc/d9e/structast__party__connected__line.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = (<span class="keywordtype">char</span> *) cid_num;</div><div class="line"><a name="l07860"></a><span class="lineno"> 7860</span>&#160;         connected.<a class="code" href="../../dc/d9e/structast__party__connected__line.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#a3df9119032baa1743f2db71344bd7cac">presentation</a> = <a class="code" href="../../de/d47/callerid_8h.html#af01ad9e215f9e9941b68f1ff1559d409">AST_PRES_ALLOWED_USER_NUMBER_NOT_SCREENED</a>;</div><div class="line"><a name="l07861"></a><span class="lineno"> 7861</span>&#160;      }</div><div class="line"><a name="l07862"></a><span class="lineno"> 7862</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cid_name)) {</div><div class="line"><a name="l07863"></a><span class="lineno"> 7863</span>&#160;         connected.<a class="code" href="../../dc/d9e/structast__party__connected__line.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">valid</a> = 1;</div><div class="line"><a name="l07864"></a><span class="lineno"> 7864</span>&#160;         connected.<a class="code" href="../../dc/d9e/structast__party__connected__line.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = (<span class="keywordtype">char</span> *) cid_name;</div><div class="line"><a name="l07865"></a><span class="lineno"> 7865</span>&#160;         connected.<a class="code" href="../../dc/d9e/structast__party__connected__line.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#a3df9119032baa1743f2db71344bd7cac">presentation</a> = <a class="code" href="../../de/d47/callerid_8h.html#af01ad9e215f9e9941b68f1ff1559d409">AST_PRES_ALLOWED_USER_NUMBER_NOT_SCREENED</a>;</div><div class="line"><a name="l07866"></a><span class="lineno"> 7866</span>&#160;      }</div><div class="line"><a name="l07867"></a><span class="lineno"> 7867</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a388b1ab04ed52109917914ac73662d0a">ast_channel_set_connected_line</a>(dialed, &amp;connected, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l07868"></a><span class="lineno"> 7868</span>&#160;   }</div><div class="line"><a name="l07869"></a><span class="lineno"> 7869</span>&#160;</div><div class="line"><a name="l07870"></a><span class="lineno"> 7870</span>&#160;   <span class="keywordflow">if</span> (early_media) {</div><div class="line"><a name="l07871"></a><span class="lineno"> 7871</span>&#160;      <a class="code" href="../../df/dcf/dial_8h.html#a2674932599e61fe027364a09f6d68c4e">ast_dial_set_state_callback</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial, <a class="code" href="../../db/d94/pbx_8c.html#a00f40129528e1bb08c291ddf96075f9e">pbx_outgoing_state_callback</a>);</div><div class="line"><a name="l07872"></a><span class="lineno"> 7872</span>&#160;   }</div><div class="line"><a name="l07873"></a><span class="lineno"> 7873</span>&#160;</div><div class="line"><a name="l07874"></a><span class="lineno"> 7874</span>&#160;   <span class="keywordflow">if</span> (locked_channel) {</div><div class="line"><a name="l07875"></a><span class="lineno"> 7875</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l07876"></a><span class="lineno"> 7876</span>&#160;<span class="comment">       * Keep a dialed channel ref since the caller wants</span></div><div class="line"><a name="l07877"></a><span class="lineno"> 7877</span>&#160;<span class="comment">       * the channel returned.  We must get the ref before</span></div><div class="line"><a name="l07878"></a><span class="lineno"> 7878</span>&#160;<span class="comment">       * spawning off pbx_outgoing_exec().</span></div><div class="line"><a name="l07879"></a><span class="lineno"> 7879</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l07880"></a><span class="lineno"> 7880</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a>(dialed);</div><div class="line"><a name="l07881"></a><span class="lineno"> 7881</span>&#160;      <span class="keywordflow">if</span> (!synchronous) {</div><div class="line"><a name="l07882"></a><span class="lineno"> 7882</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l07883"></a><span class="lineno"> 7883</span>&#160;<span class="comment">          * Lock it now to hold off pbx_outgoing_exec() in case the</span></div><div class="line"><a name="l07884"></a><span class="lineno"> 7884</span>&#160;<span class="comment">          * calling function needs the channel state/snapshot before</span></div><div class="line"><a name="l07885"></a><span class="lineno"> 7885</span>&#160;<span class="comment">          * dialing actually happens.</span></div><div class="line"><a name="l07886"></a><span class="lineno"> 7886</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l07887"></a><span class="lineno"> 7887</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(dialed);</div><div class="line"><a name="l07888"></a><span class="lineno"> 7888</span>&#160;      }</div><div class="line"><a name="l07889"></a><span class="lineno"> 7889</span>&#160;   }</div><div class="line"><a name="l07890"></a><span class="lineno"> 7890</span>&#160;</div><div class="line"><a name="l07891"></a><span class="lineno"> 7891</span>&#160;   <span class="comment">/* This extra reference is dereferenced by pbx_outgoing_exec */</span></div><div class="line"><a name="l07892"></a><span class="lineno"> 7892</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>, +1);</div><div class="line"><a name="l07893"></a><span class="lineno"> 7893</span>&#160;</div><div class="line"><a name="l07894"></a><span class="lineno"> 7894</span>&#160;   <span class="keywordflow">if</span> (synchronous == <a class="code" href="../../db/de0/pbx_8h.html#a24a619e5cc5e3f683322295991c57916ad1f109b734f3cb4d20937f283eb98d69">AST_OUTGOING_WAIT_COMPLETE</a>) {</div><div class="line"><a name="l07895"></a><span class="lineno"> 7895</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l07896"></a><span class="lineno"> 7896</span>&#160;<span class="comment">       * Because we are waiting until this is complete anyway, there is no</span></div><div class="line"><a name="l07897"></a><span class="lineno"> 7897</span>&#160;<span class="comment">       * sense in creating another thread that we will just need to wait</span></div><div class="line"><a name="l07898"></a><span class="lineno"> 7898</span>&#160;<span class="comment">       * for, so instead we commandeer the current thread.</span></div><div class="line"><a name="l07899"></a><span class="lineno"> 7899</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l07900"></a><span class="lineno"> 7900</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ac8e8f73ccf4ba3fdbc519bc9c0027e4f">pbx_outgoing_exec</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>);</div><div class="line"><a name="l07901"></a><span class="lineno"> 7901</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l07902"></a><span class="lineno"> 7902</span>&#160;      <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;in_separate_thread = 1;</div><div class="line"><a name="l07903"></a><span class="lineno"> 7903</span>&#160;</div><div class="line"><a name="l07904"></a><span class="lineno"> 7904</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;thread, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d94/pbx_8c.html#ac8e8f73ccf4ba3fdbc519bc9c0027e4f">pbx_outgoing_exec</a>, <a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>)) {</div><div class="line"><a name="l07905"></a><span class="lineno"> 7905</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to spawn dialing thread for &#39;%s/%s&#39;\n&quot;</span>, type, addr);</div><div class="line"><a name="l07906"></a><span class="lineno"> 7906</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>, -1);</div><div class="line"><a name="l07907"></a><span class="lineno"> 7907</span>&#160;         <span class="keywordflow">if</span> (locked_channel) {</div><div class="line"><a name="l07908"></a><span class="lineno"> 7908</span>&#160;            <span class="keywordflow">if</span> (!synchronous) {</div><div class="line"><a name="l07909"></a><span class="lineno"> 7909</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(dialed);</div><div class="line"><a name="l07910"></a><span class="lineno"> 7910</span>&#160;            }</div><div class="line"><a name="l07911"></a><span class="lineno"> 7911</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(dialed);</div><div class="line"><a name="l07912"></a><span class="lineno"> 7912</span>&#160;         }</div><div class="line"><a name="l07913"></a><span class="lineno"> 7913</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07914"></a><span class="lineno"> 7914</span>&#160;      }</div><div class="line"><a name="l07915"></a><span class="lineno"> 7915</span>&#160;</div><div class="line"><a name="l07916"></a><span class="lineno"> 7916</span>&#160;      <span class="keywordflow">if</span> (synchronous) {</div><div class="line"><a name="l07917"></a><span class="lineno"> 7917</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>);</div><div class="line"><a name="l07918"></a><span class="lineno"> 7918</span>&#160;         <span class="comment">/* Wait for dialing to complete */</span></div><div class="line"><a name="l07919"></a><span class="lineno"> 7919</span>&#160;         <span class="keywordflow">while</span> (!<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dialed) {</div><div class="line"><a name="l07920"></a><span class="lineno"> 7920</span>&#160;            <a class="code" href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a>(&amp;<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;cond, <a class="code" href="../../d5/da5/astobj2_8h.html#a503b6c7ced96f9b56ec59c115cbeb29a">ao2_object_get_lockaddr</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>));</div><div class="line"><a name="l07921"></a><span class="lineno"> 7921</span>&#160;         }</div><div class="line"><a name="l07922"></a><span class="lineno"> 7922</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>);</div><div class="line"><a name="l07923"></a><span class="lineno"> 7923</span>&#160;      }</div><div class="line"><a name="l07924"></a><span class="lineno"> 7924</span>&#160;   }</div><div class="line"><a name="l07925"></a><span class="lineno"> 7925</span>&#160;</div><div class="line"><a name="l07926"></a><span class="lineno"> 7926</span>&#160;   <span class="keywordflow">if</span> (synchronous) {</div><div class="line"><a name="l07927"></a><span class="lineno"> 7927</span>&#160;      <span class="comment">/* Determine the outcome of the dialing attempt up to it being answered. */</span></div><div class="line"><a name="l07928"></a><span class="lineno"> 7928</span>&#160;      <span class="keywordflow">if</span> (reason) {</div><div class="line"><a name="l07929"></a><span class="lineno"> 7929</span>&#160;         *reason = <a class="code" href="../../db/d94/pbx_8c.html#a0bf66af78336396b8c8336830130d93b">pbx_dial_reason</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial_res,</div><div class="line"><a name="l07930"></a><span class="lineno"> 7930</span>&#160;            <a class="code" href="../../df/dcf/dial_8h.html#a9467ca6247764d86e2365ab9bbc68c35">ast_dial_reason</a>(<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial, 0));</div><div class="line"><a name="l07931"></a><span class="lineno"> 7931</span>&#160;      }</div><div class="line"><a name="l07932"></a><span class="lineno"> 7932</span>&#160;</div><div class="line"><a name="l07933"></a><span class="lineno"> 7933</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/dcd/structoutgoing.html">outgoing</a>-&gt;dial_res != <a class="code" href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847a4a8c0d54e6071d1e9a36adae685406d3">AST_DIAL_RESULT_ANSWERED</a>) {</div><div class="line"><a name="l07934"></a><span class="lineno"> 7934</span>&#160;         <span class="comment">/* The dial operation failed. */</span></div><div class="line"><a name="l07935"></a><span class="lineno"> 7935</span>&#160;         <span class="keywordflow">if</span> (locked_channel) {</div><div class="line"><a name="l07936"></a><span class="lineno"> 7936</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(dialed);</div><div class="line"><a name="l07937"></a><span class="lineno"> 7937</span>&#160;         }</div><div class="line"><a name="l07938"></a><span class="lineno"> 7938</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l07939"></a><span class="lineno"> 7939</span>&#160;      }</div><div class="line"><a name="l07940"></a><span class="lineno"> 7940</span>&#160;      <span class="keywordflow">if</span> (locked_channel) {</div><div class="line"><a name="l07941"></a><span class="lineno"> 7941</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(dialed);</div><div class="line"><a name="l07942"></a><span class="lineno"> 7942</span>&#160;      }</div><div class="line"><a name="l07943"></a><span class="lineno"> 7943</span>&#160;   }</div><div class="line"><a name="l07944"></a><span class="lineno"> 7944</span>&#160;</div><div class="line"><a name="l07945"></a><span class="lineno"> 7945</span>&#160;   <span class="keywordflow">if</span> (locked_channel) {</div><div class="line"><a name="l07946"></a><span class="lineno"> 7946</span>&#160;      *locked_channel = dialed;</div><div class="line"><a name="l07947"></a><span class="lineno"> 7947</span>&#160;   }</div><div class="line"><a name="l07948"></a><span class="lineno"> 7948</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l07949"></a><span class="lineno"> 7949</span>&#160;}</div><div class="line"><a name="l07950"></a><span class="lineno"> 7950</span>&#160;</div><div class="line"><a name="l07951"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a6c3a35983760904213206a8f0a7df9c9"> 7951</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a6c3a35983760904213206a8f0a7df9c9">ast_pbx_outgoing_exten</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">struct</span> <a class="code" href="../../d8/d69/structast__format__cap.html">ast_format_cap</a> *cap, <span class="keyword">const</span> <span class="keywordtype">char</span> *addr,</div><div class="line"><a name="l07952"></a><span class="lineno"> 7952</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority, <span class="keywordtype">int</span> *reason,</div><div class="line"><a name="l07953"></a><span class="lineno"> 7953</span>&#160;   <span class="keywordtype">int</span> synchronous, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *vars,</div><div class="line"><a name="l07954"></a><span class="lineno"> 7954</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *account, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> **locked_channel, <span class="keywordtype">int</span> early_media,</div><div class="line"><a name="l07955"></a><span class="lineno"> 7955</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../da/de5/structast__assigned__ids.html">ast_assigned_ids</a> *assignedids)</div><div class="line"><a name="l07956"></a><span class="lineno"> 7956</span>&#160;{</div><div class="line"><a name="l07957"></a><span class="lineno"> 7957</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a0c27e04a09684e80f2a49fc4c4820fd0">ast_pbx_outgoing_exten_predial</a>(type, cap, addr, timeout, context, exten, priority, reason,</div><div class="line"><a name="l07958"></a><span class="lineno"> 7958</span>&#160;      synchronous, cid_num, cid_name, vars, account, locked_channel, early_media, assignedids, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l07959"></a><span class="lineno"> 7959</span>&#160;}</div><div class="line"><a name="l07960"></a><span class="lineno"> 7960</span>&#160;</div><div class="line"><a name="l07961"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a0c27e04a09684e80f2a49fc4c4820fd0"> 7961</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a0c27e04a09684e80f2a49fc4c4820fd0">ast_pbx_outgoing_exten_predial</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">struct</span> <a class="code" href="../../d8/d69/structast__format__cap.html">ast_format_cap</a> *cap, <span class="keyword">const</span> <span class="keywordtype">char</span> *addr,</div><div class="line"><a name="l07962"></a><span class="lineno"> 7962</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority, <span class="keywordtype">int</span> *reason,</div><div class="line"><a name="l07963"></a><span class="lineno"> 7963</span>&#160;   <span class="keywordtype">int</span> synchronous, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *vars,</div><div class="line"><a name="l07964"></a><span class="lineno"> 7964</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *account, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> **locked_channel, <span class="keywordtype">int</span> early_media,</div><div class="line"><a name="l07965"></a><span class="lineno"> 7965</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../da/de5/structast__assigned__ids.html">ast_assigned_ids</a> *assignedids, <span class="keyword">const</span> <span class="keywordtype">char</span> *predial_callee)</div><div class="line"><a name="l07966"></a><span class="lineno"> 7966</span>&#160;{</div><div class="line"><a name="l07967"></a><span class="lineno"> 7967</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l07968"></a><span class="lineno"> 7968</span>&#160;   <span class="keywordtype">int</span> my_reason;</div><div class="line"><a name="l07969"></a><span class="lineno"> 7969</span>&#160;</div><div class="line"><a name="l07970"></a><span class="lineno"> 7970</span>&#160;   <span class="keywordflow">if</span> (!reason) {</div><div class="line"><a name="l07971"></a><span class="lineno"> 7971</span>&#160;      reason = &amp;my_reason;</div><div class="line"><a name="l07972"></a><span class="lineno"> 7972</span>&#160;   }</div><div class="line"><a name="l07973"></a><span class="lineno"> 7973</span>&#160;   *reason = 0;</div><div class="line"><a name="l07974"></a><span class="lineno"> 7974</span>&#160;   <span class="keywordflow">if</span> (locked_channel) {</div><div class="line"><a name="l07975"></a><span class="lineno"> 7975</span>&#160;      *locked_channel = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l07976"></a><span class="lineno"> 7976</span>&#160;   }</div><div class="line"><a name="l07977"></a><span class="lineno"> 7977</span>&#160;</div><div class="line"><a name="l07978"></a><span class="lineno"> 7978</span>&#160;   res = <a class="code" href="../../db/d94/pbx_8c.html#a9582d9da72e4e799183a50e4ddc90a94">pbx_outgoing_attempt</a>(type, cap, addr, timeout, context, exten, priority,</div><div class="line"><a name="l07979"></a><span class="lineno"> 7979</span>&#160;      <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, reason, synchronous, cid_num, cid_name, vars, account, locked_channel,</div><div class="line"><a name="l07980"></a><span class="lineno"> 7980</span>&#160;      early_media, assignedids, predial_callee);</div><div class="line"><a name="l07981"></a><span class="lineno"> 7981</span>&#160;</div><div class="line"><a name="l07982"></a><span class="lineno"> 7982</span>&#160;   <span class="keywordflow">if</span> (res &lt; 0 <span class="comment">/* Call failed to get connected for some reason. */</span></div><div class="line"><a name="l07983"></a><span class="lineno"> 7983</span>&#160;      &amp;&amp; 0 &lt; synchronous</div><div class="line"><a name="l07984"></a><span class="lineno"> 7984</span>&#160;      &amp;&amp; <a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, <span class="stringliteral">&quot;failed&quot;</span>, 1, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l07985"></a><span class="lineno"> 7985</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *failed;</div><div class="line"><a name="l07986"></a><span class="lineno"> 7986</span>&#160;</div><div class="line"><a name="l07987"></a><span class="lineno"> 7987</span>&#160;      <span class="comment">/* We do not have to worry about a locked_channel if dialing failed. */</span></div><div class="line"><a name="l07988"></a><span class="lineno"> 7988</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(!locked_channel || !*locked_channel);</div><div class="line"><a name="l07989"></a><span class="lineno"> 7989</span>&#160;<span class="comment"></span></div><div class="line"><a name="l07990"></a><span class="lineno"> 7990</span>&#160;<span class="comment">      /*!</span></div><div class="line"><a name="l07991"></a><span class="lineno"> 7991</span>&#160;<span class="comment">       * \todo XXX Not good.  The channel name is not unique if more than</span></div><div class="line"><a name="l07992"></a><span class="lineno"> 7992</span>&#160;<span class="comment">       * one originate fails at a time.</span></div><div class="line"><a name="l07993"></a><span class="lineno"> 7993</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l07994"></a><span class="lineno"> 7994</span>&#160;      failed = <a class="code" href="../../d5/d7b/channel_8h.html#a2f18aafad0442206e71033ac6676dbb5">ast_channel_alloc</a>(0, <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>, cid_num, cid_name, account,</div><div class="line"><a name="l07995"></a><span class="lineno"> 7995</span>&#160;         <span class="stringliteral">&quot;failed&quot;</span>, context, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <span class="stringliteral">&quot;OutgoingSpoolFailed&quot;</span>);</div><div class="line"><a name="l07996"></a><span class="lineno"> 7996</span>&#160;      <span class="keywordflow">if</span> (failed) {</div><div class="line"><a name="l07997"></a><span class="lineno"> 7997</span>&#160;         <span class="keywordtype">char</span> failed_reason[12];</div><div class="line"><a name="l07998"></a><span class="lineno"> 7998</span>&#160;</div><div class="line"><a name="l07999"></a><span class="lineno"> 7999</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a5b14bfe21364dd8f73d45f15cf313524">ast_set_variables</a>(failed, vars);</div><div class="line"><a name="l08000"></a><span class="lineno"> 8000</span>&#160;         snprintf(failed_reason, <span class="keyword">sizeof</span>(failed_reason), <span class="stringliteral">&quot;%d&quot;</span>, *reason);</div><div class="line"><a name="l08001"></a><span class="lineno"> 8001</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(failed, <span class="stringliteral">&quot;REASON&quot;</span>, failed_reason);</div><div class="line"><a name="l08002"></a><span class="lineno"> 8002</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(failed);</div><div class="line"><a name="l08003"></a><span class="lineno"> 8003</span>&#160;</div><div class="line"><a name="l08004"></a><span class="lineno"> 8004</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a44b6406c9220f7f2b610ac712369f405">ast_pbx_run</a>(failed)) {</div><div class="line"><a name="l08005"></a><span class="lineno"> 8005</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to run PBX on &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l08006"></a><span class="lineno"> 8006</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(failed));</div><div class="line"><a name="l08007"></a><span class="lineno"> 8007</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(failed);</div><div class="line"><a name="l08008"></a><span class="lineno"> 8008</span>&#160;         }</div><div class="line"><a name="l08009"></a><span class="lineno"> 8009</span>&#160;      }</div><div class="line"><a name="l08010"></a><span class="lineno"> 8010</span>&#160;   }</div><div class="line"><a name="l08011"></a><span class="lineno"> 8011</span>&#160;</div><div class="line"><a name="l08012"></a><span class="lineno"> 8012</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l08013"></a><span class="lineno"> 8013</span>&#160;}</div><div class="line"><a name="l08014"></a><span class="lineno"> 8014</span>&#160;</div><div class="line"><a name="l08015"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a2afffb175879297ed07ec21df02fa6dc"> 8015</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a2afffb175879297ed07ec21df02fa6dc">ast_pbx_outgoing_app</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">struct</span> <a class="code" href="../../d8/d69/structast__format__cap.html">ast_format_cap</a> *cap, <span class="keyword">const</span> <span class="keywordtype">char</span> *addr,</div><div class="line"><a name="l08016"></a><span class="lineno"> 8016</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *appdata, <span class="keywordtype">int</span> *reason, <span class="keywordtype">int</span> synchronous,</div><div class="line"><a name="l08017"></a><span class="lineno"> 8017</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *vars,</div><div class="line"><a name="l08018"></a><span class="lineno"> 8018</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *account, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> **locked_channel,</div><div class="line"><a name="l08019"></a><span class="lineno"> 8019</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../da/de5/structast__assigned__ids.html">ast_assigned_ids</a> *assignedids)</div><div class="line"><a name="l08020"></a><span class="lineno"> 8020</span>&#160;{</div><div class="line"><a name="l08021"></a><span class="lineno"> 8021</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a251d9b38cd3fe1bd5ec39bf0b1c3b65f">ast_pbx_outgoing_app_predial</a>(type, cap, addr, timeout, app, appdata, reason, synchronous,</div><div class="line"><a name="l08022"></a><span class="lineno"> 8022</span>&#160;      cid_num, cid_name, vars, account, locked_channel, assignedids, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l08023"></a><span class="lineno"> 8023</span>&#160;}</div><div class="line"><a name="l08024"></a><span class="lineno"> 8024</span>&#160;</div><div class="line"><a name="l08025"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a251d9b38cd3fe1bd5ec39bf0b1c3b65f"> 8025</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a251d9b38cd3fe1bd5ec39bf0b1c3b65f">ast_pbx_outgoing_app_predial</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">struct</span> <a class="code" href="../../d8/d69/structast__format__cap.html">ast_format_cap</a> *cap, <span class="keyword">const</span> <span class="keywordtype">char</span> *addr,</div><div class="line"><a name="l08026"></a><span class="lineno"> 8026</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *appdata, <span class="keywordtype">int</span> *reason, <span class="keywordtype">int</span> synchronous,</div><div class="line"><a name="l08027"></a><span class="lineno"> 8027</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *vars,</div><div class="line"><a name="l08028"></a><span class="lineno"> 8028</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *account, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> **locked_channel,</div><div class="line"><a name="l08029"></a><span class="lineno"> 8029</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../da/de5/structast__assigned__ids.html">ast_assigned_ids</a> *assignedids, <span class="keyword">const</span> <span class="keywordtype">char</span> *predial_callee)</div><div class="line"><a name="l08030"></a><span class="lineno"> 8030</span>&#160;{</div><div class="line"><a name="l08031"></a><span class="lineno"> 8031</span>&#160;   <span class="keywordflow">if</span> (reason) {</div><div class="line"><a name="l08032"></a><span class="lineno"> 8032</span>&#160;      *reason = 0;</div><div class="line"><a name="l08033"></a><span class="lineno"> 8033</span>&#160;   }</div><div class="line"><a name="l08034"></a><span class="lineno"> 8034</span>&#160;   <span class="keywordflow">if</span> (locked_channel) {</div><div class="line"><a name="l08035"></a><span class="lineno"> 8035</span>&#160;      *locked_channel = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08036"></a><span class="lineno"> 8036</span>&#160;   }</div><div class="line"><a name="l08037"></a><span class="lineno"> 8037</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(app)) {</div><div class="line"><a name="l08038"></a><span class="lineno"> 8038</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l08039"></a><span class="lineno"> 8039</span>&#160;   }</div><div class="line"><a name="l08040"></a><span class="lineno"> 8040</span>&#160;</div><div class="line"><a name="l08041"></a><span class="lineno"> 8041</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a9582d9da72e4e799183a50e4ddc90a94">pbx_outgoing_attempt</a>(type, cap, addr, timeout, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, app, appdata,</div><div class="line"><a name="l08042"></a><span class="lineno"> 8042</span>&#160;      reason, synchronous, cid_num, cid_name, vars, account, locked_channel, 0,</div><div class="line"><a name="l08043"></a><span class="lineno"> 8043</span>&#160;      assignedids, predial_callee);</div><div class="line"><a name="l08044"></a><span class="lineno"> 8044</span>&#160;}</div><div class="line"><a name="l08045"></a><span class="lineno"> 8045</span>&#160;</div><div class="line"><a name="l08046"></a><span class="lineno"> 8046</span>&#160;<span class="comment">/* this is the guts of destroying a context --</span></div><div class="line"><a name="l08047"></a><span class="lineno"> 8047</span>&#160;<span class="comment">   freeing up the structure, traversing and destroying the</span></div><div class="line"><a name="l08048"></a><span class="lineno"> 8048</span>&#160;<span class="comment">   extensions, switches, ignorepats, includes, etc. etc. */</span></div><div class="line"><a name="l08049"></a><span class="lineno"> 8049</span>&#160;</div><div class="line"><a name="l08050"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#af51adb9b78f628397d7b0c1781b6d79e"> 8050</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#af51adb9b78f628397d7b0c1781b6d79e">__ast_internal_context_destroy</a>( <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con)</div><div class="line"><a name="l08051"></a><span class="lineno"> 8051</span>&#160;{</div><div class="line"><a name="l08052"></a><span class="lineno"> 8052</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e, *<a class="code" href="../../d5/d03/asterisk_8c.html#a617d1486ee651b4c894d02e1fe68fe04">el</a>, *en;</div><div class="line"><a name="l08053"></a><span class="lineno"> 8053</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a> = con;</div><div class="line"><a name="l08054"></a><span class="lineno"> 8054</span>&#160;</div><div class="line"><a name="l08055"></a><span class="lineno"> 8055</span>&#160;   <span class="comment">/* Free includes */</span></div><div class="line"><a name="l08056"></a><span class="lineno"> 8056</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#aeb9853664dde8a7df8bc7ea180d73d54">AST_VECTOR_CALLBACK_VOID</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">includes</a>, <a class="code" href="../../d6/d0e/pbx__include_8c.html#a074a4f22541e1231de75d69e37fc4adf">include_free</a>);</div><div class="line"><a name="l08057"></a><span class="lineno"> 8057</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">includes</a>);</div><div class="line"><a name="l08058"></a><span class="lineno"> 8058</span>&#160;</div><div class="line"><a name="l08059"></a><span class="lineno"> 8059</span>&#160;   <span class="comment">/* Free ignorepats */</span></div><div class="line"><a name="l08060"></a><span class="lineno"> 8060</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#aeb9853664dde8a7df8bc7ea180d73d54">AST_VECTOR_CALLBACK_VOID</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">ignorepats</a>, <a class="code" href="../../d9/d63/pbx__ignorepat_8c.html#ab3503fb9ba3b0c046a2d1a2a482e8ae1">ignorepat_free</a>);</div><div class="line"><a name="l08061"></a><span class="lineno"> 8061</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">ignorepats</a>);</div><div class="line"><a name="l08062"></a><span class="lineno"> 8062</span>&#160;</div><div class="line"><a name="l08063"></a><span class="lineno"> 8063</span>&#160;   <span class="comment">/* Free switches */</span></div><div class="line"><a name="l08064"></a><span class="lineno"> 8064</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#aeb9853664dde8a7df8bc7ea180d73d54">AST_VECTOR_CALLBACK_VOID</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">alts</a>, <a class="code" href="../../d9/da0/pbx__private_8h.html#acd29668e92f96d142fe8d058db4ed773">sw_free</a>);</div><div class="line"><a name="l08065"></a><span class="lineno"> 8065</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">alts</a>);</div><div class="line"><a name="l08066"></a><span class="lineno"> 8066</span>&#160;</div><div class="line"><a name="l08067"></a><span class="lineno"> 8067</span>&#160;   <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>)</div><div class="line"><a name="l08068"></a><span class="lineno"> 8068</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l08069"></a><span class="lineno"> 8069</span>&#160;</div><div class="line"><a name="l08070"></a><span class="lineno"> 8070</span>&#160;   <span class="comment">/* destroy the hash tabs */</span></div><div class="line"><a name="l08071"></a><span class="lineno"> 8071</span>&#160;   <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>) {</div><div class="line"><a name="l08072"></a><span class="lineno"> 8072</span>&#160;      <a class="code" href="../../d6/da0/hashtab_8h.html#a6103589badf8d9440a0cece2802c4c3a">ast_hashtab_destroy</a>(tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, 0);</div><div class="line"><a name="l08073"></a><span class="lineno"> 8073</span>&#160;   }</div><div class="line"><a name="l08074"></a><span class="lineno"> 8074</span>&#160;   <span class="comment">/* and destroy the pattern tree */</span></div><div class="line"><a name="l08075"></a><span class="lineno"> 8075</span>&#160;   <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>)</div><div class="line"><a name="l08076"></a><span class="lineno"> 8076</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a3900cc7c8183ab6a7316f5dbc2b955ed">destroy_pattern_tree</a>(tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>);</div><div class="line"><a name="l08077"></a><span class="lineno"> 8077</span>&#160;</div><div class="line"><a name="l08078"></a><span class="lineno"> 8078</span>&#160;   <span class="keywordflow">for</span> (e = tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a>; e;) {</div><div class="line"><a name="l08079"></a><span class="lineno"> 8079</span>&#160;      <span class="keywordflow">for</span> (en = e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>; en;) {</div><div class="line"><a name="l08080"></a><span class="lineno"> 8080</span>&#160;         el = en;</div><div class="line"><a name="l08081"></a><span class="lineno"> 8081</span>&#160;         en = en-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a>;</div><div class="line"><a name="l08082"></a><span class="lineno"> 8082</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#ae25a2122becbf9b94f5d55bc86753fea">destroy_exten</a>(el);</div><div class="line"><a name="l08083"></a><span class="lineno"> 8083</span>&#160;      }</div><div class="line"><a name="l08084"></a><span class="lineno"> 8084</span>&#160;      el = e;</div><div class="line"><a name="l08085"></a><span class="lineno"> 8085</span>&#160;      e = e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;</div><div class="line"><a name="l08086"></a><span class="lineno"> 8086</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae25a2122becbf9b94f5d55bc86753fea">destroy_exten</a>(el);</div><div class="line"><a name="l08087"></a><span class="lineno"> 8087</span>&#160;   }</div><div class="line"><a name="l08088"></a><span class="lineno"> 8088</span>&#160;   tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08089"></a><span class="lineno"> 8089</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab1d35b9611e8b5143ec695ead1b5d8d1">ast_rwlock_destroy</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ace4e0066a5b24f84b90536e9906619f6">lock</a>);</div><div class="line"><a name="l08090"></a><span class="lineno"> 8090</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a34eb63008d294b713376e64bb2a7b2ef">macrolock</a>);</div><div class="line"><a name="l08091"></a><span class="lineno"> 8091</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmp);</div><div class="line"><a name="l08092"></a><span class="lineno"> 8092</span>&#160;}</div><div class="line"><a name="l08093"></a><span class="lineno"> 8093</span>&#160;</div><div class="line"><a name="l08094"></a><span class="lineno"> 8094</span>&#160;</div><div class="line"><a name="l08095"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a06e285124697319566d67b82c25aba19"> 8095</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a06e285124697319566d67b82c25aba19">__ast_context_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *list, <span class="keyword">struct</span> <a class="code" href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a> *contexttab, <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l08096"></a><span class="lineno"> 8096</span>&#160;{</div><div class="line"><a name="l08097"></a><span class="lineno"> 8097</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>, *tmpl=<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08098"></a><span class="lineno"> 8098</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *exten_item, *prio_item;</div><div class="line"><a name="l08099"></a><span class="lineno"> 8099</span>&#160;</div><div class="line"><a name="l08100"></a><span class="lineno"> 8100</span>&#160;   <span class="keywordflow">for</span> (tmp = list; <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>; ) {</div><div class="line"><a name="l08101"></a><span class="lineno"> 8101</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* next starting point */</span></div><div class="line"><a name="l08102"></a><span class="lineno"> 8102</span>&#160;         <span class="comment">/* The following code used to skip forward to the next</span></div><div class="line"><a name="l08103"></a><span class="lineno"> 8103</span>&#160;<span class="comment">            context with matching registrar, but this didn&#39;t</span></div><div class="line"><a name="l08104"></a><span class="lineno"> 8104</span>&#160;<span class="comment">            make sense; individual priorities registrar&#39;d to</span></div><div class="line"><a name="l08105"></a><span class="lineno"> 8105</span>&#160;<span class="comment">            the matching registrar could occur in any context! */</span></div><div class="line"><a name="l08106"></a><span class="lineno"> 8106</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Investigate ctx %s %s\n&quot;</span>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l08107"></a><span class="lineno"> 8107</span>&#160;      <span class="keywordflow">if</span> (con) {</div><div class="line"><a name="l08108"></a><span class="lineno"> 8108</span>&#160;         <span class="keywordflow">for</span> (; <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>; tmpl = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>, tmp = tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a>) { <span class="comment">/* skip to the matching context */</span></div><div class="line"><a name="l08109"></a><span class="lineno"> 8109</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;check ctx %s %s\n&quot;</span>, tmp-&gt;name, tmp-&gt;registrar);</div><div class="line"><a name="l08110"></a><span class="lineno"> 8110</span>&#160;            <span class="keywordflow">if</span> ( !strcasecmp(tmp-&gt;name, con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>) ) {</div><div class="line"><a name="l08111"></a><span class="lineno"> 8111</span>&#160;               <span class="keywordflow">break</span>;   <span class="comment">/* found it */</span></div><div class="line"><a name="l08112"></a><span class="lineno"> 8112</span>&#160;            }</div><div class="line"><a name="l08113"></a><span class="lineno"> 8113</span>&#160;         }</div><div class="line"><a name="l08114"></a><span class="lineno"> 8114</span>&#160;      }</div><div class="line"><a name="l08115"></a><span class="lineno"> 8115</span>&#160;</div><div class="line"><a name="l08116"></a><span class="lineno"> 8116</span>&#160;      <span class="keywordflow">if</span> (!tmp)   <span class="comment">/* not found, we are done */</span></div><div class="line"><a name="l08117"></a><span class="lineno"> 8117</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l08118"></a><span class="lineno"> 8118</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a>(tmp);</div><div class="line"><a name="l08119"></a><span class="lineno"> 8119</span>&#160;</div><div class="line"><a name="l08120"></a><span class="lineno"> 8120</span>&#160;      <span class="keywordflow">if</span> (registrar) {</div><div class="line"><a name="l08121"></a><span class="lineno"> 8121</span>&#160;         <span class="comment">/* then search thru and remove any extens that match registrar. */</span></div><div class="line"><a name="l08122"></a><span class="lineno"> 8122</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d3/d2e/structast__hashtab__iter.html">ast_hashtab_iter</a> *exten_iter;</div><div class="line"><a name="l08123"></a><span class="lineno"> 8123</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d3/d2e/structast__hashtab__iter.html">ast_hashtab_iter</a> *prio_iter;</div><div class="line"><a name="l08124"></a><span class="lineno"> 8124</span>&#160;         <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l08125"></a><span class="lineno"> 8125</span>&#160;</div><div class="line"><a name="l08126"></a><span class="lineno"> 8126</span>&#160;         <span class="comment">/* remove any ignorepats whose registrar matches */</span></div><div class="line"><a name="l08127"></a><span class="lineno"> 8127</span>&#160;         <span class="keywordflow">for</span> (idx = <a class="code" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a>(tmp) - 1; idx &gt;= 0; idx--) {</div><div class="line"><a name="l08128"></a><span class="lineno"> 8128</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *ip = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">ignorepats</a>, idx);</div><div class="line"><a name="l08129"></a><span class="lineno"> 8129</span>&#160;</div><div class="line"><a name="l08130"></a><span class="lineno"> 8130</span>&#160;            <span class="keywordflow">if</span> (!strcmp(<a class="code" href="../../db/de0/pbx_8h.html#a8a6feb7cd8e08f18c9d0f4887d7f3d47">ast_get_ignorepat_registrar</a>(ip), registrar)) {</div><div class="line"><a name="l08131"></a><span class="lineno"> 8131</span>&#160;               <a class="code" href="../../d6/d68/vector_8h.html#a0414ce2ed1741b1e048ccafc0df420c3">AST_VECTOR_REMOVE_ORDERED</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">ignorepats</a>, idx);</div><div class="line"><a name="l08132"></a><span class="lineno"> 8132</span>&#160;               <a class="code" href="../../d9/d63/pbx__ignorepat_8c.html#ab3503fb9ba3b0c046a2d1a2a482e8ae1">ignorepat_free</a>(ip);</div><div class="line"><a name="l08133"></a><span class="lineno"> 8133</span>&#160;            }</div><div class="line"><a name="l08134"></a><span class="lineno"> 8134</span>&#160;         }</div><div class="line"><a name="l08135"></a><span class="lineno"> 8135</span>&#160;         <span class="comment">/* remove any includes whose registrar matches */</span></div><div class="line"><a name="l08136"></a><span class="lineno"> 8136</span>&#160;         <span class="keywordflow">for</span> (idx = <a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(tmp) - 1; idx &gt;= 0; idx--) {</div><div class="line"><a name="l08137"></a><span class="lineno"> 8137</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *i = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">includes</a>, idx);</div><div class="line"><a name="l08138"></a><span class="lineno"> 8138</span>&#160;</div><div class="line"><a name="l08139"></a><span class="lineno"> 8139</span>&#160;            <span class="keywordflow">if</span> (!strcmp(<a class="code" href="../../db/de0/pbx_8h.html#a2bf7469cd4b7de5d4de43d58aeff46c5">ast_get_include_registrar</a>(i), registrar)) {</div><div class="line"><a name="l08140"></a><span class="lineno"> 8140</span>&#160;               <a class="code" href="../../d6/d68/vector_8h.html#a0414ce2ed1741b1e048ccafc0df420c3">AST_VECTOR_REMOVE_ORDERED</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">includes</a>, idx);</div><div class="line"><a name="l08141"></a><span class="lineno"> 8141</span>&#160;               <a class="code" href="../../d6/d0e/pbx__include_8c.html#a074a4f22541e1231de75d69e37fc4adf">include_free</a>(i);</div><div class="line"><a name="l08142"></a><span class="lineno"> 8142</span>&#160;            }</div><div class="line"><a name="l08143"></a><span class="lineno"> 8143</span>&#160;         }</div><div class="line"><a name="l08144"></a><span class="lineno"> 8144</span>&#160;         <span class="comment">/* remove any switches whose registrar matches */</span></div><div class="line"><a name="l08145"></a><span class="lineno"> 8145</span>&#160;         <span class="keywordflow">for</span> (idx = <a class="code" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a>(tmp) - 1; idx &gt;= 0; idx--) {</div><div class="line"><a name="l08146"></a><span class="lineno"> 8146</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *sw = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">alts</a>, idx);</div><div class="line"><a name="l08147"></a><span class="lineno"> 8147</span>&#160;</div><div class="line"><a name="l08148"></a><span class="lineno"> 8148</span>&#160;            <span class="keywordflow">if</span> (!strcmp(<a class="code" href="../../db/de0/pbx_8h.html#a3d45d3b9bc79bf6ffb1540f3e815f677">ast_get_switch_registrar</a>(sw), registrar)) {</div><div class="line"><a name="l08149"></a><span class="lineno"> 8149</span>&#160;               <a class="code" href="../../d6/d68/vector_8h.html#a0414ce2ed1741b1e048ccafc0df420c3">AST_VECTOR_REMOVE_ORDERED</a>(&amp;tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">alts</a>, idx);</div><div class="line"><a name="l08150"></a><span class="lineno"> 8150</span>&#160;               <a class="code" href="../../d9/da0/pbx__private_8h.html#acd29668e92f96d142fe8d058db4ed773">sw_free</a>(sw);</div><div class="line"><a name="l08151"></a><span class="lineno"> 8151</span>&#160;            }</div><div class="line"><a name="l08152"></a><span class="lineno"> 8152</span>&#160;         }</div><div class="line"><a name="l08153"></a><span class="lineno"> 8153</span>&#160;</div><div class="line"><a name="l08154"></a><span class="lineno"> 8154</span>&#160;         <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>) { <span class="comment">/* it is entirely possible that the context is EMPTY */</span></div><div class="line"><a name="l08155"></a><span class="lineno"> 8155</span>&#160;            exten_iter = <a class="code" href="../../d6/da0/hashtab_8h.html#a2a9c96a0ce6fd77d2858e65d7d63f7b3">ast_hashtab_start_traversal</a>(tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>);</div><div class="line"><a name="l08156"></a><span class="lineno"> 8156</span>&#160;            <span class="keywordflow">while</span> ((exten_item=<a class="code" href="../../d6/da0/hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197">ast_hashtab_next</a>(exten_iter))) {</div><div class="line"><a name="l08157"></a><span class="lineno"> 8157</span>&#160;               <span class="keywordtype">int</span> end_traversal = 1;</div><div class="line"><a name="l08158"></a><span class="lineno"> 8158</span>&#160;</div><div class="line"><a name="l08159"></a><span class="lineno"> 8159</span>&#160;               <span class="comment">/*</span></div><div class="line"><a name="l08160"></a><span class="lineno"> 8160</span>&#160;<span class="comment">                * If the extension could not be removed from the root_table due to</span></div><div class="line"><a name="l08161"></a><span class="lineno"> 8161</span>&#160;<span class="comment">                * a loaded PBX app, it can exist here but have its peer_table be</span></div><div class="line"><a name="l08162"></a><span class="lineno"> 8162</span>&#160;<span class="comment">                * destroyed due to a previous pass through this function.</span></div><div class="line"><a name="l08163"></a><span class="lineno"> 8163</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l08164"></a><span class="lineno"> 8164</span>&#160;               <span class="keywordflow">if</span> (!exten_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>) {</div><div class="line"><a name="l08165"></a><span class="lineno"> 8165</span>&#160;                  <span class="keywordflow">continue</span>;</div><div class="line"><a name="l08166"></a><span class="lineno"> 8166</span>&#160;               }</div><div class="line"><a name="l08167"></a><span class="lineno"> 8167</span>&#160;</div><div class="line"><a name="l08168"></a><span class="lineno"> 8168</span>&#160;               prio_iter = <a class="code" href="../../d6/da0/hashtab_8h.html#a2a9c96a0ce6fd77d2858e65d7d63f7b3">ast_hashtab_start_traversal</a>(exten_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>);</div><div class="line"><a name="l08169"></a><span class="lineno"> 8169</span>&#160;               <span class="keywordflow">while</span> ((prio_item=<a class="code" href="../../d6/da0/hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197">ast_hashtab_next</a>(prio_iter))) {</div><div class="line"><a name="l08170"></a><span class="lineno"> 8170</span>&#160;                  <span class="keywordtype">char</span> extension[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];</div><div class="line"><a name="l08171"></a><span class="lineno"> 8171</span>&#160;                  <span class="keywordtype">char</span> <a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];</div><div class="line"><a name="l08172"></a><span class="lineno"> 8172</span>&#160;                  <span class="keywordflow">if</span> (!prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a> || strcmp(prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>, registrar) != 0) {</div><div class="line"><a name="l08173"></a><span class="lineno"> 8173</span>&#160;                     <span class="keywordflow">continue</span>;</div><div class="line"><a name="l08174"></a><span class="lineno"> 8174</span>&#160;                  }</div><div class="line"><a name="l08175"></a><span class="lineno"> 8175</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Remove %s/%s/%d, registrar=%s; con=%s(%p); con-&gt;root=%p\n&quot;</span>,</div><div class="line"><a name="l08176"></a><span class="lineno"> 8176</span>&#160;                         tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a>, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, registrar, con? con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a> : <span class="stringliteral">&quot;&lt;nil&gt;&quot;</span>, con, con? con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>: <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l08177"></a><span class="lineno"> 8177</span>&#160;                  <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(extension, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keyword">sizeof</span>(extension));</div><div class="line"><a name="l08178"></a><span class="lineno"> 8178</span>&#160;                  <span class="keywordflow">if</span> (prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>) {</div><div class="line"><a name="l08179"></a><span class="lineno"> 8179</span>&#160;                     <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(cidmatch, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">cidmatch</a>, <span class="keyword">sizeof</span>(cidmatch));</div><div class="line"><a name="l08180"></a><span class="lineno"> 8180</span>&#160;                  }</div><div class="line"><a name="l08181"></a><span class="lineno"> 8181</span>&#160;                  end_traversal &amp;= <a class="code" href="../../db/d94/pbx_8c.html#a938a84cd1446c1da1e45b2269c36c9e3">ast_context_remove_extension_callerid2</a>(tmp, extension, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, cidmatch, prio_item-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a>, NULL, 1);</div><div class="line"><a name="l08182"></a><span class="lineno"> 8182</span>&#160;               }</div><div class="line"><a name="l08183"></a><span class="lineno"> 8183</span>&#160;               <span class="comment">/* Explanation:</span></div><div class="line"><a name="l08184"></a><span class="lineno"> 8184</span>&#160;<span class="comment">                * ast_context_remove_extension_callerid2 will destroy the extension that it comes across. This</span></div><div class="line"><a name="l08185"></a><span class="lineno"> 8185</span>&#160;<span class="comment">                * destruction includes destroying the exten&#39;s peer_table, which we are currently traversing. If</span></div><div class="line"><a name="l08186"></a><span class="lineno"> 8186</span>&#160;<span class="comment">                * ast_context_remove_extension_callerid2 ever should return &#39;0&#39; then this means we have destroyed</span></div><div class="line"><a name="l08187"></a><span class="lineno"> 8187</span>&#160;<span class="comment">                * the hashtable which we are traversing, and thus calling ast_hashtab_end_traversal will result</span></div><div class="line"><a name="l08188"></a><span class="lineno"> 8188</span>&#160;<span class="comment">                * in reading invalid memory. Thus, if we detect that we destroyed the hashtable, then we will simply</span></div><div class="line"><a name="l08189"></a><span class="lineno"> 8189</span>&#160;<span class="comment">                * free the iterator</span></div><div class="line"><a name="l08190"></a><span class="lineno"> 8190</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l08191"></a><span class="lineno"> 8191</span>&#160;               <span class="keywordflow">if</span> (end_traversal) {</div><div class="line"><a name="l08192"></a><span class="lineno"> 8192</span>&#160;                  <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(prio_iter);</div><div class="line"><a name="l08193"></a><span class="lineno"> 8193</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08194"></a><span class="lineno"> 8194</span>&#160;                  <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(prio_iter);</div><div class="line"><a name="l08195"></a><span class="lineno"> 8195</span>&#160;               }</div><div class="line"><a name="l08196"></a><span class="lineno"> 8196</span>&#160;            }</div><div class="line"><a name="l08197"></a><span class="lineno"> 8197</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a>(exten_iter);</div><div class="line"><a name="l08198"></a><span class="lineno"> 8198</span>&#160;         }</div><div class="line"><a name="l08199"></a><span class="lineno"> 8199</span>&#160;</div><div class="line"><a name="l08200"></a><span class="lineno"> 8200</span>&#160;         <span class="comment">/* delete the context if it&#39;s registrar matches, is empty, has refcount of 1, */</span></div><div class="line"><a name="l08201"></a><span class="lineno"> 8201</span>&#160;         <span class="comment">/* it&#39;s not empty, if it has includes, ignorepats, or switches that are registered from</span></div><div class="line"><a name="l08202"></a><span class="lineno"> 8202</span>&#160;<span class="comment">            another registrar. It&#39;s not empty if there are any extensions */</span></div><div class="line"><a name="l08203"></a><span class="lineno"> 8203</span>&#160;         <span class="keywordflow">if</span> (strcmp(tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>, registrar) == 0 &amp;&amp; tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6022c8a609170c7365fb96e83cb2df48">refcount</a> &lt; 2 &amp;&amp; !tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a> &amp;&amp; !<a class="code" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a>(tmp) &amp;&amp; !<a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(tmp) &amp;&amp; !<a class="code" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a>(tmp)) {</div><div class="line"><a name="l08204"></a><span class="lineno"> 8204</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;delete ctx %s %s\n&quot;</span>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l08205"></a><span class="lineno"> 8205</span>&#160;            <a class="code" href="../../d6/da0/hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66">ast_hashtab_remove_this_object</a>(contexttab, tmp);</div><div class="line"><a name="l08206"></a><span class="lineno"> 8206</span>&#160;</div><div class="line"><a name="l08207"></a><span class="lineno"> 8207</span>&#160;            next = tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a>;</div><div class="line"><a name="l08208"></a><span class="lineno"> 8208</span>&#160;            <span class="keywordflow">if</span> (tmpl)</div><div class="line"><a name="l08209"></a><span class="lineno"> 8209</span>&#160;               tmpl-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a> = <a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;</div><div class="line"><a name="l08210"></a><span class="lineno"> 8210</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l08211"></a><span class="lineno"> 8211</span>&#160;               contexts = <a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;</div><div class="line"><a name="l08212"></a><span class="lineno"> 8212</span>&#160;            <span class="comment">/* Okay, now we&#39;re safe to let it go -- in a sense, we were</span></div><div class="line"><a name="l08213"></a><span class="lineno"> 8213</span>&#160;<span class="comment">               ready to let it go as soon as we locked it. */</span></div><div class="line"><a name="l08214"></a><span class="lineno"> 8214</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(tmp);</div><div class="line"><a name="l08215"></a><span class="lineno"> 8215</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#af51adb9b78f628397d7b0c1781b6d79e">__ast_internal_context_destroy</a>(tmp);</div><div class="line"><a name="l08216"></a><span class="lineno"> 8216</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08217"></a><span class="lineno"> 8217</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1,<span class="stringliteral">&quot;Couldn&#39;t delete ctx %s/%s; refc=%d; tmp.root=%p\n&quot;</span>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>,</div><div class="line"><a name="l08218"></a><span class="lineno"> 8218</span>&#160;                    tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6022c8a609170c7365fb96e83cb2df48">refcount</a>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a>);</div><div class="line"><a name="l08219"></a><span class="lineno"> 8219</span>&#160;            <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(tmp);</div><div class="line"><a name="l08220"></a><span class="lineno"> 8220</span>&#160;            next = tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a>;</div><div class="line"><a name="l08221"></a><span class="lineno"> 8221</span>&#160;            tmpl = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l08222"></a><span class="lineno"> 8222</span>&#160;         }</div><div class="line"><a name="l08223"></a><span class="lineno"> 8223</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (con) {</div><div class="line"><a name="l08224"></a><span class="lineno"> 8224</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Deleting context %s registrar=%s\n&quot;</span>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l08225"></a><span class="lineno"> 8225</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;delete ctx %s %s\n&quot;</span>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>, tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a>);</div><div class="line"><a name="l08226"></a><span class="lineno"> 8226</span>&#160;         <a class="code" href="../../d6/da0/hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66">ast_hashtab_remove_this_object</a>(contexttab, tmp);</div><div class="line"><a name="l08227"></a><span class="lineno"> 8227</span>&#160;</div><div class="line"><a name="l08228"></a><span class="lineno"> 8228</span>&#160;         next = tmp-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a>;</div><div class="line"><a name="l08229"></a><span class="lineno"> 8229</span>&#160;         <span class="keywordflow">if</span> (tmpl)</div><div class="line"><a name="l08230"></a><span class="lineno"> 8230</span>&#160;            tmpl-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a> = <a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;</div><div class="line"><a name="l08231"></a><span class="lineno"> 8231</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l08232"></a><span class="lineno"> 8232</span>&#160;            contexts = <a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;</div><div class="line"><a name="l08233"></a><span class="lineno"> 8233</span>&#160;         <span class="comment">/* Okay, now we&#39;re safe to let it go -- in a sense, we were</span></div><div class="line"><a name="l08234"></a><span class="lineno"> 8234</span>&#160;<span class="comment">            ready to let it go as soon as we locked it. */</span></div><div class="line"><a name="l08235"></a><span class="lineno"> 8235</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(tmp);</div><div class="line"><a name="l08236"></a><span class="lineno"> 8236</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#af51adb9b78f628397d7b0c1781b6d79e">__ast_internal_context_destroy</a>(tmp);</div><div class="line"><a name="l08237"></a><span class="lineno"> 8237</span>&#160;      }</div><div class="line"><a name="l08238"></a><span class="lineno"> 8238</span>&#160;</div><div class="line"><a name="l08239"></a><span class="lineno"> 8239</span>&#160;      <span class="comment">/* if we have a specific match, we are done, otherwise continue */</span></div><div class="line"><a name="l08240"></a><span class="lineno"> 8240</span>&#160;      tmp = con ? <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> : <a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;</div><div class="line"><a name="l08241"></a><span class="lineno"> 8241</span>&#160;   }</div><div class="line"><a name="l08242"></a><span class="lineno"> 8242</span>&#160;}</div><div class="line"><a name="l08243"></a><span class="lineno"> 8243</span>&#160;</div><div class="line"><a name="l08244"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a08abc5aa22cce4a793000a796b791076"> 8244</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a08abc5aa22cce4a793000a796b791076">ast_context_destroy_by_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l08245"></a><span class="lineno"> 8245</span>&#160;{</div><div class="line"><a name="l08246"></a><span class="lineno"> 8246</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con;</div><div class="line"><a name="l08247"></a><span class="lineno"> 8247</span>&#160;   <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l08248"></a><span class="lineno"> 8248</span>&#160;</div><div class="line"><a name="l08249"></a><span class="lineno"> 8249</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a18c87dac5f7f4368c11b67d8026adc22">ast_wrlock_contexts</a>();</div><div class="line"><a name="l08250"></a><span class="lineno"> 8250</span>&#160;   con = <a class="code" href="../../db/d94/pbx_8c.html#a2af2d2771e5347b18454a05dbc98e35f">ast_context_find</a>(context);</div><div class="line"><a name="l08251"></a><span class="lineno"> 8251</span>&#160;   <span class="keywordflow">if</span> (con) {</div><div class="line"><a name="l08252"></a><span class="lineno"> 8252</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a9546b830c22c693a2baed08e48569401">ast_context_destroy</a>(con, registrar);</div><div class="line"><a name="l08253"></a><span class="lineno"> 8253</span>&#160;      ret = 0;</div><div class="line"><a name="l08254"></a><span class="lineno"> 8254</span>&#160;   }</div><div class="line"><a name="l08255"></a><span class="lineno"> 8255</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l08256"></a><span class="lineno"> 8256</span>&#160;</div><div class="line"><a name="l08257"></a><span class="lineno"> 8257</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l08258"></a><span class="lineno"> 8258</span>&#160;}</div><div class="line"><a name="l08259"></a><span class="lineno"> 8259</span>&#160;</div><div class="line"><a name="l08260"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a9546b830c22c693a2baed08e48569401"> 8260</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a9546b830c22c693a2baed08e48569401">ast_context_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keyword">const</span> <span class="keywordtype">char</span> *registrar)</div><div class="line"><a name="l08261"></a><span class="lineno"> 8261</span>&#160;{</div><div class="line"><a name="l08262"></a><span class="lineno"> 8262</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a18c87dac5f7f4368c11b67d8026adc22">ast_wrlock_contexts</a>();</div><div class="line"><a name="l08263"></a><span class="lineno"> 8263</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#a06e285124697319566d67b82c25aba19">__ast_context_destroy</a>(contexts, contexts_table, con,registrar);</div><div class="line"><a name="l08264"></a><span class="lineno"> 8264</span>&#160;   <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>();</div><div class="line"><a name="l08265"></a><span class="lineno"> 8265</span>&#160;}</div><div class="line"><a name="l08266"></a><span class="lineno"> 8266</span>&#160;</div><div class="line"><a name="l08267"></a><span class="lineno"><a class="line" href="../../d9/da0/pbx__private_8h.html#a2e2f31cfba289d6d661ef50e8ddf9648"> 8267</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a2e2f31cfba289d6d661ef50e8ddf9648">wait_for_hangup</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l08268"></a><span class="lineno"> 8268</span>&#160;{</div><div class="line"><a name="l08269"></a><span class="lineno"> 8269</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l08270"></a><span class="lineno"> 8270</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f;</div><div class="line"><a name="l08271"></a><span class="lineno"> 8271</span>&#160;   <span class="keywordtype">double</span> waitsec;</div><div class="line"><a name="l08272"></a><span class="lineno"> 8272</span>&#160;   <span class="keywordtype">int</span> waittime;</div><div class="line"><a name="l08273"></a><span class="lineno"> 8273</span>&#160;</div><div class="line"><a name="l08274"></a><span class="lineno"> 8274</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data) || (sscanf(data, <span class="stringliteral">&quot;%30lg&quot;</span>, &amp;waitsec) != 1) || (waitsec &lt; 0))</div><div class="line"><a name="l08275"></a><span class="lineno"> 8275</span>&#160;      waitsec = -1;</div><div class="line"><a name="l08276"></a><span class="lineno"> 8276</span>&#160;   <span class="keywordflow">if</span> (waitsec &gt; -1) {</div><div class="line"><a name="l08277"></a><span class="lineno"> 8277</span>&#160;      waittime = waitsec * 1000.0;</div><div class="line"><a name="l08278"></a><span class="lineno"> 8278</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af10e3bd01602095e1908d3926afc3b76">ast_safe_sleep</a>(chan, waittime);</div><div class="line"><a name="l08279"></a><span class="lineno"> 8279</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">do</span> {</div><div class="line"><a name="l08280"></a><span class="lineno"> 8280</span>&#160;      res = <a class="code" href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a>(chan, -1);</div><div class="line"><a name="l08281"></a><span class="lineno"> 8281</span>&#160;      <span class="keywordflow">if</span> (res &lt; 0)</div><div class="line"><a name="l08282"></a><span class="lineno"> 8282</span>&#160;         <span class="keywordflow">return</span>;</div><div class="line"><a name="l08283"></a><span class="lineno"> 8283</span>&#160;      f = <a class="code" href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a>(chan);</div><div class="line"><a name="l08284"></a><span class="lineno"> 8284</span>&#160;      <span class="keywordflow">if</span> (f)</div><div class="line"><a name="l08285"></a><span class="lineno"> 8285</span>&#160;         <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);</div><div class="line"><a name="l08286"></a><span class="lineno"> 8286</span>&#160;   } <span class="keywordflow">while</span>(f);</div><div class="line"><a name="l08287"></a><span class="lineno"> 8287</span>&#160;}</div><div class="line"><a name="l08288"></a><span class="lineno"> 8288</span>&#160;<span class="comment"></span></div><div class="line"><a name="l08289"></a><span class="lineno"> 8289</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l08290"></a><span class="lineno"> 8290</span>&#160;<span class="comment"> * \ingroup functions</span></div><div class="line"><a name="l08291"></a><span class="lineno"> 8291</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08292"></a><span class="lineno"><a class="line" href="../../d5/db0/group__functions.html#gaf07906b55467adaf7f84124bb6515706"> 8292</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/db0/group__functions.html#gaf07906b55467adaf7f84124bb6515706">testtime_write</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>)</div><div class="line"><a name="l08293"></a><span class="lineno"> 8293</span>&#160;{</div><div class="line"><a name="l08294"></a><span class="lineno"> 8294</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d84/structast__tm.html">ast_tm</a> tm;</div><div class="line"><a name="l08295"></a><span class="lineno"> 8295</span>&#160;   <span class="keyword">struct </span>timeval tv;</div><div class="line"><a name="l08296"></a><span class="lineno"> 8296</span>&#160;   <span class="keywordtype">char</span> *remainder, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>[30], timezone[80];</div><div class="line"><a name="l08297"></a><span class="lineno"> 8297</span>&#160;</div><div class="line"><a name="l08298"></a><span class="lineno"> 8298</span>&#160;   <span class="comment">/* Turn off testing? */</span></div><div class="line"><a name="l08299"></a><span class="lineno"> 8299</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../db/d94/pbx_8c.html#ac8447d16749d15c783e1dff4d8f8e495">pbx_checkcondition</a>(value)) {</div><div class="line"><a name="l08300"></a><span class="lineno"> 8300</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;TESTTIME&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l08301"></a><span class="lineno"> 8301</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08302"></a><span class="lineno"> 8302</span>&#160;   }</div><div class="line"><a name="l08303"></a><span class="lineno"> 8303</span>&#160;</div><div class="line"><a name="l08304"></a><span class="lineno"> 8304</span>&#160;   <span class="comment">/* Parse specified time */</span></div><div class="line"><a name="l08305"></a><span class="lineno"> 8305</span>&#160;   <span class="keywordflow">if</span> (!(remainder = <a class="code" href="../../d5/deb/localtime_8h.html#a3eb2c73accce1b149ce597de80d1677a">ast_strptime</a>(value, <span class="stringliteral">&quot;%Y/%m/%d %H:%M:%S&quot;</span>, &amp;tm))) {</div><div class="line"><a name="l08306"></a><span class="lineno"> 8306</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l08307"></a><span class="lineno"> 8307</span>&#160;   }</div><div class="line"><a name="l08308"></a><span class="lineno"> 8308</span>&#160;   sscanf(remainder, <span class="stringliteral">&quot;%79s&quot;</span>, timezone);</div><div class="line"><a name="l08309"></a><span class="lineno"> 8309</span>&#160;   tv = <a class="code" href="../../d5/deb/localtime_8h.html#ae0843e4dbbd1fed36d2676dda58e0c44">ast_mktime</a>(&amp;tm, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(timezone, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div><div class="line"><a name="l08310"></a><span class="lineno"> 8310</span>&#160;</div><div class="line"><a name="l08311"></a><span class="lineno"> 8311</span>&#160;   snprintf(result, <span class="keyword">sizeof</span>(result), <span class="stringliteral">&quot;%ld&quot;</span>, (<span class="keywordtype">long</span>) tv.tv_sec);</div><div class="line"><a name="l08312"></a><span class="lineno"> 8312</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;__TESTTIME&quot;</span>, result);</div><div class="line"><a name="l08313"></a><span class="lineno"> 8313</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08314"></a><span class="lineno"> 8314</span>&#160;}</div><div class="line"><a name="l08315"></a><span class="lineno"> 8315</span>&#160;</div><div class="line"><a name="l08316"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aabe7e55731958e6cf97514e584cc2cfc"> 8316</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> <a class="code" href="../../db/d94/pbx_8c.html#aabe7e55731958e6cf97514e584cc2cfc">testtime_function</a> = {</div><div class="line"><a name="l08317"></a><span class="lineno"> 8317</span>&#160;   .<a class="code" href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">name</a> = <span class="stringliteral">&quot;TESTTIME&quot;</span>,</div><div class="line"><a name="l08318"></a><span class="lineno"> 8318</span>&#160;   .write = <a class="code" href="../../d5/db0/group__functions.html#gaf07906b55467adaf7f84124bb6515706">testtime_write</a>,</div><div class="line"><a name="l08319"></a><span class="lineno"> 8319</span>&#160;};</div><div class="line"><a name="l08320"></a><span class="lineno"> 8320</span>&#160;</div><div class="line"><a name="l08321"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ac8447d16749d15c783e1dff4d8f8e495"> 8321</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ac8447d16749d15c783e1dff4d8f8e495">pbx_checkcondition</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *condition)</div><div class="line"><a name="l08322"></a><span class="lineno"> 8322</span>&#160;{</div><div class="line"><a name="l08323"></a><span class="lineno"> 8323</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l08324"></a><span class="lineno"> 8324</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(condition)) {                <span class="comment">/* NULL or empty strings are false */</span></div><div class="line"><a name="l08325"></a><span class="lineno"> 8325</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08326"></a><span class="lineno"> 8326</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sscanf(condition, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;res) == 1) { <span class="comment">/* Numbers are evaluated for truth */</span></div><div class="line"><a name="l08327"></a><span class="lineno"> 8327</span>&#160;      <span class="keywordflow">return</span> res;</div><div class="line"><a name="l08328"></a><span class="lineno"> 8328</span>&#160;   } <span class="keywordflow">else</span> {                                         <span class="comment">/* Strings are true */</span></div><div class="line"><a name="l08329"></a><span class="lineno"> 8329</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l08330"></a><span class="lineno"> 8330</span>&#160;   }</div><div class="line"><a name="l08331"></a><span class="lineno"> 8331</span>&#160;}</div><div class="line"><a name="l08332"></a><span class="lineno"> 8332</span>&#160;</div><div class="line"><a name="l08333"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a30bdd4f0a69a85ec0c099c4262164b25"> 8333</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a30bdd4f0a69a85ec0c099c4262164b25">presence_state_cb</a>(<span class="keywordtype">void</span> *unused, <span class="keyword">struct</span> <a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg)</div><div class="line"><a name="l08334"></a><span class="lineno"> 8334</span>&#160;{</div><div class="line"><a name="l08335"></a><span class="lineno"> 8335</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/db9/structast__presence__state__message.html">ast_presence_state_message</a> *presence_state;</div><div class="line"><a name="l08336"></a><span class="lineno"> 8336</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *hint_app = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08337"></a><span class="lineno"> 8337</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> *device;</div><div class="line"><a name="l08338"></a><span class="lineno"> 8338</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> *cmpdevice;</div><div class="line"><a name="l08339"></a><span class="lineno"> 8339</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> *dev_iter;</div><div class="line"><a name="l08340"></a><span class="lineno"> 8340</span>&#160;</div><div class="line"><a name="l08341"></a><span class="lineno"> 8341</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(msg) != <a class="code" href="../../d6/dd7/presencestate_8h.html#a7552e0df81ae4e89431564844957de41">ast_presence_state_message_type</a>()) {</div><div class="line"><a name="l08342"></a><span class="lineno"> 8342</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l08343"></a><span class="lineno"> 8343</span>&#160;   }</div><div class="line"><a name="l08344"></a><span class="lineno"> 8344</span>&#160;</div><div class="line"><a name="l08345"></a><span class="lineno"> 8345</span>&#160;   presence_state = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(msg);</div><div class="line"><a name="l08346"></a><span class="lineno"> 8346</span>&#160;</div><div class="line"><a name="l08347"></a><span class="lineno"> 8347</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(hintdevices) == 0) {</div><div class="line"><a name="l08348"></a><span class="lineno"> 8348</span>&#160;      <span class="comment">/* There are no hints monitoring devices. */</span></div><div class="line"><a name="l08349"></a><span class="lineno"> 8349</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l08350"></a><span class="lineno"> 8350</span>&#160;   }</div><div class="line"><a name="l08351"></a><span class="lineno"> 8351</span>&#160;</div><div class="line"><a name="l08352"></a><span class="lineno"> 8352</span>&#160;   hint_app = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(1024);</div><div class="line"><a name="l08353"></a><span class="lineno"> 8353</span>&#160;   <span class="keywordflow">if</span> (!hint_app) {</div><div class="line"><a name="l08354"></a><span class="lineno"> 8354</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l08355"></a><span class="lineno"> 8355</span>&#160;   }</div><div class="line"><a name="l08356"></a><span class="lineno"> 8356</span>&#160;</div><div class="line"><a name="l08357"></a><span class="lineno"> 8357</span>&#160;   cmpdevice = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(<span class="keyword">sizeof</span>(*cmpdevice) + strlen(presence_state-&gt;provider));</div><div class="line"><a name="l08358"></a><span class="lineno"> 8358</span>&#160;   strcpy(cmpdevice-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">hintdevice</a>, presence_state-&gt;provider);</div><div class="line"><a name="l08359"></a><span class="lineno"> 8359</span>&#160;</div><div class="line"><a name="l08360"></a><span class="lineno"> 8360</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">context_merge_lock</a>);<span class="comment">/* Hold off ast_merge_contexts_and_delete */</span></div><div class="line"><a name="l08361"></a><span class="lineno"> 8361</span>&#160;   dev_iter = <a class="code" href="../../d5/da5/astobj2_8h.html#aeca960ec22a1d0384f6e285b25df8501">ao2_t_callback</a>(hintdevices,</div><div class="line"><a name="l08362"></a><span class="lineno"> 8362</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a2448088751e4d494d1981c7f4b84e8d0">OBJ_POINTER</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>,</div><div class="line"><a name="l08363"></a><span class="lineno"> 8363</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#aabf9a3a7442aeee52b849c70c6d0af33">hintdevice_cmp_multiple</a>,</div><div class="line"><a name="l08364"></a><span class="lineno"> 8364</span>&#160;      cmpdevice,</div><div class="line"><a name="l08365"></a><span class="lineno"> 8365</span>&#160;      <span class="stringliteral">&quot;find devices in container&quot;</span>);</div><div class="line"><a name="l08366"></a><span class="lineno"> 8366</span>&#160;   <span class="keywordflow">if</span> (!dev_iter) {</div><div class="line"><a name="l08367"></a><span class="lineno"> 8367</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">context_merge_lock</a>);</div><div class="line"><a name="l08368"></a><span class="lineno"> 8368</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(hint_app);</div><div class="line"><a name="l08369"></a><span class="lineno"> 8369</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l08370"></a><span class="lineno"> 8370</span>&#160;   }</div><div class="line"><a name="l08371"></a><span class="lineno"> 8371</span>&#160;</div><div class="line"><a name="l08372"></a><span class="lineno"> 8372</span>&#160;   <span class="keywordflow">for</span> (; (device = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(dev_iter)); <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(device, -1, <span class="stringliteral">&quot;Next device&quot;</span>)) {</div><div class="line"><a name="l08373"></a><span class="lineno"> 8373</span>&#160;      <span class="keywordflow">if</span> (device-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a>) {</div><div class="line"><a name="l08374"></a><span class="lineno"> 8374</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#aae5642e93e1996051e684bfbc3b3ab08">presence_state_notify_callbacks</a>(device-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a>, &amp;hint_app, presence_state);</div><div class="line"><a name="l08375"></a><span class="lineno"> 8375</span>&#160;      }</div><div class="line"><a name="l08376"></a><span class="lineno"> 8376</span>&#160;   }</div><div class="line"><a name="l08377"></a><span class="lineno"> 8377</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(dev_iter);</div><div class="line"><a name="l08378"></a><span class="lineno"> 8378</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">context_merge_lock</a>);</div><div class="line"><a name="l08379"></a><span class="lineno"> 8379</span>&#160;</div><div class="line"><a name="l08380"></a><span class="lineno"> 8380</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(hint_app);</div><div class="line"><a name="l08381"></a><span class="lineno"> 8381</span>&#160;}</div><div class="line"><a name="l08382"></a><span class="lineno"> 8382</span>&#160;</div><div class="line"><a name="l08383"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a1cd189626b1bebd901bb5d80e87d7b9c"> 8383</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a1cd189626b1bebd901bb5d80e87d7b9c">action_extensionstatelist</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l08384"></a><span class="lineno"> 8384</span>&#160;{</div><div class="line"><a name="l08385"></a><span class="lineno"> 8385</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *action_id = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>);</div><div class="line"><a name="l08386"></a><span class="lineno"> 8386</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint;</div><div class="line"><a name="l08387"></a><span class="lineno"> 8387</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> it_hints;</div><div class="line"><a name="l08388"></a><span class="lineno"> 8388</span>&#160;   <span class="keywordtype">int</span> hint_count = 0;</div><div class="line"><a name="l08389"></a><span class="lineno"> 8389</span>&#160;</div><div class="line"><a name="l08390"></a><span class="lineno"> 8390</span>&#160;   <span class="keywordflow">if</span> (!hints) {</div><div class="line"><a name="l08391"></a><span class="lineno"> 8391</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No dialplan hints are available&quot;</span>);</div><div class="line"><a name="l08392"></a><span class="lineno"> 8392</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08393"></a><span class="lineno"> 8393</span>&#160;   }</div><div class="line"><a name="l08394"></a><span class="lineno"> 8394</span>&#160;</div><div class="line"><a name="l08395"></a><span class="lineno"> 8395</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a>(s, m, <span class="stringliteral">&quot;Extension Statuses will follow&quot;</span>, <span class="stringliteral">&quot;start&quot;</span>);</div><div class="line"><a name="l08396"></a><span class="lineno"> 8396</span>&#160;</div><div class="line"><a name="l08397"></a><span class="lineno"> 8397</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hints);</div><div class="line"><a name="l08398"></a><span class="lineno"> 8398</span>&#160;   it_hints = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(hints, 0);</div><div class="line"><a name="l08399"></a><span class="lineno"> 8399</span>&#160;   <span class="keywordflow">for</span> (; (hint = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;it_hints)); <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hint, -1)) {</div><div class="line"><a name="l08400"></a><span class="lineno"> 8400</span>&#160;</div><div class="line"><a name="l08401"></a><span class="lineno"> 8401</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(hint);</div><div class="line"><a name="l08402"></a><span class="lineno"> 8402</span>&#160;</div><div class="line"><a name="l08403"></a><span class="lineno"> 8403</span>&#160;      <span class="comment">/* Ignore pattern matching hints; they are stored in the</span></div><div class="line"><a name="l08404"></a><span class="lineno"> 8404</span>&#160;<span class="comment">       * hints container but aren&#39;t real from the perspective of</span></div><div class="line"><a name="l08405"></a><span class="lineno"> 8405</span>&#160;<span class="comment">       * an AMI user</span></div><div class="line"><a name="l08406"></a><span class="lineno"> 8406</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l08407"></a><span class="lineno"> 8407</span>&#160;      <span class="keywordflow">if</span> (hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>[0] == <span class="charliteral">&#39;_&#39;</span>) {</div><div class="line"><a name="l08408"></a><span class="lineno"> 8408</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l08409"></a><span class="lineno"> 8409</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l08410"></a><span class="lineno"> 8410</span>&#160;      }</div><div class="line"><a name="l08411"></a><span class="lineno"> 8411</span>&#160;</div><div class="line"><a name="l08412"></a><span class="lineno"> 8412</span>&#160;      ++hint_count;</div><div class="line"><a name="l08413"></a><span class="lineno"> 8413</span>&#160;</div><div class="line"><a name="l08414"></a><span class="lineno"> 8414</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Event: ExtensionStatus\r\n&quot;</span>);</div><div class="line"><a name="l08415"></a><span class="lineno"> 8415</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(action_id)) {</div><div class="line"><a name="l08416"></a><span class="lineno"> 8416</span>&#160;         <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, action_id);</div><div class="line"><a name="l08417"></a><span class="lineno"> 8417</span>&#160;      }</div><div class="line"><a name="l08418"></a><span class="lineno"> 8418</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s,</div><div class="line"><a name="l08419"></a><span class="lineno"> 8419</span>&#160;         <span class="stringliteral">&quot;Exten: %s\r\n&quot;</span></div><div class="line"><a name="l08420"></a><span class="lineno"> 8420</span>&#160;         <span class="stringliteral">&quot;Context: %s\r\n&quot;</span></div><div class="line"><a name="l08421"></a><span class="lineno"> 8421</span>&#160;         <span class="stringliteral">&quot;Hint: %s\r\n&quot;</span></div><div class="line"><a name="l08422"></a><span class="lineno"> 8422</span>&#160;         <span class="stringliteral">&quot;Status: %d\r\n&quot;</span></div><div class="line"><a name="l08423"></a><span class="lineno"> 8423</span>&#160;         <span class="stringliteral">&quot;StatusText: %s\r\n\r\n&quot;</span>,</div><div class="line"><a name="l08424"></a><span class="lineno"> 8424</span>&#160;         hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l08425"></a><span class="lineno"> 8425</span>&#160;         hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">parent</a>-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a>,</div><div class="line"><a name="l08426"></a><span class="lineno"> 8426</span>&#160;         hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a>,</div><div class="line"><a name="l08427"></a><span class="lineno"> 8427</span>&#160;         hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a>,</div><div class="line"><a name="l08428"></a><span class="lineno"> 8428</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#a3261603753916b98888a5a5fc1d505c3">ast_extension_state2str</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a>));</div><div class="line"><a name="l08429"></a><span class="lineno"> 8429</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hint);</div><div class="line"><a name="l08430"></a><span class="lineno"> 8430</span>&#160;   }</div><div class="line"><a name="l08431"></a><span class="lineno"> 8431</span>&#160;</div><div class="line"><a name="l08432"></a><span class="lineno"> 8432</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;it_hints);</div><div class="line"><a name="l08433"></a><span class="lineno"> 8433</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(hints);</div><div class="line"><a name="l08434"></a><span class="lineno"> 8434</span>&#160;</div><div class="line"><a name="l08435"></a><span class="lineno"> 8435</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a>(s, m, <span class="stringliteral">&quot;ExtensionStateListComplete&quot;</span>, hint_count);</div><div class="line"><a name="l08436"></a><span class="lineno"> 8436</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a>(s);</div><div class="line"><a name="l08437"></a><span class="lineno"> 8437</span>&#160;</div><div class="line"><a name="l08438"></a><span class="lineno"> 8438</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08439"></a><span class="lineno"> 8439</span>&#160;}</div><div class="line"><a name="l08440"></a><span class="lineno"> 8440</span>&#160;</div><div class="line"><a name="l08441"></a><span class="lineno"> 8441</span>&#160;<span class="comment"></span></div><div class="line"><a name="l08442"></a><span class="lineno"> 8442</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l08443"></a><span class="lineno"> 8443</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l08444"></a><span class="lineno"> 8444</span>&#160;<span class="comment"> * \brief Clean up resources on Asterisk shutdown.</span></div><div class="line"><a name="l08445"></a><span class="lineno"> 8445</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l08446"></a><span class="lineno"> 8446</span>&#160;<span class="comment"> * \note Cleans up resources allocated in load_pbx</span></div><div class="line"><a name="l08447"></a><span class="lineno"> 8447</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08448"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a824bc8f418b4536d2ed8bc44ec112e10"> 8448</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a824bc8f418b4536d2ed8bc44ec112e10">unload_pbx</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08449"></a><span class="lineno"> 8449</span>&#160;{</div><div class="line"><a name="l08450"></a><span class="lineno"> 8450</span>&#160;   presence_state_sub = <a class="code" href="../../dd/d79/stasis_8h.html#a221d05010106dcde0cc2e2b43c1a8b67">stasis_unsubscribe_and_join</a>(presence_state_sub);</div><div class="line"><a name="l08451"></a><span class="lineno"> 8451</span>&#160;   device_state_sub = <a class="code" href="../../dd/d79/stasis_8h.html#a221d05010106dcde0cc2e2b43c1a8b67">stasis_unsubscribe_and_join</a>(device_state_sub);</div><div class="line"><a name="l08452"></a><span class="lineno"> 8452</span>&#160;</div><div class="line"><a name="l08453"></a><span class="lineno"> 8453</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;ShowDialPlan&quot;</span>);</div><div class="line"><a name="l08454"></a><span class="lineno"> 8454</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;ExtensionStateList&quot;</span>);</div><div class="line"><a name="l08455"></a><span class="lineno"> 8455</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a>(pbx_cli, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(pbx_cli));</div><div class="line"><a name="l08456"></a><span class="lineno"> 8456</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;exception_function);</div><div class="line"><a name="l08457"></a><span class="lineno"> 8457</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;testtime_function);</div><div class="line"><a name="l08458"></a><span class="lineno"> 8458</span>&#160;}</div><div class="line"><a name="l08459"></a><span class="lineno"> 8459</span>&#160;</div><div class="line"><a name="l08460"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ab9a2fcd7b22827d129fc37fc2777c6f4"> 8460</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ab9a2fcd7b22827d129fc37fc2777c6f4">load_pbx</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08461"></a><span class="lineno"> 8461</span>&#160;{</div><div class="line"><a name="l08462"></a><span class="lineno"> 8462</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l08463"></a><span class="lineno"> 8463</span>&#160;</div><div class="line"><a name="l08464"></a><span class="lineno"> 8464</span>&#160;   <a class="code" href="../../db/db2/asterisk_8h.html#a412442e1beffe5bec07ed2e9ea72afc3">ast_register_cleanup</a>(<a class="code" href="../../db/d94/pbx_8c.html#a824bc8f418b4536d2ed8bc44ec112e10">unload_pbx</a>);</div><div class="line"><a name="l08465"></a><span class="lineno"> 8465</span>&#160;</div><div class="line"><a name="l08466"></a><span class="lineno"> 8466</span>&#160;   <span class="comment">/* Initialize the PBX */</span></div><div class="line"><a name="l08467"></a><span class="lineno"> 8467</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Asterisk PBX Core Initializing\n&quot;</span>);</div><div class="line"><a name="l08468"></a><span class="lineno"> 8468</span>&#160;</div><div class="line"><a name="l08469"></a><span class="lineno"> 8469</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Registering builtin functions:\n&quot;</span>);</div><div class="line"><a name="l08470"></a><span class="lineno"> 8470</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a>(pbx_cli, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(pbx_cli));</div><div class="line"><a name="l08471"></a><span class="lineno"> 8471</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#aad8771c7e3b2170a749946f1a8b758aa">__ast_custom_function_register</a>(&amp;exception_function, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l08472"></a><span class="lineno"> 8472</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#aad8771c7e3b2170a749946f1a8b758aa">__ast_custom_function_register</a>(&amp;testtime_function, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l08473"></a><span class="lineno"> 8473</span>&#160;</div><div class="line"><a name="l08474"></a><span class="lineno"> 8474</span>&#160;   <span class="comment">/* Register manager application */</span></div><div class="line"><a name="l08475"></a><span class="lineno"> 8475</span>&#160;   res |= <a class="code" href="../../db/d45/manager_8h.html#a1d34461b8a3210b19e66f06bcdebfeb3">ast_manager_register_xml_core</a>(<span class="stringliteral">&quot;ShowDialPlan&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a36fb89c2a73755209133b6c73fe92e54">EVENT_FLAG_CONFIG</a> | <a class="code" href="../../db/d45/manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <a class="code" href="../../db/d94/pbx_8c.html#a08cb2466bf2b7844066c2e1f62a298db">manager_show_dialplan</a>);</div><div class="line"><a name="l08476"></a><span class="lineno"> 8476</span>&#160;   res |= <a class="code" href="../../db/d45/manager_8h.html#a1d34461b8a3210b19e66f06bcdebfeb3">ast_manager_register_xml_core</a>(<span class="stringliteral">&quot;ExtensionStateList&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a> | <a class="code" href="../../db/d45/manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <a class="code" href="../../db/d94/pbx_8c.html#a1cd189626b1bebd901bb5d80e87d7b9c">action_extensionstatelist</a>);</div><div class="line"><a name="l08477"></a><span class="lineno"> 8477</span>&#160;</div><div class="line"><a name="l08478"></a><span class="lineno"> 8478</span>&#160;   <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l08479"></a><span class="lineno"> 8479</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l08480"></a><span class="lineno"> 8480</span>&#160;   }</div><div class="line"><a name="l08481"></a><span class="lineno"> 8481</span>&#160;</div><div class="line"><a name="l08482"></a><span class="lineno"> 8482</span>&#160;   <span class="keywordflow">if</span> (!(device_state_sub = <a class="code" href="../../dd/d79/stasis_8h.html#ae3fe7fe099389094244002113814ec23">stasis_subscribe</a>(<a class="code" href="../../da/da2/devicestate_8h.html#a9fa7376e8e627cf5a512209005692013">ast_device_state_topic_all</a>(), <a class="code" href="../../db/d94/pbx_8c.html#ac1dd446fcf3d75d5da9228faf2dce1d3">device_state_cb</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l08483"></a><span class="lineno"> 8483</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l08484"></a><span class="lineno"> 8484</span>&#160;   }</div><div class="line"><a name="l08485"></a><span class="lineno"> 8485</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(device_state_sub, <a class="code" href="../../da/da2/devicestate_8h.html#a9459272db1c8c968ed1aff1387f0f9fd">ast_device_state_message_type</a>());</div><div class="line"><a name="l08486"></a><span class="lineno"> 8486</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(device_state_sub, hint_change_message_type());</div><div class="line"><a name="l08487"></a><span class="lineno"> 8487</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(device_state_sub, hint_remove_message_type());</div><div class="line"><a name="l08488"></a><span class="lineno"> 8488</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a>(device_state_sub, <a class="code" href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a>);</div><div class="line"><a name="l08489"></a><span class="lineno"> 8489</span>&#160;</div><div class="line"><a name="l08490"></a><span class="lineno"> 8490</span>&#160;   <span class="keywordflow">if</span> (!(presence_state_sub = <a class="code" href="../../dd/d79/stasis_8h.html#ae3fe7fe099389094244002113814ec23">stasis_subscribe</a>(<a class="code" href="../../d6/dd7/presencestate_8h.html#a24297292fcef05a5a271e99e1a71f45a">ast_presence_state_topic_all</a>(), <a class="code" href="../../db/d94/pbx_8c.html#a30bdd4f0a69a85ec0c099c4262164b25">presence_state_cb</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l08491"></a><span class="lineno"> 8491</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l08492"></a><span class="lineno"> 8492</span>&#160;   }</div><div class="line"><a name="l08493"></a><span class="lineno"> 8493</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(presence_state_sub, <a class="code" href="../../d6/dd7/presencestate_8h.html#a7552e0df81ae4e89431564844957de41">ast_presence_state_message_type</a>());</div><div class="line"><a name="l08494"></a><span class="lineno"> 8494</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a>(presence_state_sub, <a class="code" href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a>);</div><div class="line"><a name="l08495"></a><span class="lineno"> 8495</span>&#160;</div><div class="line"><a name="l08496"></a><span class="lineno"> 8496</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08497"></a><span class="lineno"> 8497</span>&#160;}</div><div class="line"><a name="l08498"></a><span class="lineno"> 8498</span>&#160;</div><div class="line"><a name="l08499"></a><span class="lineno"> 8499</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l08500"></a><span class="lineno"> 8500</span>&#160;<span class="comment"> * Lock context list functions ...</span></div><div class="line"><a name="l08501"></a><span class="lineno"> 8501</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08502"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a18c87dac5f7f4368c11b67d8026adc22"> 8502</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a18c87dac5f7f4368c11b67d8026adc22">ast_wrlock_contexts</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08503"></a><span class="lineno"> 8503</span>&#160;{</div><div class="line"><a name="l08504"></a><span class="lineno"> 8504</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a7470458bc954de8f3d698bd99b25aed5">conlock</a>);</div><div class="line"><a name="l08505"></a><span class="lineno"> 8505</span>&#160;}</div><div class="line"><a name="l08506"></a><span class="lineno"> 8506</span>&#160;</div><div class="line"><a name="l08507"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546"> 8507</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08508"></a><span class="lineno"> 8508</span>&#160;{</div><div class="line"><a name="l08509"></a><span class="lineno"> 8509</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a7470458bc954de8f3d698bd99b25aed5">conlock</a>);</div><div class="line"><a name="l08510"></a><span class="lineno"> 8510</span>&#160;}</div><div class="line"><a name="l08511"></a><span class="lineno"> 8511</span>&#160;</div><div class="line"><a name="l08512"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b"> 8512</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08513"></a><span class="lineno"> 8513</span>&#160;{</div><div class="line"><a name="l08514"></a><span class="lineno"> 8514</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../db/d94/pbx_8c.html#a7470458bc954de8f3d698bd99b25aed5">conlock</a>);</div><div class="line"><a name="l08515"></a><span class="lineno"> 8515</span>&#160;}</div><div class="line"><a name="l08516"></a><span class="lineno"> 8516</span>&#160;</div><div class="line"><a name="l08517"></a><span class="lineno"> 8517</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l08518"></a><span class="lineno"> 8518</span>&#160;<span class="comment"> * Lock context ...</span></div><div class="line"><a name="l08519"></a><span class="lineno"> 8519</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08520"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2"> 8520</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con)</div><div class="line"><a name="l08521"></a><span class="lineno"> 8521</span>&#160;{</div><div class="line"><a name="l08522"></a><span class="lineno"> 8522</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dd/d42/lock_8h.html#a045bd81ceab2de81e42af338ad7cf121">ast_rwlock_wrlock</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ace4e0066a5b24f84b90536e9906619f6">lock</a>);</div><div class="line"><a name="l08523"></a><span class="lineno"> 8523</span>&#160;}</div><div class="line"><a name="l08524"></a><span class="lineno"> 8524</span>&#160;</div><div class="line"><a name="l08525"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#af1a624244a07626a8f70843005206c95"> 8525</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#af1a624244a07626a8f70843005206c95">ast_rdlock_context</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con)</div><div class="line"><a name="l08526"></a><span class="lineno"> 8526</span>&#160;{</div><div class="line"><a name="l08527"></a><span class="lineno"> 8527</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dd/d42/lock_8h.html#a7330ac9d36b05bad68b188c2dcfa42d7">ast_rwlock_rdlock</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ace4e0066a5b24f84b90536e9906619f6">lock</a>);</div><div class="line"><a name="l08528"></a><span class="lineno"> 8528</span>&#160;}</div><div class="line"><a name="l08529"></a><span class="lineno"> 8529</span>&#160;</div><div class="line"><a name="l08530"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308"> 8530</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con)</div><div class="line"><a name="l08531"></a><span class="lineno"> 8531</span>&#160;{</div><div class="line"><a name="l08532"></a><span class="lineno"> 8532</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dd/d42/lock_8h.html#ac2920a1db37313ec46bd91dc83bf9c8a">ast_rwlock_unlock</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#ace4e0066a5b24f84b90536e9906619f6">lock</a>);</div><div class="line"><a name="l08533"></a><span class="lineno"> 8533</span>&#160;}</div><div class="line"><a name="l08534"></a><span class="lineno"> 8534</span>&#160;</div><div class="line"><a name="l08535"></a><span class="lineno"> 8535</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l08536"></a><span class="lineno"> 8536</span>&#160;<span class="comment"> * Name functions ...</span></div><div class="line"><a name="l08537"></a><span class="lineno"> 8537</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08538"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0"> 8538</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con)</div><div class="line"><a name="l08539"></a><span class="lineno"> 8539</span>&#160;{</div><div class="line"><a name="l08540"></a><span class="lineno"> 8540</span>&#160;   <span class="keywordflow">return</span> con ? con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">name</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08541"></a><span class="lineno"> 8541</span>&#160;}</div><div class="line"><a name="l08542"></a><span class="lineno"> 8542</span>&#160;</div><div class="line"><a name="l08543"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82"> 8543</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l08544"></a><span class="lineno"> 8544</span>&#160;{</div><div class="line"><a name="l08545"></a><span class="lineno"> 8545</span>&#160;   <span class="keywordflow">return</span> exten ? exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">parent</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08546"></a><span class="lineno"> 8546</span>&#160;}</div><div class="line"><a name="l08547"></a><span class="lineno"> 8547</span>&#160;</div><div class="line"><a name="l08548"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697"> 8548</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l08549"></a><span class="lineno"> 8549</span>&#160;{</div><div class="line"><a name="l08550"></a><span class="lineno"> 8550</span>&#160;   <span class="keywordflow">return</span> exten ? exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">name</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08551"></a><span class="lineno"> 8551</span>&#160;}</div><div class="line"><a name="l08552"></a><span class="lineno"> 8552</span>&#160;</div><div class="line"><a name="l08553"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a54aae627e24c46cfd1ce479ddfa0f3d2"> 8553</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a54aae627e24c46cfd1ce479ddfa0f3d2">ast_get_extension_label</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l08554"></a><span class="lineno"> 8554</span>&#160;{</div><div class="line"><a name="l08555"></a><span class="lineno"> 8555</span>&#160;   <span class="keywordflow">return</span> exten ? exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">label</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08556"></a><span class="lineno"> 8556</span>&#160;}</div><div class="line"><a name="l08557"></a><span class="lineno"> 8557</span>&#160;</div><div class="line"><a name="l08558"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a1662981db35d4125afaf6de98b2ba52f"> 8558</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a1662981db35d4125afaf6de98b2ba52f">ast_get_extension_priority</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l08559"></a><span class="lineno"> 8559</span>&#160;{</div><div class="line"><a name="l08560"></a><span class="lineno"> 8560</span>&#160;   <span class="keywordflow">return</span> exten ? exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> : -1;</div><div class="line"><a name="l08561"></a><span class="lineno"> 8561</span>&#160;}</div><div class="line"><a name="l08562"></a><span class="lineno"> 8562</span>&#160;</div><div class="line"><a name="l08563"></a><span class="lineno"> 8563</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l08564"></a><span class="lineno"> 8564</span>&#160;<span class="comment"> * Registrar info functions ...</span></div><div class="line"><a name="l08565"></a><span class="lineno"> 8565</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08566"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a9df0a5d301454fe924172cf89c7165a4"> 8566</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a9df0a5d301454fe924172cf89c7165a4">ast_get_context_registrar</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>)</div><div class="line"><a name="l08567"></a><span class="lineno"> 8567</span>&#160;{</div><div class="line"><a name="l08568"></a><span class="lineno"> 8568</span>&#160;   <span class="keywordflow">return</span> c ? c-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08569"></a><span class="lineno"> 8569</span>&#160;}</div><div class="line"><a name="l08570"></a><span class="lineno"> 8570</span>&#160;</div><div class="line"><a name="l08571"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a7f23f7c798d61e68c32b21d3e0cd15a2"> 8571</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a7f23f7c798d61e68c32b21d3e0cd15a2">ast_get_extension_registrar</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e)</div><div class="line"><a name="l08572"></a><span class="lineno"> 8572</span>&#160;{</div><div class="line"><a name="l08573"></a><span class="lineno"> 8573</span>&#160;   <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">registrar</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08574"></a><span class="lineno"> 8574</span>&#160;}</div><div class="line"><a name="l08575"></a><span class="lineno"> 8575</span>&#160;</div><div class="line"><a name="l08576"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a1d9b67d1b29ee2e6c3c27e14b9269410"> 8576</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a1d9b67d1b29ee2e6c3c27e14b9269410">ast_get_extension_registrar_file</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e)</div><div class="line"><a name="l08577"></a><span class="lineno"> 8577</span>&#160;{</div><div class="line"><a name="l08578"></a><span class="lineno"> 8578</span>&#160;   <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a3e3ed71b5dcbadee8292f3d1837eaa38">registrar_file</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08579"></a><span class="lineno"> 8579</span>&#160;}</div><div class="line"><a name="l08580"></a><span class="lineno"> 8580</span>&#160;</div><div class="line"><a name="l08581"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a25c1ae521dc0aa6949e716b8ce49b4e7"> 8581</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a25c1ae521dc0aa6949e716b8ce49b4e7">ast_get_extension_registrar_line</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e)</div><div class="line"><a name="l08582"></a><span class="lineno"> 8582</span>&#160;{</div><div class="line"><a name="l08583"></a><span class="lineno"> 8583</span>&#160;   <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a90ec1116822211c96e24055d95972cca">registrar_line</a> : 0;</div><div class="line"><a name="l08584"></a><span class="lineno"> 8584</span>&#160;}</div><div class="line"><a name="l08585"></a><span class="lineno"> 8585</span>&#160;</div><div class="line"><a name="l08586"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a26c679c70c1a8dd0968579be0c1755ab"> 8586</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a26c679c70c1a8dd0968579be0c1755ab">ast_get_extension_matchcid</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e)</div><div class="line"><a name="l08587"></a><span class="lineno"> 8587</span>&#160;{</div><div class="line"><a name="l08588"></a><span class="lineno"> 8588</span>&#160;   <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> : 0;</div><div class="line"><a name="l08589"></a><span class="lineno"> 8589</span>&#160;}</div><div class="line"><a name="l08590"></a><span class="lineno"> 8590</span>&#160;</div><div class="line"><a name="l08591"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aee004b6fcfccea3fa6acf9b7264f42c9"> 8591</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#aee004b6fcfccea3fa6acf9b7264f42c9">ast_get_extension_cidmatch</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e)</div><div class="line"><a name="l08592"></a><span class="lineno"> 8592</span>&#160;{</div><div class="line"><a name="l08593"></a><span class="lineno"> 8593</span>&#160;   <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a0574199c7fbb661fd7684472741955bb">cidmatch_display</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08594"></a><span class="lineno"> 8594</span>&#160;}</div><div class="line"><a name="l08595"></a><span class="lineno"> 8595</span>&#160;</div><div class="line"><a name="l08596"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974"> 8596</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e)</div><div class="line"><a name="l08597"></a><span class="lineno"> 8597</span>&#160;{</div><div class="line"><a name="l08598"></a><span class="lineno"> 8598</span>&#160;   <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">app</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08599"></a><span class="lineno"> 8599</span>&#160;}</div><div class="line"><a name="l08600"></a><span class="lineno"> 8600</span>&#160;</div><div class="line"><a name="l08601"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ac0a6c0c39796f36864868365d8989f02"> 8601</a></span>&#160;<span class="keywordtype">void</span> *<a class="code" href="../../db/d94/pbx_8c.html#ac0a6c0c39796f36864868365d8989f02">ast_get_extension_app_data</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *e)</div><div class="line"><a name="l08602"></a><span class="lineno"> 8602</span>&#160;{</div><div class="line"><a name="l08603"></a><span class="lineno"> 8603</span>&#160;   <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">data</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08604"></a><span class="lineno"> 8604</span>&#160;}</div><div class="line"><a name="l08605"></a><span class="lineno"> 8605</span>&#160;</div><div class="line"><a name="l08606"></a><span class="lineno"> 8606</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l08607"></a><span class="lineno"> 8607</span>&#160;<span class="comment"> * Walking functions ...</span></div><div class="line"><a name="l08608"></a><span class="lineno"> 8608</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08609"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a4cd5282ca555370652a7304c0c7ea4c4"> 8609</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *<a class="code" href="../../db/d94/pbx_8c.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con)</div><div class="line"><a name="l08610"></a><span class="lineno"> 8610</span>&#160;{</div><div class="line"><a name="l08611"></a><span class="lineno"> 8611</span>&#160;   <span class="keywordflow">return</span> con ? con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">next</a> : <a class="code" href="../../db/d94/pbx_8c.html#aae85d5aab50f2d1b8392d6df276f2561">contexts</a>;</div><div class="line"><a name="l08612"></a><span class="lineno"> 8612</span>&#160;}</div><div class="line"><a name="l08613"></a><span class="lineno"> 8613</span>&#160;</div><div class="line"><a name="l08614"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a505ce4b1d8e816a6163f064bc27bc2d6"> 8614</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../db/d94/pbx_8c.html#a505ce4b1d8e816a6163f064bc27bc2d6">ast_walk_context_extensions</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con,</div><div class="line"><a name="l08615"></a><span class="lineno"> 8615</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>)</div><div class="line"><a name="l08616"></a><span class="lineno"> 8616</span>&#160;{</div><div class="line"><a name="l08617"></a><span class="lineno"> 8617</span>&#160;   <span class="keywordflow">if</span> (!exten)</div><div class="line"><a name="l08618"></a><span class="lineno"> 8618</span>&#160;      <span class="keywordflow">return</span> con ? con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">root</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08619"></a><span class="lineno"> 8619</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l08620"></a><span class="lineno"> 8620</span>&#160;      <span class="keywordflow">return</span> exten-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a>;</div><div class="line"><a name="l08621"></a><span class="lineno"> 8621</span>&#160;}</div><div class="line"><a name="l08622"></a><span class="lineno"> 8622</span>&#160;</div><div class="line"><a name="l08623"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae726f7ec847da671c6d1ffc84240101f"> 8623</a></span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *<a class="code" href="../../db/d94/pbx_8c.html#ae726f7ec847da671c6d1ffc84240101f">ast_walk_context_switches</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con,</div><div class="line"><a name="l08624"></a><span class="lineno"> 8624</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *sw)</div><div class="line"><a name="l08625"></a><span class="lineno"> 8625</span>&#160;{</div><div class="line"><a name="l08626"></a><span class="lineno"> 8626</span>&#160;   <span class="keywordflow">if</span> (sw) {</div><div class="line"><a name="l08627"></a><span class="lineno"> 8627</span>&#160;      <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l08628"></a><span class="lineno"> 8628</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = 0;</div><div class="line"><a name="l08629"></a><span class="lineno"> 8629</span>&#160;</div><div class="line"><a name="l08630"></a><span class="lineno"> 8630</span>&#160;      <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a>(con); idx++) {</div><div class="line"><a name="l08631"></a><span class="lineno"> 8631</span>&#160;         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *s = <a class="code" href="../../db/d94/pbx_8c.html#a0161005b7a19bc949f2c8ebbf36a46eb">ast_context_switches_get</a>(con, idx);</div><div class="line"><a name="l08632"></a><span class="lineno"> 8632</span>&#160;</div><div class="line"><a name="l08633"></a><span class="lineno"> 8633</span>&#160;         <span class="keywordflow">if</span> (next) {</div><div class="line"><a name="l08634"></a><span class="lineno"> 8634</span>&#160;            <span class="keywordflow">return</span> s;</div><div class="line"><a name="l08635"></a><span class="lineno"> 8635</span>&#160;         }</div><div class="line"><a name="l08636"></a><span class="lineno"> 8636</span>&#160;</div><div class="line"><a name="l08637"></a><span class="lineno"> 8637</span>&#160;         <span class="keywordflow">if</span> (sw == s) {</div><div class="line"><a name="l08638"></a><span class="lineno"> 8638</span>&#160;            next = 1;</div><div class="line"><a name="l08639"></a><span class="lineno"> 8639</span>&#160;         }</div><div class="line"><a name="l08640"></a><span class="lineno"> 8640</span>&#160;      }</div><div class="line"><a name="l08641"></a><span class="lineno"> 8641</span>&#160;</div><div class="line"><a name="l08642"></a><span class="lineno"> 8642</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08643"></a><span class="lineno"> 8643</span>&#160;   }</div><div class="line"><a name="l08644"></a><span class="lineno"> 8644</span>&#160;</div><div class="line"><a name="l08645"></a><span class="lineno"> 8645</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a>(con)) {</div><div class="line"><a name="l08646"></a><span class="lineno"> 8646</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08647"></a><span class="lineno"> 8647</span>&#160;   }</div><div class="line"><a name="l08648"></a><span class="lineno"> 8648</span>&#160;</div><div class="line"><a name="l08649"></a><span class="lineno"> 8649</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a0161005b7a19bc949f2c8ebbf36a46eb">ast_context_switches_get</a>(con, 0);</div><div class="line"><a name="l08650"></a><span class="lineno"> 8650</span>&#160;}</div><div class="line"><a name="l08651"></a><span class="lineno"> 8651</span>&#160;</div><div class="line"><a name="l08652"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27"> 8652</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con)</div><div class="line"><a name="l08653"></a><span class="lineno"> 8653</span>&#160;{</div><div class="line"><a name="l08654"></a><span class="lineno"> 8654</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">alts</a>);</div><div class="line"><a name="l08655"></a><span class="lineno"> 8655</span>&#160;}</div><div class="line"><a name="l08656"></a><span class="lineno"> 8656</span>&#160;</div><div class="line"><a name="l08657"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a0161005b7a19bc949f2c8ebbf36a46eb"> 8657</a></span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d3/def/structast__sw.html">ast_sw</a> *<a class="code" href="../../db/d94/pbx_8c.html#a0161005b7a19bc949f2c8ebbf36a46eb">ast_context_switches_get</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keywordtype">int</span> idx)</div><div class="line"><a name="l08658"></a><span class="lineno"> 8658</span>&#160;{</div><div class="line"><a name="l08659"></a><span class="lineno"> 8659</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">alts</a>, idx);</div><div class="line"><a name="l08660"></a><span class="lineno"> 8660</span>&#160;}</div><div class="line"><a name="l08661"></a><span class="lineno"> 8661</span>&#160;</div><div class="line"><a name="l08662"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a6772ce6e8de86d4b6c382dbf68ea4755"> 8662</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../db/d94/pbx_8c.html#a6772ce6e8de86d4b6c382dbf68ea4755">ast_walk_extension_priorities</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>,</div><div class="line"><a name="l08663"></a><span class="lineno"> 8663</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *priority)</div><div class="line"><a name="l08664"></a><span class="lineno"> 8664</span>&#160;{</div><div class="line"><a name="l08665"></a><span class="lineno"> 8665</span>&#160;   <span class="keywordflow">return</span> priority ? priority-&gt;<a class="code" href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">peer</a> : <a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>;</div><div class="line"><a name="l08666"></a><span class="lineno"> 8666</span>&#160;}</div><div class="line"><a name="l08667"></a><span class="lineno"> 8667</span>&#160;</div><div class="line"><a name="l08668"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a1dce11e3cce31a0a487c0c3f41b8beab"> 8668</a></span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *<a class="code" href="../../db/d94/pbx_8c.html#a1dce11e3cce31a0a487c0c3f41b8beab">ast_walk_context_includes</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con,</div><div class="line"><a name="l08669"></a><span class="lineno"> 8669</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *inc)</div><div class="line"><a name="l08670"></a><span class="lineno"> 8670</span>&#160;{</div><div class="line"><a name="l08671"></a><span class="lineno"> 8671</span>&#160;   <span class="keywordflow">if</span> (inc) {</div><div class="line"><a name="l08672"></a><span class="lineno"> 8672</span>&#160;      <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l08673"></a><span class="lineno"> 8673</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = 0;</div><div class="line"><a name="l08674"></a><span class="lineno"> 8674</span>&#160;</div><div class="line"><a name="l08675"></a><span class="lineno"> 8675</span>&#160;      <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(con); idx++) {</div><div class="line"><a name="l08676"></a><span class="lineno"> 8676</span>&#160;         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *include = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">includes</a>, idx);</div><div class="line"><a name="l08677"></a><span class="lineno"> 8677</span>&#160;</div><div class="line"><a name="l08678"></a><span class="lineno"> 8678</span>&#160;         <span class="keywordflow">if</span> (next) {</div><div class="line"><a name="l08679"></a><span class="lineno"> 8679</span>&#160;            <span class="keywordflow">return</span> include;</div><div class="line"><a name="l08680"></a><span class="lineno"> 8680</span>&#160;         }</div><div class="line"><a name="l08681"></a><span class="lineno"> 8681</span>&#160;</div><div class="line"><a name="l08682"></a><span class="lineno"> 8682</span>&#160;         <span class="keywordflow">if</span> (inc == include) {</div><div class="line"><a name="l08683"></a><span class="lineno"> 8683</span>&#160;            next = 1;</div><div class="line"><a name="l08684"></a><span class="lineno"> 8684</span>&#160;         }</div><div class="line"><a name="l08685"></a><span class="lineno"> 8685</span>&#160;      }</div><div class="line"><a name="l08686"></a><span class="lineno"> 8686</span>&#160;</div><div class="line"><a name="l08687"></a><span class="lineno"> 8687</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08688"></a><span class="lineno"> 8688</span>&#160;   }</div><div class="line"><a name="l08689"></a><span class="lineno"> 8689</span>&#160;</div><div class="line"><a name="l08690"></a><span class="lineno"> 8690</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(con)) {</div><div class="line"><a name="l08691"></a><span class="lineno"> 8691</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08692"></a><span class="lineno"> 8692</span>&#160;   }</div><div class="line"><a name="l08693"></a><span class="lineno"> 8693</span>&#160;</div><div class="line"><a name="l08694"></a><span class="lineno"> 8694</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#afb93dec0c216cb07939fd15949baff2f">ast_context_includes_get</a>(con, 0);</div><div class="line"><a name="l08695"></a><span class="lineno"> 8695</span>&#160;}</div><div class="line"><a name="l08696"></a><span class="lineno"> 8696</span>&#160;</div><div class="line"><a name="l08697"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744"> 8697</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con)</div><div class="line"><a name="l08698"></a><span class="lineno"> 8698</span>&#160;{</div><div class="line"><a name="l08699"></a><span class="lineno"> 8699</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">includes</a>);</div><div class="line"><a name="l08700"></a><span class="lineno"> 8700</span>&#160;}</div><div class="line"><a name="l08701"></a><span class="lineno"> 8701</span>&#160;</div><div class="line"><a name="l08702"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#afb93dec0c216cb07939fd15949baff2f"> 8702</a></span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *<a class="code" href="../../db/d94/pbx_8c.html#afb93dec0c216cb07939fd15949baff2f">ast_context_includes_get</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keywordtype">int</span> idx)</div><div class="line"><a name="l08703"></a><span class="lineno"> 8703</span>&#160;{</div><div class="line"><a name="l08704"></a><span class="lineno"> 8704</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">includes</a>, idx);</div><div class="line"><a name="l08705"></a><span class="lineno"> 8705</span>&#160;}</div><div class="line"><a name="l08706"></a><span class="lineno"> 8706</span>&#160;</div><div class="line"><a name="l08707"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aecb1e70dc11a9dc333fcd1e74587a524"> 8707</a></span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *<a class="code" href="../../db/d94/pbx_8c.html#aecb1e70dc11a9dc333fcd1e74587a524">ast_walk_context_ignorepats</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con,</div><div class="line"><a name="l08708"></a><span class="lineno"> 8708</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *ip)</div><div class="line"><a name="l08709"></a><span class="lineno"> 8709</span>&#160;{</div><div class="line"><a name="l08710"></a><span class="lineno"> 8710</span>&#160;   <span class="keywordflow">if</span> (!con) {</div><div class="line"><a name="l08711"></a><span class="lineno"> 8711</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08712"></a><span class="lineno"> 8712</span>&#160;   }</div><div class="line"><a name="l08713"></a><span class="lineno"> 8713</span>&#160;</div><div class="line"><a name="l08714"></a><span class="lineno"> 8714</span>&#160;   <span class="keywordflow">if</span> (ip) {</div><div class="line"><a name="l08715"></a><span class="lineno"> 8715</span>&#160;      <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l08716"></a><span class="lineno"> 8716</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">next</a> = 0;</div><div class="line"><a name="l08717"></a><span class="lineno"> 8717</span>&#160;</div><div class="line"><a name="l08718"></a><span class="lineno"> 8718</span>&#160;      <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a>(con); idx++) {</div><div class="line"><a name="l08719"></a><span class="lineno"> 8719</span>&#160;         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *i = <a class="code" href="../../db/d94/pbx_8c.html#a6fee17b9633bb84f0fce209d5d42fb0a">ast_context_ignorepats_get</a>(con, idx);</div><div class="line"><a name="l08720"></a><span class="lineno"> 8720</span>&#160;</div><div class="line"><a name="l08721"></a><span class="lineno"> 8721</span>&#160;         <span class="keywordflow">if</span> (next) {</div><div class="line"><a name="l08722"></a><span class="lineno"> 8722</span>&#160;            <span class="keywordflow">return</span> i;</div><div class="line"><a name="l08723"></a><span class="lineno"> 8723</span>&#160;         }</div><div class="line"><a name="l08724"></a><span class="lineno"> 8724</span>&#160;</div><div class="line"><a name="l08725"></a><span class="lineno"> 8725</span>&#160;         <span class="keywordflow">if</span> (ip == i) {</div><div class="line"><a name="l08726"></a><span class="lineno"> 8726</span>&#160;            next = 1;</div><div class="line"><a name="l08727"></a><span class="lineno"> 8727</span>&#160;         }</div><div class="line"><a name="l08728"></a><span class="lineno"> 8728</span>&#160;      }</div><div class="line"><a name="l08729"></a><span class="lineno"> 8729</span>&#160;</div><div class="line"><a name="l08730"></a><span class="lineno"> 8730</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08731"></a><span class="lineno"> 8731</span>&#160;   }</div><div class="line"><a name="l08732"></a><span class="lineno"> 8732</span>&#160;</div><div class="line"><a name="l08733"></a><span class="lineno"> 8733</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a>(con)) {</div><div class="line"><a name="l08734"></a><span class="lineno"> 8734</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08735"></a><span class="lineno"> 8735</span>&#160;   }</div><div class="line"><a name="l08736"></a><span class="lineno"> 8736</span>&#160;</div><div class="line"><a name="l08737"></a><span class="lineno"> 8737</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a6fee17b9633bb84f0fce209d5d42fb0a">ast_context_ignorepats_get</a>(con, 0);</div><div class="line"><a name="l08738"></a><span class="lineno"> 8738</span>&#160;}</div><div class="line"><a name="l08739"></a><span class="lineno"> 8739</span>&#160;</div><div class="line"><a name="l08740"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97"> 8740</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con)</div><div class="line"><a name="l08741"></a><span class="lineno"> 8741</span>&#160;{</div><div class="line"><a name="l08742"></a><span class="lineno"> 8742</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">ignorepats</a>);</div><div class="line"><a name="l08743"></a><span class="lineno"> 8743</span>&#160;}</div><div class="line"><a name="l08744"></a><span class="lineno"> 8744</span>&#160;</div><div class="line"><a name="l08745"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a6fee17b9633bb84f0fce209d5d42fb0a"> 8745</a></span>&#160;<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a> *<a class="code" href="../../db/d94/pbx_8c.html#a6fee17b9633bb84f0fce209d5d42fb0a">ast_context_ignorepats_get</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con, <span class="keywordtype">int</span> idx)</div><div class="line"><a name="l08746"></a><span class="lineno"> 8746</span>&#160;{</div><div class="line"><a name="l08747"></a><span class="lineno"> 8747</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;con-&gt;<a class="code" href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">ignorepats</a>, idx);</div><div class="line"><a name="l08748"></a><span class="lineno"> 8748</span>&#160;}</div><div class="line"><a name="l08749"></a><span class="lineno"> 8749</span>&#160;</div><div class="line"><a name="l08750"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aca6b16b4b7433a12e65103a2f1ab8028"> 8750</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aca6b16b4b7433a12e65103a2f1ab8028">ast_context_verify_includes</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d7c/structast__context.html">ast_context</a> *con)</div><div class="line"><a name="l08751"></a><span class="lineno"> 8751</span>&#160;{</div><div class="line"><a name="l08752"></a><span class="lineno"> 8752</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l08753"></a><span class="lineno"> 8753</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l08754"></a><span class="lineno"> 8754</span>&#160;</div><div class="line"><a name="l08755"></a><span class="lineno"> 8755</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a>(con); idx++) {</div><div class="line"><a name="l08756"></a><span class="lineno"> 8756</span>&#160;      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d5/db2/structast__include.html">ast_include</a> *inc = <a class="code" href="../../db/d94/pbx_8c.html#afb93dec0c216cb07939fd15949baff2f">ast_context_includes_get</a>(con, idx);</div><div class="line"><a name="l08757"></a><span class="lineno"> 8757</span>&#160;</div><div class="line"><a name="l08758"></a><span class="lineno"> 8758</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a2af2d2771e5347b18454a05dbc98e35f">ast_context_find</a>(<a class="code" href="../../d6/d0e/pbx__include_8c.html#aeb56ec3e261d18915d12016c1cab83f3">include_rname</a>(inc))) {</div><div class="line"><a name="l08759"></a><span class="lineno"> 8759</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l08760"></a><span class="lineno"> 8760</span>&#160;      }</div><div class="line"><a name="l08761"></a><span class="lineno"> 8761</span>&#160;</div><div class="line"><a name="l08762"></a><span class="lineno"> 8762</span>&#160;      res = -1;</div><div class="line"><a name="l08763"></a><span class="lineno"> 8763</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Context &#39;%s&#39; tries to include nonexistent context &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l08764"></a><span class="lineno"> 8764</span>&#160;         <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(con), <a class="code" href="../../d6/d0e/pbx__include_8c.html#aeb56ec3e261d18915d12016c1cab83f3">include_rname</a>(inc));</div><div class="line"><a name="l08765"></a><span class="lineno"> 8765</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l08766"></a><span class="lineno"> 8766</span>&#160;   }</div><div class="line"><a name="l08767"></a><span class="lineno"> 8767</span>&#160;</div><div class="line"><a name="l08768"></a><span class="lineno"> 8768</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l08769"></a><span class="lineno"> 8769</span>&#160;}</div><div class="line"><a name="l08770"></a><span class="lineno"> 8770</span>&#160;</div><div class="line"><a name="l08771"></a><span class="lineno"> 8771</span>&#160;</div><div class="line"><a name="l08772"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a5c2ad0729efb2f13f192ee283f6f13c2"> 8772</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a5c2ad0729efb2f13f192ee283f6f13c2">__ast_goto_if_exists</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority, <span class="keywordtype">int</span> async)</div><div class="line"><a name="l08773"></a><span class="lineno"> 8773</span>&#160;{</div><div class="line"><a name="l08774"></a><span class="lineno"> 8774</span>&#160;   int (*goto_func)(<span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> <a class="code" href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>);</div><div class="line"><a name="l08775"></a><span class="lineno"> 8775</span>&#160;</div><div class="line"><a name="l08776"></a><span class="lineno"> 8776</span>&#160;   <span class="keywordflow">if</span> (!chan)</div><div class="line"><a name="l08777"></a><span class="lineno"> 8777</span>&#160;      <span class="keywordflow">return</span> -2;</div><div class="line"><a name="l08778"></a><span class="lineno"> 8778</span>&#160;</div><div class="line"><a name="l08779"></a><span class="lineno"> 8779</span>&#160;   <span class="keywordflow">if</span> (context == <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line"><a name="l08780"></a><span class="lineno"> 8780</span>&#160;      context = <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan);</div><div class="line"><a name="l08781"></a><span class="lineno"> 8781</span>&#160;   <span class="keywordflow">if</span> (exten == <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line"><a name="l08782"></a><span class="lineno"> 8782</span>&#160;      exten = <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(chan);</div><div class="line"><a name="l08783"></a><span class="lineno"> 8783</span>&#160;</div><div class="line"><a name="l08784"></a><span class="lineno"> 8784</span>&#160;   goto_func = (async) ? <a class="code" href="../../db/d94/pbx_8c.html#ae0ba2eb966a9e3376de61d30513f7302">ast_async_goto</a> : <a class="code" href="../../db/d94/pbx_8c.html#a9f840db4b5ef461ac2c0c975a57c9e89">ast_explicit_goto</a>;</div><div class="line"><a name="l08785"></a><span class="lineno"> 8785</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(chan, context, exten, priority,</div><div class="line"><a name="l08786"></a><span class="lineno"> 8786</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)))</div><div class="line"><a name="l08787"></a><span class="lineno"> 8787</span>&#160;      <span class="keywordflow">return</span> goto_func(chan, context, exten, priority);</div><div class="line"><a name="l08788"></a><span class="lineno"> 8788</span>&#160;   <span class="keywordflow">else</span> {</div><div class="line"><a name="l08789"></a><span class="lineno"> 8789</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../db/de0/pbx_8h.html#ad37eeb72ede49f9a670eb6bf3e1755cb">AST_PBX_GOTO_FAILED</a>;</div><div class="line"><a name="l08790"></a><span class="lineno"> 8790</span>&#160;   }</div><div class="line"><a name="l08791"></a><span class="lineno"> 8791</span>&#160;}</div><div class="line"><a name="l08792"></a><span class="lineno"> 8792</span>&#160;</div><div class="line"><a name="l08793"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a8f7166f50cb9642179c9b321b8143f55"> 8793</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a8f7166f50cb9642179c9b321b8143f55">ast_goto_if_exists</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span>* context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority)</div><div class="line"><a name="l08794"></a><span class="lineno"> 8794</span>&#160;{</div><div class="line"><a name="l08795"></a><span class="lineno"> 8795</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a5c2ad0729efb2f13f192ee283f6f13c2">__ast_goto_if_exists</a>(chan, context, exten, priority, 0);</div><div class="line"><a name="l08796"></a><span class="lineno"> 8796</span>&#160;}</div><div class="line"><a name="l08797"></a><span class="lineno"> 8797</span>&#160;</div><div class="line"><a name="l08798"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a281fc61f41a1be7fdd6c620372c4510b"> 8798</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a281fc61f41a1be7fdd6c620372c4510b">ast_async_goto_if_exists</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> * context, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, <span class="keywordtype">int</span> priority)</div><div class="line"><a name="l08799"></a><span class="lineno"> 8799</span>&#160;{</div><div class="line"><a name="l08800"></a><span class="lineno"> 8800</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#a5c2ad0729efb2f13f192ee283f6f13c2">__ast_goto_if_exists</a>(chan, context, exten, priority, 1);</div><div class="line"><a name="l08801"></a><span class="lineno"> 8801</span>&#160;}</div><div class="line"><a name="l08802"></a><span class="lineno"> 8802</span>&#160;</div><div class="line"><a name="l08803"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa18771ce9668fbafeb630ce5c802e6f8"> 8803</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aa18771ce9668fbafeb630ce5c802e6f8">pbx_parseable_goto</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *goto_string, <span class="keywordtype">int</span> async)</div><div class="line"><a name="l08804"></a><span class="lineno"> 8804</span>&#160;{</div><div class="line"><a name="l08805"></a><span class="lineno"> 8805</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>, *pri, *<a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l08806"></a><span class="lineno"> 8806</span>&#160;   <span class="keywordtype">char</span> *stringp;</div><div class="line"><a name="l08807"></a><span class="lineno"> 8807</span>&#160;   <span class="keywordtype">int</span> ipri;</div><div class="line"><a name="l08808"></a><span class="lineno"> 8808</span>&#160;   <span class="keywordtype">int</span> mode = 0;</div><div class="line"><a name="l08809"></a><span class="lineno"> 8809</span>&#160;   <span class="keywordtype">char</span> rest[2] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l08810"></a><span class="lineno"> 8810</span>&#160;</div><div class="line"><a name="l08811"></a><span class="lineno"> 8811</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(goto_string)) {</div><div class="line"><a name="l08812"></a><span class="lineno"> 8812</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Goto requires an argument ([[context,]extension,]priority)\n&quot;</span>);</div><div class="line"><a name="l08813"></a><span class="lineno"> 8813</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l08814"></a><span class="lineno"> 8814</span>&#160;   }</div><div class="line"><a name="l08815"></a><span class="lineno"> 8815</span>&#160;   stringp = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(goto_string);</div><div class="line"><a name="l08816"></a><span class="lineno"> 8816</span>&#160;   context = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;,&quot;</span>); <span class="comment">/* guaranteed non-null */</span></div><div class="line"><a name="l08817"></a><span class="lineno"> 8817</span>&#160;   exten = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l08818"></a><span class="lineno"> 8818</span>&#160;   pri = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l08819"></a><span class="lineno"> 8819</span>&#160;   <span class="keywordflow">if</span> (!exten) {  <span class="comment">/* Only a priority in this one */</span></div><div class="line"><a name="l08820"></a><span class="lineno"> 8820</span>&#160;      pri = <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l08821"></a><span class="lineno"> 8821</span>&#160;      exten = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08822"></a><span class="lineno"> 8822</span>&#160;      context = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08823"></a><span class="lineno"> 8823</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pri) {   <span class="comment">/* Only an extension and priority in this one */</span></div><div class="line"><a name="l08824"></a><span class="lineno"> 8824</span>&#160;      pri = <a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a>;</div><div class="line"><a name="l08825"></a><span class="lineno"> 8825</span>&#160;      exten = <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l08826"></a><span class="lineno"> 8826</span>&#160;      context = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08827"></a><span class="lineno"> 8827</span>&#160;   }</div><div class="line"><a name="l08828"></a><span class="lineno"> 8828</span>&#160;   <span class="keywordflow">if</span> (*pri == <span class="charliteral">&#39;+&#39;</span>) {</div><div class="line"><a name="l08829"></a><span class="lineno"> 8829</span>&#160;      mode = 1;</div><div class="line"><a name="l08830"></a><span class="lineno"> 8830</span>&#160;      pri++;</div><div class="line"><a name="l08831"></a><span class="lineno"> 8831</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*pri == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line"><a name="l08832"></a><span class="lineno"> 8832</span>&#160;      mode = -1;</div><div class="line"><a name="l08833"></a><span class="lineno"> 8833</span>&#160;      pri++;</div><div class="line"><a name="l08834"></a><span class="lineno"> 8834</span>&#160;   }</div><div class="line"><a name="l08835"></a><span class="lineno"> 8835</span>&#160;   <span class="keywordflow">if</span> (sscanf(pri, <span class="stringliteral">&quot;%30d%1s&quot;</span>, &amp;ipri, rest) != 1) {</div><div class="line"><a name="l08836"></a><span class="lineno"> 8836</span>&#160;      ipri = <a class="code" href="../../db/d94/pbx_8c.html#a0be9518646cf9aca4878b313cc02e901">ast_findlabel_extension</a>(chan, context ? context : <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan),</div><div class="line"><a name="l08837"></a><span class="lineno"> 8837</span>&#160;         exten ? exten : <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(chan), pri,</div><div class="line"><a name="l08838"></a><span class="lineno"> 8838</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div><div class="line"><a name="l08839"></a><span class="lineno"> 8839</span>&#160;      <span class="keywordflow">if</span> (ipri &lt; 1) {</div><div class="line"><a name="l08840"></a><span class="lineno"> 8840</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Priority &#39;%s&#39; must be a number &gt; 0, or valid label\n&quot;</span>, pri);</div><div class="line"><a name="l08841"></a><span class="lineno"> 8841</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l08842"></a><span class="lineno"> 8842</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l08843"></a><span class="lineno"> 8843</span>&#160;         mode = 0;</div><div class="line"><a name="l08844"></a><span class="lineno"> 8844</span>&#160;   }</div><div class="line"><a name="l08845"></a><span class="lineno"> 8845</span>&#160;   <span class="comment">/* At this point we have a priority and maybe an extension and a context */</span></div><div class="line"><a name="l08846"></a><span class="lineno"> 8846</span>&#160;</div><div class="line"><a name="l08847"></a><span class="lineno"> 8847</span>&#160;   <span class="keywordflow">if</span> (mode)</div><div class="line"><a name="l08848"></a><span class="lineno"> 8848</span>&#160;      ipri = <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(chan) + (ipri * mode);</div><div class="line"><a name="l08849"></a><span class="lineno"> 8849</span>&#160;</div><div class="line"><a name="l08850"></a><span class="lineno"> 8850</span>&#160;   <span class="keywordflow">if</span> (async)</div><div class="line"><a name="l08851"></a><span class="lineno"> 8851</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#ae0ba2eb966a9e3376de61d30513f7302">ast_async_goto</a>(chan, context, exten, ipri);</div><div class="line"><a name="l08852"></a><span class="lineno"> 8852</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l08853"></a><span class="lineno"> 8853</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a9f840db4b5ef461ac2c0c975a57c9e89">ast_explicit_goto</a>(chan, context, exten, ipri);</div><div class="line"><a name="l08854"></a><span class="lineno"> 8854</span>&#160;</div><div class="line"><a name="l08855"></a><span class="lineno"> 8855</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l08856"></a><span class="lineno"> 8856</span>&#160;</div><div class="line"><a name="l08857"></a><span class="lineno"> 8857</span>&#160;}</div><div class="line"><a name="l08858"></a><span class="lineno"> 8858</span>&#160;</div><div class="line"><a name="l08859"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ae9b65b0515d88371a5293dd354bfd92f"> 8859</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#ae9b65b0515d88371a5293dd354bfd92f">ast_parseable_goto</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *goto_string)</div><div class="line"><a name="l08860"></a><span class="lineno"> 8860</span>&#160;{</div><div class="line"><a name="l08861"></a><span class="lineno"> 8861</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#aa18771ce9668fbafeb630ce5c802e6f8">pbx_parseable_goto</a>(chan, goto_string, 0);</div><div class="line"><a name="l08862"></a><span class="lineno"> 8862</span>&#160;}</div><div class="line"><a name="l08863"></a><span class="lineno"> 8863</span>&#160;</div><div class="line"><a name="l08864"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#aa2caee9cd93973d6f2bc806b34f564d6"> 8864</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#aa2caee9cd93973d6f2bc806b34f564d6">ast_async_parseable_goto</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *goto_string)</div><div class="line"><a name="l08865"></a><span class="lineno"> 8865</span>&#160;{</div><div class="line"><a name="l08866"></a><span class="lineno"> 8866</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d94/pbx_8c.html#aa18771ce9668fbafeb630ce5c802e6f8">pbx_parseable_goto</a>(chan, goto_string, 1);</div><div class="line"><a name="l08867"></a><span class="lineno"> 8867</span>&#160;}</div><div class="line"><a name="l08868"></a><span class="lineno"> 8868</span>&#160;</div><div class="line"><a name="l08869"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a657e925794b2cc382b071bd81451b836"> 8869</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a657e925794b2cc382b071bd81451b836">hint_hash</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l08870"></a><span class="lineno"> 8870</span>&#160;{</div><div class="line"><a name="l08871"></a><span class="lineno"> 8871</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint = obj;</div><div class="line"><a name="l08872"></a><span class="lineno"> 8872</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/dcf/func__periodic__hook_8c.html#a364919046cab7e688f81979a59e46226">exten_name</a>;</div><div class="line"><a name="l08873"></a><span class="lineno"> 8873</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l08874"></a><span class="lineno"> 8874</span>&#160;</div><div class="line"><a name="l08875"></a><span class="lineno"> 8875</span>&#160;   exten_name = <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>);</div><div class="line"><a name="l08876"></a><span class="lineno"> 8876</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(exten_name)) {</div><div class="line"><a name="l08877"></a><span class="lineno"> 8877</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l08878"></a><span class="lineno"> 8878</span>&#160;<span class="comment">       * If the exten or extension name isn&#39;t set, return 0 so that</span></div><div class="line"><a name="l08879"></a><span class="lineno"> 8879</span>&#160;<span class="comment">       * the ao2_find() search will start in the first bucket.</span></div><div class="line"><a name="l08880"></a><span class="lineno"> 8880</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l08881"></a><span class="lineno"> 8881</span>&#160;      res = 0;</div><div class="line"><a name="l08882"></a><span class="lineno"> 8882</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l08883"></a><span class="lineno"> 8883</span>&#160;      res = <a class="code" href="../../d6/d90/strings_8h.html#ab08f8db2a7258e538a0da7417f58db58">ast_str_case_hash</a>(exten_name);</div><div class="line"><a name="l08884"></a><span class="lineno"> 8884</span>&#160;   }</div><div class="line"><a name="l08885"></a><span class="lineno"> 8885</span>&#160;</div><div class="line"><a name="l08886"></a><span class="lineno"> 8886</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l08887"></a><span class="lineno"> 8887</span>&#160;}</div><div class="line"><a name="l08888"></a><span class="lineno"> 8888</span>&#160;</div><div class="line"><a name="l08889"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a487056a5af1d0705135705f74a1e0e97"> 8889</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a487056a5af1d0705135705f74a1e0e97">hint_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l08890"></a><span class="lineno"> 8890</span>&#160;{</div><div class="line"><a name="l08891"></a><span class="lineno"> 8891</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint = obj;</div><div class="line"><a name="l08892"></a><span class="lineno"> 8892</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d00/structast__exten.html">ast_exten</a> *<a class="code" href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">exten</a> = arg;</div><div class="line"><a name="l08893"></a><span class="lineno"> 8893</span>&#160;</div><div class="line"><a name="l08894"></a><span class="lineno"> 8894</span>&#160;   <span class="keywordflow">return</span> (hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a> == exten) ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;</div><div class="line"><a name="l08895"></a><span class="lineno"> 8895</span>&#160;}</div><div class="line"><a name="l08896"></a><span class="lineno"> 8896</span>&#160;</div><div class="line"><a name="l08897"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a664a64cfc5de0467d1e7aa4ce076fef5"> 8897</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a664a64cfc5de0467d1e7aa4ce076fef5">statecbs_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l08898"></a><span class="lineno"> 8898</span>&#160;{</div><div class="line"><a name="l08899"></a><span class="lineno"> 8899</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *state_cb = obj;</div><div class="line"><a name="l08900"></a><span class="lineno"> 8900</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a2c6cd56c75fb925c726e1f400024f856">ast_state_cb_type</a> <a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a> = arg;</div><div class="line"><a name="l08901"></a><span class="lineno"> 8901</span>&#160;</div><div class="line"><a name="l08902"></a><span class="lineno"> 8902</span>&#160;   <span class="keywordflow">return</span> (state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">change_cb</a> == change_cb) ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;</div><div class="line"><a name="l08903"></a><span class="lineno"> 8903</span>&#160;}</div><div class="line"><a name="l08904"></a><span class="lineno"> 8904</span>&#160;<span class="comment"></span></div><div class="line"><a name="l08905"></a><span class="lineno"> 8905</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l08906"></a><span class="lineno"> 8906</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l08907"></a><span class="lineno"> 8907</span>&#160;<span class="comment"> * \brief Clean up resources on Asterisk shutdown</span></div><div class="line"><a name="l08908"></a><span class="lineno"> 8908</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l08909"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#ad8dce29a8b7c75e3a6ed93630d4ee713"> 8909</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#ad8dce29a8b7c75e3a6ed93630d4ee713">pbx_shutdown</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08910"></a><span class="lineno"> 8910</span>&#160;{</div><div class="line"><a name="l08911"></a><span class="lineno"> 8911</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a31197e193b1dfd6c122ff6d7c7f6b3fa">STASIS_MESSAGE_TYPE_CLEANUP</a>(hint_change_message_type);</div><div class="line"><a name="l08912"></a><span class="lineno"> 8912</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a31197e193b1dfd6c122ff6d7c7f6b3fa">STASIS_MESSAGE_TYPE_CLEANUP</a>(hint_remove_message_type);</div><div class="line"><a name="l08913"></a><span class="lineno"> 8913</span>&#160;</div><div class="line"><a name="l08914"></a><span class="lineno"> 8914</span>&#160;   <span class="keywordflow">if</span> (hints) {</div><div class="line"><a name="l08915"></a><span class="lineno"> 8915</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a4b8c1cca9dace1cf1bbadc5039f3dedf">ao2_container_unregister</a>(<span class="stringliteral">&quot;hints&quot;</span>);</div><div class="line"><a name="l08916"></a><span class="lineno"> 8916</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hints, -1);</div><div class="line"><a name="l08917"></a><span class="lineno"> 8917</span>&#160;      hints = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08918"></a><span class="lineno"> 8918</span>&#160;   }</div><div class="line"><a name="l08919"></a><span class="lineno"> 8919</span>&#160;   <span class="keywordflow">if</span> (hintdevices) {</div><div class="line"><a name="l08920"></a><span class="lineno"> 8920</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a4b8c1cca9dace1cf1bbadc5039f3dedf">ao2_container_unregister</a>(<span class="stringliteral">&quot;hintdevices&quot;</span>);</div><div class="line"><a name="l08921"></a><span class="lineno"> 8921</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hintdevices, -1);</div><div class="line"><a name="l08922"></a><span class="lineno"> 8922</span>&#160;      hintdevices = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08923"></a><span class="lineno"> 8923</span>&#160;   }</div><div class="line"><a name="l08924"></a><span class="lineno"> 8924</span>&#160;   <span class="keywordflow">if</span> (autohints) {</div><div class="line"><a name="l08925"></a><span class="lineno"> 8925</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a4b8c1cca9dace1cf1bbadc5039f3dedf">ao2_container_unregister</a>(<span class="stringliteral">&quot;autohints&quot;</span>);</div><div class="line"><a name="l08926"></a><span class="lineno"> 8926</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(autohints, -1);</div><div class="line"><a name="l08927"></a><span class="lineno"> 8927</span>&#160;      autohints = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08928"></a><span class="lineno"> 8928</span>&#160;   }</div><div class="line"><a name="l08929"></a><span class="lineno"> 8929</span>&#160;   <span class="keywordflow">if</span> (statecbs) {</div><div class="line"><a name="l08930"></a><span class="lineno"> 8930</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a4b8c1cca9dace1cf1bbadc5039f3dedf">ao2_container_unregister</a>(<span class="stringliteral">&quot;statecbs&quot;</span>);</div><div class="line"><a name="l08931"></a><span class="lineno"> 8931</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(statecbs, -1);</div><div class="line"><a name="l08932"></a><span class="lineno"> 8932</span>&#160;      statecbs = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l08933"></a><span class="lineno"> 8933</span>&#160;   }</div><div class="line"><a name="l08934"></a><span class="lineno"> 8934</span>&#160;   <span class="keywordflow">if</span> (contexts_table) {</div><div class="line"><a name="l08935"></a><span class="lineno"> 8935</span>&#160;      <a class="code" href="../../d6/da0/hashtab_8h.html#a6103589badf8d9440a0cece2802c4c3a">ast_hashtab_destroy</a>(contexts_table, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l08936"></a><span class="lineno"> 8936</span>&#160;   }</div><div class="line"><a name="l08937"></a><span class="lineno"> 8937</span>&#160;}</div><div class="line"><a name="l08938"></a><span class="lineno"> 8938</span>&#160;</div><div class="line"><a name="l08939"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a8c3585401eaf9f0d74029c238a888035"> 8939</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a8c3585401eaf9f0d74029c238a888035">print_hints_key</a>(<span class="keywordtype">void</span> *v_obj, <span class="keywordtype">void</span> *where, <a class="code" href="../../d5/da5/astobj2_8h.html#af236ed10cd1eddcbad0579ed0cf9f4c5">ao2_prnt_fn</a> *prnt)</div><div class="line"><a name="l08940"></a><span class="lineno"> 8940</span>&#160;{</div><div class="line"><a name="l08941"></a><span class="lineno"> 8941</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dac/structast__hint.html">ast_hint</a> *hint = v_obj;</div><div class="line"><a name="l08942"></a><span class="lineno"> 8942</span>&#160;</div><div class="line"><a name="l08943"></a><span class="lineno"> 8943</span>&#160;   <span class="keywordflow">if</span> (!hint) {</div><div class="line"><a name="l08944"></a><span class="lineno"> 8944</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l08945"></a><span class="lineno"> 8945</span>&#160;   }</div><div class="line"><a name="l08946"></a><span class="lineno"> 8946</span>&#160;   prnt(where, <span class="stringliteral">&quot;%s@%s&quot;</span>, <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>),</div><div class="line"><a name="l08947"></a><span class="lineno"> 8947</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<a class="code" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a>(hint-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>)));</div><div class="line"><a name="l08948"></a><span class="lineno"> 8948</span>&#160;}</div><div class="line"><a name="l08949"></a><span class="lineno"> 8949</span>&#160;</div><div class="line"><a name="l08950"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a7cf40fb61636ce16613ed58d87513027"> 8950</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a7cf40fb61636ce16613ed58d87513027">print_hintdevices_key</a>(<span class="keywordtype">void</span> *v_obj, <span class="keywordtype">void</span> *where, <a class="code" href="../../d5/da5/astobj2_8h.html#af236ed10cd1eddcbad0579ed0cf9f4c5">ao2_prnt_fn</a> *prnt)</div><div class="line"><a name="l08951"></a><span class="lineno"> 8951</span>&#160;{</div><div class="line"><a name="l08952"></a><span class="lineno"> 8952</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a> *<a class="code" href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">hintdevice</a> = v_obj;</div><div class="line"><a name="l08953"></a><span class="lineno"> 8953</span>&#160;</div><div class="line"><a name="l08954"></a><span class="lineno"> 8954</span>&#160;   <span class="keywordflow">if</span> (!hintdevice) {</div><div class="line"><a name="l08955"></a><span class="lineno"> 8955</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l08956"></a><span class="lineno"> 8956</span>&#160;   }</div><div class="line"><a name="l08957"></a><span class="lineno"> 8957</span>&#160;   prnt(where, <span class="stringliteral">&quot;%s =&gt; %s@%s&quot;</span>, hintdevice-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">hintdevice</a>,</div><div class="line"><a name="l08958"></a><span class="lineno"> 8958</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a>(hintdevice-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a>-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>),</div><div class="line"><a name="l08959"></a><span class="lineno"> 8959</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(<a class="code" href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a>(hintdevice-&gt;<a class="code" href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">hint</a>-&gt;<a class="code" href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">exten</a>)));</div><div class="line"><a name="l08960"></a><span class="lineno"> 8960</span>&#160;}</div><div class="line"><a name="l08961"></a><span class="lineno"> 8961</span>&#160;</div><div class="line"><a name="l08962"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a22a2fb8a9fa9ddcc459a538d5dc45da4"> 8962</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a22a2fb8a9fa9ddcc459a538d5dc45da4">print_autohint_key</a>(<span class="keywordtype">void</span> *v_obj, <span class="keywordtype">void</span> *where, <a class="code" href="../../d5/da5/astobj2_8h.html#af236ed10cd1eddcbad0579ed0cf9f4c5">ao2_prnt_fn</a> *prnt)</div><div class="line"><a name="l08963"></a><span class="lineno"> 8963</span>&#160;{</div><div class="line"><a name="l08964"></a><span class="lineno"> 8964</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d7f/structast__autohint.html">ast_autohint</a> *autohint = v_obj;</div><div class="line"><a name="l08965"></a><span class="lineno"> 8965</span>&#160;</div><div class="line"><a name="l08966"></a><span class="lineno"> 8966</span>&#160;   <span class="keywordflow">if</span> (!autohint) {</div><div class="line"><a name="l08967"></a><span class="lineno"> 8967</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l08968"></a><span class="lineno"> 8968</span>&#160;   }</div><div class="line"><a name="l08969"></a><span class="lineno"> 8969</span>&#160;   prnt(where, <span class="stringliteral">&quot;%s&quot;</span>, autohint-&gt;<a class="code" href="../../da/d7f/structast__autohint.html#a08658434a6786d5f55bf4f6d6a222625">context</a>);</div><div class="line"><a name="l08970"></a><span class="lineno"> 8970</span>&#160;}</div><div class="line"><a name="l08971"></a><span class="lineno"> 8971</span>&#160;</div><div class="line"><a name="l08972"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a28bae0f22e89db5fa785ae16259bd9c9"> 8972</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d94/pbx_8c.html#a28bae0f22e89db5fa785ae16259bd9c9">print_statecbs_key</a>(<span class="keywordtype">void</span> *v_obj, <span class="keywordtype">void</span> *where, <a class="code" href="../../d5/da5/astobj2_8h.html#af236ed10cd1eddcbad0579ed0cf9f4c5">ao2_prnt_fn</a> *prnt)</div><div class="line"><a name="l08973"></a><span class="lineno"> 8973</span>&#160;{</div><div class="line"><a name="l08974"></a><span class="lineno"> 8974</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> *state_cb = v_obj;</div><div class="line"><a name="l08975"></a><span class="lineno"> 8975</span>&#160;</div><div class="line"><a name="l08976"></a><span class="lineno"> 8976</span>&#160;   <span class="keywordflow">if</span> (!state_cb) {</div><div class="line"><a name="l08977"></a><span class="lineno"> 8977</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l08978"></a><span class="lineno"> 8978</span>&#160;   }</div><div class="line"><a name="l08979"></a><span class="lineno"> 8979</span>&#160;   prnt(where, <span class="stringliteral">&quot;%d&quot;</span>, state_cb-&gt;<a class="code" href="../../d6/d37/structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>);</div><div class="line"><a name="l08980"></a><span class="lineno"> 8980</span>&#160;}</div><div class="line"><a name="l08981"></a><span class="lineno"> 8981</span>&#160;</div><div class="line"><a name="l08982"></a><span class="lineno"><a class="line" href="../../db/d94/pbx_8c.html#a95d266ee6654ef26496356a20006c75c"> 8982</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../db/d94/pbx_8c.html#a95d266ee6654ef26496356a20006c75c">ast_pbx_init</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l08983"></a><span class="lineno"> 8983</span>&#160;{</div><div class="line"><a name="l08984"></a><span class="lineno"> 8984</span>&#160;   hints = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l08985"></a><span class="lineno"> 8985</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#aa8a73717c101aec8cce8641cf55aed80">HASH_EXTENHINT_SIZE</a>, <a class="code" href="../../db/d94/pbx_8c.html#a657e925794b2cc382b071bd81451b836">hint_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d94/pbx_8c.html#a487056a5af1d0705135705f74a1e0e97">hint_cmp</a>);</div><div class="line"><a name="l08986"></a><span class="lineno"> 8986</span>&#160;   <span class="keywordflow">if</span> (hints) {</div><div class="line"><a name="l08987"></a><span class="lineno"> 8987</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#abdb952d2373503555d96f02f130c5770">ao2_container_register</a>(<span class="stringliteral">&quot;hints&quot;</span>, hints, <a class="code" href="../../db/d94/pbx_8c.html#a8c3585401eaf9f0d74029c238a888035">print_hints_key</a>);</div><div class="line"><a name="l08988"></a><span class="lineno"> 8988</span>&#160;   }</div><div class="line"><a name="l08989"></a><span class="lineno"> 8989</span>&#160;   hintdevices = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l08990"></a><span class="lineno"> 8990</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#aa8a73717c101aec8cce8641cf55aed80">HASH_EXTENHINT_SIZE</a>, <a class="code" href="../../db/d94/pbx_8c.html#a605e318c7918e9a219bde85ed660c8c2">hintdevice_hash_cb</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d94/pbx_8c.html#aabf9a3a7442aeee52b849c70c6d0af33">hintdevice_cmp_multiple</a>);</div><div class="line"><a name="l08991"></a><span class="lineno"> 8991</span>&#160;   <span class="keywordflow">if</span> (hintdevices) {</div><div class="line"><a name="l08992"></a><span class="lineno"> 8992</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#abdb952d2373503555d96f02f130c5770">ao2_container_register</a>(<span class="stringliteral">&quot;hintdevices&quot;</span>, hintdevices, <a class="code" href="../../db/d94/pbx_8c.html#a7cf40fb61636ce16613ed58d87513027">print_hintdevices_key</a>);</div><div class="line"><a name="l08993"></a><span class="lineno"> 8993</span>&#160;   }</div><div class="line"><a name="l08994"></a><span class="lineno"> 8994</span>&#160;   <span class="comment">/* This is protected by the context_and_merge lock */</span></div><div class="line"><a name="l08995"></a><span class="lineno"> 8995</span>&#160;   autohints = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, 0, <a class="code" href="../../db/d94/pbx_8c.html#aa8a73717c101aec8cce8641cf55aed80">HASH_EXTENHINT_SIZE</a>,</div><div class="line"><a name="l08996"></a><span class="lineno"> 8996</span>&#160;      <a class="code" href="../../db/d94/pbx_8c.html#a7124563d8bad85417d812aab4404ceaf">autohint_hash_cb</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d94/pbx_8c.html#ae0ab68739556d89d38b0c050d6e2b469">autohint_cmp</a>);</div><div class="line"><a name="l08997"></a><span class="lineno"> 8997</span>&#160;   <span class="keywordflow">if</span> (autohints) {</div><div class="line"><a name="l08998"></a><span class="lineno"> 8998</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#abdb952d2373503555d96f02f130c5770">ao2_container_register</a>(<span class="stringliteral">&quot;autohints&quot;</span>, autohints, <a class="code" href="../../db/d94/pbx_8c.html#a22a2fb8a9fa9ddcc459a538d5dc45da4">print_autohint_key</a>);</div><div class="line"><a name="l08999"></a><span class="lineno"> 8999</span>&#160;   }</div><div class="line"><a name="l09000"></a><span class="lineno"> 9000</span>&#160;   statecbs = <a class="code" href="../../d5/da5/astobj2_8h.html#add41bd9979cb8642f81dd38aa2dfcd6d">ao2_container_alloc_list</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d94/pbx_8c.html#a664a64cfc5de0467d1e7aa4ce076fef5">statecbs_cmp</a>);</div><div class="line"><a name="l09001"></a><span class="lineno"> 9001</span>&#160;   <span class="keywordflow">if</span> (statecbs) {</div><div class="line"><a name="l09002"></a><span class="lineno"> 9002</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#abdb952d2373503555d96f02f130c5770">ao2_container_register</a>(<span class="stringliteral">&quot;statecbs&quot;</span>, statecbs, <a class="code" href="../../db/d94/pbx_8c.html#a28bae0f22e89db5fa785ae16259bd9c9">print_statecbs_key</a>);</div><div class="line"><a name="l09003"></a><span class="lineno"> 9003</span>&#160;   }</div><div class="line"><a name="l09004"></a><span class="lineno"> 9004</span>&#160;</div><div class="line"><a name="l09005"></a><span class="lineno"> 9005</span>&#160;   <a class="code" href="../../db/db2/asterisk_8h.html#a412442e1beffe5bec07ed2e9ea72afc3">ast_register_cleanup</a>(<a class="code" href="../../db/d94/pbx_8c.html#ad8dce29a8b7c75e3a6ed93630d4ee713">pbx_shutdown</a>);</div><div class="line"><a name="l09006"></a><span class="lineno"> 9006</span>&#160;</div><div class="line"><a name="l09007"></a><span class="lineno"> 9007</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d79/stasis_8h.html#a70cd046d8e3fd50de5c51aecb2830d2a">STASIS_MESSAGE_TYPE_INIT</a>(hint_change_message_type) != 0) {</div><div class="line"><a name="l09008"></a><span class="lineno"> 9008</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l09009"></a><span class="lineno"> 9009</span>&#160;   }</div><div class="line"><a name="l09010"></a><span class="lineno"> 9010</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d79/stasis_8h.html#a70cd046d8e3fd50de5c51aecb2830d2a">STASIS_MESSAGE_TYPE_INIT</a>(hint_remove_message_type) != 0) {</div><div class="line"><a name="l09011"></a><span class="lineno"> 9011</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l09012"></a><span class="lineno"> 9012</span>&#160;   }</div><div class="line"><a name="l09013"></a><span class="lineno"> 9013</span>&#160;</div><div class="line"><a name="l09014"></a><span class="lineno"> 9014</span>&#160;   <span class="keywordflow">return</span> (hints &amp;&amp; hintdevices &amp;&amp; autohints &amp;&amp; statecbs) ? 0 : -1;</div><div class="line"><a name="l09015"></a><span class="lineno"> 9015</span>&#160;}</div><div class="ttc" id="structast__exten_html_ad5d5c96b6acf265b9982ca93960b0d59"><div class="ttname"><a href="../../d7/d00/structast__exten.html#ad5d5c96b6acf265b9982ca93960b0d59">ast_exten::label</a></div><div class="ttdeci">const char * label</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00244">pbx.c:244</a></div></div>
<div class="ttc" id="astobj2_8h_html_a14c61bcab109a520a96d30c56ba5fcde"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a></div><div class="ttdeci">#define ao2_t_ref(o, delta, tag)</div><div class="ttdoc">Reference/unreference an object and return the old refcount. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00463">astobj2.h:463</a></div></div>
<div class="ttc" id="structfake__context_html_ab89d9c8c0b08ae6e239f17da8f25a7b3"><div class="ttname"><a href="../../d6/da7/structfake__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">fake_context::root_table</a></div><div class="ttdeci">struct ast_hashtab * root_table</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02430">pbx.c:2430</a></div></div>
<div class="ttc" id="structast__custom__function_html_afcd1706c9144e6d6eee6127661ae3be2"><div class="ttname"><a href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">ast_custom_function::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00119">pbx.h:119</a></div></div>
<div class="ttc" id="pbx_8c_html_a70046ced091cbd83caccdba9e719cbce"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a70046ced091cbd83caccdba9e719cbce">manager_dpsendack</a></div><div class="ttdeci">static void manager_dpsendack(struct mansession *s, const struct message *m)</div><div class="ttdoc">Send ack once. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05855">pbx.c:5855</a></div></div>
<div class="ttc" id="channel_8h_html_ac2dc872b606534943c98304aed841b34"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a></div><div class="ttdeci">struct ast_party_caller * ast_channel_caller(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00888">channel_internal_api.c:888</a></div></div>
<div class="ttc" id="structast__datastore__info_html_a763fd8db6bba8fbbbc113ca0d61c47c2"><div class="ttname"><a href="../../d9/dfb/structast__datastore__info.html#a763fd8db6bba8fbbbc113ca0d61c47c2">ast_datastore_info::type</a></div><div class="ttdeci">const char * type</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00032">datastore.h:32</a></div></div>
<div class="ttc" id="structast__include_html"><div class="ttname"><a href="../../d5/db2/structast__include.html">ast_include</a></div><div class="ttdoc">ast_include: include= support in extensions.conf </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0e/pbx__include_8c_source.html#l00037">pbx_include.c:37</a></div></div>
<div class="ttc" id="vector_8h_html_a66aaa4efda59c52384b03c38e781124d"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a></div><div class="ttdeci">#define AST_VECTOR_FREE(vec)</div><div class="ttdoc">Deallocates this vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00174">vector.h:174</a></div></div>
<div class="ttc" id="pbx_8c_html_a99c66d51539b6071efe452d9e86b299d"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a99c66d51539b6071efe452d9e86b299d">hintdevice_remove_cb</a></div><div class="ttdeci">static int hintdevice_remove_cb(void *obj, void *arg, void *data, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00504">pbx.c:504</a></div></div>
<div class="ttc" id="threadstorage_8h_html_ac268c0a8272ec11e73269392507fb1a6"><div class="ttname"><a href="../../dc/d7d/threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6">AST_THREADSTORAGE</a></div><div class="ttdeci">#define AST_THREADSTORAGE(name)</div><div class="ttdoc">Define a thread storage variable. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/threadstorage_8h_source.html#l00084">threadstorage.h:84</a></div></div>
<div class="ttc" id="pbx_8c_html_ac5308f5883751f800daddb3dfbdd7480"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ac5308f5883751f800daddb3dfbdd7480">extensionstate_buf</a></div><div class="ttdeci">static struct ast_threadstorage extensionstate_buf</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00229">pbx.c:229</a></div></div>
<div class="ttc" id="channel_8h_html_af10e3bd01602095e1908d3926afc3b76"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af10e3bd01602095e1908d3926afc3b76">ast_safe_sleep</a></div><div class="ttdeci">int ast_safe_sleep(struct ast_channel *chan, int ms)</div><div class="ttdoc">Wait for a specified amount of time, looking for hangups. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01574">channel.c:1574</a></div></div>
<div class="ttc" id="pbx_8c_html_a65bb6651308bdad136b637965835cb82"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a></div><div class="ttdeci">struct ast_context * ast_get_extension_context(struct ast_exten *exten)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08543">pbx.c:8543</a></div></div>
<div class="ttc" id="pbx_8c_html_a11b6e058f5f55637b0e7a4ecb9833b54"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a11b6e058f5f55637b0e7a4ecb9833b54">hintdevice_destroy</a></div><div class="ttdeci">static void hintdevice_destroy(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00540">pbx.c:540</a></div></div>
<div class="ttc" id="pbx_8c_html_a95d266ee6654ef26496356a20006c75c"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a95d266ee6654ef26496356a20006c75c">ast_pbx_init</a></div><div class="ttdeci">int ast_pbx_init(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08982">pbx.c:8982</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a4d63fdfe5451ec2248c16a2739190c56"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a></div><div class="ttdeci">static const char type[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00109">chan_ooh323.c:109</a></div></div>
<div class="ttc" id="pbx_8c_html_a94ca71e502d95d1cb0a815072e059aee"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a94ca71e502d95d1cb0a815072e059aee">ast_spawn_extension</a></div><div class="ttdeci">int ast_spawn_extension(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid, int *found, int combined_find_spawn)</div><div class="ttdoc">Launch a new extension (i.e. new stack) </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04204">pbx.c:4204</a></div></div>
<div class="ttc" id="chan__sip_8c_html_a14a9662e09deed264497073732fb014a"><div class="ttname"><a href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a></div><div class="ttdeci">enum sip_cc_notify_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dfe/chan__sip_8c_source.html#l00959">chan_sip.c:959</a></div></div>
<div class="ttc" id="structast__pbx__args_html"><div class="ttname"><a href="../../da/db8/structast__pbx__args.html">ast_pbx_args</a></div><div class="ttdoc">Options for ast_pbx_run() </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00391">pbx.h:391</a></div></div>
<div class="ttc" id="indications_8h_html"><div class="ttname"><a href="../../d2/d0f/indications_8h.html">indications.h</a></div><div class="ttdoc">Tone Indication Support. </div></div>
<div class="ttc" id="structast__party__name_html_a3df9119032baa1743f2db71344bd7cac"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html#a3df9119032baa1743f2db71344bd7cac">ast_party_name::presentation</a></div><div class="ttdeci">int presentation</div><div class="ttdoc">Q.931 encoded presentation-indicator encoded field. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00278">channel.h:278</a></div></div>
<div class="ttc" id="pbx_8h_html_a7e545df4a5f38ef25616c7bdf55d625faf53cb090b99fb8e952c8151990bd4192"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625faf53cb090b99fb8e952c8151990bd4192">AST_EXTENSION_DEACTIVATED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00063">pbx.h:63</a></div></div>
<div class="ttc" id="app__meetme_8c_html_a01f75a9ad916f63a94e06a27635ba278"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#a01f75a9ad916f63a94e06a27635ba278">thread</a></div><div class="ttdeci">pthread_t thread</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01089">app_meetme.c:1089</a></div></div>
<div class="ttc" id="pbx_8h_html_aa0ebd34e8d1605aa4b6e3fadea6adfb5"><div class="ttname"><a href="../../db/de0/pbx_8h.html#aa0ebd34e8d1605aa4b6e3fadea6adfb5">ast_get_switch_name</a></div><div class="ttdeci">const char * ast_get_switch_name(const struct ast_sw *sw)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d5d/pbx__sw_8c_source.html#l00048">pbx_sw.c:48</a></div></div>
<div class="ttc" id="pbx_8h_html_a3d45d3b9bc79bf6ffb1540f3e815f677"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a3d45d3b9bc79bf6ffb1540f3e815f677">ast_get_switch_registrar</a></div><div class="ttdeci">const char * ast_get_switch_registrar(const struct ast_sw *sw)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d5d/pbx__sw_8c_source.html#l00063">pbx_sw.c:63</a></div></div>
<div class="ttc" id="app__alarmreceiver_8c_html_ac2c887b7f7b359bfdda8a128980f5081"><div class="ttname"><a href="../../dc/d5c/app__alarmreceiver_8c.html#ac2c887b7f7b359bfdda8a128980f5081">digit</a></div><div class="ttdeci">char digit</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d5c/app__alarmreceiver_8c_source.html#l00131">app_alarmreceiver.c:131</a></div></div>
<div class="ttc" id="channel_8h_html_a88d833a56ea7de33e230281c5c12b75d"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a88d833a56ea7de33e230281c5c12b75d">ast_set_callerid</a></div><div class="ttdeci">void ast_set_callerid(struct ast_channel *chan, const char *cid_num, const char *cid_name, const char *cid_ani)</div><div class="ttdoc">Set caller ID number, name and ANI and generate AMI event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l07434">channel.c:7434</a></div></div>
<div class="ttc" id="pbx_8c_html_a6fb940c1fd9c74b9d573e0a91bb23697"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a></div><div class="ttdeci">const char * ast_get_extension_name(struct ast_exten *exten)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08548">pbx.c:8548</a></div></div>
<div class="ttc" id="pbx_8c_html_a1d9b67d1b29ee2e6c3c27e14b9269410"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a1d9b67d1b29ee2e6c3c27e14b9269410">ast_get_extension_registrar_file</a></div><div class="ttdeci">const char * ast_get_extension_registrar_file(struct ast_exten *e)</div><div class="ttdoc">Get name of configuration file used by registrar to register this extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08576">pbx.c:8576</a></div></div>
<div class="ttc" id="lock_8h_html_a7330ac9d36b05bad68b188c2dcfa42d7"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a7330ac9d36b05bad68b188c2dcfa42d7">ast_rwlock_rdlock</a></div><div class="ttdeci">#define ast_rwlock_rdlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00233">lock.h:233</a></div></div>
<div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00061">devicestate.h:61</a></div></div>
<div class="ttc" id="pbx_8c_html_a06e285124697319566d67b82c25aba19"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a06e285124697319566d67b82c25aba19">__ast_context_destroy</a></div><div class="ttdeci">void __ast_context_destroy(struct ast_context *list, struct ast_hashtab *contexttab, struct ast_context *con, const char *registrar)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08095">pbx.c:8095</a></div></div>
<div class="ttc" id="structfake__context_html_a8e03167ce04350be901b028cc4cf1ce1"><div class="ttname"><a href="../../d6/da7/structfake__context.html#a8e03167ce04350be901b028cc4cf1ce1">fake_context::name</a></div><div class="ttdeci">char name[256]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02440">pbx.c:2440</a></div></div>
<div class="ttc" id="asterisk_8h_html_a84666fa713cf20e8bc7e2d8524a10ce0"><div class="ttname"><a href="../../db/db2/asterisk_8h.html#a84666fa713cf20e8bc7e2d8524a10ce0">ast_mark</a></div><div class="ttdeci">int64_t ast_mark(int, int start1_stop0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d4d/astman_8c_source.html#l00103">astman.c:103</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="structnode_html"><div class="ttname"><a href="../../d5/da1/structnode.html">node</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d2b/test__heap_8c_source.html#l00038">test_heap.c:38</a></div></div>
<div class="ttc" id="musiconhold_8h_html"><div class="ttname"><a href="../../dc/d07/musiconhold_8h.html">musiconhold.h</a></div><div class="ttdoc">Music on hold handling. </div></div>
<div class="ttc" id="cli_8h_html_a5c4130cf8f1e93acfdd84416cebf1aef"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a></div><div class="ttdeci">#define AST_CLI_DEFINE(fn, txt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00197">cli.h:197</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eee"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a></div><div class="ttdeci">ast_device_state</div><div class="ttdoc">Device States. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00052">devicestate.h:52</a></div></div>
<div class="ttc" id="pbx_8c_html_ae8d2df08197cbd68d61419e6968baf27"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae8d2df08197cbd68d61419e6968baf27">ast_context_switches_count</a></div><div class="ttdeci">int ast_context_switches_count(const struct ast_context *con)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08652">pbx.c:8652</a></div></div>
<div class="ttc" id="pbx_8c_html_a23a51e49bea958a8d27c61f2a51931d9"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a23a51e49bea958a8d27c61f2a51931d9">ast_context_remove_switch2</a></div><div class="ttdeci">int ast_context_remove_switch2(struct ast_context *con, const char *sw, const char *data, const char *registrar)</div><div class="ttdoc">This function locks given context, removes switch, unlock context and return. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04920">pbx.c:4920</a></div></div>
<div class="ttc" id="structast__context_html_a6cb23af21b2834040bd20ea0031b3b8b"><div class="ttname"><a href="../../d6/d7c/structast__context.html#a6cb23af21b2834040bd20ea0031b3b8b">ast_context::ignorepats</a></div><div class="ttdeci">struct ast_ignorepats ignorepats</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00291">pbx.c:291</a></div></div>
<div class="ttc" id="pbx_8c_html_a9582d9da72e4e799183a50e4ddc90a94"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a9582d9da72e4e799183a50e4ddc90a94">pbx_outgoing_attempt</a></div><div class="ttdeci">static int pbx_outgoing_attempt(const char *type, struct ast_format_cap *cap, const char *addr, int timeout, const char *context, const char *exten, int priority, const char *app, const char *appdata, int *reason, int synchronous, const char *cid_num, const char *cid_name, struct ast_variable *vars, const char *account, struct ast_channel **locked_channel, int early_media, const struct ast_assigned_ids *assignedids, const char *predial_callee)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07755">pbx.c:7755</a></div></div>
<div class="ttc" id="structast__party__number_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_number::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber phone number (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00292">channel.h:292</a></div></div>
<div class="ttc" id="extconf_8h_html_a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be"><div class="ttname"><a href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00218">extconf.h:218</a></div></div>
<div class="ttc" id="structast__ignorepat_html_a330f40c3d5af3c94035e90e4cf4599c0"><div class="ttname"><a href="../../d0/d11/structast__ignorepat.html#a330f40c3d5af3c94035e90e4cf4599c0">ast_ignorepat::pattern</a></div><div class="ttdeci">const char pattern[0]</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d63/pbx__ignorepat_8c_source.html#l00039">pbx_ignorepat.c:39</a></div></div>
<div class="ttc" id="dial_8h_html_ab75c6f2fe91945cf61e7e91939618db2"><div class="ttname"><a href="../../df/dcf/dial_8h.html#ab75c6f2fe91945cf61e7e91939618db2">ast_dial_destroy</a></div><div class="ttdeci">int ast_dial_destroy(struct ast_dial *dial)</div><div class="ttdoc">Destroys a dialing structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l01091">dial.c:1091</a></div></div>
<div class="ttc" id="structstore__hint_html_ac2a2e2c08a623cc45757db560e06c2b4"><div class="ttname"><a href="../../d0/ddc/structstore__hint.html#ac2a2e2c08a623cc45757db560e06c2b4">store_hint::context</a></div><div class="ttdeci">char * context</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06280">pbx.c:6280</a></div></div>
<div class="ttc" id="structmessage_html"><div class="ttname"><a href="../../d8/d9e/structmessage.html">message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00144">manager.h:144</a></div></div>
<div class="ttc" id="pbx_8c_html_a22a2fb8a9fa9ddcc459a538d5dc45da4"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a22a2fb8a9fa9ddcc459a538d5dc45da4">print_autohint_key</a></div><div class="ttdeci">static void print_autohint_key(void *v_obj, void *where, ao2_prnt_fn *prnt)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08962">pbx.c:8962</a></div></div>
<div class="ttc" id="pbx_8c_html_a3c599ffe1436debbdccd45a28685b567"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3c599ffe1436debbdccd45a28685b567">ast_context_remove_ignorepat2</a></div><div class="ttdeci">int ast_context_remove_ignorepat2(struct ast_context *con, const char *ignorepat, const char *registrar)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06850">pbx.c:6850</a></div></div>
<div class="ttc" id="dial_8h_html_ab8b2433b581e1a73f860e4cf262a2890"><div class="ttname"><a href="../../df/dcf/dial_8h.html#ab8b2433b581e1a73f860e4cf262a2890">ast_dial_option_global_enable</a></div><div class="ttdeci">int ast_dial_option_global_enable(struct ast_dial *dial, enum ast_dial_option option, void *data)</div><div class="ttdoc">Enables an option globally. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l01151">dial.c:1151</a></div></div>
<div class="ttc" id="structfake__context_html_a6611ebb8017b475186f83b2a62bc25d2"><div class="ttname"><a href="../../d6/da7/structfake__context.html#a6611ebb8017b475186f83b2a62bc25d2">fake_context::root</a></div><div class="ttdeci">struct ast_exten * root</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02429">pbx.c:2429</a></div></div>
<div class="ttc" id="lock_8h_html"><div class="ttname"><a href="../../dd/d42/lock_8h.html">lock.h</a></div><div class="ttdoc">Asterisk locking-related definitions: </div></div>
<div class="ttc" id="pbx_8h_html_a7e545df4a5f38ef25616c7bdf55d625f"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625f">ast_extension_states</a></div><div class="ttdeci">ast_extension_states</div><div class="ttdoc">Extension states. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00061">pbx.h:61</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac2d42f7be13c532b6a70d50f1b8983d2"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a></div><div class="ttdeci">void astman_append(struct mansession *s, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03080">manager.c:3080</a></div></div>
<div class="ttc" id="stasis__channels_8h_html"><div class="ttname"><a href="../../d9/d4a/stasis__channels_8h.html">stasis_channels.h</a></div></div>
<div class="ttc" id="channel_8h_html_ab0eadbfdcbdad2c0e8927900ec9b98d5"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab0eadbfdcbdad2c0e8927900ec9b98d5">ast_channel_iterator_next</a></div><div class="ttdeci">struct ast_channel * ast_channel_iterator_next(struct ast_channel_iterator *i)</div><div class="ttdoc">Get the next channel for a channel iterator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01422">channel.c:1422</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="structast__exten_html"><div class="ttname"><a href="../../d7/d00/structast__exten.html">ast_exten</a></div><div class="ttdoc">ast_exten: An extension The dialplan is saved as a linked list with each context having it&amp;#39;s own link...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00237">pbx.c:237</a></div></div>
<div class="ttc" id="hashtab_8h_html_a78b1f7bc201afd020f6270378173bb79"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79">ast_hashtab_lookup</a></div><div class="ttdeci">void * ast_hashtab_lookup(struct ast_hashtab *tab, const void *obj)</div><div class="ttdoc">Lookup this object in the hash table. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00486">hashtab.c:486</a></div></div>
<div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="hashtab_8h_html_a743bfd52a8c9eb5d939ff5944758d846"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#a743bfd52a8c9eb5d939ff5944758d846">ast_hashtab_newsize_java</a></div><div class="ttdeci">int ast_hashtab_newsize_java(struct ast_hashtab *tab)</div><div class="ttdoc">Create a prime number roughly 2x the current table size. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00127">hashtab.c:127</a></div></div>
<div class="ttc" id="structast__state__cb__info_html_afb0bd6506905ab8d17df1d8bb3294fc5"><div class="ttname"><a href="../../df/d4c/structast__state__cb__info.html#afb0bd6506905ab8d17df1d8bb3294fc5">ast_state_cb_info::presence_message</a></div><div class="ttdeci">const char * presence_message</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00108">pbx.h:108</a></div></div>
<div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="pbx_8c_html_af51adb9b78f628397d7b0c1781b6d79e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#af51adb9b78f628397d7b0c1781b6d79e">__ast_internal_context_destroy</a></div><div class="ttdeci">static void __ast_internal_context_destroy(struct ast_context *con)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08050">pbx.c:8050</a></div></div>
<div class="ttc" id="structfake__context_html_a6022c8a609170c7365fb96e83cb2df48"><div class="ttname"><a href="../../d6/da7/structfake__context.html#a6022c8a609170c7365fb96e83cb2df48">fake_context::refcount</a></div><div class="ttdeci">int refcount</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02437">pbx.c:2437</a></div></div>
<div class="ttc" id="pbx_8c_html_a517e4a9ba0d6233eba58ad0f1307f55c"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a517e4a9ba0d6233eba58ad0f1307f55c">ext_strncpy</a></div><div class="ttdeci">static unsigned int ext_strncpy(char *dst, const char *src, size_t dst_size, int nofluff)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07068">pbx.c:7068</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00369">astobj2.h:369</a></div></div>
<div class="ttc" id="pbx_8c_html_a5c2ad0729efb2f13f192ee283f6f13c2"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a5c2ad0729efb2f13f192ee283f6f13c2">__ast_goto_if_exists</a></div><div class="ttdeci">static int __ast_goto_if_exists(struct ast_channel *chan, const char *context, const char *exten, int priority, int async)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08772">pbx.c:8772</a></div></div>
<div class="ttc" id="channel_8h_html_a60f9d2b0ab8b7a839902313321163b28"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a60f9d2b0ab8b7a839902313321163b28">ast_queue_control</a></div><div class="ttdeci">int ast_queue_control(struct ast_channel *chan, enum ast_control_frame_type control)</div><div class="ttdoc">Queue a control frame without payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01231">channel.c:1231</a></div></div>
<div class="ttc" id="pbx_8c_html_a805796e4728845bff70c4caf5b224308"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a></div><div class="ttdeci">int ast_unlock_context(struct ast_context *con)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08530">pbx.c:8530</a></div></div>
<div class="ttc" id="channel_8h_html_a7a8f6a50f3db42cb40cad7cfbd1d54f9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7a8f6a50f3db42cb40cad7cfbd1d54f9">ast_autoservice_start</a></div><div class="ttdeci">int ast_autoservice_start(struct ast_channel *chan)</div><div class="ttdoc">Automatically service a channel for us... </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d66/autoservice_8c_source.html#l00200">autoservice.c:200</a></div></div>
<div class="ttc" id="pbx_8h_html_a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4">AST_PBX_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00355">pbx.h:355</a></div></div>
<div class="ttc" id="pbx__private_8h_html"><div class="ttname"><a href="../../d9/da0/pbx__private_8h.html">pbx_private.h</a></div><div class="ttdoc">Private include file for pbx. </div></div>
<div class="ttc" id="pbx_8c_html_a060960d62596a2f804b6b9aec11085e2"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a060960d62596a2f804b6b9aec11085e2">parse_hint_presence</a></div><div class="ttdeci">static char * parse_hint_presence(struct ast_str *hint_args)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03037">pbx.c:3037</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00036">channelstate.h:36</a></div></div>
<div class="ttc" id="pbx_8c_html_a90e52fc3dabf4f71fd8110bda8fd1393"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a90e52fc3dabf4f71fd8110bda8fd1393">ast_context_add_include2</a></div><div class="ttdeci">int ast_context_add_include2(struct ast_context *con, const char *value, const char *registrar)</div><div class="ttdoc">Add a context include. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06726">pbx.c:6726</a></div></div>
<div class="ttc" id="pbx_8c_html_ae46143d88ad157ae0e848c7167891fa1"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae46143d88ad157ae0e848c7167891fa1">ast_add_hint</a></div><div class="ttdeci">static int ast_add_hint(struct ast_exten *e)</div><div class="ttdoc">Add hint to hint list, check initial extension state. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03982">pbx.c:3982</a></div></div>
<div class="ttc" id="structast__switch_html_a86796930e7a56540203d7a5ed97464c0"><div class="ttname"><a href="../../d9/df6/structast__switch.html#a86796930e7a56540203d7a5ed97464c0">ast_switch::exec</a></div><div class="ttdeci">ast_switch_f * exec</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00167">pbx.h:167</a></div></div>
<div class="ttc" id="pbx_8c_html_a0a1d79f17ab4af99009246a130eff8ef"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a0a1d79f17ab4af99009246a130eff8ef">ast_hint_presence_state</a></div><div class="ttdeci">int ast_hint_presence_state(struct ast_channel *c, const char *context, const char *exten, char **subtype, char **message)</div><div class="ttdoc">Uses hint and presence state callback to get the presence state of an extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03226">pbx.c:3226</a></div></div>
<div class="ttc" id="pbx_8c_html_af2ec29d1c72020b767d041c6d34b60b6"><div class="ttname"><a href="../../db/d94/pbx_8c.html#af2ec29d1c72020b767d041c6d34b60b6">alloc_device_state_info</a></div><div class="ttdeci">static struct ao2_container * alloc_device_state_info(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03076">pbx.c:3076</a></div></div>
<div class="ttc" id="pbx_8c_html_ab07357218392804a25091a0a5d03d260"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ab07357218392804a25091a0a5d03d260">EXT_DATA_SIZE</a></div><div class="ttdeci">#define EXT_DATA_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00216">pbx.c:216</a></div></div>
<div class="ttc" id="pbx_8h_html_a6e3dbc57c03c23543354ef108c31fac8"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a6e3dbc57c03c23543354ef108c31fac8">pbx_exec</a></div><div class="ttdeci">int pbx_exec(struct ast_channel *c, struct ast_app *app, const char *data)</div><div class="ttdoc">Execute an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d16/pbx__app_8c_source.html#l00471">pbx_app.c:471</a></div></div>
<div class="ttc" id="pbx_8c_html_aa2caee9cd93973d6f2bc806b34f564d6"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa2caee9cd93973d6f2bc806b34f564d6">ast_async_parseable_goto</a></div><div class="ttdeci">int ast_async_parseable_goto(struct ast_channel *chan, const char *goto_string)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08864">pbx.c:8864</a></div></div>
<div class="ttc" id="pbx_8c_html_a69b3642bb638524be829a44a1b1219db"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a69b3642bb638524be829a44a1b1219db">handle_debug_dialplan</a></div><div class="ttdeci">static char * handle_debug_dialplan(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">Send ack once. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05799">pbx.c:5799</a></div></div>
<div class="ttc" id="pbx_8c_html_adfb9d0de487a52af57ed7953508cee82"><div class="ttname"><a href="../../db/d94/pbx_8c.html#adfb9d0de487a52af57ed7953508cee82">ast_change_hint</a></div><div class="ttdeci">static int ast_change_hint(struct ast_exten *oe, struct ast_exten *ne)</div><div class="ttdoc">Change hint for an extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04096">pbx.c:4096</a></div></div>
<div class="ttc" id="pbx_8c_html_a5f96a9ab4c6286c63c25ba5dee36c4ec"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a5f96a9ab4c6286c63c25ba5dee36c4ec">exception_store_free</a></div><div class="ttdeci">static void exception_store_free(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02783">pbx.c:2783</a></div></div>
<div class="ttc" id="structast__party__number_html_a3df9119032baa1743f2db71344bd7cac"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#a3df9119032baa1743f2db71344bd7cac">ast_party_number::presentation</a></div><div class="ttdeci">int presentation</div><div class="ttdoc">Q.931 presentation-indicator and screening-indicator encoded fields. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00296">channel.h:296</a></div></div>
<div class="ttc" id="structmatch__char_html_afc8cfd0aed370c037cd78797da3313e7"><div class="ttname"><a href="../../da/d14/structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">match_char::exten</a></div><div class="ttdeci">struct ast_exten * exten</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00268">pbx.c:268</a></div></div>
<div class="ttc" id="structdialplan__counters_html_a0446d0ce125ccdc21db9b3007292115c"><div class="ttname"><a href="../../d2/dcd/structdialplan__counters.html#a0446d0ce125ccdc21db9b3007292115c">dialplan_counters::total_items</a></div><div class="ttdeci">int total_items</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05478">pbx.c:5478</a></div></div>
<div class="ttc" id="structscoreboard_html"><div class="ttname"><a href="../../db/d2d/structscoreboard.html">scoreboard</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00272">pbx.c:272</a></div></div>
<div class="ttc" id="structast__dial_html"><div class="ttname"><a href="../../db/db7/structast__dial.html">ast_dial</a></div><div class="ttdoc">Main dialing structure. Contains global options, channels being dialed, and more! ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l00048">dial.c:48</a></div></div>
<div class="ttc" id="pbx__include_8c_html_abe16a0d4e5edfd9e7ec86b255abe19a0"><div class="ttname"><a href="../../d6/d0e/pbx__include_8c.html#abe16a0d4e5edfd9e7ec86b255abe19a0">include_alloc</a></div><div class="ttdeci">struct ast_include * include_alloc(const char *value, const char *registrar)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0e/pbx__include_8c_source.html#l00074">pbx_include.c:74</a></div></div>
<div class="ttc" id="callerid_8h_html"><div class="ttname"><a href="../../de/d47/callerid_8h.html">callerid.h</a></div><div class="ttdoc">CallerID (and other GR30) management and generation Includes code and algorithms from the Zapata libr...</div></div>
<div class="ttc" id="pbx_8c_html_a26a33f5a203f8d30edc12bea10cd3f72"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a26a33f5a203f8d30edc12bea10cd3f72">ast_add_extension2_lockopt</a></div><div class="ttdeci">static int ast_add_extension2_lockopt(struct ast_context *con, int replace, const char *extension, int priority, const char *label, const char *callerid, const char *application, void *data, void(*datad)(void *), const char *registrar, const char *registrar_file, int registrar_line, int lock_context)</div><div class="ttdoc">Same as ast_add_extension2() but controls the context locking. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07325">pbx.c:7325</a></div></div>
<div class="ttc" id="structast__switch_html"><div class="ttname"><a href="../../d9/df6/structast__switch.html">ast_switch</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00160">pbx.h:160</a></div></div>
<div class="ttc" id="structdialplan__counters_html_a8a1205d5763afe73383c436bf789451b"><div class="ttname"><a href="../../d2/dcd/structdialplan__counters.html#a8a1205d5763afe73383c436bf789451b">dialplan_counters::total_exten</a></div><div class="ttdeci">int total_exten</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05480">pbx.c:5480</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad57326008c326db88dc36779741622b8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad57326008c326db88dc36779741622b8">ao2_t_alloc</a></div><div class="ttdeci">#define ao2_t_alloc(data_size, destructor_fn, debug_msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00409">astobj2.h:409</a></div></div>
<div class="ttc" id="extconf_8h_html_a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277"><div class="ttname"><a href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00216">extconf.h:216</a></div></div>
<div class="ttc" id="pbx_8h_html_a40b191a3f395775ddd84d363c8fbd030a0aa5ba413029c07073f6e915036e037f"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a0aa5ba413029c07073f6e915036e037f">AST_EXT_MATCHCID_ON</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00079">pbx.h:79</a></div></div>
<div class="ttc" id="structast__context_html_a17b7bb377cc83ce3794ce63b9f7b3c12"><div class="ttname"><a href="../../d6/d7c/structast__context.html#a17b7bb377cc83ce3794ce63b9f7b3c12">ast_context::root</a></div><div class="ttdeci">struct ast_exten * root</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00286">pbx.c:286</a></div></div>
<div class="ttc" id="pbx_8c_html_a0a6f83665eedc32f9f6d63033685f868"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a0a6f83665eedc32f9f6d63033685f868">internal_extension_state_extended</a></div><div class="ttdeci">static int internal_extension_state_extended(struct ast_channel *c, const char *context, const char *exten, struct ao2_container *device_state_info)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03141">pbx.c:3141</a></div></div>
<div class="ttc" id="pbx_8c_html_af1a624244a07626a8f70843005206c95"><div class="ttname"><a href="../../db/d94/pbx_8c.html#af1a624244a07626a8f70843005206c95">ast_rdlock_context</a></div><div class="ttdeci">int ast_rdlock_context(struct ast_context *con)</div><div class="ttdoc">Read locks a given context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08525">pbx.c:8525</a></div></div>
<div class="ttc" id="utils_8h_html_a832647380b1f97e7ac1b4492f8816d46"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a></div><div class="ttdeci">#define ast_pthread_create_detached(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00563">utils.h:563</a></div></div>
<div class="ttc" id="structast__party__connected__line_html_a8791d240f8a9c2dc271a1c8542cfe8cc"><div class="ttname"><a href="../../dc/d9e/structast__party__connected__line.html#a8791d240f8a9c2dc271a1c8542cfe8cc">ast_party_connected_line::id</a></div><div class="ttdeci">struct ast_party_id id</div><div class="ttdoc">Connected party ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00459">channel.h:459</a></div></div>
<div class="ttc" id="pbx__include_8c_html_a074a4f22541e1231de75d69e37fc4adf"><div class="ttname"><a href="../../d6/d0e/pbx__include_8c.html#a074a4f22541e1231de75d69e37fc4adf">include_free</a></div><div class="ttdeci">void include_free(struct ast_include *inc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0e/pbx__include_8c_source.html#l00106">pbx_include.c:106</a></div></div>
<div class="ttc" id="cli_8h_html_a56b6b59ee2eaa994597a5b0f4e9f9d09"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a></div><div class="ttdeci">int ast_cli_unregister_multiple(struct ast_cli_entry *e, int len)</div><div class="ttdoc">Unregister multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00030">clicompat.c:30</a></div></div>
<div class="ttc" id="dial_8h_html_a4d113a25d55a4ad9509fd954885f1dbc"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a4d113a25d55a4ad9509fd954885f1dbc">ast_dial_set_global_timeout</a></div><div class="ttdeci">void ast_dial_set_global_timeout(struct ast_dial *dial, int timeout)</div><div class="ttdoc">Set the maximum time (globally) allowed for trying to ring phones. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l01313">dial.c:1313</a></div></div>
<div class="ttc" id="pbx_8c_html_ae726f7ec847da671c6d1ffc84240101f"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae726f7ec847da671c6d1ffc84240101f">ast_walk_context_switches</a></div><div class="ttdeci">const struct ast_sw * ast_walk_context_switches(const struct ast_context *con, const struct ast_sw *sw)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08623">pbx.c:8623</a></div></div>
<div class="ttc" id="causes_8h_html_a554ad1e279785609a381c194f770f554"><div class="ttname"><a href="../../d4/da3/causes_8h.html#a554ad1e279785609a381c194f770f554">AST_CAUSE_NORMAL_TEMPORARY_FAILURE</a></div><div class="ttdeci">#define AST_CAUSE_NORMAL_TEMPORARY_FAILURE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00121">causes.h:121</a></div></div>
<div class="ttc" id="pbx_8h_html_a8a6feb7cd8e08f18c9d0f4887d7f3d47"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a8a6feb7cd8e08f18c9d0f4887d7f3d47">ast_get_ignorepat_registrar</a></div><div class="ttdeci">const char * ast_get_ignorepat_registrar(const struct ast_ignorepat *ip)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d63/pbx__ignorepat_8c_source.html#l00047">pbx_ignorepat.c:47</a></div></div>
<div class="ttc" id="channel_8h_html_ab733a7825810b895a89b629e0ea89380"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a></div><div class="ttdeci">#define ast_channel_unref(c)</div><div class="ttdoc">Decrease channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02981">channel.h:2981</a></div></div>
<div class="ttc" id="pbx_8c_html_a6fee17b9633bb84f0fce209d5d42fb0a"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a6fee17b9633bb84f0fce209d5d42fb0a">ast_context_ignorepats_get</a></div><div class="ttdeci">const struct ast_ignorepat * ast_context_ignorepats_get(const struct ast_context *con, int idx)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08745">pbx.c:8745</a></div></div>
<div class="ttc" id="structast__exten_html_a5ac083a645d964373f022d03df4849c8"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a5ac083a645d964373f022d03df4849c8">ast_exten::name</a></div><div class="ttdeci">char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00239">pbx.c:239</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a></div><div class="ttdoc">The arg parameter is a search key, but is not an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01105">astobj2.h:1105</a></div></div>
<div class="ttc" id="utils_8h_html_a67b6713ff86cf82aaed821e9a87d1c21"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a></div><div class="ttdeci">#define ast_set2_flag(p, value, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00094">utils.h:94</a></div></div>
<div class="ttc" id="channel_8h_html_ade95e66d7c53181894de1d3569aee2b8"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ade95e66d7c53181894de1d3569aee2b8">ast_party_connected_line_set_init</a></div><div class="ttdeci">void ast_party_connected_line_set_init(struct ast_party_connected_line *init, const struct ast_party_connected_line *guide)</div><div class="ttdoc">Initialize the given connected line structure using the given guide for a set update operation...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02045">channel.c:2045</a></div></div>
<div class="ttc" id="utils_8h_html_a00d4c9254c9827d6fa44f17a326744a5"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a></div><div class="ttdeci">#define ast_test_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00063">utils.h:63</a></div></div>
<div class="ttc" id="dial_8h_html_a2054b1ddc7845e78286254b366a37847a4a8c0d54e6071d1e9a36adae685406d3"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847a4a8c0d54e6071d1e9a36adae685406d3">AST_DIAL_RESULT_ANSWERED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dcf/dial_8h_source.html#l00061">dial.h:61</a></div></div>
<div class="ttc" id="pbx_8c_html_a9f840db4b5ef461ac2c0c975a57c9e89"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a9f840db4b5ef461ac2c0c975a57c9e89">ast_explicit_goto</a></div><div class="ttdeci">int ast_explicit_goto(struct ast_channel *chan, const char *context, const char *exten, int priority)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06987">pbx.c:6987</a></div></div>
<div class="ttc" id="causes_8h_html_a02b3785262e0be6843e8e9d235d8d78d"><div class="ttname"><a href="../../d4/da3/causes_8h.html#a02b3785262e0be6843e8e9d235d8d78d">AST_CAUSE_SWITCH_CONGESTION</a></div><div class="ttdeci">#define AST_CAUSE_SWITCH_CONGESTION</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00122">causes.h:122</a></div></div>
<div class="ttc" id="pbx_8c_html_aca6b16b4b7433a12e65103a2f1ab8028"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aca6b16b4b7433a12e65103a2f1ab8028">ast_context_verify_includes</a></div><div class="ttdeci">int ast_context_verify_includes(struct ast_context *con)</div><div class="ttdoc">Verifies includes in an ast_contect structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08750">pbx.c:8750</a></div></div>
<div class="ttc" id="devicestate_8h_html"><div class="ttname"><a href="../../da/da2/devicestate_8h.html">devicestate.h</a></div><div class="ttdoc">Device state management. </div></div>
<div class="ttc" id="structast__state__cb_html_ac5c5967f62e5c3601479be651a8ed76c"><div class="ttname"><a href="../../d6/d37/structast__state__cb.html#ac5c5967f62e5c3601479be651a8ed76c">ast_state_cb::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00305">pbx.c:305</a></div></div>
<div class="ttc" id="pbx_8c_html_a4cd5282ca555370652a7304c0c7ea4c4"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a></div><div class="ttdeci">struct ast_context * ast_walk_contexts(struct ast_context *con)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08609">pbx.c:8609</a></div></div>
<div class="ttc" id="pbx_8c_html_a83192a0099558f6a539fdb4e065ff99d"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a83192a0099558f6a539fdb4e065ff99d">ast_extension_close</a></div><div class="ttdeci">int ast_extension_close(const char *pattern, const char *data, int needmore)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02418">pbx.c:2418</a></div></div>
<div class="ttc" id="pbx_8c_html_ab6422b4f1e9de4cb16307bd081b8706b"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ab6422b4f1e9de4cb16307bd081b8706b">STATUS_NO_PRIORITY</a></div><div class="ttdeci">#define STATUS_NO_PRIORITY</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02469">pbx.c:2469</a></div></div>
<div class="ttc" id="pbx_8c_html_a3bf2bd297c32c358066446ceb1f4551b"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3bf2bd297c32c358066446ceb1f4551b">decrease_call_count</a></div><div class="ttdeci">static void decrease_call_count(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04670">pbx.c:4670</a></div></div>
<div class="ttc" id="pbx_8c_html_a2002365371f1915bdfda9ae2c039604b"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a2002365371f1915bdfda9ae2c039604b">ast_context_set_autohints</a></div><div class="ttdeci">void ast_context_set_autohints(struct ast_context *con, int enabled)</div><div class="ttdoc">Enable or disable autohints support on a context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06272">pbx.c:6272</a></div></div>
<div class="ttc" id="lock_8h_html_ab1d35b9611e8b5143ec695ead1b5d8d1"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab1d35b9611e8b5143ec695ead1b5d8d1">ast_rwlock_destroy</a></div><div class="ttdeci">#define ast_rwlock_destroy(rwlock)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00231">lock.h:231</a></div></div>
<div class="ttc" id="pbx_8c_html_a8c23053e0d4d87545a93ec837a19b908"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a8c23053e0d4d87545a93ec837a19b908">ast_context_remove_include2</a></div><div class="ttdeci">int ast_context_remove_include2(struct ast_context *con, const char *include, const char *registrar)</div><div class="ttdoc">Locks context, remove included contexts, unlocks context. When we call this function, &amp;conlock lock must be locked, because when we giving *con argument, some process can remove/change this context and after that there can be segfault. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04863">pbx.c:4863</a></div></div>
<div class="ttc" id="strings_8h_html_ae99d6f51ac4be6b72f8b63892cd949e1"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ae99d6f51ac4be6b72f8b63892cd949e1">ast_str_size</a></div><div class="ttdeci">size_t ast_str_size(const struct ast_str *buf)</div><div class="ttdoc">Returns the current maximum length (without reallocation) of the current buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00699">strings.h:699</a></div></div>
<div class="ttc" id="time_8h_html"><div class="ttname"><a href="../../de/df7/time_8h.html">time.h</a></div><div class="ttdoc">Time-related functions and macros. </div></div>
<div class="ttc" id="structstore__hint_html_a607486a3cfa8f0d0e80c8eb041dbcd1f"><div class="ttname"><a href="../../d0/ddc/structstore__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">store_hint::last_presence_state</a></div><div class="ttdeci">int last_presence_state</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06284">pbx.c:6284</a></div></div>
<div class="ttc" id="pbx__include_8c_html_aeb56ec3e261d18915d12016c1cab83f3"><div class="ttname"><a href="../../d6/d0e/pbx__include_8c.html#aeb56ec3e261d18915d12016c1cab83f3">include_rname</a></div><div class="ttdeci">const char * include_rname(const struct ast_include *inc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0e/pbx__include_8c_source.html#l00055">pbx_include.c:55</a></div></div>
<div class="ttc" id="gsm__explode_8c_html_a4e819f902d7ae632dd5ae75b29372f1b"><div class="ttname"><a href="../../d8/d34/gsm__explode_8c.html#a4e819f902d7ae632dd5ae75b29372f1b">bc</a></div><div class="ttdeci">#define bc</div></div>
<div class="ttc" id="structast__party__id_html_aab4036618469f3fa9ab26a22726ba2db"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">ast_party_id::name</a></div><div class="ttdeci">struct ast_party_name name</div><div class="ttdoc">Subscriber name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00341">channel.h:341</a></div></div>
<div class="ttc" id="pbx_8c_html_a487056a5af1d0705135705f74a1e0e97"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a487056a5af1d0705135705f74a1e0e97">hint_cmp</a></div><div class="ttdeci">static int hint_cmp(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08889">pbx.c:8889</a></div></div>
<div class="ttc" id="pbx_8c_html_a2afffb175879297ed07ec21df02fa6dc"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a2afffb175879297ed07ec21df02fa6dc">ast_pbx_outgoing_app</a></div><div class="ttdeci">int ast_pbx_outgoing_app(const char *type, struct ast_format_cap *cap, const char *addr, int timeout, const char *app, const char *appdata, int *reason, int synchronous, const char *cid_num, const char *cid_name, struct ast_variable *vars, const char *account, struct ast_channel **locked_channel, const struct ast_assigned_ids *assignedids)</div><div class="ttdoc">Synchronously or asynchronously make an outbound call and execute an application on the channel...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08015">pbx.c:8015</a></div></div>
<div class="ttc" id="pbx_8c_html_a86a7469073a22661d4db7086245c5b18"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a86a7469073a22661d4db7086245c5b18">pbx_set_extenpatternmatchnew</a></div><div class="ttdeci">int pbx_set_extenpatternmatchnew(int newval)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04781">pbx.c:4781</a></div></div>
<div class="ttc" id="pbx_8c_html_a4571322b2dc5414f61e4f3fe7af2331c"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a></div><div class="ttdeci">static struct ast_hashtab * contexts_table</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00777">pbx.c:777</a></div></div>
<div class="ttc" id="pbx_8c_html_aa638cd9d03f5d710b6a320ffda6d6392"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a></div><div class="ttdeci">static struct match_char * add_exten_to_pattern_tree(struct ast_context *con, struct ast_exten *e1, int findonly)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01657">pbx.c:1657</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="pbx_8c_html_aed6cfe76441ef995ab80609020a9990c"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aed6cfe76441ef995ab80609020a9990c">ast_extension_state</a></div><div class="ttdeci">int ast_extension_state(struct ast_channel *c, const char *context, const char *exten)</div><div class="ttdoc">Check extension state for an extension by using hint. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03170">pbx.c:3170</a></div></div>
<div class="ttc" id="causes_8h_html_a131d8780af378d0c4ef5075949902785"><div class="ttname"><a href="../../d4/da3/causes_8h.html#a131d8780af378d0c4ef5075949902785">AST_CAUSE_UNALLOCATED</a></div><div class="ttdeci">#define AST_CAUSE_UNALLOCATED</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00097">causes.h:97</a></div></div>
<div class="ttc" id="pbx_8c_html_a2c64874adba109557bade6a7cbfd1eea"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a2c64874adba109557bade6a7cbfd1eea">new_find_extension</a></div><div class="ttdeci">static void new_find_extension(const char *str, struct scoreboard *score, struct match_char *tree, int length, int spec, const char *callerid, const char *label, enum ext_match_t action)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01231">pbx.c:1231</a></div></div>
<div class="ttc" id="pbx_8c_html_abf4ec36d94c7f4b99cb3cd4a0bb51111"><div class="ttname"><a href="../../db/d94/pbx_8c.html#abf4ec36d94c7f4b99cb3cd4a0bb51111">extension_presence_state_helper</a></div><div class="ttdeci">static int extension_presence_state_helper(struct ast_exten *e, char **subtype, char **message)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03200">pbx.c:3200</a></div></div>
<div class="ttc" id="structast__exten_html_a90ec1116822211c96e24055d95972cca"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a90ec1116822211c96e24055d95972cca">ast_exten::registrar_line</a></div><div class="ttdeci">int registrar_line</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00255">pbx.c:255</a></div></div>
<div class="ttc" id="pbx_8c_html_a68cf7d18aa58d1ea83736f1e3a19469e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a68cf7d18aa58d1ea83736f1e3a19469e">show_dialplan_helper_extension_output</a></div><div class="ttdeci">static void show_dialplan_helper_extension_output(int fd, char *buf1, char *buf2, struct ast_exten *exten)</div><div class="ttdoc">Writes CLI output of a single extension for show dialplan. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05501">pbx.c:5501</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="namespacemake__ari__stubs_html_a40a5d58ffa6e88aa578d6683ac413105"><div class="ttname"><a href="../../d2/dc8/namespacemake__ari__stubs.html#a40a5d58ffa6e88aa578d6683ac413105">make_ari_stubs.file</a></div><div class="ttdeci">file</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/make__ari__stubs_8py_source.html#l00025">make_ari_stubs.py:25</a></div></div>
<div class="ttc" id="stasis_8h_html_a70cd046d8e3fd50de5c51aecb2830d2a"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a70cd046d8e3fd50de5c51aecb2830d2a">STASIS_MESSAGE_TYPE_INIT</a></div><div class="ttdeci">#define STASIS_MESSAGE_TYPE_INIT(name)</div><div class="ttdoc">Boiler-plate messaging macro for initializing message types. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l01501">stasis.h:1501</a></div></div>
<div class="ttc" id="structast__switch_html_aaf4e317c22482247f901b05822cdb0e1"><div class="ttname"><a href="../../d9/df6/structast__switch.html#aaf4e317c22482247f901b05822cdb0e1">ast_switch::matchmore</a></div><div class="ttdeci">ast_switch_f * matchmore</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00168">pbx.h:168</a></div></div>
<div class="ttc" id="structast__device__state__info_html_afb08eea322bbbb748cd19d547f7952fa"><div class="ttname"><a href="../../dc/d4d/structast__device__state__info.html#afb08eea322bbbb748cd19d547f7952fa">ast_device_state_info::device_name</a></div><div class="ttdeci">char device_name[1]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00099">pbx.h:99</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2448088751e4d494d1981c7f4b84e8d0"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2448088751e4d494d1981c7f4b84e8d0">OBJ_POINTER</a></div><div class="ttdeci">#define OBJ_POINTER</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01154">astobj2.h:1154</a></div></div>
<div class="ttc" id="causes_8h_html_a9e3ffd481d41079a4ed1700464c9a42a"><div class="ttname"><a href="../../d4/da3/causes_8h.html#a9e3ffd481d41079a4ed1700464c9a42a">AST_CAUSE_NETWORK_OUT_OF_ORDER</a></div><div class="ttdeci">#define AST_CAUSE_NETWORK_OUT_OF_ORDER</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00120">causes.h:120</a></div></div>
<div class="ttc" id="utils_8h_html_ab5033a1f3d781d45e7ccc27598114510"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a></div><div class="ttdeci">#define ast_set_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00070">utils.h:70</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga58c3e3da5d31739cafaee1df6ddf9342"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a></div><div class="ttdeci">void astman_send_list_complete_start(struct mansession *s, const struct message *m, const char *event_name, int count)</div><div class="ttdoc">Start the list complete event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03237">manager.c:3237</a></div></div>
<div class="ttc" id="pbx_8c_html_ab9a2fcd7b22827d129fc37fc2777c6f4"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ab9a2fcd7b22827d129fc37fc2777c6f4">load_pbx</a></div><div class="ttdeci">int load_pbx(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08460">pbx.c:8460</a></div></div>
<div class="ttc" id="structast__cli__entry_html"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a></div><div class="ttdoc">descriptor for a cli entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00171">cli.h:171</a></div></div>
<div class="ttc" id="structast__cli__args_html_a98e1d8441ca58834f11f7367be4b3345"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">ast_cli_args::argc</a></div><div class="ttdeci">const int argc</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00160">cli.h:160</a></div></div>
<div class="ttc" id="pbx_8c_html_a3a3a455c7a170e1aad15fed252cb174f"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3a3a455c7a170e1aad15fed252cb174f">publish_hint_remove</a></div><div class="ttdeci">static int publish_hint_remove(struct ast_hint *hint)</div><div class="ttdoc">Publish a hint removed event. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03924">pbx.c:3924</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="structast__state__cb_html_a46aefd6d3d8d80a5a7fa3c2c25d2638d"><div class="ttname"><a href="../../d6/d37/structast__state__cb.html#a46aefd6d3d8d80a5a7fa3c2c25d2638d">ast_state_cb::extended</a></div><div class="ttdeci">int extended</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00307">pbx.c:307</a></div></div>
<div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="pbx_8c_html_a59daa69d081df63e2454d50279185f45"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a59daa69d081df63e2454d50279185f45">context_merge_incls_swits_igps_other_registrars</a></div><div class="ttdeci">static void context_merge_incls_swits_igps_other_registrars(struct ast_context *new, struct ast_context *old, const char *registrar)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06294">pbx.c:6294</a></div></div>
<div class="ttc" id="astobj2_8h_html_a47857055118a703ae87ea5ebaf4842ed"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a></div><div class="ttdeci">#define ao2_callback(c, flags, cb_fn, arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01716">astobj2.h:1716</a></div></div>
<div class="ttc" id="pbx_8h_html_a7e545df4a5f38ef25616c7bdf55d625fa3e2a2f5572580f74e94b6d5e80261ea7"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa3e2a2f5572580f74e94b6d5e80261ea7">AST_EXTENSION_REMOVED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00062">pbx.h:62</a></div></div>
<div class="ttc" id="pbx_8c_html_a1d07989f011294a86b5557e280be666e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a1d07989f011294a86b5557e280be666e">presence_state_sub</a></div><div class="ttdeci">static struct stasis_subscription * presence_state_sub</div><div class="ttdoc">Subscription for presence state change events. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00770">pbx.c:770</a></div></div>
<div class="ttc" id="structoutgoing_html_acec9ce2df15222151ad66fcb1d74eb9f"><div class="ttname"><a href="../../de/dcd/structoutgoing.html#acec9ce2df15222151ad66fcb1d74eb9f">outgoing::priority</a></div><div class="ttdeci">int priority</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/pbx__spool_8c_source.html#l00096">pbx_spool.c:96</a></div></div>
<div class="ttc" id="logger_8h_html_a7d52159deec8b3179d27fcb4d39c30d2"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a7d52159deec8b3179d27fcb4d39c30d2">VERBOSITY_ATLEAST</a></div><div class="ttdeci">#define VERBOSITY_ATLEAST(level)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00461">logger.h:461</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00281">include/asterisk/frame.h:281</a></div></div>
<div class="ttc" id="pbx_8c_html_ae261065f1ffd04c08087b11886382530"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae261065f1ffd04c08087b11886382530">add_hintdevice</a></div><div class="ttdeci">static int add_hintdevice(struct ast_hint *hint, const char *devicelist)</div><div class="ttdoc">add hintdevice structure and link it into the container. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00552">pbx.c:552</a></div></div>
<div class="ttc" id="structast__exten_html_a3f6c079e49232c7de21109f9e7f0771c"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a3f6c079e49232c7de21109f9e7f0771c">ast_exten::cached_app</a></div><div class="ttdeci">struct ast_app * cached_app</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00247">pbx.c:247</a></div></div>
<div class="ttc" id="structast__state__cb_html"><div class="ttname"><a href="../../d6/d37/structast__state__cb.html">ast_state_cb</a></div><div class="ttdoc">ast_state_cb: An extension state notify register item </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00301">pbx.c:301</a></div></div>
<div class="ttc" id="pbx_8c_html_a5f7ea48b3f8614ef9314e5aece1f1bc3"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a5f7ea48b3f8614ef9314e5aece1f1bc3">autofallthrough</a></div><div class="ttdeci">static int autofallthrough</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00763">pbx.c:763</a></div></div>
<div class="ttc" id="pbx_8c_html_a8727e73607c8f00db1bc9c0a7f9262da"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a8727e73607c8f00db1bc9c0a7f9262da">destroy_hint</a></div><div class="ttdeci">static void destroy_hint(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03907">pbx.c:3907</a></div></div>
<div class="ttc" id="structpbx__outgoing_html_afd5237ee024d0e110e7a1fdf64234f74"><div class="ttname"><a href="../../d4/dcb/structpbx__outgoing.html#afd5237ee024d0e110e7a1fdf64234f74">pbx_outgoing::appdata</a></div><div class="ttdeci">char * appdata</div><div class="ttdoc">Application data to pass to application. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07597">pbx.c:7597</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a></div><div class="ttdeci">static int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00086">cdr_mysql.c:86</a></div></div>
<div class="ttc" id="bt__open_8c_html_a1cdd2bb1a9a71d3e1120100229315d67"><div class="ttname"><a href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a></div><div class="ttdeci">static int tmp()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1e/bt__open_8c_source.html#l00389">bt_open.c:389</a></div></div>
<div class="ttc" id="pbx_8h_html_a7e545df4a5f38ef25616c7bdf55d625fa5820eb407f3a3dbc5046c97ad43ee1f3"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa5820eb407f3a3dbc5046c97ad43ee1f3">AST_EXTENSION_UNAVAILABLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00067">pbx.h:67</a></div></div>
<div class="ttc" id="pbx_8c_html_a70382561daaa758a201b7a711d566e24"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a70382561daaa758a201b7a711d566e24">stateid</a></div><div class="ttdeci">static int stateid</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00792">pbx.c:792</a></div></div>
<div class="ttc" id="hashtab_8h_html"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html">hashtab.h</a></div><div class="ttdoc">Generic (perhaps overly so) hashtable implementation Hash Table support in Asterisk. </div></div>
<div class="ttc" id="astobj2_8h_html_add41bd9979cb8642f81dd38aa2dfcd6d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#add41bd9979cb8642f81dd38aa2dfcd6d">ao2_container_alloc_list</a></div><div class="ttdeci">#define ao2_container_alloc_list(ao2_options, container_options, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01335">astobj2.h:1335</a></div></div>
<div class="ttc" id="structast__state__cb__info_html_a3a7a902ef9b30b78b595eeee1485090f"><div class="ttname"><a href="../../df/d4c/structast__state__cb__info.html#a3a7a902ef9b30b78b595eeee1485090f">ast_state_cb_info::reason</a></div><div class="ttdeci">enum ast_state_cb_update_reason reason</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00103">pbx.h:103</a></div></div>
<div class="ttc" id="pbx_8c_html_a9800750a3fb79caa282c98556473f392"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a9800750a3fb79caa282c98556473f392">ast_context_remove_switch</a></div><div class="ttdeci">int ast_context_remove_switch(const char *context, const char *sw, const char *data, const char *registrar)</div><div class="ttdoc">Remove a switch. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04898">pbx.c:4898</a></div></div>
<div class="ttc" id="pbx_8c_html_a93f9868530c1e8a9d9d367d1ead8782e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a93f9868530c1e8a9d9d367d1ead8782e">ast_canmatch_extension</a></div><div class="ttdeci">int ast_canmatch_extension(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)</div><div class="ttdoc">Looks for a valid matching extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04194">pbx.c:4194</a></div></div>
<div class="ttc" id="pbx_8c_html_ac0a6c0c39796f36864868365d8989f02"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ac0a6c0c39796f36864868365d8989f02">ast_get_extension_app_data</a></div><div class="ttdeci">void * ast_get_extension_app_data(struct ast_exten *e)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08601">pbx.c:8601</a></div></div>
<div class="ttc" id="hashtab_8h_html_a43983b6169e9a0f9af48cca5cf9d3197"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197">ast_hashtab_next</a></div><div class="ttdeci">void * ast_hashtab_next(struct ast_hashtab_iter *it)</div><div class="ttdoc">Gets the next object in the list, advances iter one step returns null on end of traversal. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00683">hashtab.c:683</a></div></div>
<div class="ttc" id="structast__variable_html"><div class="ttname"><a href="../../dd/d02/structast__variable.html">ast_variable</a></div><div class="ttdoc">Structure for variables, used for configurations and for channel variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00083">include/asterisk/config.h:83</a></div></div>
<div class="ttc" id="pbx_8c_html_a0161005b7a19bc949f2c8ebbf36a46eb"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a0161005b7a19bc949f2c8ebbf36a46eb">ast_context_switches_get</a></div><div class="ttdeci">const struct ast_sw * ast_context_switches_get(const struct ast_context *con, int idx)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08657">pbx.c:8657</a></div></div>
<div class="ttc" id="pbx_8c_html_a6a6ee2e0a596361065c15a8795b7ea3d"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a6a6ee2e0a596361065c15a8795b7ea3d">handle_show_hints</a></div><div class="ttdeci">static char * handle_show_hints(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">handle_show_hints: CLI support for listing registered dial plan hints </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05205">pbx.c:5205</a></div></div>
<div class="ttc" id="vector_8h_html_ae9d6199727f88a8c2407cb0e004e634a"><div class="ttname"><a href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a></div><div class="ttdeci">#define AST_VECTOR_APPEND(vec, elem)</div><div class="ttdoc">Append an element to a vector, growing the vector if needed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00256">vector.h:256</a></div></div>
<div class="ttc" id="ast__expr2f_8c_html_a1b0936415a643c88ce543099c10e0d7f"><div class="ttname"><a href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a></div><div class="ttdeci">#define var</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df2/ast__expr2f_8c_source.html#l00614">ast_expr2f.c:614</a></div></div>
<div class="ttc" id="channel_8h_html_a5b14bfe21364dd8f73d45f15cf313524"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a5b14bfe21364dd8f73d45f15cf313524">ast_set_variables</a></div><div class="ttdeci">void ast_set_variables(struct ast_channel *chan, struct ast_variable *vars)</div><div class="ttdoc">adds a list of channel variables to a channel </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l08217">channel.c:8217</a></div></div>
<div class="ttc" id="group__functions_html_gaf07906b55467adaf7f84124bb6515706"><div class="ttname"><a href="../../d5/db0/group__functions.html#gaf07906b55467adaf7f84124bb6515706">testtime_write</a></div><div class="ttdeci">static int testtime_write(struct ast_channel *chan, const char *cmd, char *var, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08292">pbx.c:8292</a></div></div>
<div class="ttc" id="structstore__hint_html"><div class="ttname"><a href="../../d0/ddc/structstore__hint.html">store_hint</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06279">pbx.c:6279</a></div></div>
<div class="ttc" id="pbx_8c_html_a8845e672e1f5ce60902beeb96991459b"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a8845e672e1f5ce60902beeb96991459b">hintdevices</a></div><div class="ttdeci">static struct ao2_container * hintdevices</div><div class="ttdoc">Container for hint devices. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00363">pbx.c:363</a></div></div>
<div class="ttc" id="dial_8h_html_a2054b1ddc7845e78286254b366a37847a5cc795503d8ce3f6df21f18e7d30e24e"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847a5cc795503d8ce3f6df21f18e7d30e24e">AST_DIAL_RESULT_PROGRESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dcf/dial_8h_source.html#l00059">dial.h:59</a></div></div>
<div class="ttc" id="structstasis__subscription_html"><div class="ttname"><a href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00681">stasis.c:681</a></div></div>
<div class="ttc" id="pbx_8c_html_a7825b1b6bf1206afac71bc155cff804b"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a7825b1b6bf1206afac71bc155cff804b">NEW_MATCHER_RECURSE</a></div><div class="ttdeci">#define NEW_MATCHER_RECURSE</div></div>
<div class="ttc" id="structpbx__outgoing_html_a037644d793e72c825b54cc2deaf5783c"><div class="ttname"><a href="../../d4/dcb/structpbx__outgoing.html#a037644d793e72c825b54cc2deaf5783c">pbx_outgoing::dial_res</a></div><div class="ttdeci">int dial_res</div><div class="ttdoc">Result of the dial operation when dialed is set. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07605">pbx.c:7605</a></div></div>
<div class="ttc" id="pbx_8c_html_a01a31156d536b161d4c400af885a6b23"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a01a31156d536b161d4c400af885a6b23">hashtab_compare_extens</a></div><div class="ttdeci">static int hashtab_compare_extens(const void *ha_a, const void *ah_b)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00693">pbx.c:693</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00058">devicestate.h:58</a></div></div>
<div class="ttc" id="structscoreboard_html_a58353d0395200b159f144de279d0a9b2"><div class="ttname"><a href="../../db/d2d/structscoreboard.html#a58353d0395200b159f144de279d0a9b2">scoreboard::last_char</a></div><div class="ttdeci">char last_char</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00276">pbx.c:276</a></div></div>
<div class="ttc" id="extconf_8h_html_a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee"><div class="ttname"><a href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee">E_SPAWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00220">extconf.h:220</a></div></div>
<div class="ttc" id="channel_8h_html_a7ef6737309dc9e8b6c4a7cb4800638b1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a></div><div class="ttdeci">struct ast_frame * ast_read(struct ast_channel *chan)</div><div class="ttdoc">Reads a frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l04302">channel.c:4302</a></div></div>
<div class="ttc" id="pbx_8c_html_a7d88a9d0a54dd6e850c9ffc8d8b5314d"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a7d88a9d0a54dd6e850c9ffc8d8b5314d">handle_show_device2extenstate</a></div><div class="ttdeci">static char * handle_show_device2extenstate(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06076">pbx.c:6076</a></div></div>
<div class="ttc" id="pbx_8c_html_a657e925794b2cc382b071bd81451b836"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a657e925794b2cc382b071bd81451b836">hint_hash</a></div><div class="ttdeci">static int hint_hash(const void *obj, const int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08869">pbx.c:8869</a></div></div>
<div class="ttc" id="stasis_8h_html_a31197e193b1dfd6c122ff6d7c7f6b3fa"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a31197e193b1dfd6c122ff6d7c7f6b3fa">STASIS_MESSAGE_TYPE_CLEANUP</a></div><div class="ttdeci">#define STASIS_MESSAGE_TYPE_CLEANUP(name)</div><div class="ttdoc">Boiler-plate messaging macro for cleaning up message types. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l01523">stasis.h:1523</a></div></div>
<div class="ttc" id="pbx_8c_html_a2af2d2771e5347b18454a05dbc98e35f"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a2af2d2771e5347b18454a05dbc98e35f">ast_context_find</a></div><div class="ttdeci">struct ast_context * ast_context_find(const char *name)</div><div class="ttdoc">Find a context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02443">pbx.c:2443</a></div></div>
<div class="ttc" id="pbx_8c_html_af8449d33004759f52932db7e138c0246"><div class="ttname"><a href="../../db/d94/pbx_8c.html#af8449d33004759f52932db7e138c0246">ast_extension_state_extended</a></div><div class="ttdeci">int ast_extension_state_extended(struct ast_channel *c, const char *context, const char *exten, struct ao2_container **device_state_info)</div><div class="ttdoc">Check extended extension state for an extension by using hint. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03176">pbx.c:3176</a></div></div>
<div class="ttc" id="manager_8h_html_ab5db3cc603d7e798d61cb4cd94fbb4e2"><div class="ttname"><a href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a></div><div class="ttdeci">#define EVENT_FLAG_CALL</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00072">manager.h:72</a></div></div>
<div class="ttc" id="pbx_8c_html_af9c69ec563d1a9943f2f89706f02b7c6"><div class="ttname"><a href="../../db/d94/pbx_8c.html#af9c69ec563d1a9943f2f89706f02b7c6">INC_DST_OVERFLOW_CHECK</a></div><div class="ttdeci">#define INC_DST_OVERFLOW_CHECK</div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7">AST_DEVICE_TOTAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00062">devicestate.h:62</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00152">cli.h:152</a></div></div>
<div class="ttc" id="pbx_8c_html_ab203ba8e71a7c11736a40f7967ba1fdf"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ab203ba8e71a7c11736a40f7967ba1fdf">__ast_pbx_run</a></div><div class="ttdeci">static enum ast_pbx_result __ast_pbx_run(struct ast_channel *c, struct ast_pbx_args *args)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04310">pbx.c:4310</a></div></div>
<div class="ttc" id="pbx_8c_html_a28bae0f22e89db5fa785ae16259bd9c9"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a28bae0f22e89db5fa785ae16259bd9c9">print_statecbs_key</a></div><div class="ttdeci">static void print_statecbs_key(void *v_obj, void *where, ao2_prnt_fn *prnt)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08972">pbx.c:8972</a></div></div>
<div class="ttc" id="asterisk_8c_html_a617d1486ee651b4c894d02e1fe68fe04"><div class="ttname"><a href="../../d5/d03/asterisk_8c.html#a617d1486ee651b4c894d02e1fe68fe04">el</a></div><div class="ttdeci">static EditLine * el</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d03/asterisk_8c_source.html#l00340">asterisk.c:340</a></div></div>
<div class="ttc" id="pbx_8c_html_a2c502c100b8b4791d9efe395e08d620b"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a2c502c100b8b4791d9efe395e08d620b">ast_pbx_run_args</a></div><div class="ttdeci">enum ast_pbx_result ast_pbx_run_args(struct ast_channel *c, struct ast_pbx_args *args)</div><div class="ttdoc">Execute the PBX in the current thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04739">pbx.c:4739</a></div></div>
<div class="ttc" id="channel_8h_html_a82f2c6e4d47f62f6b65c5887eb096fd5a3f96b2798b1f93fa27bc2dff7dfd9a26"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a3f96b2798b1f93fa27bc2dff7dfd9a26">AST_FLAG_BRIDGE_HANGUP_RUN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l01019">channel.h:1019</a></div></div>
<div class="ttc" id="stasis_8h_html_a9356e8a29344ca4eac93088198ccff89"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_message_type(const struct stasis_message *msg)</div><div class="ttdoc">Get the message type for a stasis_message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00187">stasis_message.c:187</a></div></div>
<div class="ttc" id="structast__assigned__ids_html"><div class="ttname"><a href="../../da/de5/structast__assigned__ids.html">ast_assigned_ids</a></div><div class="ttdoc">Structure to pass both assignedid values to channel drivers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00605">channel.h:605</a></div></div>
<div class="ttc" id="structast__autohint_html_a08658434a6786d5f55bf4f6d6a222625"><div class="ttname"><a href="../../da/d7f/structast__autohint.html#a08658434a6786d5f55bf4f6d6a222625">ast_autohint::context</a></div><div class="ttdeci">char context[1]</div><div class="ttdoc">Name of the context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00389">pbx.c:389</a></div></div>
<div class="ttc" id="stasis_8h_html_a52b5393bef89d7781c0d039d6489de23"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a></div><div class="ttdeci">int stasis_subscription_set_filter(struct stasis_subscription *subscription, enum stasis_subscription_message_filter filter)</div><div class="ttdoc">Set the message type filtering level on a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01079">stasis.c:1079</a></div></div>
<div class="ttc" id="structast__datastore__info_html"><div class="ttname"><a href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a></div><div class="ttdoc">Structure for a data store type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00031">datastore.h:31</a></div></div>
<div class="ttc" id="pbx_8c_html_a24d50f6db8148f22eb4783ff0999d7bc"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a24d50f6db8148f22eb4783ff0999d7bc">device_state_notify_callbacks</a></div><div class="ttdeci">static void device_state_notify_callbacks(struct ast_hint *hint, struct ast_str **hint_app)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03370">pbx.c:3370</a></div></div>
<div class="ttc" id="structcfextension__states_html_a96e40dac6a068ce67b46205303d3e20a"><div class="ttname"><a href="../../d3/dd9/structcfextension__states.html#a96e40dac6a068ce67b46205303d3e20a">cfextension_states::extension_state</a></div><div class="ttdeci">int extension_state</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00607">pbx.c:607</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a></div><div class="ttdeci">ast_channel_state</div><div class="ttdoc">ast_channel states </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00035">channelstate.h:35</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6db9934459f5cdc95cb3af77d55d426e"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6db9934459f5cdc95cb3af77d55d426e">ao2_t_link</a></div><div class="ttdeci">#define ao2_t_link(container, obj, tag)</div><div class="ttdoc">Add an object to a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01547">astobj2.h:1547</a></div></div>
<div class="ttc" id="structast__party__name_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_name::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber name (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00265">channel.h:265</a></div></div>
<div class="ttc" id="structpbx__exception_html_aaee31f4cc48985167efcd38ab252dac8"><div class="ttname"><a href="../../d1/db2/structpbx__exception.html#aaee31f4cc48985167efcd38ab252dac8">pbx_exception::exten</a></div><div class="ttdeci">const ast_string_field exten</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00625">pbx.c:625</a></div></div>
<div class="ttc" id="stringfields_8h_html_a3b64083b978bdb9d28222357acf5aff7"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a3b64083b978bdb9d28222357acf5aff7">ast_calloc_with_stringfields</a></div><div class="ttdeci">#define ast_calloc_with_stringfields(n, type, size)</div><div class="ttdoc">Allocate a structure with embedded stringfields in a single allocation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00426">stringfields.h:426</a></div></div>
<div class="ttc" id="vector_8h_html_a88927df275257d9c9431252e016503ec"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a88927df275257d9c9431252e016503ec">AST_VECTOR_REMOVE_UNORDERED</a></div><div class="ttdeci">#define AST_VECTOR_REMOVE_UNORDERED(vec, idx)</div><div class="ttdoc">Remove an element from an unordered vector by index. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00438">vector.h:438</a></div></div>
<div class="ttc" id="structmatch__char_html_accb0e073a411e79bf141d0436538373c"><div class="ttname"><a href="../../da/d14/structmatch__char.html#accb0e073a411e79bf141d0436538373c">match_char::specificity</a></div><div class="ttdeci">int specificity</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00265">pbx.c:265</a></div></div>
<div class="ttc" id="dial_8h_html"><div class="ttname"><a href="../../df/dcf/dial_8h.html">dial.h</a></div><div class="ttdoc">Dialing API. </div></div>
<div class="ttc" id="pbx_8c_html_a53e8d9faad7e0156772e9559df5f8c2e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a53e8d9faad7e0156772e9559df5f8c2e">STATUS_NO_EXTENSION</a></div><div class="ttdeci">#define STATUS_NO_EXTENSION</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02468">pbx.c:2468</a></div></div>
<div class="ttc" id="structoutgoing_html_a66066052ae6571f5495a4e7f8df6c0bb"><div class="ttname"><a href="../../de/dcd/structoutgoing.html#a66066052ae6571f5495a4e7f8df6c0bb">outgoing::app</a></div><div class="ttdeci">const ast_string_field app</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/pbx__spool_8c_source.html#l00095">pbx_spool.c:95</a></div></div>
<div class="ttc" id="structast__state__cb__info_html"><div class="ttname"><a href="../../df/d4c/structast__state__cb__info.html">ast_state_cb_info</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00102">pbx.h:102</a></div></div>
<div class="ttc" id="lock_8h_html_a36233c5520173c095bf732a788356aee"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a></div><div class="ttdeci">#define ast_cond_wait(cond, mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00203">lock.h:203</a></div></div>
<div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="lock_8h_html_a69e9591803d36f5683eb9b084442be9b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a></div><div class="ttdeci">#define ast_cond_init(cond, attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00199">lock.h:199</a></div></div>
<div class="ttc" id="cli_8h_html_aea8910ed9e301e7f741f87942c244eac"><div class="ttname"><a href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a></div><div class="ttdeci">#define ast_cli_register_multiple(e, len)</div><div class="ttdoc">Register multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00265">cli.h:265</a></div></div>
<div class="ttc" id="pbx_8c_html_ac7dafac1c16b8b484834c54b532e5d66"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ac7dafac1c16b8b484834c54b532e5d66">pbx_cli</a></div><div class="ttdeci">static struct ast_cli_entry pbx_cli[]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06164">pbx.c:6164</a></div></div>
<div class="ttc" id="func__realtime_8c_html_a13d23fea305bed9188c360e245c5c9f1"><div class="ttname"><a href="../../db/d09/func__realtime_8c.html#a13d23fea305bed9188c360e245c5c9f1">buf2</a></div><div class="ttdeci">static struct ast_threadstorage buf2</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d09/func__realtime_8c_source.html#l00179">func_realtime.c:179</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad36841ab6daa3997f7ca7047ad2d033a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a></div><div class="ttdeci">void ao2_iterator_destroy(struct ao2_iterator *iter)</div><div class="ttdoc">Destroy a container iterator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00534">astobj2_container.c:534</a></div></div>
<div class="ttc" id="pbx_8c_html_ae135baf3c18339a7584b0310cbf738d9"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae135baf3c18339a7584b0310cbf738d9">add_pattern_node</a></div><div class="ttdeci">static struct match_char * add_pattern_node(struct ast_context *con, struct match_char *current, const struct pattern_node *pattern, int is_pattern, int already, struct match_char **nextcharptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01459">pbx.c:1459</a></div></div>
<div class="ttc" id="structast__hintdevice_html_a72bc97746896cb5fabbadf2c0bbb8ac7"><div class="ttname"><a href="../../df/d6f/structast__hintdevice.html#a72bc97746896cb5fabbadf2c0bbb8ac7">ast_hintdevice::hint</a></div><div class="ttdeci">struct ast_hint * hint</div><div class="ttdoc">Hint this hintdevice belongs to. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00374">pbx.c:374</a></div></div>
<div class="ttc" id="structdialplan__counters_html_a3f947ad80dce92dd50952d6633061166"><div class="ttname"><a href="../../d2/dcd/structdialplan__counters.html#a3f947ad80dce92dd50952d6633061166">dialplan_counters::context_existence</a></div><div class="ttdeci">int context_existence</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05482">pbx.c:5482</a></div></div>
<div class="ttc" id="pbx_8c_html_a3be3741c204cd685110243af9daec104"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3be3741c204cd685110243af9daec104">ast_add_extension2</a></div><div class="ttdeci">int ast_add_extension2(struct ast_context *con, int replace, const char *extension, int priority, const char *label, const char *callerid, const char *application, void *data, void(*datad)(void *), const char *registrar, const char *registrar_file, int registrar_line)</div><div class="ttdoc">Main interface to add extensions to the list for out context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07299">pbx.c:7299</a></div></div>
<div class="ttc" id="pbx_8h_html_a2bf7469cd4b7de5d4de43d58aeff46c5"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a2bf7469cd4b7de5d4de43d58aeff46c5">ast_get_include_registrar</a></div><div class="ttdeci">const char * ast_get_include_registrar(const struct ast_include *i)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0e/pbx__include_8c_source.html#l00060">pbx_include.c:60</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390">ast_control_frame_type</a></div><div class="ttdeci">ast_control_frame_type</div><div class="ttdoc">Internal control frame subtype field values. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00277">include/asterisk/frame.h:277</a></div></div>
<div class="ttc" id="app__voicemail_8c_html_abe15777a07ac747625b018ac01f92531"><div class="ttname"><a href="../../dc/df4/app__voicemail_8c.html#abe15777a07ac747625b018ac01f92531">copy</a></div><div class="ttdeci">static int copy(char *infile, char *outfile)</div><div class="ttdoc">Utility function to copy a file. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df4/app__voicemail_8c_source.html#l04629">app_voicemail.c:4629</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="structmatch__char_html_ac603db225d03f7ba125a0e2af1a37130"><div class="ttname"><a href="../../da/d14/structmatch__char.html#ac603db225d03f7ba125a0e2af1a37130">match_char::alt_char</a></div><div class="ttdeci">struct match_char * alt_char</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00266">pbx.c:266</a></div></div>
<div class="ttc" id="stringfields_8h_html_a061580e89c55282a7140fa3fdfd52b6d"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a061580e89c55282a7140fa3fdfd52b6d">AST_DECLARE_STRING_FIELDS</a></div><div class="ttdeci">#define AST_DECLARE_STRING_FIELDS(field_list)</div><div class="ttdoc">Declare the fields needed in a structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00337">stringfields.h:337</a></div></div>
<div class="ttc" id="channel_8h_html_a17e5eed14e9256176bb685dc7bac620a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a17e5eed14e9256176bb685dc7bac620a">ast_channel_yank</a></div><div class="ttdeci">struct ast_channel * ast_channel_yank(struct ast_channel *yankee)</div><div class="ttdoc">Gain control of a channel in the system. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10794">channel.c:10794</a></div></div>
<div class="ttc" id="logger_8h_html_a6db44a7e26f0bc42801fc7225817c6a1"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a6db44a7e26f0bc42801fc7225817c6a1">ast_callid</a></div><div class="ttdeci">unsigned int ast_callid</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00087">logger.h:87</a></div></div>
<div class="ttc" id="structstore__hint_html_af952513176652fdf6919b7eafad109b7"><div class="ttname"><a href="../../d0/ddc/structstore__hint.html#af952513176652fdf6919b7eafad109b7">store_hint::last_presence_message</a></div><div class="ttdeci">char * last_presence_message</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06286">pbx.c:6286</a></div></div>
<div class="ttc" id="structast__presence__state__message_html"><div class="ttname"><a href="../../d2/db9/structast__presence__state__message.html">ast_presence_state_message</a></div><div class="ttdoc">Stasis message payload representing a presence state update. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd7/presencestate_8h_source.html#l00184">presencestate.h:184</a></div></div>
<div class="ttc" id="astobj2_8h_html_ab3c44e28d661616129b7819069effe61"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a></div><div class="ttdeci">#define ao2_alloc_options(data_size, destructor_fn, options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00406">astobj2.h:406</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="pbx_8c_html_a9ee5452cfa6d5969707e3e47d658601d"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a9ee5452cfa6d5969707e3e47d658601d">context_merge_lock</a></div><div class="ttdeci">static ast_mutex_t context_merge_lock</div><div class="ttdoc">Lock to hold off restructuring of hints by ast_merge_contexts_and_delete. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00790">pbx.c:790</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00282">include/asterisk/frame.h:282</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00042">channelstate.h:42</a></div></div>
<div class="ttc" id="group__main__options_html_ga908239c63cc433cbefa4aa6f5efcb830"><div class="ttname"><a href="../../d6/dd6/group__main__options.html#ga908239c63cc433cbefa4aa6f5efcb830">ast_option_maxload</a></div><div class="ttdeci">double ast_option_maxload</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00077">options.c:77</a></div></div>
<div class="ttc" id="dial_8h_html_aaa04d25740b60e15179613e6465cff39aa437507093303f10b9b62ec2132cd00b"><div class="ttname"><a href="../../df/dcf/dial_8h.html#aaa04d25740b60e15179613e6465cff39aa437507093303f10b9b62ec2132cd00b">AST_DIAL_OPTION_PREDIAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dcf/dial_8h_source.html#l00047">dial.h:47</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_acd9db00336027462cfb25b97b5356883"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a></div><div class="ttdeci">static struct test_val c</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00048">test_linkedlists.c:48</a></div></div>
<div class="ttc" id="structchannel_html"><div class="ttname"><a href="../../d4/d84/structchannel.html">channel</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8a/muted_8c_source.html#l00095">muted.c:95</a></div></div>
<div class="ttc" id="chan__iax2_8c_html_a7dd0190efe1c61151a9dbab078bdb263"><div class="ttname"><a href="../../d5/dff/chan__iax2_8c.html#a7dd0190efe1c61151a9dbab078bdb263">match</a></div><div class="ttdeci">static int match(struct ast_sockaddr *addr, unsigned short callno, unsigned short dcallno, const struct chan_iax2_pvt *cur, int check_dcallno)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dff/chan__iax2_8c_source.html#l02315">chan_iax2.c:2315</a></div></div>
<div class="ttc" id="strings_8h_html_a7fc844c12b769ccded05e7514036e241"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a7fc844c12b769ccded05e7514036e241">ast_str_alloca</a></div><div class="ttdeci">#define ast_str_alloca(init_len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00800">strings.h:800</a></div></div>
<div class="ttc" id="structfake__context_html_aa05090666ce7a4905fe1b56b4fdd3be3"><div class="ttname"><a href="../../d6/da7/structfake__context.html#aa05090666ce7a4905fe1b56b4fdd3be3">fake_context::registrar</a></div><div class="ttdeci">const char * registrar</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02436">pbx.c:2436</a></div></div>
<div class="ttc" id="extconf_8h_html_a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba"><div class="ttname"><a href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00217">extconf.h:217</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01032">astobj2.h:1032</a></div></div>
<div class="ttc" id="structast__datastore_html"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html">ast_datastore</a></div><div class="ttdoc">Structure for a data store object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00068">datastore.h:68</a></div></div>
<div class="ttc" id="channel_8h_html_aad1e09cd7c79237d05cffb45d6cdfd7c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c">ast_channel_datastore_find</a></div><div class="ttdeci">struct ast_datastore * ast_channel_datastore_find(struct ast_channel *chan, const struct ast_datastore_info *info, const char *uid)</div><div class="ttdoc">Find a datastore on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02404">channel.c:2404</a></div></div>
<div class="ttc" id="app__jack_8c_html_af25d6dc49269fa2003ac7c7fa6f13915"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></div><div class="ttdeci">const char * str</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00147">app_jack.c:147</a></div></div>
<div class="ttc" id="file_8h_html"><div class="ttname"><a href="../../d2/d4d/file_8h.html">file.h</a></div><div class="ttdoc">Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include mod_format.h. </div></div>
<div class="ttc" id="pbx_8c_html_aad72a88ef3aa3258d69475cd14f274d0"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aad72a88ef3aa3258d69475cd14f274d0">hashtab_compare_exten_labels</a></div><div class="ttdeci">static int hashtab_compare_exten_labels(const void *ah_a, const void *ah_b)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00728">pbx.c:728</a></div></div>
<div class="ttc" id="structpbx__exception_html"><div class="ttname"><a href="../../d1/db2/structpbx__exception.html">pbx_exception</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00620">pbx.c:620</a></div></div>
<div class="ttc" id="structpbx__outgoing_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../d4/dcb/structpbx__outgoing.html#a1c7181c39f99ee801943a0d0aa9872b9">pbx_outgoing::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdoc">Condition for synchronous dialing. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07593">pbx.c:7593</a></div></div>
<div class="ttc" id="dial_8h_html_a2054b1ddc7845e78286254b366a37847a23fe48f529c8d06fa7dffc976a871a16"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847a23fe48f529c8d06fa7dffc976a871a16">AST_DIAL_RESULT_HANGUP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dcf/dial_8h_source.html#l00063">dial.h:63</a></div></div>
<div class="ttc" id="test__func__file_8c_html_a7df83d295429a2562396f1ec127a46c0"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a></div><div class="ttdeci">const char * args</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00046">test_func_file.c:46</a></div></div>
<div class="ttc" id="structfake__context_html_a34eb63008d294b713376e64bb2a7b2ef"><div class="ttname"><a href="../../d6/da7/structfake__context.html#a34eb63008d294b713376e64bb2a7b2ef">fake_context::macrolock</a></div><div class="ttdeci">ast_mutex_t macrolock</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02439">pbx.c:2439</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structpbx__find__info_html_a5316dcae577cc913943c7a2b6e00c6da"><div class="ttname"><a href="../../db/d81/structpbx__find__info.html#a5316dcae577cc913943c7a2b6e00c6da">pbx_find_info::incstack</a></div><div class="ttdeci">char * incstack[AST_PBX_MAX_STACK]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00237">extconf.h:237</a></div></div>
<div class="ttc" id="conf2ael_8c_html_a71549c9ba7fb62eeb7c04b697e716543"><div class="ttname"><a href="../../de/dcc/conf2ael_8c.html#a71549c9ba7fb62eeb7c04b697e716543">local_contexts</a></div><div class="ttdeci">struct ast_context * local_contexts</div></div>
<div class="ttc" id="pbx_8c_html_ae4a0bd08dbd3bc22fc65de969d3bfa45"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae4a0bd08dbd3bc22fc65de969d3bfa45">hashtab_hash_labels</a></div><div class="ttdeci">static unsigned int hashtab_hash_labels(const void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00757">pbx.c:757</a></div></div>
<div class="ttc" id="structcfextension__states_html_aecfd3170c3d94608e5e5c038085fdf3f"><div class="ttname"><a href="../../d3/dd9/structcfextension__states.html#aecfd3170c3d94608e5e5c038085fdf3f">cfextension_states::text</a></div><div class="ttdeci">const char *const text</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00608">pbx.c:608</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_a8fd806ad19b8f5513a4cf18cbf77532c"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a></div><div class="ttdeci">char * end</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">eagi_proxy.c:73</a></div></div>
<div class="ttc" id="pbx_8c_html_a0bf66af78336396b8c8336830130d93b"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a0bf66af78336396b8c8336830130d93b">pbx_dial_reason</a></div><div class="ttdeci">static enum ast_control_frame_type pbx_dial_reason(enum ast_dial_result dial_result, int cause)</div><div class="ttdoc">Attempt to convert disconnect cause to old originate reason. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07716">pbx.c:7716</a></div></div>
<div class="ttc" id="manager_8h_html_a1d34461b8a3210b19e66f06bcdebfeb3"><div class="ttname"><a href="../../db/d45/manager_8h.html#a1d34461b8a3210b19e66f06bcdebfeb3">ast_manager_register_xml_core</a></div><div class="ttdeci">#define ast_manager_register_xml_core(action, authority, func)</div><div class="ttdoc">Register a manager callback using XML documentation to describe the manager. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00197">manager.h:197</a></div></div>
<div class="ttc" id="pbx__include_8c_html_a1b847252ee7d639d3f230b11af9610d2"><div class="ttname"><a href="../../d6/d0e/pbx__include_8c.html#a1b847252ee7d639d3f230b11af9610d2">include_valid</a></div><div class="ttdeci">int include_valid(const struct ast_include *inc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0e/pbx__include_8c_source.html#l00065">pbx_include.c:65</a></div></div>
<div class="ttc" id="causes_8h_html_a84f3380611feeec35bb25319b26f92fd"><div class="ttname"><a href="../../d4/da3/causes_8h.html#a84f3380611feeec35bb25319b26f92fd">AST_CAUSE_NORMAL_CIRCUIT_CONGESTION</a></div><div class="ttdeci">#define AST_CAUSE_NORMAL_CIRCUIT_CONGESTION</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00119">causes.h:119</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="cli_8h_html_a791bf9f5637185bee5e8f0907c762130"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a></div><div class="ttdeci">void ast_cli(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00006">clicompat.c:6</a></div></div>
<div class="ttc" id="pbx_8h_html_a40b191a3f395775ddd84d363c8fbd030a245df0f7c904df378369f60ea91938e7"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a245df0f7c904df378369f60ea91938e7">AST_EXT_MATCHCID_OFF</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00078">pbx.h:78</a></div></div>
<div class="ttc" id="pbx_8c_html_a9546b830c22c693a2baed08e48569401"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a9546b830c22c693a2baed08e48569401">ast_context_destroy</a></div><div class="ttdeci">void ast_context_destroy(struct ast_context *con, const char *registrar)</div><div class="ttdoc">Destroy a context (matches the specified context or ANY context if NULL) </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08260">pbx.c:8260</a></div></div>
<div class="ttc" id="structast__exten_html_a3976e924940f324effe69a4e4993e9c9"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a3976e924940f324effe69a4e4993e9c9">ast_exten::stuff</a></div><div class="ttdeci">char stuff[0]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00257">pbx.c:257</a></div></div>
<div class="ttc" id="logger_8h_html_a6ff63e8955665c4a58b1598f2b07c51a"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a></div><div class="ttdeci">#define LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00241">logger.h:241</a></div></div>
<div class="ttc" id="lock_8h_html_ac2920a1db37313ec46bd91dc83bf9c8a"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac2920a1db37313ec46bd91dc83bf9c8a">ast_rwlock_unlock</a></div><div class="ttdeci">#define ast_rwlock_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00232">lock.h:232</a></div></div>
<div class="ttc" id="structast__exten_html_a11a2e693c2355642149ba92ac86db8f9"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">ast_exten::peer_table</a></div><div class="ttdeci">struct ast_hashtab * peer_table</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00251">pbx.c:251</a></div></div>
<div class="ttc" id="pbx_8c_html_aa2c309331fff0a086ab8e216f803d546"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a></div><div class="ttdeci">int ast_rdlock_contexts(void)</div><div class="ttdoc">Read locks the context list. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08507">pbx.c:8507</a></div></div>
<div class="ttc" id="http_8c_html_af9b32121c4ad80b0887a3d73fd24de5f"><div class="ttname"><a href="../../dd/d43/http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a></div><div class="ttdeci">const char * ext</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00147">http.c:147</a></div></div>
<div class="ttc" id="pbx_8c_html_adab2235bcef511bda65ac8efec17273f"><div class="ttname"><a href="../../db/d94/pbx_8c.html#adab2235bcef511bda65ac8efec17273f">hints</a></div><div class="ttdeci">static struct ao2_container * hints</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00801">pbx.c:801</a></div></div>
<div class="ttc" id="callerid_8h_html_af01ad9e215f9e9941b68f1ff1559d409"><div class="ttname"><a href="../../de/d47/callerid_8h.html#af01ad9e215f9e9941b68f1ff1559d409">AST_PRES_ALLOWED_USER_NUMBER_NOT_SCREENED</a></div><div class="ttdeci">#define AST_PRES_ALLOWED_USER_NUMBER_NOT_SCREENED</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/callerid_8h_source.html#l00329">callerid.h:329</a></div></div>
<div class="ttc" id="pbx_8c_html_aa18771ce9668fbafeb630ce5c802e6f8"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa18771ce9668fbafeb630ce5c802e6f8">pbx_parseable_goto</a></div><div class="ttdeci">static int pbx_parseable_goto(struct ast_channel *chan, const char *goto_string, int async)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08803">pbx.c:8803</a></div></div>
<div class="ttc" id="astmm_8h_html_ad42ab843b767e8b57162c10a158b75c3"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ad42ab843b767e8b57162c10a158b75c3">ast_free_ptr</a></div><div class="ttdeci">void ast_free_ptr(void *ptr)</div><div class="ttdoc">free() wrapper </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db0/astmm_8c_source.html#l01771">astmm.c:1771</a></div></div>
<div class="ttc" id="pbx_8c_html_aae5642e93e1996051e684bfbc3b3ab08"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aae5642e93e1996051e684bfbc3b3ab08">presence_state_notify_callbacks</a></div><div class="ttdeci">static void presence_state_notify_callbacks(struct ast_hint *hint, struct ast_str **hint_app, struct ast_presence_state_message *presence_state)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03464">pbx.c:3464</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a29e973bd94bfbaf59d939bd1bc988c32"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a></div><div class="ttdeci">static char cid_num[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00164">chan_mgcp.c:164</a></div></div>
<div class="ttc" id="lock_8h_html_ae2cdf274a5da241c3ad7324d82bf6af0"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a></div><div class="ttdeci">#define ast_cond_signal(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00201">lock.h:201</a></div></div>
<div class="ttc" id="channel_8h_html_a6610c8171ced0a69738622c11736ff5e"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a></div><div class="ttdeci">int ast_channel_priority(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00444">channel_internal_api.c:444</a></div></div>
<div class="ttc" id="pbx_8c_html_a44b6406c9220f7f2b610ac712369f405"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a44b6406c9220f7f2b610ac712369f405">ast_pbx_run</a></div><div class="ttdeci">enum ast_pbx_result ast_pbx_run(struct ast_channel *c)</div><div class="ttdoc">Execute the PBX in the current thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04759">pbx.c:4759</a></div></div>
<div class="ttc" id="structoutgoing_html_a7faec841658b88ad0cfbc684853acad3"><div class="ttname"><a href="../../de/dcd/structoutgoing.html#a7faec841658b88ad0cfbc684853acad3">outgoing::context</a></div><div class="ttdeci">const ast_string_field context</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/pbx__spool_8c_source.html#l00095">pbx_spool.c:95</a></div></div>
<div class="ttc" id="structmatch__char_html_ad3d9465d7bb43062eee85a086924a6eb"><div class="ttname"><a href="../../da/d14/structmatch__char.html#ad3d9465d7bb43062eee85a086924a6eb">match_char::x</a></div><div class="ttdeci">char x[1]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00269">pbx.c:269</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01043">astobj2.h:1043</a></div></div>
<div class="ttc" id="pbx__ignorepat_8c_html_ab3503fb9ba3b0c046a2d1a2a482e8ae1"><div class="ttname"><a href="../../d9/d63/pbx__ignorepat_8c.html#ab3503fb9ba3b0c046a2d1a2a482e8ae1">ignorepat_free</a></div><div class="ttdeci">void ignorepat_free(struct ast_ignorepat *ip)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d63/pbx__ignorepat_8c_source.html#l00077">pbx_ignorepat.c:77</a></div></div>
<div class="ttc" id="pbx_8c_html_a7f23f7c798d61e68c32b21d3e0cd15a2"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a7f23f7c798d61e68c32b21d3e0cd15a2">ast_get_extension_registrar</a></div><div class="ttdeci">const char * ast_get_extension_registrar(struct ast_exten *e)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08571">pbx.c:8571</a></div></div>
<div class="ttc" id="logger_8h_html_ad770f83c71e237e1f64163358ce4e13d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a></div><div class="ttdeci">#define ast_verb(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00463">logger.h:463</a></div></div>
<div class="ttc" id="pbx_8c_html_ac778ac642def88a06e5d59e11a964c43"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ac778ac642def88a06e5d59e11a964c43">ast_get_hint</a></div><div class="ttdeci">int ast_get_hint(char *hint, int hintsize, char *name, int namesize, struct ast_channel *c, const char *context, const char *exten)</div><div class="ttdoc">Get hint for channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04141">pbx.c:4141</a></div></div>
<div class="ttc" id="structast__exten_html_a8c205128d7dc6034c5a5cf16b602f2fe"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a8c205128d7dc6034c5a5cf16b602f2fe">ast_exten::registrar</a></div><div class="ttdeci">const char * registrar</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00253">pbx.c:253</a></div></div>
<div class="ttc" id="pbx_8c_html_a0fe14798bf4c5bc4415d0a3d6f170ccb"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a0fe14798bf4c5bc4415d0a3d6f170ccb">handle_hint_change_message_type</a></div><div class="ttdeci">static int handle_hint_change_message_type(struct stasis_message *msg, enum ast_state_cb_update_reason reason)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03537">pbx.c:3537</a></div></div>
<div class="ttc" id="structast__state__cb_html_a70f2042a28ce247a137f0ee89076abfe"><div class="ttname"><a href="../../d6/d37/structast__state__cb.html#a70f2042a28ce247a137f0ee89076abfe">ast_state_cb::change_cb</a></div><div class="ttdeci">ast_state_cb_type change_cb</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00309">pbx.c:309</a></div></div>
<div class="ttc" id="structast__switch_html_a63615e359652b810a1fabf668b2cb043"><div class="ttname"><a href="../../d9/df6/structast__switch.html#a63615e359652b810a1fabf668b2cb043">ast_switch::exists</a></div><div class="ttdeci">ast_switch_f * exists</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00165">pbx.h:165</a></div></div>
<div class="ttc" id="structpbx__outgoing_html_a5e2b2d88194350ced76b66b4f631e329"><div class="ttname"><a href="../../d4/dcb/structpbx__outgoing.html#a5e2b2d88194350ced76b66b4f631e329">pbx_outgoing::dialed</a></div><div class="ttdeci">unsigned int dialed</div><div class="ttdoc">Set when dialing is completed. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07607">pbx.c:7607</a></div></div>
<div class="ttc" id="structast__hint_html_a607486a3cfa8f0d0e80c8eb041dbcd1f"><div class="ttname"><a href="../../d8/dac/structast__hint.html#a607486a3cfa8f0d0e80c8eb041dbcd1f">ast_hint::last_presence_state</a></div><div class="ttdeci">int last_presence_state</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00338">pbx.c:338</a></div></div>
<div class="ttc" id="structast__context_html_a8ae14d6cd92b9ecdb2ae540532a83d15"><div class="ttname"><a href="../../d6/d7c/structast__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15">ast_context::autohints</a></div><div class="ttdeci">int autohints</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00295">pbx.c:295</a></div></div>
<div class="ttc" id="pbx_8c_html_a590d00dd2b4c421d55b9fa2b1943cedd"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a590d00dd2b4c421d55b9fa2b1943cedd">handle_set_extenpatternmatchnew</a></div><div class="ttdeci">static char * handle_set_extenpatternmatchnew(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06105">pbx.c:6105</a></div></div>
<div class="ttc" id="structast__switch_html_a24b6a2ef2583f8e94d5c5b4e28f1c86b"><div class="ttname"><a href="../../d9/df6/structast__switch.html#a24b6a2ef2583f8e94d5c5b4e28f1c86b">ast_switch::canmatch</a></div><div class="ttdeci">ast_switch_f * canmatch</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00166">pbx.h:166</a></div></div>
<div class="ttc" id="structast__cli__args_html_a2a7a1aa13a4f14075411123a4495593c"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">ast_cli_args::line</a></div><div class="ttdeci">const char * line</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00162">cli.h:162</a></div></div>
<div class="ttc" id="hashtab_8h_html_aef63906caa0b965e9c8d8561600038e9"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#aef63906caa0b965e9c8d8561600038e9">ast_hashtab_resize_java</a></div><div class="ttdeci">int ast_hashtab_resize_java(struct ast_hashtab *tab)</div><div class="ttdoc">Determines if a table resize should occur using the Java algorithm (if the table load factor is 75% o...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00084">hashtab.c:84</a></div></div>
<div class="ttc" id="pbx_8h_html_a965977ea9a3144bc203e0ce7a64680a1"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a></div><div class="ttdeci">int ast_custom_function_unregister(struct ast_custom_function *acf)</div><div class="ttdoc">Unregister a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d70/pbx__functions_8c_source.html#l00273">pbx_functions.c:273</a></div></div>
<div class="ttc" id="datastore_8h_html_aee27286888b30c6448a9bce928040a14"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#aee27286888b30c6448a9bce928040a14">ast_datastore_free</a></div><div class="ttdeci">int ast_datastore_free(struct ast_datastore *datastore)</div><div class="ttdoc">Free a data store object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d7a/datastore_8c_source.html#l00068">datastore.c:68</a></div></div>
<div class="ttc" id="group__main__options_html_ga6d3ecf74255f4bfc355ebd1540c316c1"><div class="ttname"><a href="../../d6/dd6/group__main__options.html#ga6d3ecf74255f4bfc355ebd1540c316c1">ast_option_maxcalls</a></div><div class="ttdeci">int ast_option_maxcalls</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00079">options.c:79</a></div></div>
<div class="ttc" id="pbx_8c_html_af26f77a23357ab9f51e6080911400d96"><div class="ttname"><a href="../../db/d94/pbx_8c.html#af26f77a23357ab9f51e6080911400d96">get_device_state_causing_channels</a></div><div class="ttdeci">static void get_device_state_causing_channels(struct ao2_container *c)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03296">pbx.c:3296</a></div></div>
<div class="ttc" id="pbx_8c_html_a1a7e2b65d9fc687fe40a8dbcefa7bc4e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a1a7e2b65d9fc687fe40a8dbcefa7bc4e">pbx_destroy</a></div><div class="ttdeci">static void pbx_destroy(struct ast_pbx *p)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00985">pbx.c:985</a></div></div>
<div class="ttc" id="pbx_8h_html_a98c5425b90ec7c5e136a40f529170b1b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a></div><div class="ttdeci">const char * pbx_builtin_getvar_helper(struct ast_channel *chan, const char *name)</div><div class="ttdoc">Return a pointer to the value of the corresponding channel variable. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l01000">pbx_variables.c:1000</a></div></div>
<div class="ttc" id="term_8h_html_a23aeefae76b2cacc1a6162de88c3fff0"><div class="ttname"><a href="../../db/d45/term_8h.html#a23aeefae76b2cacc1a6162de88c3fff0">COLOR_BRCYAN</a></div><div class="ttdeci">#define COLOR_BRCYAN</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/term_8h_source.html#l00060">term.h:60</a></div></div>
<div class="ttc" id="hashtab_8h_html_a2f04e7652af9cbb593431b623233cb11"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#a2f04e7652af9cbb593431b623233cb11">ast_hashtab_insert_safe</a></div><div class="ttdeci">#define ast_hashtab_insert_safe(tab, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da0/hashtab_8h_source.html#l00315">hashtab.h:315</a></div></div>
<div class="ttc" id="devicestate_8h_html_a852d7e936d4385c3bb903812de5d6403"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a852d7e936d4385c3bb903812de5d6403">ast_devstate_aggregate_result</a></div><div class="ttdeci">enum ast_device_state ast_devstate_aggregate_result(struct ast_devstate_aggregate *agg)</div><div class="ttdoc">Get the aggregate device state result. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/devicestate_8c_source.html#l00663">devicestate.c:663</a></div></div>
<div class="ttc" id="logger_8h_html_a5b3f39ea262ffa795ce4b597968ad00b"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a5b3f39ea262ffa795ce4b597968ad00b">ast_read_threadstorage_callid</a></div><div class="ttdeci">ast_callid ast_read_threadstorage_callid(void)</div><div class="ttdoc">extracts the callerid from the thread </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/logger_8c_source.html#l01962">logger.c:1962</a></div></div>
<div class="ttc" id="term_8h_html_ae443185677b2d0586ded82d4fcde6992"><div class="ttname"><a href="../../db/d45/term_8h.html#ae443185677b2d0586ded82d4fcde6992">COLORIZE</a></div><div class="ttdeci">#define COLORIZE(fg, bg, str)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/term_8h_source.html#l00068">term.h:68</a></div></div>
<div class="ttc" id="pbx_8c_html_a6ede44bb54442c1980e3d2e91da4b4bd"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a6ede44bb54442c1980e3d2e91da4b4bd">handle_show_hint</a></div><div class="ttdeci">static char * handle_show_hint(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">handle_show_hint: CLI support for listing registered dial plan hint </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05304">pbx.c:5304</a></div></div>
<div class="ttc" id="pbx_8c_html_ae41a2e0750d89ec626fd85b4f24d1e5d"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae41a2e0750d89ec626fd85b4f24d1e5d">trie_find_next_match</a></div><div class="ttdeci">static struct ast_exten * trie_find_next_match(struct match_char *node)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01160">pbx.c:1160</a></div></div>
<div class="ttc" id="func__periodic__hook_8c_html_ab32539883094fa1c8103ce4b6ec197c2"><div class="ttname"><a href="../../dc/dcf/func__periodic__hook_8c.html#ab32539883094fa1c8103ce4b6ec197c2">context_name</a></div><div class="ttdeci">static const char context_name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dcf/func__periodic__hook_8c_source.html#l00092">func_periodic_hook.c:92</a></div></div>
<div class="ttc" id="ast__expr_8h_html"><div class="ttname"><a href="../../d0/d93/ast__expr_8h.html">ast_expr.h</a></div></div>
<div class="ttc" id="extconf_8h_html_a2b7f0fafc6995b2630658a4fd8df26bea108ea5cb21cb0de3a1be976972c0a59c"><div class="ttname"><a href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea108ea5cb21cb0de3a1be976972c0a59c">E_MATCH_MASK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00219">extconf.h:219</a></div></div>
<div class="ttc" id="utils_8h_html"><div class="ttname"><a href="../../d5/d60/utils_8h.html">utils.h</a></div><div class="ttdoc">Utility functions. </div></div>
<div class="ttc" id="pbx_8c_html_ac26ad1f7944602b7367a9546e3c15950"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ac26ad1f7944602b7367a9546e3c15950">device_state_info_dt</a></div><div class="ttdeci">static void device_state_info_dt(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03069">pbx.c:3069</a></div></div>
<div class="ttc" id="pbx_8c_html_aa3c47773f118e7775a5c052dbb4bb3aa"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa3c47773f118e7775a5c052dbb4bb3aa">ast_findlabel_extension2</a></div><div class="ttdeci">int ast_findlabel_extension2(struct ast_channel *c, struct ast_context *con, const char *exten, const char *label, const char *callerid)</div><div class="ttdoc">Find the priority of an extension that has the specified label. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04189">pbx.c:4189</a></div></div>
<div class="ttc" id="pbx_8c_html_aa9130cb982e3e236c465136e0637cfaa"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa9130cb982e3e236c465136e0637cfaa">ast_extension_cmp</a></div><div class="ttdeci">int ast_extension_cmp(const char *a, const char *b)</div><div class="ttdoc">Determine if one extension should match before another. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02183">pbx.c:2183</a></div></div>
<div class="ttc" id="structast__context_html_aafd235bcf46595dcc4b91a22647f1cea"><div class="ttname"><a href="../../d6/d7c/structast__context.html#aafd235bcf46595dcc4b91a22647f1cea">ast_context::next</a></div><div class="ttdeci">struct ast_context * next</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00289">pbx.c:289</a></div></div>
<div class="ttc" id="hashtab_8h_html_a2a9c96a0ce6fd77d2858e65d7d63f7b3"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#a2a9c96a0ce6fd77d2858e65d7d63f7b3">ast_hashtab_start_traversal</a></div><div class="ttdeci">#define ast_hashtab_start_traversal(tab)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da0/hashtab_8h_source.html#l00355">hashtab.h:355</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac6a9f3498f9afffecfd78c485af41556"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a></div><div class="ttdeci">const char * astman_get_header(const struct message *m, char *var)</div><div class="ttdoc">Get header from mananger transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l02820">manager.c:2820</a></div></div>
<div class="ttc" id="pbx_8c_html_a2e2f31cfba289d6d661ef50e8ddf9648"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a2e2f31cfba289d6d661ef50e8ddf9648">wait_for_hangup</a></div><div class="ttdeci">void wait_for_hangup(struct ast_channel *chan, const void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08267">pbx.c:8267</a></div></div>
<div class="ttc" id="astobj2_8h_html_af236ed10cd1eddcbad0579ed0cf9f4c5"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#af236ed10cd1eddcbad0579ed0cf9f4c5">ao2_prnt_fn</a></div><div class="ttdeci">void() ao2_prnt_fn(void *where, const char *fmt,...)</div><div class="ttdoc">Print output. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01442">astobj2.h:1442</a></div></div>
<div class="ttc" id="lock_8h_html_ab134d98cdfe7de0f7a72b377c0765dc7"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a></div><div class="ttdeci">pthread_cond_t ast_cond_t</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00176">lock.h:176</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="structast__switch_html_afcd1706c9144e6d6eee6127661ae3be2"><div class="ttname"><a href="../../d9/df6/structast__switch.html#afcd1706c9144e6d6eee6127661ae3be2">ast_switch::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00162">pbx.h:162</a></div></div>
<div class="ttc" id="channel_8h_html_ae616309e9eba6a1b009a0466bada50cc"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae616309e9eba6a1b009a0466bada50cc">ast_channel_whentohangup</a></div><div class="ttdeci">struct timeval * ast_channel_whentohangup(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00928">channel_internal_api.c:928</a></div></div>
<div class="ttc" id="structstore__hint_html_a0f7fc37040d0e6f05e756cf921c14a31"><div class="ttname"><a href="../../d0/ddc/structstore__hint.html#a0f7fc37040d0e6f05e756cf921c14a31">store_hint::exten</a></div><div class="ttdeci">char * exten</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06281">pbx.c:6281</a></div></div>
<div class="ttc" id="pbx_8c_html_acf5505fa44483212103cce849e530e1c"><div class="ttname"><a href="../../db/d94/pbx_8c.html#acf5505fa44483212103cce849e530e1c">handle_show_dialplan</a></div><div class="ttdeci">static char * handle_show_dialplan(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05732">pbx.c:5732</a></div></div>
<div class="ttc" id="structast__exten_html_af0803fced1d4ccfbc6ec4d8577d30525"><div class="ttname"><a href="../../d7/d00/structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">ast_exten::matchcid</a></div><div class="ttdeci">int matchcid</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00240">pbx.c:240</a></div></div>
<div class="ttc" id="structoutgoing_html_aaee31f4cc48985167efcd38ab252dac8"><div class="ttname"><a href="../../de/dcd/structoutgoing.html#aaee31f4cc48985167efcd38ab252dac8">outgoing::exten</a></div><div class="ttdeci">const ast_string_field exten</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/pbx__spool_8c_source.html#l00095">pbx_spool.c:95</a></div></div>
<div class="ttc" id="structfake__context_html_a8ae14d6cd92b9ecdb2ae540532a83d15"><div class="ttname"><a href="../../d6/da7/structfake__context.html#a8ae14d6cd92b9ecdb2ae540532a83d15">fake_context::autohints</a></div><div class="ttdeci">int autohints</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02438">pbx.c:2438</a></div></div>
<div class="ttc" id="structnumber_html"><div class="ttname"><a href="../../d6/d49/structnumber.html">number</a></div><div class="ttdoc">Number structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d55/app__followme_8c_source.html#l00154">app_followme.c:154</a></div></div>
<div class="ttc" id="chan__mobile_8c_html_a186b21cef3dc1e94d6a8816e1ed75c00"><div class="ttname"><a href="../../d3/d51/chan__mobile_8c.html#a186b21cef3dc1e94d6a8816e1ed75c00">devices</a></div><div class="ttdeci">static struct devices devices</div></div>
<div class="ttc" id="structast__context_html_a34eb63008d294b713376e64bb2a7b2ef"><div class="ttname"><a href="../../d6/d7c/structast__context.html#a34eb63008d294b713376e64bb2a7b2ef">ast_context::macrolock</a></div><div class="ttdeci">ast_mutex_t macrolock</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00296">pbx.c:296</a></div></div>
<div class="ttc" id="structast__hintdevice_html_a5a911c914f4dbe7ec60ca5b5b783c380"><div class="ttname"><a href="../../df/d6f/structast__hintdevice.html#a5a911c914f4dbe7ec60ca5b5b783c380">ast_hintdevice::hintdevice</a></div><div class="ttdeci">char hintdevice[1]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00376">pbx.c:376</a></div></div>
<div class="ttc" id="pbx_8h_html_ae87c469f677f728e1f1337abb3f22ada"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ae87c469f677f728e1f1337abb3f22ada">ast_get_switch_eval</a></div><div class="ttdeci">int ast_get_switch_eval(const struct ast_sw *sw)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d5d/pbx__sw_8c_source.html#l00058">pbx_sw.c:58</a></div></div>
<div class="ttc" id="pbx_8h_html_a7e545df4a5f38ef25616c7bdf55d625fa83180bb058ded006c01229431fc887f9"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa83180bb058ded006c01229431fc887f9">AST_EXTENSION_ONHOLD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00069">pbx.h:69</a></div></div>
<div class="ttc" id="logger_8h_html_a6956becf4d7e3906c74b6e30b834ebd8"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a6956becf4d7e3906c74b6e30b834ebd8">ast_callid_threadassoc_add</a></div><div class="ttdeci">int ast_callid_threadassoc_add(ast_callid callid)</div><div class="ttdoc">Adds a known callid to thread storage of the calling thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/logger_8c_source.html#l01984">logger.c:1984</a></div></div>
<div class="ttc" id="structfake__context_html_a0d9eeadf3cb7b27fdcf4f70247dceec6"><div class="ttname"><a href="../../d6/da7/structfake__context.html#a0d9eeadf3cb7b27fdcf4f70247dceec6">fake_context::next</a></div><div class="ttdeci">struct ast_context * next</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02432">pbx.c:2432</a></div></div>
<div class="ttc" id="group__applications_html_gab06d7e57a1b08e84ac9be5343dde2074"><div class="ttname"><a href="../../d9/dc9/group__applications.html#gab06d7e57a1b08e84ac9be5343dde2074">indicate_congestion</a></div><div class="ttdeci">int indicate_congestion(struct ast_channel *chan, const char *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d1d/pbx__builtins_8c_source.html#l00757">pbx_builtins.c:757</a></div></div>
<div class="ttc" id="cdr__odbc_8c_html_a68d1e6e752f2cf81551fac543cae108a"><div class="ttname"><a href="../../d8/d56/cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a></div><div class="ttdeci">static char * table</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d56/cdr__odbc_8c_source.html#l00058">cdr_odbc.c:58</a></div></div>
<div class="ttc" id="pbx_8c_html_ab1d88f370509aae87302134e6f70628a"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ab1d88f370509aae87302134e6f70628a">ast_extension_state_add</a></div><div class="ttdeci">int ast_extension_state_add(const char *context, const char *exten, ast_state_cb_type change_cb, void *data)</div><div class="ttdoc">Add watcher for extension states. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03825">pbx.c:3825</a></div></div>
<div class="ttc" id="cdr_8h_html"><div class="ttname"><a href="../../dc/d07/cdr_8h.html">cdr.h</a></div><div class="ttdoc">Call Detail Record API. </div></div>
<div class="ttc" id="strings_8h_html_aa3341f35cedca29e60bb7f3927204283"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a></div><div class="ttdeci">int ast_str_set(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Set a dynamic string using variable arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01065">strings.h:1065</a></div></div>
<div class="ttc" id="dial_8h_html_a2674932599e61fe027364a09f6d68c4e"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a2674932599e61fe027364a09f6d68c4e">ast_dial_set_state_callback</a></div><div class="ttdeci">void ast_dial_set_state_callback(struct ast_dial *dial, ast_dial_state_callback callback)</div><div class="ttdoc">Set a callback for state changes. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l01293">dial.c:1293</a></div></div>
<div class="ttc" id="astobj2_8h_html_a503b6c7ced96f9b56ec59c115cbeb29a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a503b6c7ced96f9b56ec59c115cbeb29a">ao2_object_get_lockaddr</a></div><div class="ttdeci">void * ao2_object_get_lockaddr(void *obj)</div><div class="ttdoc">Return the mutex lock address of an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00476">astobj2.c:476</a></div></div>
<div class="ttc" id="pbx_8c_html_a18c87dac5f7f4368c11b67d8026adc22"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a18c87dac5f7f4368c11b67d8026adc22">ast_wrlock_contexts</a></div><div class="ttdeci">int ast_wrlock_contexts(void)</div><div class="ttdoc">Write locks the context list. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08502">pbx.c:8502</a></div></div>
<div class="ttc" id="structast__exten_html_ac88146e1a3c32b17f9bc75d540cc0ca5"><div class="ttname"><a href="../../d7/d00/structast__exten.html#ac88146e1a3c32b17f9bc75d540cc0ca5">ast_exten::next</a></div><div class="ttdeci">struct ast_exten * next</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00256">pbx.c:256</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html">config.h</a></div><div class="ttdoc">Configuration File Parser. </div></div>
<div class="ttc" id="structast__state__cb__info_html_a6f3d8aa9a90b701e81dad4cc4a56be67"><div class="ttname"><a href="../../df/d4c/structast__state__cb__info.html#a6f3d8aa9a90b701e81dad4cc4a56be67">ast_state_cb_info::exten_state</a></div><div class="ttdeci">enum ast_extension_states exten_state</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00104">pbx.h:104</a></div></div>
<div class="ttc" id="astobj2_8h_html_a4b8c1cca9dace1cf1bbadc5039f3dedf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a4b8c1cca9dace1cf1bbadc5039f3dedf">ao2_container_unregister</a></div><div class="ttdeci">void ao2_container_unregister(const char *name)</div><div class="ttdoc">Unregister a container for CLI stats and integrity check. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00985">astobj2_container.c:985</a></div></div>
<div class="ttc" id="structast__pbx_html"><div class="ttname"><a href="../../d6/d83/structast__pbx.html">ast_pbx</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00211">pbx.h:211</a></div></div>
<div class="ttc" id="pbx_8c_html_a505ce4b1d8e816a6163f064bc27bc2d6"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a505ce4b1d8e816a6163f064bc27bc2d6">ast_walk_context_extensions</a></div><div class="ttdeci">struct ast_exten * ast_walk_context_extensions(struct ast_context *con, struct ast_exten *exten)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08614">pbx.c:8614</a></div></div>
<div class="ttc" id="devicestate_8h_html_a9459272db1c8c968ed1aff1387f0f9fd"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a9459272db1c8c968ed1aff1387f0f9fd">ast_device_state_message_type</a></div><div class="ttdeci">struct stasis_message_type * ast_device_state_message_type(void)</div><div class="ttdoc">Get the Stasis message type for device state messages. </div></div>
<div class="ttc" id="pbx_8c_html_aabf9a3a7442aeee52b849c70c6d0af33"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aabf9a3a7442aeee52b849c70c6d0af33">hintdevice_cmp_multiple</a></div><div class="ttdeci">static int hintdevice_cmp_multiple(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00421">pbx.c:421</a></div></div>
<div class="ttc" id="structast__device__state__info_html_a6c8f5142b3e33b36fdb2c3bfeecc91e6"><div class="ttname"><a href="../../dc/d4d/structast__device__state__info.html#a6c8f5142b3e33b36fdb2c3bfeecc91e6">ast_device_state_info::causing_channel</a></div><div class="ttdeci">struct ast_channel * causing_channel</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00098">pbx.h:98</a></div></div>
<div class="ttc" id="pbx_8c_html_a664a64cfc5de0467d1e7aa4ce076fef5"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a664a64cfc5de0467d1e7aa4ce076fef5">statecbs_cmp</a></div><div class="ttdeci">static int statecbs_cmp(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08897">pbx.c:8897</a></div></div>
<div class="ttc" id="pbx_8c_html_ac8e8f73ccf4ba3fdbc519bc9c0027e4f"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ac8e8f73ccf4ba3fdbc519bc9c0027e4f">pbx_outgoing_exec</a></div><div class="ttdeci">static void * pbx_outgoing_exec(void *data)</div><div class="ttdoc">Internal function which dials an outgoing leg and sends it to a provided extension or application...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07627">pbx.c:7627</a></div></div>
<div class="ttc" id="structast__exten_html_a3e3ed71b5dcbadee8292f3d1837eaa38"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a3e3ed71b5dcbadee8292f3d1837eaa38">ast_exten::registrar_file</a></div><div class="ttdeci">const char * registrar_file</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00254">pbx.c:254</a></div></div>
<div class="ttc" id="pbx_8h_html_a24a619e5cc5e3f683322295991c57916ad1f109b734f3cb4d20937f283eb98d69"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a24a619e5cc5e3f683322295991c57916ad1f109b734f3cb4d20937f283eb98d69">AST_OUTGOING_WAIT_COMPLETE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l01154">pbx.h:1154</a></div></div>
<div class="ttc" id="astobj2_8h_html_abdb952d2373503555d96f02f130c5770"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#abdb952d2373503555d96f02f130c5770">ao2_container_register</a></div><div class="ttdeci">int ao2_container_register(const char *name, struct ao2_container *self, ao2_prnt_obj_fn *prnt_obj)</div><div class="ttdoc">Register a container for CLI stats and integrity check. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00958">astobj2_container.c:958</a></div></div>
<div class="ttc" id="hashtab_8h_html_abd1eaf0229b6a896b795026218c9bde0"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#abd1eaf0229b6a896b795026218c9bde0">ast_hashtab_insert_immediate</a></div><div class="ttdeci">#define ast_hashtab_insert_immediate(tab, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da0/hashtab_8h_source.html#l00291">hashtab.h:291</a></div></div>
<div class="ttc" id="pbx_8h_html_aabc320b5f03ccc254bde047d2e2ec0e0"><div class="ttname"><a href="../../db/de0/pbx_8h.html#aabc320b5f03ccc254bde047d2e2ec0e0">AST_PBX_ERROR</a></div><div class="ttdeci">#define AST_PBX_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00050">pbx.h:50</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="structast__exten_html_acec9ce2df15222151ad66fcb1d74eb9f"><div class="ttname"><a href="../../d7/d00/structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">ast_exten::priority</a></div><div class="ttdeci">int priority</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00243">pbx.c:243</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="pbx_8c_html_a9df0a5d301454fe924172cf89c7165a4"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a9df0a5d301454fe924172cf89c7165a4">ast_get_context_registrar</a></div><div class="ttdeci">const char * ast_get_context_registrar(struct ast_context *c)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08566">pbx.c:8566</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00060">devicestate.h:60</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20">OBJ_SEARCH_PARTIAL_KEY</a></div><div class="ttdoc">The arg parameter is a partial search key similar to OBJ_SEARCH_KEY. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01120">astobj2.h:1120</a></div></div>
<div class="ttc" id="pbx_8c_html_a30bdd4f0a69a85ec0c099c4262164b25"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a30bdd4f0a69a85ec0c099c4262164b25">presence_state_cb</a></div><div class="ttdeci">static void presence_state_cb(void *unused, struct stasis_subscription *sub, struct stasis_message *msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08333">pbx.c:8333</a></div></div>
<div class="ttc" id="structpbx__find__info_html"><div class="ttname"><a href="../../db/d81/structpbx__find__info.html">pbx_find_info</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00230">extconf.h:230</a></div></div>
<div class="ttc" id="structast__exten_html_ab7c1308495be24ebfa4c40a455d50145"><div class="ttname"><a href="../../d7/d00/structast__exten.html#ab7c1308495be24ebfa4c40a455d50145">ast_exten::peer</a></div><div class="ttdeci">struct ast_exten * peer</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00250">pbx.c:250</a></div></div>
<div class="ttc" id="dial_8h_html_a2054b1ddc7845e78286254b366a37847"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847">ast_dial_result</a></div><div class="ttdeci">ast_dial_result</div><div class="ttdoc">List of return codes for dial run API calls. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dcf/dial_8h_source.html#l00054">dial.h:54</a></div></div>
<div class="ttc" id="structast__sw_html"><div class="ttname"><a href="../../d3/def/structast__sw.html">ast_sw</a></div><div class="ttdoc">ast_sw: Switch statement in extensions.conf </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d5d/pbx__sw_8c_source.html#l00037">pbx_sw.c:37</a></div></div>
<div class="ttc" id="vector_8h_html_ad9d555fa89da1bfc691181993499f785"><div class="ttname"><a href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a></div><div class="ttdeci">#define AST_VECTOR_INIT(vec, size)</div><div class="ttdoc">Initialize a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00113">vector.h:113</a></div></div>
<div class="ttc" id="pbx_8c_html_a31755abf9f213cb9559b909f71b85124"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a31755abf9f213cb9559b909f71b85124">ext_cmp</a></div><div class="ttdeci">static int ext_cmp(const char *left, const char *right)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02126">pbx.c:2126</a></div></div>
<div class="ttc" id="pbx_8c_html_a92af176ba464b63d4d13079e68933430"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a92af176ba464b63d4d13079e68933430">ast_extension_state2</a></div><div class="ttdeci">static int ast_extension_state2(struct ast_exten *e, struct ao2_container *device_state_info)</div><div class="ttdoc">Check state of extension by using hints. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03113">pbx.c:3113</a></div></div>
<div class="ttc" id="pbx_8c_html_aef0dcef11ca2f5e3a4093598724ff086"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aef0dcef11ca2f5e3a4093598724ff086">ast_async_goto_by_name</a></div><div class="ttdeci">int ast_async_goto_by_name(const char *channame, const char *context, const char *exten, int priority)</div><div class="ttdoc">Set the channel to next execute the specified dialplan location. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07044">pbx.c:7044</a></div></div>
<div class="ttc" id="channel_8h_html"><div class="ttname"><a href="../../d5/d7b/channel_8h.html">channel.h</a></div><div class="ttdoc">General Asterisk PBX channel definitions. </div></div>
<div class="ttc" id="pbx_8c_html_a7621524948e1703e981c745c74c14d01"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a7621524948e1703e981c745c74c14d01">raise_exception</a></div><div class="ttdeci">int raise_exception(struct ast_channel *chan, const char *reason, int priority)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02806">pbx.c:2806</a></div></div>
<div class="ttc" id="structpbx__outgoing_html_acec9ce2df15222151ad66fcb1d74eb9f"><div class="ttname"><a href="../../d4/dcb/structpbx__outgoing.html#acec9ce2df15222151ad66fcb1d74eb9f">pbx_outgoing::priority</a></div><div class="ttdeci">int priority</div><div class="ttdoc">Dialplan priority. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07603">pbx.c:7603</a></div></div>
<div class="ttc" id="asterisk_8h_html_a412442e1beffe5bec07ed2e9ea72afc3"><div class="ttname"><a href="../../db/db2/asterisk_8h.html#a412442e1beffe5bec07ed2e9ea72afc3">ast_register_cleanup</a></div><div class="ttdeci">int ast_register_cleanup(void(*func)(void))</div><div class="ttdoc">Register a function to be executed before Asterisk gracefully exits. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00019">clicompat.c:19</a></div></div>
<div class="ttc" id="pbx_8c_html_a829520d1350a9bfcd02e2106e5a22a24"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a829520d1350a9bfcd02e2106e5a22a24">increase_call_count</a></div><div class="ttdeci">static int increase_call_count(const struct ast_channel *c)</div><div class="ttdoc">Increase call count for channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04621">pbx.c:4621</a></div></div>
<div class="ttc" id="group__main__options_html_gade53ca08a5e71308f410de870fa7338b"><div class="ttname"><a href="../../d6/dd6/group__main__options.html#gade53ca08a5e71308f410de870fa7338b">option_minmemfree</a></div><div class="ttdeci">long option_minmemfree</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00086">options.c:86</a></div></div>
<div class="ttc" id="pbx_8c_html_a55c3f21eda54c35107729cd65e482aec"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a55c3f21eda54c35107729cd65e482aec">maxcalllock</a></div><div class="ttdeci">static ast_mutex_t maxcalllock</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00772">pbx.c:772</a></div></div>
<div class="ttc" id="paths_8h_html"><div class="ttname"><a href="../../dd/df2/paths_8h.html">paths.h</a></div><div class="ttdoc">Asterisk file paths, configured in asterisk.conf. </div></div>
<div class="ttc" id="channel_8h_html_a21c057f81ff8b02eb1120410ae86e657"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a21c057f81ff8b02eb1120410ae86e657">ast_channel_clear_softhangup</a></div><div class="ttdeci">void ast_channel_clear_softhangup(struct ast_channel *chan, int flag)</div><div class="ttdoc">Clear a set of softhangup flags from a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02437">channel.c:2437</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gabf7c909efbfc26d0d9c66786c83b8f69"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a></div><div class="ttdeci">void astman_send_list_complete_end(struct mansession *s)</div><div class="ttdoc">End the list complete event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03245">manager.c:3245</a></div></div>
<div class="ttc" id="pbx__private_8h_html_a877bb7ddb2d41bf4d7e7fc77bc78e65f"><div class="ttname"><a href="../../d9/da0/pbx__private_8h.html#a877bb7ddb2d41bf4d7e7fc77bc78e65f">sw_alloc</a></div><div class="ttdeci">struct ast_sw * sw_alloc(const char *value, const char *data, int eval, const char *registrar)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d5d/pbx__sw_8c_source.html#l00068">pbx_sw.c:68</a></div></div>
<div class="ttc" id="pbx_8h_html_a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5">AST_PBX_CALL_LIMIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00357">pbx.h:357</a></div></div>
<div class="ttc" id="structpbx__find__info_html_ae4950db1dbfff8459a712737063b61aa"><div class="ttname"><a href="../../db/d81/structpbx__find__info.html#ae4950db1dbfff8459a712737063b61aa">pbx_find_info::data</a></div><div class="ttdeci">const char * data</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00241">extconf.h:241</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="pbx_8h_html_ab077da615e93c9e88ce539bef23f82e6"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6">ast_state_cb_update_reason</a></div><div class="ttdeci">ast_state_cb_update_reason</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00089">pbx.h:89</a></div></div>
<div class="ttc" id="structast__state__cb__info_html_adbd2034543f941d4cf84f129faee9a0b"><div class="ttname"><a href="../../df/d4c/structast__state__cb__info.html#adbd2034543f941d4cf84f129faee9a0b">ast_state_cb_info::presence_state</a></div><div class="ttdeci">enum ast_presence_state presence_state</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00106">pbx.h:106</a></div></div>
<div class="ttc" id="pbx_8c_html_a4d3fb293cd1b306f2dd3cffe2f914454"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a4d3fb293cd1b306f2dd3cffe2f914454">ext_cmp_exten_strlen</a></div><div class="ttdeci">static int ext_cmp_exten_strlen(const char *str)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01803">pbx.c:1803</a></div></div>
<div class="ttc" id="pbx_8c_html_a705ac1563ea8e4c1e3f369e6ad952fda"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a705ac1563ea8e4c1e3f369e6ad952fda">create_match_char_tree</a></div><div class="ttdeci">static void create_match_char_tree(struct ast_context *con)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01756">pbx.c:1756</a></div></div>
<div class="ttc" id="structpbx__exception_html_af9968f5aac9a0d889c0506368ea1e649"><div class="ttname"><a href="../../d1/db2/structpbx__exception.html#af9968f5aac9a0d889c0506368ea1e649">pbx_exception::reason</a></div><div class="ttdeci">const ast_string_field reason</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00625">pbx.c:625</a></div></div>
<div class="ttc" id="structast__cli__args_html_acf64f219885421479997667d2ed3f08a"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">ast_cli_args::fd</a></div><div class="ttdeci">const int fd</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00159">cli.h:159</a></div></div>
<div class="ttc" id="structast__device__state__message_html_a39d1b63955a48c72508fa9f884d05762"><div class="ttname"><a href="../../db/d92/structast__device__state__message.html#a39d1b63955a48c72508fa9f884d05762">ast_device_state_message::eid</a></div><div class="ttdeci">const struct ast_eid * eid</div><div class="ttdoc">The EID of the server where this message originated. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00248">devicestate.h:248</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga920b9d3e484257c7e593452a8e36d8d4"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga920b9d3e484257c7e593452a8e36d8d4">ast_channel_stage_snapshot_done</a></div><div class="ttdeci">void ast_channel_stage_snapshot_done(struct ast_channel *chan)</div><div class="ttdoc">Clear flag to indicate channel snapshot is being staged, and publish snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l01043">stasis_channels.c:1043</a></div></div>
<div class="ttc" id="channel_8h_html_a10f23f1907b804485f62973f66cd9aef"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a10f23f1907b804485f62973f66cd9aef">ast_channel_connected</a></div><div class="ttdeci">struct ast_party_connected_line * ast_channel_connected(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00892">channel_internal_api.c:892</a></div></div>
<div class="ttc" id="pbx_8c_html_a979d84294814362e6425db722c917e79"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a979d84294814362e6425db722c917e79">ext_cmp_pattern_pos</a></div><div class="ttdeci">static int ext_cmp_pattern_pos(const char **p, unsigned char *bitwise)</div><div class="ttdoc">helper functions to sort extension patterns in the desired way, so that more specific patterns appear...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01963">pbx.c:1963</a></div></div>
<div class="ttc" id="pbx_8c_html_a7a46e2644221be6cb7ca7ba2723006cd"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a7a46e2644221be6cb7ca7ba2723006cd">pbx_set_overrideswitch</a></div><div class="ttdeci">void pbx_set_overrideswitch(const char *newval)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04788">pbx.c:4788</a></div></div>
<div class="ttc" id="presencestate_8h_html_ac3452f41c7982c84ca27ecf7b4cc7ce1"><div class="ttname"><a href="../../d6/dd7/presencestate_8h.html#ac3452f41c7982c84ca27ecf7b4cc7ce1">ast_presence_state</a></div><div class="ttdeci">ast_presence_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd7/presencestate_8h_source.html#l00026">presencestate.h:26</a></div></div>
<div class="ttc" id="structast__device__state__message_html_a8059c3b19eb356cf729e5d25b139647e"><div class="ttname"><a href="../../db/d92/structast__device__state__message.html#a8059c3b19eb356cf729e5d25b139647e">ast_device_state_message::device</a></div><div class="ttdeci">const char * device</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00242">devicestate.h:242</a></div></div>
<div class="ttc" id="structast__state__cb_html_a7441ef0865bcb3db9b8064dd7375c1ea"><div class="ttname"><a href="../../d6/d37/structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">ast_state_cb::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00303">pbx.c:303</a></div></div>
<div class="ttc" id="structast__cli__args_html_acfc02ec89670db29251fda6a66602ce2"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">ast_cli_args::n</a></div><div class="ttdeci">const int n</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00165">cli.h:165</a></div></div>
<div class="ttc" id="channel_8h_html_acc0ae2c008f4157736ef290e9ca62572"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#acc0ae2c008f4157736ef290e9ca62572">ast_dummy_channel_alloc</a></div><div class="ttdeci">#define ast_dummy_channel_alloc()</div><div class="ttdoc">Create a fake channel structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l01283">channel.h:1283</a></div></div>
<div class="ttc" id="channel_8h_html_a488b7d6f7488bedc53be45d4ef4471c9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a></div><div class="ttdeci">struct ast_pbx * ast_channel_pbx(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00721">channel_internal_api.c:721</a></div></div>
<div class="ttc" id="app__meetme_8c_html_ae9dd6bdb4c5c0529195a03583d0d4a8d"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#ae9dd6bdb4c5c0529195a03583d0d4a8d">last</a></div><div class="ttdeci">struct sla_ringing_trunk * last</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01092">app_meetme.c:1092</a></div></div>
<div class="ttc" id="causes_8h_html_aa71419a0c598e31312477c5a644e7440"><div class="ttname"><a href="../../d4/da3/causes_8h.html#aa71419a0c598e31312477c5a644e7440">AST_CAUSE_ANSWERED_ELSEWHERE</a></div><div class="ttdeci">#define AST_CAUSE_ANSWERED_ELSEWHERE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00113">causes.h:113</a></div></div>
<div class="ttc" id="structast__custom__function_html"><div class="ttname"><a href="../../db/dc0/structast__custom__function.html">ast_custom_function</a></div><div class="ttdoc">Data structure associated with a custom dialplan function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00118">pbx.h:118</a></div></div>
<div class="ttc" id="structpbx__exception_html_acec9ce2df15222151ad66fcb1d74eb9f"><div class="ttname"><a href="../../d1/db2/structpbx__exception.html#acec9ce2df15222151ad66fcb1d74eb9f">pbx_exception::priority</a></div><div class="ttdeci">int priority</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00627">pbx.c:627</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00053">devicestate.h:53</a></div></div>
<div class="ttc" id="pbx_8c_html_a666d27d15c01c2b36dd8523a0146ba40"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a></div><div class="ttdeci">static struct ast_exten * ast_hint_extension(struct ast_channel *c, const char *context, const char *exten)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02997">pbx.c:2997</a></div></div>
<div class="ttc" id="astobj2_8h_html"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html">astobj2.h</a></div></div>
<div class="ttc" id="pbx_8h_html_ad3a372c5b23617d0ba1856aa88035f54"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ad3a372c5b23617d0ba1856aa88035f54">ast_state_cb_destroy_type</a></div><div class="ttdeci">void(* ast_state_cb_destroy_type)(int id, void *data)</div><div class="ttdoc">Typedef for devicestate and hint callback removal indication callback. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00115">pbx.h:115</a></div></div>
<div class="ttc" id="structast__context_html_a8c205128d7dc6034c5a5cf16b602f2fe"><div class="ttname"><a href="../../d6/d7c/structast__context.html#a8c205128d7dc6034c5a5cf16b602f2fe">ast_context::registrar</a></div><div class="ttdeci">char * registrar</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00293">pbx.c:293</a></div></div>
<div class="ttc" id="pbx_8c_html_aa8a73717c101aec8cce8641cf55aed80"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa8a73717c101aec8cce8641cf55aed80">HASH_EXTENHINT_SIZE</a></div><div class="ttdeci">#define HASH_EXTENHINT_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00358">pbx.c:358</a></div></div>
<div class="ttc" id="pbx_8c_html_a7677cd4c8e3a0c3d205f412e396a7d5c"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a7677cd4c8e3a0c3d205f412e396a7d5c">ast_context_add_switch</a></div><div class="ttdeci">int ast_context_add_switch(const char *context, const char *sw, const char *data, int eval, const char *registrar)</div><div class="ttdoc">Add a switch. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06771">pbx.c:6771</a></div></div>
<div class="ttc" id="channel_8h_html_af4e59494f74ad9e0c50170d9e276ad31"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a></div><div class="ttdeci">#define AST_MAX_EXTENSION</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00135">channel.h:135</a></div></div>
<div class="ttc" id="pbx_8c_html_a61b4c35e18be0d479b55e45f373725ee"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a61b4c35e18be0d479b55e45f373725ee">already_in_tree</a></div><div class="ttdeci">static struct match_char * already_in_tree(struct match_char *current, char *pat, int is_pattern)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01397">pbx.c:1397</a></div></div>
<div class="ttc" id="pbx_8c_html_a9d8398fb440bfff609135d49dfe3f01d"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a9d8398fb440bfff609135d49dfe3f01d">extension_state_add_destroy</a></div><div class="ttdeci">static int extension_state_add_destroy(const char *context, const char *exten, ast_state_cb_type change_cb, ast_state_cb_destroy_type destroy_cb, void *data, int extended)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03729">pbx.c:3729</a></div></div>
<div class="ttc" id="stringfields_8h_html_a51b5729220efb7cda4393ed35ecdfea2"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a></div><div class="ttdeci">#define AST_STRING_FIELD(name)</div><div class="ttdoc">Declare a string field. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00299">stringfields.h:299</a></div></div>
<div class="ttc" id="pbx__private_8h_html_a8fb2c698b49514ee75942405c84ad8bd"><div class="ttname"><a href="../../d9/da0/pbx__private_8h.html#a8fb2c698b49514ee75942405c84ad8bd">pbx_findswitch</a></div><div class="ttdeci">struct ast_switch * pbx_findswitch(const char *sw)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df2/pbx__switch_8c_source.html#l00040">pbx_switch.c:40</a></div></div>
<div class="ttc" id="pbx_8c_html_aa992580d26443e3306f7f08cf5908e7c"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa992580d26443e3306f7f08cf5908e7c">ast_extension_state_del</a></div><div class="ttdeci">int ast_extension_state_del(int id, ast_state_cb_type change_cb)</div><div class="ttdoc">Deletes a state change watcher by ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03858">pbx.c:3858</a></div></div>
<div class="ttc" id="structextension_html"><div class="ttname"><a href="../../d0/d5a/structextension.html">extension</a></div><div class="ttdoc">structure to hold extensions </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de9/res__phoneprov_8c_source.html#l00287">res_phoneprov.c:287</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
<div class="ttc" id="strings_8h_html_a38a896048b2ca84076864505f0aa8f01"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a></div><div class="ttdeci">#define S_COR(a, b, c)</div><div class="ttdoc">returns the equivalent of logic or for strings, with an additional boolean check: second one if not e...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00085">strings.h:85</a></div></div>
<div class="ttc" id="channel_8h_html_ac2d6607253f7e8b272d4e845474eaa9b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b">ast_softhangup</a></div><div class="ttdeci">int ast_softhangup(struct ast_channel *chan, int reason)</div><div class="ttdoc">Softly hangup up a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02476">channel.c:2476</a></div></div>
<div class="ttc" id="structmansession_html"><div class="ttname"><a href="../../d2/d8a/structmansession.html">mansession</a></div><div class="ttdoc">In case you didn&amp;#39;t read that giant block of text above the mansession_session struct, the struct mansession is named this solely to keep the API the same in Asterisk. This structure really represents data that is different from Manager action to Manager action. The mansession_session pointer contained within points to session-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01625">manager.c:1625</a></div></div>
<div class="ttc" id="term_8h_html_ae640996bf494da50000e83e165c5453e"><div class="ttname"><a href="../../db/d45/term_8h.html#ae640996bf494da50000e83e165c5453e">COLORIZE_FMT</a></div><div class="ttdeci">#define COLORIZE_FMT</div><div class="ttdoc">Shortcut macros for coloring a set of text. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/term_8h_source.html#l00067">term.h:67</a></div></div>
<div class="ttc" id="structast__state__cb__info_html_a662bbfb7890c12ee79a4ef1ea5f42a0c"><div class="ttname"><a href="../../df/d4c/structast__state__cb__info.html#a662bbfb7890c12ee79a4ef1ea5f42a0c">ast_state_cb_info::presence_subtype</a></div><div class="ttdeci">const char * presence_subtype</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00107">pbx.h:107</a></div></div>
<div class="ttc" id="pbx_8c_html_a6cd4c64e374623ea3393fbc5d580f68e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a6cd4c64e374623ea3393fbc5d580f68e">ast_processed_calls</a></div><div class="ttdeci">int ast_processed_calls(void)</div><div class="ttdoc">Retrieve the total number of calls processed through the PBX since last restart. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04769">pbx.c:4769</a></div></div>
<div class="ttc" id="pbx_8c_html_a64a5b8fdc919806135ad427aca9e71b7"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a></div><div class="ttdeci">int ast_exists_extension(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)</div><div class="ttdoc">Determine whether an extension exists. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04179">pbx.c:4179</a></div></div>
<div class="ttc" id="vector_8h_html_a0414ce2ed1741b1e048ccafc0df420c3"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a0414ce2ed1741b1e048ccafc0df420c3">AST_VECTOR_REMOVE_ORDERED</a></div><div class="ttdeci">#define AST_VECTOR_REMOVE_ORDERED(vec, idx)</div><div class="ttdoc">Remove an element from a vector by index while maintaining order. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00448">vector.h:448</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="structscoreboard_html_afd6db51221fa39c96b9469fa115db1cb"><div class="ttname"><a href="../../db/d2d/structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">scoreboard::canmatch_exten</a></div><div class="ttdeci">struct ast_exten * canmatch_exten</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00279">pbx.c:279</a></div></div>
<div class="ttc" id="pbx_8c_html_adb0fea48eab9c7727401696cbd005169"><div class="ttname"><a href="../../db/d94/pbx_8c.html#adb0fea48eab9c7727401696cbd005169">ext_cmp_pattern</a></div><div class="ttdeci">static int ext_cmp_pattern(const char *left, const char *right)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02078">pbx.c:2078</a></div></div>
<div class="ttc" id="pbx_8c_html_aabe7e55731958e6cf97514e584cc2cfc"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aabe7e55731958e6cf97514e584cc2cfc">testtime_function</a></div><div class="ttdeci">static struct ast_custom_function testtime_function</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08316">pbx.c:8316</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="pbx_8c_html_a34c5d02998c18d892113d659590cd28e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a34c5d02998c18d892113d659590cd28e">switch_data</a></div><div class="ttdeci">static struct ast_threadstorage switch_data</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00228">pbx.c:228</a></div></div>
<div class="ttc" id="pbx_8c_html_ae9b65b0515d88371a5293dd354bfd92f"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae9b65b0515d88371a5293dd354bfd92f">ast_parseable_goto</a></div><div class="ttdeci">int ast_parseable_goto(struct ast_channel *chan, const char *goto_string)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08859">pbx.c:8859</a></div></div>
<div class="ttc" id="group__applications_html_ga1388863a3809fb197d2c1c2748c02e7f"><div class="ttname"><a href="../../d9/dc9/group__applications.html#ga1388863a3809fb197d2c1c2748c02e7f">indicate_busy</a></div><div class="ttdeci">int indicate_busy(struct ast_channel *chan, const char *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d1d/pbx__builtins_8c_source.html#l00739">pbx_builtins.c:739</a></div></div>
<div class="ttc" id="pbx_8c_html_ae56fdb340b23940f7a64ed2e37c1774a"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae56fdb340b23940f7a64ed2e37c1774a">STATUS_SUCCESS</a></div><div class="ttdeci">#define STATUS_SUCCESS</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02471">pbx.c:2471</a></div></div>
<div class="ttc" id="pbx_8c_html_acec5cab19e772712434bf03875b57e9a"><div class="ttname"><a href="../../db/d94/pbx_8c.html#acec5cab19e772712434bf03875b57e9a">ast_context_remove_include</a></div><div class="ttdeci">int ast_context_remove_include(const char *context, const char *include, const char *registrar)</div><div class="ttdoc">Remove included contexts. This function locks contexts list by &amp;conlist, search for the right context...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04840">pbx.c:4840</a></div></div>
<div class="ttc" id="structast__device__state__info_html_afe5e5e5a4f8a73f3cbf66466c8c8c00f"><div class="ttname"><a href="../../dc/d4d/structast__device__state__info.html#afe5e5e5a4f8a73f3cbf66466c8c8c00f">ast_device_state_info::device_state</a></div><div class="ttdeci">enum ast_device_state device_state</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00097">pbx.h:97</a></div></div>
<div class="ttc" id="pbx_8c_html_a95e73ba35332c4ae9accb2ca3329ea41"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a95e73ba35332c4ae9accb2ca3329ea41">print_ext</a></div><div class="ttdeci">static void print_ext(struct ast_exten *e, char *buf, int buflen)</div><div class="ttdoc">helper function to print an extension </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05487">pbx.c:5487</a></div></div>
<div class="ttc" id="structpbx__outgoing_html_a56990e06ce7fc176509a38f9d1258476"><div class="ttname"><a href="../../d4/dcb/structpbx__outgoing.html#a56990e06ce7fc176509a38f9d1258476">pbx_outgoing::dial</a></div><div class="ttdeci">struct ast_dial * dial</div><div class="ttdoc">Dialing structure being used. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07591">pbx.c:7591</a></div></div>
<div class="ttc" id="linkedlists_8h_html"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html">linkedlists.h</a></div><div class="ttdoc">A set of macros to manage forward-linked lists. </div></div>
<div class="ttc" id="pbx_8c_html_a9ccbd387b4acc01572f585c55633c417"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a9ccbd387b4acc01572f585c55633c417">show_debug_helper</a></div><div class="ttdeci">static int show_debug_helper(int fd, const char *context, const char *exten, struct dialplan_counters *dpc, struct ast_include *rinclude, int includecount, const char *includes[])</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05677">pbx.c:5677</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="structast__exten_html_ad11dc8dd7d18a2cf6451b32ea529221c"><div class="ttname"><a href="../../d7/d00/structast__exten.html#ad11dc8dd7d18a2cf6451b32ea529221c">ast_exten::datad</a></div><div class="ttdeci">void(* datad)(void *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00249">pbx.c:249</a></div></div>
<div class="ttc" id="res__fax_8c_html_a7ea220e4d14b05876af4430e9832ce47"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">container</a></div><div class="ttdeci">struct ao2_container * container</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00502">res_fax.c:502</a></div></div>
<div class="ttc" id="pbx_8h_html_a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc">AST_EXTENSION_RINGING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00068">pbx.h:68</a></div></div>
<div class="ttc" id="pbx_8c_html_a36264871dfb05b0e331f7a6f19049ab6"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a36264871dfb05b0e331f7a6f19049ab6">cli_match_char_tree</a></div><div class="ttdeci">static void cli_match_char_tree(struct match_char *node, char *prefix, int fd)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01111">pbx.c:1111</a></div></div>
<div class="ttc" id="vector_8h_html_aecf5cf511c06438b264c501224d13d89"><div class="ttname"><a href="../../d6/d68/vector_8h.html#aecf5cf511c06438b264c501224d13d89">AST_VECTOR</a></div><div class="ttdeci">#define AST_VECTOR(name, type)</div><div class="ttdoc">Define a vector structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00044">vector.h:44</a></div></div>
<div class="ttc" id="structast__context_html_a37fab5903a397434aa8bde4a88290528"><div class="ttname"><a href="../../d6/d7c/structast__context.html#a37fab5903a397434aa8bde4a88290528">ast_context::includes</a></div><div class="ttdeci">struct ast_includes includes</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00290">pbx.c:290</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aadfe2a69fbba4f27c201266a2ca5f989"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a></div><div class="ttdeci">#define AST_LIST_REMOVE_HEAD(head, field)</div><div class="ttdoc">Removes and returns the head entry from a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00832">linkedlists.h:832</a></div></div>
<div class="ttc" id="pbx_8c_html_a3eef12b7f28d62e9fc68f80f1ae15569"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3eef12b7f28d62e9fc68f80f1ae15569">exception_store_info</a></div><div class="ttdeci">static const struct ast_datastore_info exception_store_info</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02790">pbx.c:2790</a></div></div>
<div class="ttc" id="causes_8h_html_af03fc9fe2f0ecc69330e014aff8d0f73"><div class="ttname"><a href="../../d4/da3/causes_8h.html#af03fc9fe2f0ecc69330e014aff8d0f73">AST_CAUSE_NO_ANSWER</a></div><div class="ttdeci">#define AST_CAUSE_NO_ANSWER</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00108">causes.h:108</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="pbx_8c_html_a7470458bc954de8f3d698bd99b25aed5"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a7470458bc954de8f3d698bd99b25aed5">conlock</a></div><div class="ttdeci">static ast_mutex_t conlock</div><div class="ttdoc">Lock for the ast_context list. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00785">pbx.c:785</a></div></div>
<div class="ttc" id="reqresp__parser_8h_html_a7e4aa55331b8292eff94249de72b807d"><div class="ttname"><a href="../../d1/d8f/reqresp__parser_8h.html#a7e4aa55331b8292eff94249de72b807d">AST_LIST_HEAD_NOLOCK</a></div><div class="ttdeci">AST_LIST_HEAD_NOLOCK(contactliststruct, contact)</div></div>
<div class="ttc" id="pbx_8h_html_ad2e753a683024fad0b34ece3b1aef83a"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a></div><div class="ttdeci">#define PRIORITY_HINT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00054">pbx.h:54</a></div></div>
<div class="ttc" id="structscoreboard_html_a4de425bb2743e2e19c2e954dfe1f0bf8"><div class="ttname"><a href="../../db/d2d/structscoreboard.html#a4de425bb2743e2e19c2e954dfe1f0bf8">scoreboard::total_specificity</a></div><div class="ttdeci">int total_specificity</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00274">pbx.c:274</a></div></div>
<div class="ttc" id="structoutgoing_html"><div class="ttname"><a href="../../de/dcd/structoutgoing.html">outgoing</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/pbx__spool_8c_source.html#l00077">pbx_spool.c:77</a></div></div>
<div class="ttc" id="pbx_8h_html_aa170ac775ac95bf40afa9a46f4a4af8f"><div class="ttname"><a href="../../db/de0/pbx_8h.html#aa170ac775ac95bf40afa9a46f4a4af8f">ast_switch_f</a></div><div class="ttdeci">int() ast_switch_f(struct ast_channel *chan, const char *context, const char *exten, int priority, const char *callerid, const char *data)</div><div class="ttdoc">All switch functions have the same interface, so define a type for them. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00156">pbx.h:156</a></div></div>
<div class="ttc" id="structast__exten_html_a10c9abe707a81a9cabd06ee4b53ac0fe"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">ast_exten::peer_label_table</a></div><div class="ttdeci">struct ast_hashtab * peer_label_table</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00252">pbx.c:252</a></div></div>
<div class="ttc" id="structast__autohint_html_ab990a3529ebde2681a00468cad7c0b48"><div class="ttname"><a href="../../da/d7f/structast__autohint.html#ab990a3529ebde2681a00468cad7c0b48">ast_autohint::registrar</a></div><div class="ttdeci">char * registrar</div><div class="ttdoc">Name of the registrar. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00387">pbx.c:387</a></div></div>
<div class="ttc" id="pbx_8c_html_a824bc8f418b4536d2ed8bc44ec112e10"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a824bc8f418b4536d2ed8bc44ec112e10">unload_pbx</a></div><div class="ttdeci">static void unload_pbx(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08448">pbx.c:8448</a></div></div>
<div class="ttc" id="hashtab_8h_html_a9c804e9bfc8355c25197187f0c6d0265"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265">ast_hashtab_end_traversal</a></div><div class="ttdeci">void ast_hashtab_end_traversal(struct ast_hashtab_iter *it)</div><div class="ttdoc">end the traversal, free the iterator, unlock if necc. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00674">hashtab.c:674</a></div></div>
<div class="ttc" id="pbx_8c_html_a5062f2413e9425755149f855577b602f"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a></div><div class="ttdeci">#define STATUS_NO_LABEL</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02470">pbx.c:2470</a></div></div>
<div class="ttc" id="pbx_8c_html_a323f8eb5d2722c6fff9467eff52ae4b5"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a323f8eb5d2722c6fff9467eff52ae4b5">ast_context_add_ignorepat</a></div><div class="ttdeci">int ast_context_add_ignorepat(const char *context, const char *value, const char *registrar)</div><div class="ttdoc">Add an ignorepat. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06877">pbx.c:6877</a></div></div>
<div class="ttc" id="channel_8h_html_aa8b52fbc8168e939bc5553502367d46a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a></div><div class="ttdeci">const char * ast_channel_exten(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00353">channel_internal_api.c:353</a></div></div>
<div class="ttc" id="dial_8h_html_a051c20e595f3e3c2be10c84b4247dd37"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a051c20e595f3e3c2be10c84b4247dd37">ast_dial_state</a></div><div class="ttdeci">enum ast_dial_result ast_dial_state(struct ast_dial *dial)</div><div class="ttdoc">Return state of dial. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l01012">dial.c:1012</a></div></div>
<div class="ttc" id="pbx_8h_html"><div class="ttname"><a href="../../db/de0/pbx_8h.html">pbx.h</a></div><div class="ttdoc">Core PBX routines and definitions. </div></div>
<div class="ttc" id="localtime_8h_html_a3eb2c73accce1b149ce597de80d1677a"><div class="ttname"><a href="../../d5/deb/localtime_8h.html#a3eb2c73accce1b149ce597de80d1677a">ast_strptime</a></div><div class="ttdeci">char * ast_strptime(const char *s, const char *format, struct ast_tm *tm)</div><div class="ttdoc">Special version of strptime(3) which places the answer in the common structure ast_tm. Also, unlike strptime(3), ast_strptime() initializes its memory prior to use. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l02550">localtime.c:2550</a></div></div>
<div class="ttc" id="pbx_8c_html_ae0ba2eb966a9e3376de61d30513f7302"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae0ba2eb966a9e3376de61d30513f7302">ast_async_goto</a></div><div class="ttdeci">int ast_async_goto(struct ast_channel *chan, const char *context, const char *exten, int priority)</div><div class="ttdoc">Set the channel to next execute the specified dialplan location. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07011">pbx.c:7011</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00054">devicestate.h:54</a></div></div>
<div class="ttc" id="channel_8h_html_a08bde7d8cf72457fc8c519a4443b413b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b">ast_autoservice_stop</a></div><div class="ttdeci">int ast_autoservice_stop(struct ast_channel *chan)</div><div class="ttdoc">Stop servicing a channel for us... </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d66/autoservice_8c_source.html#l00266">autoservice.c:266</a></div></div>
<div class="ttc" id="pbx_8h_html_a0e4eb357d2ef42629fbcf191a473f735"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a></div><div class="ttdeci">ast_pbx_result</div><div class="ttdoc">The result codes when starting the PBX on a channel with ast_pbx_start. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00354">pbx.h:354</a></div></div>
<div class="ttc" id="dial_8h_html_a65e30d29847af5495afe1baed823957e"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a65e30d29847af5495afe1baed823957e">ast_dial_run</a></div><div class="ttdeci">enum ast_dial_result ast_dial_run(struct ast_dial *dial, struct ast_channel *chan, int async)</div><div class="ttdoc">Execute dialing synchronously or asynchronously. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l00939">dial.c:939</a></div></div>
<div class="ttc" id="channel_8h_html_a9c63fff1d736568d1ee332dd7ea502bd"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd">ast_check_hangup</a></div><div class="ttdeci">int ast_check_hangup(struct ast_channel *chan)</div><div class="ttdoc">Check to see if a channel is needing hang up. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l00445">channel.c:445</a></div></div>
<div class="ttc" id="structstore__hint_html_abb78dc46b9abb01d17e33d9c04684d9e"><div class="ttname"><a href="../../d0/ddc/structstore__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">store_hint::last_presence_subtype</a></div><div class="ttdeci">char * last_presence_subtype</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06285">pbx.c:6285</a></div></div>
<div class="ttc" id="pbx_8c_html_a665b695dd4aabc37e95f1971e84f700d"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a665b695dd4aabc37e95f1971e84f700d">ast_context_add_ignorepat2</a></div><div class="ttdeci">int ast_context_add_ignorepat2(struct ast_context *con, const char *value, const char *registrar)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06890">pbx.c:6890</a></div></div>
<div class="ttc" id="structpattern__node_html"><div class="ttname"><a href="../../da/ddf/structpattern__node.html">pattern_node</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01452">pbx.c:1452</a></div></div>
<div class="ttc" id="causes_8h_html_a51ccdf5c6aa26375323fd14cfef02618"><div class="ttname"><a href="../../d4/da3/causes_8h.html#a51ccdf5c6aa26375323fd14cfef02618">AST_CAUSE_DESTINATION_OUT_OF_ORDER</a></div><div class="ttdeci">#define AST_CAUSE_DESTINATION_OUT_OF_ORDER</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00114">causes.h:114</a></div></div>
<div class="ttc" id="stasis_8h_html_ae3fe7fe099389094244002113814ec23"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#ae3fe7fe099389094244002113814ec23">stasis_subscribe</a></div><div class="ttdeci">#define stasis_subscribe(topic, callback, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00652">stasis.h:652</a></div></div>
<div class="ttc" id="pbx_8h_html_ad40e50eea098e5c16ef7dd3ffbff1bba"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ad40e50eea098e5c16ef7dd3ffbff1bba">ast_get_ignorepat_name</a></div><div class="ttdeci">const char * ast_get_ignorepat_name(const struct ast_ignorepat *ip)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d63/pbx__ignorepat_8c_source.html#l00042">pbx_ignorepat.c:42</a></div></div>
<div class="ttc" id="pbx_8c_html_aef34845bd9203c43797706dc4edc05d7"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aef34845bd9203c43797706dc4edc05d7">extension_match_core</a></div><div class="ttdeci">static int extension_match_core(const char *pattern, const char *data, enum ext_match_t mode)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02400">pbx.c:2400</a></div></div>
<div class="ttc" id="structast__state__cb__info_html_aa8966b13201b435c8506b79e7ae972b5"><div class="ttname"><a href="../../df/d4c/structast__state__cb__info.html#aa8966b13201b435c8506b79e7ae972b5">ast_state_cb_info::device_state_info</a></div><div class="ttdeci">struct ao2_container * device_state_info</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00105">pbx.h:105</a></div></div>
<div class="ttc" id="pbx_8c_html_a26c679c70c1a8dd0968579be0c1755ab"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a26c679c70c1a8dd0968579be0c1755ab">ast_get_extension_matchcid</a></div><div class="ttdeci">int ast_get_extension_matchcid(struct ast_exten *e)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08586">pbx.c:8586</a></div></div>
<div class="ttc" id="pbx_8c_html_a00f40129528e1bb08c291ddf96075f9e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a00f40129528e1bb08c291ddf96075f9e">pbx_outgoing_state_callback</a></div><div class="ttdeci">static void pbx_outgoing_state_callback(struct ast_dial *dial)</div><div class="ttdoc">Internal dialing state callback which causes early media to trigger an answer. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07690">pbx.c:7690</a></div></div>
<div class="ttc" id="term_8h_html_aee88b2ffd7fd2128fe38896cffb1a71a"><div class="ttname"><a href="../../db/d45/term_8h.html#aee88b2ffd7fd2128fe38896cffb1a71a">COLOR_BRMAGENTA</a></div><div class="ttdeci">#define COLOR_BRMAGENTA</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/term_8h_source.html#l00058">term.h:58</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="structast__cli__args_html_ad0a19c4d63698f9e9cfd5653e8851452"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">ast_cli_args::argv</a></div><div class="ttdeci">const char *const  * argv</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00161">cli.h:161</a></div></div>
<div class="ttc" id="devicestate_8h_html_a45534707838d05125f409430b371854a"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a45534707838d05125f409430b371854a">ast_devstate_aggregate_add</a></div><div class="ttdeci">void ast_devstate_aggregate_add(struct ast_devstate_aggregate *agg, enum ast_device_state state)</div><div class="ttdoc">Add a device state to the aggregate device state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/devicestate_8c_source.html#l00636">devicestate.c:636</a></div></div>
<div class="ttc" id="devicestate_8h_html_a6190de57ac370315e51f2c46724d5b10"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a6190de57ac370315e51f2c46724d5b10">ast_devstate_str</a></div><div class="ttdeci">const char * ast_devstate_str(enum ast_device_state devstate) attribute_pure</div><div class="ttdoc">Convert device state to text string that is easier to parse. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/devicestate_8c_source.html#l00255">devicestate.c:255</a></div></div>
<div class="ttc" id="structast__channel_html_abe3b191f9529aba5e60447f982310648"><div class="ttname"><a href="../../df/d3c/structast__channel.html#abe3b191f9529aba5e60447f982310648">ast_channel::dialed</a></div><div class="ttdeci">struct ast_party_dialed dialed</div><div class="ttdoc">Dialed/Called information. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00126">channel_internal_api.c:126</a></div></div>
<div class="ttc" id="pbx_8c_html_ad8dce29a8b7c75e3a6ed93630d4ee713"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ad8dce29a8b7c75e3a6ed93630d4ee713">pbx_shutdown</a></div><div class="ttdeci">static void pbx_shutdown(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08909">pbx.c:8909</a></div></div>
<div class="ttc" id="asterisk_8h_html_a075573924d385edb22dd8dedbd433256"><div class="ttname"><a href="../../db/db2/asterisk_8h.html#a075573924d385edb22dd8dedbd433256">ast_add_profile</a></div><div class="ttdeci">int ast_add_profile(const char *, uint64_t scale)</div><div class="ttdoc">support for event profiling </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d4d/astman_8c_source.html#l00092">astman.c:92</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00056">devicestate.h:56</a></div></div>
<div class="ttc" id="pbx_8c_html_aa780584a8327cbe41d566b91e119eb97"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa780584a8327cbe41d566b91e119eb97">ast_context_ignorepats_count</a></div><div class="ttdeci">int ast_context_ignorepats_count(const struct ast_context *con)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08740">pbx.c:8740</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gafadf012f66a9fd7ecf985ec5b9dee101"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a></div><div class="ttdeci">int ast_manager_unregister(const char *action)</div><div class="ttdoc">Unregister a registered manager command. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l07258">manager.c:7258</a></div></div>
<div class="ttc" id="pbx_8c_html_a43cf2fd635776b81a4e9049e1bc5cecd"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a43cf2fd635776b81a4e9049e1bc5cecd">ext_fluff_count</a></div><div class="ttdeci">static int ext_fluff_count(const char *exten)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02148">pbx.c:2148</a></div></div>
<div class="ttc" id="manager_8h_html"><div class="ttname"><a href="../../db/d45/manager_8h.html">manager.h</a></div><div class="ttdoc">The AMI - Asterisk Manager Interface - is a TCP protocol created to manage Asterisk with third-party ...</div></div>
<div class="ttc" id="pbx_8h_html_a653bef57d41c00d6b1f79c94fe19ec7b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a653bef57d41c00d6b1f79c94fe19ec7b">AST_PBX_INCOMPLETE</a></div><div class="ttdeci">#define AST_PBX_INCOMPLETE</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00051">pbx.h:51</a></div></div>
<div class="ttc" id="structast__hint_html_a59579819b2ad4c02bcf0c74c23cb468d"><div class="ttname"><a href="../../d8/dac/structast__hint.html#a59579819b2ad4c02bcf0c74c23cb468d">ast_hint::exten</a></div><div class="ttdeci">struct ast_exten * exten</div><div class="ttdoc">Hint extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00331">pbx.c:331</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaf195fcf1686408b5e52ad76996653cea"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaf195fcf1686408b5e52ad76996653cea">ast_channel_stage_snapshot</a></div><div class="ttdeci">void ast_channel_stage_snapshot(struct ast_channel *chan)</div><div class="ttdoc">Set flag to indicate channel snapshot is being staged. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l01038">stasis_channels.c:1038</a></div></div>
<div class="ttc" id="pbx_8c_html_aeed0f59adddf334e592ea0dc360b6a8c"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aeed0f59adddf334e592ea0dc360b6a8c">manager_show_dialplan_helper</a></div><div class="ttdeci">static int manager_show_dialplan_helper(struct mansession *s, const struct message *m, const char *actionidtext, const char *context, const char *exten, struct dialplan_counters *dpc, const struct ast_include *rinclude, int includecount, const char *includes[])</div><div class="ttdoc">Show dialplan extensions XXX this function is similar but not exactly the same as the CLI&amp;#39;s show dial...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05864">pbx.c:5864</a></div></div>
<div class="ttc" id="pbx_8c_html_a4ee70a9380daf9be2bf681becb1a69c3"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a4ee70a9380daf9be2bf681becb1a69c3">hashtab_hash_priority</a></div><div class="ttdeci">static unsigned int hashtab_hash_priority(const void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00751">pbx.c:751</a></div></div>
<div class="ttc" id="presencestate_8h_html"><div class="ttname"><a href="../../d6/dd7/presencestate_8h.html">presencestate.h</a></div><div class="ttdoc">Presence state management. </div></div>
<div class="ttc" id="pbx_8h_html_a40b191a3f395775ddd84d363c8fbd030a37db4d8017d05366c5b19084c5c5c84c"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a40b191a3f395775ddd84d363c8fbd030a37db4d8017d05366c5b19084c5c5c84c">AST_EXT_MATCHCID_ANY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00080">pbx.h:80</a></div></div>
<div class="ttc" id="structast__hint_html_add515701b5f4974e3d3512e034479a86"><div class="ttname"><a href="../../d8/dac/structast__hint.html#add515701b5f4974e3d3512e034479a86">ast_hint::context_name</a></div><div class="ttdeci">char context_name[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00342">pbx.c:342</a></div></div>
<div class="ttc" id="pbx_8c_html_ae517a87b356aec60d5de4591ef94581b"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a></div><div class="ttdeci">int ast_unlock_contexts(void)</div><div class="ttdoc">Unlocks contexts. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08512">pbx.c:8512</a></div></div>
<div class="ttc" id="pbx_8h_html_a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490">AST_PBX_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00356">pbx.h:356</a></div></div>
<div class="ttc" id="pbx_8c_html_afbc14f8c1eb89e675d42e8d7fe33d276"><div class="ttname"><a href="../../db/d94/pbx_8c.html#afbc14f8c1eb89e675d42e8d7fe33d276">set_ext_pri</a></div><div class="ttdeci">void set_ext_pri(struct ast_channel *c, const char *exten, int pri)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04268">pbx.c:4268</a></div></div>
<div class="ttc" id="pbx_8c_html_a68752b8c650f91f9f3e36d6ce36bba2e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a68752b8c650f91f9f3e36d6ce36bba2e">context_merge</a></div><div class="ttdeci">static void context_merge(struct ast_context **extcontexts, struct ast_hashtab *exttable, struct ast_context *context, const char *registrar)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06369">pbx.c:6369</a></div></div>
<div class="ttc" id="structast__exten_html_a0f7fc37040d0e6f05e756cf921c14a31"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a0f7fc37040d0e6f05e756cf921c14a31">ast_exten::exten</a></div><div class="ttdeci">char * exten</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00238">pbx.c:238</a></div></div>
<div class="ttc" id="structast__context_html_ace4e0066a5b24f84b90536e9906619f6"><div class="ttname"><a href="../../d6/d7c/structast__context.html#ace4e0066a5b24f84b90536e9906619f6">ast_context::lock</a></div><div class="ttdeci">ast_rwlock_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00285">pbx.c:285</a></div></div>
<div class="ttc" id="pbx_8c_html_a61bf09bfdadba04e51d6576aa014e097"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a61bf09bfdadba04e51d6576aa014e097">pbx_thread</a></div><div class="ttdeci">static void * pbx_thread(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04692">pbx.c:4692</a></div></div>
<div class="ttc" id="pbx_8c_html_a3fe692162e8e78eed9d4ccc2370a49eb"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3fe692162e8e78eed9d4ccc2370a49eb">ast_extension_state_add_destroy</a></div><div class="ttdeci">int ast_extension_state_add_destroy(const char *context, const char *exten, ast_state_cb_type change_cb, ast_state_cb_destroy_type destroy_cb, void *data)</div><div class="ttdoc">Add watcher for extension states with destructor. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03819">pbx.c:3819</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="time_8h_html_a6daa33e2052acd094bb63e78aba29733"><div class="ttname"><a href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a></div><div class="ttdeci">int ast_tvcmp(struct timeval _a, struct timeval _b)</div><div class="ttdoc">Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller, equal or greater to the second. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00128">time.h:128</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a4d258b4525e63c435d7de579d3f46960"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a></div><div class="ttdeci">#define AST_LIST_INSERT_TAIL(head, elm, field)</div><div class="ttdoc">Appends a list entry to the tail of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00730">linkedlists.h:730</a></div></div>
<div class="ttc" id="manager_8h_html_a36fb89c2a73755209133b6c73fe92e54"><div class="ttname"><a href="../../db/d45/manager_8h.html#a36fb89c2a73755209133b6c73fe92e54">EVENT_FLAG_CONFIG</a></div><div class="ttdeci">#define EVENT_FLAG_CONFIG</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00078">manager.h:78</a></div></div>
<div class="ttc" id="astobj2_8h_html_aefc16f8aa9087cbc5c55c70cf1dd41b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a></div><div class="ttdeci">#define ao2_container_alloc_hash(ao2_options, container_options, n_buckets, hash_fn, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01310">astobj2.h:1310</a></div></div>
<div class="ttc" id="structast__hint_html_a0078d2e3ae10f15d7634c01199f33d4f"><div class="ttname"><a href="../../d8/dac/structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">ast_hint::laststate</a></div><div class="ttdeci">int laststate</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00335">pbx.c:335</a></div></div>
<div class="ttc" id="structstore__hint_html_a9138102d461098886592f66e9fb82806"><div class="ttname"><a href="../../d0/ddc/structstore__hint.html#a9138102d461098886592f66e9fb82806">store_hint::callbacks</a></div><div class="ttdeci">struct store_hint::@410 callbacks</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l02442">extconf.c:2442</a></div></div>
<div class="ttc" id="pbx_8c_html_a0be9518646cf9aca4878b313cc02e901"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a0be9518646cf9aca4878b313cc02e901">ast_findlabel_extension</a></div><div class="ttdeci">int ast_findlabel_extension(struct ast_channel *c, const char *context, const char *exten, const char *label, const char *callerid)</div><div class="ttdoc">Find the priority of an extension that has the specified label. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04184">pbx.c:4184</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="structast__format__cap_html"><div class="ttname"><a href="../../d8/d69/structast__format__cap.html">ast_format_cap</a></div><div class="ttdoc">Format capabilities structure, holds formats + preference order + etc. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dc9/format__cap_8c_source.html#l00054">format_cap.c:54</a></div></div>
<div class="ttc" id="pbx_8h_html_a3414b82af9b33fe907c9377c5c73c453"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a3414b82af9b33fe907c9377c5c73c453">AST_MAX_APP</a></div><div class="ttdeci">#define AST_MAX_APP</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00040">pbx.h:40</a></div></div>
<div class="ttc" id="structstore__hints_html"><div class="ttname"><a href="../../d3/d4d/structstore__hints.html">store_hints</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06292">pbx.c:6292</a></div></div>
<div class="ttc" id="logger_8h_html_a6cd2a7c20c6cfe0e3f4fed72dd2cc6b2"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a6cd2a7c20c6cfe0e3f4fed72dd2cc6b2">ast_create_callid</a></div><div class="ttdeci">ast_callid ast_create_callid(void)</div><div class="ttdoc">factory function to create a new uniquely identifying callid. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/logger_8c_source.html#l01957">logger.c:1957</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00278">include/asterisk/frame.h:278</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00055">devicestate.h:55</a></div></div>
<div class="ttc" id="pbx_8c_html_aeb0407c693573096981db1a00fab4eb8"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aeb0407c693573096981db1a00fab4eb8">pbx_set_autofallthrough</a></div><div class="ttdeci">int pbx_set_autofallthrough(int newval)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04774">pbx.c:4774</a></div></div>
<div class="ttc" id="structstore__hint_html_a0078d2e3ae10f15d7634c01199f33d4f"><div class="ttname"><a href="../../d0/ddc/structstore__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">store_hint::laststate</a></div><div class="ttdeci">int laststate</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06283">pbx.c:6283</a></div></div>
<div class="ttc" id="cli_8h_html_a0873456096960dab21fff0ce68c95acb"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a></div><div class="ttdeci">#define CLI_SHOWUSAGE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00045">cli.h:45</a></div></div>
<div class="ttc" id="pbx_8c_html_a35c102fc9fe7a0bc1da75ac50d0982db"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a35c102fc9fe7a0bc1da75ac50d0982db">ast_extension_state3</a></div><div class="ttdeci">static int ast_extension_state3(struct ast_str *hint_app, struct ao2_container *device_state_info)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03081">pbx.c:3081</a></div></div>
<div class="ttc" id="hashtab_8h_html_a313b62d20344c2c85461dd4ed893017c"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#a313b62d20344c2c85461dd4ed893017c">ast_hashtab_remove_object_via_lookup</a></div><div class="ttdeci">void * ast_hashtab_remove_object_via_lookup(struct ast_hashtab *tab, void *obj)</div><div class="ttdoc">Looks up the object, removes the corresponding bucket. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00746">hashtab.c:746</a></div></div>
<div class="ttc" id="pbx_8c_html_aad00874b99ffc028615d6bfe93ae5496"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aad00874b99ffc028615d6bfe93ae5496">_extension_match_core</a></div><div class="ttdeci">static int _extension_match_core(const char *pattern, const char *data, enum ext_match_t mode)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02209">pbx.c:2209</a></div></div>
<div class="ttc" id="pbx_8c_html_a08cb2466bf2b7844066c2e1f62a298db"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a08cb2466bf2b7844066c2e1f62a298db">manager_show_dialplan</a></div><div class="ttdeci">static int manager_show_dialplan(struct mansession *s, const struct message *m)</div><div class="ttdoc">Manager listing of dial plan. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06019">pbx.c:6019</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
<div class="ttc" id="pbx_8c_html_a25c1ae521dc0aa6949e716b8ce49b4e7"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a25c1ae521dc0aa6949e716b8ce49b4e7">ast_get_extension_registrar_line</a></div><div class="ttdeci">int ast_get_extension_registrar_line(struct ast_exten *e)</div><div class="ttdoc">Get line number of configuration file used by registrar to register this extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08581">pbx.c:8581</a></div></div>
<div class="ttc" id="pbx__ignorepat_8c_html_a44fe4216a998a19409ee4c755698ff8c"><div class="ttname"><a href="../../d9/d63/pbx__ignorepat_8c.html#a44fe4216a998a19409ee4c755698ff8c">ignorepat_alloc</a></div><div class="ttdeci">struct ast_ignorepat * ignorepat_alloc(const char *value, const char *registrar)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d63/pbx__ignorepat_8c_source.html#l00052">pbx_ignorepat.c:52</a></div></div>
<div class="ttc" id="pbx_8c_html_a64ec6367a27dcdeb7ce0b7b614a2cc44"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a64ec6367a27dcdeb7ce0b7b614a2cc44">compare_char</a></div><div class="ttdeci">static int compare_char(const void *a, const void *b)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00674">pbx.c:674</a></div></div>
<div class="ttc" id="stasis_8h_html_a72a06fdaec039fdfb5f36892e725f9ec"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a72a06fdaec039fdfb5f36892e725f9ec">stasis_message_create</a></div><div class="ttdeci">struct stasis_message * stasis_message_create(struct stasis_message_type *type, void *data)</div><div class="ttdoc">Create a new message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00174">stasis_message.c:174</a></div></div>
<div class="ttc" id="pbx_8c_html_a9a937fbb3b5f4e68880a9c5714a29ce5"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a9a937fbb3b5f4e68880a9c5714a29ce5">ast_pbx_start</a></div><div class="ttdeci">enum ast_pbx_result ast_pbx_start(struct ast_channel *c)</div><div class="ttdoc">Create a new thread and start the PBX. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04712">pbx.c:4712</a></div></div>
<div class="ttc" id="pbx_8c_html_ae0ab68739556d89d38b0c050d6e2b469"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae0ab68739556d89d38b0c050d6e2b469">autohint_cmp</a></div><div class="ttdeci">static int autohint_cmp(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00474">pbx.c:474</a></div></div>
<div class="ttc" id="structast__context_html_a2a7f851274ec18e17d38114c39b8511a"><div class="ttname"><a href="../../d6/d7c/structast__context.html#a2a7f851274ec18e17d38114c39b8511a">ast_context::name</a></div><div class="ttdeci">char name[0]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00297">pbx.c:297</a></div></div>
<div class="ttc" id="structast__ignorepat_html"><div class="ttname"><a href="../../d0/d11/structast__ignorepat.html">ast_ignorepat</a></div><div class="ttdoc">ast_ignorepat: Ignore patterns in dial plan </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d63/pbx__ignorepat_8c_source.html#l00037">pbx_ignorepat.c:37</a></div></div>
<div class="ttc" id="structfake__context_html"><div class="ttname"><a href="../../d6/da7/structfake__context.html">fake_context</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02426">pbx.c:2426</a></div></div>
<div class="ttc" id="pbx_8h_html_a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6">AST_EXTENSION_NOT_INUSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00064">pbx.h:64</a></div></div>
<div class="ttc" id="lock_8h_html_a9b07039db138693d1ebe02c3e99ddcab"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a9b07039db138693d1ebe02c3e99ddcab">ast_rwlock_init</a></div><div class="ttdeci">#define ast_rwlock_init(rwlock)</div><div class="ttdoc">wrapper for rwlock with tracking enabled </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00222">lock.h:222</a></div></div>
<div class="ttc" id="pbx_8c_html_aa2d7a93c24186594d8c09e904fa17132"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa2d7a93c24186594d8c09e904fa17132">STATUS_NO_CONTEXT</a></div><div class="ttdeci">#define STATUS_NO_CONTEXT</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02467">pbx.c:2467</a></div></div>
<div class="ttc" id="namespacesip__to__pjsip_html_ab82f408a83ecba10ea39afd8abfd371e"><div class="ttname"><a href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">sip_to_pjsip.info</a></div><div class="ttdeci">def info(msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d6f/sip__to__pjsip_8py_source.html#l01313">sip_to_pjsip.py:1313</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="structast__autohint_html"><div class="ttname"><a href="../../da/d7f/structast__autohint.html">ast_autohint</a></div><div class="ttdoc">Structure for dial plan autohints. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00385">pbx.c:385</a></div></div>
<div class="ttc" id="pbx_8c_html_a28214486cef68144f99f63097be8a1d5"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a28214486cef68144f99f63097be8a1d5">acf_exception_read</a></div><div class="ttdeci">static int acf_exception_read(struct ast_channel *chan, const char *name, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02832">pbx.c:2832</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="pbx_8h_html_a17db9d0ffeebca9413e2e7dcb2ddd811"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a17db9d0ffeebca9413e2e7dcb2ddd811">ast_thread_inhibit_escalations_swap</a></div><div class="ttdeci">int ast_thread_inhibit_escalations_swap(int inhibit)</div><div class="ttdoc">Swap the current thread escalation inhibit setting. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d70/pbx__functions_8c_source.html#l00494">pbx_functions.c:494</a></div></div>
<div class="ttc" id="structast__state__cb_html_afdefecc023555cdad67e84d30ff1d997"><div class="ttname"><a href="../../d6/d37/structast__state__cb.html#afdefecc023555cdad67e84d30ff1d997">ast_state_cb::destroy_cb</a></div><div class="ttdeci">ast_state_cb_destroy_type destroy_cb</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00311">pbx.c:311</a></div></div>
<div class="ttc" id="structast__hint_html"><div class="ttname"><a href="../../d8/dac/structast__hint.html">ast_hint</a></div><div class="ttdoc">Structure for dial plan hints. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00324">pbx.c:324</a></div></div>
<div class="ttc" id="structast__hashtab_html"><div class="ttname"><a href="../../d0/d4a/structast__hashtab.html">ast_hashtab</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da0/hashtab_8h_source.html#l00083">hashtab.h:83</a></div></div>
<div class="ttc" id="pbx_8c_html_a594f1f57f847b59c1d8aeef4b0e3a337"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a594f1f57f847b59c1d8aeef4b0e3a337">ast_extension_match</a></div><div class="ttdeci">int ast_extension_match(const char *pattern, const char *data)</div><div class="ttdoc">Determine if a given extension matches a given pattern (in NXX format) </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02413">pbx.c:2413</a></div></div>
<div class="ttc" id="pbx_8c_html_ae9a20ca55100e97d325d306500dd49bd"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae9a20ca55100e97d325d306500dd49bd">NEW_MATCHER_CHK_MATCH</a></div><div class="ttdeci">#define NEW_MATCHER_CHK_MATCH</div></div>
<div class="ttc" id="astobj2_8h_html_aeca960ec22a1d0384f6e285b25df8501"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aeca960ec22a1d0384f6e285b25df8501">ao2_t_callback</a></div><div class="ttdeci">#define ao2_t_callback(c, flags, cb_fn, arg, tag)</div><div class="ttdoc">ao2_callback() is a generic function that applies cb_fn() to all objects in a container, as described below. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01714">astobj2.h:1714</a></div></div>
<div class="ttc" id="structast__party__connected__line_html"><div class="ttname"><a href="../../dc/d9e/structast__party__connected__line.html">ast_party_connected_line</a></div><div class="ttdoc">Connected Line/Party information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00457">channel.h:457</a></div></div>
<div class="ttc" id="dial_8h_html_a2bd4d9ffd57e401b004cc131bd2ad497"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a2bd4d9ffd57e401b004cc131bd2ad497">ast_dial_append</a></div><div class="ttdeci">int ast_dial_append(struct ast_dial *dial, const char *tech, const char *device, const struct ast_assigned_ids *assignedids)</div><div class="ttdoc">Append a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l00282">dial.c:282</a></div></div>
<div class="ttc" id="pbx_8c_html_ac1dd446fcf3d75d5da9228faf2dce1d3"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ac1dd446fcf3d75d5da9228faf2dce1d3">device_state_cb</a></div><div class="ttdeci">static void device_state_cb(void *unused, struct stasis_subscription *sub, struct stasis_message *msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03584">pbx.c:3584</a></div></div>
<div class="ttc" id="app__meetme_8c_html_a18b6f1cf748d864dd085819a7d4e6680"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#a18b6f1cf748d864dd085819a7d4e6680">first</a></div><div class="ttdeci">struct sla_ringing_trunk * first</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01092">app_meetme.c:1092</a></div></div>
<div class="ttc" id="extconf_8h_html_a05848c0de74d85dc2fb259f332d33f25"><div class="ttname"><a href="../../dd/ddb/extconf_8h.html#a05848c0de74d85dc2fb259f332d33f25">AST_PBX_MAX_STACK</a></div><div class="ttdeci">#define AST_PBX_MAX_STACK</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00226">extconf.h:226</a></div></div>
<div class="ttc" id="structfake__context_html_ace4e0066a5b24f84b90536e9906619f6"><div class="ttname"><a href="../../d6/da7/structfake__context.html#ace4e0066a5b24f84b90536e9906619f6">fake_context::lock</a></div><div class="ttdeci">ast_rwlock_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02428">pbx.c:2428</a></div></div>
<div class="ttc" id="channel_8h_html_a9e9505a91a84992d04ba4e85217fb4e4a90cd950abc1c22b0701a476bdd6cc246"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a90cd950abc1c22b0701a476bdd6cc246">AST_SOFTHANGUP_TIMEOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l01139">channel.h:1139</a></div></div>
<div class="ttc" id="pbx_8c_html_a07176e8d314eb68b3b50279fafa11390"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a07176e8d314eb68b3b50279fafa11390">ast_add_extension</a></div><div class="ttdeci">int ast_add_extension(const char *context, int replace, const char *extension, int priority, const char *label, const char *callerid, const char *application, void *data, void(*datad)(void *), const char *registrar)</div><div class="ttdoc">Add and extension to an extension context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06970">pbx.c:6970</a></div></div>
<div class="ttc" id="pbx_8c_html_a2c961dcbdcade8fac28960ed67c89bd2"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a></div><div class="ttdeci">int ast_wrlock_context(struct ast_context *con)</div><div class="ttdoc">Write locks a given context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08520">pbx.c:8520</a></div></div>
<div class="ttc" id="pbx__app_8c_html_a6d3c140ecf1f736c6750d5a17e5bf958"><div class="ttname"><a href="../../dd/d16/pbx__app_8c.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a></div><div class="ttdeci">const char * app_name(struct ast_app *app)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d16/pbx__app_8c_source.html#l00463">pbx_app.c:463</a></div></div>
<div class="ttc" id="astobj2_8h_html_a17990ea630db7dbd1252ef0132133a2b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a></div><div class="ttdeci">#define ao2_iterator_next(iter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01933">astobj2.h:1933</a></div></div>
<div class="ttc" id="lock_8h_html_a1ea2f4040a736cddbecea48b30ffedfd"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a></div><div class="ttdeci">#define ast_cond_destroy(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00200">lock.h:200</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="channel_8h_html_a8873859a4dbc3d0d053d696667e49012"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a8873859a4dbc3d0d053d696667e49012">ast_channel_creationtime</a></div><div class="ttdeci">struct timeval ast_channel_creationtime(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00976">channel_internal_api.c:976</a></div></div>
<div class="ttc" id="logger_8h_html_ad89ee324d180cdcd7defcc709ff9ca42"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a></div><div class="ttdeci">#define LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00263">logger.h:263</a></div></div>
<div class="ttc" id="structpbx__outgoing_html"><div class="ttname"><a href="../../d4/dcb/structpbx__outgoing.html">pbx_outgoing</a></div><div class="ttdoc">Structure which contains information about an outgoing dial. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07589">pbx.c:7589</a></div></div>
<div class="ttc" id="devicestate_8h_html_a9fa7376e8e627cf5a512209005692013"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a9fa7376e8e627cf5a512209005692013">ast_device_state_topic_all</a></div><div class="ttdeci">struct stasis_topic * ast_device_state_topic_all(void)</div><div class="ttdoc">Get the Stasis topic for device state messages. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/devicestate_8c_source.html#l00668">devicestate.c:668</a></div></div>
<div class="ttc" id="structast__hint_html_a9138102d461098886592f66e9fb82806"><div class="ttname"><a href="../../d8/dac/structast__hint.html#a9138102d461098886592f66e9fb82806">ast_hint::callbacks</a></div><div class="ttdeci">struct ao2_container * callbacks</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00332">pbx.c:332</a></div></div>
<div class="ttc" id="pbx_8c_html_a3a7600857afccfa4f7a5c55dcaec8407"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3a7600857afccfa4f7a5c55dcaec8407">extenpatternmatchnew</a></div><div class="ttdeci">static int extenpatternmatchnew</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00764">pbx.c:764</a></div></div>
<div class="ttc" id="structast__hashtab__iter_html"><div class="ttname"><a href="../../d3/d2e/structast__hashtab__iter.html">ast_hashtab_iter</a></div><div class="ttdoc">an iterator for traversing the buckets </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da0/hashtab_8h_source.html#l00105">hashtab.h:105</a></div></div>
<div class="ttc" id="pbx_8c_html_aed1020578edff9baad853fc543464432"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aed1020578edff9baad853fc543464432">collect_digits</a></div><div class="ttdeci">static int collect_digits(struct ast_channel *c, int waittime, char *buf, int buflen, int pos)</div><div class="ttdoc">collect digits from the channel into the buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04283">pbx.c:4283</a></div></div>
<div class="ttc" id="channel_8h_html_ae90da1877e143b996d202d4c88a9c862"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae90da1877e143b996d202d4c88a9c862">ast_softhangup_nolock</a></div><div class="ttdeci">int ast_softhangup_nolock(struct ast_channel *chan, int reason)</div><div class="ttdoc">Softly hangup up a channel (no channel lock) </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02463">channel.c:2463</a></div></div>
<div class="ttc" id="channel_8h_html_aa0a52e573af67cb0f29095177128d186"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa0a52e573af67cb0f29095177128d186">ast_channel_is_bridged</a></div><div class="ttdeci">int ast_channel_is_bridged(const struct ast_channel *chan)</div><div class="ttdoc">Determine if a channel is in a bridge. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10746">channel.c:10746</a></div></div>
<div class="ttc" id="pbx_8c_html_a078330b9a32065ec6a0c0731c06719cd"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a078330b9a32065ec6a0c0731c06719cd">totalcalls</a></div><div class="ttdeci">static int totalcalls</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00774">pbx.c:774</a></div></div>
<div class="ttc" id="channel_8h_html_a82f2c6e4d47f62f6b65c5887eb096fd5a5ff4f7a94a36fcc2b8628186cb643d4b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00998">channel.h:998</a></div></div>
<div class="ttc" id="pbx_8c_html_a582812711d3d9e2cf321bdae3230ec90"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a582812711d3d9e2cf321bdae3230ec90">remove_hintdevice</a></div><div class="ttdeci">static int remove_hintdevice(struct ast_hint *hint)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00517">pbx.c:517</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a67508a613c8f337732e35d9367b43ae7"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7">AST_LIST_ENTRY</a></div><div class="ttdeci">#define AST_LIST_ENTRY(type)</div><div class="ttdoc">Declare a forward link structure inside a list entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00409">linkedlists.h:409</a></div></div>
<div class="ttc" id="func__realtime_8c_html_aef4a708d73ca36016d9360f84685350d"><div class="ttname"><a href="../../db/d09/func__realtime_8c.html#aef4a708d73ca36016d9360f84685350d">buf1</a></div><div class="ttdeci">static struct ast_threadstorage buf1</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d09/func__realtime_8c_source.html#l00178">func_realtime.c:178</a></div></div>
<div class="ttc" id="pbx_8c_html_a08abc5aa22cce4a793000a796b791076"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a08abc5aa22cce4a793000a796b791076">ast_context_destroy_by_name</a></div><div class="ttdeci">int ast_context_destroy_by_name(const char *context, const char *registrar)</div><div class="ttdoc">Destroy a context by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08244">pbx.c:8244</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00041">channelstate.h:41</a></div></div>
<div class="ttc" id="pbx_8c_html_a312597f1da31dcefbf18f31335f7295c"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a312597f1da31dcefbf18f31335f7295c">hashtab_compare_exten_numbers</a></div><div class="ttdeci">static int hashtab_compare_exten_numbers(const void *ah_a, const void *ah_b)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00721">pbx.c:721</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa2ded2af046bb513f77056c27c083307"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307">AST_LIST_INSERT_HEAD</a></div><div class="ttdeci">#define AST_LIST_INSERT_HEAD(head, elm, field)</div><div class="ttdoc">Inserts a list entry at the head of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00710">linkedlists.h:710</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="cli_8h_html_ae47751901c430ebb833e59291a5e0b3f"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a></div><div class="ttdeci">#define CLI_FAILURE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00046">cli.h:46</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a2e006acff60d9b3d65d7d60f975d6747"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a></div><div class="ttdeci">static void parse(struct mgcp_request *req)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l01872">chan_mgcp.c:1872</a></div></div>
<div class="ttc" id="pbx__private_8h_html_ae1761f6ffd7763505cd891d3314cd7e4"><div class="ttname"><a href="../../d9/da0/pbx__private_8h.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a></div><div class="ttdeci">#define VAR_BUF_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da0/pbx__private_8h_source.html#l00068">pbx_private.h:68</a></div></div>
<div class="ttc" id="stasis_8h_html_ac43d0a33d111e9f34b441b285c166cfc"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a></div><div class="ttdeci">void stasis_publish(struct stasis_topic *topic, struct stasis_message *message)</div><div class="ttdoc">Publish a message to a topic&amp;#39;s subscribers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01511">stasis.c:1511</a></div></div>
<div class="ttc" id="channel_8h_html_abcf1aea85b924e9cd605040b86241e2a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a></div><div class="ttdeci">#define AST_MAX_CONTEXT</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00136">channel.h:136</a></div></div>
<div class="ttc" id="pbx_8c_html_a10a361ce7021a2921db6c07fad34b0cf"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a10a361ce7021a2921db6c07fad34b0cf">complete_show_dialplan_context</a></div><div class="ttdeci">static char * complete_show_dialplan_context(const char *line, const char *word, int pos, int state)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05447">pbx.c:5447</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__cli__entry_html_ade9cba72805fe52685a1deea307a8e82"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">ast_cli_entry::command</a></div><div class="ttdeci">char * command</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00186">cli.h:186</a></div></div>
<div class="ttc" id="pbx_8c_html_a3900cc7c8183ab6a7316f5dbc2b955ed"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3900cc7c8183ab6a7316f5dbc2b955ed">destroy_pattern_tree</a></div><div class="ttdeci">static void destroy_pattern_tree(struct match_char *pattern_tree)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01779">pbx.c:1779</a></div></div>
<div class="ttc" id="pbx_8c_html_a7124563d8bad85417d812aab4404ceaf"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a7124563d8bad85417d812aab4404ceaf">autohint_hash_cb</a></div><div class="ttdeci">static int autohint_hash_cb(const void *obj, const int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00453">pbx.c:453</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="dial_8h_html_aff55dbc56bc54126828f78a47d1f2282"><div class="ttname"><a href="../../df/dcf/dial_8h.html#aff55dbc56bc54126828f78a47d1f2282">ast_dial_create</a></div><div class="ttdeci">struct ast_dial * ast_dial_create(void)</div><div class="ttdoc">New dialing structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l00225">dial.c:225</a></div></div>
<div class="ttc" id="pbx_8c_html_af76fe5a18f586ee67571d9a95859cb87"><div class="ttname"><a href="../../db/d94/pbx_8c.html#af76fe5a18f586ee67571d9a95859cb87">ext_cmp_exten_partial</a></div><div class="ttdeci">static int ext_cmp_exten_partial(const char *left, const char *right)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01833">pbx.c:1833</a></div></div>
<div class="ttc" id="devicestate_8h_html_a65ebe8f28497b09769ab9edeb4eb9b86"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a65ebe8f28497b09769ab9edeb4eb9b86">ast_devstate_aggregate_init</a></div><div class="ttdeci">void ast_devstate_aggregate_init(struct ast_devstate_aggregate *agg)</div><div class="ttdoc">Initialize aggregate device state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/devicestate_8c_source.html#l00630">devicestate.c:630</a></div></div>
<div class="ttc" id="channel_8h_html_ab57c278099ea5f8d7cedbb41eba58b56"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a></div><div class="ttdeci">#define AST_CHANNEL_NAME</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00172">channel.h:172</a></div></div>
<div class="ttc" id="pbx_8c_html_acd4647df41127a333e9fe3f6a90e14d5"><div class="ttname"><a href="../../db/d94/pbx_8c.html#acd4647df41127a333e9fe3f6a90e14d5">handle_unset_extenpatternmatchnew</a></div><div class="ttdeci">static char * handle_unset_extenpatternmatchnew(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06133">pbx.c:6133</a></div></div>
<div class="ttc" id="pbx_8c_html_ae295e363d292aafe65f327e628d90dcd"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae295e363d292aafe65f327e628d90dcd">find_context</a></div><div class="ttdeci">static struct ast_context * find_context(const char *context)</div><div class="ttdoc">lookup for a context with a given name, </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04804">pbx.c:4804</a></div></div>
<div class="ttc" id="dial_8h_html_a45841b9bf18bd62ea3a58f5ecf8b5d4f"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a45841b9bf18bd62ea3a58f5ecf8b5d4f">ast_dial_get_channel</a></div><div class="ttdeci">struct ast_channel * ast_dial_get_channel(struct ast_dial *dial, int num)</div><div class="ttdoc">Get the dialing channel, if prerun has been executed. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l01282">dial.c:1282</a></div></div>
<div class="ttc" id="pbx_8c_html_a85edff1fa15717f00123b70af815e10d"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a85edff1fa15717f00123b70af815e10d">find_context_locked</a></div><div class="ttdeci">static struct ast_context * find_context_locked(const char *context)</div><div class="ttdoc">lookup for a context with a given name, </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04818">pbx.c:4818</a></div></div>
<div class="ttc" id="pbx_8c_html_ae27dd9f761219046877675635073cfc3"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae27dd9f761219046877675635073cfc3">ast_context_add_switch2</a></div><div class="ttdeci">int ast_context_add_switch2(struct ast_context *con, const char *value, const char *data, int eval, const char *registrar)</div><div class="ttdoc">Adds a switch (first param is a ast_context) </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06791">pbx.c:6791</a></div></div>
<div class="ttc" id="pbx_8c_html_a833a703b21d8f6bcb9f68e57185bca67"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a833a703b21d8f6bcb9f68e57185bca67">ast_merge_contexts_and_delete</a></div><div class="ttdeci">void ast_merge_contexts_and_delete(struct ast_context **extcontexts, struct ast_hashtab *exttable, const char *registrar)</div><div class="ttdoc">Merge the temporary contexts into a global contexts list and delete from the global list the ones tha...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06468">pbx.c:6468</a></div></div>
<div class="ttc" id="structpbx__find__info_html_a71796127253dfc9a1830ede1904c653b"><div class="ttname"><a href="../../db/d81/structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">pbx_find_info::foundcontext</a></div><div class="ttdeci">const char * foundcontext</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00242">extconf.h:242</a></div></div>
<div class="ttc" id="pbx_8c_html_aa73d176ed4f1ce51e5db6beafba45fe3"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa73d176ed4f1ce51e5db6beafba45fe3">ast_ignore_pattern</a></div><div class="ttdeci">int ast_ignore_pattern(const char *context, const char *pattern)</div><div class="ttdoc">Checks to see if a number should be ignored. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06921">pbx.c:6921</a></div></div>
<div class="ttc" id="channel_8h_html_a29557c4823f5e9c02519a01daf6a289c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a></div><div class="ttdeci">void ast_hangup(struct ast_channel *chan)</div><div class="ttdoc">Hang up a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02548">channel.c:2548</a></div></div>
<div class="ttc" id="pbx_8c_html_a4f0abef370be053d950e665535e94f76"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a4f0abef370be053d950e665535e94f76">publish_hint_change</a></div><div class="ttdeci">static int publish_hint_change(struct ast_hint *hint, struct ast_exten *ne)</div><div class="ttdoc">Publish a hint changed event. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04074">pbx.c:4074</a></div></div>
<div class="ttc" id="structpbx__find__info_html_a31dd453024f17e9e35717368cf8c87fb"><div class="ttname"><a href="../../db/d81/structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">pbx_find_info::stacklen</a></div><div class="ttdeci">int stacklen</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00238">extconf.h:238</a></div></div>
<div class="ttc" id="pbx_8c_html_a6772ce6e8de86d4b6c382dbf68ea4755"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a6772ce6e8de86d4b6c382dbf68ea4755">ast_walk_extension_priorities</a></div><div class="ttdeci">struct ast_exten * ast_walk_extension_priorities(struct ast_exten *exten, struct ast_exten *priority)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08662">pbx.c:8662</a></div></div>
<div class="ttc" id="pbx_8c_html_a1cd189626b1bebd901bb5d80e87d7b9c"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a1cd189626b1bebd901bb5d80e87d7b9c">action_extensionstatelist</a></div><div class="ttdeci">static int action_extensionstatelist(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08383">pbx.c:8383</a></div></div>
<div class="ttc" id="pbx_8c_html_ac359af75b9494f50904583d2168a7577"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ac359af75b9494f50904583d2168a7577">ast_matchmore_extension</a></div><div class="ttdeci">int ast_matchmore_extension(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)</div><div class="ttdoc">Looks to see if adding anything to this extension might match something. (exists ^ canmatch) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04199">pbx.c:4199</a></div></div>
<div class="ttc" id="xmldoc_8h_html"><div class="ttname"><a href="../../d1/d99/xmldoc_8h.html">xmldoc.h</a></div><div class="ttdoc">Asterisk XML Documentation API. </div></div>
<div class="ttc" id="structast__cli__args_html_adc1f34651f7bbfa3ba5af27db5f53817"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">ast_cli_args::word</a></div><div class="ttdeci">const char * word</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00163">cli.h:163</a></div></div>
<div class="ttc" id="pbx_8h_html_ad4f9fd5bd7afc28347c808ea295233e8"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ad4f9fd5bd7afc28347c808ea295233e8">ast_get_switch_data</a></div><div class="ttdeci">const char * ast_get_switch_data(const struct ast_sw *sw)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d5d/pbx__sw_8c_source.html#l00053">pbx_sw.c:53</a></div></div>
<div class="ttc" id="channel_8h_html_af89b0f98c227230d7180a90627c0901c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af89b0f98c227230d7180a90627c0901c">ast_channel_pbx_set</a></div><div class="ttdeci">void ast_channel_pbx_set(struct ast_channel *chan, struct ast_pbx *value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00725">channel_internal_api.c:725</a></div></div>
<div class="ttc" id="pbx_8c_html_a3aa0b9f1691104cb6214ba66c5dc3a30"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3aa0b9f1691104cb6214ba66c5dc3a30">ast_devstate_to_extenstate</a></div><div class="ttdeci">enum ast_extension_states ast_devstate_to_extenstate(enum ast_device_state devstate)</div><div class="ttdoc">Map devstate to an extension state. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03006">pbx.c:3006</a></div></div>
<div class="ttc" id="__private_8h_html"><div class="ttname"><a href="../../d4/d78/__private_8h.html">_private.h</a></div><div class="ttdoc">Prototypes for public functions only of internal interest,. </div></div>
<div class="ttc" id="stasis_8h_html_a221d05010106dcde0cc2e2b43c1a8b67"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a221d05010106dcde0cc2e2b43c1a8b67">stasis_unsubscribe_and_join</a></div><div class="ttdeci">struct stasis_subscription * stasis_unsubscribe_and_join(struct stasis_subscription *subscription)</div><div class="ttdoc">Cancel a subscription, blocking until the last message is processed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01136">stasis.c:1136</a></div></div>
<div class="ttc" id="pbx_8c_html_a6c3a35983760904213206a8f0a7df9c9"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a6c3a35983760904213206a8f0a7df9c9">ast_pbx_outgoing_exten</a></div><div class="ttdeci">int ast_pbx_outgoing_exten(const char *type, struct ast_format_cap *cap, const char *addr, int timeout, const char *context, const char *exten, int priority, int *reason, int synchronous, const char *cid_num, const char *cid_name, struct ast_variable *vars, const char *account, struct ast_channel **locked_channel, int early_media, const struct ast_assigned_ids *assignedids)</div><div class="ttdoc">Synchronously or asynchronously make an outbound call and send it to a particular extension...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07951">pbx.c:7951</a></div></div>
<div class="ttc" id="pbx_8c_html_a8c05495ada1d36b9a42cb8b184b3b352"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a8c05495ada1d36b9a42cb8b184b3b352">hintdevice_data</a></div><div class="ttdeci">static struct ast_threadstorage hintdevice_data</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00352">pbx.c:352</a></div></div>
<div class="ttc" id="structast__channel__iterator_html"><div class="ttname"><a href="../../d9/d97/structast__channel__iterator.html">ast_channel_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01351">channel.c:1351</a></div></div>
<div class="ttc" id="vector_8h_html"><div class="ttname"><a href="../../d6/d68/vector_8h.html">vector.h</a></div><div class="ttdoc">Vector container support. </div></div>
<div class="ttc" id="dial_8h_html_a2054b1ddc7845e78286254b366a37847a077aa090d089e32265755c7ec0f1dac2"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a2054b1ddc7845e78286254b366a37847a077aa090d089e32265755c7ec0f1dac2">AST_DIAL_RESULT_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dcf/dial_8h_source.html#l00056">dial.h:56</a></div></div>
<div class="ttc" id="pbx_8c_html_a25dad382feec89a9bbc6c5284bb30e25"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a25dad382feec89a9bbc6c5284bb30e25">ast_context_remove_extension2</a></div><div class="ttdeci">int ast_context_remove_extension2(struct ast_context *con, const char *extension, int priority, const char *registrar, int already_locked)</div><div class="ttdoc">This functionc locks given context, search for the right extension and fires out all peer in this ext...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04982">pbx.c:4982</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="pbx_8c_html_a938a84cd1446c1da1e45b2269c36c9e3"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a938a84cd1446c1da1e45b2269c36c9e3">ast_context_remove_extension_callerid2</a></div><div class="ttdeci">int ast_context_remove_extension_callerid2(struct ast_context *con, const char *extension, int priority, const char *callerid, int matchcallerid, const char *registrar, int already_locked)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04987">pbx.c:4987</a></div></div>
<div class="ttc" id="hashtab_8h_html_af8904cce564fd39de28b566bb8c261eb"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#af8904cce564fd39de28b566bb8c261eb">ast_hashtab_hash_string</a></div><div class="ttdeci">unsigned int ast_hashtab_hash_string(const void *obj)</div><div class="ttdoc">Hashes a string to a number. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00153">hashtab.c:153</a></div></div>
<div class="ttc" id="taskprocessor_8h_html"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html">taskprocessor.h</a></div><div class="ttdoc">An API for managing task processing threads that can be shared across modules. </div></div>
<div class="ttc" id="structstate_html"><div class="ttname"><a href="../../d4/d88/structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l00158">localtime.c:158</a></div></div>
<div class="ttc" id="pbx_8c_html_a7cf40fb61636ce16613ed58d87513027"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a7cf40fb61636ce16613ed58d87513027">print_hintdevices_key</a></div><div class="ttdeci">static void print_hintdevices_key(void *v_obj, void *where, ao2_prnt_fn *prnt)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08950">pbx.c:8950</a></div></div>
<div class="ttc" id="pbx_8c_html_a99648b71f8a58f9b5949f4587e38a890"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a99648b71f8a58f9b5949f4587e38a890">destroy_state_cb</a></div><div class="ttdeci">static void destroy_state_cb(void *doomed)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03716">pbx.c:3716</a></div></div>
<div class="ttc" id="structmatch__char_html_a67e42f878971513be0d2fa914019a38d"><div class="ttname"><a href="../../da/d14/structmatch__char.html#a67e42f878971513be0d2fa914019a38d">match_char::is_pattern</a></div><div class="ttdeci">int is_pattern</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00263">pbx.c:263</a></div></div>
<div class="ttc" id="pbx__private_8h_html_acd29668e92f96d142fe8d058db4ed773"><div class="ttname"><a href="../../d9/da0/pbx__private_8h.html#acd29668e92f96d142fe8d058db4ed773">sw_free</a></div><div class="ttdeci">void sw_free(struct ast_sw *sw)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d5d/pbx__sw_8c_source.html#l00101">pbx_sw.c:101</a></div></div>
<div class="ttc" id="pbx_8c_html_a62350bf22ada5eec5dcb16986c1909b9"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a62350bf22ada5eec5dcb16986c1909b9">ast_add_extension_nolock</a></div><div class="ttdeci">static int ast_add_extension_nolock(const char *context, int replace, const char *extension, int priority, const char *label, const char *callerid, const char *application, void *data, void(*datad)(void *), const char *registrar)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06950">pbx.c:6950</a></div></div>
<div class="ttc" id="pbx_8c_html_ae51d2f255e1f2ea7fb24e6033a9cba94"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae51d2f255e1f2ea7fb24e6033a9cba94">exception_function</a></div><div class="ttdeci">static struct ast_custom_function exception_function</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02852">pbx.c:2852</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a5a79a9dc65f139cedb64503d171d5df4"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a5a79a9dc65f139cedb64503d171d5df4">AST_LIST_HEAD_NOLOCK_INIT_VALUE</a></div><div class="ttdeci">#define AST_LIST_HEAD_NOLOCK_INIT_VALUE</div><div class="ttdoc">Defines initial values for a declaration of AST_LIST_HEAD_NOLOCK. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00251">linkedlists.h:251</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591">AST_STATE_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00043">channelstate.h:43</a></div></div>
<div class="ttc" id="channel_8h_html_a129d99e9bb9aafd0f073df357975cb66"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a129d99e9bb9aafd0f073df357975cb66">ast_channel_iterator_by_name_new</a></div><div class="ttdeci">struct ast_channel_iterator * ast_channel_iterator_by_name_new(const char *name, size_t name_len)</div><div class="ttdoc">Create a new channel iterator based on name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01388">channel.c:1388</a></div></div>
<div class="ttc" id="utils_8h_html_a7b260320610a09017a9416398acd0a70"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a></div><div class="ttdeci">#define ast_clear_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00077">utils.h:77</a></div></div>
<div class="ttc" id="pbx_8c_html_abf3da774c123a5bca0fca54659227d13"><div class="ttname"><a href="../../db/d94/pbx_8c.html#abf3da774c123a5bca0fca54659227d13">find_hint_by_cb_id</a></div><div class="ttdeci">static int find_hint_by_cb_id(void *obj, void *arg, int flags)</div><div class="ttdoc">Find Hint by callback id. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03844">pbx.c:3844</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_ade5a89f9bee15a492c760ec1765a292d"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a></div><div class="ttdeci">static char cid_name[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00165">chan_mgcp.c:165</a></div></div>
<div class="ttc" id="pbx_8h_html_ab077da615e93c9e88ce539bef23f82e6a72b959e4767d5a4c644c6232122f5ad9"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a72b959e4767d5a4c644c6232122f5ad9">AST_HINT_UPDATE_PRESENCE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00093">pbx.h:93</a></div></div>
<div class="ttc" id="structpbx__outgoing_html_a464147f9772c4cfb5b57507296c19d81"><div class="ttname"><a href="../../d4/dcb/structpbx__outgoing.html#a464147f9772c4cfb5b57507296c19d81">pbx_outgoing::in_separate_thread</a></div><div class="ttdeci">unsigned int in_separate_thread</div><div class="ttdoc">Set if we&amp;#39;ve spawned a thread to do our work. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07609">pbx.c:7609</a></div></div>
<div class="ttc" id="structscoreboard_html_ae6f7c8319cca7a79bdab95ecfa8b57eb"><div class="ttname"><a href="../../db/d2d/structscoreboard.html#ae6f7c8319cca7a79bdab95ecfa8b57eb">scoreboard::node</a></div><div class="ttdeci">struct match_char * node</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00278">pbx.c:278</a></div></div>
<div class="ttc" id="channel_8h_html_ae3d06c28b4dc8cb2830aa16c8913e6d9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae3d06c28b4dc8cb2830aa16c8913e6d9">ast_channel_callid_set</a></div><div class="ttdeci">void ast_channel_callid_set(struct ast_channel *chan, ast_callid value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00797">channel_internal_api.c:797</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00059">devicestate.h:59</a></div></div>
<div class="ttc" id="pbx_8c_html_a0c27e04a09684e80f2a49fc4c4820fd0"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a0c27e04a09684e80f2a49fc4c4820fd0">ast_pbx_outgoing_exten_predial</a></div><div class="ttdeci">int ast_pbx_outgoing_exten_predial(const char *type, struct ast_format_cap *cap, const char *addr, int timeout, const char *context, const char *exten, int priority, int *reason, int synchronous, const char *cid_num, const char *cid_name, struct ast_variable *vars, const char *account, struct ast_channel **locked_channel, int early_media, const struct ast_assigned_ids *assignedids, const char *predial_callee)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07961">pbx.c:7961</a></div></div>
<div class="ttc" id="pbx_8h_html_adc4d340f4e9d60ef5fbfd93a0e6f9c33"><div class="ttname"><a href="../../db/de0/pbx_8h.html#adc4d340f4e9d60ef5fbfd93a0e6f9c33">ast_pbx_hangup_handler_run</a></div><div class="ttdeci">int ast_pbx_hangup_handler_run(struct ast_channel *chan)</div><div class="ttdoc">Run all hangup handlers on the channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d53/pbx__hangup__handler_8c_source.html#l00058">pbx_hangup_handler.c:58</a></div></div>
<div class="ttc" id="structast__cli__entry_html_aef1bd6ad890a110b466cb0e8088507a2"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">ast_cli_entry::usage</a></div><div class="ttdeci">const char * usage</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00177">cli.h:177</a></div></div>
<div class="ttc" id="func__strings_8c_html_a7f763283c27da5574f6f8d1b2a2b9288"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#a7f763283c27da5574f6f8d1b2a2b9288">replace</a></div><div class="ttdeci">static int replace(struct ast_channel *chan, const char *cmd, char *data, struct ast_str **buf, ssize_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l00790">func_strings.c:790</a></div></div>
<div class="ttc" id="pbx_8c_html_ac8447d16749d15c783e1dff4d8f8e495"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ac8447d16749d15c783e1dff4d8f8e495">pbx_checkcondition</a></div><div class="ttdeci">int pbx_checkcondition(const char *condition)</div><div class="ttdoc">Evaluate a condition. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08321">pbx.c:8321</a></div></div>
<div class="ttc" id="channel_8h_html_a018b7a29cef2d62074dc46e9aaad0d1a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a></div><div class="ttdeci">void ast_channel_exten_set(struct ast_channel *chan, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00357">channel_internal_api.c:357</a></div></div>
<div class="ttc" id="pbx_8c_html_ae9e216d31339f7268f94d2db61e0516b"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae9e216d31339f7268f94d2db61e0516b">extension_states</a></div><div class="ttdeci">static const struct cfextension_states extension_states[]</div></div>
<div class="ttc" id="dial_8h_html_a390484ae7a65d0297177fc8223e6b083"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a390484ae7a65d0297177fc8223e6b083">ast_dial_answered_steal</a></div><div class="ttdeci">struct ast_channel * ast_dial_answered_steal(struct ast_dial *dial)</div><div class="ttdoc">Steal the channel that answered. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l00993">dial.c:993</a></div></div>
<div class="ttc" id="pbx_8h_html_a6e5b90edb84d216267148dddcffe9b9a"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a></div><div class="ttdeci">int pbx_builtin_setvar_helper(struct ast_channel *chan, const char *name, const char *value)</div><div class="ttdoc">Add a variable to the channel variable stack, removing the most recently set value for the same name...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l01071">pbx_variables.c:1071</a></div></div>
<div class="ttc" id="structast__exten_html_a8de82ae926b28db46e3c459a7a1efe83"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a8de82ae926b28db46e3c459a7a1efe83">ast_exten::cidmatch</a></div><div class="ttdeci">const char * cidmatch</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00241">pbx.c:241</a></div></div>
<div class="ttc" id="channel_8h_html_a9e9505a91a84992d04ba4e85217fb4e4a085c0c603de12dc2474a17a92e1cb5a4"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a085c0c603de12dc2474a17a92e1cb5a4">AST_SOFTHANGUP_ASYNCGOTO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l01127">channel.h:1127</a></div></div>
<div class="ttc" id="lock_8h_html_a045bd81ceab2de81e42af338ad7cf121"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a045bd81ceab2de81e42af338ad7cf121">ast_rwlock_wrlock</a></div><div class="ttdeci">#define ast_rwlock_wrlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00234">lock.h:234</a></div></div>
<div class="ttc" id="channel_8h_html_a050bec9a4abc1a599b6573a6091b080c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a050bec9a4abc1a599b6573a6091b080c">ast_waitfordigit</a></div><div class="ttdeci">int ast_waitfordigit(struct ast_channel *c, int ms)</div><div class="ttdoc">Waits for a digit. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l03184">channel.c:3184</a></div></div>
<div class="ttc" id="pbx_8c_html_a0649e18fce3ab1253badc74409de23ea"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a0649e18fce3ab1253badc74409de23ea">unreference_cached_app</a></div><div class="ttdeci">void unreference_cached_app(struct ast_app *app)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06179">pbx.c:6179</a></div></div>
<div class="ttc" id="structfake__context_html_a2fa7eba1ccec8820c766879753569da0"><div class="ttname"><a href="../../d6/da7/structfake__context.html#a2fa7eba1ccec8820c766879753569da0">fake_context::pattern_tree</a></div><div class="ttdeci">struct match_char * pattern_tree</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02431">pbx.c:2431</a></div></div>
<div class="ttc" id="pbx_8c_html_a1dce11e3cce31a0a487c0c3f41b8beab"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a1dce11e3cce31a0a487c0c3f41b8beab">ast_walk_context_includes</a></div><div class="ttdeci">const struct ast_include * ast_walk_context_includes(const struct ast_context *con, const struct ast_include *inc)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08668">pbx.c:8668</a></div></div>
<div class="ttc" id="extconf_8h_html_a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5"><div class="ttname"><a href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00221">extconf.h:221</a></div></div>
<div class="ttc" id="hashtab_8h_html_a42e7322ae7381ee379bfe15798ca75e2"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#a42e7322ae7381ee379bfe15798ca75e2">ast_hashtab_hash_int</a></div><div class="ttdeci">unsigned int ast_hashtab_hash_int(const int num)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00205">hashtab.c:205</a></div></div>
<div class="ttc" id="manager_8h_html_a0b1b4140c2836696a6950e92ab48a580"><div class="ttname"><a href="../../db/d45/manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a></div><div class="ttdeci">#define EVENT_FLAG_REPORTING</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00080">manager.h:80</a></div></div>
<div class="ttc" id="cli_8h_html_a50989f00b32eeb2516a3803cb2ffb766"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a></div><div class="ttdeci">#define CLI_SUCCESS</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00044">cli.h:44</a></div></div>
<div class="ttc" id="pbx_8c_html_a60eda23b6ef91e0dcd0a6a31972f169f"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a60eda23b6ef91e0dcd0a6a31972f169f">context_table_create_autohints</a></div><div class="ttdeci">static void context_table_create_autohints(struct ast_hashtab *table)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06332">pbx.c:6332</a></div></div>
<div class="ttc" id="structcfextension__states_html"><div class="ttname"><a href="../../d3/dd9/structcfextension__states.html">cfextension_states</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00606">pbx.c:606</a></div></div>
<div class="ttc" id="astobj2_8h_html_a7b5de2aa80f528d3dc554caadb8dc6aba42e2c6aadc44e4259a058a6675b7e7e4"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a7b5de2aa80f528d3dc554caadb8dc6aba42e2c6aadc44e4259a058a6675b7e7e4">AO2_ITERATOR_DONTLOCK</a></div><div class="ttdoc">Assume that the ao2_container is already locked. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01872">astobj2.h:1872</a></div></div>
<div class="ttc" id="channel_8h_html_adac99999f1e55833e7f903979d67b48b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#adac99999f1e55833e7f903979d67b48b">ast_channel_softhangup_internal_flag</a></div><div class="ttdeci">int ast_channel_softhangup_internal_flag(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00997">channel_internal_api.c:997</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00153">cli.h:153</a></div></div>
<div class="ttc" id="structast__datastore_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">ast_datastore::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00070">datastore.h:70</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a></div><div class="ttdoc">The arg parameter is an object of the same type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01091">astobj2.h:1091</a></div></div>
<div class="ttc" id="vector_8h_html_aef32ac52c3e8a530d16eb92cde22cacd"><div class="ttname"><a href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a></div><div class="ttdeci">#define AST_VECTOR_GET(vec, idx)</div><div class="ttdoc">Get an element from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00682">vector.h:682</a></div></div>
<div class="ttc" id="pbx_8c_html_a251d9b38cd3fe1bd5ec39bf0b1c3b65f"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a251d9b38cd3fe1bd5ec39bf0b1c3b65f">ast_pbx_outgoing_app_predial</a></div><div class="ttdeci">int ast_pbx_outgoing_app_predial(const char *type, struct ast_format_cap *cap, const char *addr, int timeout, const char *app, const char *appdata, int *reason, int synchronous, const char *cid_num, const char *cid_name, struct ast_variable *vars, const char *account, struct ast_channel **locked_channel, const struct ast_assigned_ids *assignedids, const char *predial_callee)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08025">pbx.c:8025</a></div></div>
<div class="ttc" id="group__main__options_html_gaa5dba371db31dc4ebecdff7c929ff263"><div class="ttname"><a href="../../d6/dd6/group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a></div><div class="ttdeci">struct ast_flags ast_options</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00061">options.c:61</a></div></div>
<div class="ttc" id="pbx_8h_html_a1cf62f8cc1e47da88dae67f4ee623684"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a1cf62f8cc1e47da88dae67f4ee623684">ast_get_include_name</a></div><div class="ttdeci">const char * ast_get_include_name(const struct ast_include *include)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0e/pbx__include_8c_source.html#l00050">pbx_include.c:50</a></div></div>
<div class="ttc" id="pbx_8c_html_ad121506517c1a92626d906f787f17358"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ad121506517c1a92626d906f787f17358">ast_hint_extension_nolock</a></div><div class="ttdeci">static struct ast_exten * ast_hint_extension_nolock(struct ast_channel *c, const char *context, const char *exten)</div><div class="ttdoc">Find hint for given extension in context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02991">pbx.c:2991</a></div></div>
<div class="ttc" id="structast__hintdevice_html"><div class="ttname"><a href="../../df/d6f/structast__hintdevice.html">ast_hintdevice</a></div><div class="ttdoc">Structure for dial plan hint devices. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00369">pbx.c:369</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="pbx_8c_html_abae96b9af884498895aab7ec22f04e36"><div class="ttname"><a href="../../db/d94/pbx_8c.html#abae96b9af884498895aab7ec22f04e36">get_pattern_node</a></div><div class="ttdeci">static const char * get_pattern_node(struct pattern_node *node, const char *src, int pattern, const char *extenbuf)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01513">pbx.c:1513</a></div></div>
<div class="ttc" id="structast__device__state__info_html"><div class="ttname"><a href="../../dc/d4d/structast__device__state__info.html">ast_device_state_info</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00096">pbx.h:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_ab55d227245c39181ce1a4e4f013cc898"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ab55d227245c39181ce1a4e4f013cc898">ao2_t_callback_data</a></div><div class="ttdeci">#define ao2_t_callback_data(container, flags, cb_fn, arg, data, tag)</div><div class="ttdoc">ao2_callback_data() is a generic function that applies cb_fn() to all objects in a container...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01741">astobj2.h:1741</a></div></div>
<div class="ttc" id="channel_8h_html_a6801c703e767d6f760c54c8b86a30024"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a></div><div class="ttdeci">#define ast_channel_ref(c)</div><div class="ttdoc">Increase channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02970">channel.h:2970</a></div></div>
<div class="ttc" id="structast__exten_html_a39cd5d0fb8998335df42679419beada9"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a39cd5d0fb8998335df42679419beada9">ast_exten::app</a></div><div class="ttdeci">const char * app</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00246">pbx.c:246</a></div></div>
<div class="ttc" id="channel_8h_html_a60e0bcaed001e8d5ed1ba0eb2644b3cc"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a></div><div class="ttdeci">int ast_waitfor(struct ast_channel *chan, int ms)</div><div class="ttdoc">Wait for input on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l03171">channel.c:3171</a></div></div>
<div class="ttc" id="pbx_8c_html_aecb1e70dc11a9dc333fcd1e74587a524"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aecb1e70dc11a9dc333fcd1e74587a524">ast_walk_context_ignorepats</a></div><div class="ttdeci">const struct ast_ignorepat * ast_walk_context_ignorepats(const struct ast_context *con, const struct ast_ignorepat *ip)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08707">pbx.c:8707</a></div></div>
<div class="ttc" id="structast__pbx_html_a80a133d151de25445e8dfd09953a0872"><div class="ttname"><a href="../../d6/d83/structast__pbx.html#a80a133d151de25445e8dfd09953a0872">ast_pbx::dtimeoutms</a></div><div class="ttdeci">int dtimeoutms</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00212">pbx.h:212</a></div></div>
<div class="ttc" id="structao2__iterator_html"><div class="ttname"><a href="../../d9/d97/structao2__iterator.html">ao2_iterator</a></div><div class="ttdoc">When we need to walk through a container, we use an ao2_iterator to keep track of the current positio...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01841">astobj2.h:1841</a></div></div>
<div class="ttc" id="structast__rwlock__info_html"><div class="ttname"><a href="../../dc/d9e/structast__rwlock__info.html">ast_rwlock_info</a></div><div class="ttdoc">Structure for rwlock and tracking information. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00156">lock.h:156</a></div></div>
<div class="ttc" id="localtime_8h_html_ae0843e4dbbd1fed36d2676dda58e0c44"><div class="ttname"><a href="../../d5/deb/localtime_8h.html#ae0843e4dbbd1fed36d2676dda58e0c44">ast_mktime</a></div><div class="ttdeci">struct timeval ast_mktime(struct ast_tm *const tmp, const char *zone)</div><div class="ttdoc">Timezone-independent version of mktime(3). </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l02357">localtime.c:2357</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="pbx_8c_html_a80774ac6048ab3b7b8a722bb25fd15b3"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a80774ac6048ab3b7b8a722bb25fd15b3">complete_core_show_hint</a></div><div class="ttdeci">static char * complete_core_show_hint(const char *line, const char *word, int pos, int state)</div><div class="ttdoc">autocomplete for CLI command &amp;#39;core show hint&amp;#39; </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05268">pbx.c:5268</a></div></div>
<div class="ttc" id="cli_8h_html"><div class="ttname"><a href="../../dc/db0/cli_8h.html">cli.h</a></div><div class="ttdoc">Standard Command Line Interface. </div></div>
<div class="ttc" id="pbx_8c_html_a90b8895bf6b299c1b844a57c2ea10348"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a90b8895bf6b299c1b844a57c2ea10348">ast_pbx_h_exten_run</a></div><div class="ttdeci">void ast_pbx_h_exten_run(struct ast_channel *chan, const char *context)</div><div class="ttdoc">Run the h exten from the given context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04209">pbx.c:4209</a></div></div>
<div class="ttc" id="channel_8h_html_aca211972dac7b8f3f08a283bfe0aa8bf"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a></div><div class="ttdeci">void ast_channel_context_set(struct ast_channel *chan, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00348">channel_internal_api.c:348</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="strings_8h_html_a2faaa16929951bfd2802b7829a100ba2"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a></div><div class="ttdeci">#define S_OR(a, b)</div><div class="ttdoc">returns the equivalent of logic or for strings: first one if not empty, otherwise second one...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00079">strings.h:79</a></div></div>
<div class="ttc" id="pbx_8c_html_a04876a5c80405b2f4ee492bbc4777bd4"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a04876a5c80405b2f4ee492bbc4777bd4">update_scoreboard</a></div><div class="ttdeci">static void update_scoreboard(struct scoreboard *board, int length, int spec, struct ast_exten *exten, char last, const char *callerid, int deleted, struct match_char *node)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01064">pbx.c:1064</a></div></div>
<div class="ttc" id="structast__app_html"><div class="ttname"><a href="../../d0/da3/structast__app.html">ast_app</a></div><div class="ttdoc">ast_app: A registered application </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d16/pbx__app_8c_source.html#l00045">pbx_app.c:45</a></div></div>
<div class="ttc" id="pbx_8c_html_aa636ab868f1724406019bbbc82676488"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa636ab868f1724406019bbbc82676488">ast_extension_state_add_extended</a></div><div class="ttdeci">int ast_extension_state_add_extended(const char *context, const char *exten, ast_state_cb_type change_cb, void *data)</div><div class="ttdoc">Add watcher for extended extension states. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03837">pbx.c:3837</a></div></div>
<div class="ttc" id="extconf_8h_html_a2b7f0fafc6995b2630658a4fd8df26be"><div class="ttname"><a href="../../dd/ddb/extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a></div><div class="ttdeci">ext_match_t</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00215">extconf.h:215</a></div></div>
<div class="ttc" id="pbx_8c_html_a56461864a4e21b14e753b78f9ac7afb7"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a56461864a4e21b14e753b78f9ac7afb7">ast_hashtab_hash_contexts</a></div><div class="ttdeci">unsigned int ast_hashtab_hash_contexts(const void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00735">pbx.c:735</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="pbx_8c_html_a098053e0fabe1ebd3f0b70fd7c9f8a71"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a098053e0fabe1ebd3f0b70fd7c9f8a71">countcalls</a></div><div class="ttdeci">static int countcalls</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00773">pbx.c:773</a></div></div>
<div class="ttc" id="pbx_8c_html_acae4048b911899feda92c983599d3028"><div class="ttname"><a href="../../db/d94/pbx_8c.html#acae4048b911899feda92c983599d3028">show_dialplan_helper</a></div><div class="ttdeci">static int show_dialplan_helper(int fd, const char *context, const char *exten, struct dialplan_counters *dpc, const struct ast_include *rinclude, int includecount, const char *includes[])</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05516">pbx.c:5516</a></div></div>
<div class="ttc" id="structast__cli__args_html_a4b911d12699acbbb5a8b62355b35bae8"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">ast_cli_args::pos</a></div><div class="ttdeci">const int pos</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00164">cli.h:164</a></div></div>
<div class="ttc" id="causes_8h_html_aff0e956cb3ef657557fa468a17416c0b"><div class="ttname"><a href="../../d4/da3/causes_8h.html#aff0e956cb3ef657557fa468a17416c0b">AST_CAUSE_USER_BUSY</a></div><div class="ttdeci">#define AST_CAUSE_USER_BUSY</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00106">causes.h:106</a></div></div>
<div class="ttc" id="pbx_8c_html_a6594bb017b4d4fe1bc42370cc32ec974"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a></div><div class="ttdeci">const char * ast_get_extension_app(struct ast_exten *e)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08596">pbx.c:8596</a></div></div>
<div class="ttc" id="pbx_8c_html_a8f7166f50cb9642179c9b321b8143f55"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a8f7166f50cb9642179c9b321b8143f55">ast_goto_if_exists</a></div><div class="ttdeci">int ast_goto_if_exists(struct ast_channel *chan, const char *context, const char *exten, int priority)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08793">pbx.c:8793</a></div></div>
<div class="ttc" id="pbx_8c_html_a281fc61f41a1be7fdd6c620372c4510b"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a281fc61f41a1be7fdd6c620372c4510b">ast_async_goto_if_exists</a></div><div class="ttdeci">int ast_async_goto_if_exists(struct ast_channel *chan, const char *context, const char *exten, int priority)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08798">pbx.c:8798</a></div></div>
<div class="ttc" id="pbx_8h_html_ad37eeb72ede49f9a670eb6bf3e1755cb"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ad37eeb72ede49f9a670eb6bf3e1755cb">AST_PBX_GOTO_FAILED</a></div><div class="ttdeci">#define AST_PBX_GOTO_FAILED</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00042">pbx.h:42</a></div></div>
<div class="ttc" id="channel_8h_html_a256993c64e12e420aa141c07363db3ef"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a256993c64e12e420aa141c07363db3ef">ast_channel_iterator_destroy</a></div><div class="ttdeci">struct ast_channel_iterator * ast_channel_iterator_destroy(struct ast_channel_iterator *i)</div><div class="ttdoc">Destroy a channel iterator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01360">channel.c:1360</a></div></div>
<div class="ttc" id="structast__context_html_a6022c8a609170c7365fb96e83cb2df48"><div class="ttname"><a href="../../d6/d7c/structast__context.html#a6022c8a609170c7365fb96e83cb2df48">ast_context::refcount</a></div><div class="ttdeci">int refcount</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00294">pbx.c:294</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a6440d070425a2efe8e0aa71e8d9e47b7"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a></div><div class="ttdeci">#define ast_frfree(fr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00556">include/asterisk/frame.h:556</a></div></div>
<div class="ttc" id="pbx_8c_html_a6f316646510338807bceef2a2c245983"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a6f316646510338807bceef2a2c245983">candidate_exten_advance</a></div><div class="ttdeci">static const char * candidate_exten_advance(const char *str)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01219">pbx.c:1219</a></div></div>
<div class="ttc" id="structdialplan__counters_html_ad20b944aba8713eac8e63cf3eba770b9"><div class="ttname"><a href="../../d2/dcd/structdialplan__counters.html#ad20b944aba8713eac8e63cf3eba770b9">dialplan_counters::total_prio</a></div><div class="ttdeci">int total_prio</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05481">pbx.c:5481</a></div></div>
<div class="ttc" id="pbx_8h_html_af5a13a9ab5aac5bb61e4f98ae7e8d296"><div class="ttname"><a href="../../db/de0/pbx_8h.html#af5a13a9ab5aac5bb61e4f98ae7e8d296">pbx_substitute_variables_helper</a></div><div class="ttdeci">void pbx_substitute_variables_helper(struct ast_channel *c, const char *cp1, char *cp2, int count)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/ael__main_8c_source.html#l00211">ael_main.c:211</a></div></div>
<div class="ttc" id="pbx_8c_html_a8f600ca9999b2d9c3d64cbcdb503895c"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a8f600ca9999b2d9c3d64cbcdb503895c">overrideswitch</a></div><div class="ttdeci">static char * overrideswitch</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00765">pbx.c:765</a></div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
<div class="ttc" id="pbx_8c_html_a646884fcc8a57de917abafc7a200daee"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a646884fcc8a57de917abafc7a200daee">parse_hint_device</a></div><div class="ttdeci">static char * parse_hint_device(struct ast_str *hint_args)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03056">pbx.c:3056</a></div></div>
<div class="ttc" id="presencestate_8h_html_a7552e0df81ae4e89431564844957de41"><div class="ttname"><a href="../../d6/dd7/presencestate_8h.html#a7552e0df81ae4e89431564844957de41">ast_presence_state_message_type</a></div><div class="ttdeci">struct stasis_message_type * ast_presence_state_message_type(void)</div><div class="ttdoc">Get presence state message type. </div></div>
<div class="ttc" id="pbx_8c_html_a08e43dc093c586991af4e2f86fa14f2e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a08e43dc093c586991af4e2f86fa14f2e">ast_context_remove_ignorepat</a></div><div class="ttdeci">int ast_context_remove_ignorepat(const char *context, const char *ignorepat, const char *registrar)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06837">pbx.c:6837</a></div></div>
<div class="ttc" id="pbx_8h_html_aee0767aa019c9b071f4ed73ffcf499e5"><div class="ttname"><a href="../../db/de0/pbx_8h.html#aee0767aa019c9b071f4ed73ffcf499e5">ast_thread_inhibit_escalations</a></div><div class="ttdeci">int ast_thread_inhibit_escalations(void)</div><div class="ttdoc">Inhibit (in the current thread) the execution of dialplan functions which cause privilege escalations...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d70/pbx__functions_8c_source.html#l00479">pbx_functions.c:479</a></div></div>
<div class="ttc" id="pbx_8c_html_a46084c800c9b3dbe1f2b57e2d2b62304"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a46084c800c9b3dbe1f2b57e2d2b62304">hashtab_hash_extens</a></div><div class="ttdeci">static unsigned int hashtab_hash_extens(const void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00741">pbx.c:741</a></div></div>
<div class="ttc" id="pbx_8c_html_a320968fd3a6b905a3cff12198bfa24f1"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a320968fd3a6b905a3cff12198bfa24f1">add_priority</a></div><div class="ttdeci">static int add_priority(struct ast_context *con, struct ast_exten *tmp, struct ast_exten *el, struct ast_exten *e, int replace)</div><div class="ttdoc">add the extension in the priority chain. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07109">pbx.c:7109</a></div></div>
<div class="ttc" id="stasis_8h_html_a4f248ee5f4791f05d0af8768aaab282b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a></div><div class="ttdeci">int stasis_subscription_accept_message_type(struct stasis_subscription *subscription, const struct stasis_message_type *type)</div><div class="ttdoc">Indicate to a subscription that we are interested in a message type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01025">stasis.c:1025</a></div></div>
<div class="ttc" id="pbx_8c_html_a01df16b518b69d56f374081effd01432"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a01df16b518b69d56f374081effd01432">statecbs</a></div><div class="ttdeci">static struct ao2_container * statecbs</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00803">pbx.c:803</a></div></div>
<div class="ttc" id="res__corosync_8c_html_a8e51289dd0fc7415cee40e7a57b49fdf"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a></div><div class="ttdeci">struct stasis_forward * sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00240">res_corosync.c:240</a></div></div>
<div class="ttc" id="structast__frame_html"><div class="ttname"><a href="../../d0/d99/structast__frame.html">ast_frame</a></div><div class="ttdoc">Data structure associated with a single frame of data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00165">include/asterisk/frame.h:165</a></div></div>
<div class="ttc" id="structast__exten_html_a0574199c7fbb661fd7684472741955bb"><div class="ttname"><a href="../../d7/d00/structast__exten.html#a0574199c7fbb661fd7684472741955bb">ast_exten::cidmatch_display</a></div><div class="ttdeci">const char * cidmatch_display</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00242">pbx.c:242</a></div></div>
<div class="ttc" id="pbx_8c_html_a605e318c7918e9a219bde85ed660c8c2"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a605e318c7918e9a219bde85ed660c8c2">hintdevice_hash_cb</a></div><div class="ttdeci">static int hintdevice_hash_cb(const void *obj, const int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00395">pbx.c:395</a></div></div>
<div class="ttc" id="pbx_8h_html_aad8771c7e3b2170a749946f1a8b758aa"><div class="ttname"><a href="../../db/de0/pbx_8h.html#aad8771c7e3b2170a749946f1a8b758aa">__ast_custom_function_register</a></div><div class="ttdeci">int __ast_custom_function_register(struct ast_custom_function *acf, struct ast_module *mod)</div><div class="ttdoc">Register a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d70/pbx__functions_8c_source.html#l00373">pbx_functions.c:373</a></div></div>
<div class="ttc" id="causes_8h_html"><div class="ttname"><a href="../../d4/da3/causes_8h.html">causes.h</a></div><div class="ttdoc">Internal Asterisk hangup causes. </div></div>
<div class="ttc" id="structast__presence__state__message_html_a7d81246f8d6e05037a34bceb9b722e43"><div class="ttname"><a href="../../d2/db9/structast__presence__state__message.html#a7d81246f8d6e05037a34bceb9b722e43">ast_presence_state_message::state</a></div><div class="ttdeci">enum ast_presence_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd7/presencestate_8h_source.html#l00190">presencestate.h:190</a></div></div>
<div class="ttc" id="pbx_8c_html_a8fcc10d31d51afba693ef9a4cb162c6a"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a8fcc10d31d51afba693ef9a4cb162c6a">ast_remove_hint</a></div><div class="ttdeci">static int ast_remove_hint(struct ast_exten *e)</div><div class="ttdoc">Remove hint from extension. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03945">pbx.c:3945</a></div></div>
<div class="ttc" id="pbx_8c_html_a63e03245dc48558e55da8890b3dbb87e"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a63e03245dc48558e55da8890b3dbb87e">pbx_find_extension</a></div><div class="ttdeci">struct ast_exten * pbx_find_extension(struct ast_channel *chan, struct ast_context *bypass, struct pbx_find_info *q, const char *context, const char *exten, int priority, const char *label, const char *callerid, enum ext_match_t action)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02485">pbx.c:2485</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00280">include/asterisk/frame.h:280</a></div></div>
<div class="ttc" id="structpbx__find__info_html_a3215a7f1fa2be1b8f6872b5b388b55a8"><div class="ttname"><a href="../../db/d81/structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">pbx_find_info::swo</a></div><div class="ttdeci">struct ast_switch * swo</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00240">extconf.h:240</a></div></div>
<div class="ttc" id="pbx_8c_html_a3bad7413f0be95e52f6a473ddb130fe1"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3bad7413f0be95e52f6a473ddb130fe1">ast_context_lockmacro</a></div><div class="ttdeci">int ast_context_lockmacro(const char *context)</div><div class="ttdoc">locks the macrolock in the given context </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05162">pbx.c:5162</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40e0da58ab6964e3264b90f79ad6d476"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40e0da58ab6964e3264b90f79ad6d476">getloadavg</a></div><div class="ttdeci">int getloadavg(double *list, int nelem)</div></div>
<div class="ttc" id="stasis_8h_html_a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00300">stasis.h:300</a></div></div>
<div class="ttc" id="structast__devstate__aggregate_html"><div class="ttname"><a href="../../d6/d7f/structast__devstate__aggregate.html">ast_devstate_aggregate</a></div><div class="ttdoc">You shouldn&amp;#39;t care about the contents of this struct. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00230">devicestate.h:230</a></div></div>
<div class="ttc" id="structast__context_html_ab89d9c8c0b08ae6e239f17da8f25a7b3"><div class="ttname"><a href="../../d6/d7c/structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">ast_context::root_table</a></div><div class="ttdeci">struct ast_hashtab * root_table</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00287">pbx.c:287</a></div></div>
<div class="ttc" id="structdialplan__counters_html"><div class="ttname"><a href="../../d2/dcd/structdialplan__counters.html">dialplan_counters</a></div><div class="ttdoc">Counters for the show dialplan manager command. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05477">pbx.c:5477</a></div></div>
<div class="ttc" id="structscoreboard_html_a0cfb5b2675ee3fe3abfe9b5a7aee6329"><div class="ttname"><a href="../../db/d2d/structscoreboard.html#a0cfb5b2675ee3fe3abfe9b5a7aee6329">scoreboard::canmatch</a></div><div class="ttdeci">int canmatch</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00277">pbx.c:277</a></div></div>
<div class="ttc" id="structast__cli__args_html"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html">ast_cli_args</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00158">cli.h:158</a></div></div>
<div class="ttc" id="channel_8h_html_a9e9505a91a84992d04ba4e85217fb4e4aeeafae6abd77156800ec76b0ff7d3867"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4aeeafae6abd77156800ec76b0ff7d3867">AST_SOFTHANGUP_APPUNLOAD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l01144">channel.h:1144</a></div></div>
<div class="ttc" id="pbx_8h_html_ab077da615e93c9e88ce539bef23f82e6a2e89bd60b1752d920f58a70164607189"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ab077da615e93c9e88ce539bef23f82e6a2e89bd60b1752d920f58a70164607189">AST_HINT_UPDATE_DEVICE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00091">pbx.h:91</a></div></div>
<div class="ttc" id="pbx_8c_html_aae85d5aab50f2d1b8392d6df276f2561"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aae85d5aab50f2d1b8392d6df276f2561">contexts</a></div><div class="ttdeci">static struct ast_context * contexts</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00776">pbx.c:776</a></div></div>
<div class="ttc" id="pbx_8h_html_a7e545df4a5f38ef25616c7bdf55d625fad62d357f0ccde2a718c374a0a4af2b98"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fad62d357f0ccde2a718c374a0a4af2b98">AST_EXTENSION_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00066">pbx.h:66</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a025ede890af287961d3a98d0e634a62b"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a025ede890af287961d3a98d0e634a62b">b</a></div><div class="ttdeci">static struct test_val b</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00047">test_linkedlists.c:47</a></div></div>
<div class="ttc" id="structast__device__state__message_html"><div class="ttname"><a href="../../db/d92/structast__device__state__message.html">ast_device_state_message</a></div><div class="ttdoc">The structure that contains device state. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00240">devicestate.h:240</a></div></div>
<div class="ttc" id="structentry_html"><div class="ttname"><a href="../../d3/d96/structentry.html">entry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d85/search_8h_source.html#l00040">search.h:40</a></div></div>
<div class="ttc" id="channel_8h_html_a582dee4d5ea9b2ff6f309f0c5239f6bd"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a></div><div class="ttdeci">const char * ast_channel_context(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00344">channel_internal_api.c:344</a></div></div>
<div class="ttc" id="term_8h_html"><div class="ttname"><a href="../../db/d45/term_8h.html">term.h</a></div><div class="ttdoc">Handy terminal functions for vt* terms. </div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
<div class="ttc" id="pbx_8c_html_afb93dec0c216cb07939fd15949baff2f"><div class="ttname"><a href="../../db/d94/pbx_8c.html#afb93dec0c216cb07939fd15949baff2f">ast_context_includes_get</a></div><div class="ttdeci">const struct ast_include * ast_context_includes_get(const struct ast_context *con, int idx)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08702">pbx.c:8702</a></div></div>
<div class="ttc" id="time_8h_html_a14d1e085a2d8580052c28807e762bfad"><div class="ttname"><a href="../../de/df7/time_8h.html#a14d1e085a2d8580052c28807e762bfad">ast_tvdiff_us</a></div><div class="ttdeci">int64_t ast_tvdiff_us(struct timeval end, struct timeval start)</div><div class="ttdoc">Computes the difference (in microseconds) between two struct timeval instances. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00078">time.h:78</a></div></div>
<div class="ttc" id="pbx_8c_html_aa42372790072cff15f75c674917115b0"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a></div><div class="ttdeci">const char * ast_get_context_name(struct ast_context *con)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08538">pbx.c:8538</a></div></div>
<div class="ttc" id="datastore_8h_html_a666afb07fd77d50782cc10f83e029159"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a></div><div class="ttdeci">#define ast_datastore_alloc(info, uid)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00089">datastore.h:89</a></div></div>
<div class="ttc" id="hashtab_8h_html_ae4ca301bcfd289b81751c34e0c712847"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#ae4ca301bcfd289b81751c34e0c712847">ast_hashtab_create</a></div><div class="ttdeci">#define ast_hashtab_create(initial_buckets, compare, resize, newsize, hash, do_locking)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da0/hashtab_8h_source.html#l00261">hashtab.h:261</a></div></div>
<div class="ttc" id="structast__exten_html_aa0b51b36bbd4dfa2db0d18352aa7dc3f"><div class="ttname"><a href="../../d7/d00/structast__exten.html#aa0b51b36bbd4dfa2db0d18352aa7dc3f">ast_exten::parent</a></div><div class="ttdeci">struct ast_context * parent</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00245">pbx.c:245</a></div></div>
<div class="ttc" id="app__queue_8c_html_acd1f0e9b4730ec60f62cb0806cb06ef1"><div class="ttname"><a href="../../da/dfb/app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a></div><div class="ttdeci">enum queue_result id</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dfb/app__queue_8c_source.html#l01507">app_queue.c:1507</a></div></div>
<div class="ttc" id="pbx_8c_html_a3903111827b675ec313e56a28ac80cf9"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3903111827b675ec313e56a28ac80cf9">ast_context_add_include</a></div><div class="ttdeci">int ast_context_add_include(const char *context, const char *include, const char *registrar)</div><div class="ttdoc">Add a context include. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06706">pbx.c:6706</a></div></div>
<div class="ttc" id="structast__hint_html_af952513176652fdf6919b7eafad109b7"><div class="ttname"><a href="../../d8/dac/structast__hint.html#af952513176652fdf6919b7eafad109b7">ast_hint::last_presence_message</a></div><div class="ttdeci">char * last_presence_message</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00340">pbx.c:340</a></div></div>
<div class="ttc" id="pbx_8c_html_a8a07400b41b3302edf8aef9f53644698"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a8a07400b41b3302edf8aef9f53644698">ast_context_find_or_create</a></div><div class="ttdeci">struct ast_context * ast_context_find_or_create(struct ast_context **extcontexts, struct ast_hashtab *exttable, const char *name, const char *registrar)</div><div class="ttdoc">Register a new context or find an existing one. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l06198">pbx.c:6198</a></div></div>
<div class="ttc" id="pbx_8c_html_a52a37e9e2d9a1482ef5b7d91001b61ac"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a52a37e9e2d9a1482ef5b7d91001b61ac">ast_active_calls</a></div><div class="ttdeci">int ast_active_calls(void)</div><div class="ttdoc">Retrieve the number of active calls. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04764">pbx.c:4764</a></div></div>
<div class="ttc" id="lock_8h_html_a76e8ed6bb354be6c6dd9e51acc1d7a1b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a></div><div class="ttdeci">#define ast_mutex_init(pmutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00184">lock.h:184</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="pbx_8c_html_a5938783ad407af844871a22c0b282661"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a5938783ad407af844871a22c0b282661">ext_cmp_exten</a></div><div class="ttdeci">static int ext_cmp_exten(const char *left, const char *right)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01876">pbx.c:1876</a></div></div>
<div class="ttc" id="structscoreboard_html_a411afdaaca990dd80881e20637dc44af"><div class="ttname"><a href="../../db/d2d/structscoreboard.html#a411afdaaca990dd80881e20637dc44af">scoreboard::total_length</a></div><div class="ttdeci">int total_length</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00275">pbx.c:275</a></div></div>
<div class="ttc" id="structast__exten_html_ac5c5967f62e5c3601479be651a8ed76c"><div class="ttname"><a href="../../d7/d00/structast__exten.html#ac5c5967f62e5c3601479be651a8ed76c">ast_exten::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00248">pbx.c:248</a></div></div>
<div class="ttc" id="strings_8h_html_afe8f5f844f2fd5f5bd5d0be5ef671481"><div class="ttname"><a href="../../d6/d90/strings_8h.html#afe8f5f844f2fd5f5bd5d0be5ef671481">ast_str_thread_get</a></div><div class="ttdeci">struct ast_str * ast_str_thread_get(struct ast_threadstorage *ts, size_t init_len)</div><div class="ttdoc">Retrieve a thread locally stored dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00861">strings.h:861</a></div></div>
<div class="ttc" id="structast__party__name_html_aaa04218f9e3a9065afa8be2491da8904"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">ast_party_name::valid</a></div><div class="ttdeci">unsigned char valid</div><div class="ttdoc">TRUE if the name information is valid/present. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00280">channel.h:280</a></div></div>
<div class="ttc" id="pbx_8c_html_a0dd6eaef780ca4a7de91db52a2b8b085"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a0dd6eaef780ca4a7de91db52a2b8b085">ast_extension_state_add_destroy_extended</a></div><div class="ttdeci">int ast_extension_state_add_destroy_extended(const char *context, const char *exten, ast_state_cb_type change_cb, ast_state_cb_destroy_type destroy_cb, void *data)</div><div class="ttdoc">Add watcher for extended extension states with destructor. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03831">pbx.c:3831</a></div></div>
<div class="ttc" id="pbx_8c_html_a54aae627e24c46cfd1ce479ddfa0f3d2"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a54aae627e24c46cfd1ce479ddfa0f3d2">ast_get_extension_label</a></div><div class="ttdeci">const char * ast_get_extension_label(struct ast_exten *exten)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08553">pbx.c:8553</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a></div><div class="ttdoc">Search option field mask. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01076">astobj2.h:1076</a></div></div>
<div class="ttc" id="structmatch__char_html_ae2f869d85ce6930805f0aa8ff9a928c9"><div class="ttname"><a href="../../da/d14/structmatch__char.html#ae2f869d85ce6930805f0aa8ff9a928c9">match_char::next_char</a></div><div class="ttdeci">struct match_char * next_char</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00267">pbx.c:267</a></div></div>
<div class="ttc" id="pbx_8h_html_a2c6cd56c75fb925c726e1f400024f856"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a2c6cd56c75fb925c726e1f400024f856">ast_state_cb_type</a></div><div class="ttdeci">int(* ast_state_cb_type)(const char *context, const char *exten, struct ast_state_cb_info *info, void *data)</div><div class="ttdoc">Typedef for devicestate and hint callbacks. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00112">pbx.h:112</a></div></div>
<div class="ttc" id="structpbx__find__info_html_a6e27f49150e9a14580fb313cc2777e00"><div class="ttname"><a href="../../db/d81/structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">pbx_find_info::status</a></div><div class="ttdeci">int status</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddb/extconf_8h_source.html#l00239">extconf.h:239</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_ac25ea00ee3f082df06e0cf468cbde240"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a></div><div class="ttdeci">static char context[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00116">chan_alsa.c:116</a></div></div>
<div class="ttc" id="pbx_8c_html_a5a034ba4312a7a7fcf3f3600548427d6"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a5a034ba4312a7a7fcf3f3600548427d6">execute_state_callback</a></div><div class="ttdeci">static int execute_state_callback(ast_state_cb_type cb, const char *context, const char *exten, void *data, enum ast_state_cb_update_reason reason, struct ast_hint *hint, struct ao2_container *device_state_info)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03250">pbx.c:3250</a></div></div>
<div class="ttc" id="channel_8h_html_a91de92158876186d28ba1773877f2732"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a91de92158876186d28ba1773877f2732">ast_channel_flags</a></div><div class="ttdeci">struct ast_flags * ast_channel_flags(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l01260">channel_internal_api.c:1260</a></div></div>
<div class="ttc" id="pbx_8c_html_a721c6ba091102f155a586e09b2a526bf"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a721c6ba091102f155a586e09b2a526bf">ast_context_remove_extension</a></div><div class="ttdeci">int ast_context_remove_extension(const char *context, const char *extension, int priority, const char *registrar)</div><div class="ttdoc">Simply remove extension from context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04952">pbx.c:4952</a></div></div>
<div class="ttc" id="lock_8h_html_ab8977a71822daa556f19f30ba6eec765"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a></div><div class="ttdeci">#define ast_mutex_destroy(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00186">lock.h:186</a></div></div>
<div class="ttc" id="group__main__options_html_gaf2588453b3a373a770741ad3ce353343ade4cf3231c69af57ad0527bd46244680"><div class="ttname"><a href="../../d6/dd6/group__main__options.html#gaf2588453b3a373a770741ad3ce353343ade4cf3231c69af57ad0527bd46244680">AST_OPT_FLAG_FULLY_BOOTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5b/options_8h_source.html#l00058">options.h:58</a></div></div>
<div class="ttc" id="pbx_8c_html_ae381d99bea85b43f022470b64171018d"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae381d99bea85b43f022470b64171018d">pbx_extension_helper</a></div><div class="ttdeci">static int pbx_extension_helper(struct ast_channel *c, struct ast_context *con, const char *context, const char *exten, int priority, const char *label, const char *callerid, enum ext_match_t action, int *found, int combined_find_spawn)</div><div class="ttdoc">The return value depends on the action: </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l02875">pbx.c:2875</a></div></div>
<div class="ttc" id="func__periodic__hook_8c_html_a364919046cab7e688f81979a59e46226"><div class="ttname"><a href="../../dc/dcf/func__periodic__hook_8c.html#a364919046cab7e688f81979a59e46226">exten_name</a></div><div class="ttdeci">static const char exten_name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dcf/func__periodic__hook_8c_source.html#l00093">func_periodic_hook.c:93</a></div></div>
<div class="ttc" id="pbx_8c_html_a430e8ca21568b70b07b17e15c6b373ac"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a430e8ca21568b70b07b17e15c6b373ac">STASIS_MESSAGE_TYPE_DEFN_LOCAL</a></div><div class="ttdeci">STASIS_MESSAGE_TYPE_DEFN_LOCAL(hint_change_message_type)</div></div>
<div class="ttc" id="structscoreboard_html_afc8cfd0aed370c037cd78797da3313e7"><div class="ttname"><a href="../../db/d2d/structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">scoreboard::exten</a></div><div class="ttdeci">struct ast_exten * exten</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00280">pbx.c:280</a></div></div>
<div class="ttc" id="pbx_8c_html_aea38e9b2b0f0aa337444fcc030e12730"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aea38e9b2b0f0aa337444fcc030e12730">ast_str_get_hint</a></div><div class="ttdeci">int ast_str_get_hint(struct ast_str **hint, ssize_t hintsize, struct ast_str **name, ssize_t namesize, struct ast_channel *c, const char *context, const char *exten)</div><div class="ttdoc">Get hint for channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04159">pbx.c:4159</a></div></div>
<div class="ttc" id="pbx_8c_html_a8c3585401eaf9f0d74029c238a888035"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a8c3585401eaf9f0d74029c238a888035">print_hints_key</a></div><div class="ttdeci">static void print_hints_key(void *v_obj, void *where, ao2_prnt_fn *prnt)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08939">pbx.c:8939</a></div></div>
<div class="ttc" id="dial_8h_html_a9467ca6247764d86e2365ab9bbc68c35"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a9467ca6247764d86e2365ab9bbc68c35">ast_dial_reason</a></div><div class="ttdeci">int ast_dial_reason(struct ast_dial *dial, int num)</div><div class="ttdoc">Get the reason an outgoing channel has failed. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l01271">dial.c:1271</a></div></div>
<div class="ttc" id="pbx_8h_html_ad4a6912dcd2ad44a186d0a284afafc51"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ad4a6912dcd2ad44a186d0a284afafc51">pbx_findapp</a></div><div class="ttdeci">struct ast_app * pbx_findapp(const char *app)</div><div class="ttdoc">Look up an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/ael__main_8c_source.html#l00165">ael_main.c:165</a></div></div>
<div class="ttc" id="presencestate_8h_html_a24297292fcef05a5a271e99e1a71f45a"><div class="ttname"><a href="../../d6/dd7/presencestate_8h.html#a24297292fcef05a5a271e99e1a71f45a">ast_presence_state_topic_all</a></div><div class="ttdeci">struct stasis_topic * ast_presence_state_topic_all(void)</div><div class="ttdoc">Get presence state topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d07/presencestate_8c_source.html#l00365">presencestate.c:365</a></div></div>
<div class="ttc" id="say_8h_html"><div class="ttname"><a href="../../db/dce/say_8h.html">say.h</a></div><div class="ttdoc">Say numbers and dates (maybe words one day too) </div></div>
<div class="ttc" id="logger_8h_html_a33f6031de4ab6d1406465a7a3ee18e86"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a33f6031de4ab6d1406465a7a3ee18e86">DEBUG_ATLEAST</a></div><div class="ttdeci">#define DEBUG_ATLEAST(level)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00441">logger.h:441</a></div></div>
<div class="ttc" id="causes_8h_html_a9900b24b261c275bb54631f16d4d38cc"><div class="ttname"><a href="../../d4/da3/causes_8h.html#a9900b24b261c275bb54631f16d4d38cc">AST_CAUSE_CALL_REJECTED</a></div><div class="ttdeci">#define AST_CAUSE_CALL_REJECTED</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00110">causes.h:110</a></div></div>
<div class="ttc" id="structast__hint_html_abb78dc46b9abb01d17e33d9c04684d9e"><div class="ttname"><a href="../../d8/dac/structast__hint.html#abb78dc46b9abb01d17e33d9c04684d9e">ast_hint::last_presence_subtype</a></div><div class="ttdeci">char * last_presence_subtype</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00339">pbx.c:339</a></div></div>
<div class="ttc" id="channel_8h_html_ae56cab679c0cda6436b930bc74297895"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a></div><div class="ttdeci">void ast_channel_priority_set(struct ast_channel *chan, int value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00448">channel_internal_api.c:448</a></div></div>
<div class="ttc" id="channel_8h_html_ac7e42045272530c8678418993e75fd56"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ac7e42045272530c8678418993e75fd56">ast_channel_get_by_name</a></div><div class="ttdeci">struct ast_channel * ast_channel_get_by_name(const char *name)</div><div class="ttdoc">Find a channel by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01454">channel.c:1454</a></div></div>
<div class="ttc" id="pbx_8c_html_a27922d2f06d4030fc13ed69587c4c189"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a27922d2f06d4030fc13ed69587c4c189">ast_context_unlockmacro</a></div><div class="ttdeci">int ast_context_unlockmacro(const char *context)</div><div class="ttdoc">Unlocks the macrolock in the given context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05184">pbx.c:5184</a></div></div>
<div class="ttc" id="channel_8h_html_a2f18aafad0442206e71033ac6676dbb5"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a2f18aafad0442206e71033ac6676dbb5">ast_channel_alloc</a></div><div class="ttdeci">#define ast_channel_alloc(needqueue, state, cid_num, cid_name, acctcode, exten, context, assignedids, requestor, amaflag,...)</div><div class="ttdoc">Create a channel structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l01259">channel.h:1259</a></div></div>
<div class="ttc" id="channel_8h_html_a82f2c6e4d47f62f6b65c5887eb096fd5ae9c1c04502304018b62d1e5383ccacb3"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a82f2c6e4d47f62f6b65c5887eb096fd5ae9c1c04502304018b62d1e5383ccacb3">AST_FLAG_ORIGINATED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l01040">channel.h:1040</a></div></div>
<div class="ttc" id="structast__context_html_a14868fadcf440d6507b4818f9c9f88e6"><div class="ttname"><a href="../../d6/d7c/structast__context.html#a14868fadcf440d6507b4818f9c9f88e6">ast_context::alts</a></div><div class="ttdeci">struct ast_sws alts</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00292">pbx.c:292</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga31a02a7d3cc36aa66ebebdedfc574d1c"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a></div><div class="ttdeci">void astman_send_error(struct mansession *s, const struct message *m, char *error)</div><div class="ttdoc">Send error in manager transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03159">manager.c:3159</a></div></div>
<div class="ttc" id="module_8h_html"><div class="ttname"><a href="../../d5/d16/module_8h.html">module.h</a></div><div class="ttdoc">Asterisk module definitions. </div></div>
<div class="ttc" id="structpbx__exception_html_a7faec841658b88ad0cfbc684853acad3"><div class="ttname"><a href="../../d1/db2/structpbx__exception.html#a7faec841658b88ad0cfbc684853acad3">pbx_exception::context</a></div><div class="ttdeci">const ast_string_field context</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00625">pbx.c:625</a></div></div>
<div class="ttc" id="structast__pbx__args_html_a0449b0be05342e431e60937c47fc52f7"><div class="ttname"><a href="../../da/db8/structast__pbx__args.html#a0449b0be05342e431e60937c47fc52f7">ast_pbx_args::no_hangup_chan</a></div><div class="ttdeci">unsigned int no_hangup_chan</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00398">pbx.h:398</a></div></div>
<div class="ttc" id="hashtab_8h_html_ac3452d3a8bca5b4f2611bb96b7a44f31"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#ac3452d3a8bca5b4f2611bb96b7a44f31">ast_hashtab_size</a></div><div class="ttdeci">int ast_hashtab_size(struct ast_hashtab *tab)</div><div class="ttdoc">Returns the number of elements stored in the hashtab. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00577">hashtab.c:577</a></div></div>
<div class="ttc" id="hashtab_8h_html_ae52333d2a29053dce852f8a2d35ca421"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#ae52333d2a29053dce852f8a2d35ca421">ast_hashtab_get_stats</a></div><div class="ttdeci">void ast_hashtab_get_stats(struct ast_hashtab *tab, int *biggest_bucket_size, int *resize_count, int *num_objects, int *num_buckets)</div><div class="ttdoc">Returns key stats for the table. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00563">hashtab.c:563</a></div></div>
<div class="ttc" id="structast__hint_html_a300ad50df286a2875c6665b8b421836f"><div class="ttname"><a href="../../d8/dac/structast__hint.html#a300ad50df286a2875c6665b8b421836f">ast_hint::exten_name</a></div><div class="ttdeci">char exten_name[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00343">pbx.c:343</a></div></div>
<div class="ttc" id="channel_8h_html_a1ed3e98d33d5587948a0e2ef67a81f52"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1ed3e98d33d5587948a0e2ef67a81f52">ast_channel_datastore_add</a></div><div class="ttdeci">int ast_channel_datastore_add(struct ast_channel *chan, struct ast_datastore *datastore)</div><div class="ttdoc">Add a datastore to a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02390">channel.c:2390</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00057">devicestate.h:57</a></div></div>
<div class="ttc" id="structpattern__node_html_ad360859604fcbd544fd4178924762c4c"><div class="ttname"><a href="../../da/ddf/structpattern__node.html#ad360859604fcbd544fd4178924762c4c">pattern_node::specif</a></div><div class="ttdeci">int specif</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01454">pbx.c:1454</a></div></div>
<div class="ttc" id="stringfields_8h_html_abf60f862ae6a141d2f86a0f5e82792de"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de">ast_string_field_free_memory</a></div><div class="ttdeci">#define ast_string_field_free_memory(x)</div><div class="ttdoc">free all memory - to be called before destroying the object </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00368">stringfields.h:368</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html">app.h</a></div><div class="ttdoc">Application convenience functions, designed to give consistent look and feel to Asterisk apps...</div></div>
<div class="ttc" id="structdialplan__counters_html_a3e221cee3977709c69000542b0e8253b"><div class="ttname"><a href="../../d2/dcd/structdialplan__counters.html#a3e221cee3977709c69000542b0e8253b">dialplan_counters::total_context</a></div><div class="ttdeci">int total_context</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05479">pbx.c:5479</a></div></div>
<div class="ttc" id="structast__context_html"><div class="ttname"><a href="../../d6/d7c/structast__context.html">ast_context</a></div><div class="ttdoc">ast_context: An extension context - must remain in sync with fake_context </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00284">pbx.c:284</a></div></div>
<div class="ttc" id="structast__party__number_html_aaa04218f9e3a9065afa8be2491da8904"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">ast_party_number::valid</a></div><div class="ttdeci">unsigned char valid</div><div class="ttdoc">TRUE if the number information is valid/present. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00298">channel.h:298</a></div></div>
<div class="ttc" id="pbx_8c_html_ae11307420f479da288a4da22d7af43d6"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae11307420f479da288a4da22d7af43d6">hint_id_cmp</a></div><div class="ttdeci">static int hint_id_cmp(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03891">pbx.c:3891</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01053">astobj2.h:1053</a></div></div>
<div class="ttc" id="channel_8h_html_a6c2c406bdebd477029e61774cc300abd"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6c2c406bdebd477029e61774cc300abd">ast_channel_callid</a></div><div class="ttdeci">ast_callid ast_channel_callid(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00793">channel_internal_api.c:793</a></div></div>
<div class="ttc" id="astobj2_8h_html_a91d5d37d00874ae7a92d1a15c0a3b3a6"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a></div><div class="ttdeci">struct ao2_iterator ao2_iterator_init(struct ao2_container *c, int flags) attribute_warn_unused_result</div><div class="ttdoc">Create an iterator for a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00485">astobj2_container.c:485</a></div></div>
<div class="ttc" id="pbx_8c_html_a1662981db35d4125afaf6de98b2ba52f"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a1662981db35d4125afaf6de98b2ba52f">ast_get_extension_priority</a></div><div class="ttdeci">int ast_get_extension_priority(struct ast_exten *exten)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08558">pbx.c:8558</a></div></div>
<div class="ttc" id="pbx_8c_html_a49a1c2b750c783e458a6a3dab67e4159"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a49a1c2b750c783e458a6a3dab67e4159">autohints</a></div><div class="ttdeci">static struct ao2_container * autohints</div><div class="ttdoc">Container for autohint contexts. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00380">pbx.c:380</a></div></div>
<div class="ttc" id="structdialplan__counters_html_ad4ee98222efd50240dfd8e745a46b38e"><div class="ttname"><a href="../../d2/dcd/structdialplan__counters.html#ad4ee98222efd50240dfd8e745a46b38e">dialplan_counters::extension_existence</a></div><div class="ttdeci">int extension_existence</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l05483">pbx.c:5483</a></div></div>
<div class="ttc" id="channel_8h_html_a388b1ab04ed52109917914ac73662d0a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a388b1ab04ed52109917914ac73662d0a">ast_channel_set_connected_line</a></div><div class="ttdeci">void ast_channel_set_connected_line(struct ast_channel *chan, const struct ast_party_connected_line *connected, const struct ast_set_party_connected_line *update)</div><div class="ttdoc">Set the connected line information in the Asterisk channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l08404">channel.c:8404</a></div></div>
<div class="ttc" id="pbx_8c_html_aea78542f089fbd63ff25147631b96e51"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aea78542f089fbd63ff25147631b96e51">ast_context_remove_extension_callerid</a></div><div class="ttdeci">int ast_context_remove_extension_callerid(const char *context, const char *extension, int priority, const char *callerid, int matchcallerid, const char *registrar)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04957">pbx.c:4957</a></div></div>
<div class="ttc" id="vector_8h_html_a20b08af81cc9452fb721c9a698f81bdf"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a></div><div class="ttdeci">#define AST_VECTOR_SIZE(vec)</div><div class="ttdoc">Get the number of elements in a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00611">vector.h:611</a></div></div>
<div class="ttc" id="lock_8h_html_ac840092853644cea0a186efdc58985f5"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a></div><div class="ttdeci">#define AST_MUTEX_DEFINE_STATIC(mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00518">lock.h:518</a></div></div>
<div class="ttc" id="pbx_8c_html_a89b5550b3d6ddcd9031eeb79338f5a48"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a89b5550b3d6ddcd9031eeb79338f5a48">pbx_outgoing_destroy</a></div><div class="ttdeci">static void pbx_outgoing_destroy(void *obj)</div><div class="ttdoc">Destructor for outgoing structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07613">pbx.c:7613</a></div></div>
<div class="ttc" id="pbx_8c_html_a3261603753916b98888a5a5fc1d505c3"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a3261603753916b98888a5a5fc1d505c3">ast_extension_state2str</a></div><div class="ttdeci">const char * ast_extension_state2str(int extension_state)</div><div class="ttdoc">Return extension_state as string. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l03126">pbx.c:3126</a></div></div>
<div class="ttc" id="presencestate_8h_html_ac3452f41c7982c84ca27ecf7b4cc7ce1a5b541c7f37468daf2ee6cfe488949adb"><div class="ttname"><a href="../../d6/dd7/presencestate_8h.html#ac3452f41c7982c84ca27ecf7b4cc7ce1a5b541c7f37468daf2ee6cfe488949adb">AST_PRESENCE_INVALID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd7/presencestate_8h_source.html#l00039">presencestate.h:39</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00285">include/asterisk/frame.h:285</a></div></div>
<div class="ttc" id="structast__mutex__info_html"><div class="ttname"><a href="../../d8/dc5/structast__mutex__info.html">ast_mutex_info</a></div><div class="ttdoc">Structure for mutex and tracking information. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00135">lock.h:135</a></div></div>
<div class="ttc" id="structpattern__node_html_a866e3eea299e33d1f7cdc6e46e65835f"><div class="ttname"><a href="../../da/ddf/structpattern__node.html#a866e3eea299e33d1f7cdc6e46e65835f">pattern_node::buf</a></div><div class="ttdeci">char buf[256]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01456">pbx.c:1456</a></div></div>
<div class="ttc" id="strings_8h_html_ab08f8db2a7258e538a0da7417f58db58"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ab08f8db2a7258e538a0da7417f58db58">ast_str_case_hash</a></div><div class="ttdeci">static force_inline int attribute_pure ast_str_case_hash(const char *str)</div><div class="ttdoc">Compute a hash value on a case-insensitive string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01250">strings.h:1250</a></div></div>
<div class="ttc" id="structast__context_html_a2fa7eba1ccec8820c766879753569da0"><div class="ttname"><a href="../../d6/d7c/structast__context.html#a2fa7eba1ccec8820c766879753569da0">ast_context::pattern_tree</a></div><div class="ttdeci">struct match_char * pattern_tree</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00288">pbx.c:288</a></div></div>
<div class="ttc" id="pbx_8c_html_ade1b9a3e676992cb13790cb068234f44"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ade1b9a3e676992cb13790cb068234f44">ast_add_extension2_nolock</a></div><div class="ttdeci">int ast_add_extension2_nolock(struct ast_context *con, int replace, const char *extension, int priority, const char *label, const char *callerid, const char *application, void *data, void(*datad)(void *), const char *registrar, const char *registrar_file, int registrar_line)</div><div class="ttdoc">Same as ast_add_extension2, but assumes you have already locked context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07308">pbx.c:7308</a></div></div>
<div class="ttc" id="pbx_8c_html_aec2e421fa0b10e14812d52c30ec7e744"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aec2e421fa0b10e14812d52c30ec7e744">ast_context_includes_count</a></div><div class="ttdeci">int ast_context_includes_count(const struct ast_context *con)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08697">pbx.c:8697</a></div></div>
<div class="ttc" id="presencestate_8h_html_aec78c2b072d51416200d34bdd06827a7"><div class="ttname"><a href="../../d6/dd7/presencestate_8h.html#aec78c2b072d51416200d34bdd06827a7">ast_presence_state2str</a></div><div class="ttdeci">const char * ast_presence_state2str(enum ast_presence_state state)</div><div class="ttdoc">Convert presence state to text string for output. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d07/presencestate_8c_source.html#l00103">presencestate.c:103</a></div></div>
<div class="ttc" id="vector_8h_html_aeb9853664dde8a7df8bc7ea180d73d54"><div class="ttname"><a href="../../d6/d68/vector_8h.html#aeb9853664dde8a7df8bc7ea180d73d54">AST_VECTOR_CALLBACK_VOID</a></div><div class="ttdeci">#define AST_VECTOR_CALLBACK_VOID(vec, callback,...)</div><div class="ttdoc">Execute a callback on every element in a vector disregarding callback return. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00865">vector.h:865</a></div></div>
<div class="ttc" id="app__jack_8c_html_ac191e5810fa65e63095409471eb5648f"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a></div><div class="ttdeci">jack_status_t status</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00146">app_jack.c:146</a></div></div>
<div class="ttc" id="pbx_8c_html_aee004b6fcfccea3fa6acf9b7264f42c9"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aee004b6fcfccea3fa6acf9b7264f42c9">ast_get_extension_cidmatch</a></div><div class="ttdeci">const char * ast_get_extension_cidmatch(struct ast_exten *e)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l08591">pbx.c:8591</a></div></div>
<div class="ttc" id="pbx_8c_html_a475014156b36f5ceaf11af6a164b7cb3"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a475014156b36f5ceaf11af6a164b7cb3">BITS_PER</a></div><div class="ttdeci">#define BITS_PER</div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
<div class="ttc" id="codecs_2gsm_2inc_2private_8h_html_a0b023cbb2bf7d034c2269d58d7455ac8"><div class="ttname"><a href="../../d6/da0/codecs_2gsm_2inc_2private_8h.html#a0b023cbb2bf7d034c2269d58d7455ac8">word</a></div><div class="ttdeci">short word</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da0/codecs_2gsm_2inc_2private_8h_source.html#l00012">codecs/gsm/inc/private.h:12</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
<div class="ttc" id="pbx_8c_html_ace475b3c63f137d8ff9af0e10d4f5e97"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ace475b3c63f137d8ff9af0e10d4f5e97">device_state_sub</a></div><div class="ttdeci">static struct stasis_subscription * device_state_sub</div><div class="ttdoc">Subscription for device state change events. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00768">pbx.c:768</a></div></div>
<div class="ttc" id="pbx_8c_html_aefee0e2a38de76a008277db39cd9e3a8"><div class="ttname"><a href="../../db/d94/pbx_8c.html#aefee0e2a38de76a008277db39cd9e3a8">get_canmatch_exten</a></div><div class="ttdeci">static struct ast_exten * get_canmatch_exten(struct match_char *node)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01141">pbx.c:1141</a></div></div>
<div class="ttc" id="pbx_8h_html_a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a">AST_EXTENSION_INUSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00065">pbx.h:65</a></div></div>
<div class="ttc" id="res__pktccops_8c_html_acc5ce172913ccabaada04d5c408dd85b"><div class="ttname"><a href="../../dd/d95/res__pktccops_8c.html#acc5ce172913ccabaada04d5c408dd85b">t1</a></div><div class="ttdeci">static uint16_t t1</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d95/res__pktccops_8c_source.html#l00157">res_pktccops.c:157</a></div></div>
<div class="ttc" id="http_8c_html_a6f25bc812d09fedb86bf394c01061c56"><div class="ttname"><a href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a></div><div class="ttdeci">static char prefix[MAX_PREFIX]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00141">http.c:141</a></div></div>
<div class="ttc" id="pbx_8c_html_ae25a2122becbf9b94f5d55bc86753fea"><div class="ttname"><a href="../../db/d94/pbx_8c.html#ae25a2122becbf9b94f5d55bc86753fea">destroy_exten</a></div><div class="ttdeci">static void destroy_exten(struct ast_exten *e)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04678">pbx.c:4678</a></div></div>
<div class="ttc" id="pbx_8c_html_a20a2f5668173430437db02cdd0acc9f3"><div class="ttname"><a href="../../db/d94/pbx_8c.html#a20a2f5668173430437db02cdd0acc9f3">ast_hashtab_compare_contexts</a></div><div class="ttdeci">int ast_hashtab_compare_contexts(const void *ah_a, const void *ah_b)</div><div class="ttdoc">hashtable functions for contexts </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00683">pbx.c:683</a></div></div>
<div class="ttc" id="stringfields_8h_html_a653461abd6e0d16e4e3326ab90e0501d"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a></div><div class="ttdeci">#define ast_string_field_set(x, field, data)</div><div class="ttdoc">Set a field to a simple string value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00514">stringfields.h:514</a></div></div>
<div class="ttc" id="structast__pbx_html_a765bfb11e07b0f90c235c9af9d7f46fa"><div class="ttname"><a href="../../d6/d83/structast__pbx.html#a765bfb11e07b0f90c235c9af9d7f46fa">ast_pbx::rtimeoutms</a></div><div class="ttdeci">int rtimeoutms</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00213">pbx.h:213</a></div></div>
<div class="ttc" id="structmatch__char_html_a3cb0d95aa820737d010fdfaccac92ec3"><div class="ttname"><a href="../../da/d14/structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">match_char::deleted</a></div><div class="ttdeci">int deleted</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00264">pbx.c:264</a></div></div>
<div class="ttc" id="structmatch__char_html"><div class="ttname"><a href="../../da/d14/structmatch__char.html">match_char</a></div><div class="ttdoc">match_char: forms a syntax tree for quick matching of extension patterns </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l00261">pbx.c:261</a></div></div>
<div class="ttc" id="dnsmgr_8c_html_a03e6cca0c879c0443efb431c30c14f76"><div class="ttname"><a href="../../d0/d5d/dnsmgr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a></div><div class="ttdeci">static int enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d5d/dnsmgr_8c_source.html#l00091">dnsmgr.c:91</a></div></div>
<div class="ttc" id="structast__tm_html"><div class="ttname"><a href="../../d5/d84/structast__tm.html">ast_tm</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/deb/localtime_8h_source.html#l00035">localtime.h:35</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga0ee6ee1f4d200f711e2983bffe770a72"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a></div><div class="ttdeci">void astman_send_listack(struct mansession *s, const struct message *m, char *msg, char *listflag)</div><div class="ttdoc">Send ack in manager transaction to begin a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03201">manager.c:3201</a></div></div>
<div class="ttc" id="hashtab_8h_html_a6103589badf8d9440a0cece2802c4c3a"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#a6103589badf8d9440a0cece2802c4c3a">ast_hashtab_destroy</a></div><div class="ttdeci">void ast_hashtab_destroy(struct ast_hashtab *tab, void(*objdestroyfunc)(void *obj))</div><div class="ttdoc">This func will free the hash table and all its memory. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00363">hashtab.c:363</a></div></div>
<div class="ttc" id="pbx_8c_html_af16fde113e4d9557207bb21772312196"><div class="ttname"><a href="../../db/d94/pbx_8c.html#af16fde113e4d9557207bb21772312196">insert_in_next_chars_alt_char_list</a></div><div class="ttdeci">static void insert_in_next_chars_alt_char_list(struct match_char **parent_ptr, struct match_char *node)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l01418">pbx.c:1418</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a13dd15487fee89a002d17ef3aff62d02"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a></div><div class="ttdeci">static struct test_val a</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00046">test_linkedlists.c:46</a></div></div>
<div class="ttc" id="structast__party__id_html_aca2d7de6c89f201dc8bd0a2642d2a352"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">ast_party_id::number</a></div><div class="ttdeci">struct ast_party_number number</div><div class="ttdoc">Subscriber phone number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00343">channel.h:343</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
<div class="ttc" id="dial_8h_html_a3cd0ba996525c0c0b9c88c743fe6c34d"><div class="ttname"><a href="../../df/dcf/dial_8h.html#a3cd0ba996525c0c0b9c88c743fe6c34d">ast_dial_prerun</a></div><div class="ttdeci">int ast_dial_prerun(struct ast_dial *dial, struct ast_channel *chan, struct ast_format_cap *cap)</div><div class="ttdoc">Request all appended channels, but do not dial. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/dial_8c_source.html#l00433">dial.c:433</a></div></div>
<div class="ttc" id="hashtab_8h_html_a71bd19ff2f6fad1cf5e01f9b8cad6f66"><div class="ttname"><a href="../../d6/da0/hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66">ast_hashtab_remove_this_object</a></div><div class="ttdeci">void * ast_hashtab_remove_this_object(struct ast_hashtab *tab, void *obj)</div><div class="ttdoc">Hash the object and then compare ptrs in bucket list instead of calling the compare routine...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d35/hashtab_8c_source.html#l00789">hashtab.c:789</a></div></div>
<div class="ttc" id="channel_8h_html_a9e9505a91a84992d04ba4e85217fb4e4a33d9271d8d892501de8c9536382d71ea"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a33d9271d8d892501de8c9536382d71ea">AST_SOFTHANGUP_HANGUP_EXEC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l01155">channel.h:1155</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:43:54 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
