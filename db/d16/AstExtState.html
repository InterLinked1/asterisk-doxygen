<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: Extension and device states in Asterisk</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Extension and device states in Asterisk </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>(Note that these descriptions of device states and extension states have not been updated to the way things work in Asterisk 1.6.)</p>
<p>Asterisk has an internal system that reports states for an extension. By using the dialplan priority -1, also called a <b>hint</b>, a connection can be made from an extension to one or many devices. The state of the extension now depends on the combined state of the devices.</p>
<p>The device state is basically based on the current calls. If the devicestate engine can find a call from or to the device, it's in use.</p>
<p>Some channel drivers implement a callback function for a better level of reporting device states. The SIP channel has a complicated system for this, which is improved by adding call limits to the configuration.</p>
<p>Functions that want to check the status of an extension register themself as a <b>watcher</b>. Watchers in this system can subscribe either to all extensions or just a specific extensions.</p>
<p>For non-device related states, there's an API called devicestate providers. This is an extendible system for delivering state information from outside sources or functions within Asterisk. Currently we have providers for app_meetme.c - the conference bridge - and call parking (metermaids).</p>
<p>There are manly three subscribers to extension states within Asterisk:</p><ul>
<li>AMI, the manager interface</li>
<li>app_queue.c - the Queue dialplan application</li>
<li>SIP subscriptions, a.k.a. "blinking lamps" or "buddy lists"</li>
</ul>
<p>The CLI command "show hints" show last known state</p>
<dl class="section note"><dt>Note</dt><dd>None of these handle user states, like an IM presence system. res_xmpp.c can subscribe and watch such states in jabber/xmpp based systems.</dd></dl>
<h1><a class="anchor" id="AstDevStateArch"></a>
Architecture for devicestates</h1>
<p>When a channel driver or asterisk app changes state for a watched object, it alerts the core. The core queues a change. When the change is processed, there's a query sent to the channel driver/provider if there's a function to handle that, otherwise a channel walk is issued to find a channel that involves the object.</p>
<p>The changes are queued and processed by a separate thread. This thread calls the watchers subscribing to status changes for the object. For manager, this results in events. For SIP, NOTIFY requests.</p>
<ul>
<li>Device states <ul>
<li><a class="el" href="../../d1/d80/devicestate_8c.html">devicestate.c</a> </li>
<li><a class="el" href="../../da/da2/devicestate_8h.html">devicestate.h</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="AstExtStateArch"></a>
Architecture for extension states</h1>
<p>Hints are connected to extension. If an extension changes state it checks the hint devices. If there is a hint, the callbacks into device states are checked. The aggregated state is set for the hint and reported back.</p>
<ul>
<li>Extension states <ul>
<li>AstENUM ast_extension_states </li>
<li><a class="el" href="../../db/d94/pbx_8c.html">pbx.c</a> </li>
<li><a class="el" href="../../db/de0/pbx_8h.html">pbx.h</a></li>
</ul>
</li>
<li>Structures<ul>
<li><a class="el" href="../../d6/d37/structast__state__cb.html">ast_state_cb</a> struct. Callbacks for watchers</li>
<li>Callback ast_state_cb_type</li>
<li><a class="el" href="../../d8/dac/structast__hint.html">ast_hint</a> struct.</li>
</ul>
</li>
<li>Functions<ul>
<li><a class="el" href="../../db/de0/pbx_8h.html#ab1d88f370509aae87302134e6f70628a" title="Add watcher for extension states. ">ast_extension_state_add()</a></li>
<li><a class="el" href="../../db/de0/pbx_8h.html#aa992580d26443e3306f7f08cf5908e7c" title="Deletes a state change watcher by ID. ">ast_extension_state_del()</a></li>
<li><a class="el" href="../../db/de0/pbx_8h.html#ac778ac642def88a06e5d59e11a964c43" title="If an extension hint exists, return non-zero. ">ast_get_hint()</a> </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:47:15 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
